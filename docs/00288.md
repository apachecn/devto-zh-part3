# å¦‚ä½•ä½¿ç”¨ Java Executor æ¡†æ¶è¿›è¡Œå¤šçº¿ç¨‹å¤„ç†

> åŸæ–‡:[https://dev . to/adityasridhar/how-to-use-Java-executor-framework-for-threading-30oc](https://dev.to/adityasridhar/how-to-use-java-executor-framework-for-multithreading-30oc)

**æœ¬å¸–åŸè½½äº[adityasridhar.com](https://adityasridhar.com/posts/how-to-use-java-executor-framework-for-multithreading)T3ã€‘**

åœ¨æˆ‘ä¹‹å‰çš„åšå®¢ä¸­ï¼Œæˆ‘ä»‹ç»äº† Java å¤šçº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†ã€‚ç‚¹å‡»è¿™é‡Œé˜…è¯»åšå®¢ã€‚

ä¸Šä¸€ç¯‡åšå®¢ä»‹ç»äº†å¦‚ä½•é€šè¿‡æ‰©å±• Thread ç±»å’Œå®ç° Runnable æ¥å£æ¥åˆ›å»ºçº¿ç¨‹ã€‚

æœ¬æ–‡å°†æ¶µç›–ä¸¤ä¸ªä¸»é¢˜ã€‚

*   é€šè¿‡å®ç°å¯è°ƒç”¨æ¥å£åˆ›å»ºçº¿ç¨‹
*   åœ¨ Java ä¸­ä½¿ç”¨ Executor æ¡†æ¶

# [](#implementing-the-callable-interface)å®ç°å¯è°ƒç”¨æ¥å£

ä¸ºäº†åˆ›å»ºä¸€æ®µå¯ä»¥åœ¨çº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç±»ï¼Œç„¶åå®ç°äº†å¯è°ƒç”¨çš„æ¥å£ã€‚è¿™æ®µä»£ç æ‰§è¡Œçš„ä»»åŠ¡éœ€è¦æ”¾åœ¨ **call()** å‡½æ•°ä¸­ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ä½ å¯ä»¥çœ‹åˆ° **CallableTask** æ˜¯ä¸€ä¸ªå®ç° **Callable** æ¥å£çš„ç±»ï¼Œå¯¹ 0 åˆ° 4 çš„æ•°å­—æ±‚å’Œçš„ä»»åŠ¡æ˜¯åœ¨å‡½æ•°ä¸­å®Œæˆçš„ã€‚

```
import java.util.concurrent.Callable;
class CallableTask implements Callable<Integer> {

    @Override
    public Integer call() throws Exception {

        int sum = 0;
        for (int i = 0; i < 5; i++) {
            sum += i;
        }
        return sum;
    }

} 
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½ ä¼šæ³¨æ„åˆ° **Callable** æœ‰ä¸€ä¸ªå‚æ•° **Integer** ã€‚è¿™è¡¨æ˜è¿™ä¸ª Callable çš„è¿”å›ç±»å‹å°†æ˜¯ Integerã€‚è¿˜å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨å‡½æ•°è¿”å›çš„æ˜¯**æ•´æ•°**ç±»å‹ã€‚

## [](#creating-the-threads-and-running-them)åˆ›å»ºçº¿ç¨‹å¹¶è¿è¡Œ

ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºçº¿ç¨‹ï¼Œç„¶åè¿è¡Œå®ƒä»¬ã€‚

```
import java.util.concurrent.ExecutionException;
import java.util.concurrent.FutureTask;
public class CallableInterfaceDemo {

    public static void main(String[] args) {
        FutureTask<Integer>[] futureList = new FutureTask[5];

        for (int i = 0; i <= 4; i++) {
            Callable<Integer> callable = new CallableTask();
            futureList[i] = new FutureTask<Integer>(callable);
            Thread t = new Thread(futureList[i]);
            t.start();

        }

        for (int i = 0; i <= 4; i++) {
            FutureTask<Integer> result = futureList[i];
            try {
                System.out.println("Future Task" + i + ":" + result.get());
            } catch (InterruptedException e) {

                e.printStackTrace();
            } catch (ExecutionException e) {

                e.printStackTrace();
            }
        }

    }

} 
```

ä¸ºäº†åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª **CallableTask** çš„å®ä¾‹ï¼Œå®ƒå®ç°äº† **Callable** æ¥å£ï¼Œå¦‚
æ‰€ç¤º

```
Callable<Integer> callable = new CallableTask(); 
```

ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª **FutureTask** ç±»çš„å®ä¾‹ï¼Œå¹¶å°†**å¯è°ƒç”¨**ä»»åŠ¡çš„å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå¦‚
æ‰€ç¤º

```
futureList[i] = new FutureTask<Integer>(callable); 
```

ç„¶åï¼Œä¸ºäº†åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª **Thread** ç±»çš„å®ä¾‹ï¼Œå¹¶å°† **FutureTask** ç±»çš„å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå¦‚
æ‰€ç¤º

```
Thread t = new Thread(futureList[i]); 
```

æœ€åç”¨ **start()** å‡½æ•°å¯åŠ¨çº¿ç¨‹ã€‚

## [](#getting-the-result-from-the-thread)ä»çº¿ç¨‹ä¸­è·å–ç»“æœ

åœ¨å¯è°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å®é™…ä¸Šå¯ä»¥**è¿”å›å€¼**ã€‚ä¸ºäº†è·å¾—è¿™ä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ **FutureTask** çš„å®ä¾‹ä¸Šè°ƒç”¨ **get()** å‡½æ•°ã€‚åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œçº¿ç¨‹çš„è¿”å›å€¼æ˜¯ä» 0 åˆ° 4 çš„æ•°å­—ä¹‹å’Œã€‚

è¿™æ˜¾ç¤ºåœ¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µ
ä¸­

```
FutureTask<Integer> result = futureList[i];
try {
    System.out.println("Future Task" + i + ":" + result.get());
} catch (InterruptedException e) {

    e.printStackTrace();
} catch (ExecutionException e) {

    e.printStackTrace();
} 
```

çº¿ç¨‹ä¹Ÿå¯èƒ½æŠ›å‡ºä¸€ä¸ª**å¼‚å¸¸**ï¼Œè¿™ä¸ªå¼‚å¸¸å¯ä»¥ç”¨ **try catch** å—æ¥å¤„ç†ã€‚

## [](#complete-code)å®Œæ•´ä»£ç 

è¿™é‡Œæ˜¯è®¨è®ºåˆ°ç›®å‰ä¸ºæ­¢çš„å®Œæ•´ä»£ç 

```
import java.util.concurrent.Callable;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.FutureTask;

class CallableTask implements Callable<Integer> {

    @Override
    public Integer call() throws Exception {

        int sum = 0;
        for (int i = 0; i < 5; i++) {
            sum += i;
        }
        return sum;
    }

}

public class CallableInterfaceDemo {

    public static void main(String[] args) {
        FutureTask<Integer>[] futureList = new FutureTask[5];

        for (int i = 0; i <= 4; i++) {
            Callable<Integer> callable = new CallableTask();
            futureList[i] = new FutureTask<Integer>(callable);
            Thread t = new Thread(futureList[i]);
            t.start();

        }

        for (int i = 0; i <= 4; i++) {
            FutureTask<Integer> result = futureList[i];
            try {
                System.out.println("Future Task" + i + ":" + result.get());
            } catch (InterruptedException e) {

                e.printStackTrace();
            } catch (ExecutionException e) {

                e.printStackTrace();
            }
        }

    }

} 
```

# [](#the-executor-framework)æ‰§è¡Œè€…æ¡†æ¶

æ¯æ¬¡åŠ¨æ€åˆ›å»ºçº¿ç¨‹éƒ½æ˜¯èµ„æºå¯†é›†å‹çš„ã€‚ä¸€ä¸ªå¥½çš„æ›¿ä»£æ–¹æ³•æ˜¯è®¾ç½®ä¸€äº›çº¿ç¨‹ï¼Œç„¶åå°†æˆ‘ä»¬çš„ä»»åŠ¡åˆ†é…ç»™è¿™äº›çº¿ç¨‹ã€‚è¿™å°±æ˜¯ Executors ç±»å’Œ ExecutorService éå¸¸æœ‰ç”¨çš„åœ°æ–¹ã€‚

[![Thread pool](../Images/6dc8b62390d9ea742bb2349db6cffffd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--8ciHe9MX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/q3yg6ofbxscmzlkcw1ho.jpg)

ä¸Šå›¾æ˜¾ç¤ºäº†ä¸€ä¸ªæœ‰ 4 ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚æ¯å½“æˆ‘ä»¬æƒ³è¦è¿è¡Œä»»ä½•ä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒåˆ†é…ç»™è¿™äº›çº¿ç¨‹ã€‚ä¸€æ—¦ä»»åŠ¡å®Œæˆï¼Œçº¿ç¨‹å°†è¢«é‡Šæ”¾ä»¥æ‰¿æ‹…å…¶ä»–ä»»åŠ¡ã€‚

## [](#how-to-use-the-executor-framework)å¦‚ä½•ä½¿ç”¨æ‰§è¡Œäººæ¡†æ¶

ä¸‹é¢æ˜¯ä¸€æ®µä½¿ç”¨ Executor æ¡†æ¶çš„ä»£ç ã€‚

```
import java.util.concurrent.Callable;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.Future;

class Worker implements Callable<Integer> {

    @Override
    public Integer call() throws Exception {

        int sum = 0;
        for (int i = 0; i < 5; i++) {
            sum += i;
        }
        return sum;
    }

}

public class ExecutorDemo {

    public static void main(String[] args) {
        ExecutorService executors = Executors.newFixedThreadPool(4);
        Future<Integer>[] futures = new Future[5];
        Callable<Integer> w = new Worker();
        try {
            for (int i = 0; i < 5; i++) {
                Future<Integer> future = executors.submit(w);
                futures[i] = future;

            }

            for (int i = 0; i < futures.length; i++) {
                try {
                    System.out.println("Result from Future " + i + ":" + futures[i].get());
                } catch (InterruptedException e) {

                    e.printStackTrace();
                } catch (ExecutionException e) {

                    e.printStackTrace();
                }
            }
        } finally {
            executors.shutdown();
        }

    }

} 
```

é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª**å·¥äºº**ç±»ï¼Œç”±**å®ç°å¯è°ƒç”¨çš„**å¹¶å®Œæˆæˆ‘ä»¬éœ€è¦çš„ä»»åŠ¡ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª**æ‰§è¡ŒæœåŠ¡**ã€‚

**Executors** ç±»æœ‰å¤šä¸ª **ExecutorService** çš„å®ç°ã€‚

è®©æˆ‘ä»¬ä½¿ç”¨ **Executors** ç±»åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º 4 çš„å›ºå®šçº¿ç¨‹æ± ã€‚è¿™æ˜¯è¿™æ ·åšçš„

```
ExecutorService executors = Executors.newFixedThreadPool(4); 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»»åŠ¡æäº¤ç»™ Executor æœåŠ¡ã€‚è¿™æ˜¯ä½¿ç”¨ä¸‹é¢çš„ä»£ç è¡Œ
å®Œæˆçš„

```
Future<Integer> future = executors.submit(w); 
```

åœ¨æäº¤ä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª**æœªæ¥**å¯¹è±¡çš„å®ä¾‹ã€‚æœªæ¥å¯¹è±¡æ˜¯å­˜å‚¨ä»»åŠ¡ç»“æœçš„å¯¹è±¡ã€‚

## [](#getting-the-result-of-the-thread)è·å–çº¿ç¨‹çš„ç»“æœ

ä¸ºäº†å¾—åˆ°æ¯ä¸ªä»»åŠ¡çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨**æœªæ¥**å®ä¾‹çš„ **get()** æ–¹æ³•ã€‚
å¦‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ‰€ç¤ºã€‚

```
try {
    System.out.println("Result from Future " + i + ":" + futures[i].get());
} catch (InterruptedException e) {

    e.printStackTrace();
} catch (ExecutionException e) {

    e.printStackTrace();
} 
```

çº¿ç¨‹ä¹Ÿå¯ä»¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨ **try catch** æ¥å¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚

## [](#some-possible-scenarios-of-the-fixed-thread-pool)å›ºå®šçº¿ç¨‹æ± çš„ä¸€äº›å¯èƒ½åœºæ™¯

*   åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¤§å°ä¸º 4 çš„å›ºå®šçº¿ç¨‹æ± 
*   å¦‚æœæˆ‘ä»¬å‘è¿™ä¸ª ExecutorService æäº¤æ€»å…± 3 ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆè¿™ 3 ä¸ªä»»åŠ¡éƒ½å°†è¢«åˆ†é…åˆ°çº¿ç¨‹æ± ï¼Œå®ƒä»¬å°†å¼€å§‹æ‰§è¡Œã€‚
*   å¦‚æœæˆ‘ä»¬å‘ ExecutorService æäº¤ 4 ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆè¿™ 4 ä¸ªä»»åŠ¡éƒ½å°†è¢«åˆ†é…ç»™çº¿ç¨‹æ± ï¼Œå¹¶å¼€å§‹æ‰§è¡Œã€‚
*   ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å‘è¿™ä¸ªçº¿ç¨‹æ± æäº¤ 5 ä¸ªä»»åŠ¡ã€‚åªæœ‰ 4 ä¸ªä»»åŠ¡å°†è¢«åˆ†é…ç»™çº¿ç¨‹æ± ã€‚è¿™æ˜¯å› ä¸ºçº¿ç¨‹æ± çš„å¤§å°æ˜¯ 4ã€‚åªæœ‰å½“æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹è¢«é‡Šæ”¾æ—¶ï¼Œæ‰ä¼šåˆ†é…ç¬¬ 5 ä¸ªä»»åŠ¡

## [](#shutting-down-the-executorservice)å…³é—­æ‰§è¡ŒæœåŠ¡

å½“ä¸å†éœ€è¦çº¿ç¨‹æ—¶ï¼Œéœ€è¦å…³é—­ ExecutorServiceã€‚è¿™å°†ç¡®ä¿ JVM ä¸ä¼šæ¶ˆè€—é¢å¤–çš„èµ„æºã€‚

å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤
å…³é—­ ExecutorService

```
executors.shutdown(); 
```

å¯ä»¥çœ‹å‡ºï¼Œè¯¥åœæœºè¢«ç½®äº**æœ€ç»ˆ**ç¨‹åºå—å†…ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿å³ä½¿å‘ç”Ÿä»»ä½•å¼‚å¸¸ï¼Œå…³æœºä¹Ÿæ€»æ˜¯åœ¨ä»£ç ç»“æŸæ—¶æ‰§è¡Œã€‚

å¦‚æœå…³é—­æ²¡æœ‰ä»¥æ­£ç¡®çš„æ–¹å¼å®Œæˆï¼Œé‚£ä¹ˆåœ¨å‘ç”Ÿä»»ä½•å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼ŒExecutorService ä»å°†è¿è¡Œï¼Œå¹¶å°†æ¶ˆè€—é¢å¤–çš„ JVM èµ„æºã€‚

# [](#code)ä»£ç 

æœ¬æ–‡ä¸­è®¨è®ºçš„æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨è¿™ä¸ª git repo ä¸­æ‰¾åˆ°

# [](#congrats)æ­å–œæ­å–œğŸ˜ƒ

ç°åœ¨ä½ çŸ¥é“äº†ä»¥ä¸‹æ¦‚å¿µ

*   ä½¿ç”¨å¯è°ƒç”¨æ¥å£
*   ä½¿ç”¨ Java Executor æ¡†æ¶å®ç°å¤šçº¿ç¨‹ã€‚

åœ¨æˆ‘ä»¥åçš„æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä¼šæ¶‰åŠæ›´å¤šå…³äºå¤šçº¿ç¨‹çš„ä¸»é¢˜

### [](#feel-free-to-connect-with-me-in-linkedin-or-follow-me-in-twitter)æ¬¢è¿åœ¨ [LinkedIn](https://www.linkedin.com/in/aditya1811/) ä¸æˆ‘è”ç³»ï¼Œæˆ–åœ¨ [twitter](https://twitter.com/adityasridhar18) å…³æ³¨æˆ‘ã€‚

### å¦‚æœä½ å–œæ¬¢è¿™ä¸ªå¸–å­ï¼Œä½ å¯ä»¥å»æˆ‘çš„ç½‘ç«™ã€https://adityasridhar.com T2ã€‘æŸ¥çœ‹å…¶ä»–ç±»ä¼¼çš„å¸–å­