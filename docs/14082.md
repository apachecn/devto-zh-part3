# å¦‚ä½•ä½¿ç”¨ NodeJs åœ¨ Gitlab ä¸Šè®¾ç½® CI/CD ç¯å¢ƒ

> åŸæ–‡:[https://dev . to/6th code/how-to-set-up-a-cicd-environment-on-git lab-using-nodejs-jh3](https://dev.to/6thcode/how-to-set-up-a-cicd-environment-on-gitlab-using-nodejs-jh3)

æ‰€ä»¥æˆ‘å†³å®šé€šè¿‡è®¨è®ºå¦‚ä½•å»ºç«‹æŒç»­é›†æˆ(CI)å’ŒæŒç»­äº¤ä»˜(CD)æ¥å¼€å§‹æˆ‘å…³äº dev.to çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæ¬¢è¿åé¦ˆï¼Œè¿™å¾ˆæœ‰å¸®åŠ©ï¼

[![](../Images/2e7b2d0f0033cc3563b8939ee3854bc1.png)T2ã€‘](https://i.giphy.com/media/3o7TKsJEd0lp7GNUpq/giphy.gif)

æŒç»­é›†æˆ(CI)æ˜¯ä¸€ç§å®è·µï¼Œå®ƒè¦æ±‚å¼€å‘äººå‘˜å¤šæ¬¡å°†ä»£ç é›†æˆåˆ°å…±äº«å­˜å‚¨åº“ä¸­ã€‚ç„¶åï¼Œæ¯ä¸ªç­¾å…¥éƒ½ç”±ä¸€ä¸ªè‡ªåŠ¨æ„å»ºè¿›è¡ŒéªŒè¯ï¼Œå…è®¸å›¢é˜Ÿæ£€æµ‹é—®é¢˜å¹¶å°½æ—©ä¿®å¤ã€‚

è¿ç»­äº¤ä»˜(CD)æ˜¯ä¸€ç§è½¯ä»¶å·¥ç¨‹æ–¹æ³•ï¼Œå…¶ä¸­è¿ç»­é›†æˆã€è‡ªåŠ¨åŒ–æµ‹è¯•å’Œè‡ªåŠ¨åŒ–éƒ¨ç½²åŠŸèƒ½å…è®¸åœ¨æœ€å°‘çš„äººå·¥å¹²é¢„ä¸‹å¼€å‘å’Œéƒ¨ç½²è½¯ä»¶ã€‚

æ‹¥æœ‰ä¸€ä¸ªåˆé€‚çš„ CI/CD ç¯å¢ƒå°†èƒ½å¤Ÿæ›´æ—©åœ°å‘ç°é”™è¯¯ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ›´å¿«åœ°æ£€æŸ¥ä»£ç å¹¶ä¿®å¤å®ƒã€‚

åˆ°æœ¬æ–‡ç»“æŸæ—¶ï¼Œæ‚¨å°†å¯¹å¦‚ä½•åœ¨ Gitlab ä¸Šè®¾ç½® CI/CD ç¯å¢ƒæœ‰äº†åŸºæœ¬çš„äº†è§£ã€‚

### [](#step-1-create-a-project-on-gitlab)ç¬¬ä¸€æ­¥:åœ¨ Gitlab ä¸Šåˆ›å»ºé¡¹ç›®

Gitlab æ˜¯ä¸€ä¸ªåŸºäº web çš„ Git-repository managerï¼Œå¯ä»¥åœ¨å…¶ä¸­æ‰˜ç®¡ä»£ç ã€‚å¦‚æœæ‚¨æ²¡æœ‰å¸æˆ·ï¼Œè¯·æ³¨å†Œï¼›å¦‚æœæ‚¨å·²ç»æœ‰å¸æˆ·ï¼Œè¯·ç™»å½•ç°æœ‰å¸æˆ·ã€‚åˆ›å»ºä¸€ä¸ªå­˜å‚¨åº“ï¼Œä½ å¯ä»¥ç»™å®ƒèµ·ä»»ä½•ä½ å–œæ¬¢çš„åå­—ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©å…¬å¼€æˆ–è€…ç§æœ‰å­˜å‚¨åº“ã€‚å…¬ä¼—å¯ä»¥é€šè¿‡æœç´¢æˆ–ä½¿ç”¨é¡¹ç›®çš„ URL ç›´æ¥è®¿é—®å…¬å…±å­˜å‚¨åº“ï¼Œç›¸åï¼Œç§æœ‰å­˜å‚¨åº“åªèƒ½ç”±æ‰€æœ‰è€…æˆ–ç»´æŠ¤è€…é‚€è¯·çš„æˆå‘˜è®¿é—®ã€‚

### [](#step-2-setting-up-your-ci-environment)æ­¥éª¤ 2:è®¾ç½®æ‚¨çš„ CI ç¯å¢ƒ

è¦è®¾ç½®ä¸€ä¸ª CI ç¯å¢ƒï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªåä¸º`.gitlab-ci.yml`çš„æ–‡ä»¶ï¼Œå®ƒåº”è¯¥ä½äºæ‚¨çš„å­˜å‚¨åº“çš„æ ¹ç›®å½•ä¸‹ã€‚

è¯¥æ–‡ä»¶åŒ…å«å¦‚ä½•æ„å»ºé¡¹ç›®çš„åˆ†æ­¥æè¿°ã€‚Gitlab runner å°†åœ¨æ‚¨çš„å­˜å‚¨åº“ä¸­æœç´¢è¿™ä¸ªæ–‡ä»¶å¹¶æ‰§è¡Œå®ƒã€‚GitLab CI åœ¨æ‚¨çš„å­˜å‚¨åº“ä¸­æŸ¥æ‰¾è¿™ä¸ªç‰¹å®šçš„æ–‡ä»¶ï¼Œä»¥ç¡®å®šå®ƒåº”è¯¥å¦‚ä½•æµ‹è¯•ä»£ç ã€‚

æ‚¨å¯ä»¥é€šè¿‡å·²ç»åˆ›å»ºçš„ Gitlab é¡¹ç›®æˆ–é€šè¿‡æ‚¨çš„ç»ˆç«¯æ¥åˆ›å»ºè¿™ä¸ªæ–‡ä»¶ã€‚æˆ‘å°†åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨ç»ˆç«¯ã€‚æˆ‘å–œæ¬¢æˆ‘çš„ bash å‘½ä»¤ğŸ˜ğŸ˜

æ‰“å¼€æ‚¨çš„ç»ˆç«¯ï¼Œç§»åŠ¨åˆ°é¡¹ç›®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œç„¶åé€šè¿‡ä»¥ä¸‹æ“ä½œåˆ›å»ºä¸€ä¸ªåä¸º`.gitlab-ci.yml`çš„æ–‡ä»¶:-

`$ touch .gitlab-ci.yml`

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¿…é¡»ç¼–è¾‘`.gitlab-ci.yml`æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä»¥ä¸‹æ“ä½œåˆ›å»º CI é…ç½®:-

`$ nano .gitlab-ci.yml`

é…ç½®é¡¹é…ç½®çœ‹èµ·æ¥åƒè¿™æ ·ï¼Œåº”è¯¥åœ¨æ‚¨çš„`.gitlab-ci.yml`æ–‡ä»¶ä¸­:-

```
 image: node:latest

    stages:
      - build
      - test

    cache:
      paths:
        - node_modules/

    install_dependencies:
      stage: build
      script:
        - npm install
      artifacts:
        paths:
          - node_modules/

    testing_testing:
      stage: test
      script: npm test 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬æ¥ç†è§£ä¸Šé¢çš„ç‰‡æ®µæ˜¯å…³äºä»€ä¹ˆçš„

[![](../Images/3dce533a12f7312249921d74f2a6ab57.png)T2ã€‘](https://i.giphy.com/media/aBN66chr4Y9na/giphy.gif)

é…ç½®æ–‡ä»¶ä»å£°æ˜ docker æ˜ åƒå¼€å§‹ï¼Œè¯¥æ˜ åƒå…è®¸æ‚¨æŒ‡å®šåœ¨æ„å»ºæ—¶è¦ä½¿ç”¨çš„ NodeJS çš„æŸä¸ªç‰ˆæœ¬ã€‚

```
 image: node:latest 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰å®ƒå°†è¿è¡Œçš„ä¸åŒçš„æŒç»­é›†æˆè¿‡ç¨‹ã€‚

```
 stages:
      - build
      - test 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬å·²ç»å®šä¹‰äº†é˜¶æ®µï¼Œé…ç½®åŒ…æ‹¬ä¸€ä¸ª`cache`ï¼Œå®ƒæŒ‡å®šäº†åº”è¯¥ä¿å­˜çš„æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨è¿è¡Œæˆ–é˜¶æ®µä¹‹é—´ä½¿ç”¨ã€‚

```
 cache:
      paths:
        - node_modules/ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥æ˜¯`install_dependencies`ï¼Œåœ¨æ¼”ç¤ºé˜¶æ®µé—´äº¤äº’çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨æŠ½å–è¿™ä¸ªæ­¥éª¤æ¥è¿è¡Œå®ƒè‡ªå·±çš„é˜¶æ®µã€‚é€šå¸¸ï¼Œè¿è¡Œ`npm install`å¯ä»¥ä¸æ¥ä¸‹æ¥çš„æµ‹è¯•é˜¶æ®µç›¸ç»“åˆã€‚

```
 install_dependencies:
      stage: build
      script:
        - npm install
      artifacts:
        paths:
          - node_modules/ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œ`testing_testing`å£°æ˜å°†è¿è¡Œæµ‹è¯•å¥—ä»¶çš„å‘½ä»¤ï¼Œå› ä¸ºè¿™æ˜¯æœ€åä¸€ä¸ªé˜¶æ®µï¼Œå®ƒå°†è®¿é—®ç”±`build`é˜¶æ®µäº§ç”Ÿçš„å†…å®¹ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯é¡¹ç›®ä¾èµ–å…³ç³»ã€‚

```
 testing_testing:
      stage: test
      script: npm test 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å“¦ï¼Œæ˜¯çš„ï¼Œ`testing_testing`åªæ˜¯æˆ‘ç”¨çš„ä¸€ä¸ªåå­—ï¼Œä½ å¯ä»¥ç»™å®ƒèµ·ä»»ä½•ä½ æƒ³èµ·çš„åå­—ã€‚

### [](#step-3-installing-gitlab-runner)ç¬¬ä¸‰æ­¥:å®‰è£… Gitlab Runner

ç”±äºæˆ‘ä»¬çš„å­˜å‚¨åº“åŒ…å«ä¸€ä¸ª`.gitlab-ci.yml`æ–‡ä»¶ï¼Œä»»ä½•æ–°çš„æäº¤éƒ½å°†è§¦å‘æ–°çš„ CI è¿è¡Œã€‚å¦‚æœæ²¡æœ‰å¯ç”¨çš„è¿è¡Œç¨‹åºï¼ŒCI è¿è¡Œå°†è¢«è®¾ç½®ä¸ºâ€œå¾…å®šâ€ã€‚

å¦‚å‰æ‰€è¿°ï¼Œåœ¨ GitLab ä¸­ï¼Œè·‘æ­¥è€…æ‰§è¡Œæ‚¨åœ¨`.gitlab-ci.yml`ä¸­å®šä¹‰çš„ä»»åŠ¡ã€‚æˆ‘å°†éµå¾ªè¿™é‡Œçš„æŒ‡ç¤ºã€‚

### [](#step-4-register-the-gitlab-runner)ç¬¬å››æ­¥:æ³¨å†Œ Gitlab Runner

æ¥ä¸‹æ¥ï¼ŒæŒ‰ç…§æ­¤å¤„çš„è¯´æ˜[æ³¨å†Œ Gitlab Runnerã€‚
åœ¨ shell ä¸Šè¿è¡Œ runner executor æ˜¯æœ€å®¹æ˜“è®¾ç½®çš„ï¼Œæ‰€ä»¥åœ¨æ³¨å†Œä¹‹åï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£…å¹¶å¯åŠ¨æœåŠ¡:](https://docs.gitlab.com/runner/register/index.html)

`$ gitlab-runner install
$ gitlab-runner start`

è¦ç¡®ä¿æ‚¨çš„è·‘æ­¥è€…æ­£åœ¨è·‘æ­¥ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤:

`$ gitlab-runner status`

å¦‚æœä½ çœ‹åˆ°è¿™ä¸ª:`gitlab-runner: Service is running!`å’Œä½ åœ¨ gitlab ä¸Šåˆ›å»ºçš„é¡¹ç›®ä¸Šçš„ç»¿è‰²å‹¾å·

[![Alt gitlab screenshot](../Images/38f7f27790c86846aed5f3df1a63cc0c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--khfvJ69n--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/0defp5cgmdjb69b6yrz9.png)

### [](#conclusion)ç»“è®º

å¸Œæœ›è¿™ç¯‡æ–‡ç« æ‹“å®½äº† Gitlab CI/CD çš„è¾¹ç•Œï¼Œä¸°å¯Œäº†æ‚¨çš„ç†è§£ï¼Œå°±åƒæˆ‘ä¹‹å‰è¯´çš„ï¼Œæ¬¢è¿åé¦ˆï¼Œä¸‡ä¸€æˆ‘é”™è¿‡äº†ä»€ä¹ˆï¼Œè¯·é€šçŸ¥æˆ‘ã€‚