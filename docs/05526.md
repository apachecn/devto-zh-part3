# ç”¨ react é’©å­é‡æ„æ˜Ÿçº§ç»„ä»¶

> åŸæ–‡:[https://dev . to/eveporcello/refactoring-the-starrating-component-with-react-hooks-5c 79](https://dev.to/eveporcello/refactoring-the-starrating-component-with-react-hooks-5c79)

2017 å¹´æ˜¥å¤©ï¼Œæˆ‘ä»¬å‘å¸ƒäº†æˆ‘ä»¬çš„ç¬¬ä¸€æœ¬[å¥¥è±åˆ©çš„ä¹¦](http://shop.oreilly.com/product/0636920049579.do)ã€*å­¦ä¹ ååº”*ã€‚åœ¨æˆ‘å¬è¯´ä»–ä»¬è¦æŠŠè¿™æœ¬ä¹¦çš„æœ€ç»ˆç‰ˆæœ¬é€åˆ°å°åˆ·å‚çš„é‚£å¤©ï¼Œæˆ‘åœ¨ Twitter ä¸Šæå‡ºäº†ä¸€ä¸ªç®€å•çš„è¯·æ±‚:

> è¿™ä¸ªæ˜ŸæœŸå°±è¦é€åˆ°å°åˆ·å‚äº†ï¼React å’Œç›¸å…³çš„åº“ç»´æŠ¤è€…:è¯·åœ¨ 5 å¹´å·¦å³çš„æ—¶é—´é‡Œä¸è¦æ”¹å˜ä»»ä½•ä¸œè¥¿ã€‚æˆäº¤ï¼ŸğŸ˜€ğŸ˜[https://t.co/njHdsKv6bf](https://t.co/njHdsKv6bf)
> 
> â€” Eve Porcello ([@eveporcello](https://dev.to/eveporcello) ) [April 24, 2017](https://twitter.com/eveporcello/status/856646889772466176?ref_src=twsrc%5Etfw)

æˆ‘è§‰å¾—è¿™å¾ˆåˆç†ã€‚5 å¹´å†…ä¸è¦æ”¹å˜ä»»ä½•äº‹æƒ…ã€‚ä¸¤å¹´åï¼Œå¾ˆå¤šäº‹æƒ…éƒ½å˜äº†ï¼Œå…¬å¹³åœ°è¯´ï¼Œæœ‰äººè­¦å‘Šæˆ‘:

> ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸è¿™æ ·åšï¼Œä½ å°±æ²¡æœ‰å€Ÿå£å†™ç¬¬äºŒç‰ˆäº†ï¼ğŸ™ƒ
> 
> â€” Sophie Alpert (@sophiebits) [April 27, 2017](https://twitter.com/sophiebits/status/857470144338984960?ref_src=twsrc%5Etfw)

å¾ˆæ˜æ˜¾ï¼Œæ²¡æœ‰äººå¬æˆ‘çš„æ¨ç‰¹ï¼Œä½†æœ‰å¾ˆå¥½çš„ç†ç”±ã€‚éšç€ React çš„å‘å±•ï¼Œå®ƒä¼šç»§ç»­å˜å¾—æ›´å¥½ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ç°æœ‰çš„åº”ç”¨ç¨‹åºä¸­åŠ å…¥æ–°çš„æ¨¡å¼æ¥åˆ©ç”¨æ–°çš„ä¼˜åŠ¿ã€‚åœ¨è¿™æœ¬ä¹¦çš„ç¬¬ä¸€ç‰ˆä¸­ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªå«åšé¢œè‰²ç®¡ç†å™¨çš„åº”ç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå…è®¸äººä»¬æ·»åŠ ã€ç¼–è¾‘å’Œåˆ é™¤ä»–ä»¬æœ€å–œæ¬¢çš„é¢œè‰²åˆ—è¡¨ã€‚è¯¥åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå…³é”®åŠŸèƒ½æ˜¯è¯„çº§ï¼Œäººä»¬å¯ä»¥ä¸ºæ¯ç§é¢œè‰²é€‰æ‹©ä¸€ä¸ªæ˜Ÿçº§ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ç¬¬ä¸€ç‰ˆä¸­çš„é¢œè‰²ç®¡ç†å™¨ï¼Œç„¶åæˆ‘ä»¬å°†å¯¹å®ƒè¿›è¡Œå‡çº§ï¼Œä»¥ä½¿ç”¨ä»Šå¹´æ™šäº›æ—¶å€™å°†å‡ºç‰ˆçš„ç¬¬äºŒç‰ˆçš„æœ€æ–°è¯­æ³•ã€‚(æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¼«ä¸ç»å¿ƒçš„å£°æ˜ï¼Œæˆ‘ä»¬æ­£åœ¨å¼€å‘ç¬¬äºŒç‰ˆçš„ *Learning React* ï¼Œå®ƒå°†åŒ…å«æ‰€æœ‰å†…å®¹çš„æœ€æ–°æ›´æ–°ã€‚ä¼šå¾ˆæ£’çš„ã€‚)

é¢œè‰²ç®¡ç†å™¨çš„ç”¨æˆ·ç•Œé¢å¦‚ä¸‹æ‰€ç¤º:

[![color-organizer](../Images/50559bbf92f277181012a6dd930b51b1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--SR1uJu2D--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://moonhighway.com/static/9f9a1b348694536fbd25402239d8939c/4a731/color-organizer.png)

è¿™é‡Œæœ‰å‡ ä¸ªç»„ä»¶åœ¨èµ·ä½œç”¨ï¼Œä½†æ˜¯è®©æˆ‘ä»¬æŠŠé‡ç‚¹æ”¾åœ¨`<StarRating />`ç»„ä»¶ä¸Š:

[![star rating](../Images/25b4e255fc5161a4d3f854d638ef5395.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--lX7RyP25--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://moonhighway.com/static/690cdc630437c71e78fbb872edb095ce/26524/star-rating.png)

è¯„çº§ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ:T0 å’Œ T1ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥è·Ÿè¸ªæ˜æ˜Ÿæ˜¯å¦è¢«é€‰ä¸­ä»¥ç¡®å®šè¯„çº§ã€‚æˆ‘ä»¬è¿˜éœ€è¦å…è®¸ç”¨æˆ·ç‚¹å‡»ä¸€é¢—æ˜Ÿæ¥åº”ç”¨ç‰¹å®šçš„è¯„çº§ã€‚æœ€åï¼Œæˆ‘ä»¬å¸Œæœ›ä¸ºæ˜Ÿçš„æ€»æ•°åˆ†é…ä¸€ä¸ªå€¼ï¼Œä»¥ä¾¿è¯¥ç»„ä»¶å¯ä»¥ç”¨äºæœ‰ 4 æ˜Ÿè¯„çº§ã€5 æ˜Ÿè¯„çº§ã€10 æ˜Ÿè¯„çº§ç­‰çš„åº”ç”¨ç¨‹åºã€‚

åœ¨ä¹¦ä¸­ï¼Œæˆ‘ä»¬ä¸º`StarRating`ä½¿ç”¨äº†ä¸€ä¸ªç±»ç»„ä»¶ï¼Œä¸º`Star`ä½¿ç”¨äº†ä¸€ä¸ªå‡½æ•°ç»„ä»¶ã€‚`Star`çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
const Star = ({ selected = false, onClick = f => f }) => (
  <div className={selected ? "star selected" : "star"} onClick={onClick} /> ); 
```

`Star`æœ‰ä¸¤ä¸ªå±æ€§:`selected`å’Œ`onClick`ã€‚å¦‚æœ`selected`ä¸ºå‡ï¼Œå®ƒå°†æœ‰ä¸€ä¸ª`star`çš„`className`ï¼Œè¿™æ„å‘³ç€å®ƒå°†æ˜¯ç°è‰²è€Œä¸æ˜¯çº¢è‰²ã€‚å•å‡»æ—¶ï¼Œè°ƒç”¨`onClick`æ–¹æ³•ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹`StarRating`ã€‚è¯¥ç»„ä»¶å°†å‘ˆç°æ¥è‡ª`totalStars`å±æ€§çš„`Star`ä¸ªç»„ä»¶çš„æ•°é‡ã€‚ç‚¹å‡»æ—¶ï¼Œæ¯ä¸€ä¸ª`Star`éƒ½ä¼šè§¦å‘`change`æ–¹æ³•ï¼Œè®¾ç½®`starsSelected`çš„çŠ¶æ€ã€‚ä½œä¸ºå…¸å‹çš„ç±»ç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ„é€ å‡½æ•°ä¸­å¤„ç†è®¾ç½®:è®¾ç½®åˆå§‹çŠ¶æ€ï¼Œç„¶åä¸º`change`äº‹ä»¶ç»‘å®š`this`ã€‚

```
class StarRating extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      starsSelected: 0
    };
    this.change = this.change.bind(this);
  }

  change(starsSelected) {
    this.setState({ starsSelected });
  }

  render() {
    const { totalStars } = this.props;
    const { starsSelected } = this.state;
    return (
      <div className="star-rating">
        {[...Array(totalStars)].map((n, i) => (
          <Star
            key={i}
            selected={i < starsSelected}
            onClick={() => this.change(i + 1)}
          />
        ))}
        <p>
          {starsSelected} of {totalStars} stars
        </p>
      </div>
    );
  }
}

render(
  <StarRating totalStars={5} />,
  document.getElementById("react-container")
); 
```

æ‚¨ä¹Ÿå¯ä»¥åœ¨ CodeSandbox ä¸ŠæŸ¥çœ‹:

è¿™çœ‹èµ·æ¥å¾ˆä¸é”™ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨é’©å­æŠŠå®ƒåšå¾—æ›´å¥½ã€‚

## [](#refactoring-with-hooks)ç”¨é’©å­é‡æ„

å½“å¼€å§‹é‡æ„è¿™äº›ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬è€ƒè™‘äº†å‡ ä¸ªä¸»è¦æ­¥éª¤:

1.  å¼„æ¸…æ¥šå¦‚ä½•æ›´æ–°`Star`å‡½æ•°
2.  å°†ç±»ç»„ä»¶é‡æ„ä¸ºåŠŸèƒ½ç»„ä»¶
3.  åˆ›å»ºä¸€ä¸ªç”¨äºé€‰æ‹©æ˜Ÿçº§çš„æŒ‚é’©

### [](#1-figure-out-how-to-update-the-raw-star-endraw-function)1ã€‚å¼„æ¸…æ¥šå¦‚ä½•æ›´æ–°`Star`å‡½æ•°

è¿™ä¸€æ­¥å¾ˆå®¹æ˜“ã€‚ç”±äº`Star`å·²ç»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦æ”¹å˜å®ƒã€‚æ„Ÿè°¢ 2017 å¹´çš„ Alex å’Œ Eveã€‚

```
const Star = ({ selected = false, onClick = f => f }) => (
  <div className={selected ? "star selected" : "star"} onClick={onClick} /> ); 
```

### [](#2-refactor-class-component-as-a-function-component)2ã€‚å°†ç±»ç»„ä»¶é‡æ„ä¸ºåŠŸèƒ½ç»„ä»¶

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬é‡æ„ç±»ç»„ä»¶ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬ä»`ReactDOM.render`å¼€å§‹ã€‚æˆ‘ä»¬æƒ³è¦æ¸²æŸ“`StarRating`å¹¶ç»™å®ƒä¼ é€’ä¸€ä¸ªå±æ€§:`totalStars` :

```
render(<StarRating totalStars={5} />, document.getElementById("root")); 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é‡æ„ç»„ä»¶`StarRating`ï¼Œå°†å®ƒ`totalStars`ä½œä¸ºå±æ€§ä¼ é€’:

```
const StarRating = ({ totalStars }) => {
  return (
    <div className="star-rating">
      {[...Array(totalStars)].map((n, i) => (
        <Star
          key={i}
          selected={i < starsSelected}
          onClick={() => this.change(i + 1)}
        />
      ))}
      <p>
        {starsSelected} of {totalStars} stars
      </p>
    </div>
  );
}; 
```

æˆ‘ä»¬éœ€è¦æ›´æ–°`Star`çš„`onClick`å¤„ç†ç¨‹åºï¼Œå› ä¸º`StarRating`å‡½æ•°ä¸èƒ½è®¿é—®`this`ã€‚ç›¸åï¼Œæˆ‘ä»¬å°†ç”¨ä¸€ä¸ªé’©å­æ¥å¤„ç†è¿™ä¸ªé—®é¢˜:

### [](#3-create-a-hook-for-selecting-a-star-rating)3ã€‚åˆ›å»ºä¸€ä¸ªç”¨äºé€‰æ‹©æ˜Ÿçº§çš„æŒ‚é’©

é’©å­å…è®¸ä½ åœ¨ä¸å†™ç±»çš„æƒ…å†µä¸‹ä½¿ç”¨çŠ¶æ€ã€‚å½“`StarRating`æ˜¯ä¸€ä¸ªç±»æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨äº`starsSelected`çš„çŠ¶æ€å˜é‡å’Œä¸€ä¸ªåä¸º`change`çš„æ–¹æ³•æ¥è®¾ç½®`starsSelected`çš„çŠ¶æ€ã€‚æˆ‘ä»¬å°†åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„çŠ¶æ€å˜é‡:

```
import React, { useState } from "react";

const StarRating = ({ totalStars }) => {
  const [starsSelected] = useState(0);
  return <div className="star-rating">...</div>; }; 
```

æˆ‘ä»¬ä½¿ç”¨çš„é’©å­å«åš`useState`ï¼Œå®ƒå…è®¸æˆ‘ä»¬å‘å‡½æ•°ç»„ä»¶æ·»åŠ çŠ¶æ€ã€‚æˆ‘ä»¬å°†ä½¿ç”¨åŒä¸€ä¸ªåä¸º`starsSelected`çš„çŠ¶æ€å˜é‡ï¼Œå¹¶é€šè¿‡å°†å®ƒä¼ é€’ç»™`useState`å‡½æ•°å°†å…¶åˆå§‹å€¼è®¾ç½®ä¸º`0`ã€‚æ¢å¥è¯è¯´ï¼Œå½“ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œ`starsSelected`çš„åˆå§‹çŠ¶æ€å°†æ˜¯`0`ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•åœ¨ç»™å‡ºæ–°çš„è¯„çº§æ—¶æ”¹å˜`starsSelected`çš„å€¼ã€‚è¿™åœ¨ç±»ç»„ä»¶ä¸­æ›¾ç»è¢«ç§°ä¸º`change`ï¼Œä½†æ˜¯è®©æˆ‘ä»¬æŠŠå®ƒæè¿°å¾—æ›´æ¸…æ¥šä¸€ç‚¹ï¼Œç§°å®ƒä¸º`selectStar` :

```
const StarRating = ({ totalStars }) => {
  const [starsSelected, selectStar] = useState(0);
  return <div className="star-rating">...</div>; }; 
```

ç„¶åæˆ‘ä»¬å°†æ›¿æ¢`onClick`ä¸­çš„`change`å‡½æ•°ï¼Œä½¿ç”¨`selectStar`æ–¹æ³•:

```
const StarRating = ({ totalStars }) => {
  const [starsSelected, selectStar] = useState(0);
  return (
    <div className="star-rating">
      {[...Array(totalStars)].map((n, i) => (
        <Star
          key={i}
          selected={i < starsSelected}
          onClick={() => selectStar(i + 1)}
        />
      ))}
      <p>
        {starsSelected} of {totalStars} stars
      </p>
    </div>
  );
}; 
```

å¾ˆåœ†æ»‘ï¼Œå¯¹å§ï¼Ÿæˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦åšå¤ªå¤šçš„æ”¹å˜ã€‚åªéœ€å°†ç»„ä»¶å¿«é€Ÿé‡æ„ä¸ºä¸€ä¸ªå‡½æ•°å¹¶åˆ›å»ºä¸€ä¸ªé’©å­ã€‚ç”Ÿæˆçš„ç»„ä»¶ä»£ç æ›´å°‘ï¼Œå¯è¯»æ€§æ›´å¥½ã€‚

è¿™æ˜¯ CodeSandbox ä¸Šçš„[æ•´ä»¶äº‹ã€‚](https://codesandbox.io/embed/v0n20v6143)

å½“é’©å­åœ¨ ReactConf å‘å¸ƒæ—¶ï¼Œäººä»¬ç–¯ç‹‚åœ°å¼€å§‹å°½å¯èƒ½å¤šåœ°ä½¿ç”¨å®ƒä»¬ã€‚è¿™æ˜¯æœ‰é“ç†çš„ï¼Œå› ä¸ºä»–ä»¬å¾ˆé…·ã€‚ä¸è¿‡ä½ ä¸éœ€è¦ç€æ€¥ã€‚ä»é‡æ„ä¸€äº›å°ç»„ä»¶å¼€å§‹ï¼Œä¹Ÿè®¸æ˜¯ä½ éå¸¸ç†Ÿæ‚‰çš„ç»„ä»¶ã€‚åœ¨æˆ‘ä»¬çš„ä¹¦ä¸­å’Œæˆ‘ä»¬çš„ç ”è®¨ä¼šä¸Šï¼Œæˆ‘ä»¬å·²ç»æ— æ•°æ¬¡åœ°æåˆ°äº†è¿™ä¸€ç‚¹ã€‚çœ‹åˆ°è¿™ä½è€æœ‹å‹å¸¦ç€é’©å­æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´å¥½çœ‹ï¼Œä»¤äººå…´å¥‹ã€‚