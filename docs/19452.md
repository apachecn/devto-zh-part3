# ä½¿ç”¨ NativeScript æ„å»º Android ç”µè§†åº”ç”¨ç¨‹åº

> åŸæ–‡:[https://dev . to/progress/building-an-Android-TV-app-with-native script-4d bo](https://dev.to/progress/building-an-android-tv-app-with-nativescript-4dbo)

å¦‚æœä½ åœ¨è¿™é‡Œï¼Œæˆ‘çŒœ NativeScript æ˜¯ä½ çš„ç¬¬ä¸€é€‰æ‹©(æˆ–è€…å¾ˆå¿«ï¼)ä»ä¸€ä¸ªä»£ç åº“å¼€å‘åŸç”Ÿçš„è·¨å¹³å°åº”ç”¨ï¼Œé€‚ç”¨äº iOS å’Œ Androidã€‚æˆ‘æƒ³æ ‡é¢˜æ³„éœ²äº†ä¸€åˆ‡ï¼Œä½†æ˜¯ä½ çŸ¥é“ä½ ä¹Ÿå¯ä»¥ä¸º[å®‰å“ç”µè§†](https://www.android.com/tv/)å¼€å‘æœ¬åœ°è„šæœ¬åº”ç”¨å—ï¼Ÿ

[![nativescript and android tv](../Images/0fe70ae4a74c454c4d62f3181760a388.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Vn0q6EKK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/rdlauer/articles/master/nativescript/android-tv/nativescript-and-android-tv.png)

è™½ç„¶ Android TV è¿˜æ²¡æœ‰é£é¡å…¨çƒï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰æ­£å¼æ”¯æŒè¿™ç§é›†æˆï¼Œä½†å®ƒä»ç„¶æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç»ƒä¹ ï¼Œå¯ä»¥ä½œä¸ºä½ æ€æ‰‹çº§åº”ç”¨ç¨‹åºå¼€å‘æŠ€èƒ½çš„å¦ä¸€ä¸ªæ¸ é“ã€‚

**é‚£ä¹ˆä»€ä¹ˆæ˜¯å®‰å“ç”µè§†å‘¢ï¼Ÿ**å®‰å“ç”µè§†æ˜¯ä¸€ä¸ªæœºé¡¶ç›’(ç”±å®‰å“ç³»ç»Ÿé©±åŠ¨),å¯ä»¥è®©ä½ å°†å†…å®¹ä¼ è¾“åˆ°ç”µè§†ä¸ŠğŸ“ºã€‚åœ¨å¾ˆå¤šæ–¹é¢ï¼Œä½ å¯ä»¥å°†å…¶ä¸ Apple TV è¿›è¡Œæ¯”è¾ƒï¼Œæ²¡æœ‰è‹¹æœç”Ÿæ€ç³»ç»Ÿå›ºæœ‰çš„ç¡¬ä»¶é™åˆ¶ã€‚Android TV ä¸Šæœ€å¸¸è§çš„åº”ç”¨ç¨‹åºä¸“æ³¨äºåª’ä½“æ¶ˆè´¹å’Œæ¸¸æˆï¼Œä½†è¿™ä¸ªå¹³å°æ­£åœ¨ç­‰å¾…å…¶ä¸‹ä¸€ä¸ªæ€æ‰‹çº§åº”ç”¨ç¨‹åºã€‚

ä¹Ÿè®¸ç½‘ç»œç”µè§†çš„æ—¶æœºå·²ç»æˆç†Ÿäº†ï¼ï¼ŸğŸ˜‰

[![webtv](../Images/04956694a66bfc81e83038e629ed5c3f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zJgasFR2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/rdlauer/articles/master/nativescript/android-tv/webtv.png)

## [](#a-little-history)ä¸€ç‚¹å†å²

æœ‰ä¸€å¤©ï¼Œæˆ‘ä»¬æ”¶åˆ°äº†ä¸€æ¡æ¥è‡ªä¸€ä½ NativeScript åŠ©æ‰‹ç”¨æˆ·çš„æ¶ˆæ¯ï¼Œä»–æƒ³åˆ©ç”¨è‡ªå·±çš„ NativeScript æŠ€èƒ½å¼€å‘ä¸€æ¬¾ Android ç”µè§†åº”ç”¨ç¨‹åº:

[![android tv request via intercom](../Images/9539dc78b713c335673a50a84616d665.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--2PDT6LJV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/rdlauer/articles/master/nativescript/android-tv/intercom.png)

è¿™æœ‰ç‚¹ğŸ’¡å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œå½“æˆ‘ä»¬æ„è¯†åˆ°è¿™ä¸ªå¹³å°åº”è¯¥åœ¨ NativeScript æ€»éƒ¨æœ‰ä¸€ä¸ªéå®˜æ–¹çš„å®¶ã€‚è¿›å…¥æˆ‘ä»¬çš„è€æœ‹å‹â€œæ’ä»¶â€Eddy Verbruggenã€‚

Eddy å¾ˆå¿«å°±å®Œæˆäº†ä¸€ä¸ªæ¦‚å¿µéªŒè¯ï¼Œæœ‰æ•ˆåœ°å°† Android TV ä½œä¸º NativeScript åº”ç”¨ç¨‹åºçš„å¦ä¸€ä¸ªæ„å»ºç›®æ ‡ã€‚ç‚¹å‡»æ­¤å¤„è§‚çœ‹ç®€çŸ­è§†é¢‘ã€‚ã€‚

ä½ çŸ¥é“ä»–å¿…é¡»åšä»€ä¹ˆå—ï¼Ÿè¿™éå¸¸ç®€å•ã€‚ä¸ºäº†å®ç°ä¸ Android TV çš„åŸå§‹å…¼å®¹æ€§ï¼Œæ‚¨åªéœ€åœ¨æ‚¨çš„`AndroidManifest.xml`æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œ:

```
<category android:name="android.intent.category.LEANBACK_LAUNCHER" /> 
```

ä½†ä»…ä»…æ˜¯è®©ä¸€ä¸ªåº”ç”¨åœ¨ Android TV ä¸Šæ„å»ºå’Œè¿è¡Œæ˜¯ä¸€å›äº‹ã€‚æ‹¥æŠ±å¹³å°çš„ç‹¬ç‰¹åŠŸèƒ½æ€ä¹ˆæ ·ï¼Ÿ

> å‚è€ƒè¿™ä¸ª GitHub åº“è·å¾—ä¸€ä¸ªåŸºæœ¬çš„ï¼Œä½†æ˜¯åŠŸèƒ½é½å…¨çš„ï¼ŒåŸç”Ÿçš„ Android ç”µè§†åº”ç”¨ç¨‹åºçš„ä¾‹å­ã€‚

## D-Pad æ§ä»¶

ä¸å…è®¸ä½ ç”¨æ‰‹æŒ‡æ§åˆ¶ UI çš„ iOS æˆ– Android è®¾å¤‡ä¸åŒï¼Œä½¿ç”¨ Android TVï¼Œä½ å¯ä»¥ç”¨ä¸€ä¸ªå°é¥æ§å™¨(D-pad æˆ–[æ–¹å‘é”®](https://developer.android.com/training/tv/start/navigation.html))è¿›è¡Œå¯¼èˆªã€‚å› æ­¤ï¼Œæ‚¨ç¡®å®éœ€è¦å…·å¤‡ä»¥ä¸‹èƒ½åŠ›:

*   ä½¿ç”¨ D-pad æ§ä»¶å¯¼èˆªç”¨æˆ·ç•Œé¢ï¼Œä»¥åŠ
*   èƒ½å¤Ÿ*ä¸»åŠ¨çœ‹åˆ°*ä½ åœ¨ UI ä¸­çš„ä½ç½®ã€‚

[![android tv ui example](../Images/6e485616e1f78a14e5e3ec1bb3bb40ba.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--iajmlACW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/rdlauer/articles/master/nativescript/android-tv/android-tv-ui.png)

è¿™æ„å‘³ç€å¯¹æ‚¨çš„ NativeScript åº”ç”¨ç¨‹åºè¿›è¡Œä¸€äº›å°çš„ UI è°ƒæ•´ã€‚å¹¸è¿çš„æ˜¯ï¼Œæ‚¨æœ‰å‡ ä¸ªæœ‰æ•ˆçš„é€‰é¡¹:

### [](#selectors)é€‰æ‹©å™¨

ä½ å¯ä»¥ä½¿ç”¨ [Android é€‰æ‹©å™¨](https://developer.android.com/reference/java/nio/channels/Selector.html)ä¸ºä½ çš„ UI å…ƒç´ ä¸“é—¨è®¾ç½®è§†å›¾çŠ¶æ€:

```
 <?xml version="1.0" encoding="utf-8"?>
    <selector xmlns:android="http://schemas.android.com/apk/res/android">
      <item android:state_pressed="true" android:drawable="@drawable/bluebutton_focused"/> <!-- pressed -->
      <item android:state_focused="true" android:drawable="@drawable/bluebutton_focused"/> <!-- focused -->
      <item android:state_hovered="true" android:drawable="@drawable/bluebutton_focused"/> <!-- hovered -->
      <item android:drawable="@drawable/bluebutton"/> <!-- default -->
    </selector> 
```

è™½ç„¶è¿™ç¡®å®å·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†å®ƒå¹¶ä¸æ˜¯çœŸæ­£çš„æœ¬åœ°è„šæœ¬æ–¹å¼ã€‚ç„¶è€Œï¼Œå®ƒæ˜¯å¯è¡Œçš„ï¼Œè€Œä¸”ç»™é€‰æ‹©å™¨å¸ƒçº¿ä¹Ÿä¸å¤ªå›°éš¾:

```
 export function elementLoaded(args: observable.EventData): void {
      const view = <ViewBase>args.object;

      // use a resource that specifies a 'focused' state:
      view.android.setBackgroundResource(identifier);
    } 
```

### [](#keyevents)æŒ‰é”®äº‹ä»¶

å¯ä»¥è¯´ï¼Œå®ç°â€œèšç„¦â€çŠ¶æ€çš„æ›´åˆé€‚çš„æ–¹å¼æ˜¯ä½¿ç”¨ [Android æŒ‰é”®äº‹ä»¶](https://developer.android.com/reference/android/view/KeyEvent.html) :

```
 public dispatchKeyEvent(event: android.view.KeyEvent): boolean {
        // you can respond to specific keycodes by fi. registering a listener and invoking it when appropriate
        console.log("D-Pad center button pressed? " + (event.getKeyCode() === android.view.KeyEvent.KEYCODE_DPAD_CENTER));

        // let's highlight the element that currently has the focus
        const tnsButton = <ViewBase>this.getCurrentFocus()["jsview"];
        if (tnsButton && tnsButton !== this.highlightedElement) {
          tnsButton.addPseudoClass("focused");
          if (this.highlightedElement) {
            this.highlightedElement.deletePseudoClass("focused");
          }
          this.highlightedElement = tnsButton;
        }
        return super.dispatchKeyEvent(event);
      } 
```

...æ‚¨å¯ä»¥åœ¨æ‚¨çš„ UI ä¸­ä½¿ç”¨:

```
 export function elementLoaded(args: observable.EventData): void {
      const view = <ViewBase>args.object;

      // set a backreference so 'dispatchKeyEvent' in app.ts can swap CSS classes
      view.android["jsview"] = args.object;
    } 
```

...åœ¨ä½ çš„ CSS ä¸­ä»€ä¹ˆæ˜¯æœ‰æ•ˆçš„`focused`ä¼ªç±»:

```
 .nav button {
      background-color: #87cefa;
    }

    .nav button:focused {
      background-color: #65aafa;
    } 
```

> ä¸Šé¢çš„ä¾‹å­æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æœºä¼šæ¥[æ„å»ºä¸€ä¸ªæ–°çš„ NativeScript æ’ä»¶](https://docs.nativescript.org/plugins/building-plugins)ï¼Œæç¤ºæç¤º...

## [](#separate-ui-views)å•ç‹¬çš„ UI è§†å›¾

æœ‰äº† NativeScriptï¼Œæ‚¨æ€»æ˜¯èƒ½å¤Ÿé€šè¿‡å¹³å°æ‹¥æœ‰[ä¸ªç‹¬ç«‹çš„ UI è§†å›¾ã€‚é€šè¿‡ä¸€ä¸ªå·§å¦™çš„å°æŠ€å·§ï¼Œä½ è¿˜å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ Android ç”µè§†è§†å›¾:](https://developer.telerik.com/products/nativescript/platform-specific-development-nativescript/) 

```
 import * as utils from "tns-core-modules/utils/utils";

    if (utils.ad) {
      // Android: Load either the TV or phone UI
      const uiModeManager = utils.ad.getApplicationContext().getSystemService(android.content.Context.UI_MODE_SERVICE);
      if (uiModeManager.getCurrentModeType() === android.content.res.Configuration.UI_MODE_TYPE_TELEVISION) {
        console.log("Running on a TV");
        application.start({moduleName: "main-page-tv"});
      } else {
        console.log("Running on a Phone / Tablet");
        application.start({moduleName: "main-page"});
      }
    } else {
      // iOS
      application.start({moduleName: "main-page"});
    } 
```

> è®°ä½ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ª GitHub åº“ä¸­æ‰¾åˆ°ä¸€ä¸ªå…¨åŠŸèƒ½çš„ NativeScript Android TV åº”ç”¨ã€‚

## [](#wrapping-up)åŒ…è£…å®Œæ¯•

ç°åœ¨è½®åˆ°ä½ äº†ï¼å°è¯•ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ NativeScript åº”ç”¨ç¨‹åºå¹¶æ·»åŠ è¿™äº›å®šåˆ¶ã€‚å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Android TV ä»¿çœŸå™¨(ä½œä¸º Android SDK çš„ä¸€éƒ¨åˆ†æä¾›)è¿›è¡Œæµ‹è¯•ã€‚

æœ€åï¼Œè¯·åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„ä½“éªŒ(æˆ–[æäº¤é—®é¢˜](https://github.com/EddyVerbruggen/nativescript-android-tv/issues))ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»§ç»­ä¸º Android TV å¼€å‘äººå‘˜ä¼˜åŒ–è¿™ä¸€è§£å†³æ–¹æ¡ˆã€‚