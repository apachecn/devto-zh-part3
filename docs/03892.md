# ç§‘ç‰¹æ—çš„ç­çº§ä»£è¡¨å›¢

> åŸæ–‡:[https://dev.to/lankydandev/class-delegation-in-kotlin-4dpi](https://dev.to/lankydandev/class-delegation-in-kotlin-4dpi)

> åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œå§”æ‰˜æ¨¡å¼æ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å¯¹è±¡ç»„åˆå®ç°ä¸ç»§æ‰¿ç›¸åŒçš„ä»£ç é‡ç”¨ã€‚

æ˜¯çš„ï¼Œè¿™æ˜¯ä»ç»´åŸºç™¾ç§‘å¤åˆ¶ç²˜è´´çš„æ•™ç§‘ä¹¦ğŸ˜¬ã€‚æˆ‘å¼•ç”¨è¿™å¥è¯ä½œä¸ºå¼€åœºç™½ï¼Œå› ä¸ºå®ƒæ˜¯å¯¹[å§”æ‰˜æ¨¡å¼](https://en.wikipedia.org/wiki/Delegation_pattern)çš„ç®€æ˜æè¿°ã€‚å–œæ¬¢ç»„åˆèƒœè¿‡ç»§æ‰¿æ˜¯å‡ ä¹æ¯ä¸ªä½¿ç”¨é¢å‘å¯¹è±¡è¯­è¨€(å¦‚ Java å’Œ Kotlin)çš„å¼€å‘äººå‘˜éƒ½ä¼šæåˆ°çš„äº‹æƒ…ã€‚ä½¿ç”¨è¿™ç§æ¨¡å¼å¯ä»¥è®©ä½ åœ¨ç§˜å¯†ç¼–å†™å®ç°æ¥å£çš„ä»£ç çš„åŒæ—¶ï¼Œä¸è®¨åŒç»§æ‰¿çš„å¼€å‘äººå‘˜ä¿æŒè‰¯å¥½çš„å…³ç³»ã€‚

å¥½å§ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°ä½ æŠ½æ(ä¸æ˜¯çœŸçš„ğŸ™„).ä½ æƒ³çŸ¥é“ç§‘ç‰¹æ—åœ¨å“ªé‡Œå‘æŒ¥ä½œç”¨ğŸ¤”ã€‚

Kotlin é€šè¿‡æä¾›å…³é”®å­—`by`ä½¿éµå¾ªå§”æ‰˜æ¨¡å¼å˜å¾—æ›´åŠ å®¹æ˜“ã€‚åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªå…³é”®å­—å…è®¸ä½ å®ç°(**è€Œä¸æ˜¯**ä¸€ä¸ªç±»)ä¸€ä¸ªæ¥å£ï¼ŒåŒæ—¶å°†å®ƒçš„æ‰€æœ‰åŠŸèƒ½å§”æ‰˜ç»™`by`æŒ‡å®šçš„*å§”æ‰˜*ã€‚æ‰€æœ‰çš„æ¥å£å‡½æ•°éƒ½å°†å¾—åˆ°æ»¡è¶³ï¼Œè€Œä¸éœ€è¦æ‚¨è‡ªå·±åœ¨æ–°ç±»ä¸­æä¾›ä¸€ä¸ªå®ç°ã€‚ä¸€ç§æ€è€ƒæ–¹å¼æ˜¯ï¼Œ*å§”æ‰˜*åŸºæœ¬ä¸Šå˜æˆäº†ä¸€ä¸ªä¼ªæŠ½è±¡ç±»ã€‚

ç°åœ¨ï¼Œæ‚¨å¯ä»¥æŒ‘é€‰æƒ³è¦æä¾›è‡ªå·±çš„å®ç°çš„æ¥å£å‡½æ•°ã€‚ä»»ä½•ä½ æ²¡æœ‰æä¾›çš„éƒ½è¢«å§”æ‰˜ç»™*ä»£è¡¨*ã€‚è¿™å°±æ˜¯åŠ›é‡çš„æ¥æºã€‚

æˆ‘æƒ³æ˜¯æ—¶å€™ç»™ä½ ä¸¾ä¸ªä¾‹å­äº†ã€‚ä¸‹é¢æ˜¯ä¸€äº›åœ¨ [Corda](https://github.com/corda/corda) ä¸­ä½¿ç”¨çš„ä»£ç (å®Œå…¨ç”¨ Kotlin ç¼–å†™ï¼Œå®é™…ä¸Šåœ¨ [Kotlin ä¸»é¡µ](https://kotlinlang.org/)ä¸Šæœ‰æåŠ)ğŸ‘ğŸ‘).è¿™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°`by`è¢«ä½¿ç”¨:

```
class RestrictedEntityManager(private val delegate: EntityManager) : EntityManager by delegate {

  override fun close() {
    throw UnsupportedOperationException("This method cannot be called via ServiceHub.withEntityManager.")
  }

  override fun clear() {
    throw UnsupportedOperationException("This method cannot be called via ServiceHub.withEntityManager.")
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢çš„ç±»åšäº†æˆ‘åˆšæ‰è°ˆåˆ°çš„æ‰€æœ‰äº‹æƒ…ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹ã€‚`RestrictedEntityManager`æƒ³å®ç°`EntityManager`ã€‚ä¸ºæ­¤ï¼Œå®ƒä½¿ç”¨äº†ç”±`delegate`å±æ€§æä¾›çš„å®ç°ã€‚

æ³¨æ„ï¼Œ`by`å…³é”®å­—åœ¨è¿™é‡Œçš„ç”¨æ³•ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™è¡¨ç¤ºï¼Œ`EntityManager`æ˜¯å®ç°äº†`by`çš„`delegate`å±æ€§ã€‚

é¡¾åæ€ä¹‰ï¼Œ`RestrictedEntityManager`è¿™ä¸ªç±»æƒ³è¦é™åˆ¶`EntityManager`çš„ä¸€äº›åŠŸèƒ½ã€‚æä¾›å¹¶ä½¿ç”¨`close`å’Œ`clear`çš„è¦†ç›–ï¼Œè€Œä¸æ˜¯`delegate`æä¾›çš„ç‰ˆæœ¬ã€‚

è¿™ç»™ä½ ç•™ä¸‹äº†ä¸€ä¸ªæ–°çš„ç±»ï¼Œ`RestrictedEntityManager`ï¼Œå®ƒå®ç°äº†`EntityManager`æ¥å£ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°(å¦‚æœæˆ‘æ²¡æ•°é”™çš„è¯ï¼Œæœ‰ 51 ä¸ªå‡½æ•°ğŸ˜³ğŸ˜µ)è€Œè‡ªå·±åªå†™ 2ã€‚è¿™ä¸ä»…å…è®¸ä½ æ›´æ‡’æƒ°ï¼Œå®ƒå®é™…ä¸Šæ›´æ¸…æ™°ï¼Œå¹¶ä¸”åªä¾èµ–äºæ¥å£è€Œä¸æ˜¯å…·ä½“çš„ç±»ã€‚

åœ¨è¿™ä¸ªé—®é¢˜ä¸Šï¼Œæ¥è‡ªç§‘ç‰¹æ—åŒ»ç”Ÿçš„ä¸€æ¡ä¿¡æ¯ç›¸å½“é‡è¦ã€‚

> ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œä»¥è¿™ç§æ–¹å¼é‡å†™çš„æˆå‘˜ä¸ä¼šä»å§”æ‰˜å¯¹è±¡çš„æˆå‘˜ä¸­è°ƒç”¨ï¼Œå§”æ‰˜å¯¹è±¡åªèƒ½è®¿é—®å…¶è‡ªå·±çš„æ¥å£æˆå‘˜å®ç°

æˆ‘å‰é¢è¯´è¿‡*å§”æ‰˜*å°±åƒä¸€ä¸ªæŠ½è±¡ç±»ã€‚ä¸Šé¢çš„é™ˆè¿°ç¨å¾®å¦å®šäº†è¿™ä¸€ç‚¹ï¼Œå› ä¸ºä½ æä¾›çš„å®ç°æ ¹æœ¬ä¸ä¼šè¢«*å§”æ‰˜*ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»ç„¶è®¤ä¸ºè¿™ç§æ¯”è¾ƒæ˜¯ä¸€ç§å¾ˆå¥½çš„æ€è€ƒæ–¹å¼ï¼Œä½ åªéœ€è¦è®°ä½è¿™ä¸ªäº‹å®ï¼Œä»¥é˜²æ­¢å°†æ¥å‡ºç°é”™è¯¯ã€‚

åœ¨æˆ‘ç»“æŸè¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘æƒ³æ¯”è¾ƒä¸€ä¸‹ä¸Šé¢çš„ä»£ç å’Œ Java ç‰ˆæœ¬ã€‚è¿™å°†è®©ä½ çœ‹åˆ° Kotlin å¦‚ä½•ä¸ºä½ æä¾›å·¥å…·æ¥æ”¹è¿›ä½ çš„ä»£ç :

```
public class RestrictedEntityManager implements EntityManager {

  private EntityManager delegate;

  public RestrictedEntityManager(EntityManager delegate) {
    this.delegate = delegate;
  }

  @Override
  public void close() {
    throw new UnsupportedOperationException("This method cannot be called via ServiceHub.withEntityManager.");
  }

  @Override
  public void clear() {
    throw new UnsupportedOperationException("This method cannot be called via ServiceHub.withEntityManager.");
  }

  @Override
  public void persist(Object entity) {
    delegate.persist(entity);
  }

  @Override
  public <T> T merge(T entity) {
    return delegate.merge(entity);
  }

  // and another 47 functions/methods ğŸ˜°ğŸ˜°ğŸ˜±
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åä¸€è¡Œä»£ç æ³¨é‡Šè¶³ä»¥è®©æ‚¨ç›¸ä¿¡ Kotlin è§£å†³æ–¹æ¡ˆçš„ä¼˜é›…ã€‚ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œæ‰€æœ‰ç¼ºå°‘çš„æ–¹æ³•åªæ˜¯å§”æ‰˜ç»™äº†`delegate`å±æ€§ã€‚å¦‚æœæ‚¨ç¡®å®å¯¹ä¸€äº›å‡½æ•°è¿›è¡Œäº†æ›´æ”¹ï¼Œå¹¶ä¸”æ²¡æœ‰å¾ˆå¥½åœ°æ’åºï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°å¾ˆéš¾æ³¨æ„åˆ°æ‚¨åšäº†ä»€ä¹ˆã€‚å¦ä¸€æ–¹é¢ï¼ŒKotlin ç‰ˆæœ¬åªåŒ…å«è¢«ä¿®æ”¹çš„å‡½æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹å§”æ‰˜å…¶ä»–å‡½æ•°ã€‚

æœ€åï¼Œè¿™ç¯‡çŸ­æ–‡ä»‹ç»äº† Kotlin æä¾›çš„å…³é”®å­—`by`,ä»¥åŠå®ƒå¦‚ä½•å¸®åŠ©æ‚¨åˆ©ç”¨å§”æ‰˜æ¨¡å¼ã€‚å¸®åŠ©æ‚¨åœ¨æˆä¸ºè¶…çº§å¼€å‘äººå‘˜çš„é“è·¯ä¸Šæ›´è¿›ä¸€æ­¥ã€‚æ”¾ä¸‹é‚£ä¸ªçˆªå“‡â˜•ğŸ¤®ä½ ç´§ç´§æŠ“ä½çš„ä¸œè¥¿ï¼Œç”¨åŒæ‰‹æŠ“ä½ç§‘ç‰¹æ—ğŸ‘ŒğŸ‘ğŸ‘ã€‚

åªæ˜¯ä¸ºäº†ä¿æŠ¤æˆ‘è‡ªå·±ã€‚æˆ‘ä¸åå¯¹ Javaã€‚è¯·ä¸è¦æ¥æ€æˆ‘ï¼ğŸ˜¨ğŸ˜¨

å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¾ˆæœ‰å¸®åŠ©ï¼Œä½ å¯ä»¥åœ¨ Twitter ä¸Šå…³æ³¨æˆ‘ï¼Œåœ°å€æ˜¯ [@LankyDanDev](https://twitter.com/LankyDanDev) æ¥äº†è§£æˆ‘çš„æ–°æ–‡ç« ã€‚