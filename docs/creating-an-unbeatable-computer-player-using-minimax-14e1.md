# ä½¿ç”¨ Minimax åˆ›å»ºä¸€ä¸ªæ— ä¸ä¼¦æ¯”çš„è®¡ç®—æœºæ’­æ”¾å™¨

> åŸæ–‡ï¼š<https://dev.to/ellehallal/creating-an-unbeatable-computer-player-using-minimax-14e1>

<center>

### æœ€åˆå‘å¸ƒäº [ellehallal.dev](https://ellehallal.dev) ğŸ‘©ğŸ½â€ğŸ’»

</center>

* * *

æœ¬å‘¨ï¼Œæˆ‘ä¸€ç›´è‡´åŠ›äºä¸ºæˆ‘çš„ [Ruby Tic Tac Toe æ¸¸æˆ](https://github.com/ellehallal/ruby-tic-tac-toe)æ·»åŠ ä¸€ä¸ªæ— ä¸ä¼¦æ¯”çš„ç”µè„‘(UC)æ’­æ”¾å™¨ã€‚

åœ¨è¿™ä¸ªåšå®¢ä¸­ï¼Œæˆ‘å°†åˆ†äº«æˆ‘å¯¹é€’å½’å’Œæå°æå¤§çš„ç†è§£ï¼Œä»¥åŠæˆ‘ç¬¬ä¸€æ¬¡å°è¯•ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªæ— ä¸ä¼¦æ¯”çš„è®¡ç®—æœºæ’­æ”¾å™¨ã€‚ä¸ºäº†å®ç° UC æ’­æ”¾å™¨ï¼Œæˆ‘éœ€è¦å®ç° MiniMax ç®—æ³•ï¼Œè¿™ä¹Ÿæ„å‘³ç€æˆ‘éœ€è¦ä½¿ç”¨é€’å½’ã€‚

* * *

## ç”µè„‘ç©å®¶

### å¯æ‰“è´¥çš„ç”µè„‘ç©å®¶

åœ¨åŠªåŠ›ä½¿å®ƒå˜å¾—ä¸å¯æˆ˜èƒœä¹‹å‰ï¼Œç”µè„‘ç©å®¶é€‰æ‹©äº†ä¸€ä¸ªæ²¡æœ‰ç­–ç•¥çš„ç§»åŠ¨ã€‚å®ƒåªæ˜¯åœ¨äº•å­—æ¸¸æˆæ£‹ç›˜ä¸Šéšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ç©ºé—´ã€‚

### æ— æ•Œçš„è®¡ç®—æœº(UC)ç©å®¶

UC ç©å®¶åº”è¯¥çŸ¥é“æ£‹ç›˜ä¸Šå¯ç”¨çš„æ–¹æ ¼ï¼Œè¯„ä¼°æ‰€æœ‰å¯èƒ½çš„ç»“æœï¼Œå¹¶å› æ­¤é€‰æ‹©æœ€ä½³ç§»åŠ¨ã€‚

ä»€ä¹ˆè¢«è®¤ä¸ºæ˜¯æœ€å¥½çš„è¡ŒåŠ¨ï¼Ÿ

UC ç©å®¶çš„ç›®æ ‡æ˜¯èµ¢ã€‚å¦‚æœè¿™æ˜¯ä¸å¯èƒ½çš„ï¼ŒUC çš„ä¸‹ä¸€ä¸ªæœ€å¥½çš„ç»“æœæ˜¯æ¯”èµ›æˆä¸ºå¹³å±€ã€‚å¯¹æ‰‹èµ¢å¾—æ¯”èµ›ä¸æ˜¯ä¸€ä¸ªé€‰é¡¹ã€‚åº”è¯¥é€‰æ‹©ä¸€ä¸ªç§»åŠ¨æ¥é˜»æ­¢å¯¹æ‰‹è·èƒœï¼Œéšåå¯¼è‡´ UC ç©å®¶è·èƒœæˆ–å¹³å±€ã€‚

* * *

## é€’å½’å‡½æ•°å’Œæå¤§æå°

### ä»€ä¹ˆæ˜¯é€’å½’å‡½æ•°ï¼Ÿ

æˆ‘å¯¹é€’å½’å‡½æ•°çš„ç†è§£æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨è‡ªå·±ï¼Œç›´åˆ°æ»¡è¶³æŸä¸ªæ¡ä»¶ã€‚å®ƒç”±ä¸€ä¸ªåŸºç¡€æ¡ˆä¾‹å’Œä¸€ä¸ªé€’å½’æ¡ˆä¾‹ç»„æˆã€‚

*   åŸºæœ¬æƒ…å†µ:å½“è¢«è§¦å‘æ—¶ï¼Œè¿™å°†åœæ­¢é€’å½’å‡½æ•°ã€‚

*   é€’å½’æƒ…å†µ:é€’å½’å‡½æ•°å†æ¬¡è°ƒç”¨è‡ªèº«ï¼Œä¸ä¹‹å‰çš„å‡½æ•°è°ƒç”¨ç•¥æœ‰ä¸åŒã€‚å½“åŸºæœ¬æƒ…å†µæ²¡æœ‰è¢«è§¦å‘æ—¶ï¼Œé€’å½’æƒ…å†µå‘ç”Ÿã€‚

### ä»€ä¹ˆæ˜¯æå¤§æå°ç®—æ³•ï¼Ÿ

æˆ‘çš„ç†è§£æ˜¯:

*   è¿™æ˜¯ä¸€ç§ä½¿ç”¨é€’å½’çš„ç®—æ³•

*   ç›®æ ‡æ˜¯æœ€å¤§åŒ–æ´»è·ƒç©å®¶çš„ç»“æœï¼Œç›¸åæœ€å°åŒ–å…¶ä»–ç©å®¶çš„ç»“æœ

*   å®ƒç”¨äºåœ¨æ¸¸æˆä¸­è·å¾—ç©å®¶çš„æœ€ä½³ç§»åŠ¨

*   å®ƒä½¿ç”¨å½“å‰ç©å®¶å’Œå¯¹æ‰‹çš„æ ‡è®°æ¥æ˜¾ç¤ºæ‰€æœ‰å¯èƒ½çš„ç»“æœ

*   æ¸¸æˆçš„æ¯ä¸ªç»“æœéƒ½æœ‰ä¸€ä¸ªåˆ†æ•°ï¼Œå–å†³äºå½“å‰ç©å®¶èµ¢äº†ï¼Œå¯¹æ‰‹èµ¢äº†ï¼Œè¿˜æ˜¯æ¸¸æˆå¹³å±€ã€‚

*   é€‰æ‹©çš„ç§»åŠ¨åº”è¯¥æœ€å°åŒ–å¯¹æ‰‹èƒ½å¾—åˆ°çš„åˆ†æ•°ã€‚

**åœ¨äº•å­—æ¸¸æˆä¸­:**

*   æœ€å¤§åŒ–ç©å®¶æ˜¯ UC ç©å®¶ï¼Œæœ€å°åŒ–ç©å®¶æ˜¯å¯¹æ‰‹ã€‚

*   å½“ä»»ä¸€ç©å®¶æœ‰ä¸€æ¡èµ¢çº¿æˆ–æ£‹ç›˜å·²æ»¡(å¹³å±€)æ—¶ï¼Œè§¦å‘åŸºæœ¬æƒ…å†µã€‚

*   å¦‚æœåŸºæœ¬æƒ…å†µæ²¡æœ‰è¢«è§¦å‘ï¼Œé€’å½’å‡½æ•°å°†ç»§ç»­ï¼ŒUC ç©å®¶çš„æ ‡è®°å’Œå¯¹æ‰‹çš„æ ‡è®°å°†ç»§ç»­è¢«æ·»åŠ åˆ°æ£‹ç›˜ä¸Šçš„å¯ç”¨æ–¹æ ¼ä¸­

*   å½“ä¸€ä¸ªæ ‡è®°è¢«æ·»åŠ åˆ°æ¿ä¸Šæ—¶ï¼Œè¿™æ„å‘³ç€é€’å½’å‡½æ•°è¢«å†æ¬¡è°ƒç”¨ã€‚

*   å½“ä¸€ä¸ªç©å®¶èµ¢äº†ï¼Œæˆ–è€…æ¸¸æˆæ˜¯å¹³å±€æ—¶ï¼Œå¼€å§‹ç©çš„æ–¹å—è¢«ç»™äºˆä¸€ä¸ªåˆ†æ•°ã€‚

*   UC ç©å®¶é€‰æ‹©å¯¹æ‰‹å¾—åˆ†æœ€å°çš„æœ€ä½³ç§»åŠ¨ã€‚

* * *

## ä¸€ä¸ªç»“æœæ˜¯å¦‚ä½•å¾—åˆ†çš„ï¼Ÿ

å¦‚æœæ¯”èµ›æ˜¯å¹³å±€ï¼Œç»“æœå¾—åˆ†ä¸º 0ã€‚è·èƒœçš„ç©å®¶æœ€å¤šå¯ä»¥è·å¾— 10 åˆ†(å¦‚æœæ˜¯å¯¹æ‰‹ï¼Œåˆ™ä¸º-10 åˆ†)ã€‚

å¦‚ä¸Šæ‰€è¿°ï¼Œå½“ä¸€ä¸ªæ ‡è®°è¢«æ·»åŠ åˆ°æ¿ä¸Šæ—¶ï¼Œé€’å½’å‡½æ•°è¢«å†æ¬¡è°ƒç”¨ã€‚æˆ‘çš„ç†è§£æ˜¯é€šè¿‡è·Ÿè¸ªæ·±åº¦(é€’å½’å‡½æ•°è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡)ï¼Œè¿™æœ‰åŠ©äºè¯„ä¼°æ¸¸æˆçš„ç»“æœã€‚ç›®æ ‡æ˜¯ä»¥æœ€å°‘çš„åŠ¨ä½œå–èƒœã€‚å› æ­¤ï¼Œä¸€æ­¥æ£‹èµ¢çš„åˆ†æ•°åº”è¯¥æ¯”ä¸‰æ­¥æ£‹èµ¢çš„åˆ†æ•°é«˜

éšç€ä¸€ä¸ªæ ‡è®°è¢«æ·»åŠ åˆ°æ£‹ç›˜ä¸Š(å¦ä¸€ä¸ªé€’å½’å‡½æ•°è°ƒç”¨ï¼Œæ·±åº¦å¢åŠ  1)ï¼Œè¯¥æ·±åº¦ä»ç©å®¶çš„æœ€é«˜åˆ†æ•°ä¸­å‡å»ã€‚

ä¾‹å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªåœºæ™¯:

*   UC ç©å®¶æ­£åœ¨å¯»æ‰¾æœ€ä½³ç§»åŠ¨ï¼Œå¹¶å°è¯•ä½ç½® 3

*   åœ¨é€’å½’å‡½æ•°è¢«è°ƒç”¨ 3 æ¬¡(`depth = 3`)åï¼ŒUC è·å¾—äº†ä¸€æ¡ä¼˜èƒœçº¿

```
 maximum_score = 10
  depth = 3
  score = maximum_score - depth
  #score = 7 
```

Enter fullscreen mode Exit fullscreen mode

* * *

## UC æ’­æ”¾å™¨ä½¿ç”¨ Minimax çš„å¯è§†åŒ–ä¾‹å­

åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªåœºæ™¯ï¼Œå…¶ä¸­ UC æ’­æ”¾å™¨æœ‰ä¸‰ä¸ªå¯ç”¨çš„æ–¹å—å¯ä»¥é€‰æ‹©(3ã€4 å’Œ 9)ã€‚å®ƒå±•ç¤ºäº†æ‰€æœ‰å¯èƒ½çš„ç»“æœã€‚

UC ç©å®¶(x)æ˜¯æœ€å¤§åŒ–ç©å®¶ï¼Œå¯¹æ‰‹(o)æ˜¯æœ€å°åŒ–ç©å®¶ã€‚æˆ‘å°†åœ¨ä¸‹é¢æ›´è¯¦ç»†åœ°è§£é‡Šæ‰€æœ‰å¯èƒ½çš„ç»“æœã€‚

[![](img/4617451a969cf3169ddef9c9b980c69a.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--7QYdot-u--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/LL3kSXe.png)

### UC æ’­æ”¾ä½ç½® 3

[![](img/ea8cd970e95c83dac7b9b0c076b65e72.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--BqaL1u3D--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/ddpfdSw.png)

ä¸Šå›¾å±•ç¤ºäº†ä»¥ä¸‹å†…å®¹:

1.  UC æ’­æ”¾ä½ç½® 3(æ·±åº¦ 1)

2.  å¯¹æ‰‹æ‰“ä½ç½® 4(æ·±åº¦ 2)

3.  UC æ‰“ä½ç½® 9(æ·±åº¦ 3)

åœ¨æ€»å…±ç©äº† 3 ä¸ªä½ç½®ä¹‹åï¼Œç»“æœæ˜¯ UC çš„**è·èƒœçº¿**ã€‚

UC èµ¢äº†ï¼Œæ‰€ä»¥**æœ€é«˜åˆ†æ˜¯ 7** ã€‚è®°ä½ UC èƒ½å¾—åˆ°çš„æœ€å¤§ç‚¹æ•°æ˜¯ 10ï¼Œæ·±åº¦æ˜¯ä»ä¸­å‡å»çš„ã€‚

åœ¨å›¾åƒçš„å³ä¾§:

1.  UC æ’­æ”¾ä½ç½® 3(æ·±åº¦ 1)

2.  å¯¹æ‰‹æ‰“ä½ç½® 9(æ·±åº¦ 2)

3.  UC æ‰“ä½ç½® 4(æ·±åº¦ 3)

ç»“æœæ˜¯å¹³å±€ï¼ŒUC å’Œå¯¹æ‰‹éƒ½æ²¡æœ‰è·èƒœçº¿ã€‚**æœ€ä½åˆ†æ•°ä¸º 0** ã€‚

æ€»ä¹‹ï¼Œå¯¹äºä½ç½® 3:

*   **æœ€é«˜åˆ†= 7(10â€“3)**

*   **æœ€ä½åˆ†= 0(å¹³æ‰‹)**

### UC æ’­æ”¾ä½ç½® 4

[![](img/a10df9508bf826c41c306d69161158dc.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--zJYSKpGv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/thNxHjJ.png)

åœ¨ä¸Šå›¾ä¸­ï¼ŒUC æ‰“ 4 å·ä½ã€‚è¿™æ ·åšçš„æ—¶å€™ï¼Œä¸¤ç§ç»“æœéƒ½æ˜¯ UC ä¸èµ¢ï¼Œå¯¹æ‰‹èµ¢ä¸€ä¸ªã€‚

æ€»ä¹‹ï¼Œå¯¹äºä½ç½® 4:

*   **æœ€é«˜åˆ†= 0(å¹³æ‰‹)**

*   **æœ€ä½åˆ†æ•°=-8(-(10â€“2))**

### UC æ’­æ”¾ä½ç½® 9

[![](img/0fce90937440a139ebb6765e8236dd67.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--9Axoh9xy--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/sUm9qwQ.png)

**æœ€é«˜åˆ†æ˜¯ 7** ï¼Œå› ä¸º UC å¯ä»¥åœ¨æ·±åº¦ 3 çš„ä¸€ä¸ªç»“æœä¸­è·èƒœã€‚

ç„¶è€Œï¼Œ**çš„æœ€ä½åˆ†æ•°æ˜¯-8** ï¼Œå› ä¸ºå¯¹æ‰‹åœ¨æ·±åº¦ 2 çš„å¦ä¸€ä¸ªç»“æœä¸­è·èƒœã€‚

è™½ç„¶ UC å¯ä»¥é€šè¿‡é€‰æ‹©ä½ç½® 9 è·èƒœï¼Œä½†å¯¹æ‰‹å¯ä»¥åœ¨ä¸‹ä¸€æ­¥æ£‹ä¸­è·èƒœã€‚

æ€»ä¹‹ï¼Œå¯¹äºä½ç½® 9:

*   **æœ€é«˜åˆ†= 7(10â€“3)**

*   **æœ€ä½åˆ†æ•°=-8(-(10â€“2))**

* * *

## åˆ©ç”¨åˆ†æ•°æ¥é€‰æ‹©æœ€ä½³æ£‹æ­¥

æˆ‘çš„ç†è§£æ˜¯ UC ç©å®¶çš„ç›®æ ‡æ˜¯ç¡®ä¿å¯¹æ‰‹è·å¾—å°½å¯èƒ½å°‘çš„åˆ†æ•°ã€‚å¯¹æ‰‹çš„ç§¯åˆ†è¶Šé«˜ï¼Œå…¶è·èƒœçš„å‡ ç‡å°±è¶Šé«˜ã€‚

å› æ­¤ï¼Œ**æœ€å¥½çš„æ£‹æ˜¯æ–¹å— 3ğŸ‰**å¯¹æ‰‹æœ€é«˜åˆ†ä¸º 0(æœ€å°åŒ–ç©å®¶)ã€‚è¿™ä¸ªä½ç½®ä¼šå¯¼è‡´ UC ç©å®¶è·èƒœæˆ–å¹³å±€ã€‚å¯¹æ‰‹æ²¡æœ‰è·èƒœçš„æœºä¼šã€‚

* * *

## ä½¿ä¸€ä¸ªå¯å‡»è´¥çš„ç”µè„‘ç©å®¶å˜å¾—ä¸å¯æˆ˜èƒœ

ç†è®ºä¸Šï¼Œä»¥ä¸Šå¬èµ·æ¥å¾ˆæ£’ï¼Œä½†æ˜¯å¦‚ä½•å®ç°å®ƒæ¥åˆ›é€ ä¸€ä¸ªæ— ä¸ä¼¦æ¯”çš„è®¡ç®—æœºæ’­æ”¾å™¨å‘¢ï¼Ÿè€å®è¯´ï¼Œæˆ‘å‘ç°å°†ä¸Šè¿°å†…å®¹ç¿»è¯‘æˆä»£ç æå…¶å›°éš¾ã€‚

æœ‰è®¸å¤šä¾‹å­ã€åšå®¢å’Œè§†é¢‘å±•ç¤ºäº†ä½¿ç”¨ minimax åˆ›å»ºæ— ä¸ä¼¦æ¯”çš„è®¡ç®—æœºæ’­æ”¾å™¨çš„è®¸å¤šæ–¹æ³•ã€‚ä½ å¯ä»¥åœ¨è¿™ç¯‡åšæ–‡çš„åº•éƒ¨æ‰¾åˆ°æˆ‘è®¤ä¸ºæœ‰ç”¨çš„èµ„æºã€‚åœ¨è¿™ä¸ªè§£é‡Šä¸­ï¼Œæˆ‘å°†å°è¯•è§£é‡Šå‡½æ•°çš„æ¯ä¸ªéƒ¨åˆ†ã€‚

åœ¨æˆ‘å¼€å§‹ä¹‹å‰ï¼Œ[è¿™æ˜¯æˆ‘åˆ›å»ºçš„æå°æå¤§ç±»](https://gist.github.com/ellehallal/8f8388306502f6a0d314a20f88422eec)ã€‚å®ƒåŒ…å«äº†`find_best_move`é€’å½’å‡½æ•°ï¼Œæ— æ•Œç©å®¶ä¼šç”¨åˆ°ã€‚

### é€‰æ‹© _ ç§»åŠ¨çš„åŸå› 

ä¸ºäº†ç¡®ä¿æ¸¸æˆä¸­ä½¿ç”¨çš„æ£‹ç›˜å¯¹è±¡çš„å®ä¾‹ä¸è¢«ä¿®æ”¹ï¼Œä½¿ç”¨`copy_board`æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ£‹ç›˜å®ä¾‹ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æ¿çº§ã€‚

### find _ best _ move çš„ç›®çš„å‚æ•°

```
def find_best_move(board, depth=0, current_player, opponent) 
```

Enter fullscreen mode Exit fullscreen mode

`board`æ˜¯ä¸ºäº†:

*   è·å¾—æ‰€æœ‰çš„æ–¹å—ï¼ŒåŒ…æ‹¬æ£‹ç›˜ä¸Šä¸å¯ç”¨çš„(å·²ç”¨çš„)å’Œå¯ç”¨çš„æ–¹å—

*   æ£€æŸ¥ç©å®¶åœ¨æ£‹ç›˜ä¸Šæ˜¯å¦æœ‰èµ¢çº¿ï¼Œæˆ–è€…æ£‹ç›˜æ˜¯å¦å·²æ»¡(å¹³å±€)

*   é‡ç½®æ–¹å—è¢«ä¿®æ”¹ï¼Œå¸¦æœ‰ç©å®¶çš„æ ‡è®°

`depth`:

*   è·Ÿè¸ªé€’å½’å‡½æ•°è¢«è°ƒç”¨çš„æ¬¡æ•°

`current_player`:

*   è½®åˆ°èµ°ä¸€æ­¥æ£‹çš„ç©å®¶çš„æ ‡è®°

`opponent`:

*   å½“å‰ç©å®¶çš„å¯¹æ‰‹

### æœ€ä½³ _ åˆ†æ•°å’Œå¯ç”¨ _ æ–¹å—

```
best_score = {}
available_squares = board.available_squares 
```

Enter fullscreen mode Exit fullscreen mode

`best_score`:

*   è·Ÿè¸ªèŒä½çš„å¾—åˆ†
*   å½“è¯„ä¼°å®Œæ‰€æœ‰å¯ç”¨æ–¹å—åï¼Œbest_score å°†åŒ…å«åˆ†æ•°ï¼Œå¯ç”¨æ–¹å—ä½œä¸ºå…³é”®å­—ã€‚ä¾‹å¦‚:`{3=>-8, 9=>0}`

`available_squares`:

*   ä»¥æ•°ç»„å½¢å¼åŒ…å«å½“å‰æ£‹ç›˜ä¸Šçš„å¯ç”¨æ–¹æ ¼

### æŸ¥æ‰¾ _ æœ€ä½³ _ ç§»åŠ¨çš„åŸºæœ¬æƒ…å†µ

å¦‚å‰æ‰€è¿°ï¼Œåœ¨é€’å½’å‡½æ•°ä¸­ï¼Œåº”è¯¥æœ‰ä¸€ä¸ªåŸºæœ¬ç”¨ä¾‹ï¼Œå¦‚æœè¢«è§¦å‘ï¼Œå®ƒå°†åœæ­¢å‡½æ•°ã€‚å°±æ˜¯è¿™é‡Œ:

```
return score_move(board, depth, current_player, opponent) if
  board.stop_playing?(current_player, opponent) 
```

Enter fullscreen mode Exit fullscreen mode

å¦‚æœæ¯”èµ›æ˜¯å¹³å±€ï¼Œæˆ–è€…ä»»ä½•ä¸€æ–¹èµ¢äº†ï¼Œæ¯”èµ›å°±ç»“æŸäº†ã€‚å› æ­¤ï¼Œé€’å½’åº”è¯¥åœæ­¢ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œåˆ™è¿”å› trueã€‚

ç©åˆå§‹æ–¹å—çš„ç»“æœåº”è¯¥è¢«è®¡åˆ†å¹¶è¿”å›ï¼Œæ·»åŠ åˆ°`best_score`æ•£åˆ—ä¸­ã€‚

ä¸€ä¸ªç‹¬ç«‹çš„æ–¹æ³•`score_move`æ ¹æ®ç»“æœè¿”å›åˆ†æ•°ã€‚

```
def score_move(board, depth, current_player, opponent)
  if board.winning_line?(current_player)
    10 - depth
  elsif board.winning_line?(opponent)
    depth - 10
  elsif board.complete?
    0
  end
end 
```

Enter fullscreen mode Exit fullscreen mode

### é€’å½’æƒ…å†µ:éå†å¯ç”¨æ–¹å—

*   éå†æ£‹ç›˜ä¸Šå¯ç”¨çš„æ–¹æ ¼

*   åœ¨é€‰ä¸­çš„æ–¹æ ¼ä¸­æ‰“å‡º`current_player`çš„æ ‡è®°

*   åœ¨`best_score` hash ä¸­ï¼Œå°† key è®¾ç½®ä¸º squareï¼Œå°† value è®¾ç½®ä¸º outcome scoreã€‚

*   è¿™æ˜¯å†æ¬¡è°ƒç”¨é€’å½’å‡½æ•°çš„åœ°æ–¹ï¼Œç•¥æœ‰ä¸åŒã€‚`board`ç°åœ¨åœ¨å…ˆå‰å¯ç”¨çš„ç©ºé—´ä¸­æœ‰äº†æ ‡è®°ï¼Œ`depth`å¢åŠ äº† 1ã€‚`current_player`å’Œ`opponent`å¼€å…³ã€‚

*   ä»å¯ç”¨æ–¹å—ä¸­ç§»é™¤æ ‡è®°

**é€’å½’å‡½æ•°çš„è¿”å›å€¼ä¸ºä»€ä¹ˆè¦ä¹˜ä»¥-1ï¼Ÿ**ğŸ¤·ğŸ½â€â™€ï¸

è¿™æ˜¯æˆ‘è¿˜æ²¡æœ‰é¢†ä¼šçš„ä¸œè¥¿ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€æ®µå¼•ç”¨è‡ª[åšå®¢æ–‡ç« ](http://www.shei.io/recursion-minimax-algorithm/)çš„è¯ï¼Œè§£é‡Šäº†åŸå› :

> â€œå°†è¿”å›å€¼ä¹˜ä»¥-1 å°†ç¡®ä¿æ ¹æ®æœ€åç§»åŠ¨çš„äººå¾—åˆ°[æ­£æˆ–è´Ÿçš„åˆ†æ•°]ã€‚å¦‚æœåœ¨ä»»ä½•å¥‡æ•°æ­¥(1ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ9)èµ¢å¾—æ¸¸æˆï¼Œç»“æœå°†æ˜¯[æ­£]ï¼Œè¿™æ„å‘³ç€å½“å‰ç©å®¶èµ¢å¾—äº†æ¸¸æˆã€‚å¦‚æœåœ¨ä»»ä½•å¶æ•°æ­¥(2ï¼Œ4ï¼Œ6ï¼Œ8)ä¸­èµ¢å¾—æ¯”èµ›ï¼Œåˆ†æ•°å°†ä¸º[è´Ÿ]ï¼Œè¿™æ„å‘³ç€å¯¹æ‰‹å°†èµ¢å¾—æ¯”èµ›ã€‚â€

### é€’å½’æ¡ˆä¾‹:è¯„ä¼°ç§»åŠ¨

```
evaluate_move(depth, best_score) 
```

Enter fullscreen mode Exit fullscreen mode

`find_best_move`å‡½æ•°çš„æœ€åä¸€éƒ¨åˆ†æ˜¯è¯„ä¼°ç§»åŠ¨ã€‚æˆ‘çš„ç†è§£æ˜¯å¦‚æœæ·±åº¦ä¸ä¸ºé›¶ï¼Œæ„å‘³ç€é€’å½’å‡½æ•°æ²¡æœ‰è¿”å›åˆ°ç¬¬ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œé‚£ä¹ˆå°±è¿”å›åˆ†æ•°ã€‚

å¦‚æœæ·±åº¦ä¸ºé›¶ï¼Œæœ€å¥½çš„èµ°æ³•æ˜¯ä½œä¸º UC çš„ç©å®¶èµ°æ³•è¿”å›ã€‚

```
def max_best_move(scores)
  scores.max_by { |key, value| value }[0]
end

def max_best_score(scores)
  scores.max_by { |key, value| value }[1]
end

def evaluate_move(depth, scores)
  depth.zero? ? max_best_move(scores) : max_best_score(scores)
end 
```

Enter fullscreen mode Exit fullscreen mode

ä¾‹å¦‚ï¼Œæ‰“äº†ä½ç½® 9ï¼Œç»“æœçš„åˆ†æ•°æ˜¯ 0(å¹³å±€)ã€‚å¦‚æœéœ€è¦è¿”å›åˆ†æ•°ã€‚è¿˜è®°å¾—åœ¨`depth 0?`çš„åˆå§‹é€’å½’å‡½æ•°ä¸­çš„`best_score`å“ˆå¸Œå—ï¼Œç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

`best_score = {3=-8, 9=> }`

å®ƒéœ€è¦å€¼(0)ä¸é”®(9)åŒ¹é…ï¼Œä»¥å®Œæˆæ•£åˆ—ã€‚ä½œä¸ºè°ƒç”¨`evaluate_move`çš„ç»“æœï¼Œå°†è¿”å›åˆ†æ•°ï¼Œå¹¶ä¸”`best_move`æ•£åˆ—å˜æˆ:

`best_score = {3=-8, 9=>0}`

å½“`depth = 0`æ—¶ï¼Œhash ä¸­æ¯ä¸ªé”®(å¯ç”¨æ–¹å—)çš„å€¼(åˆ†æ•°)å¯ä»¥ç”¨`evaluate_move`æ¥è¯„ä¼°ã€‚è¿”å›å…·æœ‰æœ€é«˜å€¼çš„é”®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ€å¥½çš„ç§»åŠ¨æ˜¯ 9ã€‚

æ€»ä¹‹ï¼Œè¿™æ˜¯æˆ‘å¯¹é€’å½’çš„ç†è§£ï¼Œç”¨ minimax åˆ°ç›®å‰ä¸ºæ­¢ã€‚è¿˜æœ‰ä¸€äº›æˆ‘ä¸ç¡®å®šçš„å› ç´ ã€‚éšç€æˆ‘å¯¹æå°æå¤§çš„ç†è§£çš„æé«˜ï¼Œæ— æ•Œç©å®¶çš„åˆ›é€ æ–¹å¼å¯èƒ½ä¼šæ”¹å˜ã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œç”¨ Ruby æ‰¾åˆ°æˆ‘çš„äº•å­—æ¸¸æˆåº“:[https://github.com/ellehallal/ruby-tic-tac-toe](https://github.com/ellehallal/ruby-tic-tac-toe)

* * *

### æœ‰ç”¨çš„èµ„æº

*   [äº•å­—æ¸¸æˆ:ç†è§£æå¤§æå°ç®—æ³•](https://www.neverstopbuilding.com/blog/minimax)
*   [é€’å½’ 201:æå°æå¤§ï¼Œäº•å­—æ¸¸æˆï¼Œ&ä¸€ä¸ªæ— æ•Œçš„ AI](http://www.shei.io/recursion-minimax-algorithm/)
*   [å¦‚ä½•ä½¿ç”¨æå¤§æå°ç®—æ³•è®©ä½ çš„äº•å­—æ¸¸æˆæ— ä¸ä¼¦æ¯”](https://medium.freecodecamp.org/how-to-make-your-tic-tac-toe-game-unbeatable-by-using-the-minimax-algorithm-9d690bad4b37)
*   [äº•å­—æ¸¸æˆ:ç†è§£æå¤§æå°ç®—æ³•](https://www.neverstopbuilding.com/blog/minimax)