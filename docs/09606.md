# åœ¨ Elixir/Ruby ä¸­æŸ¥æ‰¾å‡½æ•°/æ–¹æ³•

> åŸæ–‡:[https://dev . to/edisonywh/function method-look-in-elixirruby-622](https://dev.to/edisonywh/functionmethod-look-up-in-elixirruby-622)

é¦–å…ˆï¼Œæˆ‘æ˜¯ Ruby dev å­¦ä¹ çµä¸¹å¦™è¯ã€‚æˆ‘å–œæ¬¢å°†æˆ‘åœ¨ Elixir ä¸­å­¦åˆ°çš„ä¸œè¥¿ä¸æˆ‘åœ¨ Ruby ä¸­äº†è§£çš„ä¸œè¥¿è¿›è¡Œæ¯”è¾ƒï¼Œå› ä¸ºæˆ‘è®¤ä¸ºè¿™ç¡®å®åŠ å¼ºäº†æˆ‘å¯¹è¿™ä¸¤ç§è¯­è¨€çš„ç†è§£ã€‚ä»Šå¤©ï¼Œæˆ‘æƒ³è°ˆè°ˆå‡½æ•°/æ–¹æ³•æŸ¥æ‰¾ã€‚

è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘åœ¨é€šè¿‡ [PragmaticStudio çš„è¯¾ç¨‹](https://pragmaticstudio.com/courses/elixir)å­¦ä¹  [`GenServer`](https://hexdocs.pm/elixir/GenServer.html) æ—¶æç¤ºçš„(æˆ‘å¼ºçƒˆæ¨è)ï¼Œä»–ä»¬æåˆ°`GenServer`å¯ä»¥æ³¨å…¥å‡½æ•°çš„é»˜è®¤å®ç°ï¼Œå¦‚æœä½ ä¸æ‰‹åŠ¨å®šä¹‰çš„è¯ã€‚è¿™äº›é»˜è®¤åŠŸèƒ½æ˜¯:

*   `init/1`
*   `child_spec/1`
*   `code_change/3`
*   `terminate/2`
*   `handle_info/2`
*   `handle_cast/2`
*   `handle_call/3`

å¦‚æœä½ æƒ³è¦†ç›–å®ƒä»¬ï¼Œåªéœ€åœ¨å½“å‰æ¨¡å—ä¸­å®šä¹‰ä¸€ä¸ªå…·æœ‰ç›¸åŒç­¾å(åç§°+ arity)çš„å‡½æ•°ã€‚

ä½†è¿™è®©æˆ‘æƒ³åˆ°ï¼Œ*å¦‚ä½•*æ˜¯çµè¯æŸ¥æ‰¾å‡½æ•°å®šä¹‰ä½¿è¿™æˆä¸ºå¯èƒ½ï¼Ÿ

åœ¨è¿›å…¥ Elixir ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Ruby ä¸­çš„æ–¹æ³•æŸ¥æ‰¾æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

## [](#your-dad-your-dads-dad-and-your-dads-dads-dad)ä½ çˆ¸ï¼Œä½ çˆ¸çš„çˆ¸ï¼Œä½ çˆ¸çš„çˆ¸çš„çˆ¸ã€‚

äº‹å®ä¸Šï¼Œæˆ‘ä»¥å‰å†™è¿‡å…³äºè¿™ä¸ªçš„åšå®¢ï¼ŒMatz æœ¬äººä¹Ÿè½¬å‘äº†è¿™ä¸ªåšå®¢ã€‚(æˆ‘å®é™…ä¸Šä¸çŸ¥é“è¿™å®é™…ä¸Šæ„å‘³ç€ä»€ä¹ˆï¼Œä½†æˆ‘ä»ç„¶ä¼šæŠŠå®ƒå½“ä½œè£èª‰å¾½ç« ä½©æˆ´)

[![edisonywh image](../Images/388d2736cc1db9d9adde421c4812f753.png)](/edisonywh) [## Ruby æ²¡æœ‰ç±»æ–¹æ³•

### çˆ±è¿ªç”Ÿ Yap 11 æœˆ 9 æ—¥ 185 åˆ†é’Ÿé˜…è¯»

#ruby #rails](/edisonywh/ruby-has-no-class-methods-39l5)

Ruby çš„æ–¹æ³•æŸ¥æ‰¾é“¾å¯ä»¥ç”¨ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æ¥æ¦‚æ‹¬- `ancestors`ã€‚

```
Foo = Class.new
Foo.ancestors # Lookup path for instance methods
#=> [Foo, Object, Kernel, BasicObject]

Foo.class.ancestors # Lookup path for class (singleton) methods, read my blog to learn more!
#=> [Class, Module, Object, Kernel, BasicObject] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±æ˜¯è¿™æ ·â€”â€”è¿™å°±æ˜¯ä½ çœ‹åˆ°çš„ Ruby çš„æ•´ä¸ªæ–¹æ³•æŸ¥æ‰¾é“¾ï¼

å®é™…ä¸Šï¼Œ`#ancestors`æ˜¯å®šä¹‰åœ¨`BasicObject`æœ¬èº«ä¸Šçš„ï¼Œæ‰€ä»¥å½“ä½ è°ƒç”¨`Foo.ancestors`æ—¶ï¼Œå®ƒä¼šè¿™æ ·é—®:

```
You: Do you implement `#ancestors`? 
- Foo: No
- Object: No
- Kernel: No + BasicObject: Yes I do! 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°±æ˜¯å®ƒçš„å·¥ä½œåŸç†ï¼

è¿™æ ·ï¼Œæˆ‘ä»¬çŸ¥é“å¦‚æœæˆ‘ä»¬æƒ³è¦å°†ä¸€ä¸ªå‡½æ•°`inject`åˆ° Ruby ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ç¡®ä¿æ–°æ³¨å…¥çš„å‡½æ•°æ˜¯æŸ¥æ‰¾è¿‡ç¨‹ä¸­æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ–¹æ³•(åœ¨`BasicObject`ä¹‹å‰çš„ä»»ä½•åœ°æ–¹å®šä¹‰`#ancestors`)ã€‚

æ‰€ä»¥ï¼ŒRuby èƒ½å¤Ÿåšåˆ°è¿™ä¸€ç‚¹æ˜¯å› ä¸º`ancestors`ï¼Œä½†æ˜¯ Elixir å¹¶æ²¡æœ‰çœŸæ­£çš„`ancestors` / `inheritance`çš„æ¦‚å¿µï¼Œé‚£ä¹ˆè¿™é‡Œåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ

æ˜¯æ—¶å€™åœæ­¢çŒœæµ‹äº†ï¼Œæ‰€ä»¥æˆ‘å†³å®šè‡ªå·±å°è¯•ä¸€ä¸ªä¾‹å­ã€‚

```
defmodule Parent do
  defmacro __using__(_opts) do
    quote do
      def injected do
        "This is from Parent"
      end
    end
  end
end

defmodule Child do
  use Parent

  def injected do
    "This is from Child"
  end
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘çš„é¢„æœŸè¡Œä¸ºæ˜¯æˆ‘çš„`Parent.injected/0`å°†è¢«æˆ‘çš„`Child.injected/0`è¦†ç›–ï¼Œä½†æ˜¯å½“æˆ‘è¯•å›¾è¿è¡Œè¿™ä¸ªæ–‡ä»¶- `iex lookup.exs`æ—¶ï¼Œå¼¹å‡ºä»¥ä¸‹è­¦å‘Šæ¶ˆæ¯:

> è­¦å‘Š:æ­¤å­å¥æ— æ³•åŒ¹é…ï¼Œå› ä¸ºç¬¬ **12** è¡Œçš„å‰ä¸€ä¸ªå­å¥æ€»æ˜¯åŒ¹é… lookup.exs: **14**

å¥‡æ€ªçš„è­¦å‘Šï¼Œä½†è®©æˆ‘ä»¬è¯•ç€å®é™…è¿è¡Œå®ƒã€‚

```
iex(1)> Child.injected
"This is from Parent" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä»¤æˆ‘æƒŠè®¶çš„æ˜¯(å½“æˆ‘çœ‹åˆ°è­¦å‘Šæ¶ˆæ¯æ—¶ï¼ŒæƒŠå–œæœ‰ç‚¹è¢«ç ´åäº†)ï¼Œè¿è¡Œ`Child.injected`ä¼šè¿”å›æˆ‘`Parent.injected/0`è€Œä¸æ˜¯`Child.injected/0`ï¼Œä¸ºä»€ä¹ˆï¼Ÿï¼

æˆ‘å†³å®š[é’»ç ”](https://hexdocs.pm/elixir/GenServer.html)æ–‡æ¡£å¹¶æ‰¾å‡ºåŸå› ï¼Œä½†æ˜¯é™¤äº†`GenServer` *å°†*ä¸ºä½ æ³¨å…¥å‡½æ•°ä¹‹å¤–ï¼Œæ–‡æ¡£å¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘å¤ªå¤šã€‚ä½†æ˜¯æˆ‘å·²ç»çŸ¥é“äº†ï¼Œæˆ‘åªæ˜¯æƒ³çŸ¥é“*æ˜¯æ€ä¹ˆåšåˆ°çš„*ã€‚

æ‰€ä»¥ï¼ŒåŒ»ç”Ÿæ²¡æœ‰å¸®åŠ©ï¼Œæ¥ä¸‹æ¥å‘¢ï¼Ÿ

## [](#source-code)æºä»£ç ï¼

åƒå¤§å¤šæ•°å…¶ä»–è¯­è¨€ä¸€æ ·ï¼ŒElixir æ˜¯å¼€æºçš„ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥å¾ˆå®¹æ˜“åœ°é’»ç ”[æºä»£ç æœ¬èº«](https://github.com/elixir-lang/elixir/blob/master/lib/elixir/lib/gen_server.ex)ã€‚

ç°åœ¨ï¼Œæˆ‘çœ‹åˆ°äº†ä¸€ä¸ªåä¸º `defoverridable`çš„å¯ç–‘çš„ä¸œè¥¿[ï¼Œæˆ‘æœ‰ä¸€ç§é¢„æ„Ÿï¼Œå¯èƒ½å°±æ˜¯å®ƒï¼Œä½†æˆ‘æƒ³è¿›ä¸€æ­¥è¯æ˜æˆ‘çš„å‡è®¾ã€‚](https://github.com/elixir-lang/elixir/blob/master/lib/elixir/lib/gen_server.ex#L818)

åœ¨è°·æ­Œä¸Šå¿«é€Ÿæœç´¢äº†ä¸€ä¸‹`defoverridable`åï¼Œæˆ‘çœ‹åˆ°äº†[çµè¯è®ºå›](https://elixirforum.com/t/behaviours-defoverridable-and-implementations/3338)ä¸Šçš„ä¸€ä¸ªå¸–å­ï¼Œä½œè€…æ˜¯ JosÃ© Valimã€‚

## [](#solution)è§£

æ‰€ä»¥é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å‘ç°æˆ‘å¯ä»¥ä½¿ç”¨`defoverridable`ï¼Œè¿™æ„å‘³ç€æˆ‘å¯ä»¥æ›´æ–°æˆ‘çš„ä»£ç å¦‚ä¸‹:

```
defmodule Parent do
  defmacro __using__(_opts) do
    quote do
      def injected do
        "This is from Parent"
      end

+     defoverridable injected: 0
    end
  end
end 
defmodule Child do
  use Parent

  def injected do
    "This is from Child"
  end
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨å¦‚æœæˆ‘ä»¬è¿è¡Œå®ƒ..

```
iex(1)> Child.injected
"This is from Child" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç§ï¼ŒæˆåŠŸäº†ï¼å®Œç¾çš„ğŸ‰

## [](#conclusion)ç»“è®º

åœ¨ä»–çš„å¸–å­ä¸­ï¼ŒJosÃ©ä¸ºæˆ‘æ¾„æ¸…äº†`defoverridable`ï¼Œä½†ä»–ä¹Ÿç»§ç»­è¯´`defoverridable`æ˜¯**è€Œä¸æ˜¯æ¨èçš„**ï¼Œäº‹å®ä¸Šä»–ä»¬æ­£åœ¨å‘`@optional_callback`è½¬ç§»ï¼Œä»¥å°†æ–¹æ³•æ ‡è®°ä¸ºå¯é€‰çš„ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå¢å¼ºåŠŸèƒ½`@impl`(ç¼–è¯‘å™¨å°†ä½¿ç”¨å®ƒæ¥ç¡®ä¿â€œå­©å­â€å®ç°é‚£ä¸ªåŠŸèƒ½)ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯æˆ‘å­¦åˆ°çš„ä¸€ä»¶æœ‰è¶£çš„äº‹æƒ…ã€‚æ¨èä½ çœ‹å¸–å­å’Œè¯„è®ºå¤šäº†è§£ä¸€ç‚¹ã€‚

æˆ‘çš„é—®é¢˜åœ¨ä»–çš„å¸–å­çš„å‰ 10 è¡Œä¸­å¾—åˆ°äº†å›ç­”ï¼Œæ‰€ä»¥å¦‚æœæˆ‘èƒ½åœ¨ç¬¬ä¸€æ—¶é—´æ‰¾åˆ°å®ƒï¼Œé‚£å°±å¤ªå¥½äº†ã€‚è¯åˆè¯´å›æ¥ï¼Œå¦‚æœæˆ‘æ²¡æœ‰ç ”ç©¶æºä»£ç ï¼Œæˆ‘å°±ä¸ä¼šçŸ¥é“è¦å¯»æ‰¾ä»€ä¹ˆå…³é”®å­—ï¼Œå› æ­¤ä¹Ÿä¸ä¼šå‡ºç°åœ¨è¿™ç¯‡æ–‡ç« ä¸­ã€‚

å¯¹æˆ‘æ¥è¯´ï¼Œè¿™ä»ç„¶æ˜¯ä¸€æ¬¡æœ‰è¶£çš„æ—…ç¨‹ï¼Œå› ä¸ºæˆ‘ä¸€åº¦è®¤ä¸ºé•¿ç”Ÿä¸è€è¯æœ‰åƒ Ruby ä¸€æ ·çš„é—ä¼ æ€§ã€‚

(æ­¤å¤–ï¼Œtitle åœ¨æŠ€æœ¯ä¸Šæ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸º Elixir å¹¶æ²¡æœ‰çœŸæ­£çš„â€œå‡½æ•°æŸ¥æ‰¾â€â€”â€”å®ƒæ‰€åšçš„åªæ˜¯æŸ¥çœ‹å½“å‰æ¨¡å—ï¼)