# æ•™ç¨‹:å¦‚ä½•ä½¿ç”¨ React Nativeã€react-native-web å’Œ monorepo åœ¨ iOSã€Android å’Œ Web ä¹‹é—´å…±äº«ä»£ç 

> åŸæ–‡:[https://dev . to/brunolemos/tutorial-100-code-sharing-between-IOs-Android-web-using-react-native-web-and monorepo-4 pej](https://dev.to/brunolemos/tutorial-100-code-sharing-between-ios-android--web-using-react-native-web-andmonorepo-4pej)

è®©æˆ‘ä»¬ä»¥æ­£ç¡®çš„æ–¹å¼è®©æˆ‘ä»¬çš„`react-native`åº”ç”¨ç¨‹åºåœ¨æµè§ˆå™¨ä¸­å·¥ä½œã€‚

> æœ¬æ•™ç¨‹æ˜¯ä¸º`react-native <= 0.61`åˆ¶ä½œçš„ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ–°ç‰ˆæœ¬ï¼Œæˆ‘å»ºè®®ä½ è½¬è€Œä½¿ç”¨è¿™ä¸ªåº“:[brunolemos/react-native-we b-monorepo](https://github.com/brunolemos/react-native-web-monorepo)ï¼Œæˆ‘ä¼šä¿æŒå®ƒçš„æ›´æ–°ğŸ™Œ

* * *

## [](#why-am-i-writing-this)æˆ‘ä¸ºä»€ä¹ˆè¦å†™è¿™ä¸ªï¼Ÿ

ä½ å¥½ğŸ‘‹æˆ‘æ˜¯[å¸ƒé²è¯ºè±é»˜æ–¯](https://twitter.com/brunolemos)ã€‚æˆ‘æœ€è¿‘å¯åŠ¨äº†ä¸€ä¸ªåä¸º[dev hub-TweetDeck for GitHub](http://github.com/devhubapp/devhub)çš„é¡¹ç›®ï¼Œè€Œ[å¼•èµ·äººä»¬æ³¨æ„çš„ä¸€ä»¶äº‹](https://twitter.com/brunolemos/status/1072871009651384320?s=21)æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±å•ä¸€å¼€å‘è€…åˆ¶ä½œçš„åº”ç”¨ç¨‹åºï¼Œå¯åœ¨ 6 ä¸ªå¹³å°ä¸Šä½¿ç”¨:Web (react-native-web)ã€iOS ( `react native`)ã€Android ( `react native`)ã€macOSã€Windows å’Œ Linux ( `electron`ï¼Œç›®å‰ä¸º)ï¼Œå®ƒä»¬ä¹‹é—´å‡ ä¹ 100%å…±äº«ä»£ç ã€‚å®ƒç”šè‡³ä¸æœåŠ¡å™¨å…±äº«ä¸€äº›ä»£ç ï¼ç›´åˆ°å‡ å¹´å‰ï¼Œè¿™è¿˜éœ€è¦ä¸€ä¸ª 3 äººä»¥ä¸Šçš„å›¢é˜Ÿã€‚

ä»é‚£ä»¥åï¼Œæˆ‘æ”¶åˆ°äº†å‡ åæ¡æ¨æ–‡å’Œç§äººä¿¡æ¯ï¼Œè¯¢é—®å¦‚ä½•å®ç°åŒæ ·çš„ç›®æ ‡ï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†å¸¦ä½ æµè§ˆä¸€éã€‚

## [](#whats-raw-reactnativeweb-endraw-)ä»€ä¹ˆæ˜¯`react-native-web`ï¼Ÿ

å¦‚æœä½ ä¸ç†Ÿæ‚‰ [react-native-web](http://github.com/necolas/react-native-web) ï¼Œè¿™æ˜¯ä¸€ä¸ªç”± [Necolas](https://twitter.com/necolas) (å‰ Twitter å·¥ç¨‹å¸ˆ)å¼€å‘çš„åº“ï¼Œå¯ä»¥è®©ä½ çš„`React Native`ä»£ç åœ¨æµè§ˆå™¨ä¸­å‘ˆç°ã€‚ç²—ç•¥åœ°è¯´ï¼Œä½ å°†ç¼–å†™`<View />`ï¼Œå®ƒå°†æ¸²æŸ“`<div />`ï¼Œç¡®ä¿æ‰€æœ‰é£æ ¼æ¸²æŸ“å®Œå…¨ç›¸åŒçš„ä¸œè¥¿ã€‚å®ƒåšçš„ä¸æ­¢è¿™äº›ï¼Œä½†æ˜¯è®©æˆ‘ä»¬ä¿æŒç®€å•ã€‚

æ–°çš„æ¨ç‰¹å°±æ˜¯ç”¨è¿™ç§æŠ€æœ¯åˆ›å»ºçš„ï¼Œéå¸¸æ£’ã€‚

å¦‚æœä½ å·²ç»çŸ¥é“`react-native`ï¼Œä½ ä¸éœ€è¦å­¦ä¹ ä»»ä½•æ–°çš„è¯­æ³•ã€‚æ˜¯[åŒä¸€ä¸ª API](https://github.com/necolas/react-native-web#components) ã€‚

* * *

## [](#summary)æ€»ç»“

*   å¼€å§‹ä¸€ä¸ªæ–°çš„`React Native`é¡¹ç›®
*   æŠŠæˆ‘ä»¬çš„æ–‡ä»¶å¤¹ç»“æ„å˜æˆä¸€ä¸ª monorepo
*   è®©`react-native`åœ¨ monorepo ä¸­å·¥ä½œ
*   åœ¨æˆ‘ä»¬çš„ monorepo åŒ…ä¹‹é—´å…±äº«ä»£ç 
*   ä½¿ç”¨`create-react-app`å’Œ`react-native-web`åˆ›å»ºæ–°çš„ web é¡¹ç›®
*   é€šè¿‡ä»£ç å…±äº«è®©`CRA`åœ¨æˆ‘ä»¬çš„`monorepo`å†…éƒ¨å·¥ä½œ
*   ï¼Ÿï¼Ÿï¼Ÿ
*   åˆ©æ¶¦

* * *

## [](#stepbystep-tutorial)å¾ªåºæ¸è¿›æ•™ç¨‹

### [](#starting-a-new-raw-react-native-endraw-%C2%A0project)å¼€å§‹æ–°çš„`React Native`é¡¹ç›®

*   `$ react-native init myprojectname`
*   `$ cd myprojectname`
*   `$ git init && git add . -A && git commit -m "Initial commit"`

> æ³¨æ„:ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªè·¨å¹³å°çš„åº”ç”¨ç¨‹åºæ¯”è¯•å›¾ç§»æ¤ä¸€ä¸ªç°æœ‰çš„çº¯ç§»åŠ¨(æˆ–è€…æ›´éš¾:çº¯ web)é¡¹ç›®è¦å®¹æ˜“å¾—å¤šï¼Œå› ä¸ºä»–ä»¬å¯èƒ½ä¼šä½¿ç”¨è®¸å¤šç‰¹å®šäºå¹³å°çš„ä¾èµ–é¡¹ã€‚
> 
> ç¼–è¾‘:å¦‚æœä½ ä½¿ç”¨ expoï¼Œä¼¼ä¹ä»–ä»¬å¾ˆå¿«å°±ä¼šå†…ç½®å¯¹ web çš„æ”¯æŒ[ï¼](https://twitter.com/brunolemos/status/1105493974285017090?s=20)

### [](#turning-our-folder-structure-into-a%C2%A0monorepo)æŠŠæˆ‘ä»¬çš„æ–‡ä»¶å¤¹ç»“æ„å˜æˆä¸€ä¸ª monorepo

Monorepo æ„å‘³ç€åœ¨ä¸€ä¸ªåº“ä¸­æœ‰å¤šä¸ªåŒ…ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨å®ƒä»¬ä¹‹é—´å…±äº«ä»£ç ã€‚è¿™å¹¶æ²¡æœ‰å¬èµ·æ¥é‚£ä¹ˆç®€å•ï¼Œå› ä¸º`react-native`å’Œ`create-react-app`éƒ½éœ€è¦ä¸€äº›å·¥ä½œæ¥æ”¯æŒ monorepo é¡¹ç›®ã€‚ä½†æ˜¯å˜¿ï¼Œè‡³å°‘è¿™æ˜¯å¯èƒ½çš„ï¼

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸º`Yarn Workspaces`çš„ç‰¹æ€§ã€‚
è¦æ±‚: [Node.js](https://nodejs.org/en/) ã€[çº±](https://yarnpkg.com/lang/en/docs/install/)å’Œ [React Native](https://facebook.github.io/react-native/docs/getting-started.html) ã€‚

*   *ç¡®ä¿ä½ åœ¨é¡¹ç›®æ ¹æ–‡ä»¶å¤¹*
*   `$ rm yarn.lock && rm -rf node_modules`
*   `$ mkdir -p packages/components/src packages/mobile packages/web`
*   å°†æ‰€æœ‰æ–‡ä»¶(é™¤äº†`.git`)ç§»åŠ¨åˆ°`packages/mobile`æ–‡ä»¶å¤¹
*   å°†`packages/mobile/package.json`ä¸Šçš„`name`å­—æ®µä»`packagename`ç¼–è¾‘ä¸º`mobile`
*   åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºè¿™ä¸ª`package.json`æ¥å¯ç”¨`Yarn Workspaces`:

```
{  "name":  "myprojectname",  "private":  true,  "workspaces":  {  "packages":  [  "packages/*"  ],  "nohoist":  []  }  "dependencies":  {  "react-native":  "0.61.3"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`.gitignore`:

```
.DS_Store
.vscode
node_modules/
yarn-error.log 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `$ yarn`

### [](#making-reactnative-work-in-a%C2%A0monorepo)åœ¨ monorepo ä¸­åˆ¶ä½œ react-native ä½œå“

*   *æ£€æŸ¥`react-native`çš„å®‰è£…ä½ç½®ã€‚å¦‚æœæ˜¯åœ¨`/node_modules/react-native`ï¼Œå¥½å§ã€‚å¦‚æœæ˜¯åœ¨`/packages/mobile/node_modules/react-native`ï¼Œé‚£å°±ä¸å¯¹åŠ²äº†ã€‚ç¡®ä¿ä½ æœ‰æœ€æ–°ç‰ˆæœ¬çš„`node`å’Œ`yarn`ã€‚è¿˜è¦ç¡®ä¿åœ¨ monorepo åŒ…ä¹‹é—´ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ï¼Œä¾‹å¦‚åœ¨`mobile`å’Œ`components`ä¸Šä½¿ç”¨`"react": "16.11.0"`ï¼Œè€Œä¸æ˜¯åœ¨å®ƒä»¬ä¹‹é—´ä½¿ç”¨ä¸åŒçš„ç‰ˆæœ¬ã€‚*

*   æ‰“å¼€æ‚¨æœ€å–œæ¬¢çš„ç¼–è¾‘å™¨ï¼Œä½¿ç”¨`Search & Replace`åŠŸèƒ½å°†æ‰€æœ‰å‡ºç°çš„`node_modules/react-native/`æ›¿æ¢ä¸º`../../node_modules/react-native/`ã€‚

*   å¯¹äº react-native <= 0.59ï¼Œæ‰“å¼€`packages/mobile/package.json`ã€‚æ‚¨çš„`start`è„šæœ¬ç›®å‰åœ¨`/cli.js start`ç»“æŸã€‚æŠŠè¿™ä¸ªè¿½åŠ åˆ°æœ€å:`--projectRootÂ ../../`ã€‚

*   æ‰“å¼€`packages./mobile/metro.config.js`å¹¶åœ¨ä¸Šé¢è®¾ç½®`projectRoot`å­—æ®µï¼Œçœ‹èµ·æ¥åƒè¿™æ ·:

```
const path = require('path')

module.exports = {
  projectRoot: path.resolve(__dirname, '../../'),
  transformer: {
    getTransformOptions: async () => ({
      transform: {
        experimentalImportSupport: false,
        inlineRequires: false,
      },
    }),
  },
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   [è§£å†³æ–¹æ³•]æ‚¨å½“å‰éœ€è¦å°†`react-native`ä¾èµ–é¡¹æ·»åŠ åˆ°æ ¹`package.json`ä¸­ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ†ç»‘ JS:

```
 "dependencies":  {  "react-native":  "0.61.3"  }, 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#ios-changes)iOS å˜åŒ–

*   `$ open packages/mobile/ios/myprojectname.xcodeproj/`
*   æ‰“å¼€`AppDelegate.m`ï¼Œæ‰¾åˆ°`jsBundleURLForBundleRoot:@"index"`ï¼Œç”¨`packages/mobile/index`æ›¿æ¢`index`
*   è¿˜æ˜¯åœ¨ Xcode é‡Œé¢ï¼Œç‚¹å‡»ä½ å·¦è¾¹çš„é¡¹ç›®åç§°ï¼Œç„¶åè¿›å…¥`Build Phases` > `Bundle React Native code and Images`ã€‚å°†å…¶å†…å®¹æ›¿æ¢ä¸º:

```
export NODE_BINARY=node
export EXTRA_PACKAGER_ARGS="--entry-file packages/mobile/index.js"
../../../node_modules/react-native/scripts/react-native-xcode.sh 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `$ yarn workspace mobile start`

æ‚¨ç°åœ¨å¯ä»¥è¿è¡Œ iOS åº”ç”¨ç¨‹åºäº†ï¼ğŸ’™é€‰æ‹©ä¸€ä¸ª iPhone æ¨¡æ‹Ÿå™¨ï¼ŒæŒ‰ä¸‹ Xcode é‡Œé¢çš„â€œè¿è¡Œâ€ä¸‰è§’æŒ‰é’®ã€‚

[![image](../Images/88f1ba1587ccdc70616c0f47552934c2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ab3SNC46--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hw74nbu4d0h49kh90qmv.png)

#### [](#android-changes)å®‰å“å˜åŒ–

*   `$ studio packages/mobile/android/`
*   æ‰“å¼€`packages/mobile/android/app/build.gradle`ã€‚æœç´¢æ–‡æœ¬`project.ext.react = [...]`ã€‚ç¼–è¾‘å®ƒï¼Œä½¿å®ƒçœ‹èµ·æ¥åƒè¿™æ ·:

```
project.ext.react = [
    entryFile: "packages/mobile/index.js",
    root: "../../../../"
] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   Android Studio å°†æ˜¾ç¤ºä¸€ä¸ªç«‹å³åŒæ­¥å¼¹å‡ºçª—å£ã€‚ç‚¹å‡»å®ƒã€‚
*   æ‰“å¼€`packages/mobile/android/app/src/main/java/com/myprojectname/MainApplication.java`ã€‚æœç´¢`getJSMainModuleName`æ–¹æ³•ã€‚å°†`index`æ›¿æ¢ä¸º`packages/mobile/index`ï¼Œçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
@Override
protected String getJSMainModuleName() {
  return "packages/mobile/index";
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> å¦‚æœå‡ºç°`Cannot get property 'packageName' on null object`é”™è¯¯ï¼Œå°è¯•[ç¦ç”¨è‡ªåŠ¨é“¾æ¥](https://github.com/react-native-community/cli/issues/655)

æ‚¨ç°åœ¨å¯ä»¥è¿è¡Œ Android åº”ç”¨ç¨‹åºäº†ï¼ğŸ’™æŒ‰ä¸‹ Android Studio ä¸­çš„â€œè¿è¡Œâ€ç»¿è‰²ä¸‰è§’æŒ‰é’®ï¼Œé€‰æ‹©æ¨¡æ‹Ÿå™¨æˆ–è®¾å¤‡ã€‚

[![image](../Images/9e6d9634111c080f8c3c00fcf4afb97d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--MJOJuhz6--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zhpmuclw1ekywgu5fw3t.png)

### [](#sharing-code-between-our-monorepo-packages)åœ¨æˆ‘ä»¬çš„ monorepo åŒ…ä¹‹é—´å…±äº«ä»£ç 

æˆ‘ä»¬åœ¨ monorepo ä¸­åˆ›å»ºäº†å¾ˆå¤šæ–‡ä»¶å¤¹ï¼Œä½†ç›®å‰åªä½¿ç”¨äº†`mobile`ã€‚è®©æˆ‘ä»¬ä¸ºä»£ç å…±äº«å‡†å¤‡å¥½æˆ‘ä»¬çš„ä»£ç åº“ï¼Œç„¶åå°†ä¸€äº›æ–‡ä»¶ç§»åŠ¨åˆ°`components`åŒ…ä¸­ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥è¢«`mobile`ã€`web`ä»¥åŠæˆ‘ä»¬å°†æ¥å†³å®šæ”¯æŒçš„ä»»ä½•å…¶ä»–å¹³å°(ä¾‹å¦‚:`desktop`ã€`server`ç­‰)é‡ç”¨ã€‚).

*   åˆ›å»ºåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ–‡ä»¶`packages/components/package.json`:

```
{  "name":  "components",  "version":  "0.0.1",  "private":  true  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   *ã€å¯é€‰ã€‘å¦‚æœä½ å†³å®šå°†æ¥æ”¯æŒæ›´å¤šçš„å¹³å°ï¼Œä½ å¯ä»¥ä¸ºä»–ä»¬åšåŒæ ·çš„äº‹æƒ…:åˆ›å»ºä¸€ä¸ª`packages/core/package.json`ã€`packages/desktop/package.json`ã€`packages/server/package.json`ç­‰ç­‰ã€‚æ¯ä¸ªå­—æ®µçš„åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚*

*   æ‰“å¼€`packages/mobile/package.json`ã€‚æ·»åŠ æ‚¨ç”¨ä½œä¾èµ–é¡¹çš„æ‰€æœ‰ monorepo åŒ…ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œ`mobile`åªä½¿ç”¨äº†`components`åŒ…:

```
"dependencies":  {  "components":  "0.0.1",  ...  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   *åœæ­¢æ­£åœ¨è¿è¡Œçš„ react-native æ‰“åŒ…ç¨‹åº*
*   `$ yarn`
*   `$ mv packages/mobile/App.js packages/components/src/`
*   æ‰“å¼€`packages/mobile/index.js`ã€‚å°†`import App from './App'`æ›¿æ¢ä¸º`import App from 'components/src/App'`ã€‚*è¿™å°±æ˜¯ç¥å¥‡ä¹‹å¤„ã€‚ä¸€ä¸ªåŒ…ç°åœ¨å¯ä»¥è®¿é—®å…¶ä»–åŒ…äº†ï¼*
*   ç¼–è¾‘`packages/components/src/App.js`ï¼Œç”¨`Welcome to React Native monorepo!`æ›¿æ¢`Welcome to React Native!`ï¼Œè¿™æ ·æˆ‘ä»¬å°±çŸ¥é“æˆ‘ä»¬æ­£åœ¨æ¸²æŸ“æ­£ç¡®çš„æ–‡ä»¶ã€‚
*   `$ yarn workspace mobile start`

è€¶ï¼æ‚¨ç°åœ¨å¯ä»¥åˆ·æ–°æ­£åœ¨è¿è¡Œçš„ iOS/Android åº”ç”¨ç¨‹åºï¼Œå¹¶æŸ¥çœ‹æ¥è‡ªæˆ‘ä»¬å…±äº«ç»„ä»¶åŒ…çš„å±å¹•ã€‚ğŸ‰

*   `$ git addÂ . -A && git commit -m "Monorepo"`

## [](#web-project)Web é¡¹ç›®

> æ³¨æ„:æ‚¨å¯ä»¥é‡ç”¨å¤šè¾¾ 100%çš„ä»£ç ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ‚¨åº”è¯¥è¿™æ ·åšã€‚å»ºè®®åœ¨å¹³å°ä¹‹é—´æœ‰ä¸€äº›å·®å¼‚ï¼Œè®©ç”¨æˆ·æ„Ÿè§‰æ›´è‡ªç„¶ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä»¥`.web.js`ã€`.ios.js`ã€`.android.js`æˆ–`.native.js`ç»“å°¾çš„ç‰¹å®šäºå¹³å°çš„æ–‡ä»¶ã€‚å‚è§[ç¤ºä¾‹](https://github.com/devhubapp/devhub/tree/v0.90.0/packages/components/src/libs/bugsnag)ã€‚

### [](#creating-a-new-web-project-using-cra-and-reactnativeweb)ä½¿ç”¨ CRA å’Œ react-native-web åˆ›å»ºæ–°çš„ web é¡¹ç›®

*   `$ cd packages/`
*   `$ npx create-react-app web`
*   `$ cdÂ ./web` *(ç•™åœ¨æ­¤æ–‡ä»¶å¤¹å†…è¿›è¡Œä¸‹ä¸€æ­¥)*
*   `$ rm src/*` *(æˆ–è€…æ‰‹åŠ¨åˆ é™¤`packages/web/src`é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶)*
*   *ç¡®ä¿`package.json`ä¸­çš„ä¾èµ–é¡¹åœ¨æ‰€æœ‰ monorepo åŒ…ä¹‹é—´å®Œå…¨ç›¸åŒã€‚ä¾‹å¦‚ï¼Œå°†`web`å’Œ`mobile`è½¯ä»¶åŒ…ä¸Šçš„â€œååº”â€ç‰ˆæœ¬æ›´æ–°ä¸ºâ€œ16.9.0â€(æˆ–ä»»ä½•å…¶ä»–ç‰ˆæœ¬)ã€‚*
*   `$ yarn add react-native-web react-art`
*   `$ yarn add --dev babel-plugin-react-native-web`
*   åˆ›å»ºåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ–‡ä»¶`packages/web/src/index.js`:

```
import { AppRegistry } from 'react-native'

import App from 'components/src/App'

AppRegistry.registerComponent('myprojectname', () => App)
AppRegistry.runApplication('myprojectname', {
  rootTag: document.getElementById('root'),
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> æ³¨æ„:å½“æˆ‘ä»¬ä»ä¸€ä¸ª`create-react-app`é¡¹ç›®ä¸­çš„`react-native`å¯¼å…¥æ—¶ï¼Œå®ƒçš„`webpack`é…ç½®è‡ªåŠ¨[ä¸ºæˆ‘ä»¬å°†å…¶åˆ«åä¸º`react-native-web`](https://github.com/facebook/create-react-app/blob/ff19e0a6d22ba070f5b4c3b511edb4e8d4995686/packages/react-scripts/config/webpack.config.js#L274-L278) ã€‚

*   åˆ›å»ºåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ–‡ä»¶`packages/web/public/index.css`:

```
html,
body,
#root,
#root > div {
  width: 100%;
  height: 100%;
}

body {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   åœ¨å…³é—­`head`æ ‡ç­¾ä¹‹å‰ï¼Œç¼–è¾‘`packages/web/public/index.html`ä»¥åŒ…å«æˆ‘ä»¬çš„ CSS:

```
...
<title>React App</title>
<link rel="stylesheet" href="%PUBLIC_URL%/index.css" />
</head> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### é€šè¿‡ä»£ç å…±äº«è®© CRA åœ¨æˆ‘ä»¬çš„ monorepo ä¸­å·¥ä½œ

é»˜è®¤æƒ…å†µä¸‹ï¼ŒCRA ä¸ä¼šåœ¨`src`æ–‡ä»¶å¤¹ä¹‹å¤–æ„å»ºæ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦è®©å®ƒåšåˆ°è¿™ä¸€ç‚¹ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥ç†è§£æˆ‘ä»¬ monorepo åŒ…ä¸­çš„ä»£ç ï¼Œå…¶ä¸­åŒ…å« JSX å’Œå…¶ä»–éçº¯ JS ä»£ç ã€‚

*   *å¾…åœ¨`packages/web/`é‡Œç­‰å¾…æ¥ä¸‹æ¥çš„æ­¥éª¤*
*   ç”¨ä»¥ä¸‹å†…å®¹åˆ›å»ºä¸€ä¸ª`.env`æ–‡ä»¶(`packages/web/.env`):

```
SKIP_PREFLIGHT_CHECK=true 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   `$ yarn add --dev react-app-rewired`
*   ç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢`packages/web/package.json`ä¸­çš„è„šæœ¬:

```
"scripts":  {  "start":  "react-app-rewired start",  "build":  "react-app-rewired build",  "test":  "react-app-rewired test",  "eject":  "react-app-rewired eject"  }, 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*   ç”¨ä»¥ä¸‹å†…å®¹åˆ›å»º`packages/web/config-overrides.js`æ–‡ä»¶:

```
const fs = require('fs')
const path = require('path')
const webpack = require('webpack')

const appDirectory = fs.realpathSync(process.cwd())
const resolveApp = relativePath => path.resolve(appDirectory, relativePath)

// our packages that will now be included in the CRA build step
const appIncludes = [
  resolveApp('src'),
  resolveApp('../components/src'),
]

module.exports = function override(config, env) {
  // allow importing from outside of src folder
  config.resolve.plugins = config.resolve.plugins.filter(
    plugin => plugin.constructor.name !== 'ModuleScopePlugin'
  )
  config.module.rules[0].include = appIncludes
  config.module.rules[1] = null
  config.module.rules[2].oneOf[1].include = appIncludes
  config.module.rules[2].oneOf[1].options.plugins = [
    require.resolve('babel-plugin-react-native-web'),
  ].concat(config.module.rules[2].oneOf[1].options.plugins)
  config.module.rules = config.module.rules.filter(Boolean)
  config.plugins.push(
    new webpack.DefinePlugin({ __DEV__: env !== 'production' })
  )

  return config
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> ä¸Šé¢çš„ä»£ç è¦†ç›–äº†ä¸€äº›`create-react-app`çš„`webpack`é…ç½®ï¼Œæ‰€ä»¥å®ƒåœ¨ CRA çš„æ„å»ºæ­¥éª¤ä¸­åŒ…å«äº†æˆ‘ä»¬çš„ monorepo åŒ…

*   `$ git add . -A && git commit -m "Web project"`

å°±æ˜¯è¿™æ ·ï¼æ‚¨ç°åœ¨å¯ä»¥åœ¨`packages/web`(æˆ–æ ¹ç›®å½•ä¸‹çš„`yarn workspace web start`)ä¸­è¿è¡Œ`yarn start`æ¥å¯åŠ¨ web é¡¹ç›®ï¼Œä¸æˆ‘ä»¬çš„`react-native` `mobile`é¡¹ç›®å…±äº«ä»£ç ï¼ğŸ‰

[![image](../Images/1ddbee57b9384027c8e03e430aae24ca.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jHdLq3xp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/48ij2zssunapdrb4qnog.jpg)

## [](#some-gotchas)ä¸€äº›ç–‘éš¾æ‚ç—‡

*   `react-native-web`æ”¯æŒå¤§éƒ¨åˆ†çš„`react-native` APIï¼Œä½†æ˜¯å°‘äº†å‡ ä¸ªåƒ`Alert`ã€`Modal`ã€`RefreshControl`ã€`WebView`ï¼›
*   å¦‚æœä½ é‡åˆ°ä¸€ä¸ªä¸é€‚åˆ monorepo ç»“æ„çš„ä¾èµ–é¡¹ï¼Œä½ å¯ä»¥æŠŠå®ƒæ·»åŠ åˆ°[no huit](https://yarnpkg.com/blog/2018/02/15/nohoist/)åˆ—è¡¨ä¸­ï¼›ä½†æ˜¯å¦‚æœå¯èƒ½çš„è¯ï¼Œè¯·é¿å…è¿™æ ·åšï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´å…¶ä»–é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¯¹äº metro bundlerã€‚

## [](#some-tips)ä¸€äº›æç¤º

*   å¯¼èˆªå¯èƒ½æœ‰ç‚¹æŒ‘æˆ˜æ€§ï¼›ä½ å¯ä»¥ä½¿ç”¨åƒæœ€è¿‘å¢åŠ äº†ç½‘ç»œæ”¯æŒçš„ [react-navigation](https://github.com/react-navigation/react-navigation) è¿™æ ·çš„ä¸œè¥¿ï¼Œæˆ–è€…ä½ å¯ä»¥å°è¯•åœ¨å’Œ mobile ä¹‹é—´ä½¿ç”¨ä¸¤ç§ä¸åŒçš„å¯¼èˆªå™¨ï¼Œä»¥é˜²ä½ æƒ³é€šè¿‡ç‰ºç‰²ä¸€äº›ä»£ç å…±äº«æ¥è·å¾—ä¸¤ä¸ªä¸–ç•Œçš„æœ€ä½³æ•ˆæœï¼›
*   å¦‚æœä½ è®¡åˆ’ä¸æœåŠ¡å™¨å…±äº«ä»£ç ï¼Œæˆ‘æ¨èåˆ›å»ºä¸€ä¸ª`core`åŒ…ï¼ŒåªåŒ…å«é€»è¾‘å’Œå¸®åŠ©å™¨å‡½æ•°(æ²¡æœ‰ UI ç›¸å…³çš„ä»£ç )ï¼›
*   å¯¹äº Next.jsï¼Œä½ å¯ä»¥ç”¨ react-native-web æŸ¥çœ‹ä»–ä»¬çš„[å®˜æ–¹ç¤ºä¾‹](https://github.com/zeit/next.js/tree/master/examples/with-react-native-web)
*   å¯¹äºåŸç”Ÿ windowsï¼Œå¯ä»¥å°è¯•[react-native-windows](https://github.com/Microsoft/react-native-windows)ï¼›
*   å¯¹äºåŸç”Ÿ macOSï¼Œä½ å¯ä»¥ä½¿ç”¨æ–°çš„è‹¹æœé¡¹ç›® Catalystï¼Œä½†å¯¹å®ƒçš„æ”¯æŒè¿˜ä¸æ˜¯ 100%([è§æˆ‘çš„æ¨æ–‡](https://twitter.com/brunolemos/status/1185636022346043392?s=20))ï¼›
*   è¦å®‰è£…æ–°çš„ä¾èµ–é¡¹ï¼Œè¯·ä½¿ç”¨æ ¹ç›®å½•ä¸­çš„å‘½ä»¤`yarn workspace components add xxx`ã€‚è¦ä»åŒ…ä¸­è¿è¡Œè„šæœ¬ï¼Œä¾‹å¦‚è¿è¡Œ`yarn workspace web start`ï¼›è¦è¿è¡Œæ‰€æœ‰åŒ…ä¸­çš„è„šæœ¬ï¼Œè¿è¡Œ`yarn workspaces run scriptname`ï¼›

æ„Ÿè°¢é˜…è¯»ï¼ğŸ’™

å¦‚æœä½ å–œæ¬¢ reactï¼Œå¯ä»¥è€ƒè™‘åœ¨ Dev.to å’Œ Twitter ä¸Šå…³æ³¨æˆ‘ã€‚

* * *

#### [](#links)é“¾æ¥

*   æºä»£ç :[react-native-we b-mono repo](https://github.com/brunolemos/react-native-web-monorepo)
*   DevHub: [devhubapp/devhub](http://github.com/devhubapp/devhub) (ä½¿ç”¨æ­¤ç»“æ„çš„ç”Ÿäº§åº”ç”¨+æ¡Œé¢+ç±»å‹è„šæœ¬)
*   æ¨ç‰¹:[@å¸ƒé²è¯ºå‹’è«æ–¯](https://twitter.com/brunolemos)