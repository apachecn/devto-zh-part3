# ç”¨äº Microsoft SQL Server çš„ Spring Data R2DBC

> åŸæ–‡:[https://dev . to/lankydandev/spring-data-r2dbc-for-Microsoft-SQL-server-1084](https://dev.to/lankydandev/spring-data-r2dbc-for-microsoft-sql-server-1084)

è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å†™çš„å¦ä¸€ç¯‡åšæ–‡çš„å…„å¼Ÿï¼Œè¿™ç¯‡åšæ–‡å…³æ³¨çš„æ˜¯ [Spring æ•°æ® R2DBC å’Œ Postgres](https://lankydan.dev/2019/02/16/asynchronous-rdbms-access-with-spring-data-r2dbc) ã€‚å¸Œæœ›ä½ åœ¨è¿›å…¥è¿™ä¸€é¡µä¹‹å‰å·²ç»é˜…è¯»äº†æ ‡é¢˜ã€‚æ‰€ä»¥ï¼Œä½ åº”è¯¥çŸ¥é“æˆ‘å°†è¦å†™çš„æ˜¯ Spring Data R2DBC ä¸ Microsoft SQL Server çš„é›†æˆã€‚ç”±äº Spring æä¾›äº†å¾ˆå¤šç¥å¥‡çš„ğŸ§™â€â™€ï¸ï¼Œæˆ‘ä¹‹å‰çš„ [Postgres å¸–å­](https://lankydan.dev/2019/02/16/asynchronous-rdbms-access-with-spring-data-r2dbc)ä¸­çš„å¤§éƒ¨åˆ†ä»£ç ä»ç„¶å¯ä»¥å·¥ä½œï¼Œåªéœ€è¦åšä¸€äº›ä¿®æ”¹å°±å¯ä»¥ä½¿ç”¨ MSSQL äº†ã€‚

è¦äº†è§£æ›´å¤šçš„èƒŒæ™¯ä¿¡æ¯ï¼Œæˆ‘æ¨èé˜…è¯»è¿™ç¯‡æ–‡ç« çš„ [Postgres ç‰ˆæœ¬](https://lankydan.dev/2019/02/16/asynchronous-rdbms-access-with-spring-data-r2dbc)ï¼Œå› ä¸ºæˆ‘ä¸æƒ³é‡å¤å¤ªå¤šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹é¢æ˜¯å®ƒçš„ä»‹ç»ï¼Œåº”è¯¥ä¸ºæˆ‘ä»¬ç»§ç»­æä¾›è¶³å¤Ÿçš„èƒŒæ™¯ã€‚æˆ‘å°†é€šè¿‡æä¾› MSSQL å®ç°çš„ç®€è¦è¯´æ˜æ¥ä¿æŒè¿™ç¯‡æ–‡ç« çš„ç®€çŸ­ã€‚

> ä¸ä¹…å‰ï¼Œå‘å¸ƒäº† JDBC é©±åŠ¨ç¨‹åºçš„ååº”å¼å˜ä½“ã€‚è¢«ç§°ä¸º R2DBCã€‚å®ƒå…è®¸æ•°æ®å¼‚æ­¥ä¼ è¾“åˆ°ä»»ä½•è®¢é˜…å®ƒçš„ç«¯ç‚¹ã€‚å°† R2DBC è¿™æ ·çš„ååº”å¼é©±åŠ¨ç¨‹åºä¸ Spring WebFlux ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥è®©æ‚¨ç¼–å†™ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¨‹åºæ¥å¼‚æ­¥å¤„ç†æ•°æ®çš„æ¥æ”¶å’Œå‘é€ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å…³æ³¨æ•°æ®åº“ã€‚ä»è¿æ¥åˆ°æ•°æ®åº“ï¼Œç„¶åæœ€ç»ˆä¿å­˜å’Œæ£€ç´¢æ•°æ®ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Spring æ•°æ®ã€‚ä¸æ‰€æœ‰ Spring æ•°æ®æ¨¡å—ä¸€æ ·ï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†å¼€ç®±å³ç”¨çš„é…ç½®ã€‚å‡å°‘äº†æˆ‘ä»¬ä¸ºè®¾ç½®åº”ç”¨ç¨‹åºè€Œéœ€è¦ç¼–å†™çš„æ ·æ¿ä»£ç çš„æ•°é‡ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå®ƒåœ¨æ•°æ®åº“é©±åŠ¨ç¨‹åºä¸Šæä¾›äº†ä¸€ä¸ªå±‚ï¼Œä½¿ç®€å•çš„ä»»åŠ¡å˜å¾—æ›´å®¹æ˜“ï¼Œæ›´å›°éš¾çš„ä»»åŠ¡å˜å¾—ä¸é‚£ä¹ˆç—›è‹¦ã€‚

## [](#dependencies)ä¾èµ–å…³ç³»

```
<dependencies>
  <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter</artifactId>
  </dependency>
  <dependency>
    <groupId>org.springframework.data</groupId>
    <artifactId>spring-data-r2dbc</artifactId>
    <version>1.0.0.M1</version>
  </dependency>
  <dependency>
    <groupId>io.r2dbc</groupId>
    <artifactId>r2dbc-mssql</artifactId>
    <version>1.0.0.M7</version>
  </dependency>
  <dependency>
    <groupId>io.projectreactor</groupId>
    <artifactId>reactor-core</artifactId>
  </dependency>
</dependencies>

<repositories>
  <repository>
    <id>repository.spring.milestone</id>
    <name>Spring Milestone Repository</name>
    <url>http://repo.spring.io/milestone</url>
  </repository>
</repositories> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™äº›ä¾èµ–æ˜¯è¿™ç¯‡æ–‡ç« æœ€èµ·ç çš„è¦æ±‚ã€‚ç”±`spring-data-r2dbc`å’Œ`r2dbc-mssql`åšæ‰€æœ‰çš„é‡æ´»ã€‚æ ¹æ®æ‚¨æƒ³è¦ä½¿ç”¨çš„æ•°æ®åº“ï¼Œ`r2dbc-mssql`å¯ä»¥åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæœ‰ R2DBC é©±åŠ¨ç¨‹åºçš„æ•°æ®åº“(ä¾‹å¦‚`r2dbc-postgresql`)ã€‚

## [](#connecting-to-the-database)è¿æ¥æ•°æ®åº“

æ˜¥å¤©åœ¨è¿™é‡Œæ”¯æŒä½ ï¼ŒğŸ¦¸â€â™€ï¸.å®ƒå…è®¸ä½ é€šè¿‡æ‰©å±•`AbstractR2dbcConfiguration`å’Œå®ç°ä¸€ä¸ª`ConnectionFactory` bean:
æ¥è·å¾—æ‰€æœ‰çš„åŸºæœ¬è®¾ç½®

```
@Configuration
@EnableR2dbcRepositories
class DatabaseConfiguration(
  @Value("\${spring.data.mssql.host}") private val host: String,
  @Value("\${spring.data.mssql.port}") private val port: Int,
  @Value("\${spring.data.mssql.database}") private val database: String,
  @Value("\${spring.data.mssql.username}") private val username: String,
  @Value("\${spring.data.mssql.password}") private val password: String
) : AbstractR2dbcConfiguration() {

  override fun connectionFactory(): ConnectionFactory {
    return MssqlConnectionFactory(
      MssqlConnectionConfiguration.builder()
        .host(host)
        .port(port)
        .database(database)
        .username(username)
        .password(password).build()
    )
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨éœ€è¦å®ç°çš„æƒŸä¸€ bean æ˜¯`ConnectionFactory`ï¼Œå®ƒåŒ…å«(é¡¾åæ€ä¹‰)å…³äºæ•°æ®åº“è¿æ¥çš„ç»†èŠ‚ã€‚è¿™ä¸ª bean æ˜¯`DatabaseClient`çš„ä¸€ä¸ªç»„ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„ç±»ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ Spring Data R2DBC æ¨¡å—ä¸­æ‰§è¡Œ SQL çš„æ ¸å¿ƒã€‚æ„å»º`DatabaseClient`çš„å…¶ä½™ beans æ˜¯åœ¨`AbstractR2dbcConfiguration`å†…éƒ¨åˆ›å»ºçš„ï¼Œå¹¶æä¾›ç»™å®¢æˆ·ç«¯ã€‚è®©æ˜¥å¤©æ¥æŒèˆµğŸ™ŒğŸš—ä½ ä¼šæ²¡äº‹çš„ã€‚è¯´çœŸçš„ï¼Œæ‰©å±•`AbstractR2dbcConfiguration`å¹¶å®ç°`connectionFactory`å°†ä¼šè®©ä½ çš„åº”ç”¨ç¨‹åºå¿«é€Ÿå¯åŠ¨å¹¶è¿è¡Œã€‚

æœ€åï¼Œ`@EnableR2dbcRepositories`æ³¨é‡ŠæŒ‡ç¤º Spring å¯»æ‰¾ä»»ä½•æ‰©å±• Spring çš„å­˜å‚¨åº“æ¥å£çš„å­˜å‚¨åº“æ¥å£ã€‚è¿™è¢«ç”¨ä½œæ£€æµ‹ Spring æ•°æ®ä»“åº“çš„åŸºæœ¬æ¥å£ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å¯¹æ­¤è¿›è¡Œæ›´æ·±å…¥çš„æ¢è®¨ã€‚

## [](#creating-a-spring-data-repository)åˆ›å»º Spring æ•°æ®ä»“åº“

R2DBC ç›®å‰ä¸æ”¯æŒæŸ¥è¯¢çš„æ¨æ–­ï¼Œè¿™æ˜¯æˆ‘ä¹ æƒ¯äºæä¾›ç»™æˆ‘çš„æ•°æ®çš„ä¾¿åˆ©ç‰¹æ€§ä¹‹ä¸€ã€‚è™½ç„¶å®ƒä¸¢å¤±äº†ï¼Œä½†ç”Ÿå‘½å¯ä»¥ç»§ç»­ï¼Œä½†è¿™ä¸€æ¬¡å®ƒå°†éœ€è¦å¤šä¸€ç‚¹ç‚¹ä»£ç æ¥å®Œæˆå®ƒ:

```
@Repository
interface PersonRepository : R2dbcRepository<Person, Int> {

  @Query("SELECT * FROM people WHERE name = @name")
  fun findAllByName(name: String): Flux<Person>

  @Query("SELECT * FROM people WHERE age = @age")
  fun findAllByAge(age: Int): Flux<Person>
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€šè¿‡æ‰©å±•`R2DBCRepository`ï¼ŒSpring å°†è·å–è¿™äº›æŸ¥è¯¢å¹¶å¯¹å®ƒä»¬è¿›è¡Œæ£€æµ‹ï¼ŒåŒæ—¶ä¸ºæ‚¨æä¾›ä¸€äº›å…¸å‹çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚`findByAllId`ã€‚è¿™å°±æ˜¯å‰é¢æ·»åŠ çš„`@EnableR2dbcRepositories`æ³¨é‡Šå‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ³¨é‡Šï¼Œé‚£ä¹ˆè¿™ä¸ªå­˜å‚¨åº“å°†ä¸ä¼šä¸ºæ‚¨åšä»»ä½•äº‹æƒ…ï¼Œè€Œæ˜¯éœ€è¦ä¸€ä¸ªå®Œå…¨æ‰‹å·¥çš„å®ç°ã€‚

`@Query`ç”¨äºå®šä¹‰å‡½æ•°å°†æä¾›çš„æŸ¥è¯¢ï¼ŒSpring æœ¬èº«æä¾›äº†å®ç°ã€‚ä¼ é€’ç»™æŸ¥è¯¢çš„è¾“å…¥ä½¿ç”¨`@<parameter_name>`çš„æ ¼å¼å®šä¹‰ã€‚

ä»è¿™äº›å‡½æ•°è¿”å›çš„`Flux`å¯¹è±¡åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ª`List`çš„ååº”ç‰ˆæœ¬ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä»¬è¿”å›å¤šä¸ªå€¼ã€‚ä¸€æ—¦åˆ›å»ºäº†`Flux`,åªè¦æ‚¨è®¢é˜…äº†å®ƒï¼Œè¿™äº›å€¼å°±ä¼šåœ¨åˆ°è¾¾æ—¶è¢«è¿”å›å’Œå¤„ç†ã€‚

## [](#the-entity)å®ä½“

å°½ç®¡ Spring Data R2DBC çš„ç›®æ ‡ä¸æ˜¯æˆä¸ºä¸€ä¸ªå®Œå…¨æˆç†Ÿçš„ ORMï¼Œä½†å®ƒä»ç„¶æä¾›äº†å®ä½“æ˜ å°„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…¶å®ä¸éœ€è¦å¤ªå¤šè§£é‡Šçš„å®ä½“ç±»:

```
@Table("people")
data class Person(
  @Id val id: Int? = null,
  val name: String,
  val age: Int
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘è¯´è¿™ä¸éœ€è¦å¤ªå¤šçš„è§£é‡Šï¼Œæ‰€ä»¥è®©æˆ‘è¯´æ˜è¿™ä¸€ç‚¹ã€‚`id`å·²è¢«è®¾ç½®ä¸ºå¯ç©ºï¼Œå¹¶å…·æœ‰é»˜è®¤å€¼`null`ï¼Œä»¥å…è®¸ Postgres è‡ªå·±ç”Ÿæˆä¸‹ä¸€ä¸ªåˆé€‚çš„å€¼ã€‚å¦‚æœè¿™ä¸å¯ä¸ºç©ºï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ª`id`å€¼ï¼Œé‚£ä¹ˆ Spring å®é™…ä¸Šä¼šåœ¨ä¿å­˜æ—¶å°è¯•è¿è¡Œæ›´æ–°ï¼Œè€Œä¸æ˜¯æ’å…¥ã€‚æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æˆ‘è®¤ä¸ºè¿™å·²ç»è¶³å¤Ÿå¥½äº†ã€‚è€å®è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªç§‘ç‰¹æ—ç‰¹æœ‰çš„é—®é¢˜ã€‚å¦‚æœä½ ç”¨çš„æ˜¯ Javaï¼Œé‚£å°±æ”¾æ¾ç‚¹ï¼Œä½ å°±ä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªäº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¥åˆ°å…‰çš„ä¸€é¢ï¼Œåœ¨ç§‘ç‰¹æ—ç¼–ç¨‹ï¼Œå¦‚æœä½ è¿™æ ·åšï¼Œä½ æ‰€æœ‰çš„æ¢¦æƒ³éƒ½ä¼šå®ç°(æˆ‘ä¸èƒ½ä¿è¯é‚£çœŸçš„ä¼šå‘ç”ŸğŸ¤¦â€â™‚ï¸).

è¯¥å®ä½“å°†æ˜ å°„åˆ°ä¸‹é¢å®šä¹‰çš„`people`è¡¨:

```
CREATE TABLE people (
  id INT NOT NULL IDENTITY PRIMARY KEY,
  name VARCHAR(75) NOT NULL,
  age INTEGER NOT NULL
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#seeing-it-all-in-action)åœ¨è¡ŒåŠ¨ä¸­çœ‹åˆ°ä¸€åˆ‡

æ‰€æœ‰çš„è®¾ç½®éƒ½å·²ç»å®Œæˆï¼Œä¸‹é¢çš„`Application`ç±»åˆ©ç”¨äº†ä¹‹å‰ç¼–å†™çš„æŸ¥è¯¢ä»¥åŠ Spring Data æä¾›çš„ä¸€äº›ç°æˆçš„æŸ¥è¯¢ã€‚

```
@SpringBootApplication
class Application : CommandLineRunner {

  @Autowired
  private lateinit var personRepository: PersonRepository

  override fun run(vararg args: String?) {
    personRepository.saveAll(
      listOf(
        Person(name = "Dan Newton", age = 25),
        Person(name = "Laura So", age = 23)
      )
    ).log().subscribe()
    personRepository.findAll().subscribe { log.info("findAll - $it") }
    personRepository.findAllById(Mono.just(1)).subscribe { log.info("findAllById - $it") }
    personRepository.findAllByName("Laura So").subscribe { log.info("findAllByName - $it") }
    personRepository.findAllByAge(25).subscribe { log.info("findAllByAge - $it") }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™æ®µä»£ç çš„å®é™…å®ç°ä¸­ï¼Œæ·»åŠ äº†ä¸€äº›`sleep`æ¥ç¡®ä¿ååº”å¼ä»£ç æœ‰æœºä¼šå·¥ä½œã€‚ååº”å¼åº”ç”¨ç¨‹åºæ„å‘³ç€å¼‚æ­¥åšäº‹ï¼Œå› æ­¤è¯¥åº”ç”¨ç¨‹åºå°†åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¤„ç†å‡½æ•°è°ƒç”¨ã€‚å¦‚æœä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œè¿™äº›å¼‚æ­¥è¿›ç¨‹å¯èƒ½æ°¸è¿œä¸ä¼šå®Œå…¨æ‰§è¡Œã€‚ä¸ºäº†ä¿æŒæ•´æ´ï¼Œæˆ‘å·²ç»ä»ç¤ºä¾‹ä¸­åˆ é™¤äº†`sleep`ã€‚

è¿è¡Œä¸Šé¢ä»£ç çš„è¾“å‡ºç±»ä¼¼äºä¸‹é¢çš„å†…å®¹:

```
2019-05-06 18:05:04.766 INFO 23225 --- [main] reactor.Flux.ConcatMap.1 : onSubscribe(FluxConcatMap.ConcatMapImmediate)
2019-05-06 18:05:04.767 INFO 23225 --- [main] reactor.Flux.ConcatMap.1 : request(unbounded)
2019-05-06 18:05:15.451 INFO 23225 --- [actor-tcp-nio-1] reactor.Flux.ConcatMap.1 : onNext(Person(id=1, name=Dan Newton, age=25))
2019-05-06 18:05:20.533 INFO 23225 --- [actor-tcp-nio-1] reactor.Flux.ConcatMap.1 : onNext(Person(id=2, name=Laura So, age=23))
2019-05-06 18:05:20.533 INFO 23225 --- [actor-tcp-nio-1] reactor.Flux.ConcatMap.1 : onComplete()
2019-05-06 18:05:25.550 INFO 23225 --- [actor-tcp-nio-2] com.lankydanblog.tutorial.Application : findAll - Person(id=1, name=Dan Newton, age=25)
2019-05-06 18:05:25.550 INFO 23225 --- [actor-tcp-nio-2] com.lankydanblog.tutorial.Application : findAll - Person(id=2, name=Laura So, age=23)
2019-05-06 18:05:30.554 INFO 23225 --- [actor-tcp-nio-3] com.lankydanblog.tutorial.Application : findAllById - Person(id=1, name=Dan Newton, age=25)
2019-05-06 18:05:35.582 INFO 23225 --- [actor-tcp-nio-4] com.lankydanblog.tutorial.Application : findAllByName - Person(id=2, name=Laura So, age=23)
2019-05-06 18:05:40.587 INFO 23225 --- [actor-tcp-nio-5] com.lankydanblog.tutorial.Application : findAllByAge - Person(id=1, name=Dan Newton, age=25) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œè¦å¸¦èµ°ä¸€äº›ä¸œè¥¿:

*   `onSubscribe`å’Œ`request`å‡ºç°åœ¨è°ƒç”¨`Flux`çš„ä¸»çº¿ç¨‹ä¸Šã€‚åªæœ‰`saveAll`è¾“å‡ºè¿™ä¸ªï¼Œå› ä¸ºå®ƒåŒ…å«äº†`log`åŠŸèƒ½ã€‚å°†å®ƒæ·»åŠ åˆ°å…¶ä»–è°ƒç”¨ä¸­ä¼šå¯¼è‡´è®°å½•åˆ°ä¸»çº¿ç¨‹çš„ç›¸åŒç»“æœã€‚
*   åŒ…å«åœ¨`subscribe`å‡½æ•°ä¸­çš„æ‰§è¡Œå’Œ`Flux`çš„å†…éƒ¨æ­¥éª¤åœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šè¿è¡Œã€‚

è¿™ä¸æ‚¨å°†å¦‚ä½•åœ¨ç”Ÿäº§åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ååº”æµçš„çœŸå®è¡¨ç°ç›¸å»ç”šè¿œï¼Œä½†å¸Œæœ›æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å®ƒä»¬ï¼Œå¹¶æä¾›ä¸€äº›å…³äºå®ƒä»¬å¦‚ä½•æ‰§è¡Œçš„è§è§£ã€‚

## [](#dooncomplete)doOnComplete()

æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªä½¿ç”¨`Flux`å‡½æ•°åç§°çš„å·§å¦™åŒå…³è¯­ğŸ¤£ğŸ˜’ğŸ¤¦â€â™€ï¸.

æˆ‘ä»¬å·²ç»ç»“æŸäº†è¿™ç¯‡ç®€çŸ­çš„æ–‡ç« ã€‚æˆ‘æ²¡æœ‰è§£é‡Šå¤ªå¤šï¼Œå› ä¸ºæˆ‘çš„ [Postgres](https://lankydan.dev/2019/02/16/asynchronous-rdbms-access-with-spring-data-r2dbc) ç‰ˆæœ¬åšäº†æ‰€æœ‰è¿™äº›ï¼Œæˆ‘æ‡’å¾—é‡å†™ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿæ˜¯å› ä¸º Spring Data æä¾›äº†ä¸€ä¸ªé€šç”¨æ¥å£ï¼Œå®ƒå°†ä¸ºæ‚¨é“ºå¹³å¤§éƒ¨åˆ†é“è·¯ã€‚ç•™ç»™ä½ çš„åªæœ‰ä½ è‡ªå·±éœ€è¦åšçš„å‡ ä¸ªæ­¥éª¤ã€‚é¦–å…ˆï¼Œå†³å®šä½¿ç”¨å“ªä¸ªæ•°æ®åº“ï¼Œæ˜¯ Postgresã€H2ã€å¾®è½¯ SQL Server(å¦‚æœ¬æ–‡æ‰€ç¤º)è¿˜æ˜¯å°†æ¥æœ‰ R2DBC é©±åŠ¨çš„å…¶ä»–æ•°æ®åº“ã€‚æœ€åï¼Œåœ¨ä»£ç æ–¹é¢ï¼Œè®¾ç½®`ConnectionFactory`å’Œå­˜å‚¨åº“æŸ¥è¯¢ï¼Œå®ƒä»¬åœ¨æ•°æ®åº“ä¹‹é—´ä¼šç•¥æœ‰ä¸åŒã€‚æˆ‘å¯èƒ½åº”è¯¥æåˆ°è¿™æ ·ä¸€ä¸ªäº‹å®ï¼ŒR2DBC ä½¿æ‚¨èƒ½å¤Ÿè½¬å‘æ›´å…·ååº”æ€§çš„åº”ç”¨ç¨‹åºã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œè¿™ä¸ªå¸–å­æ¯•ç«Ÿæ˜¯å…³äº R2DBC çš„ğŸ¤·â€â™€ï¸.åˆ©ç”¨å¸¦æœ‰ R2DBC é©±åŠ¨ç¨‹åºå’Œ Spring æ¨¡å—çš„æ•°æ®åº“å°†å…è®¸æ‚¨æ„å»ºä¸€ä¸ªå®Œå…¨ååº”å¼çš„åº”ç”¨ç¨‹åºã€‚ä»åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒ(æ•°æ®åº“)åˆ°å‘å¤–éƒ¨å®¢æˆ·ç«¯å…¬å¼€çš„è¾¹ç¼˜å’Œç«¯ç‚¹ã€‚Spring å¯¹ååº”å¼åº”ç”¨ç¨‹åºçš„æ¨åŠ¨ä»¥åŠå³å°†åˆ°æ¥çš„ R2DBC é©±åŠ¨ç¨‹åºçš„æ”¹è¿›ï¼Œå°†ä½¿è¿™ç§è½¬æ¢(å¦‚æœé€‚åˆæ‚¨çš„ä¸šåŠ¡)ä¸é‚£ä¹ˆç—›è‹¦ï¼Œå®ç°èµ·æ¥æ›´å¿«ã€‚

è¿™ç¯‡æ–‡ç« ä¸­ä½¿ç”¨çš„ä»£ç å¯ä»¥åœ¨æˆ‘çš„ [GitHub](https://github.com/lankydan/spring-data-r2dbc/tree/mssql_r2dbc) ä¸Šæ‰¾åˆ°ã€‚

å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¾ˆæœ‰å¸®åŠ©ï¼Œä½ å¯ä»¥åœ¨ Twitter ä¸Šå…³æ³¨æˆ‘ï¼Œåœ°å€æ˜¯ [@LankyDanDev](https://twitter.com/LankyDanDev) æ¥äº†è§£æˆ‘çš„æ–°æ–‡ç« ã€‚