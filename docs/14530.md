# è®©æˆ‘ä»¬æ„å»º:ç”¨ Ruby on Rails-dribble å…‹éš†

> åŸæ–‡:[https://dev.to/justalever/lets-build-with-ruby-on-rails-å¾·ç‘å¸ƒå°”-å…‹éš†- 1n7i](https://dev.to/justalever/lets-build-with-ruby-on-rails---dribbble-clone--1n7i)

æ¬¢è¿é˜…è¯»ç”±äº”éƒ¨åˆ†ç»„æˆçš„â€œè®©æˆ‘ä»¬ä¸€èµ·æ„å»º:ç”¨ Ruby on Railsâ€ç³»åˆ—ï¼Œåœ¨è¿™ä¸ªç³»åˆ—ä¸­ï¼Œæˆ‘å°†æ•™æ‚¨å¦‚ä½•ç”¨ Ruby on Rails æ„å»ºä¸€ä¸ª Dribbble å…‹éš†ã€‚è¿™ä¸ªç³»åˆ—æ˜¯æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢æœ€å½»åº•çš„æ„å»ºï¼

Dribbble æ˜¯ä¸€ä¸ªæ´»è·ƒçš„è®¾è®¡ç¤¾åŒºï¼Œå„ç§å„æ ·çš„è®¾è®¡å¸ˆåœ¨è¿™é‡Œå‘å¸ƒä»–ä»¬æ­£åœ¨åšçš„ä»»ä½•äº‹æƒ…çš„â€œç…§ç‰‡â€ã€‚åŸæœ¬æ‰“ç®—æˆä¸ºâ€œå±•ç¤ºä½ çš„è¿›æ­¥â€ç±»å‹çš„ç½‘ç«™ï¼Œç°åœ¨å·²ç»å˜æˆäº†ä¸€ä¸ªé¢å‘æœªæ¥çš„è®¾è®¡å¸ˆå’Œç»éªŒä¸°å¯Œçš„ä¸“ä¸šäººå£«çš„æŠ•èµ„ç»„åˆã€‚(æˆ‘ç°åœ¨ç¢°å·§åœ¨è¿™é‡Œå·¥ä½œğŸ’ƒ)

æˆ‘ä»¬çš„å…‹éš†ç‰ˆå°†å¼•å…¥ä¸€äº›æ–°æ¦‚å¿µï¼Œä»¥åŠæˆ‘åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­æåˆ°çš„å…¶ä»–æ¦‚å¿µã€‚å¦‚æœæ‚¨åˆšåˆšæ¥è§¦ Ruby on Railsï¼Œæˆ‘é‚€è¯·æ‚¨çœ‹çœ‹æˆ‘ä¸‹é¢çš„å…¶ä»–ç³»åˆ—æ–‡ç« ï¼Œäº†è§£æ¡†æ¶èƒŒåçš„ä¸€äº›åŸºæœ¬åŸåˆ™ã€‚

*   [Ruby on Rails ç®€ä»‹](https://web-crunch.com/lets-build-with-ruby-on-rails-introduction/)
*   [åœ¨ä½ çš„æœºå™¨ä¸Šå®‰è£… Ruby on Rails](https://web-crunch.com/lets-build-with-ruby-on-rails-installation/)
*   [ä½¿ç”¨ Ruby on Rails åˆ›å»ºä¸€ä¸ªå¸¦æœ‰è¯„è®ºçš„åŸºæœ¬åšå®¢](https://web-crunch.com/lets-build-with-ruby-on-rails-blog-with-comments/)
*   [ç”¨ Ruby on Rails æ„å»ºä¸€ä¸ª Twitter å…‹éš†](https://web-crunch.com/lets-build-with-ruby-on-rails-a-twitter-clone/)

### [](#what-we-will-be-building-in-depth)æˆ‘ä»¬å°†æ·±å…¥æ„å»ºä»€ä¹ˆ

æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†å…·æœ‰ä»¥ä¸‹åŠŸèƒ½:

*   åˆ›å»ºã€ç¼–è¾‘å’Œé”€æ¯â€œé•œå¤´â€ä»¥åŠå–œæ¬¢å’Œä¸å–œæ¬¢å•ä¸ªé•œå¤´çš„èƒ½åŠ›ã€‚
*   ç”¨æˆ·è§’è‰²å’Œèº«ä»½éªŒè¯
*   æ‹–æ”¾åŠŸèƒ½
*   è¯„è®ºåŠŸèƒ½
*   æŸ¥çœ‹è®¡æ•°/åˆ†æ
*   ä½¿ç”¨ CSS ç½‘æ ¼çš„è‡ªå®šä¹‰å“åº”å¿«ç…§ç½‘æ ¼ç”¨æˆ·ç•Œé¢

åœ¨è¿™ä¸ªç‰ˆæœ¬çš„å¼•æ“ç›–ä¸‹æœ‰å¾ˆå¤šä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘åœ¨ Github ä¸Šåˆ›å»ºäº†ä¸€ä¸ªå…¬å…±å›è´­ï¼Œä¾›ä½ è·Ÿéš/å‚è€ƒã€‚ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œä½ ä¼šæ³¨æ„åˆ°åœ¨ä¸‹é¢çš„ä¸€äº›è§†é¢‘ä¸­ï¼Œæˆ‘å¤åˆ¶å¹¶ç²˜è´´äº†ä¸€äº›é€šç”¨çš„æ ·å¼å’Œæ ‡è®°

#### [](#download-the-source-code)ä¸‹è½½æºä»£ç 

## ![GitHub logo](../Images/292a238c61c5611a7f4d07a21d9e8e0a.png)[just alever](https://github.com/justalever)/[dribbble _ clone](https://github.com/justalever/dribbble_clone)

### å¦‚ä½•ä½¿ç”¨ Ruby on Rails æ„å»ºä¸€ä¸ªå¯æ»´å…‹éš†çš„æ¼”ç¤º

<article class="markdown-body entry-content container-lg" itemprop="text">

# è®©æˆ‘ä»¬ç”¨ Ruby on Rails æ„å»ºä¸€ä¸ª Dribbble å…‹éš†

[![Let's Build A Dribbble Clone](../Images/f7ef591aa448c79ededa3e6411bfeb84.png)T2ã€‘](https://camo.githubusercontent.com/68d07755833451cc7078e6421c1e95308d735a66c0329d80f416ab5fe6324f93/68747470733a2f2f692e696d6775722e636f6d2f6947626b3831692e6a7067)

æ¬¢è¿æ¥åˆ°è¿™ä¸ªç”±äº”éƒ¨åˆ†ç»„æˆçš„è¿·ä½ ç³»åˆ—ï¼Œåœ¨è¿™é‡Œæˆ‘å°†æ•™ä½ å¦‚ä½•ç”¨ Ruby on Rails æ„å»ºä¸€ä¸ªå¯æ»´å…‹éš†ã€‚è¿™ä¸ªç³»åˆ—æ˜¯æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢æœ€å½»åº•çš„æ„å»ºï¼

Dribbble æ˜¯ä¸€ä¸ªæ´»è·ƒçš„è®¾è®¡ç¤¾åŒºï¼Œå„ç§å„æ ·çš„è®¾è®¡å¸ˆåœ¨è¿™é‡Œå‘å¸ƒä»–ä»¬æ­£åœ¨åšçš„ä»»ä½•äº‹æƒ…çš„â€œç…§ç‰‡â€ã€‚åŸæœ¬æ‰“ç®—æˆä¸ºâ€œå±•ç¤ºä½ çš„è¿›æ­¥â€ç±»å‹çš„ç½‘ç«™ï¼Œç°åœ¨å·²ç»å˜æˆäº†ä¸€ä¸ªé¢å‘æœªæ¥çš„è®¾è®¡å¸ˆå’Œç»éªŒä¸°å¯Œçš„ä¸“ä¸šäººå£«çš„æŠ•èµ„ç»„åˆã€‚

æˆ‘ä»¬çš„ Dribbble å…‹éš†å°†å¼•å…¥ä¸€äº›æ–°æ¦‚å¿µï¼Œä»¥åŠæˆ‘åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­æåˆ°çš„å…¶ä»–æ¦‚å¿µã€‚å¦‚æœæ‚¨åˆšåˆšæ¥è§¦ Ruby on Railsï¼Œæˆ‘é‚€è¯·æ‚¨çœ‹çœ‹æˆ‘ä¸‹é¢çš„å…¶ä»–ç³»åˆ—æ–‡ç« ï¼Œäº†è§£æ¡†æ¶èƒŒåçš„ä¸€äº›åŸºæœ¬åŸåˆ™ã€‚

*   [Ruby on Rails ç®€ä»‹](https://web-crunch.com/lets-build-with-ruby-on-rails-introduction/)
*   [åœ¨ä½ çš„æœºå™¨ä¸Šå®‰è£… Ruby on Rails](https://web-crunch.com/lets-build-with-ruby-on-rails-installation/)
*   [é€ ä¸€ä¸ª](https://web-crunch.com/lets-build-with-ruby-on-rails-blog-with-comments/) â€¦

</article>

[View on GitHub](https://github.com/justalever/dribbble_clone)

### [](#what-wont-be-featured-in-the-build)ä»€ä¹ˆä¸ä¼šå‡ºç°åœ¨æ„å»ºä¸­

*   ç‹¬ç«‹ç”¨æˆ·é…ç½®æ–‡ä»¶
*   æœç´¢
*   ç£¨å°–
*   åƒ Dribbble ç›®å‰æ‰€åšçš„é‚£æ ·è‡ªå®šä¹‰è°ƒè‰²æ¿ç”Ÿæˆã€‚
*   ä¸€å¤§å †å…¶ä»–å¾ˆé…·çš„åŠŸèƒ½

æˆ‘ä»¬å¯ä»¥åšå¾ˆå¤šäº‹æƒ…æ¥æ‰©å±•å…‹éš†ï¼Œä½†æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªâ€œç¤ºä¾‹â€ç±»å‹çš„åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥æˆ‘å†³å®šæš‚æ—¶æ”¾å¼ƒå¯¹å®ƒè¿›è¡Œå¤§å¹…æ‰©å±•ã€‚å°†æ¥ï¼Œæˆ‘å¯èƒ½ä¼šæ·»åŠ åˆ°è¿™ä¸ªç³»åˆ—ä¸­ï¼Œå¹¶è¿›ä¸€æ­¥æ‰©å±•å®ƒï¼Œä½†æˆ‘ä¸»è¦é‚€è¯·æ‚¨è‡ªå·±åšåŒæ ·çš„äº‹æƒ…ï¼Œçœ‹çœ‹æ‚¨å¦‚ä½•èƒ½å¤Ÿæ›´å¥½åœ°æ¨¡ä»¿çœŸå®çš„åº”ç”¨ç¨‹åºã€‚

### [](#watch-part-1)æ‰‹è¡¨ç¬¬ä¸€éƒ¨åˆ†

[https://www.youtube.com/embed/u3-tZMKYegg](https://www.youtube.com/embed/u3-tZMKYegg)

### [](#watch-part-2)æ‰‹è¡¨ç¬¬äºŒéƒ¨åˆ†

[https://www.youtube.com/embed/7rti-QamKlg](https://www.youtube.com/embed/7rti-QamKlg)

### [](#watch-part-3)æ‰‹è¡¨ç¬¬ä¸‰éƒ¨åˆ†

[https://www.youtube.com/embed/ywMt-R5QIHU](https://www.youtube.com/embed/ywMt-R5QIHU)

### [](#watch-part-4)æ‰‹è¡¨ç¬¬å››éƒ¨åˆ†

[https://www.youtube.com/embed/vP0lMyO59Yc](https://www.youtube.com/embed/vP0lMyO59Yc)

### [](#watch-part-5)æ‰‹è¡¨ç¬¬äº”éƒ¨åˆ†

[https://www.youtube.com/embed/LSMbwIUS558](https://www.youtube.com/embed/LSMbwIUS558)

### [](#getting-started)å…¥é—¨

å‡è®¾ä½ å·²ç»åœ¨ä½ çš„æœºå™¨ä¸Šå®‰è£…äº† rails å’Œ ruby([åœ¨è¿™é‡Œå­¦ä¹ å¦‚ä½•](https://web-crunch.com/lets-build-with-ruby-on-rails-installation/))ä½ å·²ç»å‡†å¤‡å¥½å¼€å§‹äº†ã€‚ä»æ‚¨æœ€å–œæ¬¢çš„å·¥ä½œç›®å½•ï¼Œä½¿ç”¨æ‚¨æœ€å–œæ¬¢çš„å‘½ä»¤è¡Œå·¥å…·è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
$ rails new dribbble_clone
```

è¿™å°†æ­å»ºä¸€ä¸ªæ–°çš„ rails é¡¹ç›®ï¼Œå¹¶åˆ›å»ºåä¸º`dribbble_clone`çš„æ–‡ä»¶å¤¹ã€‚

ä½œä¸ºå¼€å§‹ï¼Œæˆ‘å·²ç»å°†è¿™ä¸ªé¡¹ç›®ä¸­çš„æ‰€æœ‰å®çŸ³æ·»åŠ åˆ°æˆ‘çš„`Gemfile`ä¸­ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰æ‹¿åˆ°æˆ‘åœ¨è¿™é‡Œä½¿ç”¨çš„ç›¸åŒç‰ˆæœ¬ï¼Œä½ å¯ä»¥å‚è€ƒå›è´­åè®®ã€‚

#### [](#the-gem-list)å®çŸ³æ¸…å•

è‡ªä»ä¸Šä¸€æ¬¡å»ºé€ ä»¥æ¥ï¼Œæˆ‘ä»¬çš„å®çŸ³åˆ—è¡¨å·²ç»å¢åŠ äº†ã€‚ä½ ä¼šå‘ç°ä½ çš„åº”ç”¨ç¨‹åºè¶Šå¤§ï¼Œä½ éœ€è¦çš„å®çŸ³å°±è¶Šå¤šã€‚

*   [carrier wave](https://github.com/carrierwaveuploader/carrierwave)+[Mini Magick](https://github.com/minimagick/minimagick)-ç”¨äºå›¾åƒä¸Šä¼ å’Œä¼˜åŒ–
*   [è®¾è®¡](https://github.com/plataformatec/devise) -ç”¨æˆ·è®¤è¯å’Œè§’è‰²
*   å®ˆå«(Guard)â€”â€”åœ¨æ–‡ä»¶æ”¹å˜æ—¶å¯¹å…¶è¿›è¡Œå¤„ç†â€”â€”ç±»ä¼¼äºä»»åŠ¡è¿è¡Œè€…
*   [Guard Livereload](https://github.com/guard/guard-livereload) -å½“æ–‡ä»¶æ”¹å˜æ—¶ï¼Œç»“åˆæ‚¨æœ€å–œçˆ±çš„æµè§ˆå™¨ä¸Šçš„å®æ—¶é‡æ–°åŠ è½½æ‰©å±•ï¼Œé‡æ–°åŠ è½½æµè§ˆå™¨ã€‚
*   [æ›´å¥½çš„é”™è¯¯](https://github.com/charliesome/better_errors) -åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ›´å¥½çš„é”™è¯¯ã€‚
*   [ç®€å•å½¢å¼](https://github.com/plataformatec/simple_form)-Rails ä¸­æ›´ç®€å•çš„å½¢å¼
*   [å¸ƒå°”ç›è½¨é“](https://github.com/joshuajansen/bulma-rails) -æˆ‘æœ€è¿‘æœ€å–œæ¬¢çš„åŸºäº Flexbox çš„ CSS æ¡†æ¶ã€‚
*   å°è±¡æ´¾ç”»å®¶ -æˆ‘ä»¬ç”¨è¿™ä¸ªæ¥è·å¾—ç…§ç‰‡çš„ç‚¹å‡»ç‡
*   [Gravatar å›¾åƒæ ‡ç­¾](https://github.com/mdeering/gravatar_image_tag) -æ ¹æ®ç”¨æˆ·çš„å¸æˆ·ç”µå­é‚®ä»¶è·å–ç”¨æˆ· Gravatar å›¾åƒçš„ç®€å•æ–¹æ³•
*   [å……å½“å¯å˜](https://github.com/ryanto/acts_as_votable) -å–œæ¬¢å’Œä¸å–œæ¬¢çš„é•œå¤´

æˆ‘ä¼šå°Šé‡è§†é¢‘çš„æŒ‡å¯¼ï¼Œè®©æˆ‘ä»¬çš„é¡¹ç›®éƒ½ä¸æ¯ä¸ªå•ç‹¬çš„å®çŸ³è®¾ç½®ã€‚ç¬¬ 1 éƒ¨åˆ†çš„å¤§éƒ¨åˆ†éƒ½è‡´åŠ›äºè¿™ä¸ªè¿‡ç¨‹ã€‚æˆ‘ä»¬å®šåˆ¶è®¾è®¡ä½æ·»åŠ ä¸€ä¸ªæ–°ç”¨æˆ·æ³¨å†Œçš„â€œåç§°â€å­—æ®µã€‚å†æ¬¡å‚è€ƒå›è´­åè®®ï¼Œçœ‹çœ‹éœ€è¦ä»€ä¹ˆã€‚

## [](#scaffolding-the-shot)è„šæ‰‹æ¶çš„æ‹æ‘„

æˆ‘ä»¬å¯ä»¥æµè§ˆå¹¶ä¸ºæˆ‘ä»¬çš„é•œå¤´åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨ã€æ¨¡å‹å’Œè®¸å¤šå…¶ä»–æ–‡ä»¶ï¼Œä½†æ˜¯åˆ é™¤æˆ‘ä»¬ä¹‹åä¸éœ€è¦çš„æ–‡ä»¶ä¼šæ›´å®¹æ˜“ï¼Œä¹Ÿå¯èƒ½æ›´æœ‰æ•ˆã€‚Rails é€šè¿‡ç”Ÿæˆè¿è¡Œ scaffold å‘½ä»¤æ—¶æ‰€éœ€çš„æ‰€æœ‰å¿…è¦æ–‡ä»¶å’Œè¿ç§»æ–‡ä»¶æ¥å¸®åŠ©æˆ‘ä»¬ã€‚

è¿è¡Œä»¥ä¸‹ä»£ç æ¥ç”Ÿæˆå¸¦æœ‰æ ‡é¢˜å’Œæè¿°å±æ€§çš„`Shot`:

```
 rails g scaffold Shot title:string description:text user_id:integer
rails db:migrate 
```

### [](#associate-users-to-shots)å°†ç”¨æˆ·å…³è”åˆ°å¿«ç…§

åœ¨`app`ç›®å½•ä¸­å¯¼èˆªåˆ°æ‚¨çš„`models`æ–¹å‘ã€‚æˆ‘ä»¬éœ€è¦æŠŠç”¨æˆ·å’Œé•œå¤´è”ç³»èµ·æ¥ã€‚ä¿®æ”¹æ‚¨çš„æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨å®‰è£… Devise æ—¶å·²ç»æ·»åŠ äº†ä¸€äº›æ•°æ®ã€‚ä½ å¯èƒ½å·²ç»çœ‹åˆ°äº†ä¸€äº›è¿™æ ·çš„å…³è”ã€‚å¦åˆ™ï¼Œæ­¤æ—¶å®ƒä»¬åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

```
 # app/models/user.rb
class User < ApplicationRecord
  # Include default devise modules. Others available are:
  # :confirmable, :lockable, :timeoutable and :omniauthable
  devise :database_authenticatable, :registerable,
         :recoverable, :rememberable, :trackable, :validatable
  has_many :shots
end 
```

```
 # app/models/shot.rb
class Shot < ApplicationRecord
    belongs_to :user
end 
```

### [](#carrierwave-setup)è½½æ³¢è®¾ç½®

ä¸€å¼ ç…§ç‰‡çš„åŸºç¡€å½“ç„¶æ˜¯å®ƒçš„å›¾åƒã€‚Carrierwave æ˜¯å›¾ç‰‡ä¸Šä¼ çš„ä¸€é¢—å®çŸ³ï¼Œæœ‰ä¸€å †çš„é“ƒé“›å’Œå“¨å­ã€‚ç¡®ä¿ä½ å·²ç»å®‰è£…äº† [CarrierWave gem](https://github.com/carrierwaveuploader/carrierwave) ï¼Œç„¶åè¿è¡Œä»¥ä¸‹ç¨‹åºç”Ÿæˆä¸€ä¸ªåä¸º`user_shot_uploader.rb`çš„æ–°ä¸Šä¼ æ–‡ä»¶ã€‚ç¡®ä¿ä½ å·²ç»å®‰è£…äº†æˆ‘æåˆ°çš„[è¿·ä½ å®çŸ³](https://github.com/minimagick/minimagick)ã€‚

```
$ rails generate uploader user_shot
```

è¿™å°†ä¸ºæ‚¨æä¾›ä¸€ä¸ªæ–‡ä»¶:

`app/uploaders/user_shot_uploader.rb`

åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ä¸€äº›å…³äºè½½æ³¢å¦‚ä½•å¤„ç†æˆ‘ä»¬çš„å›¾åƒã€‚æˆ‘çš„æ¡£æ¡ˆçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ã€‚æ³¨æ„:æˆ‘å·²ç»åˆ é™¤äº†ä¸€äº›ä¸å¿…è¦çš„è¯„è®ºã€‚

```
 class UserShotUploader < CarrierWave::Uploader::Base

  # Include RMagick or MiniMagick support:
  # include CarrierWave::RMagick
  include CarrierWave::MiniMagick

  # Choose what kind of storage to use for this uploader:
  storage :file

  # Override the directory where uploaded files will be stored.
  # This is a sensible default for uploaders that are meant to be mounted:
  def store_dir
    "uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}"
  end

  # Create different versions of your uploaded files:
  version :full do
    process resize_to_fit: [800, 600]
  end
  version :thumb do
    process resize_to_fit: [400, 300]
  end

  def extension_whitelist
    %w(jpg jpeg gif png)
  end
end 
```

### [](#associating-our-user-shot-with-a-shot)å°†æˆ‘ä»¬çš„ç”¨æˆ·é•œå¤´ä¸ä¸€ä¸ªé•œå¤´å…³è”

æˆ‘ä»¬éœ€è¦æˆ‘ä»¬çš„æ–°ç”¨æˆ·æ‹æ‘„çš„å›¾åƒæ˜¯æˆ‘ä»¬çš„æ•°æ®åº“è¡¨ä¸Šçš„ä¸€ä¸ªå­—æ®µã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒæ·»åŠ ä¸ºä¸€ä¸ªè¿ç§»ï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªç±»å‹ä¸º`string`çš„`user_shot`åˆ—ã€‚

```
 $ rails g migration add_shot_to_users shot:string
$ rails db:migrate 
```

åœ¨`app/models/shot.rb`å†…çš„`shot.rb`æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œä½¿å…¶å…¨éƒ¨å·¥ä½œã€‚

```
 class Shot < ActiveRecord::Base
  belongs_to :user
  mount_uploader :user_shot, UserShotUploader # add this line
end 
```

ä¸ºäº†çœŸæ­£å…è®¸ç”¨æˆ·ä¸Šä¼ ä¸€ä¸ªé•œå¤´ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®æˆ‘ä»¬çš„æ§åˆ¶å™¨æ¥å…è®¸æ‰€æœ‰è¿™äº›æ–°å‚æ•°ã€‚

### [](#creating-a-new-shot)åˆ›å»ºæ–°é•œå¤´

æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„é•œå¤´æ§åˆ¶å™¨éœ€è¦ä¸€äº› TLC æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚é™¤äº†æ§åˆ¶å™¨ï¼Œæˆ‘è¿˜æƒ³åœ¨`new`å’Œ`edit`è§†å›¾ä¸­å¼•å…¥ä¸€äº›æ‹–æ”¾ç±»å‹çš„åŠŸèƒ½ã€‚Dribbble ä¼šè‡ªåŠ¨ä¸Šä¼ å›¾åƒï¼Œä½œä¸ºä»–ä»¬æœ€åˆæ‹æ‘„çš„ä¸€éƒ¨åˆ†ã€‚ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œæˆ‘æ¨¡ä»¿äº†è¿™ä¸€ç‚¹ï¼Œä½†å®ƒè‚¯å®šè¾¾ä¸åˆ°æ­£å¸¸å·¥ä½œçš„æ•ˆæœã€‚

åœ¨`app/controllers/`ä¸­æ‰¾åˆ°çš„`shots_controller.rb`æœ€åçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
 class ShotsController < ApplicationController
  before_action :set_shot, only: [:show, :edit, :update, :destroy, :like, :unlike]
  before_action :authenticate_user!, only: [:edit, :update, :destroy, :like, :unlike]
  impressionist actions: [:show], unique: [:impressionable_type, :impressionable_id, :session_hash]

  # GET /shots
  # GET /shots.json
  def index
    @shots = Shot.all.order('created_at DESC')
  end

  # GET /shots/1
  # GET /shots/1.json
  def show
  end

  # GET /shots/new
  def new
    @shot = current_user.shots.build
  end

  # GET /shots/1/edit
  def edit
  end

  # POST /shots
  # POST /shots.json
  def create
    @shot = current_user.shots.build(shot_params)

    respond_to do |format|
      if @shot.save
        format.html { redirect_to @shot, notice: 'Shot was successfully created.' }
        format.json { render :show, status: :created, location: @shot }
      else
        format.html { render :new }
        format.json { render json: @shot.errors, status: :unprocessable_entity }
      end
    end
  end

  # PATCH/PUT /shots/1
  # PATCH/PUT /shots/1.json
  def update
    respond_to do |format|
      if @shot.update(shot_params)
        format.html { redirect_to @shot, notice: 'Shot was successfully updated.' }
        format.json { render :show, status: :ok, location: @shot }
      else
        format.html { render :edit }
        format.json { render json: @shot.errors, status: :unprocessable_entity }
      end
    end
  end

  # DELETE /shots/1
  # DELETE /shots/1.json
  def destroy
    @shot.destroy
    respond_to do |format|
      format.html { redirect_to shots_url, notice: 'Shot was successfully destroyed.' }
      format.json { head :no_content }
    end
  end

  def like
    @shot.liked_by current_user
    respond_to do |format|
      format.html { redirect_back fallback_location: root_path }
      format.json { render layout:false }
    end
  end

  def unlike
    @shot.unliked_by current_user
    respond_to do |format|
      format.html { redirect_back fallback_location: root_path }
      format.json { render layout:false }
    end
  end

  private
    # Use callbacks to share common setup or constraints between actions.
    def set_shot
      @shot = Shot.find(params[:id])
    end

    # Never trust parameters from the scary internet, only allow the whitelist through.
    def shot_params
      params.require(:shot).permit(:title, :description, :user_shot)
    end
end 
```

`like`å’Œ`unlike`åŠ¨ä½œæ˜¯ç‰¹å®šäºæˆ‘ä»¬ä½œä¸ºå¯æŠ•ç¥¨å®çŸ³çš„è¡Œä¸ºçš„ï¼Œæˆ‘å°†å¾ˆå¿«è®¨è®ºè¿™ä¸€ç‚¹ã€‚å…³äº`shot_params`ç§æœ‰æ–¹æ³•çš„é€šçŸ¥æˆ‘ä»¬å…è®¸`app/views/_form.html.erb`å†…éƒ¨çš„å­—æ®µã€‚

### [](#adding-views-and-drag-and-drop-functionality)æ·»åŠ è§†å›¾å’Œæ‹–æ”¾åŠŸèƒ½

éƒ¨åˆ†è¡¨å•å°†è¢«é‡æ–°ç”¨äºç¼–è¾‘å’Œåˆ›å»ºæ–°é•œå¤´ã€‚æˆ‘æƒ³åˆ©ç”¨ä¸€äº›æ‹–æ”¾ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘å¼•å…¥äº†ä¸€äº› JavaScript ä»£ç ï¼Œè¿™äº›ä»£ç å¾ˆç¥å¥‡ï¼Œè®©è¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥å¾ˆæµç•…ã€‚æˆ‘ä»¬æ ¹æ®å…ƒç´ åœ¨æµè§ˆå™¨çª—å£ä¸­çš„ä½ç½®å‘å®šä¹‰çš„æ‹–æ”¾åŒºæ·»åŠ ç±»ã€‚å½“å›¾åƒè¢«æ”¾ä¸‹æ—¶ï¼Œå®ƒä¼šä½¿ç”¨å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨å†…ç½®çš„ FileReader API è‡ªåŠ¨æ˜¾ç¤ºã€‚å®ƒè¿˜å°†å…¶è·¯å¾„é™„åŠ åˆ°ä¸€ä¸ªéšè—çš„æ–‡ä»¶è¾“å…¥ä¸­ï¼Œå½“ä¸€ä¸ªæ–°çš„å¸–å­è¢«åˆ›å»ºæ—¶ï¼Œè¯¥æ–‡ä»¶è¾“å…¥å°†è¢«ä¼ é€’ç»™æˆ‘ä»¬åœ¨`shots_controller.rb`ä¸Šçš„ create æ“ä½œã€‚

å½“ä¸€åˆ‡å®Œæˆåï¼Œæˆ‘ä»¬çš„æ–°å¿«ç…§å°±åˆ›å»ºå¥½äº†ï¼Œå¹¶ä¸å½“å‰ç™»å½•çš„ç”¨æˆ·æˆ–æœ¬ä¾‹ä¸­çš„`current_user`ç›¸å…³è”ã€‚

åœ¨æˆ‘ä»¬çš„è¡¨å•åˆ†éƒ¨é‡Œé¢`app/views/_form.html.erb`æˆ‘æœ‰ä¸‹é¢çš„ä»£ç :

```
 <%= simple_form_for @shot, html: { multipart: true }  do |f| %>
  <%= f.error_notification %>
  <div class="columns is-centered">
    <div class="column is-half">

    <% unless @shot.user_shot.blank? %>
    <%= image_tag (@shot.user_shot_url), id: "previewImage" %>
    <% end %>

    <output id="list"></output>
    <div id="drop_zone">Drag your shot here</div>
    <br />

    <%= f.input :user_shot, label: false, input_html: { class: "file-input", type: "file" }, wrapper: false, label_html: { class: "file-label" } %>

    <div class="field">
      <div class="control">
        <%= f.input :title, label: "Title", input_html: { class: "input"}, wrapper: false, label_html: { class: "label" } %>
      </div>
    </div>

    <div class="field">
        <div class="control">
        <%= f.input :description, input_html: { class: "textarea"}, wrapper: false, label_html: { class: "label" } %>
      </div>
    </div>

    <div class="field">
        <div class="control">
        <%= f.button :submit, class:"button is-primary" %>
      </div>
    </div>
  </div>
</div>
<% end %> 
```

è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå¤ªç–¯ç‹‚çš„ã€‚æˆ‘ä¸ºå¸ƒå°”ç›æ·»åŠ äº†ç‰¹å®šçš„æ ‡è®°ï¼Œä»¥ä¾¿å¾ˆå¥½åœ°ä¸ SimpleForm é…åˆä½¿ç”¨ï¼Œå¹¶ä¸ºæˆ‘ä»¬çš„ JavaScript æ·»åŠ äº†ä¸€äº› HTML æ¥è¿›è¡Œäº¤äº’:

```
 <output id="list"></output>
<div id="drop_zone">Drag your shot here</div> 
```

æˆ‘ä»¬çš„é™è½åŒºæ˜¯å¥‡è¿¹å‘ç”Ÿçš„åœ°æ–¹ã€‚ç»“åˆä¸€äº› CSSï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç”¨æˆ·ä¸åŒºåŸŸäº¤äº’æ—¶è¿›è¡Œæ›´æ”¹ã€‚æ£€æŸ¥ [repo](https://github.com/justalever/dribbble_clone/blob/master/app/assets/stylesheets/application.scss) è·å–æ­¤å¤„éœ€è¦çš„ CSSã€‚

å®Œæˆæ‰€æœ‰è¿™äº›å·¥ä½œçš„ JavaScript å¯ä»¥åœ¨`app/assets/javascripts/shot.js`ä¸­æ‰¾åˆ°

```
 document.addEventListener("turbolinks:load", function() {

    var Shots = {
        previewShot() {
            if (window.File && window.FileList && window.FileReader) {

                function handleFileSelect(evt) {
                    evt.stopPropagation();
                    evt.preventDefault();

                    let files = evt.target.files || evt.dataTransfer.files; 
                    // files is a FileList of File objects. List some properties.
                    for (var i = 0, f; f = files[i]; i++) {

                        // Only process image files.
                        if (!f.type.match('image.*')) {
                            continue;
                        }
                        const reader = new FileReader();

                        // Closure to capture the file information.
                        reader.onload = (function(theFile) {
                            return function(e) {
                                // Render thumbnail.
                                let span = document.createElement('span');
                                span.innerHTML = ['<img class="thumb" src="', e.target.result,
                                    '" title="', escape(theFile.name), '"/>'
                                ].join('');
                                document.getElementById('list').insertBefore(span, null);
                            };
                        })(f);

                        // Read in the image file as a data URL.
                        reader.readAsDataURL(f);
                    }
                }

                function handleDragOver(evt) {
                    evt.stopPropagation();
                    evt.preventDefault();
                    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
                }

                // Setup the dnd listeners.
                // https://stackoverflow.com/questions/47515232/how-to-set-file-input-value-when-dropping-file-on-page
                const dropZone = document.getElementById('drop_zone');
                const target = document.documentElement;
                const fileInput = document.getElementById('shot_user_shot');
                const previewImage = document.getElementById('previewImage');
                const newShotForm = document.getElementById('new_shot');

                if (dropZone) {
                    dropZone.addEventListener('dragover', handleDragOver, false);
                    dropZone.addEventListener('drop', handleFileSelect, false);

                    // Drop zone classes itself
                    dropZone.addEventListener('dragover', (e) => {
                        dropZone.classList.add('fire');
                    }, false);

                    dropZone.addEventListener('dragleave', (e) => {
                        dropZone.classList.remove('fire');
                    }, false);

                    dropZone.addEventListener('drop', (e) => {
                        e.preventDefault();
                        dropZone.classList.remove('fire');
                        fileInput.files = e.dataTransfer.files;
                        // if on shot/id/edit hide preview image on drop
                        if (previewImage) {
                            previewImage.style.display = 'none';
                        }
                        // If on shots/new hide dropzone on drop
                        if(newShotForm) {
                            dropZone.style.display = 'none';
                        }
                    }, false);

                    // Body specific 
                    target.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        dropZone.classList.add('dragging');
                    }, false);

                    // removes dragging class to body WHEN NOT dragging
                    target.addEventListener('dragleave', (e) => {
                        dropZone.classList.remove('dragging');
                        dropZone.classList.remove('fire');
                    }, false);
                }
            }
        },
        // Displays shot title, description, and created_at time stamp on home page on hover.
        // Be sure to include jquery in application.js
        shotHover() {
            $('.shot').hover(function() {
                $(this).children('.shot-data').toggleClass('visible');
            });
        }

    };
    Shots.previewShot();
    Shots.shotHover();

});
```

æˆ‘åœ¨è§†é¢‘ä¸­å¯¹è¿™æ®µä»£ç åšäº†å®Œæ•´çš„è§£é‡Šï¼Œæ‰€ä»¥è¯·åŠ¡å¿…è§‚çœ‹ä»¥äº†è§£è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚

## [](#comments-setup)æ³¨é‡Šè®¾ç½®

è¯„è®ºæ˜¯ Dribbble ç¤¾åŒºçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æˆ‘æƒ³æŠŠè¿™äº›ä½œä¸ºç»ƒä¹ å’Œè§£é‡Šæ·»åŠ åˆ°ç»„åˆä¸­ï¼Œè¯´æ˜å¦‚ä½•å…è®¸ç”¨æˆ·ä¸ Devise ç»“åˆè¿›è¡Œäº¤äº’ä»¥åŠåˆ›å»ºã€ç¼–è¾‘å’Œé”€æ¯ä»–ä»¬è‡ªå·±çš„è¯„è®ºã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªæ§åˆ¶å™¨ã€‚è¿™é‡Œæˆ‘æŒ‡å®šåªåˆ›å»º`create`å’Œ`destroy`åŠ¨ä½œã€‚è¿™ä¹Ÿç”Ÿæˆäº†é‚£äº›è§†å›¾ã€‚ä½ å¯ä»¥åˆ é™¤`app/views/comments/`é‡Œé¢çš„ã€‚

```
$ rails g controller comments create destroy 
```

ä¸ºäº†ä¸æˆ‘ä»¬çš„æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ³¨é‡Šæ¨¡å‹ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
$ rails g model comment name:string response:text
```

æ‰€æœ‰è¯„è®ºéƒ½æœ‰ä¸€ä¸ªåç§°å’Œå›å¤å­—æ®µã€‚åœ¨è¿™ä¸ªç³»åˆ—ä¸­ï¼Œæˆ‘æ²¡æœ‰æ·±å…¥è®¨è®ºéªŒè¯æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä½†æ˜¯ä¸ºäº†å¢å¼ºåº”ç”¨ç¨‹åºï¼Œæˆ‘è‚¯å®šä¼šè€ƒè™‘æ·»åŠ è¿™äº›ï¼Œè¿™æ ·ç”¨æˆ·å°±å¿…é¡»è¾“å…¥ä»–ä»¬çš„åå­—å’Œæœ‰ä»·å€¼çš„å“åº”ã€‚æ¢å¥è¯è¯´ï¼Œæ²¡æœ‰ç©ºå­—æ®µã€‚

åˆ›å»ºæ¨¡å‹åï¼Œè¯·ç¡®ä¿è¿è¡Œ:

```
 $ rails db:migrate 
```

æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªè¯„è®ºå…³è”åˆ°ä¸€ä¸ªé•œå¤´ï¼Œä¸ºæ­¤éœ€è¦ç»™è¯„è®ºæ·»åŠ ä¸€ä¸ª`shot_id`å‚æ•°ã€‚Rails è¶³å¤Ÿèªæ˜ï¼ŒçŸ¥é“`shot_id`æ˜¯`shot`å¼•ç”¨è¯„è®ºçš„æ–¹å¼ã€‚è¿™é€‚ç”¨äºæ‚¨å…³è”åœ¨ä¸€èµ·çš„ä»»ä½•ç±»å‹çš„æ¨¡å‹ã€‚

```
 $ rails g migration add_shot_id_to_comments 
```

åœ¨è¯¥ä»£(`db/migrate/XXXXXXXXX_add_shot_id_to_comments`)ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
 class AddShotIdToComments < ActiveRecord::Migration[5.1]
  def change
    add_column :comments, :shot_id, :integer
  end
end 
```

ç„¶åè¿è¡Œ:

```
 $ rails db:migrate 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ç›´æ¥å…³è”æ¨¡å‹ã€‚åœ¨æ³¨é‡Šæ¨¡å‹ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
 # app/models/comment.rb
class Comment < ApplicationRecord
    belongs_to :shot
    belongs_to :user
end 
```

å¹¶æ›´æ–°æ‹æ‘„æ¨¡å‹:

```
 # app/model/shot.rb
class Shot < ApplicationRecord
    belongs_to :user
    has_many :comments, dependent: :destroy # if a shot is deleted so are all of its comments
    mount_uploader :user_shot, UserShotUploader
end 
```

æ›´æ–°è·¯çº¿ä»¥åœ¨å¿«ç…§ä¸­åŒ…å«åµŒå¥—æ³¨é‡Š:

```
 # config/routes.rb

resources :shots do 
  resources :comments
end 
```

åœ¨æˆ‘ä»¬çš„`comments_controller.rb`æ–‡ä»¶ä¸­ï¼Œæ¥ä¸‹æ¥æ˜¯åˆ›å»ºæ³¨é‡Šçš„é€»è¾‘ã€‚

```
 class CommentsController < ApplicationController
  # a user must be logged in to comment
    before_action :authenticate_user!, only: [:create, :destroy]

  def create
    # finds the shot with the associated shot_id
    @shot = Shot.find(params[:shot_id]) 
     # creates the comment on the shot passing in params 
    @comment = @shot.comments.create(comment_params)
     # assigns logged in user's ID to
    @comment.user_id = current_user.id if current_user comment
    # saves it
    @comment.save!
    # redirect back to Shot
    redirect_to shot_path(@shot)

  end

  def destroy
    @shot = Shot.find(params[:shot_id])
    @comment = @shot.comments.find(params[:id])
    @comment.destroy
    redirect_to shot_path(@shot)
  end

  private

  def comment_params 
    params.require(:comment).permit(:name, :response)
  end
end 
```

æ¥ä¸‹æ¥æ˜¯æˆ‘ä»¬çš„è§‚ç‚¹ã€‚åœ¨`app/views/comments`ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸¤ä¸ªæ–°çš„éƒ¨åˆ†æ–‡ä»¶ã€‚è¿™äº›æœ€ç»ˆä¼šåœ¨`app/views/shots/shot.html.erb`ä¸­çš„é•œå¤´å±•ç¤ºé¡µé¢ä¸Šå‘ˆç°ã€‚

```
 <!-- app/views/comments/_form.html.erb -->
<%= simple_form_for([@shot, @shot.comments.build]) do |f| %>

    <div class="field">
        <div class="control">
            <%= f.input :name, input_html: { class: 'input'}, wrapper: false, label_html: { class: 'label' } %>
        </div>
    </div>

    <div class="field">
        <div class="control">
            <%= f.input :response, input_html: { class: 'textarea' }, wrapper: false, label_html: { class: 'label' } %>
        </div>
    </div>

    <%= f.button :submit, 'Leave a reply', class: 'button is-primary' %>
<% end %> 
```

è¿™æ˜¯æˆ‘ä»¬çš„è¯„è®ºè¡¨ï¼Œæ˜¾ç¤ºåœ¨ç…§ç‰‡ä¸‹æ–¹ã€‚

```
 <!-- app/views/comments/_comment.html.erb -->
<div class="box">
  <article class="media">
    <figure class="media-left">
      <p class="image is-48x48 user-thumb">
        <%= gravatar_image_tag(comment.user.email.gsub('spam', 'mdeering'), alt: comment.user.name, gravatar: { size: 48 }) %>
      </p>
    </figure>
    <div class="media-content">
      <div class="content">
        <p>
          <strong><%= comment.user.name %></strong>
          <div><%= comment.response %></div>
        </p>
      </div>
    </div>
    <% if (user_signed_in? && (current_user.id == comment.user_id)) %>
       <%= link_to 'Delete', [comment.shot, comment],
                  method: :delete, class: "button is-danger", data: { confirm: 'Are you sure?' } %>
    <% end %>
  </article>
</div> 
```

è¿™æ˜¯å®é™…çš„æ³¨é‡Šæ ‡è®°æœ¬èº«ã€‚è¿™é‡Œæˆ‘å†³å®šè·å–ç™»å½•ç”¨æˆ·çš„åå­—ï¼Œè€Œä¸æ˜¯ä»–ä»¬åœ¨è¯„è®ºè¡¨å•ä¸Šè¾“å…¥çš„åå­—ã€‚å¦‚æœä½ æƒ³æ‰©å±•å®ƒï¼Œå…è®¸é¢å‘å…¬ä¼—çš„ç”¨æˆ·å‘è¡¨è¯„è®ºï¼Œè¿™å½“ç„¶æ˜¯å¯èƒ½çš„ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„`comments_controller.rb`è¦æ±‚ç”¨æˆ·å…ˆç™»å½•æˆ–æ³¨å†Œã€‚

æœ€ååœ¨æˆ‘ä»¬çš„`show.html.erb`ä¸­å‘ˆç°æˆ‘ä»¬çš„è¯„è®ºã€‚

```
 <!-- app/views/shots/show.html.erb - Note: This is the final version which includes some other methods from other gems/helpers. Check the repo or videos for the step by step here! -->
<div class="section">
    <div class="container">
        <h1 class="title is-3"><%= @shot.title %></h1>
        <div class="columns">
            <div class="column is-8">
                <span class="by has-text-grey-light">by</span>
                <div class="user-thumb">
                    <%= gravatar_image_tag(@shot.user.email.gsub('spam', 'mdeering'), alt: @shot.user.name, gravatar: { size: 20 }); %>
                </div>
                <div class="user-name has-text-weight-bold"><%= @shot.user.name %></div>
                <div class="shot-time"><span class="has-text-grey-light">posted</span><span class="has-text-weight-semibold">
                    <%= verbose_date(@shot.created_at) %>
                </span></div>
            </div>    
        </div>

        <div class="columns">
            <div class="column is-8">
                <div class="shot-container">
                    <div class="shot-full">
                         <%= image_tag @shot.user_shot_url unless @shot.user_shot.blank? %>
                    </div>

                    <% if user_signed_in? && (current_user.id == @shot.user_id) %>        
                        <div class="buttons has-addons">
                            <%= link_to 'Edit', edit_shot_path(@shot), class: "button" %>
                            <%= link_to 'Delete', shot_path, class: "button", method: :delete, data: { confirm: 'Are you sure you want to delete this shot?'} %>
                        </div>
                    <% end %>

                    <div class="content">
                        <%= @shot.description %>
                    </div>

                    <section class="comments">
                        <h2 class="subtitle is-5"><%= pluralize(@shot.comments.count, 'Comment') %></h2>
                            <%= render @shot.comments %>
                        <hr />
                        <% if user_signed_in? %>
                            <div class="comment-form">
                                <h3 class="subtitle is-3">Leave a reply</h3>
                                <%= render 'comments/form' %>
                            </div>
                        <% else %>
                            <div class="content"><%= link_to 'Sign in', new_user_session_path %> to leave a comment.</div>
                        <% end %>
                    </section>

                </div>
            </div>
            <div class="column is-3 is-offset-1">
                <div class="nav panel show-shot-analytics">
                    <div class="panel-block views data">
                        <span class="icon"><i class="fa fa-eye"></i></span>
                        <%= pluralize(@shot.impressionist_count, 'View') %>
                    </div>
                    <div class="panel-block comments data">
                        <span class="icon"><i class="fa fa-comment"></i></span>
                        <%= pluralize(@shot.comments.count, 'Comment') %>
                    </div>
                    <div class="panel-block likes data">
                        <% if user_signed_in? %>
              <% if current_user.liked? @shot %>
                <%= link_to unlike_shot_path(@shot), method: :put, class: "unlike_shot" do %>
                  <span class="icon"><i class="fa fa-heart has-text-primary"></i></span>
                  <span class="vote_count"><%= pluralize(@shot.get_likes.size, 'Like') %></span>
                <% end %>
              <% else %>
                <%= link_to like_shot_path(@shot), method: :put, class: "like_shot" do %>
                  <span class="icon"><i class="fa fa-heart"></i></span>
                  <span class="vote_count"><%= pluralize(@shot.get_likes.size, 'Like') %></span>
                <% end %>
              <% end %>
            <% else %>
                <%= link_to like_shot_path(@shot), method: :put, class: "like_shot" do %>
                  <span class="icon"><i class="fa fa-heart"></i></span>
                  <span class="vote_count"><%= pluralize(@shot.get_likes.size, 'Like') %></span>
                <% end %>
            <% end %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> 
```

## [](#impressionist-setup)å°è±¡æ´¾è®¾ç½®

æ‹æ‘„ç‹¬ç‰¹çš„è§†è§’æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åŠŸèƒ½ã€‚ä¸ºäº†è®©è‡ªå·±è¿‡å¾—æ›´è½»æ¾ï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€å—åä¸ºå°è±¡æ´¾çš„å®çŸ³ã€‚å®ƒè®©å°è±¡å˜å¾—å¾ˆå®¹æ˜“ã€‚

```
 $ rails g impressionist
$ rails db:migrate 
```

å¦‚æœåœ¨æŒ‡å®šä½¿ç”¨å“ªä¸ª rails ç‰ˆæœ¬æ—¶å‡ºç°é”™è¯¯ï¼Œæ‚¨éœ€è¦å°†`[5.1]`æ·»åŠ åˆ°è¿ç§»ä¸­ã€‚ä½¿ç”¨æ‚¨ä½¿ç”¨çš„ä»»ä½•ç‰ˆæœ¬çš„ railsã€‚

å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°`shots_controller.rb`æ–‡ä»¶ä¸­:

```
 class ShotsController < ApplicationController
    # only recording when a user views the shot page and is unique
    impressionist actions: [:show], unique: [:impressionable_type, :impressionable_id, :session_hash]

    ...  
end 
```

å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°`app/models/`ä¸­çš„ shot.rb æ–‡ä»¶:

```
 class Shot < ApplicationRecord
    belongs_to :user
    has_many :comments, dependent: :destroy

    mount_uploader :user_shot, UserShotUploader
    is_impressionable # adds support for impressionist on our shot model
end 
```

åœ¨è§†å›¾ä¸­æ˜¾ç¤ºå®ƒ:

```
 <!-- on our shot index page app/views/shots/index.html.erb -->
<%= shot.impressionist_count %>
<!-- on our shot show page app/views/shots/show.html.erb -->
<%= @shot.impressionist_count %> 
```

## [](#adding-likes-with-acts-as-votable)æ·»åŠ å–œæ¬¢ä½œä¸ºæŠ•ç¥¨

å¦ä¸€ä¸ªå¾ˆå¥½çš„åŠŸèƒ½æ˜¯èƒ½å¤Ÿå–œæ¬¢å’Œä¸å–œæ¬¢ä¸€ä¸ªé•œå¤´ã€‚Dribbble å·²ç»æœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œå°½ç®¡ä»–ä»¬åœ¨å¹•ååšäº†ä¸€ç‚¹ AJAXï¼Œè®©ä¸€åˆ‡éƒ½å¯ä»¥å·¥ä½œï¼Œè€Œæ— éœ€åˆ·æ–°æµè§ˆå™¨ã€‚

### [](#installation)å®‰è£…

å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ‚¨çš„ gem æ–‡ä»¶ä¸­ï¼Œä»¥å®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚

```
 gem 'acts_as_votable', '~> 0.11.1' # check if this version is supported in your project 
```

ç„¶åç”¨ä¸€ä¸ª`bundle install`æ¥è·Ÿè¿›ã€‚

### [](#database-migrations)æ•°æ®åº“è¿ç§»

å……å½“ Votable ä½¿ç”¨æŠ•ç¥¨è¡¨æ¥å­˜å‚¨æ‰€æœ‰æŠ•ç¥¨ä¿¡æ¯ã€‚è¦ç”Ÿæˆå’Œè¿è¡Œè¿ç§»ï¼Œè¯·ä½¿ç”¨ã€‚

```
 $ rails generate acts_as_votable:migration
$ rake db:migrate 
```

æˆ‘ä»¬éœ€è¦å°†`acts_as_votable`æ ‡è¯†ç¬¦æ·»åŠ åˆ°æˆ‘ä»¬æƒ³è¦æŠ•ç¥¨çš„æ¨¡å‹ä¸­ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯`Shot`ã€‚

```
 # app/models/shot.rb
class Shot < ApplicationRecord
    belongs_to :user
    has_many :comments, dependent: :destroy

    mount_uploader :user_shot, UserShotUploader
    is_impressionable
    acts_as_votable
end 
```

æˆ‘è¿˜æƒ³å°†ç”¨æˆ·å®šä¹‰ä¸º*æŠ•ç¥¨äºº*ï¼Œå› æ­¤æˆ‘ä»¬å°†`acts_as_voter`æ·»åŠ åˆ°ç”¨æˆ·æ¨¡å‹ä¸­ã€‚

```
 # app/models/user.rb
class User < ApplicationRecord
  # Include default devise modules. Others available are:
  # :confirmable, :lockable, :timeoutable and :omniauthable
  devise :database_authenticatable, :registerable,
         :recoverable, :rememberable, :trackable, :validatable

  has_many :shots
  has_many :comments, dependent: :destroy
  acts_as_voter

end 
```

ä¸€å®šè¦åˆ›å»ºä¸€ä¸ªå¯ç‚¹å‡»çš„å–œæ¬¢æˆ–ä¸å–œæ¬¢ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å¼•å…¥ä¸€äº›è·¯çº¿ã€‚ä¸‹é¢æˆ‘æ·»åŠ äº†ä¸€ä¸ª`member do`å—ï¼Œå®ƒæœ¬è´¨ä¸Šæ·»åŠ äº†åµŒå¥—åœ¨æˆ‘ä»¬çš„`shots` restful è·¯ç”±ä¸­çš„é restful è·¯ç”±ã€‚åœ¨è¿™é‡Œè¿è¡Œ`rake routes`å°†æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸­çš„æ¯æ¡è·¯çº¿ã€‚

```
 Rails.application.routes.draw do
  resources :shots do 
    resources :comments
     member do
        put 'like', to: "shots#like"
        put 'unlike', to: "shots#unlike"
    end
  end
  devise_for :users, controllers: { registrations: 'registrations' }
  root "shots#index"
end 
```

æ§åˆ¶å™¨åœ¨è¿™é‡Œéœ€è¦ä¸€äº›å·¥ä½œï¼Œæ‰€ä»¥æˆ‘åœ¨æ··åˆä¸­æ·»åŠ äº†`:like`å’Œ`:unlike`åŠ¨ä½œã€‚è¿™äº›ä¹Ÿé€šè¿‡æˆ‘ä»¬çš„`before_actions`ä¼ é€’ï¼Œå®ƒå¤„ç†æŸ¥æ‰¾æåŠçš„é•œå¤´ä»¥åŠç¡®ä¿ç”¨æˆ·ç™»å½•ã€‚

```
 # app/controllers/shots_controller.rb

before_action :set_shot, only: [:show, :edit, :update, :destroy, :like, :unlike] 
# sets up shot for like and unlike now keeping things dry.
before_action :authenticate_user!, only: [:edit, :update, :destroy, :like, :unlike] 
# add routes as authenticated. 
....

def like
  @shot.liked_by current_user
  respond_to do |format|
    format.html { redirect_back fallback_location: root_path }
    format.js { render layout: false }
  end
end

def unlike
  @shot.unliked_by current_user
  respond_to do |format|
    format.html { redirect_back fallback_location: root_path }
    format.js { render layout: false }
  end
end 
```

åœ¨æˆ‘ä»¬çš„`app/views/show/`ä¸­çš„`index.html.erb`æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°â€œlikesâ€å—ä¸­:

```
 <!-- app/views/shots/index.html.erb -->
<div class="level-item likes data">
   <div class="votes">
   <% if user_signed_in? %>
      <% if current_user.liked? shot %>
        <%= link_to unlike_shot_path(shot), method: :put, class: 'unlike_shot' do %>
            <span class="icon"><i class="fa fa-heart has-text-primary"></i></span>
            <span class="vote_count"><%= shot.get_likes.size %></span> 
        <% end %>
      <% else %>
        <%= link_to like_shot_path(shot), method: :put, class: 'like_shot' do %>
          <span class="icon"><i class="fa fa-heart"></i></span>
          <span class="vote_count"><%= shot.get_likes.size %></span> 
        <% end %>
      <% end %>
    <% else %>
        <%= link_to like_shot_path(shot), method: :put, class: 'like_shot' do %>
          <span class="icon"><i class="fa fa-heart"></i></span>
          <span class="vote_count"><%= shot.get_likes.size %></span> 
        <% end %>
    <% end %>
  </div>
</div> 
```

ç„¶åï¼Œä¸ºäº†é‡å¤`show.html.erb`æ–‡ä»¶ä¸­çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä»¥ä¸‹å†…å®¹:

```
 <!-- app/views/shots/show.html.erb -->
<div class="panel-block likes data">
    <% if user_signed_in? %>
    <% if current_user.liked? @shot %>
      <%= link_to unlike_shot_path(@shot), method: :put, class: "unlike_shot" do %>
        <span class="icon"><i class="fa fa-heart has-text-primary"></i></span>
        <span class="vote_count"><%= pluralize(@shot.get_likes.size, 'Like') %></span>
      <% end %>
    <% else %>
      <%= link_to like_shot_path(@shot), method: :put, class: "like_shot" do %>
        <span class="icon"><i class="fa fa-heart"></i></span>
        <span class="vote_count"><%= pluralize(@shot.get_likes.size, 'Like') %></span>
      <% end %>
    <% end %>
  <% else %>
      <%= link_to like_shot_path(@shot), method: :put, class: "like_shot" do %>
        <span class="icon"><i class="fa fa-heart"></i></span>
        <span class="vote_count"><%= pluralize(@shot.get_likes.size, 'Like') %></span>
      <% end %>
  <% end %>
</div> 
```

### [](#final-touches)æœ€åçš„è§¦åŠ¨

åœ¨ä¸»é¡µä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ç‚¹è¥é”€ç»„åˆï¼Œå¹¶ä¸ºæ²¡æœ‰ç™»å½•çš„äººæ˜¾ç¤ºä¸€ä¸ªæ™®é€šçš„è‹±é›„ç‚¹ã€‚å¦‚æœä»–ä»¬å·²ç»ç™»å½•ï¼Œæˆ‘ä¸æƒ³æ˜¾ç¤ºè¿™ä¸ªã€‚åœ¨æˆ‘ä»¬çš„ç´¢å¼•è§†å›¾ä¸­ï¼Œæœ€ç»ˆç»“æœå¦‚ä¸‹æ‰€ç¤º:

```
 <!-- app/views/shots/index.html.erb -->

<%= render 'hero' %> <!-- render the hero partial-->

<section class="section">
  <div class="shots">
    <% @shots.each do |shot| %>
    ... 
```

åœ¨ä¸Šé¢çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘æœ‰ä»¥ä¸‹å†…å®¹ã€‚æˆ‘ä»¬æ­£åœ¨æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœªç™»å½•ã€‚å¦‚æœä¸æ˜¯ï¼Œæˆ‘ä»¬å°±å±•ç¤ºè‹±é›„æ——å¸œã€‚å¾ˆç®€å•ã€‚

```
 <% if !user_signed_in? %>
    <section class="hero is-dark">
        <div class="hero-body">
            <div class="container has-text-centered">
                <h1 class="title is-size-5">
                    What are you working on? <span class="has-text-grey-light">Dribbble is where designers get inspired and hired.</span>
                </h1>
                <div class="content">
                    <%= link_to "Login", new_user_session_path, class: "button is-primary" %>
                </div>
            </div>
        </div>
    </section>
<% end %> 
```

#### [](#hover-effects)æ‚¬åœæ•ˆæœ

åœ¨ç´¢å¼•é¡µé¢ä¸Šï¼Œæˆ‘æƒ³æ¨¡ä»¿ Dribbble åœ¨ä»–ä»¬çš„ç…§ç‰‡ç¼©ç•¥å›¾ä¸Šçš„æ‚¬åœæ•ˆæœã€‚ä¸ºæ­¤éœ€è¦ä¸€ç‚¹ jQueryã€‚æˆ‘åœ¨å‰é¢æåˆ°çš„`shots.js`æ–‡ä»¶ä¸­æ·»åŠ äº†ä¸‹é¢çš„æ–¹æ³•ã€‚æˆ‘ä»¬æœ€ç»ˆçš„`shots.scss`æ–‡ä»¶ä¹Ÿåœ¨ä¸‹é¢ä¾›å‚è€ƒã€‚

```
 // app/assets/javascripts/shot.js
...
},
shotHover() {
  $('.shot').hover(function() {
      $(this).children('.shot-data').toggleClass('visible');
    });
  }
};
Shots.previewShot();
Shots.shotHover();

}); 
```

```
 /* app/assets/stylesheets/shots.scss */
.hero.is-dark {
    background-color: #282828 !important;
}

.shot-wrapper {
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.07);
    border-radius: 2px;
    padding: 10px;
    background: white;
}

.shots {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-gap: 1rem;
    @media only screen and (min-width: 1600px) {
        grid-template-columns: repeat(6, 1fr);
    }
    @media only screen and (max-width: 1300px) {
        grid-template-columns: repeat(4, 1fr);
    }
    @media only screen and (max-width: 1100px) { 
        grid-template-columns: repeat(3, 1fr);
    }
    @media only screen and (max-width: 800px) {
        grid-template-columns: 1fr 1fr;
    }
    @media only screen and (max-width: 400px) {
        grid-template-columns: 1fr;
    }

}

.shot {
    position: relative;
    display: block;
    color: #333 !important;

    .shot-data {
        display: none;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        padding: 10px;
        background: rgba(white, .9);
        cursor: pointer;
        .shot-title {
            font-weight: bold;
        }
        .shot-description {
            font-size: .9rem;
        }
        .shot-time {
            font-size: .8rem;
            padding-top: .5rem;
        }
    }
}

.user-data {
    padding: 1rem 0 0 0;
}

.user-name {
    display: inline-block;
    position: relative;
    top: -4px;
    padding-left: 5px;
}

.user-thumb {
    display: inline-block;
    img {
        border-radius: 50%;
    }
}

.by,
.shot-time {
    display: inline-block;
    position: relative;
    top: -4px;
}

.shot-analytics {
    text-align: right;
    @media only screen and (max-width: 800px) {
        text-align: right;
        .level-item {
            display: inline-block;
            padding: 0 4px;
        }
        .level-left+.level-right {
            margin: 0;
            padding: 0;
        }
        .level-item:not(:last-child) {
            margin: 0;
        }
    }
}

.shot-analytics,
.panel.show-shot-analytics {
    font-size: .9rem;
    a,
    .icon {
        color: #aaa;
    }
    .icon:hover,
    a:hover {
        color: darken(#aaa, 25%);
    }
}

.panel.show-shot-analytics {
    a { color: #333; }
    .icon {
        padding-right: .5rem;
    }
    .likes .vote_count {
        margin-left: -4px;
    }
}

.shot-container {
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.07);
    border-radius: 2px;
    padding: 40px;
    background: white;
    @media only screen and (max-width: 800px) {
        padding: 10px;
    }
    .content,
    .comments {
        margin-top: 1rem;
        padding: 20px;
        @media only screen and (max-width: 800px) {
            padding: 0;
        }
    }
}

.shot-full {
    text-align: center;
} 
```

### [](#final-thoughts-and-thanks)æœ€åçš„æ€å¿µå’Œæ„Ÿè°¢

è¿™ä¸ªç‰ˆæœ¬æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„åŠªåŠ›ï¼Œå³ä½¿ä»å¤–é¢çœ‹å®ƒå¯èƒ½åœ¨åŠŸèƒ½ä¸Šæœ‰ç‚¹è½»ã€‚Dribbble æœ‰å¾ˆå¤šæ´»åŠ¨éƒ¨ä»¶ï¼Œæˆ‘ä»¬çš„å…‹éš†ä½“åªæ˜¯è§¦åŠäº†è¡¨é¢ã€‚æˆ‘é‚€è¯·ä½ ç»§ç»­æ·»åŠ ä½ è®¤ä¸ºåˆé€‚çš„ç‰¹æ€§å’Œé›†æˆã€‚ä½œä¸ºä¸€å web å¼€å‘äººå‘˜ï¼Œä»…ä»…æ˜¯æŠ•å…¥è¿›å»ï¼Œæ‰“ç ´å’Œä¿®å¤ä¸€äº›ä¸œè¥¿ï¼Œæœ€ç»ˆå°±èƒ½è®©ä½ å­¦ä¹ å’Œæˆé•¿ã€‚

æ„Ÿè°¢æ”¶çœ‹è¿™ä¸ªç³»åˆ—èŠ‚ç›®ã€‚å¦‚æœä½ ç»§ç»­å…³æ³¨æˆ–è€…æœ‰åé¦ˆï¼Œè¯·åœ¨è¯„è®ºä¸­æˆ–è€…åœ¨ [Twitter](https://twitter.com/webcrunchblog) ä¸Šå‘Šè¯‰æˆ‘ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œä¸€å®šè¦çœ‹çœ‹åšå®¢çš„[éƒ¨åˆ†ï¼Œè·å–æ›´å¤šå…³äºè®¾è®¡å’Œå¼€å‘çš„æ–‡ç« ã€‚](https://web-crunch.com/archive)

#### [](#watchread-the-full-ruby-on-rails-lets-build-series)è§‚çœ‹/é˜…è¯»å®Œæ•´çš„ Ruby on Rails è®©æˆ‘ä»¬æ„å»ºç³»åˆ—:

1.  [Ruby on Rails ç®€ä»‹](https://web-crunch.com/lets-build-with-ruby-on-rails-introduction/)
2.  [åœ¨ä½ çš„æœºå™¨ä¸Šå®‰è£… Ruby on Rails](https://web-crunch.com/lets-build-with-ruby-on-rails-installation/)
3.  [ä½¿ç”¨ Ruby on Rails åˆ›å»ºä¸€ä¸ªå¸¦æœ‰è¯„è®ºçš„åŸºæœ¬åšå®¢](https://web-crunch.com/lets-build-with-ruby-on-rails-blog-with-comments/)
4.  [ç”¨ Ruby on Rails æ„å»ºä¸€ä¸ª Twitter å…‹éš†](https://web-crunch.com/lets-build-with-ruby-on-rails-a-twitter-clone/)

## [](#shameless-plugs)ä¸è¦è„¸çš„æ’å¤´

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘åœ¨ [YouTube](https://youtube.com/c/webcrunch) å’Œæˆ‘çš„[åšå®¢](https://web-crunch.com)ä¸Šæœ‰æ›´å¤šå†…å®¹ã€‚æˆ‘è®¡åˆ’åœ¨è¿™é‡Œå¼€å§‹åˆ›ä½œæ›´å¤šçš„ä½œå“ã€‚å¸Œæœ›æ”¶ä»¶ç®±ä¸­æœ‰æ›´å¤šè¿™æ ·çš„å†…å®¹å—ï¼Ÿ[è®¢é˜…æˆ‘çš„ç®€è®¯](https://web-crunch.com/subcribe)è‡ªåŠ¨è·å–ã€‚

 [![](../Images/c009079376aa2fccf2abd73f5ab135d8.png)](https://hellorails.io) 
â˜æƒ³ä»å¤´å¼€å§‹å­¦ä¹  Ruby on Railsï¼Ÿçœ‹çœ‹æˆ‘å³å°†æ¨å‡ºçš„è¯¾ç¨‹ [Hello Rails](https://hellorails.io) ã€‚