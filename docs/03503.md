# ç†è§£ Kotlin åç¨‹ä¸­çš„æŒ‚èµ·åŠŸèƒ½

> åŸæ–‡:[https://dev . to/on myway 133/understanding-suspend-function-in-kot Lin-coroutine-2 clb](https://dev.to/onmyway133/understanding-suspend-function-in-kotlin-coroutine-2clb)

## [](#getting-to-know-coroutine)äº†è§£åç¨‹

ä»[https://kotlinlang.org/docs/reference/coroutines.html](https://kotlinlang.org/docs/reference/coroutines.html)

> ç»§ç»­ç±»æ¯”ï¼Œawait()å¯ä»¥æ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°(å› æ­¤ä¹Ÿå¯ä»¥ä» async {}å—ä¸­è°ƒç”¨),å®ƒæŒ‚èµ·ä¸€ä¸ªåç¨‹ï¼Œç›´åˆ°å®Œæˆä¸€äº›è®¡ç®—å¹¶è¿”å›å…¶ç»“æœ:

æ¥è‡ª[https://kot linlang . org/docs/tutorials/coroutines-basic-JVM . html](https://kotlinlang.org/docs/tutorials/coroutines-basic-jvm.html)

> æˆ‘ä»¬ä½¿ç”¨çš„ delay()å‡½æ•°ç±»ä¼¼äº Thread.sleep()ï¼Œä½†æ›´å¥½:å®ƒä¸é˜»å¡çº¿ç¨‹ï¼Œè€Œåªæ˜¯æŒ‚èµ·åç¨‹æœ¬èº«ã€‚å½“åç¨‹ç­‰å¾…æ—¶ï¼Œçº¿ç¨‹è¢«è¿”å›åˆ°æ± ä¸­ï¼Œå½“ç­‰å¾…ç»“æŸæ—¶ï¼Œåç¨‹åœ¨æ± ä¸­çš„ä¸€ä¸ªè‡ªç”±çº¿ç¨‹ä¸Šæ¢å¤ã€‚
> 
> await()ä¸èƒ½åœ¨åç¨‹ä¹‹å¤–è°ƒç”¨ï¼Œå› ä¸ºå®ƒéœ€è¦æŒ‚èµ·ï¼Œç›´åˆ°è®¡ç®—å®Œæˆï¼Œå¹¶ä¸”åªæœ‰åç¨‹å¯ä»¥ä»¥éé˜»å¡æ–¹å¼æŒ‚èµ·

## kot Lin åç¨‹ä¸­çš„ suspend å‡½æ•°æ˜¯ä»€ä¹ˆæ„æ€ğŸ¤”

[https://stack overflow . com/questions/47871868/what-do-suspend-function-mean-in-kot Lin-coroutine](https://stackoverflow.com/questions/47871868/what-does-suspend-function-mean-in-kotlin-coroutine)

## [](#understanding-async)äº†è§£å¼‚æ­¥

æ¥è‡ª[https://github . com/kot Lin/kot linx . coroutines/blob/master/coroutines-guide . MD](https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md)

> ä»æ¦‚å¿µä¸Šè®²ï¼Œå¼‚æ­¥å°±åƒå¯åŠ¨ã€‚å®ƒå¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„åç¨‹ï¼Œè¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çº¿ç¨‹ï¼Œä¸æ‰€æœ‰å…¶ä»–åç¨‹å¹¶è¡Œå·¥ä½œã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œlaunch è¿”å›ä¸€ä¸ªä½œä¸šï¼Œå¹¶ä¸”ä¸æºå¸¦ä»»ä½•ç»“æœå€¼ï¼Œè€Œ async è¿”å›ä¸€ä¸ª Deferredâ€”â€”ä¸€ä¸ªè½»é‡çº§çš„éé˜»å¡æœªæ¥ï¼Œè¡¨ç¤ºä»¥åæä¾›ç»“æœçš„æ‰¿è¯ºã€‚ä½ å¯ä»¥ç”¨ã€‚await()æ¥è·å¾—å®ƒçš„æœ€ç»ˆç»“æœï¼Œä½†æ˜¯ deferred ä¹Ÿæ˜¯ä¸€é¡¹å·¥ä½œï¼Œæ‰€ä»¥å¦‚æœéœ€è¦çš„è¯å¯ä»¥å–æ¶ˆå®ƒã€‚

```
fun main(args: Array<String>) = runBlocking<Unit> {
    val time = measureTimeMillis {
        val one = async { doSomethingUsefulOne() }
        val two = async { doSomethingUsefulTwo() }
        println("The answer is ${one.await() + two.await()}")
    }
    println("Completed in $time ms")
} 
```

> å¼‚æ­¥æœ‰ä¸€ä¸ªæƒ°æ€§é€‰é¡¹ï¼Œä½¿ç”¨ä¸€ä¸ªå¯é€‰çš„ start å‚æ•°ï¼Œå…¶å€¼ä¸º CoroutineStart.LAZYã€‚è¿è¡Œä»¥ä¸‹ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹ä¸ä¸Šä¸€ä¸ªç¤ºä¾‹çš„ä¸åŒä¹‹å¤„ä»…åœ¨äºæ­¤é€‰é¡¹:

```
fun main(args: Array<String>) = runBlocking<Unit> {
    val time = measureTimeMillis {
        val one = async(start = CoroutineStart.LAZY) { doSomethingUsefulOne() }
        val two = async(start = CoroutineStart.LAZY) { doSomethingUsefulTwo() }
        println("The answer is ${one.await() + two.await()}")
    }
    println("Completed in $time ms")
} 
```

## kot Lin ååŒä¾‹ç¨‹ä¸­çš„å¯åŠ¨/åŠ å…¥å’Œå¼‚æ­¥/ç­‰å¾…æœ‰ä»€ä¹ˆåŒºåˆ«

[https://stackoverflow.com/a/48079738/1418457](https://stackoverflow.com/a/48079738/1418457)

æˆ‘è§‰å¾—è¿™ä¸ªæŒ‡å—[https://github . com/kot Lin/kot linx . coroutines/blob/master/coroutines-guide . MD](https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md)å¾ˆæœ‰ç”¨ã€‚æˆ‘å°†å¼•ç”¨é‡è¦çš„éƒ¨åˆ†

ğŸ¦„ååŒç¨‹åº

æœ¬è´¨ä¸Šï¼Œåç¨‹æ˜¯è½»é‡çº§çº¿ç¨‹ã€‚

å› æ­¤ï¼Œæ‚¨å¯ä»¥å°†åç¨‹è§†ä¸ºä»¥éå¸¸é«˜æ•ˆçš„æ–¹å¼ç®¡ç†çº¿ç¨‹çš„ä¸œè¥¿ã€‚

ğŸ¤å¯åŠ¨

```
fun main(args: Array<String>) {
    launch { // launch new coroutine in background and continue
        delay(1000L) // non-blocking delay for 1 second (default time unit is ms)
        println("World!") // print after delay
    }
    println("Hello,") // main thread continues while coroutine is delayed
    Thread.sleep(2000L) // block main thread for 2 seconds to keep JVM alive
} 
```

æ‰€ä»¥ launch å¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œåšä¸€äº›äº‹æƒ…ï¼Œç„¶åç«‹å³è¿”å›ä¸€ä¸ªä»¤ç‰Œä½œä¸º Jobã€‚æ‚¨å¯ä»¥åœ¨è¿™ä¸ªä»»åŠ¡ä¸Šè°ƒç”¨ join æ¥é˜»å¡ï¼Œç›´åˆ°è¿™ä¸ªå¯åŠ¨çº¿ç¨‹å®Œæˆ

```
fun main(args: Array<String>) = runBlocking<Unit> {
    val job = launch { // launch new coroutine and keep a reference to its Job
        delay(1000L)
        println("World!")
    }
    println("Hello,")
    job.join() // wait until child coroutine completes
} 
```

ğŸ¦†å¼‚æ­¥ËŒéåŒæ­¥(asynchronous)

ä»æ¦‚å¿µä¸Šè®²ï¼Œå¼‚æ­¥å°±åƒå¯åŠ¨ã€‚å®ƒå¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„åç¨‹ï¼Œè¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çº¿ç¨‹ï¼Œä¸æ‰€æœ‰å…¶ä»–åç¨‹å¹¶è¡Œå·¥ä½œã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œlaunch è¿”å›ä¸€ä¸ªä½œä¸šï¼Œå¹¶ä¸”ä¸æºå¸¦ä»»ä½•ç»“æœå€¼ï¼Œè€Œ async è¿”å›ä¸€ä¸ª Deferredâ€”â€”ä¸€ä¸ªè½»é‡çº§çš„éé˜»å¡æœªæ¥ï¼Œè¡¨ç¤ºä»¥åæä¾›ç»“æœçš„æ‰¿è¯ºã€‚

æ‰€ä»¥ async å¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œåšä¸€äº›äº‹æƒ…ï¼Œç„¶åç«‹å³è¿”å›ä¸€ä¸ªå»¶è¿Ÿçš„ä»¤ç‰Œã€‚

```
fun main(args: Array<String>) = runBlocking<Unit> {
    val time = measureTimeMillis {
        val one = async { doSomethingUsefulOne() }
        val two = async { doSomethingUsefulTwo() }
        println("The answer is ${one.await() + two.await()}")
    }
    println("Completed in $time ms")
} 
```

ä½ å¯ä»¥ç”¨ã€‚await()æ¥è·å¾—å®ƒçš„æœ€ç»ˆç»“æœï¼Œä½†æ˜¯ deferred ä¹Ÿæ˜¯ä¸€é¡¹å·¥ä½œï¼Œæ‰€ä»¥å¦‚æœéœ€è¦çš„è¯å¯ä»¥å–æ¶ˆå®ƒã€‚

æ‰€ä»¥å»¶æœŸå…¶å®æ˜¯ä¸€ç§å·¥ä½œã€‚å‚è§[https://kot Lin . github . io/kot linx . coroutines/kot linx-coroutines-core/kot linx . coroutines . experimental/-deferred/index . html](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.experimental/-deferred/index.html)

```
interface Deferred<out T> : Job (source) 
```

ğŸ¦‹é»˜è®¤æƒ…å†µä¸‹ï¼Œå¼‚æ­¥æ˜¯æ€¥åˆ‡çš„

å¼‚æ­¥æœ‰ä¸€ä¸ªæƒ°æ€§é€‰é¡¹ï¼Œä½¿ç”¨ä¸€ä¸ªå¯é€‰çš„ Start å‚æ•°ï¼Œå…¶å€¼ä¸º CoroutineStart.LAZYã€‚åªæœ‰å½“æŸäº› await éœ€è¦å®ƒçš„ç»“æœæˆ–è€…è°ƒç”¨äº† start å‡½æ•°æ—¶ï¼Œå®ƒæ‰å¯åŠ¨ coroutineã€‚

åŸå¸–[https://github.com/onmyway133/blog/issues/123](https://github.com/onmyway133/blog/issues/123)