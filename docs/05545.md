# å‘æ‚¨çš„ NativeScript åº”ç”¨ç¨‹åºæ·»åŠ åŸºæœ¬çš„å´©æºƒæŠ¥å‘Š

> åŸæ–‡:[https://dev . to/progress/add-basic-crash-reporting-to-your-native script-app-2bcb](https://dev.to/progress/add-basic-crash-reporting-to-your-nativescript-app-2bcb)

è™½ç„¶æˆ‘ä¸ªäººä¸€ç”Ÿä¸­ä»æœªå†™è¿‡ä¸€è¡Œé”™è¯¯çš„ä»£ç ï¼Œä½†ä½ ä»¬ä¸­çš„ä¸€äº›äººå¾ˆå¯èƒ½å†™è¿‡ã€‚å¼€æºçš„é»„é‡‘æ³•åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨æ‚¨çš„ç”¨æˆ·æœ‰æœºä¼šåˆ¶é€  GitHub é—®é¢˜ä¹‹å‰ï¼Œè¯†åˆ«å¹¶ä¿®å¤é”™è¯¯ï¼

æˆ‘ä»¬é›†ä½“é‡‡å–äº†è®¸å¤šæ–¹æ³•æ¥è®°å½•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„é”™è¯¯(æ— è®ºæ˜¯ web è¿˜æ˜¯ç§»åŠ¨çš„)ã€‚åœ¨æˆ‘è¿‡å»ä½œä¸º. NET web å¼€å‘äººå‘˜çš„ç»å†ä¸­ï¼Œæˆ‘ç»å¸¸é‡‡ç”¨ä¸€ç§åŸºæœ¬çš„æ–¹æ³•ï¼Œåˆ©ç”¨å…¨å±€`Application_Error`äº‹ä»¶è®©æˆ‘çš„åº”ç”¨ç¨‹åºå‘é€ä¸€å°ç®€å•çš„ç”µå­é‚®ä»¶ï¼Œå…¶ä¸­åŒ…å«é”™è¯¯çš„è¯¦ç»†ä¿¡æ¯ã€‚å“¦ğŸ˜ã€‚å®ƒå¯ä»¥å·¥ä½œï¼Œä½†ä¸èƒ½æä¾›ä¼ä¸šçº§åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ•´åˆæŠ¥å‘Šã€‚

æ—¶ä»£å˜äº†ï¼Œå‡ºç°äº†è®¸å¤šæ›´å¼ºå¤§çš„â€œå´©æºƒæŠ¥å‘Šâ€æœåŠ¡ã€‚ä¸€äº›æ›´å—æ¬¢è¿çš„æ˜¯ [CrashProbe](http://www.crashprobe.com/) ã€ [Sentry.io](https://sentry.io/welcome/) å’Œ [Firebase Crashlytics](https://firebase.google.com/docs/crashlytics/) ã€‚

[![sentry.io crashprobe crashlytics logos](../Images/75eb14727ef4e839186d2df54bb71d90.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--FzKe6GYA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/rdlauer/articles/master/nativescript/crashlytics/logos.png)

ç°åœ¨ï¼Œå¦‚æœä½ æ²¡æœ‰ä½¿ç”¨*ä»»ä½•*é”™è¯¯æŠ¥å‘Šæœºåˆ¶ï¼Œæˆ‘çš„æœ¬èƒ½æ˜¯ç¾è¾±ä½ ï¼Œä½†å®é™…ä¸Šæˆ‘æƒ³ç»™ä½ ä¸€ä¸ªæ‹¥æŠ±ï¼Œè®©ä½ çŸ¥é“ä¸€åˆ‡éƒ½ä¼šå¥½çš„ã€‚

ä»Šå¤©ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åˆ©ç”¨ Crashlytics(Firebase çš„ä¸€éƒ¨åˆ†)æ¥è®°å½•å’ŒæŠ¥å‘Š iOS å’Œ Android çš„ NativeScript åº”ç”¨ç¨‹åºä¸­çš„é”™è¯¯ã€‚

> **æç¤º:** NativeScript 5.2 å¸¦æ¥äº†å·¨å¤§çš„æ”¹è¿›[é”™è¯¯è®°å½•æ”¹è¿›](https://www.nativescript.org/blog/nativescript-5.2-comes-with-official-support-for-vue)ï¼

## Firebase æ’ä»¶

å¿«é€Ÿå†å²è¯¾:è‡ª 2011 å¹´ä»¥æ¥ï¼ŒCrashlytics ä¸€ç›´å­˜åœ¨ã€‚å‡ å¹´åï¼Œå®ƒä»¬è¢« Twitter æ”¶è´­ï¼Œæœ€è¿‘åˆè¢« Google æ”¶è´­ï¼Œå¹¶åŒ…å«åœ¨ä»–ä»¬çš„ Firebase äº§å“ä¸­ã€‚

> æˆ‘å¹¶ä¸æ˜¯è¦è®©ä½ å®Œå…¨å¸‚åœºåŒ–ï¼Œä½†æ˜¯å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªæœ‰ç«äº‰åŠ›çš„ã€æœ¬åœ°è„šæœ¬ä¼˜åŒ–çš„æ— æœåŠ¡å™¨åç«¯ï¼Œçœ‹çœ‹ [Progress Kinvey](https://devcenter.kinvey.com/nativescript/guides/getting-started) ã€‚

è™½ç„¶ Firebase åŒ…å«è®¸å¤šæœåŠ¡ï¼Œä½†æˆ‘ä»¬ä»Šå¤©å”¯ä¸€å…³å¿ƒçš„æ˜¯ Crashlyticsã€‚è¿˜æœ‰ä»€ä¹ˆæ¯”é€šè¿‡ [NativeScript Firebase æ’ä»¶](https://market.nativescript.org/plugins/nativescript-plugin-firebase)æ¥åˆ©ç”¨è¿™äº›æœåŠ¡æ›´å¥½çš„æ–¹å¼å‘¢ï¼

[![nativescript and firebase](../Images/81d5b238d28a6bc06161fe99f6ba2f35.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--7JySO9bH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/rdlauer/articles/master/nativescript/crashlytics/nativescript-firebase.png)

è¦å¼€å§‹ä½¿ç”¨ Firebaseï¼Œä½ æ‰€éœ€è¦åšçš„å°±æ˜¯å‰å¾€ [Firebase æ§åˆ¶å°](https://console.firebase.google.com/)å¹¶å»ºç«‹ä¸€ä¸ªæ–°çš„(å…è´¹)å¸æˆ·ã€‚

ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä¼šè®©ä½ æŒ‰ç…§[çš„ç®€å•è¯´æ˜](https://github.com/EddyVerbruggen/nativescript-plugin-firebase#prerequisites)æ¥è®¾ç½®ä½ çš„ç¬¬ä¸€ä¸ª Firebase é¡¹ç›®ï¼Œå¹¶æ­£ç¡®é…ç½®ä½ çš„ NativeScript åº”ç”¨ç¨‹åºã€‚

> **æç¤º:**åœ¨æ’ä»¶å®‰è£…æœŸé—´ï¼Œå®‰è£…è„šæœ¬ä¼šæç¤ºæ‚¨æ¿€æ´»ä¸€ä¸ªæˆ–å¤šä¸ª Firebase æœåŠ¡ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œç¡®ä¿åœ¨æç¤ºæ—¶ç”¨ä¸€ä¸ªå¤§çš„`Y`æ ‡è®°`Crashlytics`æœåŠ¡æ˜¯å¾ˆé‡è¦çš„ã€‚æœ€åçš„æƒ…å†µæ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡è¿›å…¥`node_modules/nativescript-plugin-firebase`ç›®å½•å¹¶è¿è¡Œ`npm run config`æ¥é‡æ–°é…ç½®æ’ä»¶ã€‚

åœ¨ä½ è¯¢é—®ä¹‹å‰ï¼Œè¯·æ³¨æ„æ‰€æä¾›çš„è¯´æ˜å…è®¸ä¸ NativeScript Core(å³æ™®é€š JavaScript)ã€Angular æˆ– Vue.js ä¸€èµ·ä½¿ç”¨ï¼

## [](#working-with-crashlytics)ä½¿ç”¨ç¢°æ’åˆ†æå·¥å…·

å®‰è£… Firebase æ’ä»¶å¹¶åœ¨åº”ç”¨ç¨‹åºä¸­åˆå§‹åŒ– Firebase åï¼Œæ˜¯æ—¶å€™æ›´ä»”ç»†åœ°ç ”ç©¶ Crashlytics äº†ã€‚

> **æ³¨æ„:**æ­¤æ—¶ï¼Œç¡®ä¿ä½ çš„`firebase.nativescript.json`æ–‡ä»¶æœ‰`"crashlytics": true`å’Œ`"crash_reporting": false`æ ‡æ³¨ã€‚è¿™å°†å¯ç”¨ Crashlytics å¹¶ç¦ç”¨è¾ƒæ—§çš„ Firebase å´©æºƒæŠ¥å‘ŠæœåŠ¡ã€‚å¦‚æœä½ å¿…é¡»å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œåœ¨ä½ çš„åº”ç”¨ä¸­åˆ é™¤`platforms`æ–‡ä»¶å¤¹(å®ƒä¼šåœ¨ä¸‹ä¸€æ¬¡æ„å»ºæ—¶è¿”å›ï¼).

ç°åœ¨ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ å¯ä»¥è¯´ï¼Œâ€œæˆ‘å®Œæˆäº†ï¼â€...ä½ ä¸ä¼šé”™çš„ã€‚Crashlytics *å°†*å¼€å§‹è·Ÿè¸ªåº”ç”¨ç¨‹åºå´©æºƒï¼Œå¹¶åœ¨ Firebase æ§åˆ¶å°ä¸­æ˜¾ç¤ºå®ƒä»¬:

[![app crashes in firebase console](../Images/d7ce98f63650a22dfc2b9b7edb320102.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--8RrDhqY2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/rdlauer/articles/master/nativescript/crashlytics/crashes.png)

ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ï¼åœ¨åº”ç”¨å´©æºƒä¹‹å‰æ•æ‰é”™è¯¯*å¹¶å‘ç”¨æˆ·æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯æ˜¯ä¸€ä¸ªæ›´å¥½çš„åšæ³•ã€‚æœ‰æ—¶æˆ‘ä»¬ä¸èƒ½é¢„æµ‹å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æœ‰å¯èƒ½æ”¹å˜çš„å¤–éƒ¨ä¾èµ–æ—¶(æ¯”å¦‚è¿œç¨‹ API)ï¼Œæˆ‘ä»¬åº”è¯¥è°¨æ…è¡Œäº‹ï¼Œæ£€æŸ¥é”™è¯¯ï¼Œå¹¶è®°å½•å®ƒä»¬ã€‚*

## [](#capturing-an-error)æ•æ‰é”™è¯¯

ä»»ä½•æ—¶å€™ä½ æƒ³æ˜ç¡®åœ°è®°å½•ä¸€ä¸ªé”™è¯¯ï¼Œä½ åªéœ€è¦æ’å…¥ä¸€äº›å¾®å°çš„ä»£ç ç‰‡æ®µã€‚æ‚¨é¦–å…ˆéœ€è¦å¯¼å…¥ Firebase:

```
import * as firebase from 'nativescript-plugin-firebase'; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œè°ƒç”¨ Firebase `sendCrashLog`æ–¹æ³•å°†å®šåˆ¶çš„é”™è¯¯æ—¥å¿—å‘é€åˆ°æ‚¨çš„ Firebase é¡¹ç›®:

```
firebase.sendCrashLog({
  message: 'You screwed up! Here is the error: ' + error,
  showInConsole: true
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> æ‚¨ä¸ä»…å¯ä»¥ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„`message`æ¥ç™»å½• Firebaseï¼Œè¿˜å¯ä»¥é€‰æ‹©åœ¨æ‚¨çš„æ§åˆ¶å°ä¸­æ˜¾ç¤ºç›¸åŒçš„æ¶ˆæ¯ã€‚

å®è·µä¸­ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯`fetch`æ¨¡å—ã€‚ç”±äº`fetch`å¯ä»¥è¢«é…ç½®ä¸º`catch`ä¸€ä¸ªé”™è¯¯å“åº”ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°è®°å½•ä»»ä½•é”™è¯¯:

```
fetch("https://httpbin.org/get")
    .then((response) => response.json())
    .then((r) => {
        // do something with the data!
    })
    .catch((error) => {
        // oh no!
        firebase.sendCrashLog({
          message: 'Error with that one API: ' + error,
          showInConsole: true
        });
    }
); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸è¿‡ï¼Œæƒ…å†µè¶Šæ¥è¶Šå¥½äº†ã€‚ç”±äº`sendCrashLog`è¿”å›äº†ä¸€ä¸ªæ‰¿è¯ºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä¸€äº›æ›´å‹å¥½çš„ UI æé†’æˆ‘ä»¬çš„ç”¨æˆ·æ³¨æ„ä¸€ä¸ªé—®é¢˜(åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªæœ¬åœ°æé†’):

```
firebase.sendCrashLog({

  message: "Error!",

  showInConsole: true

}).then(

    () => {

      alert({

        title: "Sorry!",

        message: "Hey, we screwed up. Just thought you should know.",

        okButtonText: "OK"

      });

    }

); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## 
 [](#faking-an-error) 
ä½œå‡é”™è¯¯

åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­å®ç°é”™è¯¯è®°å½•å½“ç„¶å¾ˆå¥½ï¼Œä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆçŸ¥é“å®ƒåœ¨å·¥ä½œå‘¢ï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œåœ¨ iOS å’Œ Android ä¸Šéƒ½å¾ˆå®¹æ˜“å‡è£…å´©æºƒ:

```
import { isIOS, isAndroid } from 'tns-core-modules/platform';

declare const Crashlytics: any;

public force crash():void {
if(isIOS){
//ä¸€äº›ä¿è¯æŠ›å‡ºå¼‚å¸¸çš„æ— æ„ä¹‰ä»£ç :)
var _ _ error = 1/0ï¼›
} else {
throw new Java . lang . exception(" Forced a exception . ");
 } 
 } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## 
 [](#crashlytics-reporting) 
ä¸é€Ÿä¹‹å®¢

éšç€ä¸€äº›å´©æºƒçš„è®°å½•ï¼Œæ˜¯æ—¶å€™å»ä½ çš„ä¾¿åˆ©çš„ Firebase æ§åˆ¶å°æ£€æŸ¥ä½ çš„æŠ¥å‘Šäº†ï¼

[![crashlytics nativescript example](../Images/b3271546f47d0e6aa7b22aec7a08f7d7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--DAga7Df2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/rdlauer/articles/master/nativescript/crashlytics/crashlytics-example.png)

**å¼€å¿ƒğŸ›æŒ¤å‹ï¼**