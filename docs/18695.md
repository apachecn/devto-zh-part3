# OpenSSH:åŸºäºä¸»æœºçš„é…ç½®ç­‰ã€‚

> åŸæ–‡:[https://dev.to/nabbisen/openssh-configurations-by-hosts-h1g](https://dev.to/nabbisen/openssh-configurations-by-hosts-h1g)

# [](#summary)æ€»ç»“

[OpenSSH](https://www.openssh.com/) æä¾›äº†åŸºäºä¸»æœºç­‰å®šä¹‰é…ç½®çš„æ–¹æ³•ã€‚åŒå…³é”®å­—ï¼Œ [`Host`](https://man.openbsd.org/ssh_config#Host) å’Œ [`Match`](https://man.openbsd.org/ssh_config#Match) ã€‚

### [](#environment)ç¯å¢ƒ

*   SSH å®¢æˆ·ç«¯:OpenSSH 7.9

<center>âœ¿ âœ¿ âœ¿</center>

# [](#basis)ä¾æ®

æ‰“å¼€ [`ssh_config`](https://man.openbsd.org/ssh_config) æ–‡ä»¶ã€‚

```
$  nvim ~/.ssh/config 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åå†™å®šä¹‰ã€‚

##### [](#examples)ä¾‹å­

è¿™é‡Œæ˜¯ä¸€ä¸ªå¤šé‡æ¡ä»¶çš„ä¾‹å­ã€‚
æ¯ä¸ªæ¡ä»¶çš„å®šä¹‰ç›´åˆ°ä¸‹ä¸€ä¸ª`Host`æˆ–`Match`å…³é”®å­—éƒ½æœ‰æ•ˆã€‚

```
# [~/.ssh/config] 
Host %host-name%
    %Parameter-Name%    %parameter-value%

Host %multiple-hosts-name-1% %multiple-hosts-name-2%
    %Parameter-Name%    %parameter-value%

Match {host,originalhost,user,localuser,exec,canonical,final} "%criteria%"
    %Parameter-Name%    %parameter-value%

... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸‹é¢æ˜¯ä¸€ä¸ªå•ä¸ªä¸»æœºä¸­å¤šä¸ªå‚æ•°çš„ç¤ºä¾‹ã€‚
å½“ç„¶ï¼Œåœ¨ä»»ä½•ä¸»æœºä¸­å®šä¹‰æ¯”å…¶ä»–ä¸»æœºæ›´å¤šæˆ–æ›´å°‘çš„å‚æ•°éƒ½æ²¡é—®é¢˜ã€‚(æ³¨æ„é»˜è®¤å€¼ã€‚)

```
# [~/.ssh/config] 
Host %nickname%
    Hostname     %real-hostname%
    Port         %specified-port%
    User         %specified-user%
    IdentityFile ~/.ssh/specified-user_id_rsa
    ServerAliveInterval 60 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨æ„:ç¼©è¿›åªæ˜¯ä¸ºäº†ä¾¿äºæŸ¥çœ‹ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰å¿…è¦ã€‚*

<center>âœ¿ âœ¿ âœ¿</center>

# [](#flexible-definitions)çµæ´»å®šä¹‰

### [](#1-patterns)#1: [å›¾æ¡ˆ](https://man.openbsd.org/ssh_config#PATTERNS)

| *å›¾æ¡ˆ*ç¬¦å· | ä½¿ç”¨ |
| --- | --- |
| `*` | åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚ |
| `?` | æ°å¥½åŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€‚ |
| `!` | å¦å®šç›®æ ‡ã€‚ |

##### [](#examples)ä¾‹å­

```
# [ `*` keyword ]
# any hosts Host *
# any .com domains Host *.com

# [ `?` keyword ]
# 192.168.0.[0-9] Host 192.168.0.?

# [ `!` keyword ]
# any except specified domain Host * !cool-website.com
# any except specified domain and subdomains Host * !cool-website.com !*.cool-website.com
# any 192.168.* except 192.168.0.* Host 192.168.* !192.168.0.* 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨æ„:`!`å…³é”®å­—éœ€è¦åŒ¹é…çš„ç›®æ ‡å’Œå¦å®šçš„ç›®æ ‡:*

*   NG: `Host !some.domain.com`
*   å¥½:`Host * !some.domain.com`

### [](#2-raw-match-endraw-instead-of-raw-host-endraw-)#2: [`Match`](https://man.openbsd.org/ssh_config#Match) ä»£æ›¿ [`Host`](https://man.openbsd.org/ssh_config#Host)

| å…³é”®å­— | ä½¿ç”¨ |
| --- | --- |
| `host` | è¦ç™»å½•çš„çœŸå®ä¸»æœºåã€‚ |
| `originalhost` | åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„ä¸»æœºåã€‚ |
| `user` | è¿œç¨‹ä¸»æœºä¸Šçš„ç›®æ ‡ç”¨æˆ·åã€‚ |
| `localuser` | è¿è¡Œ`ssh`çš„æœ¬åœ°ç”¨æˆ·çš„åç§°ã€‚ |

##### [](#examples)ä¾‹å­

```
# a single condition with a single option Match host "some-domain.com"
# which equals to:
# Host some-domain.com
    IdentityFile ~/.ssh/default_id_rsa

# a single condition with multiple options Match host "specified-domain.com,some.specified-domain.com"
# which equals to:
# Host specified-domain.com some.specified-domain.com
    IdentityFile ~/.ssh/specified-domain_id_rsa

# multiple conditions Match host "specified-domain.com" user "specified-user"
    IdentityFile ~/.ssh/specified-user_id_rsa 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨æ„:ä¸è¦åœ¨å¤šä¸ªé€‰é¡¹ä¹‹é—´åŠ ç©ºæ ¼:*

*   NG: `Match host "specified-domain.com, some.specified-domain.com"`
*   å¥½:`Match host "specified-domain.com,some.specified-domain.com"`

##### [](#optional-more-controls-with-raw-match-endraw-)(å¯é€‰)æ›´å¤šæ§ä»¶åŒ`Match`

| å…³é”®å­— | ä½¿ç”¨ |
| --- | --- |
| `exec` | åœ¨ç”¨æˆ·çš„å¤–å£³ä¸‹æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚å¦‚æœå‘½ä»¤è¿”å›é›¶é€€å‡ºçŠ¶æ€ï¼Œåˆ™è®¤ä¸ºæ¡ä»¶ä¸ºçœŸã€‚è‡ªå˜é‡å¯ä»¥å®šä¹‰ä¸º[è®°å·](https://man.openbsd.org/ssh_config#TOKENS)ã€‚ |
| `canonical` | ä»…å½“åœ¨[ä¸»æœºåè§„èŒƒåŒ–](https://man.openbsd.org/ssh_config#CanonicalizeHostname)åé‡æ–°è§£æé…ç½®æ–‡ä»¶æ—¶åŒ¹é…ã€‚ |
| `final` | è¯·æ±‚é‡æ–°è§£æé…ç½®(ä¸ç®¡ [CanonicalizeHostname](https://man.openbsd.org/ssh_config#CanonicalizeHostname) æ˜¯å¦å¯ç”¨)ï¼Œå¹¶ä¸”ä»…åœ¨æœ€åä¸€æ¬¡é€šè¿‡æ—¶åŒ¹é…ã€‚å¦‚æœå¯ç”¨äº† CanonicalizeHostnameï¼Œåˆ™åœ¨åŒä¸€ä¸ªè¿‡ç¨‹ä¸­ï¼Œcanonical å’Œ final åŒ¹é…ã€‚ |

<center>âœ¿ âœ¿ âœ¿</center>

# ç”¨é€”

### [](#1-configuration-for-specified-hostname)#1:æŒ‡å®šä¸»æœºåçš„é…ç½®

```
Host some.cool-website.com
    User     %user-specified%

Host *
    User     %user-default% 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#2-configurations-by-subdomains)#2:å­åŸŸé…ç½®

```
# specified domain Host cool-website.com
    # write configuration... 
# specified subdomain Host www.cool-website.com
    # write configuration... 
# all subdomains Host *.cool-website.com
    # write configuration... 
# specified domain and subdomains Host cool-website.com *.cool-website.com
# or:
# Match host "cool-website.com,*.cool-website.com"
    # write configuration... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#3-hostname-alias)#3:ä¸»æœºååˆ«å

```
Host %nickname%
    HostName    real.very-long-hostname.com 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#4-port-switching)#4:ç«¯å£åˆ‡æ¢

```
Host %host-with-unique-port%
    Port    %real-port% 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#5-using-an-identity-file)#5:ä½¿ç”¨èº«ä»½æ–‡ä»¶

```
Host www.cool-website.com
    IdentityFile    ~/.ssh/specified_id_rsa 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<center>âœ¿ âœ¿ âœ¿</center>

ä¸ºğŸ•ŠæœåŠ¡æ„‰å¿«