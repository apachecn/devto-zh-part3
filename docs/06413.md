# ä¸ React æŒ‚é’©â€”â€”React æŒ‚é’©ä¸­çš„é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€ï¼Œç¬¬ 2 éƒ¨åˆ†

> åŸæ–‡:[https://dev . to/param Harrison/hooked-with-react-error-handling-and-loading-state-in-react-hooks-part-2-4f 53](https://dev.to/paramharrison/hooked-with-react-error-handling-and-loading-state-in-react-hooks-part-2-4f53)

> åœ¨ [Twitter](https://twitter.com/learnwithparam) ä¸Šå…³æ³¨æˆ‘ï¼Œå¾ˆé«˜å…´æ¥å—æ‚¨å¯¹ä¸»é¢˜æˆ–æ”¹è¿›çš„å»ºè®®

åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å›¾ä¹¦æœç´¢åº”ç”¨ reactã€‚ä½†æ˜¯åœ¨ä» API è·å–æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬æ²¡æœ‰å¤„ç†ä»»ä½•é”™è¯¯æˆ–ä»»ä½•åŠ è½½çŠ¶æ€ã€‚

åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°

*   é”™è¯¯å¤„ç†
*   API è°ƒç”¨çš„åŠ è½½çŠ¶æ€
*   è¾“å…¥çš„åŸºæœ¬éªŒè¯

## [](#error-handling)é”™è¯¯å¤„ç†

ç°åœ¨ï¼Œå¦‚æœæ‚¨å•å‡»è¾“å…¥å€¼ä¸ºç©ºçš„ search æŒ‰é’®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° API è°ƒç”¨é”™è¯¯ã€‚åœ¨æˆ‘ä»¬çš„ä»£ç æ²™ç®±[è¿™é‡Œ](https://codesandbox.io/s/1qm1m9zpnl)å°è¯•ä¸€ä¸‹

è¿™æ˜¯ Google books API è¿”å›çš„å†…å®¹ï¼Œ

```
{  "error":  {  "errors":  [  {  "domain":  "global",  "reason":  "queryRequired",  "message":  "Missing query.",  "locationType":  "parameter",  "location":  "q"  }  ],  "code":  400,  "message":  "Missing query."  }  } 
```

è®©æˆ‘ä»¬ç”¨ä»£ç æ¥å¤„ç†å®ƒï¼Œ

```
// App.js
...

const [searchTerm, setSearchTerm] = useState('');
const [books, setBooks] = useState({items: []});
const [error, setError] = useState(false);

let API_URL = `https://www.googleapis.com/books/v1/volumes`;

const fetchBooks = async () => {
  setError(false);
  try {
    const result = await axios.get(`${API_URL}?q=${searchTerm}`);
    setBooks(result.data);
  }
  catch(error) {
    setError(true);
  }
}

... 
```

æˆ‘ä»¬ä½¿ç”¨`useState`åˆ›å»ºäº†ä¸€ä¸ªå«åš`error`çš„æ–°çŠ¶æ€ã€‚å®ƒè¢«è®¾ç½®åœ¨ catch å—ä¸­ã€‚
`try, catch`æ˜¯å¤„ç†å¼‚æ­¥ã€ç­‰å¾…å‡½æ•°é”™è¯¯çš„å¸¸ç”¨æ–¹æ³•ã€‚

æˆ‘ä»¬è¿˜åœ¨è·å– API ä¹‹å‰å°†é”™è¯¯çŠ¶æ€è®¾ç½®ä¸º falseï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿ä¸‹æ¬¡ API è¿”å›æ­£ç¡®çš„å€¼æ—¶ï¼Œä¸ä¼šå› ä¸ºä¹‹å‰çš„å°è¯•è€Œæ˜¾ç¤ºé”™è¯¯ã€‚å› æ­¤åœ¨å†æ¬¡å°è¯•æå–ä¹‹å‰æ¸…é™¤é”™è¯¯ã€‚

> ä¸ºäº†ä¿æŒå®ç°ç®€å•ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ API ä¸­çš„å®é™…é”™è¯¯å¯¹è±¡ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å‘æœ€ç»ˆç”¨æˆ·æ˜¾ç¤ºé€‚å½“çš„é”™è¯¯ã€‚

è®©æˆ‘ä»¬å‘ç”¨æˆ·æ˜¾ç¤ºé”™è¯¯ï¼Œ

```
// App.js
...

return (
  <section>
    <form onSubmit={onSubmitHandler}>
      <label>
        <span>Search for books</span>
        <input
          type="search"
          placeholder="microservice, restful design, etc.,"
          value={searchTerm}
          onChange={onInputChange}
        />
        <button type="submit">Search</button>
      </label>
      {
        error && <div style={{color: `red`}}>some error occurred, while fetching api</div>
      }
    </form>
    ...
  </section>
);

... 
```

å¦‚æœ API è¿”å›é”™è¯¯ï¼Œæˆ‘ä»¬ä¼šå‘ç”¨æˆ·æ˜¾ç¤ºä¸€æ¡ç®€å•çš„é”™è¯¯æ¶ˆæ¯ã€‚å¤ªå¥½äº†ï¼Œèµ·ä½œç”¨äº†ã€‚è®©æˆ‘ä»¬ç»§ç»­è®¾ç½®`loading`çŠ¶æ€ã€‚è¿™ç±»ä¼¼äºæˆ‘ä»¬å¤„ç†é”™è¯¯çš„æ–¹å¼ã€‚

## [](#loading-state)åŠ è½½çŠ¶æ€

åˆ›å»ºåŠ è½½çŠ¶æ€çš„æ­¥éª¤ï¼Œ

*   ä½¿ç”¨`useState`åˆ›å»ºåŠ è½½çŠ¶æ€
*   åœ¨è·å– API å‰è®¾ç½®åŠ è½½çŠ¶æ€ï¼Œåœ¨ API è°ƒç”¨å®Œæˆåé‡ç½®
*   åŸºäº`loading`çŠ¶æ€å€¼åœ¨ JSX ä¸­è®¾ç½®åŠ è½½å™¨

```
// App.js
...

const [searchTerm, setSearchTerm] = useState('');
const [books, setBooks] = useState({items: []});
const [error, setError] = useState(false);
const [loading, setLoading] = useState(false);

let API_URL = `https://www.googleapis.com/books/v1/volumes`;

const fetchBooks = async () => {
  // set loading Before API operation starts
  setLoading(true);
  setError(false);
  try {
    const result = await axios.get(`${API_URL}?q=${searchTerm}`);
    setBooks(result.data);
  }
  catch(error) {
    setError(true);
  }
  // After API operation end
  setLoading(false);
} 
```

è®©æˆ‘ä»¬åœ¨ JSX ä¸­æ·»åŠ åŠ è½½ç¨‹åº

```
...

return (
  <section>
    <form onSubmit={onSubmitHandler}>
      ...
    </form>
    {
      loading && <div style={{color: `green`}}>fetching books for "<strong>{searchTerm}</strong>"</div>
    }
    <ul>
      {
        books.items.map((book, index) => {
          return (
            ...
          );
        })
      }
    </ul>
  </section>
);

... 
```

[https://codesandbox.io/embed/48j0pqr8w9](https://codesandbox.io/embed/48j0pqr8w9)

è¿™æ˜¯å¯è¡Œçš„ï¼Œæˆ‘ä»¬å·²ç»æ˜¾ç¤ºäº† API è·å–æ—¶çš„åŠ è½½çŠ¶æ€ï¼Œå¹¶åœ¨ API å®Œæˆè·å–å’ŒåŠ è½½åæ˜¾ç¤ºäº†æœç´¢åˆ°çš„ä¹¦ç±ã€‚

è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç®€å•çš„ HTML éªŒè¯ï¼Œä¸å…è®¸ç©ºå­—ç¬¦ä¸²å€¼ï¼Œ

```
<input
  type="search"
  placeholder="microservice, restful design, etc.,"
  value={searchTerm}
  onChange={onInputChange}
  required
/> 
```

ä¼™è®¡ä»¬ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†å›¾ä¹¦æœç´¢åº”ç”¨ç¨‹åºçš„åŠ è½½å’Œé”™è¯¯çŠ¶æ€ã€‚

[https://codesandbox.io/embed/n47kmr7m9j](https://codesandbox.io/embed/n47kmr7m9j)

æˆ‘ä»¬ç³»åˆ—çš„ä¸‹ä¸€æ­¥ï¼Œ

*   é‡æ„ä»£ç ä»¥åˆ†ç¦»ç»„ä»¶
*   å†è°ˆçŠ¶æ€ç®¡ç†
*   æ›´å¤šçš„æ˜¯é€ å‹å’Œæµ‹è¯•

å¸Œæœ›è¿™ä¸ªç³»åˆ—èƒ½å¸®åŠ©ä½ æ„å»ºä¸‹ä¸€ä¸ªå¤§çš„ react åº”ç”¨ğŸ˜…ã€‚è¯·ç»§ç»­å…³æ³¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€éƒ¨åˆ†ğŸ¤—

åœ¨è¿™é‡ŒæŸ¥çœ‹ç¬¬ 2 éƒ¨åˆ†[çš„ä»£ç åº“ï¼Œåœ¨è¿™é‡Œ](https://github.com/learnwithparam/books-series-react-hooks/commit/e4defbf9d8073be796c680c7445278bbc538d5bd)æŸ¥çœ‹æ•´ä¸ªç³»åˆ—çš„ä»£ç åº“[ã€‚](https://github.com/learnwithparam/books-series-react-hooks)

> æ³¨:æœ¬æ–‡æœ€åˆæ˜¯ä¸º[æˆ‘çš„åšå®¢](https://learnwithparam.com/blog/error-handling-in-react-hooks/)å†™çš„ã€‚æˆ‘åœ¨è¿™é‡Œä¸ºç¥å¥‡çš„å¼€å‘è€…ç¤¾åŒºé‡æ–°å‘å¸ƒå®ƒã€‚