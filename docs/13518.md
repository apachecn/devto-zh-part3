# ç¬¬ 015 é›†-ä»å‰ç«¯è°ƒç”¨ Web API-ASP.NET æ ¸å¿ƒ:ä» 0 åˆ°è¿‡åº¦

> åŸæ–‡:[https://dev.to/joaofbantunes/episode-015-ä»å‰ç«¯è°ƒç”¨ç½‘ç»œ API-aspnet-core-from-0-to-over kill-2603](https://dev.to/joaofbantunes/episode-015---calling-the-web-api-from-the-frontend---aspnet-core-from-0-to-overkill-2603)

æ€»ç»“ä¸€ä¸‹ç”¨ Vue.js æ„å»ºçš„å‰ç«¯åº”ç”¨ç¨‹åºï¼Œåœ¨è¿™ä¸€é›†é‡Œï¼Œæˆ‘ä»¬è®©å®ƒä¸æˆ‘ä»¬ç›®å‰å¼€å‘çš„ç»„ç®¡ç† Web API ä¸€èµ·å·¥ä½œã€‚

å¯¹äºæ¼”ç»ƒï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ä¸‹ä¸€ä¸ªè§†é¢‘ï¼Œä½†å¦‚æœæ‚¨å–œæ¬¢å¿«é€Ÿé˜…è¯»ï¼Œè¯·è·³åˆ°ä¹¦é¢ç»¼åˆã€‚

[https://www.youtube.com/embed/ZF_uhOjMqsU](https://www.youtube.com/embed/ZF_uhOjMqsU)

æ•´ä¸ªç³»åˆ—çš„æ’­æ”¾åˆ—è¡¨æ˜¯[è¿™é‡Œæ˜¯](https://www.youtube.com/playlist?list=PLN0oN9Azm_MMAjk3nhRnmHdr1l0160Dhs)ã€‚
T3ã€‘

## [T1ã€‘ç®€ä»‹](#intro)

åœ¨è¿™ä¸€é›†é‡Œï¼Œæˆ‘ä»¬å°†é€šè¿‡å¯¹ç»„æœåŠ¡è¿›è¡Œ HTTP è°ƒç”¨æ¥è¿æ¥å‰ç«¯å’Œåç«¯ã€‚ä¸ºäº†è¿›è¡Œ HTTP è°ƒç”¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [axios](https://github.com/axios/axios) ã€‚

## [](#service-client-interface)æœåŠ¡å®¢æˆ·ç«¯ç•Œé¢

æˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ¥å£æ¥è¡¨ç¤ºæˆ‘ä»¬çš„ç»„æœåŠ¡å®¢æˆ·ç«¯ã€‚åƒå¾€å¸¸ä¸€æ ·ï¼Œåœ¨è¿™äº›å‰ç«¯å¸–å­ä¸­ï¼Œè¿™ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†æ˜¯æˆ‘å€¾å‘äºæ”¾å¼ƒæˆ‘çš„ C#ä¹ æƒ¯ğŸ™‚

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨`src`ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`data`çš„æ–°æ–‡ä»¶å¤¹ã€‚åœ¨æ–°æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å¦ä¸€ä¸ªåä¸º`models`çš„æ–‡ä»¶å¤¹ï¼Œç”¨æ¥ä¿å­˜ä»£è¡¨æˆ‘ä»¬ä»æœåŠ¡ä¸­è·å–(å’Œå‘é€)çš„æ¨¡å‹ã€‚

`data\models\group-model.ts`

```
export interface GroupModel {
    id: number;
    name: string;
    rowVersion: string;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`GroupModel`ä¸æˆ‘ä»¬åœ¨å…¶ä»–åº”ç”¨é¢†åŸŸçœ‹åˆ°çš„ä¸€æ ·ã€‚è®©æˆ‘ä»¬è¿›å…¥ä¸€äº›æ–°çš„ä¸œè¥¿ï¼ŒæœåŠ¡å®¢æˆ·ç«¯æ¥å£ï¼Œ`GroupsEndpoint`(å°±å‘½åè€Œè¨€ï¼Œè¿™ä¸æ˜¯æˆ‘æœ€å¥½çš„ä¸€é›†ğŸ˜›).

`data\groups-endpoint.ts`

```
import { GroupModel } from './models/group-model';

export interface GroupsEndpoint {
    getAll(): Promise<GroupModel[]>;
    getById(id: number): Promise<GroupModel>;
    add(group: GroupModel): Promise<GroupModel>;
    update(group: GroupModel): Promise<GroupModel>;
    remove(id: number): Promise<void>;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ è®°å¾—æˆ‘ä»¬åœ¨ã€ŠT2ã€‹ç¬¬ 12 é›†ä¸­çš„`GroupsService`ï¼Œè¿™å°†æ˜¯éå¸¸ç†Ÿæ‚‰çš„ã€‚åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯æ”¹ç¼–æˆäº† TypeScriptã€‚æ‰€æœ‰æ–¹æ³•åœ¨æ‰§è¡Œ IO æ“ä½œæ—¶éƒ½è¿”å›`Promise`ã€‚

## [](#service-client-implementation)æœåŠ¡å®¢æˆ·ç«¯å®ç°

åœ¨å®ç°æœåŠ¡å®¢æˆ·ç«¯ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å°† axios æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚å½“æˆ‘ä½¿ç”¨ npm æ—¶ï¼Œæˆ‘æ˜¯é€šè¿‡è¿è¡Œ`npm install --save axios`æ¥å®Œæˆçš„ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥å®ç°æˆ‘ä»¬å®šä¹‰çš„æ¥å£äº†ã€‚

`data\groups-service.ts`

```
import { GroupsEndpoint } from './groups-endpoint';
import axios from 'axios';
import { GroupModel } from './models/group-model';

// TODO: handle eventual errors

export class GroupsService implements GroupsEndpoint {
    private readonly baseUrl: string = '/api/groups';

    public async getAll(): Promise<GroupModel[]> {
        const response = await axios.get(this.baseUrl);
        return response.data;
    }

    public async getById(id: number): Promise<GroupModel> {
        const response = await axios.get(`${this.baseUrl}/${id}`);
        return response.data;
    }

    public async add(group: GroupModel): Promise<GroupModel> {
        const response = await axios.post(this.baseUrl, group);
        return response.data;
    }

    public async update(group: GroupModel): Promise<GroupModel> {
        const response = await axios.put(`${this.baseUrl}/${group.id}`, group);
        return response.data;
    }

    public async remove(id: number): Promise<void> {
        const response = await axios.delete(`${this.baseUrl}/${id}`);
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ²¡ä»€ä¹ˆå¥½è§£é‡Šçš„ï¼Œä½†æ˜¯è®©æˆ‘ä»¬æ¥çœ‹çœ‹ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºè¯·æ±‚å®šä¹‰äº†ä¸€ä¸ªåŸºæœ¬ urlã€‚æ³¨æ„ï¼Œå®ƒä»¥`/api`å¼€å§‹ï¼Œä½†è¿™ä¸æ˜¯æˆ‘ä»¬åœ¨æœåŠ¡ä¸­å®šä¹‰çš„è·¯çº¿çš„ä¸€éƒ¨åˆ†ã€‚å…³äºå¼€å‘æœåŠ¡å™¨ä»£ç†ï¼Œæˆ‘ä»¬ç¨åä¼šçœ‹åˆ°åŸå› ã€‚

å…³äºæ–¹æ³•å®ç°ï¼Œå®ƒä»¬éƒ½æ˜¯åˆ©ç”¨ axios æ¥å‘å‡ºè¯·æ±‚ï¼Œä½¿ç”¨æˆ‘ä»¬åœ¨åˆ›å»º web API æ—¶å®šä¹‰çš„å„ç§ HTTP æ–¹æ³•ã€‚

æˆ‘ä»¬è¿˜æ²¡æœ‰ä»»ä½•é”™è¯¯å¤„ç†é€»è¾‘ï¼Œæˆ‘ä»¬æœ€ç»ˆåº”è¯¥å®ç°å®ƒï¼Œä½†ç°åœ¨å®ƒä¸æ˜¯å¾ˆé‡è¦ã€‚

## [](#using-the-service-client-in-vuex-actions)åœ¨ Vuex åŠ¨ä½œä¸­ä½¿ç”¨æœåŠ¡å®¢æˆ·ç«¯

æ—¢ç„¶æˆ‘ä»¬å·²ç»å®ç°äº†æœåŠ¡å®¢æˆ·æœºï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ“ä½œä¸­ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬å¯ä»¥åªå¯¼å…¥`GroupsService`å¹¶åœ¨åŠ¨ä½œå®ç°ä¸­ä½¿ç”¨å®ƒï¼Œä½†æ˜¯ä¸ºäº†åœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™æ›´å®¹æ˜“æµ‹è¯•åŠ¨ä½œï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ¥æ”¶`GroupsEndpoint`å®ä¾‹çš„å·¥å‚ã€‚

`store/modules/groups/actions.ts`

```
import { ActionTree } from 'vuex';
import { GroupsState, Group } from './state';
import { RootState } from '@/store/state';
import { GroupsEndpoint } from '@/data/groups/groups-endpoint';

export const types = {
    LOAD_GROUPS: 'groups/loadGroups',
    ADD_GROUP: 'groups/add',
    UPDATE_GROUP: 'groups/update',
    REMOVE_GROUP: 'groups/remove'
};

export const makeActions = (groupsEndpoint: GroupsEndpoint): ActionTree<GroupsState, RootState> => {
    return {
        async loadGroups({ commit }): Promise<void> {
            const groups = await groupsEndpoint.getAll();
            commit('setGroups', groups);
        },
        async add({ commit }, group: Group): Promise<void> {
            const addedGroup = await groupsEndpoint.add(group);
            commit('add', addedGroup);
        },
        async update({ commit }, group: Group): Promise<void> {
            const updatedGroup = await groupsEndpoint.update(group);
            commit('update', updatedGroup);
        },
        async remove({ commit }, groupId: number): Promise<void> {
            await groupsEndpoint.remove(groupId);
            commit('remove', groupId);
        }
    };
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

çœ‹ä¸€çœ‹ï¼ŒåŠ¨ä½œé€»è¾‘å‡ ä¹æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬åœ¨å°†å€¼ä¼ é€’ç»™æ›´æ–°çŠ¶æ€çš„çªå˜ä¹‹å‰å‘å‡º API è¯·æ±‚ã€‚è¿™äº›åŠ¨ä½œä¹Ÿå˜æˆäº†`async`ï¼Œå› ä¸ºå®ƒä»¬ä¹Ÿè°ƒç”¨äº†å¼‚æ­¥æœåŠ¡æ–¹æ³•ã€‚

æ³¨æ„ï¼Œåœ¨`add`å’Œ`update`åŠ¨ä½œä¸­ï¼Œæˆ‘ä»¬å°†æ¥è‡ªæœåŠ¡çš„å“åº”ä¼ é€’ç»™çªå˜ï¼Œè€Œä¸æ˜¯åŠ¨ä½œè´Ÿè½½ã€‚è¿™æ˜¯å› ä¸ºæœ‰ä¸€äº›å±æ€§æ˜¯åœ¨æœåŠ¡å™¨ç«¯åˆå§‹åŒ–æˆ–æ›´æ–°çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜è¿™äº›ä¿¡æ¯ã€‚

## [](#configure-development-server-proxy)é…ç½®å¼€å‘æœåŠ¡å™¨ä»£ç†

å¦‚æœæ‚¨è¿˜è®°å¾—æˆ‘ä»¬å¼€å‘ API æ—¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å¯ç”¨ CORSï¼Œå› ä¸ºæˆ‘ä»¬å°†ä»åŒä¸€ä¸ªåŸŸä¸­æœåŠ¡å‰ç«¯å’Œ APIã€‚å½“æ‰€æœ‰è¿™äº›éƒ½åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šä¸€èµ·å·¥ä½œæ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåå‘ä»£ç†å°†è¯·æ±‚æ˜ å°„åˆ°åç«¯æœåŠ¡ï¼Œå…¶ä¸­è·¯ç”±ä»¥`/api`å¼€å§‹ï¼Œå…¶ä½™çš„å°†åˆ°è¾¾å‰ç«¯ã€‚

ä¸ºäº†åœ¨å¼€å‘è¿‡ç¨‹ä¸­å®ç°ç±»ä¼¼çš„ç›®æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½® Vue çš„å¼€å‘æœåŠ¡å™¨æ¥ä»£ç† API è¯·æ±‚ã€‚

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­ï¼Œåœ¨`src`ä¹‹ä¸Šï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`vue.config.js`çš„æ–°æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­è®¾ç½® dev æœåŠ¡å™¨æ¥ä»£ç† API è¯·æ±‚ã€‚

`vue.config.js`

```
module.exports = {
    devServer: {
      proxy: {
        '^/api': {
          target: 'http://localhost:5000',
          ws: true,
          changeOrigin: true,
          pathRewrite: {
            '^/api': ''
          },
        }
      }
    }
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è¯´æ‰€æœ‰ä»¥`/api`å¼€å§‹çš„è¯·æ±‚éƒ½åˆ°äº†`http://localhost:5000`ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»åœ¨è¿™é‡Œæ‰˜ç®¡äº† dev ä¸­çš„ APIã€‚è¿˜æœ‰ä¸€äº›é€‰é¡¹ï¼Œä½†æœ€ç›¸å…³çš„æ˜¯è·¯å¾„é‡å†™ï¼Œå®ƒä»è·¯ç”±ä¸­åˆ é™¤äº†`/api`ï¼Œå› ä¸ºå®ƒä¸åœ¨ç»„æœåŠ¡ API ä¸­ã€‚å¯¹äºè¿™ä¸¤ä¸ªå¸ƒå°”å€¼ï¼Œ`ws`æ„å‘³ç€æˆ‘ä»¬ä¹Ÿä»£ç† web å¥—æ¥å­—è¯·æ±‚ï¼Œè€Œ`changeOrigin`å°†ä¸»æœºå¤´çš„æ¥æºæ›´æ”¹ä¸ºç›®æ ‡ urlã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œå’Œè¿™é‡Œçœ‹åˆ°æ›´å¤šè¿™äº›é…ç½®[ã€‚](https://cli.vuejs.org/config/#devserver-proxy)

## [](#outro)å…¶ä»–

é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ç»“æŸäº†è¿™ä¸ªç³»åˆ—çš„ç¬¬ä¸€æ¬¡å‰ç«¯å†’é™©ã€‚åœ¨è¿™ 3 é›†ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªç®€å•çš„ Vue.js åº”ç”¨ç¨‹åºï¼Œå®ƒå…è®¸éå¸¸ç®€å•çš„ç»„ç®¡ç†ã€‚æˆ‘ä»¬åˆ©ç”¨äº†ç»„ä»¶ï¼Œä¸€ä¸ªå•†åº—ï¼Œå¹¶ä½¿å®ƒä¸ web API å¾ˆå¥½åœ°é…åˆã€‚

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å›åˆ° C#ï¼Œä½†æˆ‘ä»¬æœ€ç»ˆå½“ç„¶ä¼šå›åˆ°å‰ç«¯ã€‚

å¸–å­ä¸­çš„é“¾æ¥:

*   vista . js
*   [è½´](https://github.com/axios/axios)
*   [æ£€è§† CLI - devServer.proxy](https://cli.vuejs.org/config/#devserver-proxy)
*   [http-ä»£ç†-ä¸­é—´ä»¶](https://github.com/chimurai/http-proxy-middleware)

è¿™ä¸ªå¸–å­çš„æºç æ˜¯[è¿™é‡Œ](https://github.com/AspNetCoreFromZeroToOverkill/WebFrontend/tree/episode015)ã€‚

æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼

è°¢è°¢ä½ çš„æ¥è®¿ï¼Œè¥¿é˜¿å…¹ï¼