# å¦‚ä½•ä¸ºå¤šä¸ªäº§å“ç¯å¢ƒè®¾ç½® AWS å¸æˆ·

> åŸæ–‡:[https://dev . to/pauls wail/how-to-setup-AWS-accounts-for-multiple-product-environments-4bl 6](https://dev.to/paulswail/how-to-set-up-aws-accounts-for-multiple-product-environments-4bl6)

ä½œä¸ºæˆ‘æ­£åœ¨è¿›è¡Œçš„é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘æ­£åœ¨å»ºç«‹ä¸¤ä¸ªæ–°çš„ AWS è´¦æˆ·ï¼Œä»¥ä¾¿:

*   æ‰˜ç®¡æˆ‘å°†åœ¨è¿ç§»è¿‡ç¨‹ä¸­åˆ›å»ºçš„æ‰€æœ‰æ–°èµ„æº(API Gatewayã€Lambda ç­‰)
*   é€æ¸å°†ç°æœ‰èµ„æºä»ééš”ç¦»çš„æ—§å¸æˆ·è¿ç§»åˆ°æ–°å¸æˆ·ä¸­
*   ç¡®ä¿ç”Ÿäº§èµ„æºä¸ä¼šå—åˆ°æ„å¤–å¹²æ‰°
*   è®©æˆ‘çš„å¼€å‘å·¥ä½œæµç¨‹å°½å¯èƒ½é«˜æ•ˆ

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä»‹ç»å¦‚ä½•å»ºç«‹ä¸€ä¸ªç»„ç»‡ç»“æ„ï¼Œåˆ›å»ºä¸¤ä¸ªå¸æˆ·(å¼€å‘/è¯•è¿è¡Œå’Œç”Ÿäº§)ï¼Œåˆ›å»º IAM ç”¨æˆ·ï¼Œå¹¶é…ç½®æ‚¨çš„ CLIï¼Œä»¥ä¾¿å°†æ¥æ˜“äºç®¡ç†ã€‚

## [](#organization-structure)ç»„ç»‡ç»“æ„

æˆ‘å°†ä½¿ç”¨ [AWS ç»„ç»‡](https://aws.amazon.com/organizations/)æ¥åˆ›å»ºå¸æˆ·ã€‚

*æ³¨æ„:å¦‚æœä½ åœ¨ä¸€ä¸ªå…¬å¸ç¯å¢ƒä¸­ï¼Œä½ æ— æƒè®¿é—®ç»„ç»‡æˆ–ä¸»å¸æˆ·ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦è®©ä¸»å¸æˆ·ä¸­çš„ç®¡ç†å‘˜ä¸ºä½ åšè¿™ä»¶äº‹ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥è·³åˆ°ä¸‹é¢çš„[è®¾ç½® CLI è®¿é—®](#setting-up-cli-access)éƒ¨åˆ†ã€‚*

æˆ‘å·²ç»æœ‰äº†ä¸€ä¸ªä»¥æˆ‘å…¬å¸åç§°å‘½åçš„ä¸»å¸æˆ·ï¼Œä»¥åŠä¸€ä¸ªç°æœ‰çš„å­å¸æˆ·(ä»¥åç§°ä¸ºâ€œä¼ ç»Ÿâ€å¸æˆ·)ï¼Œæˆ‘å½“å‰çš„æ‰€æœ‰åŸºç¡€æ¶æ„éƒ½æ‰˜ç®¡åœ¨è¯¥å­å¸æˆ·ä¸­ã€‚æ­¤ä¼ ç»Ÿå¸æˆ·åŒ…å«å¼€å‘/è¯•è¿è¡Œå’Œç”Ÿäº§é˜¶æ®µçš„èµ„æºï¼Œä»¥åŠä¸€äº›ä¸äº§å“æ— å…³çš„é™æ€ç½‘ç«™ã€‚æˆ‘çš„é•¿æœŸç›®æ ‡æ˜¯å°†é€‚å½“çš„èµ„æºè½¬ç§»åˆ°æ–°å®¢æˆ·ä¸­ï¼Œå¹¶å½»åº•æ¸…é™¤æ—§å®¢æˆ·ã€‚

æˆ‘è¿˜å°†ä¸ºè¯¥äº§å“ä½¿ç”¨ä¸€ä¸ªâ€œç»„ç»‡å•ä½â€ï¼Œä»¥é˜²å°†æ¥æˆ‘å¸Œæœ›å¯¹è¯¥äº§å“çš„æ‰€æœ‰å¸æˆ·åº”ç”¨ç­–ç•¥ï¼Œä½†ä¸è§¦åŠä¸æˆ‘çš„å…¶ä»–äº§å“ç›¸å…³çš„å¸æˆ·ã€‚

ä»¥ä¸‹æ˜¯æˆ‘çš„ç»„ç»‡ç»“æ„:

*   ğŸ `winterwindsoftware`(ä¸»å…¬å¸è´¦æˆ·ï¼Œæ­¤å¤„ä¸ºè´¦å•)
    *   ğŸ”‘`root`(æ ¹ç”¨æˆ·ï¼ŒMFA)
    *   ğŸ—‚ `autochart`(ç‰¹å®šäº§å“çš„ç»„ç»‡å•ä½)
        *   ğŸ `autochart_legacy`
            *   ğŸ”‘`root`(æ ¹ç”¨æˆ·ï¼ŒMFA)
            *   ğŸ‘¥`sysadmins` (IAM ç»„ï¼Œç®¡ç†å‘˜è®¿é—®ç­–ç•¥)
            *   ğŸ‘¤`paul` (IAM ç”¨æˆ·ï¼Œåœ¨`sysadmins`ï¼ŒMFA)
        *   ğŸ  **`autochart_dev`** (æ–°è´¦æˆ·ï¼Œç”¨äºå¼€å‘å’Œæš‚å­˜èµ„æº)
            *   ğŸ”‘`root`(æ ¹ç”¨æˆ·ï¼ŒMFA)
            *   ğŸ‘¥`sysadmins` (IAM ç»„ï¼Œç®¡ç†å‘˜è®¿é—®ç­–ç•¥)
            *   ğŸ‘¤`paul` (IAM ç”¨æˆ·ï¼Œåœ¨`sysadmins`ï¼ŒMFA å¯é€‰)
        *   ğŸ  **`autochart_prod`** (æ–°è´¦æˆ·ï¼Œé’ˆå¯¹ç”Ÿäº§ä¸“ç”¨èµ„æº)
            *   ğŸ”‘`root`(æ ¹ç”¨æˆ·ï¼ŒMFA)
            *   ğŸ‘¥`sysadmins` (IAM ç»„ï¼Œç®¡ç†å‘˜è®¿é—®ç­–ç•¥)
            *   ğŸ‘¤`paul` (IAM ç”¨æˆ·ï¼Œåœ¨`sysadmins`ï¼ŒMFA)

ä½¿ç”¨ [AWS ç»„ç»‡æ§åˆ¶å°](https://console.aws.amazon.com/organizations)åˆ›å»ºæ‚¨è‡ªå·±çš„ç»“æ„æ—¶ï¼Œæ‚¨å¯ä»¥ç”¨æ‚¨çš„äº§å“åç§°æ›¿æ¢ä¸Šé¢çš„`autochart`ã€‚

é¦–å…ˆï¼Œä»¥ root ç”¨æˆ·èº«ä»½ç™»å½•ä¸»å¸æˆ·ï¼Œåˆ›å»ºä¸¤ä¸ªæ–°å¸æˆ·ï¼Œè¾“å…¥æ‚¨å¸Œæœ›ç”¨äºå­å¸æˆ· root ç™»å½•çš„å¸æˆ·åç§°å’Œç”µå­é‚®ä»¶åœ°å€ã€‚

ğŸ”¥*æç¤º:åƒä¸‡ä¸è¦ä½¿ç”¨ä¸ç°æœ‰ä¸ªäºº Amazon.com è´¦æˆ·å…³è”çš„ç”µå­é‚®ä»¶åœ°å€ä½œä¸ºä½ çš„ root ç™»å½•ï¼Œå› ä¸º[ç›®å‰æ²¡æœ‰åŠæ³•å°†å…¶ä¸ AWS è´¦æˆ·](https://forums.aws.amazon.com/thread.jspa?threadID=85882)æ–­å¼€ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Gmail/Gsuite ç”µå­é‚®ä»¶åœ°å€ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨åœ°å€çš„ç¬¬ä¸€éƒ¨åˆ†åæ·»åŠ ä¸€ä¸ªåŠ å·æ¥ä¸ºæ¯ä¸ªå¸æˆ·ä½¿ç”¨åˆ«ååœ°å€ï¼Œä¾‹å¦‚`paul+myproduct_dev@mycompany.com`å’Œ`paul+myproduct_prod@mycompany.com`* ã€‚

åº”å¯¹æ¯ä¸ªæ–°è´¦æˆ·é‡å¤ä»¥ä¸‹æ­¥éª¤ã€‚

ğŸ”¥æç¤º:æˆ‘å¼ºçƒˆå»ºè®®ä½¿ç”¨å¯†ç ç®¡ç†å™¨æ¥ä¸ºä½ å°†è¦è®¾ç½®çš„æ‰€æœ‰ç”¨æˆ·å­˜å‚¨å’Œç”Ÿæˆå¼ºå¯†ç ã€‚æˆ‘ä½¿ç”¨[1 å¯†ç ](https://1password.com/)ï¼Œå®ƒä¹Ÿæä¾› 2 å› ç´ è®¤è¯åŠŸèƒ½ã€‚

## [](#logging-in-to-new-accounts-for-first-time-as-root-user)ä»¥ root ç”¨æˆ·èº«ä»½é¦–æ¬¡ç™»å½•æ–°è´¦æˆ·

ä¸ºäº†ä»¥ root ç”¨æˆ·èº«ä»½é¦–æ¬¡ç™»å½•æ‚¨æ–°åˆ›å»ºçš„å¸æˆ·ï¼Œæ‚¨éœ€è¦æ ¹æ®[AWS æ–‡æ¡£](https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_accounts_access.html#orgs_manage_accounts_access-as-root)ä½¿ç”¨å¯†ç é‡ç½®æµç¨‹ğŸ¤”ã€‚

ğŸ”¥*æç¤º:åœ¨æ­¤ä¹‹å‰ï¼Œç”±äºæ‚¨å°†ç™»å½•å¤šä¸ª AWS å¸æˆ·ï¼Œ[åœ¨æ­¤é˜¶æ®µä¸ºæ‚¨çš„å¼€å‘å’Œç”Ÿäº§ç”¨æˆ·è®¾ç½®ä¸åŒçš„æµè§ˆå™¨é…ç½®æ–‡ä»¶](https://winterwindsoftware.com/aws-console-multiple-users/)ï¼Œä»¥ä¾¿äºåŒæ—¶è®¿é—®æ¯ä¸ªå¸æˆ·ï¼Œå¹¶é€šè¿‡ä¸»é¢˜ç›´è§‚åœ°åŒºåˆ†æ¯ä¸ªå¸æˆ·ã€‚*

## [](#activate-multifactor-auth-for-root-user-and-create-an-individual-iam-user)ä¸ºæ ¹ç”¨æˆ·æ¿€æ´»å¤šå› ç´ æˆæƒï¼Œå¹¶åˆ›å»ºå•ä¸ª IAM ç”¨æˆ·

å½“æ‚¨ä»¥ root ç”¨æˆ·èº«ä»½æ‰“å¼€ [IAM æ§åˆ¶å°](https://console.aws.amazon.com/iam)æ—¶ï¼Œæ‚¨ä¼šçœ‹åˆ°å¦‚ä¸‹æ¸…å•:

[![IAM checklist](../Images/f63388fa33de1e771d031814f9c02b4c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--lCkFzQYC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://winterwindsoftware.com/img/blog-images/iam-dashboard.png)

æ‚¨ç°åœ¨åº”è¯¥åœ¨æ‚¨çš„ root å¸æˆ·ä¸Šæ¿€æ´» MFAï¼Œç„¶åå®Œæˆå‰©ä½™çš„æ­¥éª¤ã€‚
å…·ä½“æ¥è¯´ï¼Œä½ åº”è¯¥ç”¨è‡ªå·±çš„åå­—ä¸ºè‡ªå·±åˆ›å»ºä¸€ä¸ªç”¨æˆ·ã€‚ç¡®ä¿ä¸ºç”¨æˆ·å¯ç”¨ç¼–ç¨‹å’Œæ§åˆ¶å°è®¿é—®ã€‚æˆ‘å°†è¿™ä¸ªç”¨æˆ·æ·»åŠ åˆ°ä¸€ä¸ªæ–°åˆ›å»ºçš„`sysadmins`ç»„ä¸­ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ äº†`AdministratorAccess`ç­–ç•¥ã€‚

[![Create IAM Group](../Images/2034b981c4ba3cbc85d204d143ac9fec.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--aD_9Y1tW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://winterwindsoftware.com/img/blog-images/iam-group.png)

## [](#create-account-alias-for-console-login)ä¸ºæ§åˆ¶å°ç™»å½•åˆ›å»ºè´¦æˆ·åˆ«å

åœ¨ [IAM æ§åˆ¶å°](https://console.aws.amazon.com/iam)çš„ä»ªè¡¨æ¿ä¸­ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå‹å¥½çš„ URL æ¥ç™»å½•æ§åˆ¶å°ã€‚è¿™ä½¿æ‚¨ä¸å¿…æ¯æ¬¡éƒ½åœ¨ç™»å½•è¡¨å•ä¸­è¾“å…¥å¸æˆ· IDã€‚

[![IAM console URL alias](../Images/e2e09f69b06db5b63041cb59e659c102.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--1b1_zJ2_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://winterwindsoftware.com/img/blog-images/iam-url-alias.png)

## [](#enable-mfa-for-your-production-accounts-iam-user)ä¸ºæ‚¨çš„ç”Ÿäº§å¸æˆ·çš„ IAM ç”¨æˆ·å¯ç”¨ MFA

è¿™å¯¹äºæ‚¨çš„ dev å¸æˆ·æ¥è¯´å¹¶ä¸æ˜¯ç»å¯¹å¿…è¦çš„ï¼Œä½†æ˜¯å› ä¸ºæˆ‘æˆäºˆäº†æˆ‘çš„ IAM ç”¨æˆ·å®Œå…¨çš„ç®¡ç†å‘˜æƒé™ï¼Œæ‰€ä»¥æˆ‘æƒ³ç¡®ä¿å®ƒå°½å¯èƒ½çš„å®‰å…¨ã€‚

è¦ä¸ºæ‚¨çš„ IAM ç”¨æˆ·å¯ç”¨ MFAï¼Œè¯·ä»¥ root ç”¨æˆ·èº«ä»½æ³¨é”€æ§åˆ¶å°ï¼Œç„¶åä»¥æ‚¨ä¸ºè‡ªå·±åˆ›å»ºçš„ IAM ç”¨æˆ·èº«ä»½é‡æ–°ç™»å½•ï¼Œè½¬åˆ°â€œç”¨æˆ·â€->â€œæ‚¨çš„ç”¨æˆ·â€->â€œå®‰å…¨å‡­æ®â€é€‰é¡¹å¡ï¼Œå¹¶æŸ¥æ‰¾åˆ†é…çš„ MFA è®¾å¤‡ã€‚

æ‚¨åº”è¯¥å°†è¿™ä¸ª IAM ç”¨æˆ·ç”¨äºå°†æ¥å‡ ä¹æ‰€æœ‰çš„æ§åˆ¶å°è®¿é—®ã€‚

## [](#setting-up-cli-access)è®¾ç½® CLI è®¿é—®

è™½ç„¶æˆ‘å·²ç»ä½¿ç”¨ AWS æ§åˆ¶å°å®Œæˆäº†ä¸Šè¿°æ­¥éª¤ï¼Œä½†å‡ ä¹æ‰€æœ‰æœªæ¥çš„é…ç½®å’Œèµ„æºç®¡ç†éƒ½å°†é€šè¿‡ç¼–ç¨‹å®Œæˆï¼Œè¦ä¹ˆé€šè¿‡ AWS CLIã€Javascript SDKï¼Œè¦ä¹ˆé€šè¿‡å¦ä¸€ç§åŸºç¡€è®¾æ–½ä½œä¸ºä»£ç å·¥å…·(ä¾‹å¦‚æ— æœåŠ¡å™¨æ¡†æ¶æˆ– CloudFormation)ã€‚

æ‰€ä»¥ä¸‹ä¸€æ­¥æ˜¯[ä½¿ç”¨ç»ˆç«¯å®‰è£… AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html) ã€‚ç„¶å[é…ç½® CLIï¼Œä½¿ç”¨ä¹‹å‰ä¸ºæ‚¨çš„ IAM ç”¨æˆ·](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html)ç”Ÿæˆçš„è®¿é—®å¯†é’¥å’Œå¯†ç ã€‚ä¸è¦åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ‚¨æ„å¤–åœ°å¯¹é”™è¯¯çš„å¸æˆ·è¿è¡Œå‘½ä»¤ã€‚è¯·åˆ›å»ºä¸€ä¸ªå‘½åçš„æ¦‚è¦æ–‡ä»¶ã€‚æˆ‘å–œæ¬¢ä½¿ç”¨ä¸‹é¢çš„æƒ¯ä¾‹æ¥å‘½åæ¦‚è¦æ–‡ä»¶`<productname>_<environment>_<username>`ï¼Œä¾‹å¦‚

```
 aws configure â€”-profile myproduct_dev_paul
# ... enter your access ID, secret key and default region when prompted 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‹¥æœ‰è¿™æ ·ç‹¬ç«‹çš„æ¦‚è¦æ–‡ä»¶ä½¿å¾—åœ¨ä½ çš„æ— æœåŠ¡å™¨æ¡†æ¶æœåŠ¡ä¸­[è®¾ç½®æ¯ä¸ªé˜¶æ®µçš„æ¦‚è¦æ–‡ä»¶](https://serverless-stack.com/chapters/configure-multiple-aws-profiles.html#set-profiles-per-stage)å˜å¾—å®¹æ˜“ã€‚

## [](#creating-more-users)åˆ›å»ºæ›´å¤šç”¨æˆ·

è™½ç„¶æˆ‘åªæ˜¯ä¸€ä¸ªå›¢é˜Ÿä¸­çš„ä¸€ä¸ªäººåœ¨å¼€å‘æˆ‘çš„äº§å“ï¼Œä½†æœ‰å¯èƒ½ä½ å›¢é˜Ÿä¸­çš„å…¶ä»–åŒäº‹ä¹Ÿéœ€è¦è®¿é—®ã€‚æ‚¨å¯ä»¥åƒåˆ›å»ºè‡ªå·±çš„ IAM ç”¨æˆ·ä¸€æ ·ï¼Œå°†ä»–ä»¬è®¾ç½®ä¸º IAM ç”¨æˆ·ã€‚æ‚¨éœ€è¦è‡ªå·±åˆ¤æ–­æˆäºˆä»–ä»¬ä»€ä¹ˆçº§åˆ«çš„è®¿é—®æƒé™ã€‚AdministratorAccess å¯¹äº dev å¸æˆ·å¯èƒ½æ²¡é—®é¢˜ï¼Œä½†æ˜¯æ‚¨å¯èƒ½å¸Œæœ›é™åˆ¶æŸäº›å›¢é˜Ÿæˆå‘˜å¯¹ç”Ÿäº§å¸æˆ·çš„è®¿é—®ã€‚

## [](#unsubscribe-from-marketing-emails)é€€è®¢è¥é”€é‚®ä»¶

æœ€åï¼Œä½¿ç”¨[è¿™ä¸ªè¡¨æ ¼](https://pages.awscloud.com/communication-preferences.html)å–æ¶ˆè®¢é˜…ä½œä¸ºä½ çš„æ ¹ç”¨æˆ·çš„ä¸¤ä¸ªç”µå­é‚®ä»¶åœ°å€ã€‚

* * *

ğŸ’Œ ***å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥æ³¨å†Œ[åˆ°æˆ‘çš„å…³äºåœ¨ AWS ä¸­æ„å»ºæ— æœåŠ¡å™¨ç½‘ç»œåº”ç”¨çš„æ¯å‘¨æ—¶äº‹é€šè®¯](https://winterwindsoftware.com/newsletter/)ã€‚***
ä½ ä¹Ÿå¯èƒ½ä¼šå–œæ¬¢:

*   [29 æ‹…å¿ƒæ— æœåŠ¡å™¨å¸¦èµ°](https://winterwindsoftware.com/concerns-that-serverless-takes-away/)
*   [ç”Ÿäº§ä¸­çš„ AWS æ— æœåŠ¡å™¨åº”ç”¨æ¡ˆä¾‹ç ”ç©¶](https://winterwindsoftware.com/real-world-serverless-case-studies/)
*   [â€œæ— æœåŠ¡å™¨â€çš„ä¸åŒå®šä¹‰](https://winterwindsoftware.com/serverless-definitions/)

*åŸè½½äº winterwindsoftware.com*ã€‚