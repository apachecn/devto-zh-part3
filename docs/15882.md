# åœ¨ç½‘ç»œä¸Šå®ç°ç”»ä¸­ç”»

> åŸæ–‡:[https://dev . to/ananyaneogi/implement-picture-in-picture-on-the-web-17g 8](https://dev.to/ananyaneogi/implement-picture-in-picture-on-the-web-17g8)

æˆ‘æœ€å–œæ¬¢åœ¨ç½‘ä¸Šåšçš„äº‹æƒ…ä¹‹ä¸€æ˜¯å®ç°å’Œæµ‹è¯•æ–°çš„å’Œå³å°†æ¨å‡ºçš„åŠŸèƒ½ã€‚ä»Šå¤©æˆ‘ä»¬è¦å®ç°ç”»ä¸­ç”»ã€‚

## [](#what-is-pictureinpicture-)ä»€ä¹ˆæ˜¯ç”»ä¸­ç”»ï¼Ÿ

æ ¹æ® [W3C ç”»ä¸­ç”»è§„èŒƒ-](https://wicg.github.io/picture-in-picture/)

> è¯¥è§„èŒƒæ—¨åœ¨æä¾› APIï¼Œä»¥å…è®¸ç½‘ç«™åˆ›å»ºä¸€ä¸ªæ€»æ˜¯ä½äºå…¶ä»–çª—å£é¡¶éƒ¨çš„æµ®åŠ¨è§†é¢‘çª—å£ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥åœ¨ä¸å…¶ä»–å†…å®¹ç«™ç‚¹æˆ–è®¾å¤‡ä¸Šçš„åº”ç”¨ç¨‹åºäº¤äº’çš„åŒæ—¶ç»§ç»­æ¶ˆè´¹åª’ä½“ã€‚

åœ¨ PiP(ç”»ä¸­ç”»)æ¨¡å¼ä¸‹ï¼Œè§†é¢‘åŒ…å«åœ¨ä¸€ä¸ªç‹¬ç«‹çš„*è¿·ä½ *çª—å£ä¸­ï¼Œè¯¥çª—å£å§‹ç»ˆä½äºå…¶ä»–çª—å£çš„é¡¶éƒ¨ã€‚å³ä½¿ç”¨æˆ·ä»£ç†ä¸å¯è§ï¼Œè¯¥çª—å£ä¹Ÿä¿æŒå¯è§ã€‚

* * *

## [](#how-to-implement-pictureinpicture-)å¦‚ä½•å®ç°ç”»ä¸­ç”»ï¼Ÿ

HTML -

```
<video id="videoElement" controls="true" src="demo.mp4"></video>

<!-- button will be used to toggle the PiP mode -->
<button id="togglePipButton">Toggle Picture-in-Picture Mode!</button> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

JavaScript -

### [](#1-call-raw-requestpictureinpicture-endraw-on-click-of-raw-togglepipbutton-endraw-button-element)1ã€‚ç‚¹å‡»`togglePipButton`æŒ‰é’®å…ƒç´ è°ƒç”¨`requestPictureInPicture()`ã€‚

`requestPictureInPicture()`å›æŠ¥æ‰¿è¯ºã€‚
å½“æ‰¿è¯ºå®Œæˆæ—¶ï¼Œæµè§ˆå™¨ä¼šå°†è§†é¢‘ç¼©å°æˆä¸€ä¸ªè¿·ä½ çª—å£ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¿™ä¸ªçª—å£ä¸­ç§»åŠ¨å¹¶å®šä½åœ¨å…¶ä»–çª—å£ä¸Šã€‚

```
let video = document.getElementById('videoElement');
let togglePipButton = document.getElementById('togglePipButton');

togglePipButton.addEventListener('click', async function (event) {
    togglePipButton.disabled = true; //disable toggle button while the event occurs
    try {
        // If there is no element in Picture-in-Picture yet, request for it
        if (video !== document.pictureInPictureElement) {
            await video.requestPictureInPicture();
        }
        // If Picture-in-Picture already exists, exit the mode
        else {
            await document.exitPictureInPicture();
        }

    } catch (error) {
        console.log(`Oh Horror! ${error}`);
    } finally {
        togglePipButton.disabled = false; //enable toggle button after the event
    }
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#2-check-for-pictureinpicture-event-changes)2ã€‚æ£€æŸ¥ç”»ä¸­ç”»äº‹ä»¶æ›´æ”¹

```
let video = document.getElementById('videoElement');
video.addEventListener('enterpictureinpicture', function (event) {
    console.log('Entered PiP');
    pipWindow = event.pictureInPictureWindow;
    console.log(`Window size -  \n Width: ${pipWindow.width} \n Height: ${pipWindow.height}`); // get the width and height of PiP window
});

video.addEventListener('leavepictureinpicture', function (event) {
    console.log('Left PiP');
    togglePipButton.disabled = false;
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç”šè‡³å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ª`resize`äº‹ä»¶å¤„ç†ç¨‹åºï¼Œæ ¹æ®ç”»ä¸­ç”»çª—å£å¤§å°çš„å˜åŒ–æ¥æ›´æ–°è§†é¢‘å¤§å°ã€‚è¿™å°†æœ‰åŠ©äºæ ¹æ®ç”¨æˆ·è§‚çœ‹è§†é¢‘çš„çª—å£æä¾›æ­£ç¡®çš„è§†é¢‘è´¨é‡ã€‚

### [](#3-always-check-for-feature-support)3ã€‚å§‹ç»ˆæ£€æŸ¥åŠŸèƒ½æ”¯æŒ

```
if ('pictureInPictureEnabled' in document) {
    showPipButton();

    // loadedmetadata event occurs when meta data for the specified audio/video has been loaded.Meta data might consists of: duration, dimensions etc.
    video.addEventListener('loadedmetadata', showPipButton);

    // emptied event is fired when the media has become empty, e.g. media has already been loaded or partially loaded.
    video.addEventListener('emptied', showPipButton);
} else {
    console.log('The Picture-in-Picture Web API is not available.');
    togglePipButton.hidden = true;
}

// Enable/disable toggle button depending on whether PiP availability.
function showPipButton() {
    togglePipButton.disabled = (video.readyState === 0) || !document.pictureInPictureEnabled || video.disablePictureInPicture;
}
// video.readyState === 0 means Video metadata have not been loaded yet 
// !document.pictureInPictureEnabled means if Pip is not available
// video.disablePictureInPicture means disablePictureInPicture attribute is present in the video which will result in requestPictureInPicture() rejected promise. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±æ˜¯è¿™æ ·ï¼æ‚¨çš„ web åº”ç”¨ç¨‹åºç°åœ¨å¯ä»¥ä½¿ç”¨ç”»ä¸­ç”»äº†ï¼

* * *

*å¥–é‡‘ï¼*ä¸ºæ­¤åšäº†ä¸€ä¸ªå¿«é€Ÿæ¼”ç¤ºï¼Œ[æ¥çœ‹çœ‹å§ï¼](https://ananyaneogi.github.io/picture-in-picture-demo/)

## ![GitHub logo](../Images/75095a8afc1e0f207cda715962e75c8d.png) [é˜¿çº³äºšè¯ºå‰](https://github.com/ananyaneogi) / [ç”»ä¸­ç”»æ¼”ç¤º](https://github.com/ananyaneogi/picture-in-picture-demo)

### ä¸Šä¼ ä»»ä½•è§†é¢‘ï¼Œå¹¶ä»¥ç”»ä¸­ç”»æ¨¡å¼æ’­æ”¾

<article class="markdown-body entry-content container-lg" itemprop="text">

# ç”»ä¸­ç”»æ¼”ç¤º<g-emoji class="g-emoji" alias="tada" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f389.png">ğŸ‰</g-emoji>

ä»æ‚¨çš„è®¡ç®—æœºæ·»åŠ ä»»ä½•è§†é¢‘ï¼Œå¹¶ä»¥ç”»ä¸­ç”»æ¨¡å¼æ’­æ”¾è§†é¢‘ï¼

[ç«‹å³è§‚çœ‹æ¼”ç¤ºï¼](https://ananyaneogi.github.io/picture-in-picture-demo/)

</article>

[View on GitHub](https://github.com/ananyaneogi/picture-in-picture-demo)

ç›®å‰è¯¥ API åªæ”¯æŒåœ¨`HTMLVideoElement`ä¸Šä½¿ç”¨ï¼Œä½†å®ƒå£°ç§°å°†æ¥å¯ä»¥æ‰©å±•ã€‚
æ£€æŸ¥[can use stats](https://caniuse.com/#feat=picture-in-picture)çš„æµè§ˆå™¨æ”¯æŒã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ¸è¿›çš„å¢å¼ºï¼Œæ‰€ä»¥ä¸ç®¡æ”¯æŒï¼Œä½ ä»Šå¤©å¯ä»¥åœ¨ä½ ç°æœ‰çš„åº”ç”¨ç¨‹åºä¸Šä½¿ç”¨å®ƒï¼è€¶ï¼

* * *

## [](#references)å‚è€ƒæ–‡çŒ®

1.  [W3C ç”»ä¸­ç”»è§„èŒƒ](https://wicg.github.io/picture-in-picture/)
2.  [æ‰“é€ ç°ä»£ç½‘ç»œåª’ä½“ä½“éªŒ(Chrome Dev Summit 2018)](https://www.youtube.com/watch?v=iTC3mfe0DwE)