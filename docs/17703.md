# ä»å¤´å¼€å§‹æ„å»º React Infinite Scroller ç»„ä»¶

> åŸæ–‡:[https://dev . to/Kris/building-a-react-infinite-scroller-component-from-scratch-1042](https://dev.to/kris/building-a-react-infinite-scroller-component-from-scratch-1042)

[![](../Images/2de1f36a2fac540e4325b80844bb16a5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--QXaluCLf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AJqp3y1JpVCUYs7cK04v9gg.png)

æˆ‘ä»¬éƒ½çŸ¥é“ä¼Ÿå¤§çš„å†…å®¹å‘ç°ä½“éªŒï¼Œæˆ‘ä»¬å¯ä»¥æ»šåŠ¨å’Œæ»šåŠ¨ï¼Œå‘ç°æ›´å¤šçš„é¡¹ç›®ï¼Œäººå’Œç…§ç‰‡ã€‚å½“æ„å»ºæˆ‘ä»¬çš„ web æˆ–ç§»åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ç»å¸¸å¸Œæœ›ç»™æˆ‘ä»¬çš„ç”¨æˆ·æä¾›è¿™ç§è‰¯å¥½çš„ä½“éªŒã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨çº¯ JavaScript æ„å»ºä¸€ä¸ª react infinite scrollï¼Œå¹¶å°†å…¶åµŒå…¥åˆ° ReactJS ç»„ä»¶ä¸­ã€‚

æœ‰äº†è¿™ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€äº›äº†ä¸èµ·çš„äº‹æƒ…:

1.  ä» JSON æ ¼å¼çš„ API è·å–æ•°æ®
2.  å°†æ•°æ®æ³¨å…¥ DOM å…ƒç´ 
3.  ä½¿ç”¨ addEventListener ç»‘å®šåˆ° scroll äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨é€šç”¨ API å¤„ç†åˆ†é¡µ
4.  ä½¿ç”¨å†…éƒ¨çŠ¶æ€å­˜å‚¨å’Œè¿½åŠ æ•°æ®
5.  è®¡ç®—è†¨èƒ€å®¹å™¨çš„åº•éƒ¨

æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ã€‚

*   æç¤º:ä½¿ç”¨åƒ[é’»å¤´](https://github.com/teambit/bit)è¿™æ ·çš„å·¥å…·å°†ä½ çš„ç»„ä»¶å˜æˆå¯é‡å¤ä½¿ç”¨çš„ä¹é«˜ç§¯æœ¨ã€‚åˆ›å»ºæ”¶è—ï¼Œå…±äº«æ‚¨çš„ç»„ä»¶ï¼Œåœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒä»¬ï¼Œå¹¶ä¸æ‚¨çš„å›¢é˜Ÿä¸€èµ·æ›´å¿«åœ°æ„å»ºã€‚è¯•è¯•çœ‹ã€‚

[ä½å…±äº«å’Œæ„å»ºä»£ç ç»„ä»¶](https://bitsrc.io)

#### [](#lets-get-started)æˆ‘ä»¬å¼€å§‹å§

ä½¿ç”¨ä»£ç æ²™ç®±é€šè¿‡ create-react-app å¯åŠ¨é¡¹ç›®ã€‚

[![](../Images/12e2b70b3b228b5f618337248287cbdb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--sYr4b8ZS--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AAX7IHZDEMk-hiJ1YpEw26g.png)

æ‚¨å°†çœ‹åˆ°ç¼–è¾‘å™¨å’Œè¾“å‡ºæµè§ˆå™¨ã€‚

[![](../Images/f08c4da38f90645fdc98aecc1eede4dc.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--qTh5SqvW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2A5lxvliOAej3u7anS_ueJZw.png)

åˆ›å»ºä¸€ä¸ªç»„ä»¶ç»“æ„ä½¿ç”¨çš„æ˜¯ä¸‹é¢çš„ä¸€ä¸ªã€‚

[![](../Images/d83bedd57a86bd821ab681256727f49c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--_tgspgnz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/268/1%2Af5NAErCIEuNmDwbK1F-Mzw.png)

### [](#fetching-data-from-api-and-using-it-in-the-scrolling-component)ä» API è·å–æ•°æ®å¹¶åœ¨æ»šåŠ¨ç»„ä»¶ä¸­ä½¿ç”¨

å¯¼å…¥å¿…è¦çš„åº“ã€‚

```
import React from 'react'

import fetch from 'isomorphic-fetch' 
```

ä½¿ç”¨[åŒæ„-è·å–](https://github.com/matthew-andrews/isomorphic-fetch)è½»æ¾è·å–æ•°æ®ã€‚

åˆ›å»ºä¸€ä¸ªç±»æ— ç©·å°

```
class Infinitescroll extends React.Component {
   render() {
     return <div />;
   }
 }
export default Infinitescroll; 
```

å°†å…¶åŒ…å«åœ¨ Index.js ä¸­

```
import React from "react";
import ReactDOM from "react-dom";
import Infinitescroll from "./components/infinitescroll";
import "./styles.css"; 
```

è¿˜æœ‰ï¼Œåœ¨ index.js.

```
function App() {
  return (
     <div className="container">
       <h1>User</h1>
       <Infinitescroll />
     </div>
   );
}
const rootElement = document.getElementById("root");
ReactDOM.render(<App />, rootElement); 
```

ç»“æœåº”è¯¥æ˜¯:

[![](../Images/90ee9d905ce426e63deff86e677a1b44.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--k-B0Aktx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AUyYx5U02Qu2GUZtLqvS-JA.png)

ç°åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªçŠ¶æ€å˜é‡æ¥å­˜å‚¨æ¥è‡ª API:
çš„æ•°æ®

```
state = {
  data: [],
  per: 3,
  page: 1,
  total\_pages: null,
}; 
```

ä½¿ç”¨å‡½æ•°ä» API ä¸­è·å–æ•°æ®

```
loadUser = () => {
   const { per, page, data } = this.state;
   const url = `https://reqres.in/api/users? per_page=${per}&page=${page}`;
      fetch(url)
     .then(response => response.json())
     .then(json =>
      this.setState({
           data: son.data,
           scrolling: false,
           total\_pages: json.total\_pages
     })
  );
}; 
```

å¹¶æ¸²æŸ“:

```
render() {
     return (
       <ul>
       {this.state.data.map(data => (
          <li key={data.id}>
            <div>
               <div>
                  <img src={data.avatar} />
               </div>
               <div>{data.first\_name}</div>
               <div>{data.last\_name}</div>
            </div>
          </li>
       ))}
      </ul>
  );
} 
```

åœ¨é¡µé¢åŠ è½½æ—¶å‘ˆç°ç»„ä»¶â€”â€”è¿™å¯ä»¥ä½¿ç”¨ componentWillMount æ¥å®ç°ã€‚

```
componentWillMount() {
   this.loadUser();
} 
```

ç»“æœæ˜¯:

[![](../Images/9ab9eecaf25bd56b490c3a8791912042.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--g3Ewwj8O--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/560/1%2AzkcBIS-RWKf-FfXYDN2cOA.png)

### [](#loading-more-data)åŠ è½½æ›´å¤šæ•°æ®

å› æ­¤ï¼Œåœ¨åŠ è½½ä¸‹ä¸€ä¸ªæ»šåŠ¨é¡µé¢ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åŠ è½½æ›´å¤šçš„æ•°æ®ã€‚

æ·»åŠ ä¸€ä¸ªåä¸º prevState çš„æ–°çŠ¶æ€å˜é‡æ¥è·å–ä¸‹ä¸€é¡µå€¼å¹¶è°ƒç”¨ loadUserã€‚

```
loadMore = () => {
    this.setState(
      prevState => ({
        page: prevState.page + 1,
        scrolling: true
      }),
      this.loadUser
    );
  }; 
```

å•å‡»â€œåŠ è½½æ›´å¤šâ€æŒ‰é’®è°ƒç”¨æ­¤å‡½æ•°ã€‚

```
<div>
        <ul>
          {this.state.data.map(data => (
            <li key={data.id}>
              <div>
                <div>
                  <img src={data.avatar} />
                </div>
                <div>{data.first\_name}</div>
                <div>{data.last\_name}</div>
              </div>
            </li>
          ))}
        </ul>
        <button
          onClick={e => {
            this.loadMore();
          }}
        >
          Load More
        </button>
      </div> 
```

ç»“æœâ€¦

[![](../Images/07809f348155bbd0b8ef36d164b820a0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--4x8pu6zr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/590/1%2A7_Igv3yM9RekKoHp8sotGg.gif)

è¿™å¾ˆæ£’ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰ä¸€ä¸ªé—®é¢˜:æ—§æ•°æ®è¢«æ–°æ•°æ®å–ä»£äº†ã€‚

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·å°†æ–°çš„å“åº”è¿½åŠ åˆ°æ—§æ•°æ®ä¸­ã€‚

```
fetch(url)
      .then(response => response.json())
      .then(json =>
        this.setState({
          data: [...data, ...json.data],
          scrolling: false,
          total\_pages: json.total\_pages
        })
     ); 
```

ç»“æœâ€¦

[![](../Images/a24d5b3b23d5f8355110663b59791d52.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--U_m6M6PQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/569/1%2AdRbbvjzVR0jchxonYmYl7g.gif)

å—¯ï¼Œå®ƒå·¥ä½œå¾—å¾ˆå¥½ï¼

### [](#trigger-loadmore-with-scroll-event)ç”¨æ»šåŠ¨äº‹ä»¶è§¦å‘ loadMore

å¯¹äºæœ€åä¸€éƒ¨åˆ†ï¼Œåœ¨æ»šåŠ¨äº‹ä»¶ä¸Šè§¦å‘ loadMoreã€‚

ç¬¬ä¸€ï¼Œæœ€å

*   with getQuerySelector. Calculate the element offset to get current page offset. If page offset is greater than the Offset of last item that means scrollbar is near the last offset. This should trigger loadMore.

    ```
    handleScroll = () => { 
      var lastLi = document.querySelector("ul.container > li:last-child");
      var lastLiOffset = lastLi.offsetTop + lastLi.clientHeight;
      var pageOffset = window.pageYOffset + window.innerHeight;

      if (pageOffset > lastLiOffset) {
           this.loadMore();
      }
    }; 
    ```

    å°†æ»šåŠ¨ä¾¦å¬å™¨ç»‘å®šåˆ°æ»šåŠ¨å¤„ç†ç¨‹åºã€‚

    ```
    componentWillMount() {
        this.loadUser();
        this.scrollListener = window.addEventListener("scroll", e => {
          this.handleScroll(e);
        });
      } 
    ```

    ç»“æœæ˜¯:

    [![](../Images/5e03ba7f576e4dc9c7b76123de5a2031.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--AeSQjrSK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/542/1%2A7cNUrvZ8I_hC4LNvyJtmdw.gif)

    å¤ªå¥½äº†ï¼å°±æ˜¯è¿™æ ·ã€‚æ‚¨çš„ç»„ä»¶ç°åœ¨å·²ç»å‡†å¤‡å¥½äº†ï¼æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨[ä½](https://github.com/teambit/bit)ä¸æ‚¨çš„å›¢é˜Ÿå…±äº«å®ƒï¼Œå°†å®ƒæ·»åŠ åˆ°æ‚¨çš„ç»„ä»¶é›†åˆä¸­ï¼Œå¹¶åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒã€‚

    ### [](#quick-recap)å¿«é€Ÿå›é¡¾

    åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•å®ç°ä¸€ä¸ª React æ— é™æ»šåŠ¨ç»„ä»¶ã€‚

    é¦–å…ˆï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä» API è·å–æ•°æ®ï¼Œå¹¶å‘ˆç°å®ƒã€‚ä½¿ç”¨ loadMore å’Œ handleScrollï¼Œæˆ‘ä»¬è®¡ç®—äº†æ»šåŠ¨æ¡çš„ä½ç½®ã€‚æ¯å½“æ»šåŠ¨æ¡é è¿‘çª—å£åº•éƒ¨æ—¶ï¼Œè·å–æ›´å¤šæ•°æ®å¹¶å°†å…¶é™„åŠ åˆ°ç°æœ‰æ•°æ®ï¼Œç„¶åå‘ˆç°ç»„ä»¶ã€‚

    å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·éšæ—¶è¯„è®ºå’Œæé—®ï¼ä½ ä¹Ÿå¯ä»¥ç»™æˆ‘ç•™å‡ ä¸ªğŸ‘å¦‚æœä½ å–œæ¬¢çš„è¯ã€‚å¹²æ¯ï¼

    ### [](#learn-more)äº†è§£æ›´å¤š

    *   [åœ¨ React ä¸­åŠ å¿«å¼€å‘çš„ 5 ç§å·¥å…·](https://blog.bitsrc.io/5-tools-for-faster-development-in-react-676f134050f2)
    *   [2019 å¹´ä½ åº”è¯¥çŸ¥é“çš„ 11 ä¸ª React UI ç»„ä»¶åº“](https://blog.bitsrc.io/11-react-component-libraries-you-should-know-178eb1dd6aa4)
    *   [å¦‚ä½•åœ¨é¡¹ç›®å’Œåº”ç”¨ä¹‹é—´å…±äº« React UI ç»„ä»¶](https://blog.bitsrc.io/how-to-easily-share-react-components-between-projects-3dd42149c09)

    * * *