# node.js é¡¹ç›®ä¸­çš„å¯¹ç­‰ä¾èµ–æ˜¯ä»€ä¹ˆ

> åŸæ–‡:[https://dev . to/Bt dev/what-thes-peerdependencies-in-a-nodejs-project-51jo](https://dev.to/btdev/what-are-those-peerdepenedencies-in-a-nodejs-project-51jo)

*PeerDependencies* ï¼Œå½“æˆ‘åœ¨ç»ˆç«¯ä¸­æ”¶åˆ°å¦‚ä¸‹ PeerDependency è­¦å‘Šæ—¶ï¼Œè¿™ä¸ªæœ¯è¯­è‡³å°‘ç»™æˆ‘å¸¦æ¥äº†å›°æƒ‘:

[![alt text](../Images/6583d65ba555b059edc69f4095c6b742.png "NPM peer dependency warning")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--mr5Ay_LK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/3saoi2jo707mx6uzzqrg.jpg)

æœ€è¿‘å‘ç”Ÿçš„å…³äºèŠ‚ç‚¹åŒ…ä¸­æ¶æ„ä»£ç æ”»å‡»çš„äº‹ä»¶å¤§é‡åŒ…å«äº†å¯¹ç­‰ä¾èµ–çš„ä¸»é¢˜ï¼Œè¿™æœ€ç»ˆä½¿æˆ‘å¯¹è¿™ä¸ªä¸»é¢˜äº§ç”Ÿäº†å¥½å¥‡ï¼Œå¹¶å¼€å§‹å¯¹å¯¹ç­‰ä¾èµ–å¦‚ä½•å·¥ä½œè¿›è¡Œæ›´æ·±å…¥çš„ç ”ç©¶ã€‚åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘å°†å†™ä¸‹æˆ‘å¯¹ NodeJS å¯¹ç­‰ä¾èµ–çš„å‘ç°ï¼Œè¿™ä¹Ÿå¯èƒ½æœ‰åŠ©äºä½ æ›´å¥½åœ°ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚

å½“ç„¶ï¼Œä½¿ç”¨è°·æ­Œæœç´¢`"What are peer dependencies"`ä¼šè¿”å›ä¸€äº›ç»“æœã€‚ç„¶è€Œï¼Œè°·æ­Œè¿”å›çš„ä¸»è¦å‚è€ƒæ–‡çŒ®éƒ½æ²¡æœ‰è®©æˆ‘æ»¡æ„åœ°ç†è§£å¯¹ç­‰ä¾èµ–ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘å‘ç°è¿™ä¸ª [Stackoverflow é¡µé¢](https://stackoverflow.com/questions/26737819/why-use-peer-dependencies-in-npm-for-plugins/34645112#34645112)åŒ…æ‹¬ä¸€ä¸ªä¼Ÿå¤§çš„ PeerDependency è§£é‡Š [Stijn De Witt](https://stackoverflow.com/users/286685/stijn-de-witt) ã€‚ä»–çš„è§£é‡Šéå¸¸æ¥è¿‘ä¸€ä¸ªç‰ˆæœ¬ï¼Œè®©æˆ‘ç†è§£äº†å¯¹ç­‰ä¾èµ–çš„åŸºç¡€ï¼Œå¹¶æå‡ºäº†ä¸€äº›æƒ³è±¡çš„â€œå•Šå“ˆï¼â€ç¬é—´(è°¢è°¢ Stijnï¼).ä½†ä¸çŸ¥ä½•æ•…ï¼Œç”±äºæˆ‘æ›´åƒæ˜¯ä¸€ä¸ªè§†è§‰å­¦ä¹ å‹çš„äººï¼ŒStijn çš„â€œæ–‡æœ¬é©±åŠ¨â€Stackoverflow è§£é‡Šå¹¶æ²¡æœ‰ç»™æˆ‘å¸¦æ¥æƒ³è±¡ä¸­çš„ç†è§£åŒä¼´ä¾èµ–æ€§çš„æœ€åä¸€è‹±é‡Œçš„æ»¡è¶³æ„Ÿã€‚å› æ­¤ï¼Œæˆ‘åœ¨ä»–çš„è§£é‡Šå‘¨å›´ç”»äº†ä¸€äº›ä»£ç (ä½ å¯ä»¥åœ¨ä¸‹é¢çœ‹åˆ°å¼•ç”¨)ï¼Œçªç„¶äº‹æƒ…å¯¹æˆ‘æ¥è¯´å˜å¾—æ›´æ¸…æ¥šäº†ã€‚

## [](#whats-the-problem)æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ

å‰æœŸ:åœ¨æ¥ä¸‹æ¥çš„ä¾‹å­ä¸­ï¼Œ`JillsModule`å°†æ˜¯æµç¨‹ä¸­æ£˜æ‰‹çš„éƒ¨åˆ†(éšåæ˜¯ PeerDependency)ã€‚æ‰€ä»¥æˆ‘åœ¨ç”¨çš„æ—¶å€™åŠ äº†è™šæ„ç‰ˆè¿½åŠ (@1.0ï¼Œ@2.0)ã€‚

> å‡è®¾æˆ‘ä»¬æ­£åœ¨æ„å»º`OurCoolProject`ï¼Œå¹¶ä¸”æ­£åœ¨ä½¿ç”¨`JacksModule`å’Œ`JillsModule@2.0`ã€‚è®©æˆ‘ä»¬å‡è®¾`JacksModule`ä¹Ÿä¾èµ–äº JillsModuleï¼Œä½†æ˜¯ä¾èµ–äºä¸åŒçš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚è¯´`JillsModule@1.0`ã€‚åªè¦é‚£ 2 ä¸ªç‰ˆæœ¬ä¸ç¬¦åˆï¼Œå°±æ²¡æœ‰é—®é¢˜ã€‚äº‹å®ä¸Š,`JacksModule`åœ¨è¡¨é¢ä¸‹ä½¿ç”¨`JillsModule`,è¿™åªæ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚ã€‚æˆ‘ä»¬æ­£åœ¨æ†ç»‘`JillsModule`(å› ä¸ºä»£ç ä½¿ç”¨äº†ä¸¤ä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼Œä½†æ˜¯å½¼æ­¤ä¸ç›¸å…³ã€‚))ä¸¤æ¬¡ï¼Œä½†å½“æˆ‘ä»¬è·å¾—å¼€ç®±å³ç”¨çš„ç¨³å®šè½¯ä»¶æ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå°çš„ä»£ä»·ã€‚

åœ¨ä»£ç ä¸­ï¼Œè¿™æ„å‘³ç€ç±»ä¼¼äº

```
// OurCoolProcject.js

import JacksModule from 'jacksmodule';
import JillsModule(@2.0) from 'jillsmodule(@2.0)';

const OurCoolProcject = () => {
    // do some stuff with JacksModule
    // do some stuff with JillsModule(@2.0). stuff won't break as we have the compatible @2.0 version of JillsModule available in this scope.
}

export default OurCoolProject; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
// jacksmodule.js (an npm module)

import JillsModule(@1.0) from 'jillsmodule(@1.0)';

const JacksModule = () => {
    // do some stuff with JillsModule(@1.0). stuff won't break as we have the compatible @1.0 version of JillsModule available in this scope.
}

export default JacksModule; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†æ˜¯æ¥ä¸‹æ¥è¿™ç§ä¾èµ–å…³ç³»å˜å¾—æ›´åŠ æ£˜æ‰‹ã€‚

> ç°åœ¨è®©æˆ‘ä»¬å‡è®¾`JacksModule`ä»¥æŸç§æ–¹å¼å…¬å¼€äº†å®ƒå¯¹`JillsModule`çš„ä¾èµ–ã€‚ä¾‹å¦‚ï¼Œå®ƒæ¥å—ä¸€ä¸ª`object instanceof JillsClass`...å½“æˆ‘ä»¬ä½¿ç”¨ 2.0 ç‰ˆæœ¬çš„åº“åˆ›å»ºä¸€ä¸ª`new JillsClass`å¹¶å°†å…¶ä¼ é€’ç»™`jacksFunction`æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ(æˆ‘ä»¬çŸ¥é“ 1.0 ç‰ˆæœ¬é™¤å¤–ï¼)?ä¸€åˆ‡éƒ½å°†å¤±æ§ï¼åƒ`jillsObject instanceof JillsClass`è¿™æ ·ç®€å•çš„ä¸œè¥¿ä¼šçªç„¶è¿”å›`false`ï¼Œå› ä¸º`jillsObject`å…¶å®æ˜¯å¦ä¸€ä¸ª`JillsClass`çš„å®ä¾‹ï¼Œ2.0 ç‰ˆæœ¬ã€‚

åœ¨ä»£ç ä¸­ï¼Œè¿™æ„å‘³ç€è¿™æ ·çš„äº‹æƒ…:

```
// OurCoolProcject.js

import jacksFunction from 'jacksmodule';
import JillsModule(@2.0) from 'jillsmodule(@2.0)'; // node resolves to OUR dependency of JillsModule which is 2.0!

const OurCoolProcject = () => {    
    const jillsObject = new JillsModule(@2.0).JillsClass;

    // next the beginning of all evil, we'll pass a jillsObject of version 2.0
    // to jacksFunction (that would expect jillsObject of version 1.0 ğŸ¤¦â€â™€ï¸)
    jacksFunction(jillsObject); 
}

export default OurCoolProject; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
// jacksmodule.js (an npm module)

import JillsModule(@1.0) from 'jillsmodule(@1.0)';

const jacksFunction = (jillsObject) => {
    // make sure jillsObject is compatible for further usage in this function
    const jillsObjectRocks = jillsObject instanceOf JillsModule(@1.0).JillsClass;
            // â””â”€> ğŸ”¥ğŸ”¥ğŸ”¥ `jillsObjectRocks` will be a big, fat FALSE
            // as the JillsModule dependencies actively used in this function and
            // passed to this function differ in versions (1.0 vs. 2.0) ğŸ¤¦â€â™€ï¸
    ...
}

export default jacksFunction; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ æ³¨æ„åˆ°è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆå—ï¼Ÿ`jacksFunction`æ”¶åˆ°ä¸€ä¸ªä¸å…¼å®¹çš„`jillsObject`ï¼Œå› ä¸ºè¯¥å¯¹è±¡æ˜¯ä» JillsModule(2.0)æ„å»ºçš„ï¼Œè€Œä¸æ˜¯ä» JillsModule(1.0) `JacksModule`æ„å»ºçš„ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ*è¿™åªæ˜¾ç¤ºäº†é—®é¢˜*åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œå¯¼è‡´è½¯ä»¶æ— æ³•å·¥ä½œã€‚

## [](#how-peerdependencies-solve-this-problem)å¯¹ç­‰ä¾èµ–å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜

å¹¸è¿çš„æ˜¯ï¼Œnpm æœ‰ä¸€äº›å†…ç½®çš„æ™ºèƒ½æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœ JacksModule å°† JillsModule(@1.0)å£°æ˜ä¸º PeerDependencyï¼Œnpm ä¼šåœ¨å®‰è£…é¡¹ç›®çš„ä¾èµ–é¡¹æ—¶å‘ç”¨æˆ·å‘å‡ºè­¦å‘Šã€‚æ‰€ä»¥ JacksModule çš„`package.json`åº”è¯¥åŒ…å«è¿™ä¸ªå£°æ˜:

```
{
  "name": "JacksModule",
  ...
  "peerDependencies": {
    "JillsModule": "1.x"
  },
  ...
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› æ­¤ï¼Œnpm çš„ PeerDepenedency æ™ºèƒ½åŸºæœ¬ä¸Šè§¦å‘äº†ä¸€ä¸ªæ§åˆ¶å°è¾“å‡ºï¼Œé€šçŸ¥æˆ‘ä»¬çš„å¼€å‘äººå‘˜ï¼Œå¹¶è­¦å‘Šè¯´:

å˜¿ï¼Œæˆ‘æ˜¯æ°å…‹é€Šæ¨¡å—ã€‚è®©æˆ‘å‘Šè¯‰ä½ :æˆ‘éœ€è¦ JillsModule çš„è¿™ä¸ªç‰¹å®šåŒ…ï¼Œä½†æˆ‘çœŸçš„éœ€è¦å±äºæˆ‘çš„ JacksModule é¡¹ç›®å¹¶åœ¨æˆ‘çš„ package.json æ–‡ä»¶ä¸­åˆ—å‡ºçš„ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿å®ƒå·²å®‰è£…ï¼Œå¹¶ç¡®ä¿å®ƒä¸æ˜¯æ‚¨å¯èƒ½åœ¨åº”ç”¨ç¨‹åºçš„å…¶ä»–åœ°æ–¹å®‰è£…çš„ä¾›æ‚¨è‡ªå·±ä½¿ç”¨çš„ JillsModule çš„å…¶ä»–ç‰ˆæœ¬ã€‚

æ‰€ä»¥æœ€ç»ˆâ€”â€”è¿›ä¸€æ­¥è€ƒè™‘â€”â€”ä¾èµ–éœ€è¦å¯¹ç­‰ä¾èµ–çš„ npm åŒ…å¯èƒ½ä¼šå¾ˆæ£˜æ‰‹ã€‚å¦‚æœæ‚¨éœ€è¦ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„åŒ… X åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å•ç‹¬ä½¿ç”¨ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ï¼Œå¦‚æœæ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„å¦ä¸€ä¸ªä¾èµ–é¡¹å¯¹åŒ… X çš„å¦ä¸€ä¸ªç‰ˆæœ¬æœ‰å¯¹ç­‰ä¾èµ–å…³ç³»ã€‚å¦‚æœè¿™ç§æƒ…å†µå‡ºç°â€”â€”åœ¨æœ€åçš„æƒ…å†µä¸‹ä¹Ÿä¼šå¯¼è‡´æ‚¨çš„è½¯ä»¶å‡ºç°é—®é¢˜â€”â€”æ‚¨éœ€è¦è‡ªå·±å†³å®šä½¿ç”¨å“ªä¸ªåŒ…æˆ–å“ªä¸ªä»£ç å¯èƒ½éœ€è¦é‡æ„æ¥æ»¡è¶³æ‰€æœ‰è¦æ±‚ã€‚

æˆ‘å¸Œæœ›è¿™äº›è§£é‡Šå’Œä»£ç ç¤ºä¾‹å¯¹æ‚¨æœ‰æ„ä¹‰ï¼Œå¹¶å¼¥åˆäº†æ‚¨å¯¹å¯¹ç­‰ä¾èµ–çš„æœ€åä¸€ä¸ªæ€æƒ³é¸¿æ²Ÿã€‚å¦‚æœä½ æœ‰é—®é¢˜æˆ–æƒ³å»ºè®®ä¸€äº›æ–‡ç« ä¼˜åŒ–ï¼Œéšæ—¶è”ç³»æˆ‘æˆ–ç•™ä¸‹è¯„è®ºã€‚

è¿™ä¸ªå¸–å­æ˜¯[æœ€åˆè´´åœ¨è¿™é‡Œ](https://manpenaloza.dev/what-are-those-peerdepenedencies-in-a-nodejs-project/)ã€‚