# äºŒè¿›åˆ¶æ–‡ä»¶â€œäºŒè¿›åˆ¶â€å’Œâ€œæ–‡æœ¬â€æ–‡ä»¶çš„åŒºåˆ«

> åŸæ–‡ï¼š<https://dev.to/sharkdp/what-is-a-binary-file-2cf5>

æœ¬æ–‡æ¢è®¨äº†â€œäºŒè¿›åˆ¶â€å’Œâ€œæ–‡æœ¬â€æ–‡ä»¶çš„ä¸»é¢˜ã€‚ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«(å¦‚æœæœ‰çš„è¯)ï¼Ÿå¯¹äºä»€ä¹ˆæ˜¯â€œäºŒè¿›åˆ¶â€æˆ–â€œæ–‡æœ¬â€æ–‡ä»¶æœ‰æ˜ç¡®çš„å®šä¹‰å—ï¼Ÿ

æˆ‘ä»¬ä»ä¸¤ä¸ªå€™é€‰æ–‡ä»¶å¼€å§‹æˆ‘ä»¬çš„æ—…ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°å°†å®ƒä»¬çš„å†…å®¹åˆ†åˆ«å½’ç±»ä¸ºâ€œæ–‡æœ¬â€å’Œâ€œäºŒè¿›åˆ¶â€æ•°æ®:

```
echo "hello ğŸŒ" > message
convert -size 1x1 xc:white png:white 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸¤ä¸ªæ–‡ä»¶:ä¸€ä¸ªåä¸º`message`çš„æ–‡ä»¶ï¼Œå…¶æ–‡æœ¬å†…å®¹ä¸º*â€œä½ å¥½ğŸŒ"*(åŒ…æ‹¬ Unicode ç¬¦å·["åœ°çƒåœ°çƒæ¬§æ´²éæ´²"](https://unicode-table.com/en/1F30D/))å’Œä¸€ä¸ªå¸¦æœ‰å•ä¸ªç™½è‰²åƒç´ çš„ PNG å›¾åƒï¼Œç§°ä¸º`white`ã€‚æ–‡ä»¶æ‰©å±•åè¢«æ•…æ„å¿½ç•¥ã€‚

ä¸ºäº†æ¼”ç¤ºä¸€äº›ç¨‹åºåŒºåˆ†â€œæ–‡æœ¬â€å’Œâ€œäºŒè¿›åˆ¶â€æ–‡ä»¶ï¼Œçœ‹çœ‹`grep`å¦‚ä½•æ”¹å˜å®ƒçš„è¡Œä¸º:

```
â–¶ grep -R hello            
message:hello ğŸŒ

â–¶ grep -R PNG
Binary file white matches 
```

Enter fullscreen mode Exit fullscreen mode

`diff`åšç±»ä¼¼çš„äº‹æƒ…:

```
â–¶ echo "hello world" > other-message
â–¶ diff other-message message 
1c1
< hello world
--------
> hello ğŸŒ

â–¶ convert -size 1x1 xc:black png:black
â–¶ diff black white
Binary files black and white differ 
```

Enter fullscreen mode Exit fullscreen mode

è¿™äº›ç¨‹åºå¦‚ä½•åŒºåˆ†â€œæ–‡æœ¬â€å’Œâ€œäºŒè¿›åˆ¶â€æ–‡ä»¶ï¼Ÿ

åœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆè¯•ç€ç»™å‡ºä¸€ä¸ªå®šä¹‰ã€‚æ˜¾ç„¶ï¼Œåœ¨åŸºæœ¬çš„æ–‡ä»¶ç³»ç»Ÿçº§åˆ«ä¸Šï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½åªæ˜¯å­—èŠ‚çš„é›†åˆï¼Œå› æ­¤å¯ä»¥è¢«è§†ä¸ºäºŒè¿›åˆ¶æ•°æ®ã€‚å¦ä¸€æ–¹é¢ï¼ŒåŒºåˆ†â€œæ–‡æœ¬â€å’Œâ€œéæ–‡æœ¬â€(ä»¥ä¸‹ç§°ä¸ºâ€œäºŒè¿›åˆ¶â€)æ•°æ®ä¼¼ä¹å¯¹åƒ`grep`æˆ–`diff`è¿™æ ·çš„ç¨‹åºå¾ˆæœ‰å¸®åŠ©ï¼Œåªè¦ä¸å¼„ä¹±ç»ˆç«¯ä»¿çœŸå™¨çš„è¾“å‡ºã€‚

æ‰€ä»¥ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ä»å®šä¹‰â€œæ–‡æœ¬â€æ•°æ®å¼€å§‹ã€‚ä»æ–‡æœ¬çš„æŠ½è±¡æ¦‚å¿µå¼€å§‹ä¼¼ä¹æ˜¯åˆç†çš„ï¼Œå®ƒæ˜¯ä¸€ç³»åˆ—çš„ [Unicode ç ä½](https://en.wikipedia.org/wiki/Unicode)ã€‚ä»£ç ç‚¹çš„ä¾‹å­æœ‰åƒ`k`ã€`Ã¤`æˆ–`×`è¿™æ ·çš„å­—ç¬¦ï¼Œä»¥åŠåƒ`%`ã€`â˜¢`æˆ–`ğŸ™ˆ`è¿™æ ·çš„ç‰¹æ®Šç¬¦å·ã€‚ä¸ºäº†å°†ç»™å®šçš„æ–‡æœ¬å­˜å‚¨ä¸ºä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€ä¸ª*ç¼–ç *ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿè¡¨ç¤ºæ•´ä¸ª Unicode èŒƒå›´ï¼Œæˆ‘ä»¬é€šå¸¸é€‰æ‹© UTF-8ï¼Œæœ‰æ—¶é€‰æ‹© UTF-16 æˆ– UTF-32ã€‚ä»å†å²ä¸Šçœ‹ï¼Œåªæ”¯æŒå½“ä»Š Unicode çš„ä¸€éƒ¨åˆ†çš„ç¼–ç ä¹Ÿå¾ˆé‡è¦ã€‚æœ€çªå‡ºçš„æ˜¯ US-ASCII å’Œ Latin1 (ISO 8859-1)ï¼Œä½†è¿˜æœ‰æ›´å¤šã€‚æ‰€æœ‰è¿™äº›åœ¨å­—èŠ‚çº§åˆ«ä¸Šéƒ½æœ‰æ‰€ä¸åŒã€‚

ç»™å®šä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹(è€Œä¸æ˜¯å®ƒæ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„å†å²)ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä¸‹é¢çš„å®šä¹‰:

> å¦‚æœæ–‡ä»¶çš„å†…å®¹ç”± Unicode ç ä½çš„ç¼–ç åºåˆ—ç»„æˆï¼Œåˆ™è¯¥æ–‡ä»¶ç§°ä¸ºâ€œæ–‡æœ¬æ–‡ä»¶â€ã€‚

è¿™ä¸ªå®šä¹‰æœ‰ä¸¤ä¸ªå®é™…é—®é¢˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ‰€æœ‰å¯èƒ½çš„ç¼–ç çš„åˆ—è¡¨ã€‚ç¬¬äºŒï¼Œä¸ºäº†æµ‹è¯•ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜¯å¦ä»¥ç»™å®šçš„ç¼–ç æ–¹å¼ç¼–ç ï¼Œæˆ‘ä»¬å¿…é¡»è§£ç æ–‡ä»¶çš„*å…¨éƒ¨*å†…å®¹ï¼Œçœ‹çœ‹æ˜¯å¦æˆåŠŸã€‚æ•´ä¸ªè¿‡ç¨‹ä¼šéå¸¸ç¼“æ…¢ã€‚

äº‹å®è¯æ˜ï¼Œæœ‰ä¸€ç§æ›´å¿«çš„æ–¹æ³•æ¥åŒºåˆ†æ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½†è¿™æ˜¯ä»¥ç²¾åº¦ä¸ºä»£ä»·çš„ã€‚

ä¸ºäº†äº†è§£è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ä¸¤ä¸ªå€™é€‰æ–‡ä»¶ï¼Œæ¢ç´¢å®ƒä»¬çš„å­—èŠ‚çº§å†…å®¹ã€‚æˆ‘ä½¿ç”¨ [`hexyl`](https://github.com/sharkdp/hexyl) ä½œä¸ºåå…­è¿›åˆ¶æµè§ˆå™¨ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨`hexdump -C`:

[![Binary content of 'message' and 'white'](img/4ef45397f62f11ea853861631cefa3cf.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--TyxBK_wi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/gk85n9eha0m5pjt3dthj.png)

è¯·æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½åŒ…å« ASCII èŒƒå›´å†…å¤–çš„å­—èŠ‚(`00` â€¦ `7f`)ã€‚ä¾‹å¦‚ï¼Œ`message`æ–‡ä»¶ä¸­çš„å››ä¸ªå­—èŠ‚`f0 9f 8c 8d`æ˜¯ Unicode ç ä½`U+1F30D`(ğŸŒ).å¦ä¸€æ–¹é¢ï¼Œ`white`å›¾åƒå¼€å¤´çš„å­—èŠ‚`50 4e 47`æ˜¯å­—ç¬¦`PNG`çš„ç®€å• ASCII ç¼–ç ç‰ˆæœ¬ã€‚

æ‰€ä»¥å¾ˆæ˜æ˜¾ï¼ŒæŸ¥çœ‹ ASCII èŒƒå›´ä¹‹å¤–çš„å­—èŠ‚ä¸èƒ½ä½œä¸ºæ£€æµ‹â€œäºŒè¿›åˆ¶â€æ–‡ä»¶çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œçš„*æ˜¯*ä¸¤ä¸ªæ–‡ä»¶çš„åŒºåˆ«ã€‚å›¾åƒæ–‡ä»¶åŒ…å«å¤§é‡ç©ºå­—èŠ‚(`00`)ï¼Œè€ŒçŸ­æ–‡æœ¬æ¶ˆæ¯åˆ™ä¸åŒ…å«ã€‚äº‹å®è¯æ˜ï¼Œè¿™å¯ä»¥å˜æˆä¸€ä¸ªç®€å•çš„*å¯å‘å¼*æ–¹æ³•æ¥æ£€æµ‹äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› ä¸ºè®¸å¤šç¼–ç çš„æ–‡æœ¬æ•°æ®ä¸åŒ…å«ä»»ä½•ç©ºå­—èŠ‚(å³ä½¿å®ƒå¯èƒ½æ˜¯åˆæ³•çš„)ã€‚

äº‹å®ä¸Šï¼Œè¿™æ­£æ˜¯`diff`å’Œ`grep`ç”¨æ¥æ£€æµ‹â€œäºŒè¿›åˆ¶â€æ–‡ä»¶çš„ã€‚ä»¥ä¸‹å®åŒ…å«åœ¨ [`diff`çš„æºä»£ç ä¸­(`src/io.c` )](https://github.com/Distrotech/diffutils/blob/9e70e1ce7aaeff0f9c428d1abc9821589ea054f1/src/io.c#L85-L88) :

```
#define binary_file_p(buf, size) (memchr (buf, 0, size) != 0) 
```

Enter fullscreen mode Exit fullscreen mode

è¿™é‡Œï¼Œ [`memchr(const void *s, int c, size_t n)`](https://linux.die.net/man/3/memchr) å‡½æ•°ç”¨äºåœ¨ä»`buf`å¼€å§‹çš„å­˜å‚¨åŒºçš„åˆå§‹`size`å­—èŠ‚ä¸­æœç´¢å­—ç¬¦`0`ã€‚ä¸ºäº†è¿›ä¸€æ­¥åŠ é€Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Œé€šå¸¸åªæœ‰æ–‡ä»¶çš„å‰å‡ ä¸ªå­—èŠ‚è¢«è¯»å…¥ç¼“å†²åŒº`buf`(ä¾‹å¦‚ 1024 å­—èŠ‚)ã€‚æ€»è€Œè¨€ä¹‹ï¼Œ`grep`å’Œ`diff`ä½¿ç”¨ä»¥ä¸‹å¯å‘å¼æ–¹æ³•:

> å¦‚æœæ–‡ä»¶å†…å®¹çš„å‰ 1024 ä¸ªå­—èŠ‚ä¸åŒ…å«ä»»ä½•ç©ºå­—èŠ‚ï¼Œåˆ™è¯¥æ–‡ä»¶å¾ˆå¯èƒ½æ˜¯â€œæ–‡æœ¬æ–‡ä»¶â€ã€‚

è¯·æ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸€äº›å¤±è´¥çš„åä¾‹ã€‚ä¾‹å¦‚ï¼Œå³ä½¿ä¸å¤ªå¯èƒ½ï¼ŒUTF 8 ç¼–ç çš„æ–‡æœ¬å¯ä»¥åˆæ³•åœ°åŒ…å«ç©ºå­—èŠ‚ã€‚ç›¸åï¼Œä¸€äº›ç‰¹å®šçš„äºŒè¿›åˆ¶æ ¼å¼(å¦‚ binary [PGM](https://en.wikipedia.org/wiki/Netpbm_format) )ä¸åŒ…å«ç©ºå­—èŠ‚ã€‚è¿™ç§æ–¹æ³•é€šå¸¸ä¹Ÿä¼šå°† UTF-16 å’Œ UTF-32 ç¼–ç çš„æ–‡æœ¬å½’ç±»ä¸ºâ€œäºŒè¿›åˆ¶â€ï¼Œå› ä¸ºå®ƒä»¬ç”¨ç©ºå­—èŠ‚å¯¹å¸¸è§çš„ Latin-1 ä»£ç ç‚¹è¿›è¡Œç¼–ç :

```
â–¶ iconv -f UTF-8 -t UTF-16 message > message-utf16
â–¶ hexdump -C message-utf16 
00000000  ff fe 68 00 65 00 6c 00  6c 00 6f 00 20 00 3c d8  |..h.e.l.l.o. .<.|
00000010  0d df 0a 00                                       |....|
00000014
â–¶ grep . message-utf16                            
Binary file message-utf16 matches 
```

Enter fullscreen mode Exit fullscreen mode

ç„¶è€Œï¼Œè¿™ç§å¯å‘å¼æ–¹æ³•éå¸¸æœ‰ç”¨ã€‚æˆ‘åœ¨ Rust ä¸­å†™äº†ä¸€ä¸ª[å°åº“](https://github.com/sharkdp/content_inspector),å®ƒä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„ä¸€ä¸ªç¨å¾®æ”¹è¿›çš„ç‰ˆæœ¬æ¥å¿«é€Ÿç¡®å®šä¸€ä¸ªç»™å®šçš„æ–‡ä»¶æ˜¯åŒ…å«â€œäºŒè¿›åˆ¶â€è¿˜æ˜¯â€œæ–‡æœ¬â€æ•°æ®ã€‚åœ¨æˆ‘çš„ç¨‹åº [`bat`](https://github.com/sharkdp/bat) ä¸­ä½¿ç”¨å®ƒæ¥é˜²æ­¢â€œäºŒè¿›åˆ¶â€æ–‡ä»¶è¢«è½¬å‚¨åˆ°ç»ˆç«¯:

[![bat, detecting binary files](img/a91b86d97fa7d3b0be9bfd730e1abd8e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--10FKVT3K--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/6cvzc0jcupyp5ex1ainm.png)

#### è„šæ³¨

 <small>æ³¨æ„ï¼Œæœ‰ä¸€äº›ç¼–ç åœ¨æ–‡ä»¶çš„å¼€å¤´å†™æ‰€è°“çš„[å­—èŠ‚é¡ºåºæ ‡è®°](https://en.wikipedia.org/wiki/Byte_order_mark) (BOM)æ¥è¡¨ç¤ºç¼–ç çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼ŒUTF-32 çš„ little-endian å˜ä½“ä½¿ç”¨`ff fe 00 00`ã€‚è¿™äº› BOM å°†æœ‰åŠ©äºç¬¬äºŒç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦è§£ç æ–‡ä»¶çš„æ•´ä¸ªå†…å®¹ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ·»åŠ  BOM æ˜¯å¯é€‰çš„ï¼Œå¾ˆå¤šç¼–ç éƒ½æ²¡æœ‰æŒ‡å®šã€‚</small> 

 <small>`50 4e 47`æ˜¯ PNG æ ¼å¼çš„[å¹»æ•°](https://en.wikipedia.org/wiki/List_of_file_signatures)çš„ä¸€éƒ¨åˆ†ã€‚å¹»æ•°ç±»ä¼¼äº BOMï¼Œè®¸å¤šäºŒè¿›åˆ¶æ ¼å¼åœ¨æ–‡ä»¶å¼€å¤´ä½¿ç”¨å¹»æ•°æ¥è¡¨ç¤ºå®ƒä»¬çš„ç±»å‹ã€‚ä½¿ç”¨å¹»æ•°æ¥æ£€æµ‹æŸäº›ç±»å‹çš„â€œäºŒè¿›åˆ¶â€æ–‡ä»¶æ˜¯ä¸€ç§ç”±`file`å·¥å…·ä½¿ç”¨çš„æ–¹æ³•ã€‚</small>