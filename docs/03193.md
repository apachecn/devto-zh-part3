# åœ¨ WordPress ä¸­æ³¨å†Œä¸€äº›è‡ªå®šä¹‰è®¾ç½®

> åŸæ–‡:[https://dev . to/19h 47/register-some-custom-settings-in-WordPress-32pf](https://dev.to/19h47/register-some-custom-settings-in-wordpress-32pf)

æœ€è¿‘æˆ‘ç©äº†å¾ˆå¤šå…³äº WPGraphQL çš„æ’ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸º T4 WordPress T5 å¯ç”¨ T2 GraphQL API çš„æ’ä»¶ã€‚æˆ‘éœ€è¦åœ¨æˆ‘çš„åº”ç”¨ç¨‹åºä¸­æ£€ç´¢ç¤¾äº¤ç½‘ç»œçš„é“¾æ¥ã€‚

ä»å†å²ä¸Šçœ‹ï¼Œæˆ‘ä¼šç”¨[å®šåˆ¶å™¨ API](https://codex.wordpress.org/Theme_Customization_API) æ¥åšè¿™ä»¶äº‹ï¼Œä½†æ˜¯ **WPGraphQL** ç›®å‰æ²¡æœ‰å…¬å¼€è¿™ä¸ªæ•°æ®ã€‚

æ‰€ä»¥ï¼Œå¤šäºäº† **WPGraphQL** æ–‡æ¡£ï¼Œæˆ‘æƒ³åˆ°äº†å¦ä¸€ä¸ªä¸»æ„:ä½¿ç”¨[è®¾ç½® API](https://codex.wordpress.org/Settings_API) ã€‚WPGraphQL å…¬å¼€äº† WPGraphQL æ¨¡å¼ä¸­çš„æ‰€æœ‰æ ¸å¿ƒè®¾ç½®ã€‚

æ‰€ä»¥æˆ‘è®¤ä¸º documented å¯èƒ½å¯¹ä»»ä½•äººéƒ½æœ‰ç”¨ï¼Œå³ä½¿æ˜¯ WPGraphQL ç”Ÿæ€ç³»ç»Ÿä¹‹å¤–çš„äººã€‚

### [](#settings-api)è®¾ç½® API

ä¸‰ä¸ªåŠŸèƒ½å¯¹äºå®ç°æ‚¨çš„ç›®æ ‡è‡³å…³é‡è¦:

*   [add_settings_section](https://developer.wordpress.org/reference/functions/add_settings_section/) ï¼Œç”¨äºä¸ºç®¡ç†é¡µé¢å®šä¹‰æ–°çš„è®¾ç½®éƒ¨åˆ†ï¼›
*   [add_settings_field](https://developer.wordpress.org/reference/functions/add_settings_field/) ï¼Œç”¨äºå®šä¹‰ä¸€ä¸ªè®¾ç½®å­—æ®µï¼›
*   [register_setting](https://developer.wordpress.org/reference/functions/register_setting/) ï¼Œç™»è®°è®¾ç½®å’Œæ•°æ®ã€‚

### [](#settings-class)è®¾ç½®ç±»

æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªåä¸º`Settings` :
çš„ PHP ç±»

```
class Settings {
    /**
     * The theme name
     */
    protected $theme_name;

    /**
     * The theme version
     */
    protected $theme_version;

    /**
     * The constructor
     */
    public function __construct( $theme_name, $theme_version ) {
        $this->theme_name    = $theme_name;
        $this->theme_version = $theme_version;
    }
} 
```

è¿™ä¸ªç±»å°†åœ¨æˆ‘ä»¬çš„ä¸»é¢˜(æˆ–æ’ä»¶)çš„`functions.php`ä¸­è¢«å®ä¾‹åŒ–ã€‚

### [](#settings-api-init-method)è®¾ç½® API åˆå§‹åŒ–æ–¹æ³•

æ‰€ä»¥æˆ‘ä»¬è¦ä¸ºæˆ‘ä»¬çš„`Settings`ç±»å†™ä¸€ä¸ªæ–¹æ³•æ¥æ·»åŠ è®¾ç½®:

```
public function settings_api_init() {
    add_settings_section(
        'socials',
        'Socials',
        // In class context pass an array with $this and the method name
        // to retrieve callback function.
        array( $this, 'socials_callback_function' ),
        // Our Socials setting will be set under the General tab.
        'general'
    );

    add_settings_field(
        'twitter',
        'Twitter',
        array( $this, 'setting_callback_function' ),
        'general',
        // Display this setting under our newly declared section right
        // above.
        'socials',
        // Extra arguments used in callback function.
        array(
            'name'  => 'twitter',
            'label' => 'Twitter',
        )
    );
} 
```

### [](#callback-method)å›è°ƒæ–¹æ³•

`add_settings_section`å’Œ`add_settings_field`å–ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œ`socials_callback_function`å’Œ`setting_callback_function`åˆ†åˆ«åŠ å…¥æˆ‘ä»¬çš„ç±»:

```
public function socials_callback_function() {
    echo '<p>Socials urls</p>';
}

public function setting_callback_function( $args ) {
    // Ugly, I know ğŸ˜”.
    echo '<input name="' . esc_attr( $args['name'] ) . '" type="text" value="' . esc_attr( get_option( $args['name'] ) ) . '" class="regular-text code" placeholder="' . esc_attr( $args['label'] ) . ' URL" />'; 
    echo ' ' . esc_attr( $args['label'] ) . ' URL';
} 
```

### [](#register-settings-method)å¯„å­˜å™¨è®¾ç½®æ–¹æ³•

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦æ³¨å†Œè¿™ä¸ªè®¾ç½®ï¼Œè¿™æ · WordPress å°±å¯ä»¥å¤„ç†è¿™ä¸ª:

```
public function register_settings() {
    $args = array(
        'type'              => 'string',
        'sanitize_callback' => 'sanitize_text_field',
        'default'           => null,
        // Extra argument for WPGraphQL.
        'show_in_graphql'   => true,
        'show_in_rest'      => true,
     );

     register_setting( 'general', 'twitter', $args );
} 
```

### [](#constructor)æ„é€ å‡½æ•°

æœ€åï¼Œåœ¨æˆ‘ä»¬çš„æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é€‚å½“çš„é’©å­:
ä¸­å°†è¿™ä¸ªæ–¹æ³•é™„åŠ åˆ°ç±»ä¸Š

```
 public function __construct( $theme_name, $theme_version ) {
    $this->theme_name    = $theme_name;
    $this->theme_version = $theme_version;

    add_action( 'admin_init', array( $this, 'settings_api_init' ) );
    // We hook into init and not admin_init to make front aware of this
    // settings.
    add_action( 'init', array( $this, 'register_settings' ) );
} 
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`functions.php`ä¸­å®ä¾‹åŒ–æˆ‘ä»¬çš„`Settings`ç±»ï¼Œå¹¶åœ¨é€šç”¨è®¾ç½®é¡µé¢ä¸­æ£€ç´¢æˆ‘ä»¬çš„è®¾ç½®ã€‚

[![WordPress custom settings](../Images/ed0c882e7684f3e6403737a04225dcf5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--hsXDa1vU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/yx22sbpqtxuoj0xcr8ul.jpg)

é…·å§ï¼Ÿè€Œä¸”æ²¡æœ‰ä»»ä½•æ’ä»¶ã€‚ğŸ˜

### [](#conclusion)ç»“è®º

å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œä½¿ç”¨å…¶ä»–ç±»å‹è¾“å…¥ï¼Œæ˜¾ç¤ºé¡µé¢é€‰æ‹©ï¼Œæ˜¾ç¤ºä¸€äº›å¤é€‰æ¡†ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºï¼

å¦‚æœä½ çœ‹åˆ°ä»»ä½•é”™åˆ«å­—æˆ–æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶çº æ­£æˆ‘ã€‚

â€“
<small>è¦æ£€ç´¢æ•´ä¸ªç±»ï¼Œè¯·éµå¾ªæ­¤[é“¾æ¥](https://gist.github.com/19h47/2e0e03a3caede1c258d95a5d7f7e16e3)</small>

â€“

#### [](#bonus-wpgraphql)å¥–é‡‘ WPGraphQL

ç°åœ¨æˆ‘ä»¬çš„è®¾ç½®å·²ç»æ³¨å†Œï¼Œåœ¨`generalSettings`æ¡ç›®ä¸‹ï¼Œæˆ‘ä»¬å°†æ‰¾åˆ°æˆ‘ä»¬çš„å‚æ•°:

```
 generalSettings {
    twitter
} 
```