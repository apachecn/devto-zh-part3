# rcctl:å¦‚ä½•åœ¨ OpenBSD 6.4 ä¸­è°ƒè¯•

> åŸæ–‡:[https://dev.to/nabbisen/debugging-rcctl-in-openbsd-3e70](https://dev.to/nabbisen/debugging-rcctl-in-openbsd-3e70)

## [](#summary)æ€»ç»“

è¿™ç¯‡æ–‡ç« æ˜¯å…³äºå›´ç»• [OpenBSD](https://www.openbsd.org/) çš„ [`rcctl`](https://man.openbsd.org/rcctl) çš„å•ä¸ªé€‰é¡¹ï¼Œå®ç”¨ç¨‹åºâ€œé…ç½®å’Œæ§åˆ¶å®ˆæŠ¤è¿›ç¨‹å’ŒæœåŠ¡â€ã€‚

æ€»ä¹‹ï¼Œå½“è¿è¡Œ`rcctl start %service%`å¤±è´¥æ—¶ï¼Œ**ä½¿ç”¨`-d`é€‰é¡¹**æä¾›äº†å…³äºå¤±è´¥åŸå› çš„è‰¯å¥½ä¿¡æ¯ã€‚

### [](#environment)ç¯å¢ƒ

*   æ“ä½œç³»ç»Ÿ:OpenBSD 6.4 amd64

<center>âœ¿ âœ¿ âœ¿</center>

## [](#a-problem)ä¸€ä¸ªé—®é¢˜

æˆ‘è¯•å›¾å»ºç«‹ä¸€ä¸ª Gitea æœåŠ¡å™¨ã€‚
æˆ‘åº”è¯¥åªç”¨ 4 ä¸ªå¤šä¸€ç‚¹çš„æ­¥éª¤å°±å®Œæˆäº†:

```
#  pkg_add gitea
#  rcctl enable gitea
#  nvim /etc/gitea/conf/app.ini
#  rcctl start gitea 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†æ˜¯ç°å®ä¸€ç‚¹:

```
#  rcctl start gitea # the same to the last step in the above
gitea(failed) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘æ‹¼äº†è€å‘½æŸ¥æ—¥å¿—å’Œæ‰‹å†Œåƒè¿™æ ·:

```
#  rcctl check gitea
$  nvim -R /var/www/logs/%some-log%
$  nvim -R /var/log/%some-log%
$  nvim -R /usr/local/share/doc/pkg-manuals/gitea 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†æ˜¯ç°å®ä»ç„¶æ˜¯è‹¦æ¶©çš„ğŸ˜–ä¿¡æ¯å¤ªå°‘ï¼Œæ‰¾ä¸åˆ°è·¯ã€‚

## [](#the-solution)è§£

**`-d`** é€‰é¡¹æ˜¯ã€‚

### [](#before)ä¹‹å‰

```
#  rcctl restart gitea 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç»“æœæ˜¯:

```
gitea(failed) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [å](#after)

```
#  rcctl -d restart gitea 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç»“æœæ˜¯:

```
doing _rc_parse_conf
doing _rc_quirks
gitea_flags empty, using default >web<
doing _rc_parse_conf /var/run/rc.d/gitea
doing _rc_quirks
doing _rc_parse_conf
doing _rc_quirks
gitea_flags empty, using default >web<
doing _rc_parse_conf /var/run/rc.d/gitea
doing _rc_quirks
doing rc_check
doing _rc_parse_conf
doing _rc_quirks
gitea_flags empty, using default >web<
doing _rc_parse_conf /var/run/rc.d/gitea
doing _rc_quirks
doing rc_check
gitea
doing rc_start
doing _rc_wait start
No home directory /nonexistent!
doing rc_check
Logging in with home = "/".
panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=... addr=... pc=...]

goroutine 1 [running]:
code.gitea.io/gitea/vendor/gopkg.in/ini%2ev1.(*Key).transformValue(...
        /usr/obj/ports/gitea-1.5.0/go/src/code.gitea.io/gitea/vendor/gopkg.in/ini.v1/key.go:123 +0x...
code.gitea.io/gitea/vendor/gopkg.in/ini%2ev1.(*Key).String(...
        /usr/obj/ports/gitea-1.5.0/go/src/code.gitea.io/gitea/vendor/gopkg.in/ini.v1/key.go:130 +0x...
code.gitea.io/gitea/vendor/gopkg.in/ini%2ev1.(*Key).MustString(...
        /usr/obj/ports/gitea-1.5.0/go/src/code.gitea.io/gitea/vendor/gopkg.in/ini.v1/key.go:202 +0x...
code.gitea.io/gitea/modules/setting.NewContext()
        /usr/obj/ports/gitea-1.5.0/go/src/code.gitea.io/gitea/modules/setting/setting.go:1151 +0x...
code.gitea.io/gitea/routers.GlobalInit()
        /usr/obj/ports/gitea-1.5.0/go/src/code.gitea.io/gitea/routers/init.go:47 +0x...
code.gitea.io/gitea/cmd.runWeb(...
        /usr/obj/ports/gitea-1.5.0/go/src/code.gitea.io/gitea/cmd/web.go:83 +0x...
code.gitea.io/gitea/vendor/github.com/urfave/cli.HandleAction(...
        /usr/obj/ports/gitea-1.5.0/go/src/code.gitea.io/gitea/vendor/github.com/urfave/cli/app.go:471 +0x...
code.gitea.io/gitea/vendor/github.com/urfave/cli.Command.Run(...
        /usr/obj/ports/gitea-1.5.0/go/src/code.gitea.io/gitea/vendor/github.com/urfave/cli/command.go:191 +0x...
code.gitea.io/gitea/vendor/github.com/urfave/cli.(*App).Run(...
        /usr/obj/ports/gitea-1.5.0/go/src/code.gitea.io/gitea/vendor/github.com/urfave/cli/app.go:241 +0x...
main.main()
        /usr/obj/ports/gitea-1.5.0/go/src/code.gitea.io/gitea/main.go:52 +0x...
doing _rc_rm_runfile
(failed) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¿¡æ¯å¤šä¹ˆä¸°å¯Œå•Šï¼
æ¯•ç«Ÿå¤šäºäº† Gitea çš„ Github é—®é¢˜: [#4692](https://github.com/go-gitea/gitea/issues/4692) ã€ [#4260](https://github.com/go-gitea/gitea/issues/4260) ï¼Œæˆ‘å‘ç°æ˜¯ Gitea çš„`app.ini`ä¸­`[U2F]`æ®µè®¾ç½®é”™è¯¯é€ æˆçš„ã€‚

```
#  rcctl restart gitea
gitea(ok) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½ğŸ˜†

* * *

## [](#reference)å¼•ç”¨

`rcctl`è¿˜æœ‰ä¸€ä¸ªå¼ºåˆ¶é€‰é¡¹`-f`æ¥å¯åŠ¨æ®‹ç–¾äººæœåŠ¡:

```
#  rcctl -f start %disabled-service% 
%disabled-service%(ok) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<center>âœ¿ âœ¿ âœ¿</center>

ä¸ºğŸ•ŠæœåŠ¡æ„‰å¿«