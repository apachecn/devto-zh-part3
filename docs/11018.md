# ä½¿ç”¨ React ä¸Šä¸‹æ–‡ API æ²¡æœ‰åµŒå¥—æ¸²æŸ“é€‚å½“çš„ç–²åŠ³ã€‚

> åŸæ–‡:[https://dev . to/blnk space/how-to-use-react-context-API-without-nested-render-prop-fatigue-14bm](https://dev.to/blnkspace/how-to-use-react-context-api-without-nested-render-prop-fatigue-14bm)

## ç¼–è¾‘:æœ‰äº† React é’©å­ï¼Œä½ å¯ä»¥æ¯«ä¸è´¹åŠ›åœ°ä½¿ç”¨ useContext æ¥åšè¿™ä»¶äº‹ï¼Œè¿™ç¯‡æ–‡ç« ç°åœ¨å·²ç»æ²¡æœ‰ä»€ä¹ˆä»·å€¼äº†ï¼Œåº“ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æˆ‘å‘ç°è‡ªå·±æ ¹æœ¬ä¸éœ€è¦è¿™ä¸ªã€‚

## [](#a-little-context-lol)ä¸€ç‚¹ä¸Šä¸‹æ–‡(lol)

Redux ä¸€ç›´æ˜¯æˆ‘çš„å®¶ï¼Œå°†æ˜¯æˆ‘å¾ˆå¤šç”¨ä¾‹çš„å®¶ã€‚è¿™ä½¿å¾—æ€»æ˜¯ä¸å¾—ä¸ç‹¬è‡ªç®¡ç†å¤§è§„æ¨¡é¡¹ç›®çš„å¼€å‘äººå‘˜çš„ç”Ÿæ´»å˜å¾—è½»æ¾ã€‚ä½†æ˜¯è¿™é‡Œæœ‰æ— æ•°çš„ç”¨ä¾‹ï¼Œä½ ä¸éœ€è¦ Redux çš„é­”åŠ›æˆ–åŠŸèƒ½ã€‚æœ‰æ—¶å€™ä½ åªéœ€è¦ä¸­å¤®çŠ¶æ€ï¼Œè€Œä¸éœ€è¦é“å…·æ¼”ç»ƒã€‚å»å¹´ï¼Œæˆ‘å‚åŠ äº†ä¸€äº›éœ€è¦å¸¦å›å®¶çš„å°é¡¹ç›®çš„å·¥ä½œé¢è¯•ï¼Œæˆ‘æ„è¯†åˆ°å½“ä½ ä¸éœ€è¦ Redux/MobX ç­‰æ—¶ï¼ŒContext API æ˜¯å¤šä¹ˆå¼ºå¤§ã€‚å”¯ä¸€çš„é—®é¢˜æ˜¯ï¼ŒRedux è®©æˆ‘å¯ä»¥å°†æ‰€æœ‰ä¸œè¥¿æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå¹¶ä¼˜é›…åœ°ä»ä¸­é€‰æ‹©æˆ‘éœ€è¦çš„ä¸œè¥¿ã€‚å¯¹äºæ¶ˆè´¹è€…ï¼Œæˆ‘é™·å…¥äº†æ¸²æŸ“é“å…·åœ¨æ¸²æŸ“é“å…·é‡Œé¢çš„æƒ…å†µ...ä½ æ˜ç™½äº†ã€‚å¦‚æœä½ å¯¹å‡½æ•°å¼ç¼–ç¨‹æ„Ÿå…´è¶£ï¼Œä½ è„‘æµ·ä¸­çš„ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯å¦‚æœæˆ‘èƒ½å†™è¿™äº›å°±å¥½äº†ã€‚è®©æˆ‘ä»¬çœ‹ä¸€äº›æœ‰è½»å¾®é—®é¢˜çš„ä»£ç æ¥ç†è§£è¿™ä¸€ç‚¹ã€‚

```
import React, { Fragment } from "react";
import { render } from "react-dom";
import { __, map, prop } from "ramda";

import Drawer from 'drawer-component-from-wherever';
import List from 'list-component-from-wherever';
import Title from 'title-component-from-wherever';

/*
    Note: the following is not the "right" way to initialise context values, you're
    supposed to use a Provider and pass a value prop to it. If the Consumer finds
    no matching parent Provider, only then it uses the arguments passed to
    createContext as the initial value. This is a hypothetical example,
    hence the shortcuts.
*/

const PoseContext = React.createContext('closed'); // is the drawer open or closed?
const CartContext = React.createContext([{
  ids: idsFromSomewhere,
  cartMap: objectFromSomewhereElse,
}]);

const App = () => (
  <PoseContext.Consumer>
    {pose => (
      <Drawer pose={pose}>
        <Title pose={pose}>Your Cart</Title>
        <CartContext.Consumer>
          {({ ids, cartMap }) => <List data={map(prop(__, cartMap), ids)} /> }
        </CartContext.Consumer>
      </Drawer>
    )}
  </PoseContext.Consumer> );

render(<App />, document.getElementById('appRoot')); 
```

å—¯ï¼Œç°åœ¨çœ‹èµ·æ¥ä¸å¤ªéš¾çœ‹äº†ã€‚ä½†æ˜¯æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¸ä½¿ç”¨ ramda å¹¶å¸è½½åˆ°å¦ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬åœ¨ CartContext çš„æ¶ˆè´¹è€…ä¸­æœ‰è¿™æ ·çš„ä¸œè¥¿:

```
<CartContext.Consumer>
  {({ ids, cartMap }) => (
    <Fragment>
      {ids.map((id) => {
        const product = cartMap[id];
        return (
          <CartItem onClick={clickHandler} key={id}>
            <Link route={`/products/${product.slug}/p/${product.id}`}>
              <a>{product.name}</a>
            </Link>
          </CartItem>
        );
      })}
    </Fragment>
  )}
</CartContext.Consumer>; 
```

ç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼Œä½†æ˜¯ä½¿ç”¨å¦ä¸€ä¸ªåä¸º CouponConsumer çš„æ¶ˆè´¹è€…æ¥æ³¨å…¥åº”ç”¨ç¨‹åºçš„ä¼˜æƒ åˆ¸ç›¸å…³çŠ¶æ€ã€‚å³ä½¿ç½ªé­ç¥¸é¦–æ˜¯ä¸¤ä¸ªæœˆå‰çš„æˆ‘ï¼Œæˆ‘ä¹Ÿä¼šå®³æ€•çœ‹åˆ° Cart.jsã€‚ç©ç¬‘å¼€å¤Ÿäº†ï¼Œç°åœ¨è®©æˆ‘ä»¬å¿ äºè¿™ç¯‡æ–‡ç« çš„æ ‡é¢˜ï¼Œå¹¶æå‡ºä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ¥åˆ¶ä½œæ•´æ´çš„ä»£ç ã€‚

## [](#adopting-reactadopt-ok-sorry-no-more)é‡‡ç”¨ react-é‡‡ç”¨(å¥½å§å¯¹ä¸èµ·æ²¡äº†)

### [](#the-tiny-library-that-saves-the-day)åŒ–é™©ä¸ºå¤·çš„å¾®å‹å›¾ä¹¦é¦†ã€‚

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png)/[ååº”â€”â€”é‡‡çº³](https://github.com/pedronauck/react-adopt)

### ğŸ˜åƒä¸“ä¸šäººå‘˜ä¸€æ ·ç¼–å†™æ¸²æŸ“é“å…·ç»„ä»¶

<article class="markdown-body entry-content container-lg" itemprop="text">

<g-emoji class="g-emoji" alias="sunglasses" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f60e.png">ğŸ˜</g-emoji> ***ååº”é‡‡ç”¨-*** åƒä¸“ä¸šäººå‘˜ä¸€æ ·æ’°å†™æ¸²æŸ“é“å…·ç»„ä»¶

[![GitHub release](../Images/568e32673e06b8ec1db2518e8a469d46.png)](https://raw.githubusercontent.com/pedronauck/react-adopt/master/)[![Build Status](../Images/a2d62f68f23ec065661778e211902634.png)](https://travis-ci.org/pedronauck/react-adopt)[![Codacy Badge](../Images/4f641fec1ddd7be23ab3b54132bb82cb.png)](https://www.codacy.com/app/pedronauck/react-adopt?utm_source=github.com&utm_medium=referral&utm_content=pedronauck/react-adopt&utm_campaign=Badge_Grade)

[![](../Images/964542e23002557844f0a18b4b7d8e5c.png)T2ã€‘](https://camo.githubusercontent.com/d8cf2e176f8f28a6474d00425ae188b2e904f81b/68747470733a2f2f692e696d67666c69702e636f6d2f3237657575322e6a7067)

## <g-emoji class="g-emoji" alias="scroll" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4dc.png">ğŸ“œ</g-emoji>ç›®å½•

*   [ä¸ºä»€ä¹ˆ](https://raw.githubusercontent.com/pedronauck/react-adopt/master/#--why)
*   [è§£å†³æ–¹æ¡ˆ](https://raw.githubusercontent.com/pedronauck/react-adopt/master/#--solution)
*   [æ¼”ç¤º](https://raw.githubusercontent.com/pedronauck/react-adopt/master/#--demos)
*   [ç”¨é€”](https://raw.githubusercontent.com/pedronauck/react-adopt/master/#--usage-demo)
    *   [ä½¿ç”¨æ–°çš„ä¸Šä¸‹æ–‡ api](https://raw.githubusercontent.com/pedronauck/react-adopt/master/#working-with-new-context-api)
    *   [è‡ªå®šä¹‰æ¸²æŸ“å’Œä»åˆæˆä¸­æ£€ç´¢é“å…·](https://raw.githubusercontent.com/pedronauck/react-adopt/master/#custom-render-and-retrieving-props-from-composed)
    *   [æ¥è‡ªæ˜ å°„å™¨çš„æ˜ å°„å±æ€§](https://raw.githubusercontent.com/pedronauck/react-adopt/master/#mapping-props-from-mapper)
    *   [ä½¿ç”¨æ˜ å°„å™¨ä¸Šçš„ç»„ä»¶](https://raw.githubusercontent.com/pedronauck/react-adopt/master/#using-components-on-mapper)
    *   [ä»¥å¤šä¸ªå‚æ•°å¼€å¤´](https://raw.githubusercontent.com/pedronauck/react-adopt/master/#leading-with-multiple-params)
    *   [æ”¯æŒæ‰“å­—ç¨¿](https://raw.githubusercontent.com/pedronauck/react-adopt/master/#typescript-support)
    *   [åœ¨çº¿æ’ç‰ˆ](https://raw.githubusercontent.com/pedronauck/react-adopt/master/#inline-composition)

## <g-emoji class="g-emoji" alias="monocle_face" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f9d0.png">ğŸ§</g-emoji> ä¸ºä»€ä¹ˆ

[æ¸²æŸ“é“å…·](https://reactjs.org/docs/render-props.html)æ˜¯ React ç”Ÿæ€ç³»ç»Ÿçš„æ–°ç‚’ä½œï¼Œè¿™æ˜¯äº‹å®ã€‚æ‰€ä»¥ï¼Œå½“ä½ éœ€è¦ä¸€èµ·ä½¿ç”¨å¤šä¸ªæ¸²æŸ“é“å…·ç»„ä»¶æ—¶ï¼Œè¿™å¯èƒ½ä¼šå¾ˆæ— èŠï¼Œç”Ÿæˆä¸€ä¸ªå«åš*ã€æ¸²æŸ“é“å…·å›è°ƒåœ°ç‹±ã€‘*çš„ä¸œè¥¿ï¼Œå°±åƒè¿™æ ·:

[![Bad](../Images/b60222bd58559ecdfb38aaa4e923dd3b.png)T2ã€‘](https://camo.githubusercontent.com/f4f4167721e1d5c75d26e98cfbf9b974d9fd5cb0/68747470733a2f2f692e696d6775722e636f6d2f716d6b33426b352e706e67)

## <g-emoji class="g-emoji" alias="bulb" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4a1.png">ğŸ’¡</g-emoji>æº¶æ¶²

*   **å°**ã€‚ç¼©å°äº† 0.7kbï¼
*   **æå…¶ç®€å•**ã€‚åªæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼

React Adopt æ˜¯ä¸€ä¸ªç®€å•æ–¹æ³•ï¼Œå®ƒç»„åˆäº†å¤šä¸ªæ¸²æŸ“å±æ€§ç»„ä»¶ï¼Œåˆå¹¶äº†æ¥è‡ªæ˜ å°„å™¨çš„æ¯ä¸ªå±æ€§ç»“æœã€‚

## <g-emoji class="g-emoji" alias="pager" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4df.png">ğŸ“Ÿ</g-emoji>æ¼”ç¤º

*   [åŸºæœ¬ç¤ºä¾‹](https://codesandbox.io/s/vq1wl37m0y?hidenavigation=1)
*   [ä½¿ç”¨ React Apollo çš„ Todo åº”ç”¨ç¤ºä¾‹](https://codesandbox.io/s/3x7n8wyp15?hidenavigation=1)
*   [æ–°ä¸Šä¸‹æ–‡ API ç¤ºä¾‹](https://codesandbox.io/s/qv3m6yk2n4?hidenavigation=1)

## <g-emoji class="g-emoji" alias="computer" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4bb.png">ğŸ’»</g-emoji>ç”¨æ³•

ä½œä¸ºé¡¹ç›®ä¾èµ–é¡¹å®‰è£…:

```
$ yarn add react-adopt
```

ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨â€¦

</article>

[View on GitHub](https://github.com/pedronauck/react-adopt)

```
import { adopt } from 'react-adopt';

const CombinedContext = adopt({
  pose: <PoseContext.Consumer />,
  cart: <CartContext.Consumer />,
});

const App = () => (
  <CombinedContext>
    {({ pose, cart: { ids, cartMap } }) => (
      <Drawer pose={pose}>
        <Title pose={pose}>Your Cart</Title>
        <List data={map(prop(__, cartMap), ids)} />
      </Drawer>
    )}
  </CombinedContext> ); 
```

å¾ˆæ•´æ´ï¼Œä¸æ˜¯å—ï¼Ÿæˆ‘ä»¬èƒ½å¤Ÿå°†ä¸¤ä¸ªæ¸²æŸ“é“å…·ç»„ä»¶ç»„åˆæˆä¸€ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ç”¨ä¸‰ä¸ªæˆ–å››ä¸ªç»„ä»¶åšåŒæ ·çš„äº‹æƒ…ã€‚è™½ç„¶ Context Consumers æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¼”ç¤ºï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå·§å¦™çš„æŠ€å·§ç”¨äºæ‰€æœ‰çš„æ¸²æŸ“ç»„ä»¶ï¼Œä½¿æˆ‘ä»¬çš„ä»£ç æ›´å®¹æ˜“ç†è§£å’Œç»„ç»‡ã€‚

æˆ‘æ­£åŠªåŠ›å…»æˆæ¯å‘¨å†™ä½œçš„ä¹ æƒ¯ï¼Œå¦‚æœä½ æƒ³çŸ¥é“æ›´å¤šæˆ‘åœ¨å‰ç«¯æ—…ç¨‹ä¸­å­¦åˆ°çš„å°æŠ€å·§ï¼Œè¯·è·Ÿéšæˆ‘ã€‚