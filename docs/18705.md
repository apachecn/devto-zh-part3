# å¦‚ä½•åœ¨ 4 ä¸ªå‘½ä»¤è¡Œä¸­è®¾ç½®æœ¬åœ° HashiCorp Vault é›†ç¾¤ï¼Ÿ

> åŸæ–‡:[https://dev.to/v6/how-do-i-set-up-a-hashicorp-vault-cluster-kdb](https://dev.to/v6/how-do-i-set-up-a-hashicorp-vault-cluster--kdb)

æˆ‘æƒ³ç»™ä½ çš„æ˜¯ä¸€ä¸ª Vault ç¯å¢ƒï¼Œä½ å¯ä»¥åœ¨ä¸åˆ° [25 åˆ†é’Ÿ](http://e.ggtimer.com/1500)å†…å¯åŠ¨å¹¶è¿è¡Œå®ƒï¼Œåªéœ€ 4 ä¸ªå‘½ä»¤è¡Œï¼*

*   å…è´£å£°æ˜:è¿™ 4 ä¸ªå‘½ä»¤è¡Œåªæœ‰åœ¨å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„ Gitã€Virtualbox å’Œ after åæ‰èƒ½å·¥ä½œã€‚ <sup id="fnref1">[1](#fn1)</sup>

å¬èµ·æ¥æ€ä¹ˆæ ·ï¼Ÿä¸€å¥—å…¨é¢è¿è¡Œçš„ 3 ä¸ª Vault æœåŠ¡å™¨ï¼Œåç«¯å— ACL ä¿æŠ¤ï¼Ÿ

æ‚¨ä»¥å‰æ˜¯å¦åªç”¨ 4 ä¸ªå‘½ä»¤è¡Œå°±åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Ÿ

å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆï¼Œå¥½å§ï¼Œæˆ‘ä»¬èµ°å§ï¼

è¯¥å›¾æ˜¾ç¤ºäº†â€œçº¯ä¸»æœºâ€ç½‘ç»œä¸­çš„ 3 å°è™šæ‹Ÿæœºã€‚è¿™æ„å‘³ç€ï¼Œå®ƒä»¬ä¸æ˜¯äº’è”ç½‘çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç›¸å½“äºä½ çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šçš„æœ¬åœ°æ— çº¿ç½‘ç»œã€‚ä½ çŸ¥é“æ€ä¹ˆæœ‰ä¸ªäººæŠ«è¨å—ï¼Ÿè¿™æ˜¯ä¸€ä¸ªä¸ªäººç½‘ç»œã€‚ä½ ä¸éœ€è¦æ‹…å¿ƒè¿™äº›ä¸œè¥¿ï¼Œå› ä¸º VirtualBox å’Œ vagger ä¼šä¸ºä½ åšè¿™äº›å·¥ä½œï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°çš„ã€‚

å›¾ä¸­ç”±ç™½è‰²çŸ©å½¢è¡¨ç¤ºçš„è™šæ‹Ÿæœºåç§°æ˜¯å®ä¾‹ 5ã€å®ä¾‹ 6 å’Œå®ä¾‹ 7ã€‚æ¯ä¸ªä¸Šé¢éƒ½å®‰è£…äº†[æ‰§æ”¿å®˜](https://www.consul.io/)å’Œ[é‡‘åº“](https://www.vaultproject.io)ã€‚Consuls è¢«é…ç½®ä¸ºå½¢æˆä¸€ä¸ªé›†ç¾¤ï¼Œè¯¥é›†ç¾¤å……å½“ Vault æœåŠ¡å™¨çš„å­˜å‚¨å’Œé«˜å¯ç”¨æ€§â€œåç«¯â€ã€‚

[![Vagrant setup with 3 VMs. Consul and Vault are installed on each VM. The Consuls are configured to form a cluster, which acts as the Vault backend.](../Images/a15b397d06300292b6474ae06c85c8ae.png "Vagrant setup with 3 VMs. Consul and Vault are installed on each VM.")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--qct7SMbA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/p3kk0l2oxzvumayi6b1g.png)

æœ‰æ„ä¹‰å—ï¼Ÿå¾ˆå¥½ã€‚å¦‚æœæ²¡æœ‰ï¼Œå˜¿ï¼Œæ€»æœ‰è¯„è®ºåŒºã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¼„æ¸…æ¥šä¸€äº›å…ˆå†³æ¡ä»¶ã€‚

å¦‚æœæ‚¨è¢«å…ˆå†³æ¡ä»¶ã€è¦å®‰è£…çš„å·¥å…·æˆ–ä¸‹è½½ä»£ç æ‰€å›°æ‰°ï¼Œè¯·çœ‹çœ‹ç½‘ä¸Šçš„èµ„æºï¼Œæˆ–è€…èŠ±å‡ åˆ†é’Ÿåœ¨è¯„è®ºä¸­å‘æ³„ä¸€ä¸‹ã€‚

ç‰¹åˆ«æ˜¯å¯¹äºæµæµªè€…ï¼Œä¸€æ—¦ä½ å®‰è£…äº†æµæµªè€…å’Œ Virtualboxï¼Œå…¥é—¨æŒ‡å—éœ€è¦å¤§çº¦ 30 åˆ†é’Ÿ:[https://www.vagrantup.com/intro/getting-started/index.html](https://www.vagrantup.com/intro/getting-started/index.html)

ä½†æ˜¯ï¼Œå¦‚æœä½ å‘ç°ä¸€ä¸ª Vault å·¥ä½œä¸æ­£å¸¸çš„é”™è¯¯ï¼Œè¯·å°½å¿«åœ¨ [Vault è®¨è®ºç»„](https://groups.google.com/forum/#!forum/vault-tool)ä¸Šå‘å¸–ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥å¸®åŠ©ä½ åˆ¤æ–­è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ª bugã€‚

# [](#osspecific-prerequisites)ç‰¹å®šäºæ“ä½œç³»ç»Ÿçš„å…ˆå†³æ¡ä»¶

*   MacOS: OSX 10.13 æˆ–æ›´é«˜ç‰ˆæœ¬
*   Windows: Windows å¿…é¡»æœ‰ [Powershell 3.0](https://stackoverflow.com/a/32385347/2146138) æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å¦‚æœä½ ç”¨çš„æ˜¯ Windows 7ï¼Œæˆ‘æ¨è Windows Management Framework 4.0ï¼Œå› ä¸ºå®ƒæ›´å®¹æ˜“å®‰è£…

# [](#install-virtualbox-and-git)å®‰è£… VirtualBox å’Œ Git

é¦–å…ˆè¦åšçš„æ˜¯ [Virtualbox](https://www.virtualbox.org/wiki/Downloads) å’Œ [Git](https://git-scm.com/downloads) ï¼Œå› ä¸ºå®ƒä»¬å°†å…è®¸ä½ è¿è¡Œä¸€ä¸ªâ€œè™šæ‹Ÿæœºâ€ï¼Œå¹¶å…è®¸ä½ åˆ†åˆ«è·å¾—è¿™ä¸ªæ¼”ç»ƒçš„ä»£ç ã€‚

# [](#install-vagrant)å®‰è£…æµæµªæ±‰

ç¬¬ä¸€ä¸ªå·¥å…·æ˜¯ vaggerï¼Œä¸€ä¸ªå¸®åŠ©å¼€å‘ç¯å¢ƒæ‰€æœ‰ç»†èŠ‚çš„ç¨‹åºã€‚æŠŠå®ƒæƒ³è±¡æˆä»£ç çš„åŸºç¡€è®¾æ–½ï¼Œä½†æ˜¯å¯¹äºè™šæ‹Ÿæœºã€å®¹å™¨å’Œè‡ªåŠ¨åŒ–è®¾ç½®ç¨‹åºçš„æ¯ç‡¥éƒ¨åˆ†ï¼Œä½ å¿…é¡»åœ¨å®ƒä»¬ä¸Šé¢è¿è¡Œæ¥åšå¼€å‘å·¥ä½œã€‚

### [](#install-tools)å®‰è£…å·¥å…·

1.  ç¡®ä¿ä½ å·²ç»å®‰è£…äº† [Git](https://git-scm.com/downloads)
2.  å®‰è£…*æœ€æ–°*ç‰ˆæœ¬çš„æµæµªè€…([æ³¨:WINDOWS 7 å’Œ WINDOWS 8 éœ€è¦ POWERSHELL > = 3](https://blogs.technet.microsoft.com/heyscriptingguy/2013/06/02/weekend-scripter-install-powershell-3-0-on-windows-7/) )
3.  å®‰è£…*æœ€æ–°*ç‰ˆæœ¬çš„ VMWare æˆ– [Virtualbox](https://www.virtualbox.org/wiki/Downloads)

### [](#reason-for-this-article)æœ¬æ–‡åŸå› 

å½“ä½ ç­‰å¾…æ‰€æœ‰è¿™äº›ä¸œè¥¿å®‰è£…çš„æ—¶å€™ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå…³äºæˆ‘ä¸ºä»€ä¹ˆå†™è¿™ä¸ªçš„è¯´æ˜ã€‚

å¦‚æœæ‚¨æœç´¢[,å¦‚ä½•è®¾ç½® hashicorp vault é›†ç¾¤ï¼Ÿ](https://duckduckgo.com/?q=how+do+I+set+up+a+hashicorp+vault+cluster)ï¼Œæ‚¨å°†è·å¾—ä¸€äº›æ¶µç›–æ¦‚å¿µçš„ç»“æœï¼Œä¸€äº›è®¨è®ºå¦‚ä½•ä½¿ç”¨ Vault çš„ APIï¼Œä¸€äº›è®¨è®ºå¦‚ä½•å¯ç”¨ Vault Enterprise çš„ä¸€èˆ¬åŠŸèƒ½ã€‚

ä¾‹å¦‚ï¼ŒHashiCorp æœ‰ä¸€ä¸ªä¼˜ç§€çš„éƒ¨ç½²æŒ‡å—ï¼Œå¦‚ä¸‹æ‰€ç¤º:

[å­˜å‚¨åº“éƒ¨ç½²æŒ‡å—](https://learn.hashicorp.com/vault/operations/ops-deployment-guide)

ä»¥åŠå¯é çš„å‚è€ƒæ¶æ„ï¼Œå¦‚ä¸‹æ‰€ç¤º:

[ä¿é™©åº“å‚è€ƒæ¶æ„](https://learn.hashicorp.com/vault/operations/ops-reference-architecture.html)

ä½†æ˜¯æœ‰ä¸€äº›å…ˆå†³æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œåœ¨ã€Šéƒ¨ç½²æŒ‡å—ã€‹ä¸­ï¼Œæ‚¨é¦–å…ˆéœ€è¦çŸ¥é“å¦‚ä½•å®‰è£… Vault æœåŠ¡å™¨ï¼Œå¹¶çŸ¥é“å¦‚ä½•åœ¨ç½‘ç»œå®¹å™¨æˆ–å…¶ä»–åŸºç¡€è®¾æ–½ä¸Šè¿è¡Œå®ƒï¼Œç„¶åå†å¼€å§‹é˜…è¯»è¯¥æŒ‡å—ã€‚

å‚è€ƒä½“ç³»ç»“æ„æ›´å¤šçš„æ˜¯å¯¹ç¤ºä¾‹ä½“ç³»ç»“æ„çš„æ¦‚è¿°ï¼Œè€Œä¸æ˜¯æ·±å…¥åˆ°ä¸ Vault æˆ– Consul æ²¡æœ‰ç›´æ¥å…³ç³»çš„å‘½ä»¤çš„æœ¬è´¨ã€‚

è¿™äº›ä¹Ÿä¸æ˜¯å…³äºä½¿ç”¨å“ªç§ç½‘ç»œå †æ ˆæˆ–å…¶ä»–åŸºç¡€è®¾æ–½æ¥è®¾ç½®æ‚¨çš„ Vault é›†ç¾¤çš„è§„å®šæˆ–æ„è§ã€‚

æˆ‘ä¸ºé‚£äº›æˆ‘è®¤ä¸ºå·²ç»å¯¹è„šæœ¬ã€Gitã€é…ç½®æ–°çš„ SSH è¿æ¥ã€å®‰è£…è½¯ä»¶å’Œè™šæ‹Ÿæœºæœ‰æ‰€äº†è§£çš„äººå†™äº†è¿™ç¯‡æŒ‡å—ï¼Œå› ä¸ºè¿™äº›å¾ˆéš¾è§£é‡Šï¼Œè€Œä¸”åœ¨åˆ«å¤„æœ‰æ›´å¥½çš„èµ„æºã€‚

æ— è®ºå¦‚ä½•ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘è¦å†™ä¸€ä¸ªç®€å•çš„ Vault é›†ç¾¤è®¾ç½®ã€‚å®‰è£…å‡ ä¸ªè·¨å¹³å°çš„å¼€æºå·¥å…·(vaggerã€VirtualBox å’Œ Git)ï¼Œè¿è¡Œå‡ ä¸ªé€šç”¨å‘½ä»¤ï¼Œç­‰å¾… 10 åˆ†é’Ÿï¼Œç§ï¼Œæ‚¨çš„æ–° Vault é›†ç¾¤å°±å¯ä»¥è¿è¡Œäº†ã€‚

### [](#screencast-example)æˆªå±ç¤ºä¾‹

å¦‚æœæ‚¨æƒ³åœ¨æµè§ˆæœ¬æŒ‡å—æ—¶æ‰“å¼€å®ƒï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªè®¾ç½®çš„æˆªå±ç¤ºä¾‹:

[![Screencast of the Vagrant setup with 3 VMs. Consul and Vault are installed on each VM. The Consuls are configured to form a cluster, which acts as the Vault backend.](../Images/9ad3c342a8e7057f516782ae3497a978.png "Screencast of Vagrant setup with 3 VMs. Consul and Vault are installed on each VM.")T2ã€‘](https://player.vimeo.com/video/310219248)

### [](#download-the-code-for-the-vault-cluster-setup)ä¸‹è½½ Vault é›†ç¾¤è®¾ç½®çš„ä»£ç 

*ç›¸å…³å‚å•†æ–‡æ¡£é“¾æ¥:[https://help.github.com/articles/cloning-a-repository](https://help.github.com/articles/cloning-a-repository)T3ã€‘*

`git clone https://github.com/v6/super-duper-vault-train.git`

### [](#use-this-code-to-make-a-vault-cluster)ä½¿ç”¨æ­¤ä»£ç åˆ¶ä½œä¸€ä¸ª Vault é›†ç¾¤

*ç›¸å…³æµæµªå•†è´©æ–‡æ¡£é“¾æ¥:[https://www.vagrantup.com/intro/index.html#why-vagrant-](https://www.vagrantup.com/intro/index.html#why-vagrant-)T3ã€‘*

1.  `cd super-duper-vault-train`
2.  `vagrant up` ##æ³¨æ„:æ‚¨å¯èƒ½éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç­‰å¾…`vagrant up`å®Œæˆï¼Œå¹¶ä¸”åœ¨æˆåŠŸè¿æ¥ä¹‹å‰å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ä¼šå‡ºç°ä¸€äº›â€œè¿æ¥é‡è¯•â€é”™è¯¯ï¼Œå› ä¸ºè™šæ‹Ÿæœºæ­£åœ¨å¯åŠ¨ã€‚ç¡®ä¿ä½ æœ‰æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¹¶å°è¯•æµæµªå…¥é—¨æŒ‡å—

> æ³¨æ„:ä½ å·²ç»èµ°äº†è¿™ä¹ˆè¿œã€‚ç°åœ¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ—¶é—´æ‰¾åˆ°ä½ å½“åœ°çš„è²å°”èŒ¨æˆ–çš®ç‰¹æˆ–æ˜Ÿå·´å…‹å¾—åˆ°ä¸€ä¸ªå½“ä¹‹æ— æ„§çš„`<insert favorite snack or beverage>`ï¼Œå› ä¸º`vagrant up`è¿‡ç¨‹...è‰¯å¥½çš„...è¿™éœ€è¦ä¸€æ®µæ—¶é—´ã€‚**è®©æµæµªè€…å»åšå·¥ä½œï¼Œè€Œä½ å¾—åˆ°é¢å¤–æ´¥è´´ã€‚**

1.  `vagrant status`
2.  `vagrant ssh instance5`åœ¨ä½ `ssh`åˆ°é‚£ä¸ªåä¸º`instance5`çš„è™šæ‹Ÿæœºåï¼Œä½ ä¼šçœ‹åˆ°ä½ çš„å‘½ä»¤æç¤ºç¬¦å˜æˆæ˜¾ç¤º`vagrant@instance5`ã€‚æ‚¨è¿˜å¯ä»¥å°†`vagrant ssh`ä¸­çš„å…¶ä»–è™šæ‹Ÿæœºåˆ—åœ¨`vagrant status`çš„è¾“å‡ºä¸­ã€‚
3.  ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨è¿è¡Œ`vagrant ssh`çš„è™šæ‹Ÿæœºä¸­ä½¿ç”¨ Vault æˆ– Consulã€‚ä¾‹å¦‚ï¼Œåœ¨æ‚¨çš„ä»»ä½•è™šæ‹Ÿæœºä¸­å°è¯•å‘½ä»¤`consul members`æˆ–`vault status`ã€‚

# [](#vault)è·³é©¬

### [](#explore-the-vault-cluster)æ¢ç´¢é‡‘åº“é›†ç¾¤

`ps -ef | grep vault` ##æ£€æŸ¥ Vault è¿›ç¨‹(åœ¨è¢«ç®¡ç†çš„å®ä¾‹ä¸­è¿è¡Œ)

`ps -ef | grep consul` ##æ£€æŸ¥ Consul è¿›ç¨‹(åœ¨è¢«ç®¡ç†çš„å®ä¾‹ä¸­è¿è¡Œ)

`vault version` ##è¾“å‡ºåº”è¯¥æ˜¯`Vault v0.10.2 ('3ee0802ed08cb7f4046c2151ec4671a076b76166')`

`consul version`ã€‚# #è¾“å‡ºåº”è¯¥æ˜¾ç¤º Consul ä»£ç†ç‰ˆæœ¬å’Œ Raft åè®®ç‰ˆæœ¬

æµæµªæ±‰åšæ£®æœ‰ä»¥ä¸‹ IP åœ°å€:

```
192.168.13.35

192.168.13.36

192.168.13.37 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é‡‘åº“å’Œæ‰§æ”¿å®˜éƒ½åœ¨è¿è¡Œã€‚

ä¿é™©åº“åœ¨ 8200 ç«¯å£ã€‚

é¢†äº‹åœ¨ 8500 ç«¯å£ã€‚

### [](#open-the-links-in-tabs)æ‰“å¼€æ ‡ç­¾é¡µä¸­çš„é“¾æ¥

http://192.168.13.35:8200 (é‡‘åº“)

http://192 . 168 . 13 . 35:8500(é¢†äº‹)

http://192.168.13.36:8200 (é‡‘åº“)

http://192 . 168 . 13 . 36:8500(é¢†äº‹)

http://192.168.13.37:8200 (é‡‘åº“)

http://192 . 168 . 13 . 37:8500(é¢†äº‹)

### [](#start-vault-data)å¯åŠ¨é‡‘åº“æ•°æ®

*ç›¸å…³å‚å•†æ–‡æ¡£é“¾æ¥:[https://www.vaultproject.io/api/system/init.html](https://www.vaultproject.io/api/system/init.html)T3ã€‘*

å¯åŠ¨ä¿é™©åº“ã€‚

åœ¨ä¸€ä¸ªè¢«ç®¡ç†çš„è™šæ‹Ÿæœºä¸Šè¿è¡Œè¿™ä¸ª`curl`å‘½ä»¤ï¼Œæˆ–è€…åœ¨ä½ å®‰è£…äº†`curl`çš„è®¡ç®—æœºä¸Šè¿è¡Œè¿™ä¸ªå‘½ä»¤ã€‚

```
 curl -s --request PUT -d '{"secret_shares": 3,"secret_threshold": 2}' http://192.168.13.35:8200/v1/sys/init 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#unseal-vault)è§£å°é‡‘åº“

*ç›¸å…³å‚å•†æ–‡æ¡£é“¾æ¥:[https://www.vaultproject.io/api/system/unseal.html](https://www.vaultproject.io/api/system/unseal.html)T3ã€‘*

å¦‚æœæˆåŠŸï¼Œè¯¥è¿‡ç¨‹å°†åœ¨`192.168.13.35:8200`è§£å°ä¿é™©åº“ã€‚æ‚¨å¯ä»¥å¯¹`192.168.13.36:8200`å’Œ`192.168.13.37:8200`ä½¿ç”¨ç›¸åŒçš„è¿‡ç¨‹ã€‚

1.  ä½¿ç”¨æ‚¨çš„è§£å°å¯†é’¥æ›¿æ¢å¯†é’¥`abcd1430890...`çš„å€¼ï¼Œå¹¶åœ¨è¢«ç®¡ç†çš„è™šæ‹Ÿæœºä¸Šè¿è¡Œå®ƒã€‚

```
 curl --request PUT --data '{"key":"abcd12345678..."}' http://192.168.13.35:8200/v1/sys/unseal 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

1.  å†æ¬¡è¿è¡Œ`curl`å‘½ä»¤ã€‚ä½†æ˜¯å¯¹`"key":`ä½¿ç”¨ä¸åŒçš„å€¼ã€‚ä»è¿è¡Œ`v1/sys/init`ç«¯ç‚¹æ—¶æ”¶åˆ°çš„å¯†é’¥ä¸­ï¼Œç”¨ä¸åŒäºä¸Šä¸€æ­¥ä¸­ä½¿ç”¨çš„å¯†é’¥æ›¿æ¢`efgh2541901...`ã€‚

```
 curl --request PUT --data '{"key":"efgh910111213..."}' http://192.168.13.35:8200/v1/sys/unseal 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#nonvagrant)éæµæµªè€…

è¯·å‚è€ƒæˆ‘ä»¬ä¹‹å‰å…‹éš†çš„å­˜å‚¨åº“ä¸­çš„æ–‡ä»¶[PRODUCTION _ installation . MD](https://github.com/v6/super-duper-vault-train/blob/develop/PRODUCTION_INSTALLATION.md)ã€‚

# [](#codified-vault-policies-and-configuration)æ•´ç†å­˜å‚¨åº“ç­–ç•¥å’Œé…ç½®

è¦é€šè¿‡å…¶ API æä¾› Vaultï¼Œè¯·å‚è€ƒæˆ‘ä»¬ä¹‹å‰å…‹éš†çš„å­˜å‚¨åº“ä¸­çš„ [`provision_vault`æ–‡ä»¶å¤¹](https://github.com/v6/super-duper-vault-train/tree/develop/provision_vault)ã€‚

å®ƒæœ‰æ•°æ®å’Œè„šæœ¬ã€‚

`data`æ–‡ä»¶å¤¹çš„æ ‘å¯¹åº”äº HashiCorp Vault API
ç«¯ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤º:

[https://www . hashi corp . com/blog/coding-vault-policies-and-configuration # layout-and-design](https://www.hashicorp.com/blog/codifying-vault-policies-and-configuration#layout-and-design)

åœ¨
åˆå§‹åŒ–å¹¶è§£å°ä¿é™©åº“ä¹‹åï¼Œ
é€šè¿‡å…¶ API å¿«é€Ÿé…ç½®ä¿é™©åº“ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ‚¨åˆå§‹æ ¹ä»¤ç‰Œçš„ç¼–ç ä¿é™©åº“
ç­–ç•¥å’Œé…ç½®
ã€‚

çš„ã€‚æ¯ä¸ªæ–‡ä»¶å¤¹
ä¸­çš„ json æ–‡ä»¶å¯¹åº”äºé€šè¿‡å…¶ API å‘é€åˆ° Vault
çš„æœ‰æ•ˆè½½è·ï¼Œä½†ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œä¹Ÿå¯èƒ½æœ‰`.hcl`ã€
ã€`.sample`ã€`.sh`æ–‡ä»¶ã€‚

æ‰‹åŠ¨è®¾ç½®çš„è¿›ä¸€æ­¥é˜…è¯»:

[https://medium . com/rigged-ops/building-a-local-hashi corp-vault-cluster-5575 Fe 322 a 17](https://medium.com/rigged-ops/building-a-local-hashicorp-vault-cluster-5575fe322a17)

* * *

1.  *æ¹¿æ»‘ï¼Œç‰ˆæƒæ‰€æœ‰ï¼Œå³ä½¿æ˜¯çŸ›ç›¾çš„ã€‚åˆ€åˆƒéå¸¸é”‹åˆ©ã€‚è¿™ä¸ªé¡¹ç›®å¯èƒ½åŒ…å«è‡ªç”±/å¼€æºè½¯ä»¶ä»£ç ã€‚æœªç»æˆæƒä½¿ç”¨æˆ–å¤åˆ¶æœ¬ç½‘ç«™ä¸Šçš„ææ–™æ˜¯ä¸¥æ ¼è¦æ±‚ï¼Œå¹¶å—åˆ°ç¥è´ºã€‚ä¸è¦åƒã€‚æ¨èä½¿ç”¨ğŸ¥½æŠ¤ç›®é•œã€‚ä¼˜æƒ åœ¨å‚ä¸åœ°ç‚¹æœ‰æ•ˆï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯æŒ‡æ‰€æœ‰åœ°ç‚¹ã€‚æ—¨åœ¨ä¸å…¶ä»–æŠ¥ä»·ç›¸ç»“åˆæˆ–ä»¥æŸç§æ–¹å¼å·§å¦™å¤åˆ¶ã€‚æ¯æ¬¡è®¿é—®é™åˆ¶ä¸€ä¸ªæµæµªè€…ã€‚ç°é‡‘ä»·å€¼æ˜¯ä¸€ä¸ªæ¯”ç‰¹å¸çš„ 1/100000000ï¼Œä½†ä¸è¦é€¼æˆ‘è¿™ä¹ˆåšï¼Œå› ä¸ºç°åœ¨è°çŸ¥é“è¿™æ„å‘³ç€ä»€ä¹ˆã€‚è¿™æ˜¯ç»†åˆ™ï¼Œä½ ä¸ºä»€ä¹ˆè¿˜åœ¨çœ‹è¿™ä¸ªï¼ŸçœŸçš„ï¼Œè¿™æ˜¯è¶Šæ¥è¶Šæ„šè ¢ï¼Œå»ä»£ç ã€‚* [â†©](#fnref1)