# ä¸€ä¸ª Lerna monorepo ä¸­çš„å¤šä¸ª VueJs åº”ç”¨ç¨‹åºï¼Œå…±äº«ä¸€ä¸ªæ•…äº‹ä¹¦ç»„ä»¶åº“ã€‚

> åŸæ–‡:[https://dev . to/pixari/multiple-vuejs-apps-in-a-lerna-mono repo-sharing-a-story book-component-library-1f7k](https://dev.to/pixari/multiple-vuejs-apps-in-a-lerna-monorepo-sharing-a-storybook-component-library-1f7k)

*(æŸ¥çœ‹[æˆ‘çš„åšå®¢](https://raffaelepizzari.com/) )*

> ä½ å¥½ï¼è¿™æ˜¯æ­£åœ¨è¿›è¡Œä¸­çš„åŸå‹ï¼Œä½†å®é™…ä¸Šå®ƒå·²ç»å·¥ä½œã€‚æˆ‘æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯:å¤šä¸ª VueJs åº”ç”¨å…±äº«ä¸€ä¸ªç»„ä»¶åº“ã€‚æˆ‘æƒ³æŠŠå®ƒä»¬éƒ½æ”¾åœ¨ç”± Lerna ç®¡ç†çš„ monorepo ä¸­ã€‚
> ç»„ä»¶åº“åŸºäºæ•…äº‹ä¹¦ã€‚

è¯·éšæ—¶å¸®åŠ©æˆ‘/ç»™æˆ‘ä½ çš„å»ºè®®ã€‚

## [](#what-i-want-to-achieve)æˆ‘æƒ³å®ç°ä»€ä¹ˆ

*ç®€å•æ€§å’Œå¯ç»´æŠ¤æ€§*ã€‚
åœ¨æˆ‘çš„åœºæ™¯ä¸­ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªå›¢é˜Ÿæ­£åœ¨å¼€å‘ç»„ä»¶ï¼Œå¹¶ä½¿ç”¨*è¯­ä¹‰ç‰ˆæœ¬*æ›´æ–°å®ƒä»¬ã€‚
æ‰€æœ‰ VueJs åº”ç”¨ç¨‹åºéƒ½ä½¿ç”¨å…±äº«ç»„ä»¶ï¼Œæ›´æ”¹æ—¥å¿—æ ¹æ®æäº¤æ¶ˆæ¯å’Œæ ‡ç­¾è‡ªåŠ¨åˆ›å»ºã€‚æäº¤æ¶ˆæ¯å’Œæ ‡ç­¾ç”± Lerna è‡ªåŠ¨ç®¡ç†ã€‚

â€œæ¡†æ¶â€å·²ç»åœ¨å·¥ä½œäº†ï¼Œä½†æ˜¯æˆ‘ä»ç„¶éœ€è¦æ”¹è¿›ä¸€äº›æ­¥éª¤ï¼Œå¢åŠ ä¸€äº›åŠŸèƒ½ã€‚

è¿™æ˜¯ GitHub å›è´­:[https://github.com/pixari/component-library-monorepo](https://dev.topixar/component-library-monorepo)ã€‚

è¿™é‡Œæ˜¯â€œå¦‚ä½•åšâ€:

## [](#getting-started)å…¥é—¨

### [](#install-lerna)å®‰è£…æ³¥æµ†

è®©æˆ‘ä»¬ä»ä½¿ç”¨ npm å…¨å±€å®‰è£… Lerna å¼€å§‹:

```
$ npm install --global lerna 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

æ¥ä¸‹æ¥æˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„ git å­˜å‚¨åº“:

```
$ git init component-library-monorepo && cd component-library-monorepo 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åï¼ŒæŒ‰ç…§ Lerna çš„å®˜æ–¹æ–‡ä»¶ï¼Œå°†å®ƒå˜æˆä¸€ä¸ª Lerna å›è´­:

```
lerna init 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªå‚¨å­˜åº“åº”è¯¥çœ‹æå’Œè¿™ä¸ª:

```
component-library-monorepo/
  packages/
  lerna.json
  package.json 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºè¿™ä¸ªè¿‡ç¨‹çš„ä¿¡æ¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹å®˜æ–¹çš„ Lerna æ–‡æ¡£ã€‚

### [](#install-storybook)å®‰è£…æ•…äº‹ä¹¦

è®©æˆ‘ä»¬ä»ä½¿ç”¨ npm å…¨å±€å®‰è£… Lerna å¼€å§‹:

```
$ npm install @storybook/vue --save-dev 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ·»åŠ å¯¹ç­‰ä¾èµ–å…³ç³»

```
$ npm install vue --save
$ npm install vue-loader vue-template-compiler @babel/core babel-loader babel-preset-vue --save-dev 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ·»åŠ  npm è„šæœ¬

```
{  "scripts":  {  "storybook":  "start-storybook"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹äºä¸€ä¸ªåŸºæœ¬çš„æ•…äº‹ä¹¦é…ç½®ï¼Œæ‚¨å”¯ä¸€éœ€è¦åšçš„äº‹æƒ…å°±æ˜¯å‘Šè¯‰æ•…äº‹ä¹¦åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°æ•…äº‹ã€‚

ä¸ºæ­¤ï¼Œè¯·åœ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚storybook/config.js åŒ…å«ä»¥ä¸‹å†…å®¹:

```
import { configure } from '@storybook/vue';

const req = require.context('../packages', true, /.stories.js$/);
function loadStories() {
  req.keys().forEach(filename => req(filename));
}
configure(loadStories, module); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#add-the-first-component-to-the-component-library)å°†ç¬¬ä¸€ä¸ªç»„ä»¶æ·»åŠ åˆ°ç»„ä»¶åº“ä¸­

æˆ‘ä»¬åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª packages/index.stories.js æ–‡ä»¶ï¼Œå¹¶ç¼–å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ•…äº‹:

```
import Vue from 'vue';
import { storiesOf } from '@storybook/vue';
import MyButton from './Button/src/Button.vue';

storiesOf('Button', module)
  .add('as a component', () => ({
    components: { MyButton },
    template: '<my-button>with text</my-button>'
  }))
  .add('with emoji', () => ({
    components: { MyButton },
    template: '<my-button>ğŸ˜€ ğŸ˜ ğŸ‘ ğŸ’¯</my-button>'
  }))
  .add('with text', () => ({
    components: { MyButton },
    template: '<my-button :rounded="true">rounded</my-button>'
  })); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬åˆ›å»ºçœŸæ­£çš„â€œæŒ‰é’®â€ç»„ä»¶:

```
/packages/Button
  /src
    Button.vue 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
<template>
  <button type="button"><slot /></button>
</template>

<script>
export default {
  name: 'MyButton',
}
</script> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

index.js

```
/packages/Button
  src/index.js 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
import MyButton from './Button.vue';
export default MyButton; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿˜æœ‰ package.json:

```
{  "name":  "@mylibrary/my-button",  "version":  "0.2.0",  "description":  "Just a simple button component",  "main":  "dist/index.js",  "module":  "src/index.js",  "scripts":  {  "transpile":  "vue-cli-service build --target lib ./src/index.js"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#start-storybook)å¼€å§‹æ•…äº‹ä¹¦

ç°åœ¨ä½ å·²ç»å‡†å¤‡å¥½å¯åŠ¨ Storybook å¹¶å¼€å§‹ç©ä½ çš„ç¬¬ä¸€ä¸ªç»„ä»¶:

```
$ npm run storybook 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ åº”è¯¥çœ‹åˆ°å®ƒåœ¨è¿™é‡Œè¿è¡Œ:

```
http://localhost:51368 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#create-a-vuejs-app)åˆ›å»ºä¸€ä¸ª VueJs App

### [](#installation)å®‰è£…

è¦å®‰è£… Vue CLIï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:

```
$ npm install -g @vue/cli
$ npm install --save-dev @vue/cli-service 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#create-a-new-project)åˆ›å»ºæ–°é¡¹ç›®

è¦åˆ›å»ºæ–°é¡¹ç›®ï¼Œè¿è¡Œ:

```
$ cd packages && vue create my-app 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·é€‰æ‹©æœ€ç®€å•çš„é€‰é¡¹:

```
> default (babel, eslint) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸æƒ³æ„å»ºæœ€å¥½çš„ VueJs åº”ç”¨ç¨‹åºï¼Œè€Œåªæ˜¯å±•ç¤ºå¦‚ä½•åœ¨ VueJs åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«ç»„ä»¶åº“ã€‚

## [](#add-eslint-configuration)æ·»åŠ  eslint é…ç½®

åˆ›é€ ã€‚/packages/my-app/. eslintrc . js

```
module.exports = {
    "env": {
        "browser": true,
        "es6": true
    },
    "extends": [
        "eslint:recommended",
        "plugin:vue/essential"
    ],
    "globals": {
        "Atomics": "readonly",
        "SharedArrayBuffer": "readonly"
    },
    "parserOptions": {
        "ecmaVersion": 2018,
        "sourceType": "module"
    },
    "plugins": [
        "vue"
    ],
    "rules": {
    }
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#run-the-app)è¿è¡Œ App

è®©æˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„æ–°åº”ç”¨:

```
$ cd my-app && npm run serve 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæ‚¨åº”è¯¥å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œå¯åŠ¨å¹¶è¿è¡Œ:

```
http://localhost:8080/ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#using-lerna-to-link-dependencies)ä½¿ç”¨ Lerna æ¥é“¾æ¥ä¾èµ–å…³ç³»

å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ°æ‚¨çš„ packages/my-app/package . JSON:

```
{  "dependencies":  {  "@mylibrary/my-button":  "*"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#fix-eslint)å›ºå®šæ–¯æ´›æ–‡å°¼äºšè¯­

```
const path = require('path');
module.exports = {
  chainWebpack: config => {
    config.module
      .rule('eslint')
      .use('eslint-loader')
      .tap(options => {
        options.configFile = path.resolve(__dirname, ".eslintrc.js");
        return options;
      })
  },
  css: {
    loaderOptions: {
      postcss: {
        config:{
          path:__dirname
        }
      }
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥â€œå¼•å¯¼â€å½“å‰ Lerna repo ä¸­çš„è½¯ä»¶åŒ…ï¼Œå®‰è£…å®ƒä»¬çš„æ‰€æœ‰ä¾èµ–é¡¹ï¼Œå¹¶é“¾æ¥ä»»ä½•äº¤å‰ä¾èµ–é¡¹:

åœ¨æ ¹:

```
$ lerna bootstrap 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#update-the-vue-app)æ›´æ–° Vue App

æ”¹å˜çš„å†…å®¹ã€‚/packages/my-app/src/main . js:

```
import Vue from 'vue'
import App from './App.vue'
import MyButton from '@mylibrary/my-button';

Vue.config.productionTip = false
Vue.component('my-button', MyButton);
new Vue({
  render: h => h(App),
}).$mount('#app') 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶æ›´æ”¹æˆ‘ä»¬çš„ HelloWorld ç»„ä»¶çš„å†…å®¹(ã€‚/packages/my-app/src/components/hello world . vue):

```
<template>
  <div class="hello">
    <h1>{{ msg }}</h1>
    <my-button>It Works!</my-button>
  </div> </template> 
<script>
export default {
  name: 'HelloWorld',
  props: {
    msg: String
  }
}
</script> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç°åœ¨ä¼ è¾“æˆ‘ä»¬çš„ç»„ä»¶:

```
$ lerna run transpile 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å†æ¬¡è¿è¡Œ..

```
$ cd packages/my-app && npm run serve 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è½¬åˆ° [http://localhost:8080](http://localhost:8080) ï¼Œä½ åº”è¯¥çœ‹åˆ° HelloWorld é¡µé¢ä¸­é—´çš„æŒ‰é’®:)