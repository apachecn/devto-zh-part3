# Spring Boot + Groovy:ä»é›¶åˆ°è‹±é›„

> åŸæ–‡:[https://dev.to/jorge_rockr/spring-boot-groovy-ä»é›¶åˆ°è‹±é›„-5d39](https://dev.to/jorge_rockr/spring-boot--groovy-from-zero-to-hero-5d39)

Java çš„æˆ‘ä¸çŸ¥é“æ˜¯çŒ«å¤´é¹°å—æˆ‘ä¸çŸ¥é“

[![](../Images/6bcf860c65933b5ad43ade059362050c.png)T2ã€‘](https://i.giphy.com/media/54PaD9dWT0go/giphy.gif)

æˆ‘ä¸å–œæ¬¢ä½¿ç”¨ Java(ä¹Ÿè¯·ä¸è¦ä½¿ç”¨å®ƒ)ï¼Œä½†æœ‰æ—¶æˆ‘ä¸å¾—ä¸è¿™æ ·åš...äº‹å®å°±æ˜¯å¦‚æ­¤ã€‚

[![](../Images/457de64248b94695be12608255358ff9.png)T2ã€‘](https://i.giphy.com/media/eBCnpuRGBhQGY/giphy-downsized-large.gif)

å‡ å‘¨å‰ï¼Œæˆ‘åœ¨ [Indigo](https://www.dsindigo.com/) å¼€å§‹äº†ä¸€ä¸ªæ–°é¡¹ç›®(è¯·è·Ÿéšä»–ä»¬ï¼)é€‰æ‹©çš„æ¡†æ¶æ˜¯ [Spring Boot](http://spring.io/projects/spring-boot) ï¼Œè¿™ä¸€æ¬¡æˆ‘æ²¡æœ‰é€‰æ‹©ï¼Œå› ä¸ºå’Œæˆ‘ä¸€èµ·å¼€å‘çš„å¦ä¸€ä¸ªäººå–œæ¬¢ç»„åˆ **Java + Spring Boot** ã€‚

[![](../Images/bfdc2bf41f4be66e9182762a8f026e8b.png)T2ã€‘](https://i.giphy.com/media/Pch8FiF08bc1G/giphy.gif)

ä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘è¯´â€œç»“åˆâ€ï¼ŸğŸ¤”å—¯ï¼Œæœ‰ä¸€äº›åœ¨ JVM ä¸Šå·¥ä½œçš„ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å¦‚ Kotlinã€Scala å’Œæˆ‘æœ€å–œæ¬¢çš„ Groovyï¼ã€‚

## [](#what-is-groovy)ä»€ä¹ˆæ˜¯ Groovyï¼Ÿ

æ ¹æ®å®ƒçš„å®˜æ–¹é¡µé¢:

> Apache Groovy æ˜¯ä¸€ç§å¼ºå¤§çš„ã€å¯é€‰ç±»å‹çš„åŠ¨æ€è¯­è¨€ï¼Œå…·æœ‰é™æ€ç±»å‹å’Œé™æ€ç¼–è¯‘èƒ½åŠ›ï¼Œç”¨äº Java å¹³å°ï¼Œç”±äºå…¶ç®€æ´ã€ç†Ÿæ‚‰ä¸”æ˜“äºå­¦ä¹ çš„è¯­æ³•ï¼Œæ—¨åœ¨æé«˜å¼€å‘äººå‘˜çš„ç”Ÿäº§ç‡ã€‚å®ƒå¯ä»¥ä¸ä»»ä½• Java ç¨‹åºé¡ºåˆ©é›†æˆï¼Œå¹¶ç«‹å³ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›å¼ºå¤§çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬è„šæœ¬åŠŸèƒ½ã€ç‰¹å®šé¢†åŸŸçš„è¯­è¨€åˆ›ä½œã€è¿è¡Œæ—¶å’Œç¼–è¯‘æ—¶å…ƒç¼–ç¨‹ä»¥åŠå‡½æ•°å¼ç¼–ç¨‹ã€‚

æ¢å¥è¯è¯´ï¼Œä½ å¯ä»¥åšæ›´å¥½çš„ä¸œè¥¿ï¼Œå†™æ›´å°‘çš„ä»£ç ï¼Œè·å¾—ä¸€äº› Java åšä¸åˆ°çš„å¾ˆé…·çš„ç‰¹æ€§ã€‚

## [](#what-will-be-our-example)æˆ‘ä»¬çš„æ¦œæ ·ä¼šæ˜¯ä»€ä¹ˆï¼Ÿ

è¿™æ¬¡æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå£è¢‹å¦–æ€ª APIï¼ï¼è®©æˆ‘ä»¬æŠ“ä½ä»–ä»¬

[![](../Images/546b94c1b603da43c38267ee0e2e5103.png)T2ã€‘](https://i.giphy.com/media/W04QVzelTHsNW/giphy.gif)

æˆ‘ä»¬çš„ API å¿…é¡»:

*   è·å–æ‰€æœ‰åŸ¹è®­å¸ˆçš„ä¿¡æ¯
*   è·å–ç‰¹å®šæ•™ç»ƒçš„ä¿¡æ¯
*   è·å¾—æ‰€æœ‰ç‰¹å®šè®­ç»ƒå¸ˆçš„å£è¢‹å¦–æ€ª

## [](#what-will-be-using-to-solve-that)é‚£ä¼šç”¨ä»€ä¹ˆæ¥è§£å†³å‘¢ï¼Ÿ

*   Java 8
*   Gradle
*   Spring Boot
*   ç»å¦™çš„
*   å…³ç³»å‹æ•°æ®åº“
*   é£è¡Œè·¯çº¿æ•°æ®åº“

## [](#what-do-i-need-to-install)æˆ‘éœ€è¦å®‰è£…ä»€ä¹ˆï¼Ÿ

*   Java 8 æˆ–æ›´é«˜ç‰ˆæœ¬
*   Gradle
*   å…³ç³»å‹æ•°æ®åº“

å¼ºçƒˆæ¨èä½ é€šè¿‡ [SDKMAN](https://sdkman.io) å®‰è£… Java å’Œ Gradleã€‚

æˆ‘ä»¬å¼€å§‹å§ï¼

## [](#1-create-the-base-project-with-gradle)1ã€‚ç”¨ Gradle åˆ›å»ºåŸºç¡€é¡¹ç›®

åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªåä¸º`build.gradle`çš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å°†:

*   ä¸‹è½½æ‰€æœ‰ä¾èµ–é¡¹
*   ç¼–è¯‘æ•´ä¸ªé¡¹ç›®
*   è¿è¡Œ Spring Boot æœåŠ¡å™¨
*   å¦‚æœéœ€è¦ï¼Œè¿è¡Œæµ‹è¯•

æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬åŠ ä¸Šä¸‹é¢å‡ è¡Œ:

```
buildscript {
  ext {
    springBootVersion = '2.0.6.RELEASE'
  }
  repositories {
    mavenCentral()
  }
  dependencies {
    classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
  }
}

apply plugin: 'groovy'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'

group = 'com.pokemon'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = 1.8

repositories {
  mavenCentral()
}

dependencies {
  implementation("org.springframework.boot:spring-boot-starter-web:${springBootVersion}")
  implementation('org.codehaus.groovy:groovy:2.5.3')
} 
```

è¿™å‡ è¡Œå‘Šè¯‰ Gradle å°† Maven Central é…ç½®ä¸ºé»˜è®¤å­˜å‚¨åº“ï¼Œä¸‹è½½å¹¶ä½¿ç”¨`spring-boot-gradle-plugin`å¹¶ä¸‹è½½ä»¥ä¸‹ä¾èµ–é¡¹:

*   **Spring Boot ç½‘**:å…¬å¼€ REST æœåŠ¡
*   **Groovy** :ç¼–è¯‘å’Œè§£é‡Šæ‰€æœ‰ Groovy/Java ä»£ç 

æˆ‘ä»¬çš„åŸºç¡€åŒ…åä¹Ÿå°†æ˜¯`com.pokemon`,æ‰€ä»¥æ¯ä¸ªæœ‰è¿™ä¸ªåŒ…åçš„ç±»éƒ½å°†ç”± Gradle ç¼–è¯‘ï¼Œç”± Spring Boot ä½¿ç”¨ã€‚

## [](#2-create-the-base-code-and-run-it-for-the-first-time)2ã€‚åˆ›å»ºåŸºæœ¬ä»£ç å¹¶é¦–æ¬¡è¿è¡Œå®ƒ

åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºç›®å½•`src/main/groovy/com/pokemon`ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªåä¸º`Application.groovy` :
çš„æ–‡ä»¶

```
package com.pokemon

import org.springframework.boot.SpringApplication
import org.springframework.boot.autoconfigure.SpringBootApplication

// In groovy every class is public by default
// so you don't need to write "public class" anymore
@SpringBootApplication
class Application {

    // Every method is public as well
    static void main(String[] args) {

        // You can omit the last method call parenthesis
        // This is the same as .run(Application, args)
        // also you can omit ;
        SpringApplication.run Application, args
    }
} 
```

æ‰“å¼€æ‚¨çš„ç»ˆç«¯ï¼Œè½¬åˆ°æ‚¨çš„é¡¹ç›®ç›®å½•ï¼Œé”®å…¥å‘½ä»¤`gradle bootRun`è®©æ‚¨çš„åº”ç”¨ç¨‹åºåƒè¿™æ ·è¿è¡Œ:

[![](../Images/2f0ac06ab14af3f32010e6fb0329564b.png)T2ã€‘](https://i.giphy.com/media/8gKOQx8DDF6BkRRNhL/giphy.gif)

## [](#3-sql-tables-with-flyway-db)3ã€‚å¸¦æœ‰ Flyway æ•°æ®åº“çš„ SQL è¡¨

ä½¿ç”¨ SQL æ•°æ®åº“é€šå¸¸æ˜¯ä¸€ä»¶ç—›è‹¦çš„äº‹æƒ…ã€‚

ä½ å¦‚ä½•ä¸ä½ çš„å›¢é˜Ÿåˆ†äº«æ•°æ®åº“ç»“æ„ï¼Ÿ

å¤„ç†å®ƒçš„ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª SQL è„šæœ¬ï¼Œå¹¶ä¸æ‰€æœ‰å¼€å‘äººå‘˜å…±äº«ã€‚

å¬èµ·æ¥ä¸é”™ï¼Œå¯¹å§ï¼Ÿ

[![](../Images/cbb3c1dd31e45e122f7c7464d6c9a9bd.png)T2ã€‘](https://i.giphy.com/media/111ebonMs90YLu/giphy.gif)

ä½†æ˜¯ï¼Œå½“æ‚¨éœ€è¦å‘è„šæœ¬æ·»åŠ æ›´æ”¹(æ¯”å¦‚ä¿®æ”¹ç°æœ‰çš„è¡¨æˆ–æ·»åŠ æ–°è¡¨)æ—¶ï¼Œæ‚¨ç°åœ¨è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå¼€å‘å›¢é˜Ÿå¦‚ä½•ä»è¿™äº›å˜æ›´ä¸­å¾—åˆ°é€šçŸ¥ï¼Ÿ

PHP Laravel ç­‰æ¡†æ¶å¼•å…¥äº†*è¿ç§»*çš„æ¦‚å¿µã€‚å¯¹æ•°æ®åº“çš„æ¯æ¬¡æ›´æ”¹(åˆ›å»ºè¡¨ã€æ·»åŠ å­—æ®µã€æ›´æ”¹å­—æ®µç±»å‹ç­‰)éƒ½æ˜¯ä¸€æ¬¡*è¿ç§»*ã€‚è¿ç§»æŒ‰ä¸€å®šçš„é¡ºåºæ‰§è¡Œï¼Œå¹¶ä½¿æ•°æ®åº“å§‹ç»ˆä¿æŒæœ€æ–°ã€‚

**Flyway DB** å°†å¸®åŠ©æˆ‘ä»¬è§£å†³é—®é¢˜ï¼Œä½†åœ¨ Java (Groovy)ä¸­ã€‚

æ ¹æ®å®ƒçš„å®˜æ–¹é¡µé¢:

> æ•°æ®åº“çš„ç‰ˆæœ¬æ§åˆ¶ã€‚è·¨æ‚¨æ‰€æœ‰ç¯å¢ƒçš„å¼ºå¤§æ¨¡å¼æ¼”å˜ã€‚
> è½»æ¾ã€æ„‰å¿«ã€ç®€å•çš„ SQLã€‚

æ‰€ä»¥ç°åœ¨è®©æˆ‘ä»¬å°† **Flyway DB** ã€ **Spring Data** å’Œ **MySQL Connector** æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚

ç¼–è¾‘`build.gradle`æ–‡ä»¶å’Œä»¥ä¸‹ä¾èµ–é¡¹:

```
implementation('org.flywaydb:flyway-core:5.2.0')
implementation("org.springframework.boot:spring-boot-starter-data-jpa:${springBootVersion}")
implementation('mysql:mysql-connector-java:8.0.13') 
```

ç°åœ¨åœ¨`src/main/resources`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º`application.properties` :
çš„æ–°æ–‡ä»¶

```
spring.flyway.url=jdbc:mysql://localhost/
spring.flyway.user=your-username
spring.flyway.password=your-password
spring.flyway.schemas=your-database-name

spring.datasource.url=jdbc:mysql://localhost/your-database-name
spring.datasource.username=your-username
spring.datasource.password=your-password
spring.datasource.driver-class-name=com.mysql.jdbc.Driver 
```

ä¸è¦å¿˜è®°æ›´æ”¹**ä½ çš„ç”¨æˆ·å**ã€**ä½ çš„å¯†ç **å’Œ**ä½ çš„æ•°æ®åº“å**çš„å€¼ã€‚

åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæ•°æ®åº“åæ˜¯`pokemon_example`ã€‚

**spring.flyway** å‡­è¯è®© **FlywayDB** è¿æ¥åˆ°æ•°æ®åº“ï¼Œå¹¶åœ¨æ¯æ¬¡è¿è¡Œé¡¹ç›®æ—¶å®‰è£…æœ€æ–°çš„æ›´æ”¹ã€‚

**spring.datasource** å‡­è¯è®© **Spring Data** è¿æ¥åˆ°æ•°æ®åº“å¹¶è¿è¡ŒæŸ¥è¯¢ã€‚

ä¸ºäº†åˆ›å»ºåˆå§‹è¡¨ï¼Œåœ¨`src/main/resources/db/migration`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º`V1__creating_initial_tables.sql` :
çš„æ–°æ–‡ä»¶

```
CREATE TABLE trainers(
  id INTEGER AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL,
  level SMALLINT NOT NULL DEFAULT 1,
  PRIMARY KEY (id)
);

CREATE TABLE pokemon(
  id INTEGER AUTO_INCREMENT,
  name VARCHAR(20) NOT NULL,
  number SMALLINT NOT NULL,
  PRIMARY KEY (id)
);

CREATE TABLE wild_pokemon(
  id INTEGER AUTO_INCREMENT,
  combat_power SMALLINT NOT NULL DEFAULT 0,
  pokemon_id INTEGER NOT NULL,
  trainer_id INTEGER,
  PRIMARY KEY (id),
  FOREIGN KEY (pokemon_id) REFERENCES pokemon (id)
    ON DELETE CASCADE,
  FOREIGN KEY (trainer_id) REFERENCES trainers (id)
    ON DELETE SET NULL
); 
```

**Flyway DB** ä½¿ç”¨æ¨¡å¼ **VN__any_name.sql** æœç´¢`db/migration`ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå…¶ä¸­ N æ˜¯å”¯ä¸€ç‰ˆæœ¬ï¼Œä¾‹å¦‚:

*   one
*   001
*   Five point two
*   1.2.3.4.5.6.7.8.9
*   Two hundred and five point six eight
*   20130115113556
*   2013.1.15.11.35.56
*   2013.01.15.11.35.56

æˆ‘ä¸ªäººæ›´å–œæ¬¢ä½¿ç”¨è¿™ç§ç‰ˆæœ¬æ§åˆ¶:

*   V1 _ _ æ— è®ºå¦‚ä½•. sql
*   V2 _ _ æ— è®ºå¦‚ä½•. sql
*   ç­‰ç­‰ã€‚

æœ€åï¼Œç”¨`gradle bootRun`å‘½ä»¤è¿è¡Œé¡¹ç›®ï¼Œç„¶åæŸ¥çœ‹æ•°æ®åº“ã€‚

[![](../Images/359b3a466be818e94b483eb7b68ec697.png)T2ã€‘](https://i.giphy.com/media/etn4pXJcDkR4DDYHiy/giphy.gif)

## [](#4-entity-classes-domain)4ã€‚å®ä½“ç±»(åŸŸ)

å›åˆ°ä»£ç ï¼ŒæˆåŠŸåˆ›å»ºæ•°æ®åº“åï¼Œæ˜¯æ—¶å€™å°†è¿™äº›è¡¨æ˜ å°„åˆ°ç±»äº†ã€‚

åœ¨`src/main/groovy/com/pokemon`ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªåä¸º`entity`çš„ç›®å½•ï¼Œå¹¶æ–°å»º 3 ä¸ªæ–‡ä»¶:

*   `Trainer.groovy`
*   `Pokemon.groovy`
*   `WildPokemon.groovy`

*Trainer.groovy*

```
package com.pokemon.entity

import javax.persistence.Entity
import javax.persistence.Id
import javax.persistence.GeneratedValue
import javax.persistence.Table
import javax.persistence.GenerationType
import javax.validation.constraints.NotNull
import javax.persistence.Column

@Entity
@Table(name = "trainers")
class Trainer {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  Integer id

  @NotNull
  @Column(nullable = false)
  String name

  @NotNull
  @Column(nullable = false)
  Short level
} 
```

*Pokemon.groovy*

```
package com.pokemon.entity

import javax.persistence.Entity
import javax.persistence.Id
import javax.persistence.GeneratedValue
import javax.persistence.Table
import javax.persistence.GenerationType
import javax.validation.constraints.NotNull
import javax.persistence.Column

@Entity
@Table(name = "pokemon")
class Pokemon {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  Integer id

  @NotNull
  @Column(nullable = false)
  String name

  @NotNull
  @Column(nullable = false)
  Short number
} 
```

*WildPokemon.groovy*

```
package com.pokemon.entity

import javax.persistence.Entity
import javax.persistence.Id
import javax.persistence.GeneratedValue
import javax.persistence.Table
import javax.persistence.GenerationType
import javax.validation.constraints.NotNull
import javax.persistence.Column
import javax.persistence.ManyToOne
import javax.persistence.JoinColumn

@Entity
@Table(name = "wild_pokemon")
class WildPokemon {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  Integer id

  @NotNull
  @Column(name = "combat_power", nullable = false)
  Integer combatPower

  @ManyToOne
  @JoinColumn(name = "pokemon_id", referencedColumnName = "id", nullable = false)
  Pokemon pokemon

  @ManyToOne
  @JoinColumn(name = "trainer_id", referencedColumnName = "id", nullable = true)
  Trainer trainer
} 
```

åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·è®°ä½ï¼ï¼å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Groovyï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦æ·»åŠ æ— èŠçš„*getter*å’Œ*setter*:

```
// Groovy version
class Example {

  String property
}

Example ex = new Example(property: "hello world")
ex.property = "hola inmundo"

// -----------------------------------------------------

// Java version
public class Example {

  private String property;

  public Example(String property) {
    this.property = property;
  }

  public String getProperty() {
    return property;
  }

  public void setProperty(String property) {
    this.property = property;
  }
}

Example ex = new Example("hello world")
ex.setProperty("hola inmundo") 
```

å°‘å†™ä»£ç  FTWï¼ğŸ¤™

å¦‚æ‚¨æ‰€è§ï¼ŒåŸºäºè¡¨åˆ›å»ºå®ä½“ç±»å¾ˆå®¹æ˜“ã€‚åœ¨`WildPokemon`æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸¤ä¸ªå¤šå¯¹ä¸€å…³ç³»ï¼Œä¸€ä¸ªåˆ°`Pokemon`ç±»(æˆ–è¡¨),å¦ä¸€ä¸ªåˆ°`Trainer`ç±»(æˆ–è¡¨)ã€‚åªæœ‰`Trainer`å…³ç³»å¯ä»¥ä¸ºç©ºã€‚

## [](#5-repository-classes-persistence-layer)5ã€‚å­˜å‚¨åº“ç±»(æŒä¹…å±‚)

ç±»æ˜¯å®šä¹‰æˆ‘ä»¬çš„æŸ¥è¯¢çš„åœ°æ–¹ã€‚å®ƒæ—¢ç®€å•åˆç¥å¥‡ã€‚

è®°ä½æˆ‘ä»¬çš„ API ç›®æ ‡:

*   è·å–æ‰€æœ‰åŸ¹è®­å¸ˆçš„ä¿¡æ¯
*   è·å–ç‰¹å®šæ•™ç»ƒçš„ä¿¡æ¯
*   è·å¾—æ‰€æœ‰ç‰¹å®šè®­ç»ƒå¸ˆçš„å£è¢‹å¦–æ€ª

å¥½äº†ï¼Œè®©æˆ‘ä»¬æŠŠè¿™äº›ç‰¹æ€§ç¿»è¯‘æˆ SQL æŸ¥è¯¢:

```
-- Get the information of all trainers
SELECT * FROM trainers;

-- Get the information of a specific trainer
SELECT * FROM trainers WHERE id = ?;

-- Get all caught pokemon of a specific trainer
SELECT * FROM wild_pokemon WHERE trainer_id = ?; 
```

ä¼¼ä¹æ˜¯åˆæ³•çš„ã€‚

ä½†æ˜¯å¦‚æœæŸ¥è¯¢æ˜¯ç”¨äººç±»å¯è¯»çš„æ–‡æœ¬ç¼–å†™çš„å‘¢ï¼Ÿ

```
# Get the information of all trainers
find all trainers

# Get the information of a specific trainer
find trainer by id

# Get all caught pokemon of a specific trainer
find wild pokemon by trainer id 
```

ä¿¡ä¸ä¿¡ç”±ä½ ï¼Œä½¿ç”¨æ¥è‡ª **Spring æ•°æ®**çš„`JpaRepository`æ¥å£ï¼Œæˆ‘ä»¬çš„æŸ¥è¯¢æ˜¯:

*   `findAll`
*   `findById`
*   `findByTrainerId`

éå¸¸å®¹æ˜“ï¼ï¼ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰

è®©æˆ‘ä»¬å¯¹å®ƒä»¬è¿›è¡Œç¼–ç ï¼Œåœ¨`src/main/groovy/com/pokemon`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º`repository`çš„æ–°æ–‡ä»¶ï¼Œå¹¶åˆ›å»º 2 ä¸ªæ–°æ–‡ä»¶:

*   `TrainerRepository.groovy`
*   `WildPokemonRepository.groovy`

*trainerrepository . groovy*

```
package com.pokemon.repository

import com.pokemon.entity.Trainer
import org.springframework.data.jpa.repository.JpaRepository
import org.springframework.stereotype.Repository

@Repository
interface TrainerRepository extends JpaRepository<Trainer, Integer> {

  List<Trainer> findAll()

  Trainer findById(Integer id)
} 
```

*wild pokemon repository . groovy*

```
package com.pokemon.repository

import com.pokemon.entity.WildPokemon
import org.springframework.data.jpa.repository.JpaRepository
import org.springframework.stereotype.Repository

@Repository
interface WildPokemonRepository extends JpaRepository<WildPokemon, Integer> {

  List<WildPokemon> findByTrainerId(Integer trainerId)
} 
```

å°±è¿™ä¹ˆç®€å•ï¼Œ **Spring Data** å°†æœç´¢æ‰€æœ‰ç”¨`@Repository`æ ‡æ³¨çš„ç±»ï¼Œå¹¶éªŒè¯æ–¹æ³•ç­¾åã€‚

## [](#6-service-classes-business-layer)6ã€‚æœåŠ¡ç±»åˆ«(ä¸šåŠ¡å±‚)

æˆ‘ä»¬çš„ API æ ¹æœ¬ä¸éœ€è¦ä¸šåŠ¡é€»è¾‘ï¼Œä½†åˆ›å»ºæœåŠ¡ç±»å¹¶åœ¨å…¶ä¸­ä½¿ç”¨å­˜å‚¨åº“ä»ç„¶æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚

åœ¨`src/main/groovy/com/pokemon`ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`service`çš„æ–°ç›®å½•ï¼Œç„¶ååœ¨`service`ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`impl`çš„æ–°ç›®å½•ã€‚

æˆ‘ä»¬çš„`service`ç›®å½•å°†åŒ…å«æ¥å£å’Œ`impl`å®ƒä»¬çš„å®ç°ã€‚

ç­‰ç­‰ï¼Œä»€ä¹ˆï¼Ÿ

[![](../Images/bb855f73648554790c7da7f11d802f06.png)T2ã€‘](https://i.giphy.com/media/oOxBQwNqGwxeWLDF6A/giphy.gif)

å®ƒæœ‰å®ƒçš„è§£é‡Šã€‚

å‡è®¾ä½ è¦å®ç°ä¸€ä¸ªå­˜å‚¨æ–‡ä»¶çš„ç±»:

```
class FileStorage {

  String saveFile(String base64) {
    // storing file in disk...
  }
} 
```

éå¸¸ç®€å•ï¼Œä½†æ˜¯ä½ çš„å®¢æˆ·ç«¯ä¹Ÿéœ€è¦å°†æ–‡ä»¶å­˜å‚¨åœ¨äºšé©¬é€Š S3 å’Œ Azure Blob ä¸­ã€‚è§£å†³é—®é¢˜æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ

ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå› ä¸ºç›˜å†…å­˜å‚¨ã€äºšé©¬é€Š S3 å­˜å‚¨å’Œ Azure Blob å­˜å‚¨åšçš„æ˜¯åŒæ ·çš„äº‹æƒ…ï¼Œä¿å­˜ä¸€ä¸ªæ–‡ä»¶:

```
interface Storage {

  String saveFile(String base64)
} 
```

ç„¶åä¸ºæ¯ç§å­˜å‚¨ç±»å‹å®ç°è¯¥ç±»ã€‚

```
class S3Storage implements Storage {
}

class BlobStorage implements Storage {
}

class DiskStorage implements Storage {
} 
```

æœ€åï¼Œæ‚¨å¯ä»¥éšæ—¶ä½¿ç”¨`polymorphism`æ¥æ›´æ”¹å­˜å‚¨ç±»å‹:

```
// Save the file in Amazon S3
Storage storage = new S3Storage()

// Save the file in Azure Blob
Storage storage = new BlobStorage()

// Save the file in disk
Storage storage = new DiskStorage() 
```

è¿™å°±æ˜¯æˆ‘ä»¬åˆ›å»ºæ¥å£çš„åŸå› ï¼Œå› ä¸ºä¸šåŠ¡é€»è¾‘å¯ä»¥æ ¹æ®å®¢æˆ·çš„éœ€è¦éšæ—¶æ”¹å˜ã€‚

å› æ­¤ï¼Œè®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„ 2 ä¸ªæ¥å£åŠå…¶å®ç°:

*trainerservice . groovy*

```
package com.pokemon.service

import com.pokemon.entity.Trainer

interface TrainerService {

  List<Trainer> findAll()

  Trainer findById(int id)
} 
```

*trainerserviceimpl . groovy*T2ã€‘

```
package com.pokemon.service.impl

import com.pokemon.entity.Trainer
import com.pokemon.service.TrainerService
import com.pokemon.repository.TrainerRepository
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.stereotype.Service

@Service
class TrainerServiceImpl implements TrainerService {

  @Autowired
  private final TrainerRepository trainerRepository

  @Override
  List<Trainer> findAll() {
    trainerRepository.findAll()
  }

  @Override
  Trainer findById(int id) {
    trainerRepository.findById(id)
  }
} 
```

`WildPokemonService`å®ç°éå¸¸ç›¸ä¼¼ã€‚

æˆ‘ä»¬çš„å®ç°ç±»æœ‰`@Service`æ³¨é‡Šï¼Œå› ä¸ºå½“å¦ä¸€ä¸ªç±»ä½¿ç”¨`@Autowired`æ³¨é‡Šæ—¶ï¼Œ **Spring** ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚

åœ¨`TrainerServiceImpl`ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`@Autowired`æ³¨é‡Šæ¥åˆ›å»ºä¸€ä¸ª`TrainerRepository`ç±»çš„å®ä¾‹ã€‚

æ³¨é‡Šéå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬å‘Šè¯‰ **Spring** å®ƒä»¬æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•å¤„ç†å®ƒä»¬ã€‚

## [](#7-controller-classes)7ã€‚æ§åˆ¶å™¨ç±»åˆ«

æœ€åï¼Œæ˜¯æ—¶å€™åˆ›å»ºå…·æœ‰ 3 ä¸ªç«¯ç‚¹çš„æ§åˆ¶å™¨äº†:

*   `/trainers` -è·å¾—æ‰€æœ‰è®­ç»ƒå¸ˆ
*   `/trainers/{ id }` -æ‰¾ä¸€ä¸ªç‰¹å®šçš„æ•™ç»ƒ
*   è·å¾—ç‰¹å®šè®­ç»ƒè€…çš„æ‰€æœ‰å£è¢‹å¦–æ€ª

åœ¨`src/main/groovy/com/pokemon`ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸º`controller`çš„æ–‡ä»¶ï¼Œç„¶åæ–°å»ºä¸€ä¸ªåä¸º`TrainerController.groovy` :
çš„æ–‡ä»¶

```
package com.pokemon.controller

import com.pokemon.entity.Trainer
import com.pokemon.entity.WildPokemon
import com.pokemon.service.TrainerService
import com.pokemon.service.WildPokemonService
import org.springframework.web.bind.annotation.RestController
import org.springframework.web.bind.annotation.RequestMapping
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.web.bind.annotation.RequestMethod
import org.springframework.web.bind.annotation.PathVariable

@RestController
@RequestMapping('/trainers')
class TrainerController {

  @Autowired
  private final TrainerService trainerService

  @Autowired
  private final WildPokemonService wildPokemonService

  @RequestMapping(method = RequestMethod.GET)
  List<Trainer> findAll() {
    trainerService.findAll()
  }

  @RequestMapping(value = '/{id}/pokemon', method = RequestMethod.GET)
  List<Trainer> findCaughtPokemon(@PathVariable('id') int id) {
    wildPokemonService.findByTrainer id
  }

  @RequestMapping(value = '/{id}', method = RequestMethod.GET)
  Trainer findById(@PathVariable('id') int id) {
    trainerService.findById id
  }
} 
```

`@RequestMapping`æ³¨é‡Šé…ç½®è¯¥æ§åˆ¶å™¨ä¸­å®šä¹‰çš„æ‰€æœ‰ç«¯ç‚¹çš„å‰ç¼€ã€‚è¿˜é…ç½®æ–¹æ³•ç±»å‹(GETã€POSTã€PUTã€DELETE ç­‰)ã€‚

æ³¨é‡Šä¸ºæˆ‘ä»¬åˆ›å»ºäº†æœåŠ¡ç±»çš„å®ä¾‹ã€‚

`@PathVariable` annotation å°†æŒ‡å®šçš„ URL å‚æ•°ä¼ é€’ç»™æ–¹æ³•è°ƒç”¨ã€‚

æœ€åï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ **Flyway DB** å°†è™šæ‹Ÿæ•°æ®æ’å…¥ MySQLã€‚åˆ›å»ºä¸€ä¸ªåä¸º`V2__inserting_example_data.sql` :
çš„æ–°è¿ç§»(åœ¨`src/main/resources/db/migration`ä¸­)

```
INSERT INTO trainers VALUES (1, 'Red', 40), (2, 'Ash Ketchum', 10);

INSERT INTO pokemon VALUES
  (1, 'Bulbasaur', 1), (2, 'Ivysaur', 2), (3, 'Venosaur', 3), (4, 'Charmander', 4),
  (5, 'Charmeleon', 5), (6, 'Charizard', 6), (7, 'Squirtle', 7), (8, 'Wartortle', 8),
  (9, 'Blastoise', 9);

INSERT INTO wild_pokemon VALUES
  (1, 2000, 1, 3), (2, 2100, 4, 6), (7, 2000, 7, 9), (8, 600, 1, 2); 
```

ç”¨`gradle bootRun`å‘½ä»¤è¿è¡Œé¡¹ç›®ï¼Œè¿›å…¥ä½ æœ€å–œæ¬¢çš„æµè§ˆå™¨ï¼Œå¯¼èˆªåˆ°[http://localhost:8080/trainers/1/pokemon](http://localhost:8080/trainers/1/pokemon)è·å–:

```
[  {  "id":1,  "combatPower":2000,  "pokemon":{  "id":3,  "name":"Venosaur",  "number":3  },  "trainer":{  "id":1,  "name":"Red",  "level":40  }  },  {  "id":2,  "combatPower":2100,  "pokemon":{  "id":6,  "name":"Charizard",  "number":6  },  "trainer":{  "id":1,  "name":"Red",  "level":40  }  },  {  "id":7,  "combatPower":2000,  "pokemon":{  "id":9,  "name":"Blastoise",  "number":9  },  "trainer":{  "id":1,  "name":"Red",  "level":40  }  }  ] 
```

è¿™æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„é¡¹ç›®ç›®å½•ç»“æ„:

[![](../Images/2bf0f0123c73fb76422f5f8985f144dc.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--bU5OJwPC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/pwc9ipwwndkgl3baohna.png)

å°±è¿™äº›äº†ï¼Œä¼™è®¡ä»¬ï¼

éå¸¸æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡é•¿æ–‡ã€‚

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ”¹è¿›æˆ‘ä»¬çš„å£è¢‹å¦–æ€ª APIï¼Œå¢åŠ æ›´å¤šçš„åŠŸèƒ½å’Œä¸œè¥¿ï¼Œå¦‚æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œå¼‚å¸¸å¤„ç†ç¨‹åºï¼Œæ‹›æ‘‡ï¼Œæµ‹è¯•ç­‰ç­‰ï¼

æ•¬è¯·å…³æ³¨ã€‚

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png) [ jorgeramon ](https://github.com/jorgeramon) / [æ˜¥å¤©-groovy-å£è¢‹å¦–æ€ª](https://github.com/jorgeramon/spring-groovy-pokemon)

### ä½¿ç”¨ Spring Boot + Groovy çš„å£è¢‹å¦–æ€ª API ç¤ºä¾‹ã€‚

<article class="markdown-body entry-content container-lg" itemprop="text">

# å£è¢‹å¦–æ€ª API v1.0 ç‰ˆ

é¢å‘å¼€å‘è€…çš„ Spring Boot + Groovy ç¤ºä¾‹

## è¦æ±‚

*   Java 8 æˆ–æ›´é«˜ç‰ˆæœ¬
*   å…³ç³»å‹æ•°æ®åº“
*   Gradle

## é…ç½®

ç¼–è¾‘æ–‡ä»¶`application.properties`å¹¶æ›´æ”¹**æ‚¨çš„ç”¨æˆ·å**ã€**æ‚¨çš„å¯†ç **å’Œ**æ‚¨çš„æ•°æ®åº“**çš„å€¼ã€‚

è¿è¡Œè¯¥é¡¹ç›®å°†è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ã€è¡¨å’Œæ’å…¥ç¤ºä¾‹æ•°æ®ã€‚

## è¿è¡Œé¡¹ç›®

åœ¨ç»ˆç«¯ä¸­é”®å…¥å‘½ä»¤`gradle bootRun`ã€‚

</article>

[View on GitHub](https://github.com/jorgeramon/spring-groovy-pokemon)