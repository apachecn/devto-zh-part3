# ä» Azure DevOps é‡Šæ”¾åˆ° npm

> åŸæ–‡:[https://dev . to/azure/releasing-to-NPM-from-azure-devo PS-3505](https://dev.to/azure/releasing-to-npm-from-azure-devops-3505)

åœ¨æˆ‘æœ€è¿‘çš„ä¸€ç¯‡å…³äº[ç”¨ Go](https://www.aaron-powell.com/posts/2019-02-08-golang-wasm-5-compiling-with-webpack/) åˆ›å»º webpack åŠ è½½å™¨æ¥ç”Ÿæˆ WebAssembly çš„æ–‡ç« ä¸­ï¼Œæˆ‘å†³å®šåœ¨æ„å»ºåŠ è½½å™¨æ—¶èƒ½å¤Ÿè½»æ¾åœ°å°†å®ƒå‘å¸ƒç»™ npmã€‚

ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘å†³å®šä½¿ç”¨ Azure DevOpsï¼Œå› ä¸ºå®ƒå¯ä»¥å¾ˆå¥½åœ°å°†æ„å»ºé˜¶æ®µå’Œå‘å¸ƒé˜¶æ®µåˆ†å¼€ã€‚æ­¤å¤–ï¼Œå¾ˆå¤šäººä¸çŸ¥é“ Azure DevOps ç®¡é“å¯¹å¼€æºé¡¹ç›®æ˜¯å…è´¹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬çš„é¡¹ç›®åˆ©ç”¨è¿™ä¸€ç‚¹å°å°çš„å¥½å¤„ã€‚

## [](#creating-a-build)åˆ›å»ºä¸€ä¸ªæ„å»º

æ‚¨éœ€è¦åšçš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªæ„å»ºå®šä¹‰ã€‚æˆ‘ä»¬å°†é€šè¿‡å®‰è£… [Azure Pipelines GitHub åº”ç”¨ç¨‹åº](https://github.com/marketplace/azure-pipelines)(å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£…å®ƒ)å¹¶ä¸ºæˆ‘ä»¬çš„ GitHub åº“æ¿€æ´»å®ƒæ¥å®ç°ã€‚

å½“é“¾æ¥å®ƒä»¬æ—¶ï¼Œæˆ‘ä»¬å°†æˆæƒ Azure DevOps è®¿é—®æˆ‘ä»¬çš„ GitHub ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ Node.js æ¨¡æ¿å®šä¹‰ä½œä¸ºåŸºç¡€åˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œä½†æˆ‘ä»¬å°†åœ¨ä¿å­˜ä¹‹å‰å¯¹å…¶è¿›è¡Œä¸€äº›å®šåˆ¶ã€‚

Node.js æ¨¡æ¿æ˜¯è¿™æ ·çš„:

```
trigger:
- master

pool:
    vmImage: 'Ubuntu-16.04'

steps:
- task: NodeTool@0
    inputs:
    versionSpec: '10.x'
    displayName: 'Install  Node.js'

- script: |
    npm install
    npm run build
    displayName: 'npm install and build' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ®è¯´è¿™ä¸ªæ„å»ºæ˜¯åœ¨`master`åˆ†æ”¯ä¸Šè§¦å‘çš„ï¼Œæ‰€ä»¥ PR ä¸ä¼šè§¦å‘è¿™ä¸ª(æˆ‘ä»¬æ€»æ˜¯å¯ä»¥ä¸º PR è§¦å‘ä¸€ä¸ªä¸åŒçš„æ„å»º)ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬æ„å»ºä»£ç†å°†åœ¨ Linux æ‰˜ç®¡ä»£ç†çš„`pool`ä¸­ï¼Œç‰¹åˆ«æ˜¯ Ubuntu 16.04 æ˜¯å°†è¢«ä½¿ç”¨çš„å‘è¡Œç‰ˆã€‚

ç°åœ¨æˆ‘ä»¬è¿›å…¥ä»£ç†å°†è¿è¡Œçš„ä»»åŠ¡ï¼Œé¦–å…ˆæ˜¯å®‰è£…æ‚¨è¯·æ±‚çš„ Node.js ç‰ˆæœ¬çš„ä»»åŠ¡ã€‚å®ƒå°†é»˜è®¤ä¸ºæœ€æ–°çš„ LTSï¼Œä½†å¦‚æœä½ æƒ³åšç‰ˆæœ¬é”å®šæˆ–ä»»ä½•äº‹æƒ…ï¼Œä½ å¯ä»¥è°ƒæ•´å®ƒï¼Œåªéœ€æ”¹å˜`versionSpec`å±æ€§ã€‚æœ€åï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸ª`script`ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡å°†åœ¨ä»£ç†çš„å¤–å£³ä¸­æ‰§è¡Œä¸€ä¸ªè„šæœ¬(åœ¨æœ¬ä¾‹ä¸­ï¼Œæ˜¯ä¸€ä¸ª Linux è„šæœ¬ï¼Œä½†å¦‚æœå®ƒæ˜¯ä¸€ä¸ª Windows ä»£ç†ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª Windows è„šæœ¬)ï¼Œè¯¥è„šæœ¬è¿è¡Œ`npm install`å’Œ`npm run build`ã€‚è¿™é‡Œå‡è®¾ä½ å·²ç»æœ‰äº†ä¸€ä¸ªåä¸º`build`çš„ *npm è„šæœ¬*ï¼Œå®ƒå°†å®Œæˆæ„å»ºï¼Œæ‰€ä»¥å¦‚æœä½ æ„¿æ„çš„è¯ï¼Œä½ å¯ä»¥è°ƒæ•´å®ƒã€‚äº‹å®ä¸Šï¼Œä½ å¯ä»¥åšä»»ä½•ä½ éœ€è¦çš„æ”¹å˜ï¼Œä½†æ˜¯è¿™å¯¹äºå¤§å¤šæ•°æƒ…å†µæ¥è¯´å¾ˆç®€å•ã€‚æ­¤å¤–ï¼Œæ ¹æ®æ‚¨å¯¹ä»»åŠ¡è§’è‰²çš„åå¥½ï¼Œæ‚¨å¯ä»¥å°†`install`å’Œ`build`æ­¥éª¤æ‹†åˆ†æˆå•ç‹¬çš„ä»»åŠ¡ï¼Œè¿™æ ·å¯ä»¥æ›´å®¹æ˜“åœ°è°ƒè¯•å¤±è´¥ï¼Œè€Œä¸å¿…è¯»å–æ—¥å¿—ã€‚

å¦‚æœä½ é€‰æ‹©`Save and Run`ï¼Œå®ƒä¼šåœ¨ä½ çš„ GitHub ä»“åº“ä¸­åˆ›å»ºä¸€ä¸ª`azure-pipelines.yaml`æ–‡ä»¶ï¼Œè¦ä¹ˆç›´æ¥åœ¨`master`ä¸­ï¼Œè¦ä¹ˆåœ¨ PR æ‰€åœ¨çš„åˆ†æ”¯ä¸­ï¼Œæ‰€ä»¥é€‰æ‹©ä½ å–œæ¬¢çš„æ–¹æ³•ï¼Œç„¶åæˆ‘ä»¬çš„æ„å»ºå°±ä¼šå¼€å§‹ï¼Œåº”è¯¥ä¼šæˆåŠŸå®Œæˆã€‚

é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å‘å¸ƒä¸€äº›ä¸œè¥¿å‘¢ï¼Ÿ

## [](#getting-artifacts-for-release)è·å–å·¥ä»¶è¿›è¡Œå‘å¸ƒ

æˆ‘ä»¬çš„æ„å»ºå°†åœ¨ä¸€ä¸ªä»£ç†ä¸Šè¿è¡Œï¼Œç”Ÿæˆæˆ‘ä»¬æƒ³è¦ç”Ÿæˆçš„ä¸œè¥¿(åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œå°† TypeScript è½¬æ¢ä¸º JavaScript ),ä½†è¿™äº›ä¸œè¥¿åªå­˜åœ¨äºé‚£ä¸ªä»£ç†ä¸Šï¼Œå½“ä»£ç†å®Œæˆæ—¶ï¼Œå®ƒä»¬å°±è¢«é”€æ¯äº†ã€‚å—¯ï¼Œç°åœ¨è¿™ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œæ˜¯å—ï¼Œæˆ‘ä»¬å¸Œæœ›é‚£é‡Œçš„ä¸œè¥¿æ¨é€åˆ° npmã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ç¼–è¾‘æˆ‘ä»¬çš„`azure-pipelines.yaml`æ–‡ä»¶ã€‚é¦–å…ˆè®©æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªå¯ä»¥å‘å¸ƒçš„ npm åŒ…:

```
- script: |
    npm pack
    displayName: 'Package for npm release' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åŒæ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨`script`ä»»åŠ¡æ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼Œæˆ‘ä»¬è¿è¡Œ`npm pack`å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ª`tgz`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥è¢«å‘é€åˆ° npm åŒ…å­˜å‚¨åº“(æˆ–ä»»ä½•å…¶ä»–æ‚¨æƒ³è¦çš„å­˜å‚¨åº“)ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ç”Ÿæˆä¸€ä¸ªåŒ…è€Œä¸å‘å¸ƒå‘¢ï¼ŸåŸå› æ˜¯æˆ‘ä»¬æƒ³å°†æˆ‘ä»¬ç®¡é“çš„**æ„å»º**é˜¶æ®µä»**å‘å¸ƒ**é˜¶æ®µä¸­åˆ†ç¦»å‡ºæ¥ï¼Œè¿™æ ·æŒç»­é›†æˆç„¶åæŒç»­äº¤ä»˜ã€‚ä»æˆ‘ä»¬çš„æ„å»ºæ­¥éª¤ä¸­å‘å¸ƒæœ‰ç‚¹æ··æ·†äº†ä»€ä¹ˆå¯¹ä»€ä¹ˆè´Ÿè´£ã€‚æ­¤å¤–ï¼Œé€šè¿‡åœ¨æ„å»ºä¸­ç”Ÿæˆ`tgz`æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è¯´è¿™æ˜¯å°†è¦å‘å¸ƒçš„å†…å®¹ï¼Œå¹¶ä¸”ä¸èƒ½æ›´æ”¹ï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸´æ—¶ npm å­˜å‚¨åº“ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ¨é€åˆ°é‚£é‡Œï¼Œå°±åƒæˆ‘ä»¬å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºä¸´æ—¶ç«™ç‚¹ä¸€æ ·ã€‚æœ€ç»ˆï¼Œå®ƒä½¿å¾—å‘å¸ƒçš„å·¥ä»¶æ›´åŠ ä¸å¯å˜ã€‚

æˆ‘ä»¬ç°åœ¨å·²ç»ç”Ÿæˆäº†ä¸€ä¸ª`tgz`æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°†å®ƒä½œä¸ºå·¥ä»¶é™„åŠ åˆ°æ„å»ºä¸­ã€‚ä¸€ä¸ªå·¥ä»¶æ˜¯ä¸€ä¸ªæ„å»ºçš„è¾“å‡ºï¼Œå®ƒå¯ä»¥ä»å…¶ä»–åœ°æ–¹è·å¾—ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªé“¾æ¥çš„æ„å»ºï¼Œä¸€ä¸ªå‘å¸ƒï¼Œæˆ–è€…åªæ˜¯æ‰‹åŠ¨æŸ¥çœ‹æ„å»ºç»“æœã€‚

```
- task: CopyFiles@2
    inputs:
    sourceFolder: '$(Build.SourcesDirectory)'
    contents: '*.tgz' 
    targetFolder: $(Build.ArtifactStagingDirectory)/npm
    displayName: 'Copy  npm  package'

- task: CopyFiles@2
    inputs:
    sourceFolder: '$(Build.SourcesDirectory)'
    contents: 'package.json' 
    targetFolder: $(Build.ArtifactStagingDirectory)/npm
    displayName: 'Copy  package.json'

- task: PublishBuildArtifacts@1
    inputs:
    pathtoPublish: '$(Build.ArtifactStagingDirectory)/npm'
    artifactName: npm
    displayName: 'Publish  npm  artifact' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½¿ç”¨[å¤åˆ¶æ–‡ä»¶](https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/utility/copy-files?view=azure-devops&tabs=yaml&WT.mc_id=devto-blog-aapowell)ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—æ–‡ä»¶(æˆ‘ä»¬çš„`tgz`å’Œ`package.json`)å¹¶å°†å®ƒä»¬å¤åˆ¶åˆ°ç”±å˜é‡`$(Build.ArtifactStagingDirectory)`å®šä¹‰çš„*å·¥ä»¶æš‚å­˜ä½ç½®*ã€‚è¿™æ˜¯ä»£ç†æ‹¥æœ‰çš„ä¸€ä¸ªç‰¹æ®Šç›®å½•ï¼Œæ‰“ç®—ä½œä¸ºå·¥ä»¶å‘å¸ƒã€‚ä¸€æ—¦è¿™äº›æ–‡ä»¶åœ¨æ­£ç¡®çš„ä½ç½®ï¼Œæˆ‘ä»¬ä½¿ç”¨ [Publish Artifacts](https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/utility/publish-build-artifacts?view=azure-devops&WT.mc_id=devto-blog-aapowell) ä»»åŠ¡æ¥å‘Šè¯‰æˆ‘ä»¬æ„å»ºæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶å°†åœ¨`npm`çš„ä¸€ä¸ªåä¸º Artifacts çš„*ä¸­ã€‚è¿™ä¸ªåç§°å¾ˆé‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨å°†æ¥ä½¿ç”¨å®ƒæ¥è®¿é—®å®ƒä»¬ï¼Œæ‰€ä»¥è¦ä½¿å®ƒç¬¦åˆé€»è¾‘ã€‚æˆ‘è¿˜å°†é¿å…åœ¨å·¥ä»¶çš„åç§°ä¸­ä½¿ç”¨ç©ºæ ¼ï¼Œè¿™æ ·å½“æ‚¨å°è¯•ä½¿ç”¨å®ƒä»¬æ—¶å°±ä¸å¿…è¿›è¡Œè½¬ä¹‰ã€‚*

æˆ‘è¿˜å°†å¤åˆ¶å‘è¡Œè¯´æ˜ä»¥åŠæˆ‘ä»¬ä» TypeScript ç¼–è¯‘å™¨ç”Ÿæˆçš„ JavaScript æ–‡ä»¶ï¼Œå› ä¸ºè¿™äº›æ–‡ä»¶å¯¹è°ƒè¯•å¾ˆæœ‰ç”¨ã€‚

å½“ä¸€åˆ‡éƒ½ç»“æŸåï¼Œæˆ‘ä»¬çš„æ„å»ºå®šä¹‰ç°åœ¨çœ‹èµ·æ¥åƒæ˜¯[è¿™ä¸ª](https://github.com/aaronpowell/webpack-golang-wasm-async-loader/blob/master/azure-pipelines.yml)ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å®ƒçš„è¿è¡Œå†å²[ã€‚](https://dev.azure.com/aaronpowell/webpack-golang-wasm-async-loader/_build?definitionId=16)

## [](#creating-a-release)åˆ›å»ºå‘å¸ƒ

æˆ‘ä»¬çš„æ„å»ºé€šè¿‡äº†ï¼Œæˆ‘ä»¬å¾—åˆ°äº†å·¥ä»¶è¾“å‡ºï¼Œæ˜¯æ—¶å€™å‘å¸ƒåˆ° npm äº†ã€‚

ç›®å‰ï¼Œåˆ›å»ºå‘å¸ƒç®¡é“çš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿ç”¨ Azure Pipeline ä¸­çš„è®¾è®¡å™¨ï¼Œæ²¡æœ‰ YAML å¯¼å‡ºï¼Œä½†å¥½åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„å‘å¸ƒç®¡é“ï¼

åœ¨ Azure DevOps é—¨æˆ·ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„å‘å¸ƒï¼Œä½¿ç”¨**ç©ºä½œä¸š**æ¨¡æ¿ï¼Œå¹¶å°†æˆ‘ä»¬çš„å‘å¸ƒé˜¶æ®µå‘½åä¸º*å‘å¸ƒ*ã€‚

[![Our blank release](../Images/3527b4191307be39d59a712d540b8351.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--fonsU_d2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.aaron-powell.com/images/npm-azd/blank-release.jpg)

ç°åœ¨æˆ‘ä»¬éœ€è¦å®šä¹‰æˆ‘ä»¬çš„å‘å¸ƒå°†ç»å†å“ªäº›é˜¶æ®µã€‚ä¸€ä¸ªé˜¶æ®µå¯ä»¥ä»£è¡¨ä¸€ä¸ªç¯å¢ƒï¼Œæ‰€ä»¥å¦‚æœä½ è¦å‘å¸ƒåˆ° UATï¼Œç„¶åæ˜¯é¢„ç”Ÿäº§ï¼Œæœ€åæ˜¯ç”Ÿäº§ï¼Œä½ åº”è¯¥åœ¨æ„å»ºä¸­æŠŠå®ƒä»¬éƒ½è§„åˆ’å‡ºæ¥ã€‚æ‚¨è¿˜å¯ä»¥å®šä¹‰æ¯ä¸ªé˜¶æ®µçš„å…³å¡ï¼Œæ˜¯å¦æœ‰é˜¶æ®µå‘å¸ƒçš„æ‰¹å‡†è€…ï¼Œç­‰ç­‰ã€‚ä½†æ‰€æœ‰è¿™äº›éƒ½è¶…å‡ºäº†æˆ‘ä»¬åœ¨è¿™é‡Œæ‰€éœ€è¦çš„ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªé˜¶æ®µï¼Œé‚£å°±æ˜¯å‘å¸ƒåˆ° npmã€‚æŸ¥çœ‹[æ–‡æ¡£ï¼Œäº†è§£å…³äºé˜¶æ®µ](https://docs.microsoft.com/en-us/azure/devops/pipelines/release/environments?view=azure-devops&WT.mc_id=devto-blog-aapowell)çš„æ›´å¤šä¿¡æ¯ã€‚

æ–¹ä¾¿çš„æ˜¯ï¼ŒAzure DevOps æä¾›äº†ä¸€ä¸ª`npm`ä»»åŠ¡ï¼Œå…¶ä¸­å®šä¹‰äº†ä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼ŒåŒ…æ‹¬æˆ‘ä»¬æƒ³è¦çš„ä»»åŠ¡`publish`ï¼æŒ‡å®šåä¸º`npm`çš„é“¾æ¥å·¥ä»¶çš„è·¯å¾„(æˆ‘ä»¬åœ¨ä¸Šé¢å‘½åäº†å®ƒ)ï¼Œå¹¶é€‰æ‹©å‘å¸ƒåˆ°ä¸€ä¸ª**å¤–éƒ¨ npm æ³¨å†Œè¡¨**(æˆ‘ä»¬ä½¿ç”¨å®ƒæ˜¯å› ä¸º Azure DevOps å¯ä»¥å……å½“ npm æ³¨å†Œè¡¨)ã€‚

å¦‚æœæ‚¨ä¹‹å‰æ²¡æœ‰è¿™æ ·åšï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªåˆ° npm æ³¨å†Œä¸­å¿ƒçš„[æœåŠ¡è¿æ¥](https://docs.microsoft.com/en-us/azure/devops/pipelines/library/service-endpoints?view=azure-devops&WT.mc_id=devto-blog-aapowell#sep-npm)ï¼Œä½¿ç”¨**æ–°å»º**æŒ‰é’®å¹¶è¾“å…¥`[https://registry.npmjs.org](https://registry.npmjs.org)`ä½œä¸ºæºå’Œä»¤ç‰Œï¼Œæ‚¨å¯ä»¥ä» npm ç½‘ç«™åœ¨æ‚¨çš„é…ç½®æ–‡ä»¶ä¸‹ç”Ÿæˆè¯¥ä»¤ç‰Œã€‚

ç°åœ¨ä½ ä¼šè®¤ä¸ºæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†ï¼Œå¯¹å—ï¼Ÿå—¯â€¦â€¦æ˜¯çš„ï¼Œä½ çš„ç¡®å‘å¸ƒåˆ° npmï¼Œä½†æ˜¯ä½ å‘å¸ƒçš„æ˜¯ä¸€ä¸ªåŒ…ï¼Œå…¶ä¸­*åŒ…å«*ä½ çš„`tgz`ï¼Œè€Œä¸æ˜¯ä½ çš„`tgz`ã€‚ä½ çœ‹ï¼Œ`publish`å‘½ä»¤èƒ½å¤Ÿè·å–`tgz`å¹¶å°†å…¶å‘å¸ƒåˆ° npmï¼Œä½†æ˜¯åœ¨ Azure DevOps ä»»åŠ¡ä¸­æœ‰ä¸€ä¸ª[é”™è¯¯ï¼Œè¿™æ„å‘³ç€å®ƒæ— æ³•å·¥ä½œã€‚æ‰€ä»¥ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå˜é€šåŠæ³•ğŸ˜¦ã€‚](https://github.com/Microsoft/azure-pipelines-tasks/issues/4958)

å¹¸è¿çš„æ˜¯ï¼Œè§£å†³æ–¹æ³•éå¸¸ç®€å•ï¼Œæˆ‘ä»¬éœ€è¦è§£å‹`tgz`æ–‡ä»¶ï¼Œå¹¶å¯¹å…¶å†…å®¹ä½¿ç”¨å‘å¸ƒä»»åŠ¡ã€‚æˆ‘ä»¬ç”¨ Extract Files ä»»åŠ¡æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼ŒæŒ‡å®š`*.tgz`ä½œä¸ºæˆ‘ä»¬è¦æå–çš„å†…å®¹(å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“æ–‡ä»¶å),å¹¶ç»™ if ä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ã€‚æˆ‘ç”¨äº†`$(System.DefaultWorkingDirectory)/npm-publish`ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥æ›´æ–°æˆ‘ä»¬çš„å‘å¸ƒå‘½ä»¤ï¼Œä¸ä½¿ç”¨å·¥ä»¶ç›®å½•ï¼Œè€Œæ˜¯ä½¿ç”¨è§£å‹ç¼©çš„ç›®å½•ï¼Œåœ¨æˆ‘çš„ä¾‹å­ä¸­æ˜¯`$(System.DefaultWorkingDirectory)/npm-publish/package`ã€‚

éšç€æˆ‘ä»¬çš„é˜¶æ®µå®Œæˆï¼Œæ˜¯æ—¶å€™å°†å®ƒé“¾æ¥åˆ°æ„å»ºå®šä¹‰äº†ã€‚æˆ‘ä»¬é€šè¿‡æ·»åŠ ä¸€ä¸ªå·¥ä»¶ï¼Œé€‰æ‹©æˆ‘ä»¬åˆ›å»ºçš„æ„å»ºç®¡é“å¹¶ä¿ç•™é»˜è®¤å€¼æ¥å®ç°ã€‚

[![Adding an artifact](../Images/03fe9149222a50aada57c2b6eec688a0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--2K1MUAWh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.aaron-powell.com/images/npm-azd/adding-artifact.jpg)

*æ³¨æ„:æˆ‘å°†**é»˜è®¤ç‰ˆæœ¬**ä¿ç•™ä¸º**åœ¨å‘å¸ƒåˆ›å»º**æ—¶æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒç»™äº†æ„ä»¶çš„æ„å»ºæ§åˆ¶æƒã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå®ƒä¸ä¼šäº§ç”Ÿå¾ˆå¤§çš„å·®å¼‚ï¼Œä½†åœ¨æ›´å¤æ‚çš„è®¾ç½®ä¸­ä¼šå¾ˆæœ‰ç”¨ã€‚*

å› ä¸ºæˆ‘ä»¬å¸Œæœ›æ¯æ¬¡æ„å»ºå®Œæˆæ—¶å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ç‚¹å‡»å·¥ä»¶ä¸Šçš„é—ªç”µ(âš¡)å¹¶å¯ç”¨æŒç»­éƒ¨ç½²è§¦å‘å™¨ã€‚æ²¡æœ‰è¿™ä¸ªæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è§¦å‘é‡Šæ”¾ã€‚å¦‚æœä½ æœ‰æŸäº›ä¸åº”è¯¥è¢«é‡Šæ”¾çš„åˆ†æ”¯(ä¾‹å¦‚:`gh-pages`)ï¼Œé‚£ä¹ˆä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œä¸ºå®ƒä»¬æ·»åŠ ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚

æ•‘ï¼Œè·‘ï¼Œå˜£ï¼æ¨é€è‡³`master`æ—¶ npm å‘ç”Ÿé‡Šæ”¾ã€‚è¯·è®°ä½ï¼Œæ‚¨å¿…é¡»æ›´æ–°æ‚¨çš„`package.json`ä»¥è·å¾—æ–°çš„ç‰ˆæœ¬å·ï¼Œå¦åˆ™å®ƒå°†æ— æ³•å‘å¸ƒåˆ° npmï¼Œå› ä¸ºæ‚¨æ— æ³•å‘å¸ƒç°æœ‰çš„ç‰ˆæœ¬ã€‚

## [](#adding-badges)æ·»åŠ å¾½ç« 

æ‚¨æœ€ä¸æƒ³åšçš„äº‹æƒ…å°±æ˜¯åœ¨æ‚¨çš„è‡ªè¿°æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªå¾½ç« æ¥å±•ç¤ºä»¤äººæ•¬ç•çš„ç®¡é“å·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥ä»å³ä¸Šè§’çš„â€œæ„å»º->èœå•â€ä¸­é€‰æ‹©â€œçŠ¶æ€å¾½ç« â€ï¼Œç„¶ååƒè¿™æ ·åšä¸€äº›é™ä»·:

```
[![Build Status](https://dev.azure.com/aaronpowell/webpack-golang-wasm-async-loader/_apis/build/status/aaronpowell.webpack-golang-wasm-async-loader?branchName=master)](https://dev.azure.com/aaronpowell/webpack-golang-wasm-async-loader/_build/latest?definitionId=16&branchName=master) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

[![Build Status](../Images/a51db23a3c82097824cc2e535f4131dc.png)T2ã€‘](https://dev.azure.com/aaronpowell/webpack-golang-wasm-async-loader/_build/latest?definitionId=16&branchName=master)

### [](#customising-the-label)å®šåˆ¶æ ‡ç­¾

æˆ‘æœ€è¿‘æ‰å‘ç°ï¼Œä½ å¯ä»¥ä¸º Azure Pipelines å¾½ç« å®šåˆ¶æ ‡ç­¾ä¸­çš„æ–‡æœ¬ã€‚ä¸ºæ­¤ï¼Œå‘å›¾åƒ`label=<something cool>`æ·»åŠ ä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚å®ƒç”šè‡³å¯ä»¥æ”¯æŒè¡¨æƒ…ç¬¦å·ğŸ˜‰ï¼

```
[![Build Status](https://dev.azure.com/aaronpowell/webpack-golang-wasm-async-loader/_apis/build/status/aaronpowell.webpack-golang-wasm-async-loader?branchName=master&label=ğŸš¢ it)](https://dev.azure.com/aaronpowell/webpack-golang-wasm-async-loader/
_build/latest?definitionId=16&branchName=master) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[![Build Status](../Images/d160fe13495389a0940dd663e77271de.png)T2ã€‘](https://dev.azure.com/aaronpowell/webpack-golang-wasm-async-loader/_build/latest?definitionId=16&branchName=master)

## [](#bonus-round-releasing-to-github)å¥–åŠ±å›åˆï¼Œå‘å¸ƒåˆ° GitHub

å‘ npm å‘å¸ƒæ˜¯å¥½çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¹Ÿæƒ³å‘ GitHub å‘å¸ƒï¼Œæ­£ç¡®æ ‡è®°æäº¤ï¼Œå¹¶ç¡®ä¿ä»»ä½•åªæƒ³è·å¾—åŸå§‹æ–‡ä»¶çš„äººéƒ½å¯ä»¥è·å¾—å®ƒä»¬ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ

æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ Azure DevOps åšåˆ°è¿™ä¸€ç‚¹ï¼

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è·å–æˆ‘ä»¬å‘å¸ƒçš„ç‰ˆæœ¬å·ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ GitHub ä¸Šå¯¹å®ƒè¿›è¡Œé€‚å½“çš„æ ‡è®°ã€‚æˆ‘å°†ä½¿ç”¨ Bash ä»»åŠ¡(å› ä¸ºæˆ‘çŸ¥é“æˆ‘ä½¿ç”¨çš„æ˜¯ Linux ä»£ç†)ï¼Œå¹¶è¿è¡Œä¸€ä¸ªå†…è”è„šæœ¬:

```
v=`node -p "const p = require('./package.json'); p.version;"`
echo "##vso[task.setvariable variable=packageVersion]$v" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘æ­£åœ¨è¿è¡Œä¸€ä¸ªå°çš„å†…è” Node.js è„šæœ¬ï¼Œä»¥ä»æˆ‘ä»¬ä½œä¸ºå·¥ä»¶é™„åŠ çš„`package.json`æ–‡ä»¶ä¸­è·å–ç‰ˆæœ¬å·(æ‰€ä»¥æˆ‘å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º`$(System.DefaultWorkingDirectory)/aaronpowell.webpack-golang-wasm-async-loader/npm`)ï¼Œæˆ–è€…ï¼Œæ‚¨å¯ä»¥ä»è§£å‹ç¼©çš„`tgz`æ–‡ä»¶ä¸­è·å–ç‰ˆæœ¬å·(ä½†æ˜¯æˆ‘åœ¨æ„è¯†åˆ°æˆ‘å¿…é¡»è¿™ä¹ˆåšä¹‹å‰å°±å¼€å§‹è¿™ä¹ˆåšäº†ğŸ˜›).æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨`echo`åˆ›å»ºä¸€ä¸ªåä¸º`packageVersion`çš„ Azure DevOps å˜é‡ã€‚

ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ GitHub Release ä»»åŠ¡(åœ¨æ’°å†™æœ¬æ–‡æ—¶å®ƒå¤„äºé¢„è§ˆçŠ¶æ€)æ¥ç”Ÿæˆæˆ‘ä»¬çš„ç‰ˆæœ¬ã€‚

æˆ‘é€‰æ‹©æˆ‘è¦å‘å¸ƒçš„ GitHub å¸æˆ·å’Œå‘å¸ƒåˆ°çš„åº“(ä¸¤ä¸ªæ˜¾ç¤ºéƒ½åœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­å¯ç”¨)ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨**åˆ›å»º**è¿›è¡Œæ“ä½œ(æ¯•ç«Ÿè¿™æ˜¯ä¸€ä¸ªæ–°çš„å‘å¸ƒç‰ˆæœ¬)**ç›®æ ‡**æ˜¯`$(Build.SourceVersion)`ï¼Œå› ä¸ºè¿™æ˜¯æ„å»ºè¢«è§¦å‘çš„æäº¤çš„ SHAï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³è¦æ ‡è®°ï¼Œä½¿ç”¨æˆ‘ä»¬çš„å˜é‡`$(packageVersion)`ä½œä¸ºæ ‡è®°ï¼Œæ ‡è®°æºä¸º**ç”¨æˆ·æŒ‡å®šçš„æ ‡è®°**ï¼Œç„¶åå°†èµ„äº§è®¾ç½®ä¸ºæˆ‘ä»¬æƒ³è¦å‘å¸ƒçš„å·¥ä»¶(æˆ‘å‘å¸ƒäº†ã€T2 æˆ‘è¿˜é€‰æ‹©æ·»åŠ å‘å¸ƒè¯´æ˜ï¼Œæˆ‘å°†å®ƒå†™å…¥ git repo ä¸­ä¸€ä¸ªåä¸º`ReleaseNotes.md`çš„æ–‡ä»¶ä¸­ï¼Œå¹¶ä½œä¸ºå·¥ä»¶å‘å¸ƒã€‚

ç°åœ¨ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‘å¸ƒæ—¶ï¼Œå®ƒä¸ä»…ä¼šå‘é€åˆ° npmï¼Œè¿˜ä¼šä½œä¸ºä¸€ä¸ªå‘å¸ƒå‘é€åˆ° GitHubï¼Œæ ‡è®°æäº¤å¹¶é“¾æ¥å‘å¸ƒä¸­åŒ…å«çš„æäº¤ã€‚ç‚¹å‡»æŸ¥çœ‹[ã€‚](https://dev.azure.com/aaronpowell/webpack-golang-wasm-async-loader/_release?definitionId=1)

[![Complete pipeline](../Images/b70330b2eeddfa29b770ddf95c39b937.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ICo2efkG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.aaron-powell.com/images/npm-azd/complete-pipeline-steps.jpg)

## [](#conclusion)ç»“è®º

è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•ä» Azure DevOps è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒ npm å’Œ GitHub ç‰ˆæœ¬çš„åŒ…ã€‚è¿™çœŸçš„å¾ˆç®€å•ï¼

## [](#commentary-on-2fa-for-publish)å‘è¡¨å¯¹ 2FA çš„è¯„è®º

æˆ‘çš„åŒäº‹ [Tierney Cyren](https://twitter.com/bitandbang) æŒ‡å‡ºï¼Œå¦‚æœä½ åœ¨ npm ä¸­ä½¿ç”¨ [2FA on Publish](https://docs.npmjs.com/requiring-2fa-for-package-publishing-and-settings-modification) çš„è¯ï¼Œä¸Šè¿°æ–¹æ³•å°†ä¸èµ·ä½œç”¨ã€‚ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ³•æ˜¯åœ¨å‘è¡Œç‰ˆä¸Šè®¾ç½®ä¸€ä¸ªæ‰‹åŠ¨å…¥å£ï¼Œåœ¨è¿è¡Œå‘è¡Œç‰ˆå¹¶åœ¨å‘å¸ƒæ—¶å°†å…¶ä½œä¸º CLI æ ‡å¿—ä¼ é€’ä¹‹å‰ï¼Œæ‚¨å¿…é¡»å°† OTP ä»£ç ä½œä¸ºä¸€ä¸ªå˜é‡è¾“å…¥ã€‚å¦åˆ™ï¼Œåœ¨ä½ çš„å‘å¸ƒä¸­ä¼šæœ‰ä¸€ä¸ªé”™è¯¯[ï¼Œæ¯”å¦‚è¿™ä¸ª](https://dev.azure.com/aaronpowell/webpack-golang-wasm-async-loader/_releaseProgress?_a=release-environment-logs&releaseId=17&environmentId=17)ã€‚