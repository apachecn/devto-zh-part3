# ç”¨ Mongoose åœ¨ Node.js ä¸­è®¾ç½® MongoDB

> åŸæ–‡:[https://dev . to/akhilaariyachandra/setup-MongoDB-in-node-js-with-mongose-4gik](https://dev.to/akhilaariyachandra/setup-mongodb-in-node-js-with-mongoose-4gik)

å¦‚æœæ‚¨æ­£åœ¨ç”¨ Node æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæ‚¨å¯èƒ½éœ€è¦å°†å®ƒè¿æ¥åˆ°ä¸€ä¸ª MongoDB æ•°æ®åº“ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä¼šå‘Šè¯‰ä½ å¦‚ä½•è®¾ç½®å®ƒã€‚æœ¬æŒ‡å—å‡è®¾æ‚¨å·²ç»åˆå§‹åŒ–äº†ä¸€ä¸ªèŠ‚ç‚¹é¡¹ç›®ã€‚

å¦‚æœä½ è¿˜æ²¡æœ‰æ•°æ®åº“ï¼ŒmLab å¯èƒ½æ˜¯è·å¾—å…è´¹æ•°æ®åº“çš„æœ€å¥½åœ°æ–¹ã€‚

# [](#setting-up-database-connection)è®¾ç½®æ•°æ®åº“è¿æ¥

é¦–å…ˆè®©æˆ‘ä»¬å®‰è£… mongoose ä¾èµ–é¡¹ã€‚

```
npm install mongoose --save 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ–è€…ç”¨çº±çº¿ã€‚

```
yarn add mongoose 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ•°æ®åº“é…ç½®å’Œå®ä¾‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåä¸º database.jsã€‚

é¦–å…ˆè®©æˆ‘ä»¬å¯¼å…¥ä¾èµ–é¡¹ï¼›

```
const mongoose = require("mongoose"); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åè®©æˆ‘ä»¬å°†æ•°æ®åº“çš„è·¯å¾„å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­ã€‚è·¯å¾„åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼Œæ›¿æ¢ä¸ºæ‚¨ä¸ºæ•°æ®åº“åˆ›å»ºçš„ç”¨æˆ·ã€‚

```
const dbPath = "mongodb://<dbuser>:<dbpassword>@ds250607.mlab.com:38485/test-db"; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¹‹åï¼Œæˆ‘ä»¬å°†è¿æ¥åˆ°æ•°æ®åº“ã€‚

```
mongoose.connect(dbPath, {
    useNewUrlParser: true,
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬éœ€è¦å¯¼å‡ºæ•°æ®åº“çš„è¿™ä¸ªå®ä¾‹ï¼Œä»¥å¤‡åç”¨ã€‚

```
module.exports = mongoose; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦åº”ç”¨ç¨‹åºå¯åŠ¨ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæŒ‡ç¤ºå™¨æ˜¾ç¤ºåº”ç”¨ç¨‹åºæ˜¯å¦æˆåŠŸè¿æ¥åˆ°æ•°æ®åº“ï¼Œé‚£å°±æ›´å¥½äº†ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€äº›ä»£ç æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```
const db = mongoose.connection;
db.on("error", () => {
    console.log("> error occurred from the database");
});
db.once("open", () => {
    console.log("> successfully opened the database");
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œdatabase.js åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚

```
// database.js
const mongoose = require("mongoose");
const dbPath = "mongodb://<dbuser>:<dbpassword>@ds250607.mlab.com:38485/test-db";
mongoose.connect(dbPath, {
    useNewUrlParser: true,
});
const db = mongoose.connection;
db.on("error", () => {
    console.log("> error occurred from the database");
});
db.once("open", () => {
    console.log("> successfully opened the database");
});
module.exports = mongoose; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#setting-up-modelsschema)è®¾ç½®æ¨¡å‹/æ¨¡å¼

å»ºç«‹æ•°æ®åº“è¿æ¥åï¼Œè®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå®ä½“æ¨¡å‹æ¥ä¿å­˜å’Œæ£€ç´¢ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ª**ç”¨æˆ·**å®ä½“ã€‚å®ƒå°†æœ‰ä¸‰ä¸ªé¢†åŸŸï¼Œåç§°ï¼Œç”µå­é‚®ä»¶å’Œå¯†ç ã€‚æˆ‘ä»¬ä¼šå°†æ‰€æœ‰æ¨¡å‹å­˜å‚¨åœ¨æ¨¡å‹æ–‡ä»¶å¤¹ä¸­ã€‚

```
// models/userModel.js
const mongoose = require("../database");
const schema = {
    name: { type: mongoose.SchemaTypes.String, required: true },
    email: { type: mongoose.SchemaTypes.String, required: true },
    password: { 
        type: mongoose.SchemaTypes.String, 
        required: true, 
        select: false
    }
};
const collectionName = "user"; // Name of the collection of documents
const userSchema = mongoose.Schema(schema);
const User = mongoose.model(collectionName, userSchema);
module.exports = User; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œæœ‰ä¸€äº›æ³¨é‡Šã€‚æ¨¡å¼çš„ç»“æ„åœ¨æ¨¡å¼å¸¸é‡ä¸­å®šä¹‰ã€‚æ¯ä¸ªå±æ€§éƒ½åº”è¯¥æœ‰ä¸€ä¸ªç±»å‹å­—æ®µã€‚å¿…å¡«å­—æ®µç”¨äºè®¾ç½®è¯¥å±æ€§æ˜¯å¦ä¸ºå¿…å¡«å­—æ®µã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ‰€æœ‰ä¸‰ä¸ªå±æ€§éƒ½æ˜¯ã€‚password å±æ€§æœ‰ä¸€ä¸ªè®¾ç½®ä¸º true çš„é¢å¤–é€‰æ‹©å­—æ®µã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æŸ¥è¯¢æ—¶é»˜è®¤æƒ…å†µä¸‹ä¸è¿”å› password å±æ€§ã€‚

è¿™å°±æ˜¯å¼€å§‹ä½¿ç”¨æ•°æ®åº“æ‰€éœ€çš„å…¨éƒ¨è®¾ç½®ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨è¯¥æ¨¡å‹çš„ä¸€äº›ç¤ºä¾‹ã€‚

```
// Create user
User.create({
    name: name,
    email: email,
    password: password
});
// Find user by email
User.findOne({
    email: email
});
// Find user by email with the password field included
User.findOne({
    email: email
}).select("+password"); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#wrapping-up)åŒ…è£…å®Œæ¯•

æˆ‘å¸Œæœ›æœ¬æ•™ç¨‹å¯¹ä¸ºæ‚¨çš„èŠ‚ç‚¹åº”ç”¨ç¨‹åºè®¾ç½® MongoDB æ•°æ®åº“æœ‰ç”¨ã€‚å¦‚æœä½ å¯¹æˆ‘å¦‚ä½•æ”¹è¿›æœ¬æ•™ç¨‹æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åœ¨ä¸‹é¢ç•™è¨€ï¼ğŸ˜Š