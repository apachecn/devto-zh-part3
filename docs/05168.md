# ä½¿ç”¨ Firebase Firestore å’Œè®¤è¯çš„ Svelte 3 ä¸­çš„ RxFire

> åŸæ–‡:[https://dev . to/codingcatdev/rx fire-in-svelte-3-using-firebase-firestore-and-authentic ation-PCA](https://dev.to/codingcatdev/rxfire-in-svelte-3-using-firebase-firestore-and-authentication-pca)

> åŸå¸–:[https://ajonp . com/lessons/rx fire-in-svelte-3-using-firebase-firestore-and-authentic ation/](https://ajonp.com/lessons/rxfire-in-svelte-3-using-firebase-firestore-and-authentication/)

[https://www.youtube.com/embed/ju80EzhnCE8](https://www.youtube.com/embed/ju80EzhnCE8)

# [](#rxfire-in-svelte-3-using-firebase-firestore-and-authentication)RxFire åœ¨è‹—æ¡ 3 ä¸­ä½¿ç”¨ Firebase Firestore å¹¶è®¤è¯

RxFire æ˜¯ç”± Firebase å¼€å‘è€…å€¡å¯¼è€…[å¤§å«Â·ä¼Šæ–¯ç‰¹](https://twitter.com/_davideast)åˆ›å»ºçš„ã€‚è™½ç„¶ [Firebase åšå®¢](https://firebase.googleblog.com/2018/09/introducing-rxfire-easy-async-firebase.html)åœ¨ 2018 å¹´ 9 æœˆæ¨å‡ºäº† RxFireã€‚æˆ‘è®¤ä¸ºè¿™å¯¹äºåŒæ—¶ä½¿ç”¨[svelite 3](https://svelte.dev)å’Œ [Firebase](https://www.firebase.com/) çš„åˆå­¦è€…æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒç‚¹ã€‚

å¯¹äºé‚£äº›æ¥è‡ªè§’åº¦èƒŒæ™¯çš„äººï¼Œä½ å¯èƒ½ç†Ÿæ‚‰ [RxJS](https://github.com/ReactiveX/rxjs) å’Œ [Angularfire2](https://github.com/angular/angularfire2) åŒ…ã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼Œå¦‚æœä½ æƒ³åœ¨ä»»ä½•å°ºå¯¸çš„åº”ç”¨ä¸­ä½¿ç”¨ Angularï¼Œä½ *å¿…é¡»*å­¦ä¹  RxJSã€‚è¿™å¯èƒ½æ˜¯æœ€éš¾å­¦çš„éƒ¨åˆ†ä¹‹ä¸€ï¼Œä½†æœ‰å‡ ä¸ªç²¾å½©çš„æ•™ç¨‹å’Œç½‘ç«™ä¸“é—¨ä»‹ç» RxJS æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

æˆ‘æœ€å–œæ¬¢çš„ä¸€äº›

*   [Fireship çš„åå¤§ RxJS æ¦‚å¿µ](https://fireship.io/lessons/rxjs-basic-pro-tips/)
*   [xjs å¤§ç†çŸ³](https://rxmarbles.com/)

æ–°æ¥çš„è‹—æ¡ 3 å·ï¼Œè¯·ç»“å¸- [è‹—æ¡æ•™ç¨‹](https://svelte.dev/tutorial/) - [Rich Harris åæ€ååº”æ€§](https://youtu.be/AdNJ3fydeao) - [Toolsday - 93ã€‚è‹—æ¡](https://pca.st/JyN1)

# [](#lesson)æ•™è®­

## [](#example)ä¸¾ä¾‹

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå®ƒå±•ç¤ºäº†ä¸€ä¸ªå¿«é€Ÿé¢„è§ˆ osf æœ€ç»ˆçš„ React åº”ç”¨ç¨‹åºå°†å¦‚ä½•å·¥ä½œã€‚å¦‚æ‚¨æ‰€è§ï¼Œå°†ä¼šå‘ç”ŸåŸºæœ¬çš„ 4 ä¸ªæ­¥éª¤ã€‚

1.  ç­¾åˆ°
2.  æ·»åŠ å¡ç‰¹å½¼å‹’äº‹å®
3.  åœ¨åˆ—è¡¨ä¸­æ˜¾ç¤ºæ·»åŠ çš„å¡ç‰¹å½¼å‹’äº‹å®
4.  é€€å‡º <video controls=""><source src="https://res.cloudinary.com/ajonp/video/upload/v1556399505/ajonp-ajonp-com/17-rxfire-react-cats/5.webm" type="video/webm"> <source src="https://res.cloudinary.com/ajonp/video/upload/v1556399505/ajonp-ajonp-com/17-rxfire-react-cats/5.mov" type="video/mp4"></video> ##è®¾ç½®

ä½ å°†éœ€è¦ä¸ nodejs æ†ç»‘åœ¨ä¸€èµ·çš„ NPMã€‚å¦å¤– [npx](https://github.com/zkat/npx) æ˜¯æœ€å®¹æ˜“ä½¿ç”¨ git ä¸Šæä¾›çš„æ¨¡æ¿çš„ã€‚

```
npx degit sveltejs/template rxfire-svelte
cd rxfire/svelte 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨è¿˜éœ€è¦åˆ›å»ºè‡ªå·±çš„ Firebase é¡¹ç›®å¹¶åˆå§‹åŒ– Firestore æ•°æ®åº“ï¼Œè¯·ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼åˆ›å»ºã€‚[ç¤ºä¾‹è§„åˆ™](https://github.com/AJONPLLC/rxfire-react-cats/blob/master/firestore.rules)ï¼›

## [](#final-app-structure)æœ€ç»ˆ App ç»“æ„

[![](../Images/33486299d52f5c6d1c74623719c8f7a8.png) ](https://res.cloudinary.com/practicaldev/image/fetch/s--jsR9IVIx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1556565487/ajonp-ajonp-com/18-rxfire-svelte-cats/djkgve67f4opo5oh6jqr.png) [ ![](../Images/c73617ca892f640f11ebf639f95925e3.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--hBEIY9Zy--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/v1556565487/ajonp-ajonp-com/18-rxfire-svelte-cats/pzf7b3rmcfmfmmgicsii.png)

## [](#install-dependencies)å®‰è£…ä¾èµ–é¡¹

ä½ å°†éœ€è¦ [rxfire](https://www.npmjs.com/package/rxfire) ã€ [firebase](https://www.npmjs.com/package/firebase) å’Œ [rxjs](https://www.npmjs.com/package/rxjs)

```
npm i rxfire firebase rxjs 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#create-firebasejs)åˆ›å»º Firebase.js

js å°†æ˜¯æˆ‘ä»¬çš„ä¸»è¦ firebase æ–‡ä»¶ï¼Œå¹¶å°†åŒ…å«æˆ‘ä»¬çš„ Firebase åº”ç”¨ç¨‹åºçš„å·¥å…·ï¼ŒåŒ…æ‹¬ Firebase çš„å®ä¾‹åŒ–ã€‚è¯¥æ–‡ä»¶åŒ…æ‹¬ç”¨äº auth å’Œ firestore åŠ©æ‰‹åŠŸèƒ½çš„ rxfireã€‚

Firebase.js

```
import 'firebase/auth';
import 'firebase/firestore';

import firebase from 'firebase/app';
import { authState } from 'rxfire/auth';
import { collectionData } from 'rxfire/firestore';
import { filter } from 'rxjs/operators';

const app = firebase.initializeApp({
/* Place your configuration here */
});

const firestore = firebase.firestore(app); // Initialize firestore
const auth = firebase.auth(app); // Initialize firebase auth
const loggedIn$ = authState(auth).pipe(filter(user => !!user)); // Observable only return when user is logged in.

export { app, auth, firestore, collectionData, loggedIn$ };

export default firebase; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> å¦‚æœä½ å·²ç»ç†Ÿæ‚‰ Svelte 3ï¼Œä½ å¯ä»¥è·³è¿‡æœ¬è¯¾çš„è¯´æ˜éƒ¨åˆ†ã€‚

## [](#simple-initial-component)ç®€å•çš„åˆå§‹ç»„ä»¶

### [](#remove-appsvelte-and-replace-it-with-the-following)åˆ é™¤ App.svelteï¼Œæ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹

ä½ åŸºæœ¬ä¸Šå¯ä»¥æŠŠä¸€ä¸ª. svelte æ–‡ä»¶æƒ³è±¡æˆä¸€ä¸ª html æ–‡ä»¶ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸€äº›äº‹æƒ…ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•æ ·å¼çš„ä½œç”¨åŸŸéƒ½æ˜¯å½“å‰ç»„ä»¶ï¼Œä¸ºäº†è·å¾—è¶…å‡ºå½“å‰ç»„ä»¶çš„æ ·å¼ï¼Œä½ å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨ç±»ä¼¼äº`:global(div.flex-row)`çš„åœ°æ–¹ã€‚ç„¶è€Œ(ä¹Ÿè®¸æ˜¯æœ€ä½³å®è·µ)ï¼Œæˆ‘å‘ç°å°†è¿™äº›ä» App.svelte è½¬ç§»åˆ°`/public/global.css`æ›´å®¹æ˜“ï¼›

App.svelte

```
<script>
    import Instructions from './components/Instructions.svelte';
    import SignIn from './components/Signin.svelte';
    import AddCat from './components/AddCat.svelte';
    import ListCatFacts from './components/ListCatFacts.svelte';
    import {loggedIn$} from './Firebase.js'

    /* Make something more observable */
    const user = loggedIn$;
</script>
<style>
/* :global(div.flex-row){
    display: flex;
    justify-content: center;
    flex-flow: row wrap;
}
:global(div.flex-column){
    display: flex;
    justify-content: center;
    flex-flow: column;
}
.max-800{
    max-width: 800px;
} */
</style>
 <div class="flex-row">
 <div class="flex-column">
     <Instructions />
 </div>
</div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#create-instructionssvelte)åˆ›å»ºè¯´æ˜

è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ç»„ä»¶ï¼Œä¸éœ€è¦ä»»ä½•é“å…·ï¼Œå®ƒåªè¿”å›ç®€å•çš„ htmlã€‚

ç»„ä»¶/è¯´æ˜.è¶…è–„

```
<div class="flex-row">
  <div>
    <img
      src="https://res.cloudinary.com/ajonp/image/upload/w_500/v1556553295/ajonp-ajonp-com/18-rxfire-svelte-cats/RxFire_Svelt.png"
      alt="rxfire for cats"
    />
  </div>
  <div>
    <p>
      In this example we will use RxFire to Observe the Cat Facts that we add to
      our Firestore Database.
    </p>
    <a href="https://github.com/AJONPLLC/rxfire-react-cats" target="no_index">
      https://github.com/AJONPLLC/rxfire-react-cats
    </a>
    <ol>
      <li>
        Sign In
        <ul>
          <li>Uses Google Auth for Firebase</li>
          <li>Found in App.svelte</li>
        </ul>
      </li>
      <li>
        Add Cat Fact
        <ul>
          <li>This will use an API and Insert the facts into Firestore</li>
          <li>Found in components/AddCat.svelte</li>
        </ul>
      </li>
      <li>
        Firestore collection
        <ul>
          <li>Observing catfacts for changes, heart eyes are your facts</li>
          <li>Found in components/ListCatFacts.svelte</li>
        </ul>
      </li>
      <li>
        Sign Out
        <ul>
          <li>Observe that user is removed</li>
        </ul>
      </li>
    </ol>
  </div>
</div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#update-collection-catfacts)æ›´æ–°é›†åˆ catfacts

### [](#create-addcatsvelte)åˆ›å»º AddCat.svelte

æˆ‘ä»¬è¦æ·»åŠ çš„ç¬¬ä¸€ä¸ªæŒ‰é’®éå¸¸ç®€å•ï¼Œå®ƒè°ƒç”¨ä¸€ä¸ª API å¹¶å°†è¿”å›çš„æ•°æ®ä½œä¸ºä¸€ä¸ªæ–°æ–‡æ¡£æ¨å…¥ firestore é›†åˆã€‚æˆ‘æ€»æ˜¯å–œæ¬¢è‡ªä¸Šè€Œä¸‹åœ°å·¥ä½œï¼Œæ‰€ä»¥é¦–å…ˆè®©æˆ‘ä»¬å°† AddCat.svelte å¯¼å…¥æˆ‘ä»¬çš„ App.svelteã€‚

### [](#update-appsvelte)æ›´æ–° App.svelte

App.svelte

```
...
import AddCat from './components/AddCat';
...
 <SignIn user={user} />
... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ç°åœ¨å°†æŠŠæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªé“å…·ä¼ é€’ç»™`AddCat`ï¼Œè¿™å¾ˆç®€å•ï¼Œé€šè¿‡å£°æ˜ä¸€ä¸ªå˜é‡å¹¶ä¼ é€’å®ƒï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`const user = loggedIn$`ã€‚è¿™æœ‰å¿…è¦å—ï¼Œå¯èƒ½æ²¡æœ‰ï¼Œä½†æˆ‘æƒ³å±•ç¤ºä¼ é€’ä¸€ä¸ªé“å…·ï¼Œæˆ‘ä»¬å¯ä»¥ä»`Firebase.js`é‚£é‡Œå¾—åˆ°è¿™ä¸ªã€‚

è®°ä¸‹è¿™ä¸ªå­©å­ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰`export let user;`æ¥è®¿é—®è¿™ä¸ªé“å…·ã€‚

`addCatFact`å‡½æ•°è°ƒç”¨ä¸€ä¸ª APIï¼Œä»[https://cat-fact.herokuapp.com](https://cat-fact.herokuapp.com)è¿”å›ä¸€ä¸ªéšæœºçš„çŒ«äº‹å®ã€‚å› ä¸º CORSï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ä»£ç†ä¼ é€’å®ƒï¼Œä½†æ˜¯ä½ ä¼šçœ‹åˆ°æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªè¿”å›å€¼ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ javascript [ææ„èµ‹å€¼](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment)æ¥åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–¹æ³•æ˜¯å°†æˆ‘ä»¬çš„`catFactDate`æ·»åŠ åˆ°è¯¥å¯¹è±¡ä¸­ã€‚è¿™å…è®¸æˆ‘ä»¬ä»¥åæŒ‰é™åºå¯¹åˆ—è¡¨ä¸­çš„äº‹å®è¿›è¡Œæ’åºã€‚

æˆ‘ä»¬å‘ firestore æ·»åŠ äº†ä¸€ä¸ªéšæœºçš„çŒ«äº‹å®ï¼Œå¹¶å‘å¯¹è±¡æ·»åŠ äº†æˆ‘ä»¬çš„`catFactDate`ã€‚è¿™å…è®¸æˆ‘ä»¬ä»¥åæŒ‰é™åºå¯¹åˆ—è¡¨ä¸­çš„äº‹å®è¿›è¡Œæ’åºã€‚

è¿™é‡Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯- #if - [if blocks](https://svelte.dev/docs#If_blocks) åªæ˜¯ä¸€ä¸ªæ ‡å‡† Ifï¼Œä½ ä¼šæœŸæœ›- $user - [Subscriptions](https://svelte.dev/docs#svelte_store) å¦‚æœä½ æ¥è‡ª angularï¼Œè¿™å°±åƒå¼‚æ­¥ç®¡é“ã€‚- on:click={addCatFact - [ç»„ä»¶äº‹ä»¶](https://svelte.dev/docs#Component_events)è¿™ç±»ä¼¼äº html ç»„ä»¶ä¸­å¸¸è§çš„äº‹ä»¶ï¼Œä½†è¿™é‡Œæˆ‘ä»¬åªæ˜¯ç”¨ curlys æ¥ä¼ é€’å‡½æ•°`addCatFact`ã€‚

components/AddCat.svelte

```
<script>
  import { firestore } from '../Firebase';
  import catFacts from '../random.js';
  export let user;
  const addCatFact = async () => {
    try {
      /* Gave up on the API working!!! */
      const value = catFacts[Math.floor(Math.random() * catFacts.length)];
      await firestore
        .collection('catfacts')
        .add({ ...value, catFactDate: new Date() });
    } catch (error) {
      console.error(error);
    }
  };
</script>
<div class="flex-column">
  {#if $user}
  <button className="myButton" on:click="{addCatFact}">
    2\. Add Cat Fact
  </button>
  {/if}
</div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå¦‚æœä½ ç°åœ¨å°è¯•è¿™æ ·åšï¼Œåº”è¯¥ä¼šå¤±è´¥ï¼Œå¹¶å‡ºç°è­¦å‘Š [![fail image](../Images/b3a99e24f662ac53f92316aa9c59f199.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--5033Fw9Q--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/f_auto%2Cfl_lossy%2Cq_auto/v1556403260/ajonp-ajonp-com/12-angular-material-from-firestore/pmapculndlkk3c61pa21.jpg)

è¿™æ˜¯æ„æ–™ä¹‹ä¸­çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„ firestore.rules è®¾ç½®ä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ­¥é€šè¿‡èº«ä»½éªŒè¯éƒ¨åˆ†åæ·»åŠ è¿™äº›è§„åˆ™ã€‚

æ‚¨å¯èƒ½è¿˜ä¼šåœ¨æ§åˆ¶å°ä¸­æ³¨æ„åˆ°(åœ¨å±å¹•ä¸Šï¼Œäº‹å®ä¼šè·³è¿›è·³å‡º)ï¼Œfirebase å®é™…ä¸Šä¼šæ·»åŠ åˆ°æˆ‘ä»¬çš„é˜µåˆ—ä¸­ï¼Œç›´åˆ°åç«¯å‡ºç°æ•…éšœã€‚è¿™æ ·åšæ˜¯æœ‰ç›®çš„çš„ï¼Œå› ä¸ºå®ƒç»™äº†æˆ‘ä»¬æ‰€æœŸæœ›çš„å¿«é€Ÿ UIï¼ŒåŒæ—¶è¿˜ä¿æŒäº†æ•°æ®çš„å®Œæ•´æ€§ã€‚

## [](#add-firebase-authentication)æ·»åŠ  Firebase è®¤è¯

### [](#update-appsvelte)æ›´æ–° App.svelte

åœ¨`SignIn`ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†å†æ¬¡ä½¿ç”¨ propsï¼Œæˆ‘ä»¬å°†ä¼ é€’ç”¨æˆ·çŠ¶æ€ã€‚

App.svelte

```
<script>
  ...
    import SignIn from './components/Signin.svelte';
  ...
  </script>

  ...
     <SignIn user={user} />
  ... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

SignIn.svelte

```
<script>
  import firebase, { app } from '../Firebase';

  /* this is like props */
  export let user;

  const signIn = () => {
    const authProvider = new firebase.auth.GoogleAuthProvider();
    app.auth().signInWithPopup(authProvider);
  };
  const signOut = async () => {
    await firebase.auth().signOut();
  };
</script>
<div class="flex-column">
  {#if $user}
  <h1>
    Welcome {$user.email}
    <button className="myButton" on:click="{signOut}">
      4\. Sign Out
    </button>
  </h1>
  {:else}
  <button className="myButton" on:click="{signIn}">
    1\. Sign In
  </button>
  {/if}
</div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#update-addcat-to-include-user-uid)æ›´æ–° AddCat ä»¥åŒ…å«ç”¨æˆ· uid

### [](#pass-user-to-addcat)å°†ç”¨æˆ·ä¼ é€’ç»™ AddCat

æ›´æ–°æˆ‘ä»¬çš„ä¸» appï¼Œé€šè¿‡ç”¨æˆ·é“å…·ã€‚

App.svelte

```
<AddCat user={user} /> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å°†æˆ‘ä»¬çš„æ•°æ®åŒ…å«åˆ° firestore ä¸­ã€‚AddCat.svelte

```
...
.add({ ...value, uid: $user.uid, catFactDate: new Date() })
... 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é™¤äº†æ˜¯å¦æ˜¾ç¤º Add Cat Fact æŒ‰é’®ï¼Œæˆ‘ä»¬è¿˜æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨ã€‚æ­¤æŒ‰é’®åº”ä»…åœ¨ç”¨æˆ·ç™»å½•æ—¶æ˜¾ç¤ºã€‚

```
<div class="flex-column">
  {#if $user}
  <button className="myButton" on:click="{addCatFact}">
    2\. Add Cat Fact
  </button>
  {/if}
</div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#update-firestorerules)æ›´æ–° firestore.rules

```
service cloud.firestore {
  match /databases/{database}/documents {
    // LockDown All
    match /{document=**} {
      allow read: if false;
      allow write: if false;
    }
    // User
    match /users/{userId} {
      allow read: if false;
      allow write: if request.resource.id == request.auth.uid;
    }
    // CatFacts
    match /catfacts/{catFactId} {
      allow read: if true;
      allow write: if request.auth.uid != null && request.resource.data.uid == request.auth.uid;
    }
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#create-list-of-cat-facts)åˆ›å»ºçŒ«äº‹å®åˆ—è¡¨

### [](#create-listcatfacts)åˆ›å»º ListCatFacts

è¿™å¯èƒ½æ˜¯`RxFire`æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå¯è§‚å¯Ÿå€¼ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨å‡½æ•°`collectionData`è®¢é˜…å¯¹é›†åˆçš„æ‰€æœ‰æ›´æ”¹ï¼Œè¯¥å‡½æ•°å°†é›†åˆä½œä¸ºå‚æ•°ä»¥åŠè¦åˆ›å»ºçš„é€‰é¡¹ idï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’äº†`catFactsRef.orderBy('catFactDate', 'desc')`å’Œ`'catFactId'`ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åªä½¿ç”¨ä¸€ä¸ª map æ¥è¿­ä»£æ¯ä¸ª catFactï¼Œæ¯å½“å¯è§‚å¯Ÿå¯¹è±¡æ›´æ–°å½“å‰çš„`catFact`çŠ¶æ€æ—¶ï¼Œæ•°ç»„å°±ä¼šæ›´æ–°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`{#each $catFacts as catFact}`æ˜¾ç¤ºå®Œæ•´çš„åˆ—è¡¨æ›´æ–°ï¼Œç„¶åå¦‚æœæ‚¨æ˜¯è¯¥äº‹å®çš„æ‰€æœ‰è€…ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ if å—è·å¾— catheart eyesã€‚

*   [æ¯ä¸ªåŒºå—](https://svelte.dev/docs#Each_blocks)

ListCatFacts.svelte

```
<script>
  import { collectionData, firestore } from '../Firebase';
  import { startWith } from 'rxjs/operators';
  const catFactsRef = firestore.collection('catfacts');

  export let user;

  const catFacts = collectionData(
    catFactsRef.orderBy('catFactDate', 'desc'),
    'catFactId'
  ).pipe(startWith([]));
</script>
<style>
  .flex-row {
    justify-content: left;
  }
</style>
<div class="flex-column max-800">
  <h3>Firestore Collection "catfacts"</h3>
  <div>
    {#each $catFacts as catFact}
    <div>
      {#if $user && $user.uid === catFact.uid}
      <span role="img" aria-label="fun-cat">
        ğŸ˜»
      </span>
      {:else}
      <span role="img" aria-label="fun-cat">
        ğŸ˜º
      </span>
      {/if}
      <span>{catFact.text}</span>
    </div>
    {/each}
  </div>
</div> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>