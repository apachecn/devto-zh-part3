# ååº”é’©å­:ç”¨é…¶æµ‹è¯•å®šåˆ¶é’©å­

> åŸæ–‡:[https://dev . to/flexdinesh/react-hooks-test-custom-hooks-with-enzyme-40ib](https://dev.to/flexdinesh/react-hooks-test-custom-hooks-with-enzyme-40ib)

**TLï¼›DR** -å°†ä½ çš„å®šåˆ¶é’©å­åŒ…è£…åœ¨ä¸€ä¸ªç»„ä»¶ä¸­ï¼Œå¹¶å¯¹å…¶è¿›è¡Œæµ…å±‚æ¸²æŸ“ä»¥æµ‹è¯•å®ç°ç»†èŠ‚ã€‚

# [](#what-you-will-learn)ä½ å°†å­¦åˆ°ä»€ä¹ˆ

*   ååº”æµ‹è¯•ç­–ç•¥
    *   **ç”¨æˆ·å¯è§‚å¯Ÿçš„è¡Œä¸º**
    *   **å®æ–½ç»†èŠ‚**
*   ç”¨é…¶æµ‹è¯•å®šåˆ¶æŒ‚é’©

## [](#test-strategies)æµ‹è¯•ç­–ç•¥

å¤§ä½“ä¸Šæœ‰ä¸¤ç§ç­–ç•¥æ¥æµ‹è¯•æˆ‘ä»¬çš„ React ä»£ç åº“ã€‚

1.  æµ‹è¯•ç”¨æˆ·å¯è§‚å¯Ÿçš„è¡Œä¸º
2.  æµ‹è¯•å®æ–½ç»†èŠ‚

### [](#testing-user-observable-behaviour)æµ‹è¯•ç”¨æˆ·å¯è§‚å¯Ÿçš„è¡Œä¸º

æµ‹è¯•ç”¨æˆ·å¯è§‚å¯Ÿçš„è¡Œä¸ºæ„å‘³ç€é’ˆå¯¹æµ‹è¯•çš„ç»„ä»¶ç¼–å†™æµ‹è¯•

*   ç»„ä»¶çš„å‘ˆç°æ–¹å¼
*   å½“ç”¨æˆ·ä¸ DOM äº¤äº’æ—¶å¦‚ä½•é‡æ–°å‘ˆç°ç»„ä»¶
*   é“å…·/çŠ¶æ€å¦‚ä½•æ§åˆ¶æ¸²æŸ“çš„å†…å®¹

è€ƒè™‘ä»¥ä¸‹ç»„ä»¶- `Greet`

```
function Greet({ user = 'User' }) {
  const [name, setName] = React.useState(user);

  return <div onClick={() => setName('Pinocchio')}>Hello, {name}!</div>;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`Greet`ä¸­æµ‹è¯•ç”¨æˆ·å¯è§‚å¯Ÿåˆ°çš„è¡Œä¸ºæ„å‘³ç€

*   æµ‹è¯•`Greet`æ¸²æŸ“æ—¶æ˜¯å¦æ²¡æœ‰å´©æºƒ
*   æµ‹è¯•ç”¨æˆ·å±æ€§æœªé€šè¿‡æ—¶`Hello, User!`æ˜¯å¦è¢«æ¸²æŸ“
*   æµ‹è¯•å½“`Bruce`ä½œä¸ºå€¼ä¼ é€’ç»™`user`å±æ€§æ—¶`Hello, Bruce!`æ˜¯å¦è¢«æ¸²æŸ“
*   æµ‹è¯•å½“ç”¨æˆ·ç‚¹å‡»å…ƒç´ æ—¶æ–‡æœ¬æ˜¯å¦æ”¹å˜ä¸º`Hello, Pinocchio!`

### [](#testing-implementation-details)æµ‹è¯•å®ç°ç»†èŠ‚

æµ‹è¯•å®ç°ç»†èŠ‚æ„å‘³ç€æ ¹æ®æµ‹è¯•çš„çŠ¶æ€é€»è¾‘ç¼–å†™æµ‹è¯•

*   å¦‚ä½•ç”¨é»˜è®¤å€¼/æ­£ç¡®å€¼åˆå§‹åŒ–çŠ¶æ€
*   è°ƒç”¨å¤„ç†ç¨‹åºæ—¶çŠ¶æ€å¦‚ä½•å˜åŒ–

è€ƒè™‘åŒä¸€ä¸ªç»„ä»¶- `Greet`

```
function Greet({ user = 'User' }) {
  const [name, setName] = React.useState(user);

  return <div onClick={() => setName('Pinocchio')}>Hello, {name}!</div>;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æµ‹è¯•`Greet`ä¸­çš„å®ç°ç»†èŠ‚æ„å‘³ç€

*   å½“ç”¨æˆ·å±æ€§æœªä¼ é€’ç»™`Greet`æ—¶ï¼Œæµ‹è¯•`name`æ˜¯å¦è®¾ç½®ä¸ºé»˜è®¤å€¼`User`
*   å½“ç”¨æˆ·å±æ€§è¢«ä¼ é€’åˆ°`Greet`æ—¶ï¼Œæµ‹è¯•`name`æ˜¯å¦è¢«è®¾ç½®ä¸ºå±æ€§å€¼
*   æµ‹è¯•è°ƒç”¨`setName`æ—¶`name`æ˜¯å¦æ›´æ–°

## [](#testing-custom-hooks-with-enzyme)ç”¨é…¶æµ‹è¯•å®šåˆ¶æŒ‚é’©

*æ³¨æ„:è¯·ç¡®ä¿ä½ çš„ React ç‰ˆæœ¬æ˜¯`^16.8.5`ã€‚åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒHooks ä¸ä¼šä½¿ç”¨ enzyme shallow render é‡æ–°æ¸²æŸ“ç»„ä»¶ï¼ŒReact å›¢é˜Ÿåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœä½ çš„ React ç‰ˆæœ¬ä½äºè¿™ä¸ªç‰ˆæœ¬ï¼Œä½ å¯èƒ½éœ€è¦åœ¨æ¯æ¬¡ä¿®æ”¹åä½¿ç”¨ enzyme mount å’Œã€wrapper æ¥æµ‹è¯•é‡æ–°æ¸²æŸ“ã€‚*

å½“æ‚¨é’ˆå¯¹åŒ…å«è¡¨ç¤ºæ€§(UI)é€»è¾‘å’Œ DOM å‘ˆç°å…ƒç´ çš„ç»„ä»¶ç¼–å†™æµ‹è¯•æ—¶ï¼Œæµ‹è¯•å®ç°ç»†èŠ‚å¯èƒ½çœ‹èµ·æ¥æ²¡æœ‰å¿…è¦ï¼Œç”šè‡³å¯èƒ½è¢«è®¤ä¸ºæ˜¯ä¸€ç§ä¸å¥½çš„åšæ³•ã€‚ä½†æ˜¯**å®šåˆ¶é’©å­**åªåŒ…å«**çŠ¶æ€é€»è¾‘**ï¼Œæˆ‘ä»¬å¿…é¡»å½»åº•æµ‹è¯•å®ç°ç»†èŠ‚ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½ç¡®åˆ‡åœ°çŸ¥é“æˆ‘ä»¬çš„å®šåˆ¶é’©å­åœ¨ç»„ä»¶ä¸­çš„è¡Œä¸ºã€‚

è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æŒ‚é’©æ¥æ›´æ–°å’ŒéªŒè¯è¡¨å•å­—æ®µã€‚

```
/* useFormField.js */

import React from 'react';

function useFormField(initialVal = '') {
  const [val, setVal] = React.useState(initialVal);
  const [isValid, setValid] = React.useState(true);

  function onChange(e) {
    setVal(e.target.value);

    if (!e.target.value) {
      setValid(false);
    } else if (!isValid) setValid(true);
  }

  return [val, onChange, isValid];
}

export default useFormField; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°½ç®¡è‡ªå®šä¹‰é’©å­åœ¨æŠ½è±¡å‡ºä»£ç ä¸­å¯é‡ç”¨çš„é€»è¾‘æ–¹é¢å¾ˆæ£’ï¼Œä½†å®ƒä»¬ä¹Ÿæœ‰ä¸€ä¸ªé™åˆ¶ã€‚å°½ç®¡å®ƒä»¬åªæ˜¯ JavaScript å‡½æ•°ï¼Œä½†å®ƒä»¬åªèƒ½åœ¨ React ç»„ä»¶å†…éƒ¨å·¥ä½œã€‚ä½ ä¸èƒ½ä»…ä»…è°ƒç”¨å®ƒä»¬ï¼Œå¹¶æ ¹æ®é’©å­è¿”å›çš„å†…å®¹ç¼–å†™æµ‹è¯•ã€‚æ‚¨å¿…é¡»å°†å®ƒä»¬åŒ…è£…åœ¨ React ç»„ä»¶ä¸­ï¼Œå¹¶æµ‹è¯•å®ƒè¿”å›çš„å€¼ã€‚

*   å®šåˆ¶é’©å­ä¸èƒ½åƒ JavaScript å‡½æ•°ä¸€æ ·è¢«æµ‹è¯•
*   è‡ªå®šä¹‰æŒ‚é’©åº”è¯¥åŒ…è£…åœ¨ React ç»„ä»¶ä¸­ï¼Œä»¥æµ‹è¯•å…¶è¡Œä¸º

ç”±äºé’©å­çš„å¯ç»„åˆæ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°†é’©å­ä½œä¸ºä¸€ä¸ªé“å…·ä¼ é€’ç»™ä¸€ä¸ªç»„ä»¶ï¼Œä¸€åˆ‡éƒ½å°†æŒ‰ç…§å®ƒåº”è¯¥çš„æ–¹å¼å·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªåŒ…è£…å™¨ç»„ä»¶æ¥å‘ˆç°å’Œæµ‹è¯•æˆ‘ä»¬çš„é’©å­ã€‚

```
/* useFormField.test.js */

function HookWrapper(props) {
  const hook = props.hook ? props.hook() : undefined;
  return <div hook={hook} />;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬å¯ä»¥åƒè®¿é—® JavaScript å¯¹è±¡ä¸€æ ·è®¿é—®é’©å­ï¼Œå¹¶æµ‹è¯•å®ƒçš„è¡Œä¸ºã€‚

```
/* useFormField.test.js */

import React from 'react';
import { shallow } from 'enzyme';
import useFormField from './useFormField';

function HookWrapper(props) {
  const hook = props.hook ? props.hook() : undefined;
  return <div hook={hook} />;
}

it('should set init value', () => {
  let wrapper = shallow(<HookWrapper hook={() => useFormField('')} />);

  let { hook } = wrapper.find('div').props();
  let [val, onChange, isValid] = hook;
  expect(val).toEqual('');

  wrapper = shallow(<HookWrapper hook={() => useFormField('marco')} />);

  // destructuring objects - {} should be inside brackets - () to avoid syntax error
  ({ hook } = wrapper.find('div').props());
  [val, onChange, isValid] = hook;
  expect(val).toEqual('marco');
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®šåˆ¶é’©å­çš„å®Œæ•´æµ‹è¯•å¥—ä»¶å¦‚ä¸‹æ‰€ç¤ºã€‚

```
/* useFormField.test.js */

import React from 'react';
import { shallow } from 'enzyme';
import useFormField from './useFormField';

function HookWrapper(props) {
  const hook = props.hook ? props.hook() : undefined;
  return <div hook={hook} />;
}

describe('useFormField', () => {
  it('should render', () => {
    let wrapper = shallow(<HookWrapper />);

    expect(wrapper.exists()).toBeTruthy();
  });

  it('should set init value', () => {
    let wrapper = shallow(<HookWrapper hook={() => useFormField('')} />);

    let { hook } = wrapper.find('div').props();
    let [val, onChange, isValid] = hook;
    expect(val).toEqual('');

    wrapper = shallow(<HookWrapper hook={() => useFormField('marco')} />);

    // destructuring objects - {} should be inside brackets - () to avoid syntax error
    ({ hook } = wrapper.find('div').props());
    [val, onChange, isValid] = hook;
    expect(val).toEqual('marco');
  });

  it('should set the right val value', () => {
    let wrapper = shallow(<HookWrapper hook={() => useFormField('marco')} />);

    let { hook } = wrapper.find('div').props();
    let [val, onChange, isValid] = hook;
    expect(val).toEqual('marco');

    onChange({ target: { value: 'polo' } });

    ({ hook } = wrapper.find('div').props());
    [val, onChange, isValid] = hook;
    expect(val).toEqual('polo');
  });

  it('should set the right isValid value', () => {
    let wrapper = shallow(<HookWrapper hook={() => useFormField('marco')} />);

    let { hook } = wrapper.find('div').props();
    let [val, onChange, isValid] = hook;
    expect(val).toEqual('marco');
    expect(isValid).toEqual(true);

    onChange({ target: { value: 'polo' } });

    ({ hook } = wrapper.find('div').props());
    [val, onChange, isValid] = hook;
    expect(val).toEqual('polo');
    expect(isValid).toEqual(true);

    onChange({ target: { value: '' } });

    ({ hook } = wrapper.find('div').props());
    [val, onChange, isValid] = hook;
    expect(val).toEqual('');
    expect(isValid).toEqual(false);
  });
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å‘ˆç°è‡ªå®šä¹‰é’©å­å¹¶ä½œä¸ºé“å…·è®¿é—®å®ƒï¼Œåº”è¯¥å¯ä»¥è®©æˆ‘ä»¬å®Œå…¨è®¿é—®å®ƒçš„è¿”å›å€¼ã€‚

å¦‚æœä½ åœ¨ä½ çš„å®šåˆ¶é’©å­ä¸­ä½¿ç”¨äº†`useEffect`é’©å­ï¼Œç¡®ä¿ä½ ç”¨[reactsetutils . act()](https://reactjs.org/docs/test-utils.html#act)åŒ…è£…äº†`shallow`æˆ–`mount`è°ƒç”¨ï¼Œä»¥ä¾¿åœ¨æ–­è¨€ä¹‹å‰æ¸…é™¤æ•ˆæœã€‚é…¶å¯èƒ½ä¼šå¾ˆå¿«åœ¨å†…éƒ¨æ”¯æŒè¿™ä¸€ç‚¹ï¼Œä½†ç°åœ¨ï¼Œè¿™æ˜¯å¿…éœ€çš„ã€‚æ›´å¤šä¿¡æ¯è¯·ç‚¹å‡»è¿™é‡Œ- [é’©å­-å¸¸è§é—®é¢˜è§£ç­”](https://reactjs.org/docs/hooks-faq.html#how-to-test-components-that-use-hooks)ã€‚

```
act(() => {
  wrapper = shallow(<HookWrapper />);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ç¯‡æ–‡ç« ä¸­çš„æ‰€æœ‰ä»£ç ç‰‡æ®µéƒ½å¯ä»¥åœ¨ repo - [testing-hooks](https://github.com/flexdinesh/testing-hooks) ä¸­æ‰¾åˆ°ï¼Œå¹¶é™„æœ‰ä¸€ä¸ªå·¥ä½œç¤ºä¾‹ã€‚

æµ‹è¯•æ„‰å¿«ï¼ğŸ‰