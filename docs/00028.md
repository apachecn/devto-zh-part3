# NSPersistentCloudKitContainer çš„ç¬¬ä¸€å°è±¡

> åŸæ–‡:[https://dev . to/andrewcbancroft/first-impressions-of-nspersistentcloudkitcontainer-2a2d](https://dev.to/andrewcbancroft/first-impressions-of-nspersistentcloudkitcontainer-2a2d)

èµ„æº

*   [ä½¿ç”¨ CloudKit çš„æ ¸å¿ƒæ•°æ®- WWDC 2019 ä¼šè®® 202](https://developer.apple.com/videos/play/wwdc2019/202)
*   [æ¥è‡ªè‹¹æœçš„æ ·æœ¬é¡¹ç›®](https://developer.apple.com/documentation/coredata/synchronizing_a_local_store_to_the_cloud)

## NSPersistentCloudKitContainer å¦‚ä½•å¸®åŠ©

æˆ‘æƒ³æ¯ä¸ªäººéƒ½åº”è¯¥é—®çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œâ€œè¿™æœ‰ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Ÿ`NSPersistentCloudKitContainer`æ€ä¹ˆä¼šå¸®æˆ‘ï¼Ÿâ€

æˆ‘æ³¨æ„åˆ°åœ¨ [WWDC 2019 å±Š](https://developer.apple.com/videos/play/wwdc2019/202)ä¸­è‡³å°‘æœ‰**ä¸‰ä¸ªå·¨å¤§çš„èƒœåˆ©**ã€‚é—®é—®ä½ è‡ªå·±â€¦

1)â€œæˆ‘æƒ³çŸ¥é“å¦‚ä½•ä» CloudKit ä¸­æ£€ç´¢æ•°æ®ï¼Œå¹¶å°†å…¶ä¸æˆ‘è‡ªå·±çš„æœ¬åœ°æ ¸å¿ƒæ•°æ®æŒä¹…æ€§å­˜å‚¨åˆå¹¶å—ï¼Ÿâ€æ²¡æœ‰å—ï¼Ÿæˆ‘ä¹Ÿæ˜¯ã€‚ğŸ˜ƒ

`NSPersistentCloudKitContainer`å¤„ç†åˆ¶ä½œåº”ç”¨ç¨‹åº CloudKit æ•°æ®çš„æœ¬åœ°å‰¯æœ¬ã€‚

2)â€œæˆ‘æ˜¯å¦å¸Œæœ›å®ç°åŒæ­¥è®¡åˆ’å’Œ CloudKit é™„å¸¦çš„æ‰€æœ‰é”™è¯¯å¤„ç†ï¼Ÿâ€â€“æˆ‘*ç»å¯¹*ä¸â€¦

`NSPersistentCloudKitContainer`å¤„ç†è°ƒåº¦ CloudKit æ“ä½œï¼Œå¹¶è·å–æ‚¨çš„`// handle errors`å ä½ç¬¦ä»£ç (ğŸ‘€)å¹¶åœ¨å†…éƒ¨ä»¥æ­£ç¡®çš„æ–¹å¼å®ç°å®ƒã€‚#ç”œèœœ

3)â€œæˆ‘æƒ³æ‰‹å·¥åœ¨`NSManagedObjects`å’Œ`CKRecords`ä¹‹é—´æ˜ å°„å—ï¼Ÿâ€-å¦‚æœé‚£æ˜¯è‡ªåŠ¨çš„å°±ä¸ä¼šäº†ï¼

`NSPersistentCloudKitContainer`ä¹Ÿè´Ÿè´£å°†ä½ çš„`NSManagedObjects`è½¬æ¢æˆ`CKRecords`ã€‚

## [](#exciting-times)æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»

è‹¹æœåšäº†å¾ˆå¤šå·¥ä½œæ¥**å°è£…ä¸€ç»„éå¸¸å¸¸è§çš„ä»£ç æ¨¡å¼**ï¼Œè¿™å¯¹å®ç°ä¸€ä¸ªå…·æœ‰æ ¸å¿ƒæ•°æ®å’Œ CloudKit çš„åº”ç”¨ç¨‹åºæ˜¯å¿…è¦çš„ã€‚

ä»–ä»¬å£°ç§°èƒ½å¤Ÿ**ä¸ºæˆ‘ä»¬èŠ‚çœæ•°åƒè¡Œä»£ç **(æˆ‘ä¹Ÿç›¸ä¿¡ï¼).

æˆ‘æœ‰ä¸€ä¸ªåœ¨æœ¬åœ°ä½¿ç”¨æ ¸å¿ƒæ•°æ®çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä¸€ç›´æƒ³å¯ç”¨ CloudKitï¼Œä»¥ä¾¿åœ¨æˆ‘çš„ç”¨æˆ·è®¾å¤‡ä¹‹é—´åŒæ­¥æ•°æ®ã€‚æ¯å½“æˆ‘æƒ³åˆ°è¦è®©æ ¸å¿ƒæ•°æ®ç‰‡æ®µä¸äº‘å¥—ä»¶ç‰‡æ®µåœ¨åŒä¸€æ³¢é•¿ä¸Šäº¤æµéœ€è¦åšäº›ä»€ä¹ˆï¼Œæˆ‘å°±å®³æ€•éšä¹‹è€Œæ¥çš„ä¸å¯é¿å…çš„å¤´ç—›ã€‚æ‰€ä»¥æˆ‘é€ƒè·‘äº†ã€‚ğŸ˜¬

æˆ‘å¸Œæœ›çœ‹çœ‹ç”¨ç°æœ‰çš„åº”ç”¨ç¨‹åºå¯ç”¨`NSPersistentCloudKitContainer`æ˜¯ä»€ä¹ˆæ„Ÿè§‰ã€‚æˆ‘ä¸€å®šä¼šè®°å½•ä¸‹è¿™æ®µæ—…ç¨‹ï¼

# [](#dipping-a-toe-in)æŠŠè„šè¶¾ä¼¸è¿›å»

åªæ˜¯ä¸€äº›å…³äºè¿™ä¸ªæ–°ç±»çš„è®¾ç½®è¿‡ç¨‹çš„èŠ±çµ®â€¦

## [](#enabling-core-data-cloudkit)å¯ç”¨æ ¸å¿ƒæ•°æ®+äº‘å¥—ä»¶

è™½ç„¶ä¸ä¸€å®šéœ€è¦é€‰ä¸­è¿™äº›å¤é€‰æ¡†ï¼Œä½† Xcode ä¼šä¸ºæ‚¨æä¾›ä¸€äº›å°†æ ¸å¿ƒæ•°æ®å’Œ CloudKit **ä¸€èµ·ä½¿ç”¨æ‰€å¿…éœ€çš„æ ·æ¿ä»£ç **ã€‚

[![Check Use Core Data + CloudKit](../Images/61c88cf9cdddccdf8ae33a4d9ddb99e2.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--k4KZe9Jy--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.andrewcbancroft.com/blog/ios-development/data-persistence/first-impressions-of-nspersistentcloudkitcontainer/enable-coredata-cloudkit.png)

## [](#starting-point)èµ·ç‚¹

Xcode åœ¨ AppDelegate.swift æ–‡ä»¶ä¸­ç”Ÿæˆä¸€äº›ä»£ç æ¥åˆå§‹åŒ–æ ¸å¿ƒæ•°æ®å †æ ˆï¼Œåªæ˜¯è¿™ä¸€æ¬¡ï¼Œå®ƒä¸æ˜¯åˆå§‹åŒ–æ ‡å‡†çš„`NSPersistentContainer`ï¼Œè€Œæ˜¯åˆå§‹åŒ–æ–°çš„`NSPersistentCloudKitContainer`:

```
 lazy var persistentContainer: NSPersistentCloudKitContainer = {
   let container = NSPersistentCloudKitContainer(name: "NSPersistentCloudKitContainer_First_Steps")
   container.loadPersistentStores(completionHandler: { (storeDescription, error) in
   if let error = error as NSError? {
   // Replace this implementation with code to handle the error appropriately.
   fatalError("Unresolved error \(error), \(error.userInfo)")
   }
   })
   return container
   }() 
```

## [](#not-ready-yet-more-to-enable)å°šæœªå°±ç»ª(æ›´å¤šå¾…å¯ç”¨)

#### [](#enable-cloudkit-capability)å¯ç”¨ CloudKit åŠŸèƒ½

ç”±äºæ‚¨åœ¨æ­¤åœºæ™¯ä¸­ä½¿ç”¨çš„æ˜¯ CloudKitï¼Œå› æ­¤æ‚¨ä»ç„¶éœ€è¦*å¯ç”¨* CloudKitï¼Œä»¥ä¾¿æ‚¨çš„åº”ç”¨ç¨‹åºæ‹¥æœ‰é€‚å½“çš„**æƒé™**ï¼Œå¹¶ä¸”æ‚¨çš„åº”ç”¨ç¨‹åºçš„ **CloudKit å®¹å™¨**åœ¨ iCloud ä¸­åˆ›å»ºã€‚

[![Enable iCloud](../Images/9563c8be0fc077429c5a5573d73e7401.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--7uwrPusB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://www.andrewcbancroft.com/blog/ios-development/data-persistence/first-impressions-of-nspersistentcloudkitcontainer/enable-icloud.gif)

#### [](#enable-remote-notifications)å¯ç”¨è¿œç¨‹é€šçŸ¥

CloudKit è¿˜ä½¿ç”¨æ¨é€é€šçŸ¥æ¥æé†’æ‚¨çš„åº”ç”¨ç¨‹åºæ¥è‡ªå…¶ä»–è®¾å¤‡çš„æ•°æ®æ›´æ”¹ã€‚è¦è·å¾—è¿™äº›é€šçŸ¥ï¼Œæ‚¨è¿˜éœ€è¦ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºå¯ç”¨è¿œç¨‹é€šçŸ¥åŠŸèƒ½ã€‚

[![Enable Remote Notifications](../Images/381532ce70bb7f52c0e34411376ca83f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s---7mzi-7w--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://www.andrewcbancroft.com/blog/ios-development/data-persistence/first-impressions-of-nspersistentcloudkitcontainer/enable-remote-notifications.gif)

## [](#next-steps)ä¸‹ä¸€æ­¥

è¯´åˆ°å­¦ä¹ ä¸‹ä¸€æ­¥è¯¥åšä»€ä¹ˆï¼Œ [Apple æä¾›äº†ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®](https://developer.apple.com/documentation/coredata/synchronizing_a_local_store_to_the_cloud)ï¼Œæˆ‘å¸Œæœ›å¯¹å…¶è¿›è¡Œæ£€æŸ¥å’Œåˆ†æã€‚

æ›´å¤šå³å°†æ¨å‡ºï¼