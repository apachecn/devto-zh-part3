# AWS ç‰©è”ç½‘å’–å•¡ç›‘æ§å™¨â€“ç¬¬ 2 éƒ¨åˆ†

> åŸæ–‡:[https://dev.to/rehanvdm/aws-iot-coffee-monitor-part-2-279d](https://dev.to/rehanvdm/aws-iot-coffee-monitor-part-2-279d)

è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨æˆ‘çš„ä¸ªäººåšå®¢ä¸Šã€‚

è¿™æ˜¯æ„å»º AWS ç‰©è”ç½‘å’–å•¡ç›‘æ§å™¨çš„ç¬¬ 2 éƒ¨åˆ†ã€‚ç¬¬ 1 éƒ¨åˆ†å¯ä»¥åœ¨[è¿™é‡Œ](https://dev.to/rehanvdm/aws-iot-coffee-monitor-part-1-33ic)æ‰¾åˆ°

åœ¨ç¬¬ 1 éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•å°†ç‰©è”ç½‘æ•°æ®æ”¾å…¥äº‘ä¸­ã€‚æˆ‘ä»¬è¿æ¥äº†æˆ‘ä»¬çš„è®¾å¤‡ ESP32ï¼Œå¹¶æˆåŠŸåœ°å°†æˆ‘ä»¬ä¸€æ¯å’–å•¡çš„æ¸©åº¦å‘é€åˆ°äº‘ç«¯ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ•°æ®å­˜å‚¨åœ¨ DynamoDB ä¸­ï¼Œå†³å®šæˆ‘ä»¬çš„å’–å•¡å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Œå¦‚æœéœ€è¦ï¼Œå‘é€ç”µæŠ¥æ¨é€é€šçŸ¥ï¼Œå‘Šè¯‰æˆ‘ä»¬æŠ“ç´§æ—¶é—´ç»§ç»­å–(åœ¨å®ƒå˜å‡‰ä¹‹å‰å–æ‰å®ƒ)ã€‚è¿™æ˜¯æ¶æ„å›¾:

[![Architect Diagram](../Images/8693b35cd1848e624a14adb308fba128.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--BxPaDynz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.rehanvdm.com/contents/data/2019/04/post5_CoffeeMonitor-Original.jpg)

**å…ˆå†³æ¡ä»¶**:

*   ç†Ÿæ‚‰ AWS
*   åœ¨ä½ çš„æ‰‹æœºä¸Šå®‰è£…ç”µæŠ¥
*   å®‰è£…å¹¶é…ç½® AWS SDK
*   å®‰è£…äº† AWS SAM(è¿›ä¸€æ­¥æä¾›ç®€è¦è¯´æ˜)

# [](#a-telegram-bot-is-born)ç”µæŠ¥æœºå™¨äººè¯ç”Ÿäº†

åˆ›å»ºä¸€ä¸ªæ–°çš„ç”µæŠ¥æœºå™¨äººæ¯”ä½ æƒ³è±¡çš„è¦å®¹æ˜“å¾—å¤šã€‚æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œæœç´¢**æœºå™¨äººçˆ¶äº²**ï¼Œç„¶åè¾“å…¥*/æ–°æœºå™¨äºº*ï¼Œç»™ä½ çš„æœºå™¨äººèµ·ä¸ªåå­—ï¼Œç„¶åè¾“å…¥å”¯ä¸€çš„ç”¨æˆ·åã€‚ç„¶åä½ ä¼šæ”¶åˆ°ä¸€æ¡ç¥è´ºæ¶ˆæ¯ï¼Œç‚¹å‡»ç¬¬ä¸€ä¸ªé“¾æ¥å¼€å§‹ä¸ä½ çš„æœºå™¨äººèŠå¤©ï¼Œå†å¾€ä¸‹ä½ ä¼šå¾—åˆ°ä¸€ä¸ªæœºå™¨äººä»¤ç‰Œã€‚è¯·ä¿ç•™æ­¤ bot ä»¤ç‰Œçš„å‰¯æœ¬ï¼Œå› ä¸ºæˆ‘ä»¬ç¨åå°†ä½¿ç”¨å®ƒå‘æ­¤ bot å’Œæˆ‘ä»¬çš„èŠå¤©å‘é€æ¨é€é€šçŸ¥ã€‚

[![Bots](../Images/d15b4c8963bf76b0556dc01a29e9d0bb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--3tVPXzSq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/tymnkmeuw1f4xtwbaozl.png)

# [](#iac-and-sam)IaC å’Œ SAM

ä½œä¸ºä»£ç çš„åŸºç¡€è®¾æ–½ï¼Œè¿™ä¸ªæ¦‚å¿µåŒ…æ‹¬æè¿°å’Œæä¾›æ‚¨çš„ä»£ç å°†åœ¨å…¶ä¸­ç”Ÿå­˜çš„ç¯å¢ƒã€‚åœ¨è‡ªåŠ¨æ°”è±¡ç«™çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æè¿°æ˜¯äº‘å½¢æˆæ¨¡æ¿çš„æ ¼å¼ã€‚äº‘å½¢æˆ(CF)æ¨¡æ¿åªæ˜¯ä¸€ä¸ª YAML/JSON æ–‡æ¡£ï¼Œå®ƒæè¿°äº†æ‚¨çš„ä»£ç å°†ä½¿ç”¨çš„èµ„æºï¼Œç„¶åè¿™ä¸ªæ–‡ä»¶ä¸æ‚¨çš„ä»£ç ä¸€èµ·è¢«ç­¾å…¥ã€‚

è¿™äº› CF æ¨¡æ¿éšåè¢«éƒ¨ç½²å¹¶æˆä¸º CF æ ˆã€‚ä»¥è¿™ç§æ–¹å¼ç¼–å†™åº”ç”¨ç¨‹åºæœ‰å¾ˆå¤šå¥½å¤„ã€‚æœ‰äº›åŒ…æ‹¬ï¼Œä½ å¯ä»¥ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ï¼Œæ‘§æ¯åº”ç”¨ç¨‹åºå’Œå®ƒä½¿ç”¨çš„æ‰€æœ‰èµ„æºï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ä¸ä½¿ç”¨å®ƒçš„æ—¶å€™æ€æ­»å®ƒã€‚è¿™ä¸ª CF æ¨¡æ¿ä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨è®¸å¤šåœ°åŒºï¼Œå¹¶ä¸”å¯¹ CF æ ˆçš„æ›´æ–°å¯ä»¥åŒæ—¶å°†æ›´æ”¹éƒ¨ç½²åˆ°æ‰€æœ‰åœ°åŒºã€‚

ç”±äº CF æ¨¡æ¿ç¼–å†™èµ·æ¥å¾ˆç¹çï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ AWS **S** æ— æœåŠ¡å™¨ **A** åº”ç”¨ç¨‹åº **M** odelï¼ŒSAM çš„ç®€ç§°ã€‚SAM åªæ˜¯ä¸€ä¸ªé¢å¤–çš„æŠ½è±¡ï¼Œè®©æˆ‘ä»¬æ›´å®¹æ˜“ç¼–å†™ CF æ¨¡æ¿ï¼Œå‡å°‘ä»£ç /è¡Œæ•°ã€‚SAM æ¨¡æ¿è¢«è½¬æ¢ä¸º CF æ¨¡æ¿ï¼Œç„¶åä½œä¸º CF å †æ ˆè¿›è¡Œéƒ¨ç½²ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šå…³äºå±±å§†çš„ä¿¡æ¯ã€‚

å¦‚æœè¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡ä½¿ç”¨ SAMï¼Œä½ éœ€è¦æŒ‰ç…§è¯´æ˜å®‰è£…å®ƒ[è¿™é‡Œ](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html)ã€‚å¦‚æœä½ è·Ÿéšç„¶åä½ å°†ä¸å¾—ä¸åˆ›å»ºä¸€ä¸ª S3 æ¡¶ï¼Œå±±å§†å°†å­˜å‚¨å°è£…çš„ CF æ¨¡æ¿ï¼Œæˆ‘å‘½åä¸ºâ€œrehan-sam-packagesâ€ï¼Œç°åœ¨è¿™æ ·åšã€‚

æˆ‘ä»¬å°†åœ¨ template.yaml æ–‡ä»¶ä¸­å®šä¹‰æˆ‘ä»¬çš„èµ„æºå’Œç¯å¢ƒï¼Œç¨åä¼šè¯¦ç»†ä»‹ç»ã€‚

ç„¶åéœ€è¦ä¸‰ä¸ªå‘½ä»¤æ¥åœ¨ AWS ä¸Šéƒ¨ç½²å’Œè¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åº:

*   sam æ„å»º
*   å±±å§†Â·å¸•å…‹
*   sam éƒ¨ç½²

ç¨åå°†é€šè¿‡ä¼ é€’é¢å¤–çš„å‚æ•°(ä¸»è¦æ˜¯ç¯å¢ƒå˜é‡)æ¥ä½¿ç”¨å®ƒä»¬ã€‚

# CF æ¨¡æ¿

å®Œæ•´çš„ä»£ç å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/rehanvdm/CoffeeMonitor/blob/master/template.yaml)æ‰¾åˆ°ã€‚

ç¯å¢ƒé€‚åˆä¸åˆ° 150 è¡Œçš„ YAMLï¼Œå®ƒå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ã€‚è®©æˆ‘ä»¬åˆ†æä¸€ä¸‹æ–‡ä»¶ã€‚ç¬¬ä¸€éƒ¨åˆ†éœ€è¦å‘Šè¯‰ CF å¦‚ä½•æ­£ç¡®åœ°å°†è¿™ä¸ª SAM æ¨¡æ¿è½¬æ¢æˆ CF æ¨¡æ¿ã€‚

```
AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Coffee Monitor 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„å †æ ˆå®šä¹‰ç¯å¢ƒå‚æ•°ï¼Œå½“æˆ‘ä»¬æ„å»ºå’Œéƒ¨ç½²å®ƒæ—¶ï¼Œè¿™äº›å‚æ•°å°†è¢«ä¼ å…¥:

```
Parameters:
  AppName:
    Default: coffeemonitor
    Type: String
    Description: Name of app
  AppEnvironment:
    Type: String
    AllowedValues:
      - prod
    Description: Environment of this stack
  AppVersion:
      Type: String
      Description: Version of this stack in form of SemVer
  AppBuild:
      Type: String
      Description: Build number of this stack
  TelegramBotToken:
    Type: String
    Description: "The  bot  token  received  from  botfather  after  using  /newbot"
  TelegramBotChatId:
    Type: String
    Description: "Send:  chat  id?  to  the  bot,  fill  this  in  and  then  redeploy  the  stack"
  MaxTemp:
    Default: 50
    Type: String
    Description: The temperature which we use to determine that a coffee is at a good drinking temperature
  MinTemp:
      Default: 40
      Type: String
      Description: The temperature which we use to determine that a coffee is now cold 
```

å€¼å¾—æ³¨æ„çš„æ˜¯ *TelegramBotToken* å’Œ *TelegramBotChatId* ç¯å¢ƒå˜é‡ï¼Œåœ¨éƒ¨ç½²æ—¶æ‚¨éœ€è¦ç”¨è‡ªå·±çš„ç¯å¢ƒå˜é‡æ›¿æ¢å®ƒä»¬ã€‚å…¶ä»–å­—æ®µä»…ç”¨äºç‰ˆæœ¬æ§åˆ¶ã€‚MinTemp å’Œ MaxTemp æ˜¯ç”¨æ¥å®šä¹‰æˆ‘ä»¬æƒ³è¦çš„å’–å•¡çš„èŒƒå›´çš„å€¼ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œå–å’–å•¡çš„æœ€ä½³æ¸©åº¦æ˜¯ 40â„ƒåˆ° 50â„ƒ

> MinTemp å’Œ MaxTemp æ˜¯ç”¨æ¥å®šä¹‰æˆ‘ä»¬æƒ³è¦çš„å’–å•¡çš„èŒƒå›´çš„å€¼

ç„¶åæˆ‘ä»¬æœ‰ä¸€ä¸ªå…¨å±€å˜é‡éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¯´æ‰€æœ‰çš„å‡½æ•°éƒ½æœ‰è¿™äº›å€¼ï¼Œé™¤éå¦å¤–æŒ‡å®šã€‚

```
Globals:
    Function:
        Timeout: 12
        Environment:
          Variables:
            APPNAME: !Ref AppName
            ENVIRONMENT: !Ref AppEnvironment
            VERSION: !Ref AppVersion
            BUILD: !Ref AppBuild
        Tags:
            APPNAME: !Ref AppName
            ENVIRONMENT: !Ref AppEnvironment
            VERSION: !Ref AppVersion
            BUILD: !Ref AppBuild 
```

åœ¨ä¸‹é¢çš„å‚è€ƒèµ„æ–™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¼€å§‹ç”¨ Lambda å‡½æ•°å®šä¹‰æˆ‘ä»¬çš„ç¯å¢ƒï¼Œè¯¥å‡½æ•°å°†ç›‘å¬ç‰©è”ç½‘è®¾å¤‡ ESP32ã€‚

```
Resources:
    CoffeeMonitorLambda:
        DependsOn: TelegramSNSTopic
        Type: AWS::Serverless::Function
        Properties:
            FunctionName: !Join ['', ['coffee-monitor-', !Ref AppEnvironment]]
            Runtime: nodejs8.10
            CodeUri: lambdas/coffee-monitor/
            Handler: app.handler
            Policies:
              - DynamoDBCrudPolicy:
                  TableName: !Join ['', ['coffee-monitor-', !Ref AppEnvironment]]
              - SNSPublishMessagePolicy:
                  TopicName: !GetAtt TelegramSNSTopic.TopicName
            Environment:
              Variables:
                SNS_TOPIC_TELEGRAM: !Ref TelegramSNSTopic
                TEMP_MAX: !Ref MaxTemp
                TEMP_MIN: !Ref MinTemp
            Events:
              IoT:
                Type: IoTRule
                Properties:
                  Sql: "SELECT  *  FROM  'coffee-monitor/#'"
                  AwsIotSqlVersion: '2016-03-23' 
```

æˆ‘ä»¬æŒ‡å®šæˆ‘ä»¬çš„ Lambda å‡½æ•°ä½¿ç”¨ NodeJS ç‰ˆï¼Œå¹¶å‘Šè¯‰å®ƒä»£ç ä½äºå“ªä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚ç„¶åæˆ‘ä»¬å®šä¹‰ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥å…è®¸è®¿é—®å…¶ä»– AWS èµ„æºï¼Œæˆ‘ä»¬æŒ‡å®šè¿™ä¸ª lambda å¯ä»¥åœ¨åä¸º *coffee-monito-prod* çš„è¡¨ä¸Šæ‰§è¡Œ CRUDï¼Œå…¶ä¸­ prod æ˜¯å‚æ•°ä¸­ä¼ é€’çš„ç¯å¢ƒåç§°ã€‚æˆ‘ä»¬è¿˜æŒ‡å®šå…è®¸å‘æˆ‘ä»¬ç¨åå®šä¹‰çš„ TelegramSNS ä¸»é¢˜å‘é€æ¶ˆæ¯ã€‚

é‚£ä¹ˆè§¦å‘è¿™ä¸ªÎ»çš„äº‹ä»¶å°±æ˜¯ç‰©è”ç½‘è§„åˆ™ã€‚SQL ç”¨äºé€‰æ‹©å‘é€åˆ°è¿™ä¸ª lambda çš„æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬è¯´æ‰€æœ‰æ¥è‡ªæˆ‘ä»¬çš„ coffee-monitor è®¾å¤‡çš„æ•°æ®éƒ½å¿…é¡»å‘é€åˆ°è¿™ä¸ª Lambdaã€‚å¦‚æœæˆ‘ä»¬åªå¯¹ 1 ä¸ªè®¾å¤‡ä½ç½®æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬åº”è¯¥å°† from æ”¹ä¸º: *coffee-monitor/home/#*

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ DynamoDB è¡¨ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­å­˜å‚¨ NoSQL æ•°æ®ã€‚æˆ‘ä»¬å®šä¹‰äº†åˆ†åŒºé”®å’Œæ’åºé”®åˆ—ä»¥åŠ TTL åˆ—ã€‚è¿™æ˜¯ DynamoDB åˆ é™¤æ—§æ•°æ®çš„å†…éƒ¨æœºåˆ¶ï¼Œå¦‚æœæˆ‘ä»¬æä¾›ä¸€ä¸ªå¸¦æœ‰ *expiration_ts* timestamp å±æ€§çš„è¡Œï¼Œé‚£ä¹ˆ DynamoDB å°†åœ¨è¯¥æ—¶é—´åˆ°è¾¾æ—¶è‡ªåŠ¨åˆ é™¤å®ƒã€‚å¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œæ‰€æœ‰æ—¶é—´åºåˆ—æ•°æ®éƒ½æœ‰ 30 å¤©çš„åˆ°æœŸæ—¥ã€‚

```
DynamoDBControlTable:
  Type: AWS::DynamoDB::Table
  Properties:
    TableName: !Join ['', ['coffee-monitor-', !Ref AppEnvironment]]
    KeySchema:
      - AttributeName: "PK"
        KeyType: "HASH"
      - AttributeName: "SK"
        KeyType: "RANGE"
    AttributeDefinitions:
      - AttributeName: "PK"
        AttributeType: "S"
      - AttributeName: "SK"
        AttributeType: "S"
    TimeToLiveSpecification:
      AttributeName: expiration_ts
      Enabled: true
    BillingMode: PAY_PER_REQUEST 
```

è¿˜è¦æ³¨æ„ï¼Œæˆ‘ä»¬çš„ DynamoDB è¡¨è¢«è®¾ç½®ä¸ºæŒ‰è¯·æ±‚ä»˜è´¹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å®šä¹‰ç¬¬äºŒä¸ªÎ»å‡½æ•°ï¼Œç”µæŠ¥Î»ã€‚å®ƒå°†ç”±ä¸¤ä¸ªäº‹ä»¶è§¦å‘ã€‚ç¬¬ä¸€ä¸ªæ˜¯é€šè¿‡ APIï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„ bot è®¾ç½®å›è°ƒ URLï¼Œè¿™æ ·å½“æˆ‘ä»¬å›å¤å®ƒæ—¶ï¼ŒTelegram ä¼šå°†å›å¤å‘é€åˆ°æˆ‘ä»¬çš„ URLï¼ŒURL åˆä¼šå°†æ•°æ®å‘é€åˆ°è¿™ä¸ª Lambdaã€‚å½“å°† API è·¯å¾„å®šä¹‰ä¸º proxy å’Œ method any æ—¶ï¼Œæ‰€æœ‰åˆ°è¾¾è¯¥ç«¯ç‚¹çš„æ•°æ®éƒ½å°†è¢«å‘é€åˆ° Lambda å‡½æ•°ã€‚

ç¬¬äºŒä¸ªè§¦å‘äº‹ä»¶æ˜¯ SNS è¯é¢˜ã€‚æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª Lambda å‡½æ•°å°†å‘å¸ƒäº‹ä»¶æ¶ˆæ¯(æ¯”å¦‚ new coffee)åˆ° SNS ä¸»é¢˜ï¼Œè¿™ä¸ª Lambda ä¹Ÿè®¢é˜…äº†è¿™ä¸ªä¸»é¢˜ã€‚ç„¶åï¼Œå®ƒå°†æŒ‰åŸæ ·æ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ HTTPS å°†å…¶å‘é€åˆ° Telegramï¼Œä½œä¸ºæ¨é€é€šçŸ¥å‘é€ç»™æˆ‘ä»¬ã€‚

```
ApiLambdaFunction:
   Type: AWS::Serverless::Function
   Properties:
     FunctionName: !Join ['', ['coffee-monitor-telegram-api-bot-', !Ref AppEnvironment]]
     Runtime: nodejs8.10
     CodeUri: lambdas/telegram-bot/
     Handler: app.handler
     Environment:
       Variables:
         TELEGRAM_BOT_TOKEN: !Ref TelegramBotToken
         TELEGRAM_BOT_CHAT_ID: !Ref TelegramBotChatId
     Events:
       ReceiveAPIRequest:
         Type: Api
         Properties:
           Path: /{proxy+}
           Method: ANY
           RestApiId: !Ref CoffeeMonitorApi
       SendSNSEvent:
           Type: SNS
           Properties:
             Topic: !Ref TelegramSNSTopic 
```

æˆ‘ä»¬è¿˜å‘è¯¥å‡½æ•°ä¼ é€’å‘é€æ¨é€é€šçŸ¥æ‰€éœ€çš„é¢å¤–ç¯å¢ƒå˜é‡ã€‚æœ€åçš„èµ„æºæ˜¯ API ç½‘å…³å’Œè´¯ç©¿å…¨æ–‡çš„ SNS ä¸»é¢˜ã€‚

```
CoffeeMonitorApi:
  Type: AWS::Serverless::Api
  Properties:
    Name: !Join ['', ['coffee-monitor-api-', !Ref AppEnvironment]]
    StageName: !Ref AppEnvironment

TelegramSNSTopic:
  Type: 'AWS::SNS::Topic'
  Properties:
    DisplayName: !Join ['', ['coffee-monitor-telegram-bot-', !Ref AppEnvironment]]

Lastly we define the Output section, which CF will produce when the Stack is deployed. It is usefull information that we can use.

Outputs:
    ApiURL:
      Description: "API  Gateway  endpoint  URL"
      Value: !Sub "https://${CoffeeMonitorApi}.execute-api.${AWS::Region}.amazonaws.com/${AppEnvironment}/"
    RegisterTelegramBot:
      Description: "Navigate  to  the  URL  below  to  let  your  bot  push  to  your  API  Endpoint"
      Value: !Sub "https://api.telegram.org/bot${TelegramBotToken}/setWebHook?url=https://${CoffeeMonitorApi}.execute-api.${AWS::Region}.amazonaws.com/${AppEnvironment}/bot_callback"
    TelegramSNSTopic:
      Description: "TelegramSNSTopic  ARN"
      Value: !Ref TelegramSNSTopic 
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†è¾“å‡º API URLï¼Œä¸€ä¸ªé“¾æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å•å‡»è¯¥é“¾æ¥å°†è¿™ä¸ª API ç½‘å…³ URL æ³¨å†Œä¸ºæˆ‘ä»¬çš„ bot çš„å›è°ƒ(å…³äºè¿™ä¸€ç‚¹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…éƒ¨ç½²éƒ¨åˆ†),ç„¶åæ˜¯ SNS ä¸»é¢˜ã€‚

å°±æ˜¯è¿™æ ·ï¼Œè¿™å‡ è¡Œå®Œæ•´çš„æè¿°äº†æˆ‘ä»¬çš„æ¶æ„å›¾èµ„æºã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹çœ‹é‡è¦çš„ä»£ç ï¼Œç„¶åæ˜¯éƒ¨ç½²è¿‡ç¨‹ã€‚

# [](#lambda-code-coffee-monitor-iot)Lambda ç â€“å’–å•¡ç›‘æ§å™¨ç‰©è”ç½‘

å®Œæ•´çš„ä»£ç å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/rehanvdm/CoffeeMonitor/tree/master/lambdas/coffee-monitor)æ‰¾åˆ°

é¦–å…ˆï¼Œæ‰€æœ‰çš„ Lambda ä»£ç éƒ½åŒ…è£…åœ¨ä¸€ä¸ª try-catch ä¸­ï¼Œæœ€åï¼Œå®ƒè‡ªå§‹è‡³ç»ˆä½¿ç”¨ ES6 å’Œæœ¬æœºæ‰¿è¯ºã€‚æˆ‘ä»¬æ‰“å¼€ä¼ å…¥çš„ AWS ç‰©è”ç½‘æ ¸å¿ƒäº‹ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªæœ‰ 2 ä¸ªäº‹ä»¶ï¼Œå³æ¸©åº¦å’ŒæŒ‰é’®ç‚¹å‡»ã€‚å¼€å…³ä¸ºæ¯ä¸€ä¸ªåšé€‚å½“çš„ä»£ç å—ï¼Œå¦‚æœæ˜¯æŒ‰é’®ç‚¹å‡»ï¼Œé‚£ä¹ˆå®ƒæ’å…¥ä¸€ä¸ªè®°å½•åˆ° Dynamo DBï¼Œå¹¶é€šçŸ¥æˆ‘ä»¬çš„ SNS ä¸»é¢˜ã€‚

```
module.exports.handler = async (event, context) =>
 {
     let response = null;
     try
     {
         let dtNow = moment().toISOString();
         switch (event.event_type)
         {
             case "button_click":
                 console.log("BUTTON 0 was pressed", event.click_no);
                 let expiration_ts_30_days = (Math.round(Date.now() / 1000) + (60 * 60 * 24 * 30));
                 await db_event.Insert(DynmaoDB_Events.EVENTS.BUTTON_CLICK, dtNow, event.click_no, expiration_ts_30_days);
                 await SendSNSNotification("Button Clicked: " +  event.click_no);
                 break;

             case "temp":
                 console.log("TEMP is", event.value);
                 await TempChange(event, dtNow);
                 break;

             default:
                 console.log(event);
                 break;
         }
         response = true;
     }
     catch (err)
     {
         console.error(err);
         response = false;
     }
     finally
     {
         //console.log("* Response: " + response)
         return response;
     }
 }; 
```

å¦‚æœæ˜¯æ¸©åº¦äº‹ä»¶ï¼Œå®ƒå°†è¿›å…¥*æ¸©åº¦å˜åŒ–*åŠŸèƒ½ã€‚ä½¿ç”¨ç¯å¢ƒå˜é‡ä¼ å…¥æœ€å°å’Œæœ€å¤§æ¸©åº¦å€¼ï¼Œç„¶åæˆ‘ä»¬å¾—åˆ°å’–å•¡çš„å½“å‰çŠ¶æ€ï¼Œæœ€åçš„æ¸©åº¦å€¼ï¼Œæˆ‘ä»¬ä¹Ÿä¿å­˜å½“å‰çš„æ¸©åº¦å€¼ã€‚ä»¥ä¸Š 3 ä¸ªæ“ä½œéƒ½æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ã€‚æˆ‘ä»¬è¿˜å¤„ç†ä¸€äº›è¾¹ç¼˜æƒ…å†µï¼Œæ¯”å¦‚æ²¡æœ‰å…ˆå‰çš„çŠ¶æ€æˆ–æ¸©åº¦ï¼Œè¡¨æ˜è¡¨æ˜¯ç©ºçš„ã€‚

ç„¶åæˆ‘ä»¬åˆ°äº†æœ‰è¶£çš„éƒ¨åˆ†ï¼ŒçŠ¶æ€æœºå†³å®šä½•æ—¶è§¦å‘ä¸€ä¸ªå˜æ›´äº‹ä»¶ã€‚ä»¥ä¸‹æ¡ä»¶ä¼šè§¦å‘è¿™äº›çŠ¶æ€:

*   **æ–°å’–å•¡**:å¦‚æœå½“å‰æ¸©åº¦ä¸ä¹‹å‰æ¸©åº¦ç›¸å·®è¶…è¿‡ 5 åº¦ï¼Œä¸”çŠ¶æ€ä¸ºæ— å’–å•¡æˆ–å’–å•¡å˜å†·ï¼Œåˆ™è½¬æ¢
*   **å¥½å’–å•¡**:å¦‚æœæ¸©åº¦å·®å˜ä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºæ­£åœ¨å†·å´ï¼Œå¦‚æœæ¸©åº¦ä»‹äºæœ€å°å€¼å’Œæœ€å¤§å€¼ä¹‹é—´ï¼Œä¸”å¤„äº NEW_COFFEE çŠ¶æ€ï¼Œåˆ™è½¬æ¢ã€‚
*   **å˜å†·**:æ¸©åº¦ä½äºæœ€å°æ¸©åº¦ä¸”å¤„äºè‰¯å¥½æ¸©åº¦çŠ¶æ€æ—¶è½¬æ¢ã€‚

è¿™äº›çŠ¶æ€å˜åŒ–ä¸­çš„æ¯ä¸€ä¸ªéƒ½å‘ SNS ç”µæŠ¥ä¸»é¢˜å‘é€æ¶ˆæ¯ï¼Œå¹¶å¹¶è¡Œä¿å­˜å½“å‰çŠ¶æ€ã€‚

```
async function TempChange(event, dtNow)
{
    let minTemp = process.env.TEMP_MIN;
    let maxTemp = process.env.TEMP_MAX;
    let temp = event.value;

    let expiration_ts_30_days = (Math.round(Date.now() / 1000) + (60 * 60 * 24 * 30));

    /* PARALLEL: Get Current State, Last Temperature and save Current Temperature */
    let [pState, pLastTemp, pSaveTemp] = [db_State.GetCurrentState(),
                                            db_event.GetLastTempValue(),
                                            db_event.Insert(DynmaoDB_Events.EVENTS.TEMP, dtNow, temp, expiration_ts_30_days)];
    let currentState = await pState;
    let prevTemp = await pLastTemp;
    await pSaveTemp;

    /* If no prev state, then means clean table, just insert a No Coffee state so that checking logic not fail */
    if(!currentState)
        await db_State.Insert(DynmaoDB_State.STATES.NO_COFFEE, dtNow, temp, expiration_ts_30_days);

    /* If no prev temp then return, need at least one value to make decision */
    if(!prevTemp)
        return;

    let tempDifFromPrev = (temp - prevTemp.Value);

    /* First state is special, it looks at the Prev value and then starts the StateMachine */
    if( tempDifFromPrev > 5
        && (currentState.StateValue === DynmaoDB_State.STATES.NO_COFFEE || currentState.StateValue === DynmaoDB_State.STATES.GETTING_COLD))
    {
        /* NEW COFFEE */
        console.log("** NEW COFFEE");
        let pNotify = SendSNSNotification("Coffee: â˜• NEW, temp: " + temp + " Â°C");
        let pNewState = db_State.Insert(DynmaoDB_State.STATES.NEW_COFFEE, dtNow, temp, expiration_ts_30_days);

        await pNotify;
        await pNewState;
    }
    else if( (tempDifFromPrev < 0)  /* Only if getting colder then check this */
        && temp > minTemp && temp <= maxTemp
        && currentState.StateValue === DynmaoDB_State.STATES.NEW_COFFEE)
    {
        /* DRINK IT NOW, GOOD COFFEE */
        console.log("** DRINK IT NOW, GOOD COFFEE");
        let pNotify = SendSNSNotification("Coffee: ğŸ‘ GOOD, temp: " + temp + " Â°C");
        let pNewState = db_State.Insert(DynmaoDB_State.STATES.GOOD_TEMP, dtNow, temp, expiration_ts_30_days);

        await pNotify;
        await pNewState;
    }
    else if(temp <= minTemp
        && currentState.StateValue === DynmaoDB_State.STATES.GOOD_TEMP)
    {
        /* GETTING COLD FAST, DRINK */
        console.log("** GETTING COLD FAST, DRINK");
        let pNotify = SendSNSNotification("Coffee: ğŸ‘ COLD, temp: " + temp + " Â°C");
        let pNewState = db_State.Insert(DynmaoDB_State.STATES.GETTING_COLD, dtNow, temp, expiration_ts_30_days);

        await pNotify;
        await pNewState;
    }
} 
```

# Î»ç -API&SNS ç”µæŠ¥

å®Œæ•´çš„ä»£ç å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/rehanvdm/CoffeeMonitor/tree/master/lambdas/telegram-bot)æ‰¾åˆ°

ä¸ç¬¬ä¸€ä¸ª Lambda éå¸¸ç›¸ä¼¼ï¼Œæˆ‘ä»¬æœ‰ try-catch-finallyï¼Œç„¶åæˆ‘ä»¬æ ¹æ®ä¼ å…¥çš„æ•°æ®å†³å®šé‡‡å–ä»€ä¹ˆè¡ŒåŠ¨ã€‚å¦‚æœæ˜¯æ¥è‡ª API å’Œ/bot_callback è·¯å¾„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰§è¡Œ *ReceiveNotification* å‡½æ•°ï¼Œå¦‚æœæ˜¯å…¶ä»–è·¯å¾„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€å›å¤ä¸€ä¸ª HTTP çŠ¶æ€ä»£ç  200ã€‚å¦åˆ™ï¼Œå¦‚æœå®ƒæ¥è‡ªä¸»é¢˜ä¸º *SendNotification* çš„ SNS ä¸»é¢˜ï¼Œæˆ‘ä»¬å°†æ‰§è¡Œ *SendNotification* åŠŸèƒ½ã€‚

```
module.exports.handler = async (event, context) =>
{
    console.log(JSON.stringify(event));
    let response = null;

    try
    {
        if(event.resource === '/{proxy+}' && event.path === '/bot_callback') /* If receiving HTTP Request from Telegram callback */
            response = await ReceiveNotification(event);
        else if(event.resource === '/{proxy+}')  /* If receiving Any other HTTP Requests, just reply with default 200 */
            response =  { statusCode: 200, body: 'Thank you' };
        else if(event.Records && event.Records[0].Sns && event.Records[0].Sns.Subject === "SendNotification" )  /* If came from SNS topic */
            response = await SendNotification(event.Records[0].Sns.Message);

        return response;
    }
    catch (err)
    {
        console.error(err);
        response = false;
    }
    finally
    {
        console.log("* Response: " + response)
        return response;
    }
}; 
```

ReceiveNotification æœ‰ç‚¹æœ‰è¶£ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬å¦‚ä½•å¯¹æœºå™¨äººçš„â€œæ™ºèƒ½â€è¿›è¡Œç¼–ç¨‹çš„ã€‚å¦‚æœæˆ‘ä»¬å‘é€æ–‡å­—:**èŠå¤© idï¼Ÿ**å¯¹äºæˆ‘ä»¬çš„æœºå™¨äººï¼Œå®ƒå°†å“åº”å½“å‰çš„èŠå¤© idï¼Œè¿™æ˜¯æˆ‘ä»¬ç¨ååœ¨éƒ¨ç½²æ­¥éª¤ä¸­éœ€è¦çš„ã€‚æˆ‘ä»¬è¿˜æœ‰å¦ä¸€ä¸ªåŠ¨ä½œï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥ **Ping** ï¼Œå®ƒä¼šç”¨ Pong å›åº”ï¼Œå…¶ä»–çš„å®ƒéƒ½ä¸ç†è§£ã€‚æˆ‘ä»¬æ€»æ˜¯å‘ç”µæŠ¥ API è¿”å› 200ã€‚

```
async function ReceiveNotification(event)
{
    console.log(JSON.parse(event.body));

    let message = JSON.parse(event.body);

    let bot = new TelegramBot(process.env.TELEGRAM_BOT_TOKEN);
    switch (message.message.text.toLowerCase())
    {
        case "chat id?":
            await bot.Send("Your chat id is: "+message.message.from.id, message.message.from.id);
            break;

        case "ping":
            await bot.Send("Pong", process.env.TELEGRAM_BOT_CHAT_ID); //message.message.from.id);
            break;

        default:
            await bot.Send("Sorry, I don't understand that", process.env.TELEGRAM_BOT_CHAT_ID); //message.message.from.id);
            break;
    }

    return {
        statusCode: 200,
        body: 'Thank you'
    };
} 
```

æœ€åæ˜¯ *SendNotification* å‡½æ•°ï¼Œå®ƒç®€å•åœ°è·å– SNS æ¶ˆæ¯ï¼Œå¹¶æŒ‰åŸæ ·å‘é€ç»™ç”±æˆ‘ä»¬çš„ bot ä»¤ç‰Œå’ŒèŠå¤© id æ ‡è¯†çš„æˆ‘ä»¬ã€‚

```
async function SendNotification(event)
{
    let body = JSON.parse(event);
    let bot = new TelegramBot(process.env.TELEGRAM_BOT_TOKEN);
    await bot.Send(body.message, process.env.TELEGRAM_BOT_CHAT_ID);
    return true;
} 
```

# [](#data-storage)æ•°æ®å­˜å‚¨

æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªé‡è½½çš„ DynamoDB è¡¨ä¸­ã€‚åœ¨*åˆ†åŒºé”®*ä¸­ï¼Œæˆ‘ä»¬å­˜å‚¨æˆ‘ä»¬æ­£åœ¨å­˜å‚¨çš„è®°å½•ç±»å‹çš„åç§°ï¼Œç„¶å*æ’åºé”®*è¢«ç”¨ä½œè¯¥è®°å½•çš„æ ‡è¯†ç¬¦ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œæ¯æ¬¡æˆ‘ä»¬å†™æ¸©åº¦äº‹ä»¶ï¼Œæˆ‘ä»¬å†™ 2 ä¸ªè®°å½•ï¼Œä¸€ä¸ªæ˜¯é‚£ä¸ªæ—¥æœŸæ—¶é—´ï¼Œç„¶åæˆ‘ä»¬ä¹Ÿæ”¾å…¥/æ›´æ–°å½“å‰çŠ¶æ€ã€‚

[![dynamodb table](../Images/0715af9cd340f17a26275c3ec9c0ae84.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--AQi843DC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.rehanvdm.com/contents/data/2019/04/post5_dynamo_1.png)

è¿™æ ·ï¼Œæˆ‘ä»¬å°±æœ‰äº†æ‰€æœ‰æ¸©åº¦å˜åŒ–çš„å†å²è®°å½•ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥åœ¨ä¸çŸ¥é“è®°å½•çš„æœ€åæ—¥æœŸæ—¶é—´å€¼çš„æƒ…å†µä¸‹å¯¹å½“å‰æ¸©åº¦è®°å½•è¿›è¡Œå•æ¬¡æŸ¥æ‰¾ã€‚è¿™ä½¿æˆ‘ä»¬ä¸å¿…åšè¿‡äºå¤æ‚çš„åº”ç”¨ç¨‹åºé€»è¾‘æˆ–æ˜‚è´µçš„è¡¨æ‰«æã€‚

æ³¨æ„ï¼Œç›¸åŒçš„æ¨¡å¼ç”¨äºçŠ¶æ€è½¬æ¢ï¼Œå†å²è®°å½•å’Œå½“å‰è®°å½•éƒ½è¢«å†™å…¥ã€‚ä¸‹é¢æ˜¯è¿è¡Œæ¨¡æ‹Ÿå’–å•¡çš„é›†æˆæµ‹è¯•åï¼Œè¡¨ä¸­çš„çŠ¶æ€çœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·å­ã€‚

[![dynamodb table 2](../Images/277f0098d5f584cedd0760823164e16e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--OmjB3-FI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.rehanvdm.com/contents/data/2019/04/post5_dynamo_2.png)

[![dynamodb table 3](../Images/8e684d1738f345b55bb919dfd2b49e05.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--cbVWu1zU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.rehanvdm.com/contents/data/2019/04/post5_telegram_4.png) 
**æ‰‹æœºä¸Šæ”¶åˆ°çš„ç”µæŠ¥æ¨é€é€šçŸ¥ã€‚**

# [](#deploying)æ­£åœ¨éƒ¨ç½²

ä¸ºäº†æ‰“åŒ…å’Œéƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‰é¢æåˆ°çš„ SAM cliã€‚é‡å¤åŒæ ·é•¿çš„å‘½ä»¤è¡Œæ˜¯ä¹å‘³çš„ï¼Œæ‰€ä»¥ç”±äºè¿™æ˜¯ä¸€ä¸ªèŠ‚ç‚¹é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ npm è„šæœ¬ä½¿æˆ‘ä»¬çš„ç”Ÿæ´»æ›´è½»æ¾ã€‚è¿™äº›åœ¨ package.json ä¸­å®šä¹‰å¦‚ä¸‹:

[![scripts](../Images/959a991185b4531966cb8619fa93668c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--czYewREa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.rehanvdm.com/contents/data/2019/04/post5_deploy_1.png)

å¦‚æœæˆ‘ä»¬ cd åˆ°é¡¹ç›®æ ¹ç›®å½•å¹¶è¿è¡Œå‘½ä»¤: **npm run sam_deploy** å®ƒå°†ä½¿ç”¨ sam å‘½ä»¤æ‰§è¡Œä¸Šé¢çš„ 3 ä¸ªè„šæœ¬ï¼Œä»¥æ„å»ºã€æ‰“åŒ…å’Œéƒ¨ç½²åº”ç”¨ç¨‹åºåˆ° CloudFront ä½œä¸ºä¸€ä¸ªå †æ ˆã€‚è“è‰²éƒ¨åˆ†åªæ˜¯æˆ‘ä»¬ä¼ é€’ç»™ SAM æ¨¡æ¿ä¸­å‚æ•°éƒ¨åˆ†çš„ç¯å¢ƒå˜é‡ã€‚å¦‚æœæ‚¨æ­£åœ¨è·Ÿè¿›ï¼Œè¿™å°†æ˜¯æ‚¨åœ¨éƒ¨ç½²å †æ ˆä¹‹å‰æ’å…¥ bot ä»¤ç‰Œå’ŒèŠå¤© id çš„åœ°æ–¹ã€‚

è¦æˆåŠŸéƒ¨ç½²ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºéµå¾ªè¯´æ˜:

*   ä½¿ç”¨ç”µæŠ¥æœºå™¨äººçˆ¶äº²è·å¾—ä¸€ä¸ªæ–°çš„æœºå™¨äººå’Œæœºå™¨äººä»¤ç‰Œ
*   åœ¨ä¸Šé¢çš„ package.json æ–‡ä»¶ä¸­ï¼Œåªåœ¨ä¼ é€’ç»™æˆ‘ä»¬çš„å †æ ˆçš„ç¯å¢ƒå˜é‡ä¸­å¡«å…… *TelegramBotToken* å€¼ã€‚
*   ç„¶åï¼Œå½“æ ˆè¢«éƒ¨ç½²æ—¶ï¼Œè½¬åˆ° AWS æ§åˆ¶å°ï¼Œäº‘å½¢æˆï¼Œç‚¹å‡»æ ˆå¹¶æŸ¥çœ‹è¾“å‡ºã€‚å°†ä¼šæœ‰ä¸€ä¸ªåä¸º *RegisterTelegramBot* çš„è¾“å‡ºï¼Œå•å‡»å®ƒï¼Œå®ƒå°†æ³¨å†Œæˆ‘ä»¬çš„æ–° API ç«¯ç‚¹ï¼Œä»¥æ¥æ”¶å‘é€ç»™æˆ‘ä»¬çš„ Bot çš„æ‰€æœ‰æ¶ˆæ¯ã€‚ç„¶å API ä¼šå°†è¿™äº›æ¶ˆæ¯è½¬å‘ç»™æˆ‘ä»¬çš„ Lambdaã€‚
*   è¦æ‰¾åˆ°èŠå¤© idï¼Œå‘æœºå™¨äººå‘é€ä»¥ä¸‹æ¶ˆæ¯:**èŠå¤© idï¼Ÿ**å®ƒä¼šå›å¤ä½ çš„èŠå¤© idã€‚
*   å†æ¬¡æ‰“å¼€ package.json æ–‡ä»¶ï¼Œå¹¶åœ¨ç¯å¢ƒå˜é‡ä¸­å¡«å…… *TelegramBotChatId* ã€‚é‡æ–°éƒ¨ç½²å †æ ˆï¼Œç„¶åå°±å®Œæˆäº†ã€‚æ¥æ”¶å®æ—¶æ¸©åº¦å€¼çš„ Lambda å‡½æ•°ç°åœ¨å¯ä»¥æˆåŠŸåœ°å‘æ‚¨çš„æœºå™¨äººå’ŒèŠå¤©å‘é€æ¶ˆæ¯ã€‚

[![cf outputs](../Images/44cec349cb4f1c04dc57960d46028dcf.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zL0l05JV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.rehanvdm.com/contents/data/2019/04/post5_deploy_2.png)

# [](#testing)æµ‹è¯•

ç¼–å†™äº†ä¸€äº›åŸºæœ¬çš„æµ‹è¯•æ¥æ¨¡æ‹Ÿè§¦å‘æˆ‘ä»¬çš„ Lambda å‡½æ•°çš„äº‹ä»¶ï¼Œå®ƒä»¬å¯ä»¥åœ¨è¿™é‡Œ[æŸ¥çœ‹](https://github.com/rehanvdm/CoffeeMonitor/tree/master/lambdas/tests)ã€‚ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­æ˜¯ï¼Œæˆ‘ä»¬åšäº†ä¸€ä¸ªé›†æˆæµ‹è¯•æ¥æµ‹è¯•ä¸€ç³»åˆ—æ¸©åº¦å€¼ï¼Œå› ä¸ºå®ƒä»¬è¢«å‘é€åˆ°æˆ‘ä»¬çš„å’–å•¡ç›‘æ§å™¨ Lambdaã€‚ä¸‹é¢æ˜¯æµ‹è¯•çš„ä¸€ä¸ªç‰‡æ®µ

# [](#conclusion)ç»“è®º

è¿™æ˜¯ä¸€ä¸ªç”± AWSã€serverless å’Œ IaC æ”¯æŒçš„æœ‰è¶£çš„å°å‘¨æœ«é¡¹ç›®(è™½ç„¶å†™è¿™ç¯‡æ–‡ç« å¯èƒ½æ¯”è¿™ä¸ªé¡¹ç›®èŠ±çš„æ—¶é—´è¦é•¿)ã€‚ç°åœ¨æˆ‘åªéœ€è¦æ›´åŠ å…³æ³¨æ”¶åˆ°çš„é€šçŸ¥(æ²¡æœ‰è§£å†³åŠæ³•),å¸Œæœ›æˆ‘ä¸å†éœ€è¦å†·å’–å•¡ğŸ™‚

*è¿™æ˜¯æ„å»º AWS ç‰©è”ç½‘å’–å•¡ç›‘æ§å™¨çš„ç¬¬ 2 éƒ¨åˆ†ï¼Œå…± 2 éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°*