# Node JS ä¸­çš„å¹¶å‘æ˜¯ä»€ä¹ˆï¼Ÿ

> åŸæ–‡:[https://dev . to/neutrino 2211/what-is-concurrency-in-node-js-3lgo](https://dev.to/neutrino2211/what-is-concurrency-in-node-js-3lgo)

Javascript æ˜¯ä¸€ç§å•çº¿ç¨‹è¯­è¨€ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½éå¸¸æœ‰é™ï¼Œå› ä¸ºè¿›ç¨‹è¢«å¡åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œæ— æ³•å……åˆ†åˆ©ç”¨å®ƒæ‰€è¿è¡Œçš„ CPUï¼Œä½†ç”±äºå¹¶å‘æ€§ï¼Œå®ƒçš„å•çº¿ç¨‹æœ¬è´¨ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚

***ä½†æ˜¯ç­‰ç­‰ï¼Œä»€ä¹ˆå«å¹¶å‘ï¼ï¼Ÿ*T3ã€‘**

æˆ‘å¾ˆé«˜å…´ä½ é—®äº†(*å³ä½¿ä½ æ²¡æœ‰é—®ï¼Œä¹Ÿè¦å‡è£…ä½ é—®äº†ï¼Œæˆ‘ä»¬å°†ç»§ç»­è®¨è®º*ğŸ˜‰)

### [](#basics)åŸºç¡€çŸ¥è¯†

å¹¶å‘æ„å‘³ç€ä¸¤ä¸ªæˆ–æ›´å¤šçš„è¿›ç¨‹åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä¸€èµ·è¿è¡Œï¼Œä½†ä¸æ˜¯åŒæ—¶è¿è¡Œï¼Œæˆ‘ä»¬å¾ˆå¤šäººåœ¨ Node JS ä¸­é‡åˆ°è¿‡å¹¶å‘ï¼Œä½†å¯èƒ½æ²¡æœ‰æ³¨æ„åˆ°å®ƒ( *Prime example = me* ğŸ˜…).

ç¤ºä¾‹:

ä½ å¯ä»¥è¿è¡Œè¿™æ®µä»£ç ï¼ï¼

`const fs = require('fs'); fs.writeFile('./file.txt', 'Hello World!!', function(){ console.log('Wrote "Hello World!!" into file.txt'); }); console.log('Writing "Hello World!!" into file.txt');`

ä¸Šä¾‹ä¸­çš„ä»£ç å¯¹æˆ‘ä»¬å¤§å¤šæ•°äººæ¥è¯´ä¸€å®šå¾ˆç†Ÿæ‚‰ï¼Œä½†æ˜¯æ‚¨çŸ¥é“è¿™æ˜¯å¹¶å‘æ€§çš„ä¸€ä¸ªä¸»è¦ä¾‹å­å—ï¼Ÿã€‚æˆ‘ä»¬éƒ½åŒæ„ç¬¬ 7 è¡Œåœ¨ç¬¬ 5 è¡Œä¹‹å‰æ‰§è¡Œï¼Œå¯¹å§ï¼Œ**è¿™å°±æ˜¯å¹¶å‘ï¼**ï¼Œå¤šä¸ªç‹¬ç«‹çš„è¿›ç¨‹åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼Œè½®æµæ‰§è¡Œä»£ç ã€‚

è¿™äº›æ˜¯æ‰§è¡Œè¿‡ç¨‹ä¸­é‡‡å–çš„æ­¥éª¤ã€‚

*   fs.writeFile è°ƒç”¨ä¸€ä¸ªåº•å±‚å‡½æ•°ï¼Œè¯¥å‡½æ•°å……å½“ JS å’Œ C++ä¹‹é—´çš„ä»£ç†

*   è¯¥å‡½æ•°è°ƒç”¨ C++ä»£ç ï¼Œè¯¥ä»£ç åœ¨äº‹ä»¶å¾ªç¯ä¸Šåˆ›å»ºä¸€ä¸ªå¤„ç†å†™æ“ä½œçš„è¿›ç¨‹

*   console.log('ç¼–å†™â€œHello Worldï¼!"into file . txtâ€™)

*   è¯¥è¿‡ç¨‹å°†å†…å®¹å†™å…¥`file.txt`

*   æµç¨‹è¿”å›ï¼Œæˆ‘ä»¬çš„å›è°ƒè¢«æ‰§è¡Œ

*   console.log('å†™äº†â€œHello Worldï¼!"into file . txtâ€™)

è¿™å¾ˆå¥½ï¼Œä½†æ˜¯ç”¨å¹¶å‘è¡Œä¸ºç¼–å†™ä»£ç æœ‰ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œå®ƒè¢«äº²åˆ‡åœ°ç§°ä¸º**â€œå›è°ƒåœ°ç‹±â€**

ç¤ºä¾‹:

å†™ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åä»ä¸­è¯»å–ã€‚

`const fs = require('fs'); fs.writeFile('./file.txt', 'Hello World!!', function(){ console.log('Wrote "Hello World!!" into file.txt'); fs.readFile('./file.txt', function(err, data){ if(err){ throw new Error(err); } console.log('Read "', data.toString(), '" from ./file.txt') }) }); console.log('Writing "Hello World!!" into file.txt');`

ä½ è¶Šéœ€è¦ä½¿ç”¨è¿™æ ·ä¸€ä¸ªå‡½æ•°æä¾›çš„æ•°æ®ï¼Œæƒ…å†µå°±è¶Šç³Ÿç³•ï¼Œä½†æ˜¯å½“ä½ ä½¿ç”¨**æ‰¿è¯º**æ—¶ï¼Œæ•´ä¸ªç—›è‹¦å°±å¯ä»¥é¿å…ã€‚

### [](#promises)æ‰¿è¯º

æ‰¿è¯ºæ˜¯ javascript ç»“æ„ï¼Œå®ƒâ€œæ‰¿è¯ºâ€å¼‚æ­¥ä»£ç çš„è§£å†³/å¤±è´¥ï¼Œå¹¶å¸®åŠ©æˆ‘ä»¬ä»¥ä¸€ç§**è¯­æ³•ä¸Š**åŒæ­¥çš„æ–¹å¼å¤„ç†å®ƒä»¬çš„æˆåŠŸ/å¤±è´¥ã€‚

ç¤ºä¾‹:

`const fs = require('fs'); const readPromise = function(){ return new Promise(function(resolve, reject){ fs.readFile('./file.txt', function(err, data){ if(err){ reject(err); } resolve(data); }) }); } const writePromise = function(){ return new Promise(function(resolve, reject){ fs.writeFile('./file.txt', 'Hello world!!', function(err){ if(err){ reject(err); } resolve(); }) }); } writePromise() .then(() => { return readPromise() }) .then(data => console.log(data.toString())) .catch(err => console.log(err));`

ä¸Šé¢çš„ä»£ç çœ‹èµ·æ¥å¹¶æ²¡æœ‰å¥½åˆ°å“ªé‡Œå»ï¼Œä½†æ˜¯éšç€æ‰¿è¯ºè€Œæ¥çš„è¿˜æœ‰ async/await å…³é”®å­—ï¼Œè¿™å¯¹æ¸…ç†æˆ‘ä»¬çš„ä»£ç éå¸¸æœ‰å¸®åŠ©ã€‚

`await`å…³é”®å­—å¸®åŠ©æˆ‘ä»¬æ£€ç´¢ç”± promise è§£æçš„æ•°æ®ï¼Œå°±å¥½åƒå®ƒæ˜¯ä»åŒæ­¥å‡½æ•°ç›´æ¥è¿”å›çš„ä¸€æ ·ï¼Œä½†æ˜¯`await`åªåœ¨å¼‚æ­¥å‡½æ•°ä¸­å·¥ä½œï¼Œè¿™å°±æ˜¯`async`å…³é”®å­—çš„ç”¨æ­¦ä¹‹åœ°ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬å®šä¹‰å¯ä»¥ä½¿ç”¨`await`çš„å¼‚æ­¥å‡½æ•°ã€‚

ç¤ºä¾‹:

`const fs = require('fs'); const readPromise = function(){ return new Promise(function(resolve, reject){ fs.readFile('./file.txt', function(err, data){ if(err){ reject(err); } resolve(data); }) }); } const writePromise = function(){ return new Promise(function(resolve, reject){ fs.writeFile('./file.txt', 'Hello world!!', function(err){ if(err){ reject(err); } resolve(); }) }); } async function start(){ await writePromise(); // data returned as if it were from a synchronous function const data = await readPromise(); console.log(data.toString()); }; start()`

è¿™å°±æ˜¯å¹²å‡€çš„å¼‚æ­¥ä»£ç ï¼ï¼

### [](#taking-it-further)æ›´è¿›ä¸€æ­¥

æ—¢ç„¶æˆ‘ä»¬å¯ä»¥åˆ›é€ æ‰¿è¯ºå¹¶å®ç°å®ƒä»¬ï¼Œæˆ‘ä»¬å°±ä¸å†éœ€è¦ä½¿ç”¨å›è°ƒã€‚è¿™é‡Œæœ‰ä¸€äº›ä¸€èˆ¬çš„ä¾‹å­ã€‚

**æ³¨æ„:Node JS ä¸­çš„é»˜è®¤åº“ä¸å¤ªæ”¯æŒæ‰¿è¯ºï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ¥å®ç°å¼‚æ­¥ç¤ºä¾‹**

#### [](#api-calls)API è°ƒç”¨

ä½¿ç”¨å›è°ƒ

`const http = require('http'); http.request('http://jsonplaceholder.typicode.com/todos/1', function(res) { let data = ''; res.setEncoding('utf8'); res.on('data', function (chunk) { data += chunk; }); res.on('end', function(){ console.log(JSON.parse(data)); }) }).end();`

åˆ©ç”¨æ‰¿è¯º

`const fetch = require('node-fetch'); async function start(){ const response = await fetch('http://jsonplaceholder.typicode.com/todos/1'); const data = await response.text(); console.log(JSON.parse(data)); } start();`

#### [](#spawn-processes)äº§åµè¿‡ç¨‹

ä½¿ç”¨å›è°ƒ

`const { spawn } = require('child_process'); const ls = spawn('echo', ['Hello World!!']); let data = ''; ls.stdout.on('data', (_data) => { data += _data; }); ls.on('close', (code) => { console.log(data); });`

åˆ©ç”¨æ‰¿è¯º

`const spawn = require('spawn-promise'); async function start(){ const out = await spawn('echo',['Hello World!!']); console.log(out.toString()); } start();`

## [](#conclusion)ç»“è®º

å¹¶å‘æ˜¯ä¸€ä»¶ç¾å¥½çš„äº‹æƒ…ï¼Œå°¤å…¶æ˜¯åœ¨é€Ÿåº¦æ˜¯é‡ä¸­ä¹‹é‡çš„å¤§è§„æ¨¡åº”ç”¨ä¸­ï¼Œæˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ›´å¤šåœ°äº†è§£å®ƒä»¥åŠå¦‚ä½•æœ€å¥½åœ°åº”ç”¨å®ƒã€‚

## [](#thanks-for-reading)æ„Ÿè°¢é˜…è¯»ï¼ï¼ï¼

*è€ƒè™‘åœ¨ [Twitter](https://twitter.com/neutrino2211) ä¸Šå…³æ³¨æˆ‘ï¼Œä½ å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„å¸–å­[è¿™é‡Œ](https://dev.to/neutrino2211/how-to-avoid-javascript-bugs-31pm)*