# ä½¿ç”¨ Xstate å’Œ ReactJS çš„çº¯ UI

> åŸæ–‡:[https://dev.to/cris_o/pure-ui-using-xstate-and-reactjs-5em7](https://dev.to/cris_o/pure-ui-using-xstate-and-reactjs-5em7)

æˆ‘ä»¬å°†è®¨è®ºä»€ä¹ˆæ˜¯çŠ¶æ€æœºï¼Œä»¥åŠç±»ä¼¼â€œçŠ¶æ€æœº 2.0â€çš„çŠ¶æ€å›¾å¦‚ä½•å¸®åŠ©æ‚¨æ„å»ºæ›´å¼ºå¤§çš„åº”ç”¨ç¨‹åºã€‚

æˆ‘ä»¬å°†ä½¿ç”¨`xstate`ï¼Œå®ƒæ˜¯ä¸€ä¸ª`statechart`åº“å’Œ reactJSã€‚ä½†æ˜¯ä½ å¯ä»¥ç”¨ä»»ä½•å…¶ä»–æ¡†æ¶ä»£æ›¿`reactJS`ã€‚

æ€»çš„ç›®æ ‡æ˜¯é€šè¿‡è®©ä½ çš„ UI æˆä¸ºçŠ¶æ€çš„å‡½æ•°æ¥å‡å°‘å¼€å‘ UI æ—¶çš„è®¤çŸ¥è´Ÿè·ã€‚

| åˆé€Ÿç”µæµçŠ¶æ€ | ç”¨æˆ·ç•Œé¢ |
| --- | --- |
| ç›®å½• | æ˜¾ç¤ºåˆ—è¡¨ |
| åˆ—è¡¨.åŠ è½½ | æ˜¾ç¤ºç‰¹å®šåˆ—è¡¨åŠ è½½å›¾åƒ |
| æ— ç»“æœ | ä¸æ˜¾ç¤ºç»“æœæ¶ˆæ¯ |

> è¿™ç¯‡æ–‡ç« çš„ä»£ç å¯ä»¥åœ¨ä»¥ä¸‹ç½‘å€æ‰¾åˆ°:

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png) [ criso ](https://github.com/criso) / [å”®ç¥¨æœºå™¨äºº](https://github.com/criso/ticket-bot)

### ç”¨ Xstate å’Œ ReactJs æ„å»ºçš„èŠå¤©æœºå™¨äººç¤ºä¾‹

<article class="markdown-body entry-content container-lg" itemprop="text">

[![flow](../Images/2edaf97f453c47482e0cf31dbb875f2b.png)T2ã€‘](https://github.com/criso/ticket-bot/blob/master/blog/assets/flow.gif?raw=true)

### è¿™ä¸ªå›è´­åŒ…å«è¿™ç¯‡[åšå®¢æ–‡ç« ](https://dev.to/cris_o/pure-ui-using-xstate-and-reactjs-5em7)çš„ä»£ç 

æˆ‘ä»¬å°†ä»‹ç»ä»€ä¹ˆæ˜¯çŠ¶æ€æœºï¼Œä»¥åŠç±»ä¼¼â€œçŠ¶æ€æœº 2.0â€çš„çŠ¶æ€å›¾å¦‚ä½•å¸®åŠ©æ‚¨æ„å»ºæ›´å¥å£®çš„åº”ç”¨ç¨‹åºã€‚

å®ƒä½¿ç”¨ Xstate(statecharts)å’Œ reactJS æ¥æ„å»ºèŠå¤©æœºå™¨äººæµç¨‹<g-emoji class="g-emoji" alias="fire" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f525.png">ğŸ”¥</g-emoji>

è¿™ä¸ªé¡¹ç›®æ˜¯ç”¨ [Create React App](https://github.com/facebook/create-react-app) å¼•å¯¼çš„ã€‚

## å¯ç”¨è„šæœ¬

åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œæ‚¨å¯ä»¥è¿è¡Œ:

### `npm start`

åœ¨å¼€å‘æ¨¡å¼ä¸‹è¿è¡Œåº”ç”¨ç¨‹åºã€‚
æ‰“å¼€ [http://localhost:3000](http://localhost:3000) åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚

å¦‚æœæ‚¨è¿›è¡Œç¼–è¾‘ï¼Œé¡µé¢å°†é‡æ–°åŠ è½½ã€‚æ‚¨è¿˜ä¼šåœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ä»»ä½• lint é”™è¯¯ã€‚

</article>

[View on GitHub](https://github.com/criso/ticket-bot)

### [](#a-state-machine)ä¸€ä¸ªçŠ¶æ€æœºï¼Ÿ

æˆ‘ä¸€ç›´è§‰å¾—çŠ¶æ€æœºè¿™ä¸ªæœ¯è¯­æœ‰ç‚¹å¥‡æ€ªã€‚
æœ€åˆå¯èƒ½æ›´å®¹æ˜“ç†è§£ä¸º:

> ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨ç»™å®šçš„è¾“å…¥ä¸‹ï¼Œåªåšä¸åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€ç›¸å…³çš„äº‹æƒ…ã€‚

```
const currentState = "isLoading";
function machine(input) {
  if (currentState === "isLoading") {
    // *only* do things related to `isLoading` state with `input`
  }

  if (currentState === "isError") {
    // *only* do things related to `isError` state with `input`
  }
} 
```

è¿™é‡Œæœ‰ä¸€ä¸ªç†Ÿæ‚‰çš„çŠ¶æ€æœº:

```
// currentState is `idle`

fetch() // currentState is `fetching`
.then(
  (successResults) => {
    //  currentState is 'success'
    // stateful data is 'successResults'
  }
  (errorMsg) => {
    // currentState is 'error'
    // stateful data is 'errorMsg'
  }
); 
```

æ—¢ç„¶ï¼Œ`currentState`ä¸€æ¬¡åªèƒ½æ˜¯**ä¸€ä»¶äº‹**ï¼Œä½ å°±ä¸è¦ç¢°åˆ°è¿™äº›æ£€æŸ¥:

```
 // NOPE, NOPE, NOPE
if (isLoading && !isError) // ...
if (!isLoading && isError) // ...
if (isLoading && isError) // ... 
```

> ä¸€ä¸ªæœ‰æ•ˆçš„å¤æ‚ç³»ç»Ÿæ€»æ˜¯è¢«å‘ç°æ˜¯ä»ä¸€ä¸ªæœ‰æ•ˆçš„ç®€å•ç³»ç»Ÿè¿›åŒ–è€Œæ¥çš„ã€‚çº¦ç¿°Â·é«˜å°”

### [](#two-types-of-state)ä¸¤ç§çŠ¶æ€

æœ‰ä¸¤ç§çŠ¶æ€:

1.  ä½ çš„åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€ã€‚è¿™äº›é—®é¢˜å›ç­”å¦‚ä¸‹:

*   â€œæ­£åœ¨åŠ è½½å—ï¼Ÿâ€
*   â€œæœ‰é”™è¯¯å—ï¼Ÿâ€
*   â€œæˆ‘ä»¬æ­£åœ¨è·å–ç”¨æˆ·æ•°æ®å—ï¼Ÿâ€

è¿™é‡Œçš„ç­”æ¡ˆå°†å†³å®šä½¿ç”¨å“ªä¸ª**ç»„ä»¶**:

```
if (currentState === 'error') {
  return <Error />;
} 
```

1.  æœ‰çŠ¶æ€æ•°æ®ã€‚è¿™åœ¨`xState`é‡Œå«åš`context`ã€‚è¿™äº›é—®é¢˜å›ç­”å¦‚ä¸‹:

*   â€œé”™è¯¯ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿâ€
*   " API è¯·æ±‚çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ"
*   "å½“å‰é€‰æ‹©äº†å“ªä¸ªè¿‡æ»¤å™¨/é€‰é¡¹ï¼Ÿ"

è¿™é‡Œçš„ç­”æ¡ˆå°†å†³å®šä¸€ä¸ªç»„ä»¶æ‹¥æœ‰å“ªäº›**é“å…·**:

```
if (currentState === 'error') {
  return <Error msg={context.errorMsg}>
} 
```

### å‘Šè¯‰æˆ‘æˆ‘ä»¬åœ¨å“ªä¸ªçŠ¶æ€ï¼Œæˆ‘ä¼šå‘Šè¯‰ä½ ç”¨æˆ·ç•Œé¢æ˜¯ä»€ä¹ˆæ ·å­çš„

UI åº”è¯¥æ˜¯çŠ¶æ€çš„ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸åŒäºè®©ç”¨æˆ·ç•Œé¢æˆä¸ºæˆ‘ä»¬ç°æœ‰æ•°æ®çš„å‡½æ•°ã€‚

ğŸ‘çŠ¶æ€åŠŸèƒ½:

```
if (currentState === list.noResults) {
  return "No Results found";
}

if (currentState === list.isError) {
  return "Oops!";
} 
```

#### [](#vs)vs

ğŸ‘æˆ‘ä»¬ç›®å‰æŒæ¡çš„æ•°æ®:

```
if (list.length === 0) {
  // the list is empty, so we probably don't have any results"
  return "No Results found";
}

if (list.errMsg) {
  // list.err is not empty, show an error message #yolo
  return "Oops";
} 
```

##### [](#pointup-this-is-an-important-distinction-pointup)â˜ï¸è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„åŒºåˆ«ã€‚â˜ï¸

è¿™é‡Œçš„å¯¹è¯ä»:

> â€œå¦‚æœç»“æœä¸ºé›¶ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿâ€è¯·è®°ä½:
> ç”±äºä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬å¯èƒ½æ²¡æœ‰ä»»ä½•ç»“æœï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è·å–ä»»ä½•ä¸œè¥¿ï¼Œæˆ–è€…æˆ‘ä»¬çœŸçš„æ²¡æœ‰ä»»ä½•ç»“æœã€‚è¿™äº›ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ˜¯ä¸€ä¸ª**ä¸åŒçš„**çŠ¶æ€ã€‚

æ”¶ä»¶äºº:

> â€œå½“å¤„äº`error`ã€`initial`æˆ–`noResults`çŠ¶æ€æ—¶ï¼Œ**çš„ç”¨æˆ·ç•Œé¢æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿâ€**

æ‚¨ç°åœ¨æ­£åœ¨æ„å»ºæ‚¨çš„ UI æ¥è€ƒè™‘æ¯ä¸ªçŠ¶æ€ã€‚

> é¢˜ç›®å˜äº†å—ï¼Ÿå›¾æ ‡ä¼šæ”¹å˜å—ï¼Ÿ
> æŸæ ·ä¸œè¥¿ä¼šå˜æˆæ®‹åºŸå—ï¼Ÿ
> åº”è¯¥æœ‰é‡è¯•æŒ‰é’®å—ï¼Ÿ

### [](#state-chart-configuration)çŠ¶æ€å›¾è¡¨é…ç½®

çŠ¶æ€å›¾æ˜¯ä¸€ä¸ªå¯ä»¥åŒ…å«å…¶ä»–çŠ¶æ€æœºçš„çŠ¶æ€æœº...è¿˜æœ‰æ›´å¤šï¼

æ‰€æœ‰è¿™äº›çš„åŸºç¡€æ˜¯çŠ¶æ€å›¾çš„é…ç½®ã€‚

ä½ å£°æ˜:

*   å¯èƒ½å­˜åœ¨çš„çŠ¶æ€`loading, error, noResults, listing, details, etc..`
*   åœ¨æ¯ä¸ªçŠ¶æ€çš„**ä¸­å¯èƒ½å‘ç”Ÿçš„`actions/events`:`action/TRY_AGAIN`åªæœ‰åœ¨æˆ‘ä»¬å¤„äº`listing.error`çŠ¶æ€æ—¶æ‰ä¼šå‘ç”Ÿ**
*   åœ¨è½¬ç§»åˆ°å¦ä¸€ä¸ªçŠ¶æ€ä¹‹å‰ï¼Œéœ€è¦é€šè¿‡`conditionals/guards`ï¼Œä¾‹å¦‚:å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæˆåŠŸçš„å“åº”å’Œ`total === 0`ï¼Œæˆ‘ä»¬å°†åªè½¬ç§»åˆ°`noResults`çŠ¶æ€

é…ç½®ä¸€ä¸ªå¯ä»¥ç†è§£ç»å¤§å¤šæ•° UI é€»è¾‘çš„çŠ¶æ€æœºå¾ˆé…·ã€‚

åœ¨çœ‹åˆ°è§£é‡Šä¹‹å‰ï¼Œè¯•ç€ç†è§£ä¸‹é¢çš„é…ç½®:

```
// guards.js - conditional functions used to determine what the next step in the flow is
const guards = {
  shouldCreateNewTicket: (ctx, { data }) => data.value === "new_ticket",
  shouldFindTicket: (ctx, { data }) => data.value === "find_ticket"
};

// actions.js - functions that perform an action like updating the stateful data in the app
const actions = {
  askIntroQuestion: ctx => {
    return {
      ...ctx,
      chat: ["How may I help you?"]
    };
  }
};

// constants/state.js constants to represent the current state of the app
const intro = "@state/INTRO";
const question = "@state/QUESTION";
const newTicket = "@state/NEW_TICKET";
const findTicket = "@state/FIND_TICKET";

// constants/actions.js: constants to represent actions to be taken
const ANSWER = "@state/ANSWER";

const config = Machine({
  initial: intro,
  states: {
    [intro]: {
      initial: question,
      on: {
        [ANSWER]: [
          {
            cond: "shouldCreateNewTicket",
            actions: "updateCtxWithAnswer",
            target: newTicket
          },
          {
            cond: "shouldFindTicket",
            actions: "updateCtxWithAnswer",
            target: findTicket
          }
        ]
      },
      states: {
        [question]: { onEntry: "askIntroQuestion" }
      }
    },
    [newTicket]: {},
    [findTicket]: {}
  }
}).withConfig({
  actions,
  guards
}); 
```

[![image](../Images/8b1ac1a986e9fb07e0e141c2a3faf3c8.png)T2ã€‘](https://i.giphy.com/media/xUPGcJRMK0NxGNEkKY/giphy.gif)

#### [](#the-snippet-above-reads-as)ä¸Šé¢çš„ç‰‡æ®µå¦‚ä¸‹:

*   åˆå§‹çŠ¶æ€æ˜¯ä»*çŠ¶æ€å¼€å§‹çš„`intro`*
    *   `intro`é‡Œé¢çš„åˆå§‹çŠ¶æ€æ˜¯*é—®é¢˜*
    *   `intro.question`çš„`onEntry`æˆ‘ä»¬å°†è§¦å‘è¡ŒåŠ¨`askIntroQuestion`
    *   è¿™é‡Œä»€ä¹ˆä¹Ÿæ²¡å‘ç”Ÿ...ç”¨æˆ·ç•Œé¢å¤„äºç©ºé—²çŠ¶æ€...ç°åœ¨æˆ‘ä»¬ç­‰å¾…
    *   åœ¨å‘ç”Ÿ`ANSWER`äº‹ä»¶æ—¶:
        *   å¦‚æœ`shouldCreateNewTicket`
        *   `updateCtxWithAnswer`
        *   è¿›å…¥`newTicket`çŠ¶æ€
        *   å¦‚æœ`shouldFindTicket`
        *   `updateCtxWithAnswer`
        *   è¿›å…¥`findTicket`çŠ¶æ€

#### [](#and-can-be-visualized-at-httpsstatechartsgithubioxstateviz)ï¼Œåœ¨ https://statecharts.github.io/xstate-viz/[å¯ä»¥çœ‹åˆ°](https://statecharts.github.io/xstate-viz/)

[![image](../Images/c20108b3c1550d483ca580b9b7528447.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ERBC-Z8t--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/3h1cvpqtpeztlukabuia.jpg)

å“Ÿï¼è¿™ç§å¯è§†åŒ–æ˜¯ä»å®é™…ä»£ç ä¸­æ„å»ºçš„ï¼

æˆ‘â¤ï¸è¿™ä¸ªï¼

è¿™äº›ä¸æ˜¯ä»£ç æ³¨é‡Šï¼Œä¹Ÿä¸æ˜¯å…±äº«ç¡¬ç›˜ä¸Š 8 ä¸ªæœˆæ²¡æœ‰æ›´æ–°çš„`spec-32.pdf`ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œè¿™æœ‰åŠ©äºæ¨åŠ¨å…³äºäº§å“æµçš„å¯¹è¯ï¼Œä»¥åŠå®ƒå¦‚ä½•å›´ç»•åº”ç”¨ç¨‹åºçš„æ¯ä¸ªçŠ¶æ€ä¸åˆ©ç›Šç›¸å…³è€…ä¿æŒä¸€è‡´ã€‚

å¾ˆæ˜æ˜¾ï¼Œæ˜¯å¦æœ‰ä¸€ä¸ª`error`çŠ¶æ€ã€
T4ï¼Œæˆ–è€…æ˜¯å¦åº”è¯¥æœ‰ä¸€ä¸ª`noResults`å¯¹ä¸€ä¸ª`error`çŠ¶æ€

## [](#okay-lets-build-a-chatbot-flow)å¥½çš„...è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªèŠå¤©æœºå™¨äººæµç¨‹

[![image](../Images/824423b07a8498bfbfab4aac293f4d61.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ZxXf-xH_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/miqglabh6eg9s8j4y5g2.gif)

è¿™æ˜¯è§„æ ¼å’Œæµç¨‹...æ— èŠæˆ‘çŸ¥é“...ä½†æ˜¯å’Œæˆ‘ä¸€èµ·å‘†åœ¨è¿™é‡Œã€‚

### [](#spec)è§„æ ¼:

ä½œä¸ºç”¨æˆ·ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿ:

1.  åˆ›å»ºä¸€å¼ æ–°çš„è®¢å•
2.  æŸ¥æ‰¾ç°æœ‰ç¥¨è¯
3.  å¦‚æœé€‚ç”¨ï¼Œåº”è¯¥æœ‰`loading`çŠ¶æ€å’Œ`error`çŠ¶æ€

`Create new ticket`

*   è®¢è´­äº§å“æ—¶:
    *   å¦‚æœæˆ‘ä»¬æ²¡æœ‰è¯¥é¡¹ç›®çš„åº“å­˜:
    *   æ˜¾ç¤ºè­¦å‘Šæ¶ˆæ¯
    *   æ˜¾ç¤ºå•†å“é€‰é¡¹ï¼Œç¼ºè´§å•†å“æ˜¾ç¤ºä¸ºç°è‰²
    *   ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿå†æ¬¡ä»é€‰é¡¹ä¸­é€‰æ‹©
    *   å¦‚æœæˆ‘ä»¬æœ‰è¯¥å•†å“çš„åº“å­˜:
    *   æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
    *   å¦‚æœæœ‰é”™è¯¯
    *   æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯

`Find ticket`

*   å¦‚æœæ‰¾åˆ°:

    *   æ˜¾ç¤ºè®¢è´­çš„å†…å®¹
    *   è¯¢é—®ç”¨æˆ·æ˜¯å¦æ„¿æ„å‘è¯¥è®¢å•å‘é€â€œpingâ€
*   å¦‚æœæ‰¾ä¸åˆ°:

    *   æ˜¾ç¤ºè­¦å‘Šæ¶ˆæ¯
    *   è¯¢é—®ç”¨æˆ·æ˜¯å¦è¦åˆ›å»ºæ–°ç¥¨è¯

è¿™é‡Œæœ‰ä¸€ç‚¹æœºå™¨é…ç½®:

```
const flowMachine = Machine({
  initial: intro,
  states: {
    [intro]: {
      initial: question,
      on: {
        [ANSWER]: [
          {
            target: newTicket,
            cond: "shouldCreateNewTicket",
            actions: "updateCtxWithAnswer"
          },
          {
            target: findTicket,
            cond: "shouldFindTicket",
            actions: "updateCtxWithAnswer"
          }
        ]
      },
      states: {
        [question]: { onEntry: "askIntroQuestion" }
      }
    },

    [findTicket]: {
      initial: question,
      on: {
        [ANSWER]: { target: `.${pending}`, actions: 'updateCtxWithAnswer' }
      },
      states: {
        [question]: { onEntry: 'askFindTicket' },
        [error]: {},
        [noResults]: {},
        [pending]: {
          invoke: {
            src: 'getTicket',
            onDone: [
              {
                target: done,
                actions: 'updateCtxWithResults',
                cond: 'foundTicket'
              },
              { target: noResults }
            ],
            onError: error
          }
        },
        [done]: { type: 'final' }
      },
      onDone: pingTicket
  }
}); 
```

*   åœ¨`findTicket`ä¸­:
*   ä¸€æ—¦ç”¨æˆ·å›ç­”äº†é—®é¢˜ï¼Œæˆ‘ä»¬å°†è¿›å…¥`pending`çŠ¶æ€ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†è°ƒç”¨ä¸€ä¸ªå«åš`getTicket`çš„`promise`
*   å¦‚æœæœ‰é”™è¯¯:
    *   æˆ‘ä»¬è¿›å…¥`error`çŠ¶æ€
*   å…¶ä»–
    *   å¦‚æœ`foundTicket`ä¸ºçœŸï¼Œæˆ‘ä»¬è½¬ç§»åˆ°`done`çŠ¶æ€
    *   å¦‚æœ`foundTicket`ä¸ºå‡ï¼Œæˆ‘ä»¬è½¬ç§»åˆ°`noResults`çŠ¶æ€

### [](#heres-one-way-to-render-component-per-state)è¿™é‡Œæœ‰ä¸€ç§æŒ‰çŠ¶æ€æ¸²æŸ“ç»„ä»¶çš„æ–¹æ³•

åŸºäºå½“å‰çŠ¶æ€å‘ˆç°ç»„ä»¶æ˜¯å¾ˆæ£’çš„ã€‚

è¿™æ˜¯ä½ å¯ä»¥é€‰æ‹©çš„æ¸²æŸ“ç»„ä»¶
æˆ–è€…æ ¹æ®åº”ç”¨ç¨‹åºçš„`currentState`ä¼ é€’ä¸åŒé“å…·çš„å¤šç§æ–¹å¼ä¹‹ä¸€ã€‚
å†æ¬¡:
`currentState`è¿™é‡ŒæŒ‡çš„æ˜¯ app çŠ¶æ€â€œæ­£åœ¨åŠ è½½ã€å‡ºé”™ç­‰â€
`currentState.context`æ˜¯æŒ‡å½“å‰æœ‰
çš„æœ‰çŠ¶æ€æ•°æ®

```
/**
 * Array of
 * [].<StateName, function>
 *
 * NOTE: specificity matters here so a more specific state
 * should be first in the list. e.g:
 * 'findTicket.noResults'
 * 'findTicket'
 *
 * On state 'findTicket.foo', 'findTicket' will be matched
 */
const stateRenderers = [
  [newTicket, ({ onSelect, currentState }) =>
    <Choices
      options={currentState.context.options}
      onSelect={onSelect} />
  ],

  [`${findTicket}.${noResults}`, () =>
    <Msg>Sorry, we can't find your ticket</Msg>],

  [`${findTicket}.${error}`, () => <Msg>Oops, we ran into an error!</Msg>],

  [findTicket, ({ onSelect }) => <FindTicketForm onSelect={onSelect} />]
];

// components/Choices.jsx
const Choices = ({ currentState, ...props}) => (
  // based on current state, get a function from `stateRenders`
  // and render it with the props we have
  const [stateName, renderState] =
      stateRenderers.find(([key]) => currentState.matches(key));

  return renderState(props);
) 
```

### [](#and-heres)è¿˜æœ‰è¿™é‡Œçš„...

[![!image](../Images/678e862126d0b734b3c47862ce26498b.png)T2ã€‘](https://i.giphy.com/media/5OWLUbuMq4YXEl2ECg/giphy.gif)

è¿™é‡Œæœ‰ä¸€ä¸ªåŸºäºå½“å‰
åº”ç”¨ç¨‹åºçŠ¶æ€æ˜¾ç¤ºç»„ä»¶çš„ä¸åŒè®¾ç½®ã€‚

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ã€‚`currentState`ä¸€æ¬¡åªæœ‰ä¸€ä»¶äº‹
ï¼Œæ‰€ä»¥è¿™é‡Œä¸åš
`isLoading`å¯¹`error`
çš„å¸ƒå°”æ£€æŸ¥

```
<ChatBody data-testid="ChatBody">
  // display any chat info that exists in context
  {currentState.context.chat.map(({ question, answer }) => (
    <React.Fragment key={`${question}.${answer}`}>
      <ChatMsgQuestion>{question}</ChatMsgQuestion>
      {answer && <ChatMsgAnswer>{answer}</ChatMsgAnswer>}
    </React.Fragment>
  ))}

  // display message based on the current state that we're in
  // NOTE: only one of this is possible at a time
  {currentState.matches(pending) && <ChatMsgLoading />}
  {currentState.matches(error) && <ChatMsgError />}

  {currentState.matches(noResults) && (
    <ChatMsgWarning>{getNoResultsMsg(currentState)}</ChatMsgWarning>
  )}

  {currentState.matches(itemOrdered) && (
    <ChatMsgSuccess>{getSuccessMsg(currentState)}</ChatMsgSuccess>
  )}
</ChatBody> 
```

### [](#takeaways)å¤–å–

æ²¡é—®é¢˜çš„...å¸Œæœ›ä½ å·²ç»èµ°äº†è¿™ä¹ˆè¿œã€‚æŸ¥çœ‹æ›´å¤šå†…å®¹çš„ä»£ç ã€‚

æˆ‘è®¤ä¸ºè¿™å¾ˆå¥½åœ°å»ºç«‹åœ¨å·²ç»æˆåŠŸçš„`redux`æ¨¡å¼ä¹‹ä¸Šï¼Œæ¯”å¦‚æ¶ˆæ¯ä¼ é€’ã€å•å‘æµåŠ¨ã€æ•°æ®ç®¡ç†ä¸ç»„ä»¶åˆ†ç¦»ã€‚

æˆ‘å‘ç°ä½¿ç”¨è¿™ç§æ¨¡å¼æ¥é€‚åº”éœ€æ±‚å˜åŒ–éå¸¸å®¹æ˜“ã€‚

äº‹æƒ…å¤§æ¦‚æ˜¯è¿™æ ·çš„:

1.  è§„æ ¼å˜åŒ–
2.  é¦–å…ˆè°ƒæ•´çŠ¶æ€æœºé…ç½®
3.  åœ¨ UI ä¸­åæ˜ æ–°çŠ¶æ€

> â€œå¥½å§ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ°è¾¾è¿™ä¸ªæ–°çš„çŠ¶æ€ã€‚ä¸€æ—¦æˆ‘ä»¬å¤„äºè¿™ç§çŠ¶æ€ï¼Œæˆ‘ä»¬åªéœ€è¦è®©ç”¨æˆ·ç•Œé¢åæ˜ å‡ºè¿™ç§ç‰¹å®šçŠ¶æ€åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„â€

### [](#opinions)æ„è§

1.  è¿™ä¸ªä»£æ›¿ redux å—ï¼Ÿæ²¡é”™ã€‚ä½†æ˜¯ redux æ¨¡å¼ä»ç„¶é€‚ç”¨ã€‚
    *   æœ‰ä¸€ä¸ªåœ°æ–¹ï¼Œå‡å°‘ä½ çš„æ•°æ®åŸºäºä¸€ä¸ªäº‹ä»¶
    *   æ•°æ®å•å‘æµåŠ¨
    *   ç‹¬ç«‹çš„ API
2.  é“å…·é’»æ¢å‘¢ï¼Ÿ
    *   æˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜è¢«å¤¸å¤§äº†ã€‚
    *   æ‚¨å¯ä»¥æ›´å¥½åœ°åˆ†è§£ç»„ä»¶ï¼Œæˆ–è€…ä½¿ç”¨ react.context

### [](#recommended-reading)æ¨èé˜…è¯»

[https://xstate.js.org](https://xstate.js.org)
T3ã€‘https://state charts . github . io