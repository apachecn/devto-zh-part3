# åœ¨ Teamcity ä¸­æ›´å¥½åœ°ç¿»è¯‘å‰§æœ¬è¾“å‡º

> åŸæ–‡:[https://dev . to/dploeger/better-ansi ble-playbook-output-in-team city-11al](https://dev.to/dploeger/better-ansible-playbook-output-in-teamcity-11al)

æˆ‘ä»¬åœ¨æˆ‘çš„å…¬å¸é‡Œä½¿ç”¨äº†å¤§é‡çš„[å¯ç¿»è¯‘çš„](https://ansible.com)å‰§æœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨[å›¢é˜ŸåŸå¸‚](https://www.jetbrains.com/teamcity/)ä½œä¸ºæˆ‘ä»¬çš„ä¸»è¦ CI æœåŠ¡ã€‚

åœ¨ TeamCity ä¸Šï¼Œæˆ‘ä»¬çš„å‰§æœ¬è¾“å‡ºå¦‚ä¸‹æ‰€ç¤º:

[![Ansible Playbook output without the plugin](../Images/9013069efbcf210f6915d018ba24a30c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--tDyOkLA2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/dodevops/ansible-teamcity-callback/raw/master/log_view_without.png)

ğŸ¤¨ğŸ™ğŸ˜

æˆ‘ä¸çŸ¥é“ä½ ï¼Œä½†æˆ‘å¾ˆä¸å–œæ¬¢ Ansible playbook çš„é»˜è®¤è¾“å‡ºã€‚å®ƒéå¸¸æ‹¥æŒ¤å’Œåºå¤§ï¼Œå¾ˆéš¾æ£€æŸ¥ Ansible ç›®å‰åœ¨å“ªé‡Œå·¥ä½œã€‚

TeamCity æœ‰ä¸€ä¸ªéå¸¸å¥½çš„ç‰¹æ€§å«åš[æ„å»ºè„šæœ¬äº¤äº’](https://confluence.jetbrains.com/display/TCD18/Build+Script+Interaction+with+TeamCity)ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥æ ¹æ®ç‰¹å®šçš„æ ‡å‡†æ ¼å¼åŒ–ä½ çš„æ ‡å‡†è¾“å‡ºï¼Œè¿™æ ·å®ƒå°±å¯ä»¥è¢« TeamCity è§£é‡Šã€‚

è¿™æ ·ä½ å¯ä»¥æ‰“å¼€å’Œå…³é—­ç¨‹åºå—ï¼Œè®¾ç½®å˜é‡ï¼Œæ ‡è®°é”™è¯¯ç­‰ç­‰ã€‚

æˆ‘è¯´äº†â€œæ‰“å¼€å’Œå…³é—­å—â€å—ï¼Ÿæ˜¯çš„ï¼Œæˆ‘åšåˆ°äº†ï¼Œè¿™å°†æˆä¸ºå¯ç¿»è¯‘å‰§æœ¬çš„å®Œç¾ç‰¹å¾ï¼Œå¯¹å—ï¼Ÿ

å¹¸è¿çš„æ˜¯ï¼ŒAnsible å¯ä»¥è¢«æ’ä»¶æ‰©å±•ï¼ŒAnsible çš„è¾“å‡ºç”±æ‰€è°“çš„[å›è°ƒæ’ä»¶](https://docs.ansible.com/ansible/latest/plugins/callback.html)å¤„ç†ã€‚å›è°ƒæ’ä»¶å¯¹æŸäº›äº‹ä»¶ä½œå‡ºååº”(æŸ¥çœ‹[å›è°ƒåº“](https://github.com/ansible/ansible/blob/devel/lib/ansible/plugins/callback/__init__.py)çš„ç±»å®šä¹‰ï¼Œè·å–å¯è¦†ç›–çš„æ–¹æ³•åˆ—è¡¨)ï¼Œå…¶ä¸­ä¸€äº›äº‹ä»¶ä¸æ¸¸æˆæˆ–ä»»åŠ¡çš„å¼€å§‹æœ‰å…³ã€‚

æ‰€ä»¥æˆ‘æ‰©å±•äº†åŸæ¥çš„é»˜è®¤è¾“å‡ºæ’ä»¶ï¼Œè¦†ç›–äº†æ¸¸æˆå’Œä»»åŠ¡çš„ç‰¹å®šæ–¹æ³•ã€‚

æœ‰äº†è¿™ä¸ªæ’ä»¶ï¼Œæ—¥å¿—ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·:

[![Ansible Playbook output with the plugin](../Images/f739a94d534b2358e159f4f77388ad2b.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--6AgoBIT---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/dodevops/ansible-teamcity-callback/raw/master/log_view_with.png)

ğŸ˜ğŸ˜ğŸ˜

æ‰€æœ‰ç»“æ„è‰¯å¥½çš„å›¢é˜Ÿç”šè‡³å¯ä»¥è®¡ç®—æ¸¸æˆå’Œä»»åŠ¡çš„æ—¶é—´ï¼

åœ¨ GitHub ä¸ŠæŸ¥çœ‹:

## ![GitHub logo](../Images/292a238c61c5611a7f4d07a21d9e8e0a.png) [æ¸¡æ¸¡é¸Ÿ](https://github.com/dodevops)/[ansi ble-team city-callback](https://github.com/dodevops/ansible-teamcity-callback)

### ä¸€ä¸ªå¯å“åº”çš„å›è°ƒæ’ä»¶ï¼Œç”¨äºè¾“å‡ºé€‚åˆå›¢é˜ŸåŸå¸‚çš„å†…å®¹

<article class="markdown-body entry-content container-lg" itemprop="text">

# Teamcity çš„ Ansible å›è°ƒæ’ä»¶

## ä»‹ç»

è¿™ä¸ª [Ansible](https://ansible.com) [å›è°ƒæ’ä»¶](https://raw.githubusercontent.com/dodevops/ansible-teamcity-callback/master/)æ ¼å¼åŒ– Ansible å‰§æœ¬çš„è¾“å‡ºï¼Œä»¥ä¾¿ TeamCity èƒ½å¤Ÿæ›´å¥½åœ°è§£é‡Šå®ƒã€‚

## ä¸ºä»€ä¹ˆï¼Ÿ

å› ä¸º Teamcity ä¸­çš„ Ansible æ—¥å¿—çœ‹èµ·æ¥åƒè¿™æ ·:

[![Log without this plugin](../Images/c53d116ffd1b026e5d8c8add0e4a21f9.png)T2ã€‘](https://raw.githubusercontent.com/dodevops/ansible-teamcity-callback/master/log_view_without.png)

æœ‰äº†è¿™ä¸ªæ’ä»¶ï¼Œå®ƒä»¬çœ‹èµ·æ¥åƒè¿™æ ·:

[![Log with this plugin](../Images/575c6bbd0489d914b84d553a487e579d.png)T2ã€‘](https://raw.githubusercontent.com/dodevops/ansible-teamcity-callback/master/log_view_with.png)

æ‰€æœ‰çš„æ¸¸æˆå’Œä»»åŠ¡éƒ½è¢«å¾ˆå¥½åœ°æ”¾å…¥å®ƒä»¬è‡ªå·±çš„æ¨¡å—ä¸­ï¼Œè¿™æ · TeamCity å°±å¯ä»¥æŠ˜å å®ƒä»¬å¹¶è®¡ç®—ä¸åŒçš„æ—¶é—´ã€‚

## ä½¿ç”¨

ä½ æœ‰ä¸åŒçš„é€‰æ‹©æ¥ä½¿ç”¨è¿™ä¸ªæ’ä»¶:

*   åœ¨æ‚¨çš„å‰§æœ¬åº“ä¸­
    *   ç›´æ¥åœ¨æ‚¨çš„å‰§æœ¬æ‰€åœ¨çš„ä½ç½®åˆ›å»ºä¸€ä¸ªåä¸º`callback_plugins`çš„æ–‡ä»¶å¤¹
    *   ä¸‹è½½[æ–‡ä»¶ teamcity.py](https://raw.githubusercontent.com/dodevops/ansible-teamcity-callback/master/teamcity.py) å¹¶å°†å…¶æ”¾åœ¨`callback_plugins`ç›®å½•ä¸­
*   åˆ«çš„åœ°æ–¹
    *   [ä¸‹è½½](https://github.com/dodevops/ansible-teamcity-callback/archive/master.zip)æˆ–[å…‹éš†](https://github.com/dodevops/ansible-teamcity-callback.git)æ’ä»¶ï¼Œå°†å…¶è§£å‹ç¼©ï¼Œå¹¶å°†æ–‡ä»¶å¤¹æ”¾åœ¨å¯è®¿é—®çš„åœ°æ–¹(å³ä½¿ç”¨[å›¢é˜ŸåŸå¸‚å·¥å…·åŠŸèƒ½](https://confluence.jetbrains.com/display/TCD18/Installing+Agent+Tools)å°†æ’ä»¶åˆ†å‘ç»™æ‰€æœ‰ä»£ç†)
    *   ä½¿ç”¨ä¸‹é¢çš„ç¯å¢ƒå˜é‡å‘Šè¯‰ Ansible åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°ä½ çš„æ’ä»¶:`export ANSIBLE_CALLBACK_PLUGINS=<path of your plugin>`

è®¾ç½®ä»¥ä¸‹ç¯å¢ƒâ€¦

</article>

[View on GitHub](https://github.com/dodevops/ansible-teamcity-callback)