# # 100 code examplesâ€“ä½¿ç”¨åŸåŠ›æ›¿æ¢å¯¹è±¡

> åŸæ–‡:[https://dev.to/pesse/100codeexamples-ä½¿ç”¨æ­¦åŠ›æ¥å–ä»£ç‰©ä½“-5b0o](https://dev.to/pesse/100codeexamples--use-the-force-to-replace-objects-5b0o)

åœ¨å‰é¢çš„ä¸€ä¸ª[ç¤ºä¾‹](https://dev.to/pesse/100codeexamples--plsql-objects-basics-of-force-sensitive-beings-1275)ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº† PL/SQL ä¸­å¯¹è±¡çš„åŸºæœ¬ç”¨æ³•ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥åœ¨ oracle æ•°æ®åº“ä¸­å¼€å§‹é¢å‘å¯¹è±¡çš„å¼€å‘ã€‚

ç„¶è€Œï¼Œå¯¹è±¡æ›´å¸¸è§çš„ç”¨æ³•æ˜¯å°†å®ƒä»¬ç”¨ä½œåµŒå¥—è¡¨é›†åˆ(å¯¹è±¡è¡¨)çš„åŸºæœ¬ç±»å‹ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä» SQL è®¿é—®å¯¹è±¡ï¼Œè¿™æ˜¯ä» PL/SQL å‡½æ•°è¿”å›è¡¨ç»“æ„çš„ä¸€ç§éå¸¸å¼ºå¤§çš„å¯èƒ½æ€§ã€‚

å½“æˆ‘ä»¬æƒ³è¦æ”¹å˜ä¸€ä¸ªå·²ç»åœ¨è¡¨ç±»å‹ä¸­è¢«å¼•ç”¨çš„å¯¹è±¡æ—¶ï¼Œéº»çƒ¦å°±å¼€å§‹äº†:æˆ‘ä»¬å¾—åˆ° ORA-02303 ä¾èµ–é”™è¯¯ã€‚å’Œå¾€å¸¸ä¸€æ ·ï¼Œè¿™é‡Œçš„â€œåŠ›â€å¯ä»¥æœ‰æ‰€å¸®åŠ©:

```
-- We can use attribute-only objects without
-- any methods. We dont even have to specify
-- a body in that case
create or replace type t_disturbance is object
(
  planet_name varchar2(1000),
  strength number(10,4)
);
/

-- And we can create a table of objects
-- so we can select objects from SQL
create or replace type t_disturbances
  is table of t_disturbance;
/

-- Little helper function to create
-- disturbances
create or replace function get_disturbances
  return t_disturbances
as
  l_result t_disturbances := t_disturbances();
  begin
    l_result.extend;
    l_result(1) := new t_disturbance('Alderaan', 10000);
    return l_result;
  end;
/

select *
from table(get_disturbances());

-- What if we want to change the underlying object now?
create or replace type t_disturbance is object
(
  planet_name varchar2(1000),
  strength number(10,4),
  alignment varchar2(10)
);
/

-- Error.
-- The problem is, that our object-type is a
-- dependency of the table-type.
-- But we can use the force (since 11.2)!
create or replace type t_disturbance force is object
(
  planet_name varchar2(1000),
  strength number(10,4),
  alignment varchar2(10)
);
/

-- Caution! This doesnt work if the type is used
-- in a table:
create table disturbance_history (
  id integer not null primary key,
  disturbance t_disturbance,
  occured timestamp with local time zone
    default current_timestamp
);

create or replace type t_disturbance force is object
(
  planet_name varchar2(1000),
  strength number(10,4),
  alignment varchar2(10),
  cause_name varchar2(1000)
);
/

-- So lets just not do this for the moment
drop table disturbance_history;
/

create or replace type t_disturbance force is object
(
  planet_name varchar2(1000),
  strength number(10,4),
  alignment varchar2(10),
  cause_name varchar2(1000)
);
/

-- Check for invalid objects
select * from user_objects where status  'VALID';

-- The table-type is invalid, but 
-- we can just compile it without any
-- additional change
alter type t_disturbances compile;

-- We now need to adapt our helper function
-- because the default constructor of 
-- objects requires each attribute to be
-- passed
create or replace function get_disturbances
  return t_disturbances
as
  l_result t_disturbances := t_disturbances();
  begin
    l_result.extend;
    l_result(1) := new t_disturbance('Alderaan', 10000, null, null);
    return l_result;
  end;
/

select *
from table(get_disturbances()); 
```

è¿™ä¸ªä¾‹å­å¯ä»¥åœ¨ [LiveSQL](https://livesql.oracle.com/apex/livesql/s/hyqyfannrmnlh1pqhpo2jpdl1) ä¸Šè¿è¡Œã€‚å…³äº [github](https://github.com/pesse/sith-demo-db/blob/master/100CodeExamples/objects/9_table_objects_and_the_force.sql) çš„å®Œæ•´æºä»£ç ã€‚

æˆ‘åœ¨ 10g ä¸Šå¼€å§‹äº†æˆ‘çš„ PL/SQL ç¼–ç ï¼Œè®°å¾—æœ‰å‡ ä¸ªè„šæœ¬åªæ˜¯åˆ é™¤äº†ä¸€ä¸ªè¡¨ç±»å‹ï¼Œæ”¹å˜äº†åº•å±‚çš„å¯¹è±¡ç±»å‹å¹¶å†æ¬¡åˆ›å»ºäº†è¡¨ç±»å‹ã€‚

äº‹æƒ…æ˜¯è¿™æ ·çš„:æˆ‘ç”šè‡³åœ¨æ›´æ–°åˆ° 11 å’Œ 12 ä¹‹åè¿˜åœ¨ä½¿ç”¨é‚£ä¸ªæ–¹æ³•ï¼Œå› ä¸ºæˆ‘ç›´åˆ°æœ€è¿‘æ‰çŸ¥é“è¿™ä¸ªå¼ºå¤§çš„å°åŠ©æ‰‹ã€‚ä¹Ÿè®¸æˆ‘ä¸æ˜¯å”¯ä¸€çš„ä¸€ä¸ªâ€”â€”å¦‚æœæ˜¯è¿™æ ·ï¼Œè¯·è®©æˆ‘çŸ¥é“ğŸ™‚