# å¤§å¹…ç¼©å° React æœ¬æœºåº”ç”¨ç¨‹åºçš„è§„æ¨¡ï¼

> åŸæ–‡ï¼š<https://dev.to/rishikc/shrink-your-react-native-application-size-dramatically-3ekj>

æ‰€ä»¥ä½ åšäº†ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆé…·å¾ˆæ£’çš„ [React Native](https://facebook.github.io/react-native/) åº”ç”¨ç¨‹åºï¼Œç°åœ¨ä½ å‡†å¤‡å¥½æ„å»ºå®ƒï¼Œå¹¶å¯èƒ½å‘å¸ƒåˆ°å•†åº—â€”â€”

ä½†æ˜¯è€ƒè™‘åˆ°å®ƒçš„æ„å»ºè§„æ¨¡ï¼Œæ‹…å¿ƒç”¨æˆ·æ˜¯å¦æ„¿æ„å®‰è£…å®ƒï¼Ÿæˆ–è€…ï¼Œä¹Ÿè®¸ä½ åªæ˜¯æƒ³ä¿æŒå®ƒçš„é‡é‡è½»ï¼Œä¸è¦å ç”¨å¤ªå¤šä¸å¿…è¦çš„å†…å­˜ï¼Œå½“å®ƒå¯ä»¥è£…è¿›ä¸€ä¸ªæ›´å°çš„å°ºå¯¸ï¼Ÿ

æˆ–è€…ä½ åªæ˜¯æˆ‘ä»¬ä¸­çš„ä¸€å‘˜ï¼Œå¯¹å»ºç­‘å°ºå¯¸æœ‰åè§ï¼Ÿåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬æ©æŠ¤ä½ ï¼ğŸ˜„ âœ”ï¸

* * *

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºä»¥ä¸‹ä¸¤ä»¶äº‹:

*   å‹ç¼© react æœ¬æœºåº”ç”¨ç¨‹åºçš„å¤§å°â€”â€”é€šè¿‡å‹ç¼©åœ¨æ„å»ºåº”ç”¨ç¨‹åºæ—¶ç”Ÿæˆçš„ java å­—èŠ‚ç ï¼Œå¹¶è¦æ±‚å®ƒå°è¯•å‹ç¼©ä¸åº”ç”¨ç¨‹åºæ†ç»‘åœ¨ä¸€èµ·çš„æ‰€æœ‰èµ„æºã€‚

*   å°†æˆ‘ä»¬çš„åº”ç”¨æ†ç»‘åŒ…æ‹†åˆ†æˆå¤šä¸ª`apk`ä»¥åˆ é™¤è¿è¡Œå®ƒçš„è®¾å¤‡ä¸éœ€è¦çš„ä¸å¿…è¦çš„ä»£ç â€”â€”å› ä¸ºè®¸å¤šä»£ç ä¸è®¾å¤‡ç‰¹å®šçš„é€šç”¨ apk æ†ç»‘åœ¨ä¸€èµ·â€”â€”è¿™æ„å‘³ç€æˆ‘ä»¬ä¸éœ€è¦åœ¨å°†è¦å®‰è£…å®ƒçš„è®¾å¤‡ä¸­æœ‰è®¸å¤šä»£ç ã€‚

* * *

æˆ‘ä»¬å¼€å§‹å§ï¼âœŠ

é¦–å…ˆï¼Œå¦‚æœæ‚¨åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ [create-react-native-app](https://github.com/react-community/create-react-native-app) ï¼Œæ‚¨å°†éœ€è¦é€€å‡ºæ‚¨çš„åŸç”Ÿåº”ç”¨ç¨‹åº(å¦‚æœæ‚¨åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰å·²ç»æ„å»ºäº†æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯èƒ½å·²ç»è¿™æ ·åšäº†)ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºåœ¨å¼¹å‡ºä¹‹å‰ä½ ä¸èƒ½è®¿é—®é…ç½®ï¼Œå› ä¸ºæ„å»ºæ–‡ä»¶å¤¹æ˜¯æˆ‘ä»¬å¿…é¡»è¿›è¡Œæ›´æ”¹çš„åœ°æ–¹ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œä½ å¯ä»¥ç®€å•åœ°è¿™æ ·åš:

```
npm run eject 
```

Enter fullscreen mode Exit fullscreen mode

**æ³¨æ„:**å¼¹å‡ºä¸€ä¸ª react åŸç”Ÿåº”ç”¨æ˜¯ä¸€ä¸ªæ°¸ä¹…åŠ¨ä½œï¼(é™¤éä½ æ­£åœ¨ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¥è·Ÿè¸ªä½ çš„åº”ç”¨ç¨‹åºçš„ä»¥å‰ç‰ˆæœ¬ï¼Œå¦‚æœä½ éœ€è¦ï¼Œä½ å¯ä»¥ä»é‚£é‡Œæ¢å¤ä½ çš„åº”ç”¨ç¨‹åºçš„â€œæœªè¢«æ‹’ç»â€çš„ç‰ˆæœ¬)ã€‚[äº†è§£æ›´å¤šå…³äºå¼¹å‡ºçš„ä¿¡æ¯ã€‚](https://github.com/react-community/create-react-native-app/blob/master/EJECTING.md)

å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬éƒ½å‡†å¤‡å¥½äº†ï¼è®©æˆ‘ä»¬å¼€å§‹å¹¶å°½å¿«å®Œæˆã€‚åˆ«æ‹…å¿ƒï¼Œåªéœ€å‡ åˆ†é’Ÿï¼Œä½ çš„åº”ç”¨ç¨‹åºå¤§å°å°±ä¼šå¤§å¹…ç¼©å°ï¼

ç°åœ¨ï¼Œä»æ‚¨çš„é¡¹ç›®æ ¹ç›®å½•å¯¼èˆªåˆ°`android / app`æ–‡ä»¶å¤¹ï¼Œåœ¨é‚£é‡Œæ‚¨å¯ä»¥æ‰¾åˆ°æ‚¨çš„`build.gradle`æ–‡ä»¶ã€‚

[![](img/ba02a119fbbee5006548040d39ad8fc9.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--xXwEe2A7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9yej9fe34wys9wndfywm.png)

åœ¨è¿™é‡Œï¼Œæ‚¨ä¼šå‘ç°æ‚¨çš„é»˜è®¤æ„å»ºé…ç½®å·²ç»è®¾ç½®å¥½äº†ï¼Œæ‰¾åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç è¡Œ:

```
def enableProguardInReleaseBuilds = false
def enableSeparateBuildPerCPUArchitecture = false 
```

Enter fullscreen mode Exit fullscreen mode

å¹¶å°†å®ƒä»¬çš„å€¼æ›´æ”¹ä¸º`true`ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
def enableProguardInReleaseBuilds = true
def enableSeparateBuildPerCPUArchitecture = true 
```

Enter fullscreen mode Exit fullscreen mode

æ‰€ä»¥ä½ å¯èƒ½æƒ³çŸ¥é“å®ƒæ˜¯åšä»€ä¹ˆçš„ã€‚å—¯ï¼Œå¦‚æœä½ å‘ä¸‹æ»šåŠ¨ä¸€ç‚¹ï¼Œä½ ä¼šçœ‹åˆ°`enableProguardInReleaseBuilds`å’Œ`enableSeparateBuildPerCPUArchitecture`å†™åœ¨æ›´å¤šçš„åœ°æ–¹ï¼Œå°±åƒè¿™é‡Œ:

[![](img/45126d8eeb988ed5e5d792acd82d54b7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--KaIPQRyX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ansujrc3fonpiby7wgrg.png)

å¦‚ä½ æ‰€è§ï¼Œè¿™äº›å˜é‡è¢«ç”¨æ¥å¯ç”¨æˆ–ç¦ç”¨ä¸¤ä¸ªæ„å»ºé…ç½®â€”

*   ä¸€ä¸ªç”¨äºç”Ÿæˆå•ç‹¬çš„ã€‚ä¸åŒè®¾å¤‡æ¶æ„çš„ apkï¼Œ

```
...
splits {
    abi {
      reset()
      enable enableSeparateBuildPerCPUArchitecture
... 
```

Enter fullscreen mode Exit fullscreen mode

ä¸è¦æ‹…å¿ƒå¿…é¡»å¤„ç†ä¸åŒçš„ã€‚æ¯ä¸ªæ¶æ„çš„ apkâ€”â€”Google è´Ÿè´£å°†å®ƒåˆ†å‘ç»™ç”¨æˆ·ï¼æ ¹æ®æ¶æ„æ¥åˆ†ç¦»æ„å»ºä¼šä»æ‚¨çš„æ–‡ä»¶ä¸­åˆ é™¤ä¸å¿…è¦çš„ä»£ç ï¼Œè¿™äº›ä»£ç åœ¨è¿è¡Œå®ƒçš„è®¾å¤‡ä¸Šæ˜¯ä¸éœ€è¦çš„ã€‚

*   å¦ä¸€ä¸ªç”¨äºå‹ç¼©ç¼–è¯‘æ—¶ç”Ÿæˆçš„ Java å­—èŠ‚ç ï¼Œ

```
...
buildTypes {
    release {
        minifyEnabled enableProguardInReleaseBuilds
... 
```

Enter fullscreen mode Exit fullscreen mode

å”·ï¼Œè¿™å¤ªç®€å•äº†ï¼ä½†æ˜¯ç­‰ç­‰ï¼Œæˆ‘ä»¬è¿˜æ²¡å®Œå‘¢ï¼æˆ‘ä»¬éœ€è¦åšä¸€ä»¶å°äº‹ã€‚

ç°åœ¨è®©æˆ‘ä»¬åœ¨`minifyEnabled`é…ç½®çš„æ­£ä¸‹æ–¹æ·»åŠ è¿™ä¸€è¡Œ:

```
...
buildTypes {
    release {
        minifyEnabled enableProguardInReleaseBuilds
        shrinkResources true; /* <-- Add this line */
... 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬å®Œäº‹äº†ã€‚ç°åœ¨å†æ¬¡æ„å»ºæ‚¨çš„åº”ç”¨ç¨‹åºå¹¶æ£€æŸ¥`output`ç›®å½•ã€‚ä½ ä¼šå‘ç°ä½ çš„åº”ç”¨æœ‰ä¸¤ä¸ªä¸åŒçš„`.apks`ï¼Œé»˜è®¤æƒ…å†µä¸‹åœ¨é…ç½®ä¸­æŒ‡å®šï¼Œå³`armebi`å’Œ`x86`æ¶æ„ã€‚

å“¦ï¼Œé¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœä½ éœ€è¦ä¸€ä¸ªæ”¯æŒæ‰€æœ‰è®¾å¤‡æ¶æ„çš„é€šç”¨`.apk`â€”â€”åªéœ€å°†`universalApk`è®¾ç½®ä¸º trueï¼Œå®ƒå°†åœ¨ä½ ä¸‹æ¬¡è¿è¡Œ build æ—¶ç”Ÿæˆä¸€ä¸ªé€šç”¨`.apk`ï¼

ä»…æ­¤è€Œå·²ï¼ç°åœ¨ï¼Œæ‚¨å·²ç»è®¾ç½®äº†æ‚¨çš„æ„å»ºé…ç½®ï¼Œä»¥ç¼©å‡æ‚¨çš„ä»£ç å’Œèµ„æºï¼Œå¹¶ä¸ºä¸åŒçš„æ¶æ„åˆ›å»ºå•ç‹¬çš„`.apk`â€”â€”ä»è€Œä»æœ€ç»ˆçš„æ„å»ºä¸­åˆ é™¤ä¸å¿…è¦çš„ä»£ç ã€‚

æ„Ÿè°¢é˜…è¯»ï¼æ‚¨è¿˜å¯ä»¥æŸ¥çœ‹æ›´å¤šå…³äºå¦‚ä½•å‡å°‘åº”ç”¨ç¨‹åºæ„å»ºè§„æ¨¡çš„å‚è€ƒèµ„æ–™ã€‚ğŸ˜„

ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« å—ï¼Ÿè¿˜æ˜¯æˆ‘é”™è¿‡äº†ä»€ä¹ˆï¼Ÿä½ æœ‰ä»€ä¹ˆå¯ä»¥æ·»åŠ åˆ°è¿™ç¯‡æ–‡ç« ä¸­çš„ä¸œè¥¿â€”â€”å¯ä»¥ä½¿å®ƒå˜å¾—æ›´å¥½å—ï¼Ÿ

ä½ å¯ä»¥é€šè¿‡ [Twitter](http://twitter.com/rishiikc) å’Œæˆ‘è”ç³»ã€‚

é»‘å®¢å¿«ä¹ï¼å¹²æ¯ï¼

* * *