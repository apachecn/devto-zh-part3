# Kentico 12:è®¾è®¡æ¨¡å¼ç¬¬ 1 éƒ¨åˆ†â€”â€”ç¼–å†™å¯æµ‹è¯•ä»£ç 

> åŸæ–‡:[https://dev . to/seang Wright/kentico-12-design-patterns-part-1-writing-testable-code-258 a](https://dev.to/seangwright/kentico-12-design-patterns-part-1-writing-testable-code-258a)

<figure>[![](../Images/4f3ba4c9fd2b8239712d74a6db1a0706.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--wmfYywB5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/0%2AxpmHwds5Fbvdv7PA) 

<figcaption>ç…§ç‰‡ç”±[å°¼å¤æ‹‰æ–¯Â·æ‰˜é©¬æ–¯](https://unsplash.com/@nicolasthomas?utm_source=medium&utm_medium=referral)äº[ä¸Š](https://unsplash.com?utm_source=medium&utm_medium=referral)</figcaption>

</figure>

## [](#the-good-why-we-love-kentico)å¥½:æˆ‘ä»¬ä¸ºä»€ä¹ˆçˆ± KenticoğŸ˜»

åœ¨æˆ‘çœ‹æ¥ï¼ŒKentico çš„è®¾è®¡ä¸€ç›´æ˜¯ä¸ºäº†è®©å®ƒçš„ç”¨æˆ·å¯Œæœ‰æˆæ•ˆã€‚å¯¹äºä¼ ç»Ÿçš„é—¨æˆ·å¼•æ“æ‹–æ”¾å¼ UI ç”Ÿæˆå™¨å’Œã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨. NET åº“ä¸ CMS è¿›è¡Œäº¤äº’ã€‚

éœ€è¦ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·æ•°æ®å—ï¼Ÿç”¨`UserInfoProvider.GetUsers();`è°ƒç”¨é™æ€æä¾›è€…ç±»ã€‚âœ”ï¸

æ‚¨éœ€è¦çŸ¥é“å½“å‰è¯·æ±‚è¿è¡Œåœ¨å“ªä¸ªç«™ç‚¹ä¸‹å—ï¼Ÿä½¿ç”¨é™æ€ä¸Šä¸‹æ–‡è®¿é—®å™¨`SiteContext.CurrentSiteName;`ã€‚âœ”ï¸

æƒ³è¦ç¡®ä¿ä½œä¸ºç±»å‹å¯¹è±¡å¯è®¿é—®çš„ä¸€äº›æ•°æ®å®é™…ä¸Šæ˜¯æ‚¨æœ€åˆå­˜å‚¨çš„ int å€¼å—ï¼Ÿå°†å…¶åŒ…è£…åœ¨é™æ€å®ç”¨æ–¹æ³•è°ƒç”¨`ValidationHelper.GetInteger(originalData, 0);`ä¸­ã€‚âœ”ï¸

å…³äºæ‰€æœ‰è¿™äº›è°ƒç”¨ï¼Œéœ€è¦æ³¨æ„çš„å…³é”®ç‚¹æ˜¯å®ƒä»¬é€šå¸¸æ˜¯åœ¨`static`ç±»ä¸Šçš„`static`æ–¹æ³•ã€‚

è¿™äº›ç±»ä¸éœ€è¦å®ä¾‹åŒ–ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç†è§£å®ƒä»¬çš„ä¾èµ–å›¾ï¼Œå®ƒä»¬æ˜¯é¢„å…ˆæ‰“åŒ…å¥½çš„ï¼Œéšæ—¶å¯ä»¥ä½¿ç”¨ï¼Œåªè¦æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®éƒ¨ç½²å®ƒä»¬çš„`.dll`,å®ƒä»¬å°±æ˜¯çœŸæ­£çš„å…¨å±€å€¼ã€‚

è¿™ç§è®¾è®¡çš„å«ä¹‰æ˜¯ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨çš„æ‰€æœ‰ä¸Šè¿°å·¥å…·ï¼Œç”¨äºåœ¨ Kentico CMS ä¸Šæ„å»ºå¤æ‚çš„ç½‘ç«™ï¼Œå¯ä»¥å°½å¯èƒ½ç®€å•åœ°è¢«å‘ç°å’Œåˆ©ç”¨ã€‚ğŸ™Œ

## [](#the-bad-skeletons-in-the-closet)å:ä¸å¯å‘Šäººçš„ç§˜å¯†ğŸ’€

å…¨çƒåŒ–çš„å¿«ä¹ä¸–ç•Œä¹Ÿæœ‰é»‘æš—çš„ä¸€é¢ã€‚

è¿™äº›ç±»å‹é€šå¸¸ä¸å®ƒä»¬çš„ä¾èµ–é¡¹ç´§å¯†è€¦åˆï¼Œæœ‰äº›åªèƒ½åœ¨ç‰¹å®šçš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨(é€šè¿‡ ASP.NET è¯·æ±‚ç®¡é“çš„å®æ—¶è¯·æ±‚)ï¼Œå¹¶ä¸”å¾ˆéš¾(å¦‚æœä¸æ˜¯ä¸å¯èƒ½çš„è¯)è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚ğŸ˜±

> ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘å°†æåˆ°â€œå¯æµ‹è¯•â€æˆ–â€œä¸å¯æµ‹è¯•â€çš„ä¸œè¥¿ï¼Œæˆ‘æŒ‡çš„æ˜¯å•å…ƒæµ‹è¯•ã€‚

è¿™ä¸€åæœå¹¶ä¸å®Œå…¨æ˜¯ Kentico çš„é”™ã€‚

ASP.NET Web Forms ä¸æ˜¯ä¸€ç§é¼“åŠ±æµ‹è¯•æˆ–åˆ†ç¦»æ¶æ„çš„æŠ€æœ¯ã€‚å®ƒæ—¨åœ¨ç¡®ä¿ Windows çª—ä½“æ¡Œé¢å¼€å‘äººå‘˜åœ¨æ„å»º web åº”ç”¨ç¨‹åºæ—¶è·å¾—æœ€ä½³çš„å·¥ä½œæ•ˆç‡ã€‚

Kentico å»ºç«‹åœ¨ web è¡¨å•ä¸Šï¼Œå› æ­¤å°†æ¨¡ä»¿å®ƒçš„æ¨¡å¼å’Œä¼˜å…ˆçº§â€”â€”æ˜“ç”¨æ€§ï¼ŒæŠ½è±¡å‡º web å¼€å‘çš„â€œWebâ€éƒ¨åˆ†ï¼Œä»¥åŠè®¿é—®é™æ€çš„â€œç¯å¢ƒä¸Šä¸‹æ–‡â€å…¨å±€å˜é‡ï¼Œå¦‚`HttpContext`ã€‚

> å¦‚æœä½ ä»¥å‰ä»æœªå¬è¯´è¿‡ç¯å¢ƒä¸Šä¸‹æ–‡ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»[è®¾è®¡æ¨¡å¼ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯åœ¨â€œç»“æœâ€éƒ¨åˆ†ï¼Œå…¶ä¸­å£°æ˜â€œä½¿ç”¨ç¯å¢ƒä¸Šä¸‹æ–‡å¯¹è±¡çš„ç³»ç»Ÿçš„ç»“æœå°†å–å†³äºé—®é¢˜åŸŸâ€ã€‚è¿™é‡Œçš„â€œé—®é¢˜åŸŸâ€ç›¸å½“äºâ€œçœŸæ­£è¿è¡Œçš„ ASP.NET ç«™ç‚¹å¤„ç†ä¸€ä¸ªä¸»åŠ¨ HTTP è¯·æ±‚â€ã€‚](https://aabs.wordpress.com/2007/12/31/the-ambient-context-design-pattern-in-net/)

ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¼€å§‹äº† Kentico å¼€å‘çš„æ–°æ—¶ä»£ï¼Œæˆ‘ä»¬çš„ä»£ç å°†åœ¨ Web Forms CMS æ¶æ„å’Œæ›´æ–°çš„ MVC æ¶æ„ä¸­è¿è¡Œã€‚

MVC è¢«è®¾è®¡æˆåˆ†ç¦»å…³æ³¨ç‚¹ï¼Œå°†å£°æ˜æ€§ UI ä»è¿‡ç¨‹é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶å…è®¸åƒæ§åˆ¶åè½¬ã€ä¾èµ–æ³¨å…¥å’Œç»„åˆè¿™æ ·çš„æ¨¡å¼ï¼Œè€Œä¸æ˜¯ç»§æ‰¿ã€‚ğŸ¤“

ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨ Kentico æä¾›çš„ç”¨äºé›†æˆ CMS çš„å¼ºå¤§çš„åº“å’Œå·¥å…·é›†ä¸ MVC å…è®¸(å’Œé¼“åŠ±)çš„æœ€ä½³å®è·µæ¶æ„æ¨¡å¼ä¹‹é—´æ¶èµ·ä¸€åº§æ¡¥æ¢ï¼ŸğŸ¥º

> å¹¶é Kentico çš„æ‰€æœ‰è¯¾ç¨‹éƒ½æœ‰è¿™äº›é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œ`ValidationHelper`æ˜¯é™æ€çš„ï¼Œä½†åŸºæœ¬ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå®ƒè¯•å›¾å°†ç±»å‹`object`çš„å€¼è½¬æ¢ä¸ºç‰¹å®šçš„ç±»å‹ã€‚å®ƒå¯ä»¥å®‰å…¨åœ°ç”¨åœ¨ä»£ç ä¸­çš„ä»»ä½•åœ°æ–¹ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶ä¼šç»™å‡ºä¸æµ‹è¯•æ—¶ç›¸åŒçš„ç»“æœã€‚

## [](#but-wait-theres-hope)ä½†æ˜¯ç­‰ä¸€ä¸‹ï¼Œè¿˜æœ‰å¸Œæœ›ï¼ğŸ¤—

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚ä½•å°è£…ä¼ ç»Ÿ Kentico åº”ç”¨ç¨‹åºä¸­æ–¹ä¾¿ä½†ä¸å¯æµ‹è¯•çš„éƒ¨åˆ†ã€‚

å¯¹äºæœ¬ä¾‹ï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹å¦‚ä½•è®¿é—® Kentico çš„è®¾ç½® APIï¼Œè¯¥ API å…è®¸è¿›è¡Œé…ç½®ï¼Œé€šå¸¸å­˜å‚¨åœ¨ä¸€ä¸ªç«™ç‚¹çš„`web.config`ä¸­çš„`<appSettings>`ä¸­ï¼Œç„¶åå­˜å‚¨åœ¨ Kentico çš„æ•°æ®åº“ä¸­ã€‚

æ‚¨é€šå¸¸å¦‚ä½•è·å–å½“å‰è¯·æ±‚ç«™ç‚¹çš„æ•°æ®ï¼ŸğŸ¤”å¯èƒ½æ˜¯ä»¥ä¸‹:

```
string settingValue = SettingsKeyInfoProvider.GetValue("someKeyString", SiteContext.CurrentSiteName); 
```

è™½ç„¶ Kentico ç¡®å®ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§åœ¨å•å…ƒæµ‹è¯•ä¸­ä½¿ç”¨`Fake<>`æ¥æµ‹è¯•`SettingsKeyInfoProvider.GetValue()` [çš„æ–¹æ³•ï¼Œä½†æ˜¯å´æ²¡æœ‰åŠæ³•å¯¹`SiteContext`è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚](https://docs.kentico.com/k12/custom-development/writing-automated-tests/faking-info-and-provider-objects-in-unit-tests)

`SiteContext`å’Œæ‰€æœ‰å…¶ä»–æ–¹ä¾¿çš„é™æ€`***Context`ç±»å‹éƒ½æ˜¯ä¸å¯æµ‹è¯•çš„ã€‚ä¸ºäº†æ­£ç¡®å·¥ä½œï¼Œå®ƒä»¬éœ€è¦ä¸€ä¸ªçœŸå®çš„ ASP.NET åº”ç”¨ç¨‹åºå’Œä¸€ä¸ªå®æ—¶è¯·æ±‚ï¼Œå› ä¸ºå®ƒä»¬æ˜¯é™æ€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½æ¨¡ä»¿å®ƒä»¬ã€‚ğŸ˜’

æˆ‘ä»¬å¦‚ä½•æ„å»ºè‡ªå·±çš„ API æ¥æä¾›å¯¹è¿™äº›æ•°æ®çš„è®¿é—®ï¼Œä½†åˆä¸ä¾èµ–äº`SiteContext`ï¼Ÿ

## [](#interfaces-are-here-to-help)ä»‹æ˜¯æ¥å¸®å¿™çš„

ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä»‹ç»äº†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯æœ€å¥½çš„å·¥å…·ï¼Œå®ƒä½¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ›´æ˜“æµ‹è¯•:æ¥å£ã€‚

åœ¨ C#ä¸­ï¼Œæ¥å£ä¸èƒ½ç”±`static`ç±»æ¥å®ç°ï¼Œæ‰€ä»¥è¿™ç«‹å³ä½¿æˆ‘ä»¬å…äºé™·å…¥æˆ‘ä»¬å·²ç»å‘ç°è‡ªå·±æ‰€å¤„çš„å¢ƒåœ°ã€‚

ä½†æ˜¯å®ƒä»¬ä¹Ÿæä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™æ’å…¥å¯¹ Kentico çš„`static`ç±»å’Œæ–¹æ³•çš„ç°æœ‰è°ƒç”¨ï¼Œè€Œä¸ç”¨æš´éœ²å®ç°ã€‚æ²¡å¿…è¦æŠŠå­©å­å’Œæ´—æ¾¡æ°´ä¸€èµ·å€’æ‰ã€‚æˆ‘ä»¬ä¸æƒ³é‡å†™ CMS æˆ‘ä»¬åªæ˜¯å¸Œæœ›å®ƒæ˜¯å¯æµ‹è¯•çš„ã€‚ğŸ˜‰