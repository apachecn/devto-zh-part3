# æ²¡æœ‰å¯†ç çš„ä¸–ç•Œ

> åŸæ–‡:[https://dev.to/yashints/a-world-without-passwords-21a](https://dev.to/yashints/a-world-without-passwords-21a)

è®©æˆ‘ä»¬é¢å¯¹ç°å®å§ï¼Œè¿™å¹´å¤´æ²¡æœ‰å¯†ç æˆ‘ä»¬æ˜¯æ´»ä¸ä¸‹å»çš„ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬çš„æ•´ä¸ªç½‘ç»œç”Ÿæ´»éƒ½ä¾èµ–äºå®ƒä»¬ã€‚ä½†æ˜¯æœ‰äº†å¯†ç ï¼Œä¸ä»…ç»™ç”¨æˆ·ï¼Œä¹Ÿç»™æˆ‘ä»¬å¼€å‘è€…å¸¦æ¥äº†ä¸€å¤§å †é—®é¢˜ã€‚

# [](#a-bitter-fact)æƒ¨ç—›çš„äº‹å®

å¤§å¤šæ•°äººéƒ½æœ‰ä¸€ä¸ªå¼±å¯†ç (å¾ˆå¯èƒ½æ˜¯ç›¸åŒçš„)ï¼Œç”¨äºä»–ä»¬æ‰€å±çš„è®¸å¤šç½‘ç«™ã€‚ç¤¾äº¤åª’ä½“ã€ç”µå­é‚®ä»¶ã€ç”Ÿäº§åŠ›å·¥å…·ï¼Œå‡¡æ˜¯ä½ èƒ½æƒ³åˆ°çš„ï¼Œå®ƒä»¬éƒ½æœ‰ä¸åŒçš„å¯†ç æ”¿ç­–ï¼Œå¤§å¤šæ•°ç”¨æˆ·éƒ½ä¼šæ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œä½¿ç”¨å¼±å¯†ç æˆ–å†™åœ¨ä¾¿åˆ©è´´ä¸Šçš„å¼ºå¯†ç æ¥ç»•è¿‡å¯†ç ğŸ¤·ğŸ½â€â™‚ï¸.

äº‹å®ä¸Šï¼Œ81%çš„æ•°æ®æ³„éœ²éƒ½æ˜¯ç”±é»‘å®¢æ”»å‡»å¼•èµ·çš„ï¼Œ[åˆ©ç”¨è¢«ç›—æˆ–å¼±å¯†ç ](https://www.verizonenterprise.com/resources/reports/2017_dbir_en_xg.pdf)ã€‚

# [](#there-is-a-better-way)æœ‰æ›´å¥½çš„åŠæ³•

ä½†æ˜¯å¤šäºäº† W3C(T2)å’Œ T4()çš„å·¨å¤§åŠªåŠ›ï¼Œæˆ‘ä»¬ä¸å¿…åœ¨ä»»ä½•äº‹æƒ…ä¸Šéƒ½ä½¿ç”¨å¯†ç ã€‚Web è®¤è¯ APIï¼Œåˆå`WebAuthn`æ˜¯ä¸€ä¸ªç›¸å½“[çš„æ–°è§„èŒƒ](https://w3c.github.io/webauthn/)ï¼Œå®ƒå¼•å…¥äº†ä¸€ç§æ–°çš„æ— éœ€å¯†ç çš„è®¤è¯æ–¹å¼ã€‚

è°·æ­Œã€å¾®è½¯ã€Yubico å’Œå…¶ä»–è¡Œä¸šå·¨å¤´éƒ½æ˜¯è¿™ä¸ªè§„èŒƒå¾—ä»¥å¹¿æ³›ä¼ æ’­çš„è´¡çŒ®è€…ã€‚è¿™ä¸ª API å…è®¸æœåŠ¡å™¨ä½¿ç”¨å…¬é’¥åŠ å¯†ä»£æ›¿å¯†ç æ¥æ³¨å†Œå’ŒéªŒè¯ç”¨æˆ·ã€‚

Windows Helloï¼Œè‹¹æœçš„è§¦æ§ IDï¼ŒYubikey è®¾å¤‡ï¼Œéƒ½æ˜¯ä¸éœ€è¦å¯†ç çš„ä¸åŒç±»å‹çš„è®¤è¯æœºåˆ¶çš„ä¾‹å­ã€‚ä»–ä»¬ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«æˆ–ç¡¬ä»¶è®¾å¤‡æ¥å®ç°è¿™ä¸€ç‚¹ã€‚

# [](#how-it-works)å·¥ä½œåŸç†

ä» 1000 è‹±å°ºå¼€å§‹ï¼Œæ‚¨å°†ä½¿ç”¨ä¸ºç½‘ç«™ç”Ÿæˆçš„[å¯†é’¥å¯¹(å…¬é’¥å’Œç§é’¥)](https://en.wikipedia.org/wiki/Public-key_cryptography)ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¯†ç ã€‚

ç§é’¥å®‰å…¨åœ°å­˜å‚¨åœ¨ç”¨æˆ·çš„è®¾å¤‡ä¸Šï¼Œè€Œå…¬é’¥ä¸éšæœºç”Ÿæˆçš„å‡­è¯ ID ä¸€èµ·è¢«å‘é€åˆ° web æœåŠ¡å™¨è¿›è¡Œå­˜å‚¨ï¼Œå¹¶åœ¨ä»¥åç”¨äºè®¤è¯è¯¥ç‰¹å®šç”¨æˆ·ã€‚

æ€»çš„æ¥è¯´ï¼ŒWebAuthn ä¾èµ–äºä¸‰ä¸ªä¸»è¦æ–¹é¢:

*   è®¤è¯è€…(è¿›è¡Œè®¤è¯å’ŒéªŒè¯çš„è®¾å¤‡)
*   ä¾èµ–æ–¹(web åº”ç”¨ç¨‹åºæ‰€æœ‰è€…)
*   æµè§ˆå™¨çš„ Web èº«ä»½éªŒè¯ API

æµç¨‹ç›¸å½“ç®€å•ï¼Œç¬¬ä¸€æ­¥æ˜¯æ³¨å†Œï¼Œç„¶åæ˜¯è®¤è¯ã€‚

## [](#registration-a-credential)æ³¨å†Œä¸€ä¸ªå‡­è¯

ä¸å¯†ç éªŒè¯æµç¨‹ç›¸åŒï¼Œå…¶ä¸­ web æœåŠ¡å™¨é€šå¸¸ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªè¡¨å•æ¥è¾“å…¥ä»–ä»¬çš„å¯†ç ï¼Œç„¶åå°†å¯†ç å‘é€å›æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ã€‚

å¯¹äº WebAuthnï¼Œæƒ…å†µç›¸å½“ç±»ä¼¼ï¼Œä½†æ˜¯ä¾èµ–æ–¹è¦æ±‚å…¬é’¥ï¼Œè€Œä¸æ˜¯è¦æ±‚å¯†ç ã€‚

| ![Registration using WebAuthn](../Images/4e18443fe847094d49c857279a548d96.png) |
| --- |
| *å›¾ç‰‡æ¥è‡ª WebAuthn.io* |

å½“æç¤ºç”¨æˆ·è¾“å…¥å‡­è¯æ—¶ï¼Œä½¿ç”¨`navigator.credentials.create()`:

```
const credential = await navigator.credentials.create(
  {
    publicKey: publicKeyCredentialCreationOptions,
  }
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨æƒ³çŸ¥é“`publicKeyCredentialCreationOptions`çœ‹èµ·æ¥åƒä»€ä¹ˆï¼Œå®ƒåŒ…å«äº†ä¸€å †å¼ºåˆ¶å’Œå¯é€‰å­—æ®µ:

```
const publicKeyCredentialCreationOptions = {
  challenge: Uint8Array.from(
    randomStringFromServer,
    c => c.charCodeAt(0)
  ),
  rp: {
    name: 'Google',
    id: 'accounts.google.com',
  },
  user: {
    id: Uint8Array.from('5T9AFCUZSL8', c =>
      c.charCodeAt(0)
    ),
    name: 'me@yashints.dev',
    displayName: 'Yaser',
  },
  pubKeyCredParams: [
    { alg: -7, type: 'public-key' },
  ],
  authenticatorSelection: {
    authenticatorAttachment: 'cross-platform',
  },
  timeout: 60000,
  attestation: 'direct',
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€‰é¡¹ä¸­æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯æŒ‘æˆ˜ã€‚å®ƒæ˜¯æœåŠ¡å™¨ä¸Šéšæœºç”Ÿæˆçš„å­—èŠ‚ï¼Œç”¨äºé˜²æ­¢å›å¤æ”»å‡»ã€‚

`rp`:è¡¨ç¤ºä¾èµ–æ–¹ï¼Œæ˜¯ç”¨æˆ·è¯•å›¾æ³¨å†Œçš„ web æœåŠ¡å™¨ã€‚

`user`:è¿™æ˜¯æ³¨å†ŒæœåŠ¡çš„æœ€ç»ˆç”¨æˆ·ã€‚`id`ç”¨äºå°†å…¬é’¥ä¸è¯¥ç”¨æˆ·ç›¸å…³è”ï¼Œä½†å»ºè®®ä¸è¦ä½œä¸ºä¸ªäººè¯†åˆ«ä¿¡æ¯ã€‚

`pubKeyCredPrams`:æŒ‡å®šæœåŠ¡å™¨å¯æ¥å—çš„å…¬é’¥ç±»å‹ã€‚

`authenticatorSelection`:å¯é€‰å­—æ®µï¼Œå¸®åŠ©ä¾èµ–æ–¹è¿›ä¸€æ­¥é™åˆ¶å…è®¸æ³¨å†Œçš„æˆæƒç ã€‚å¯èƒ½çš„å€¼(`platform`åƒ Windows Helloï¼Œæˆ–è€…`cross-platform`åƒ Yubikey)å¯ä»¥åœ¨è§„æ ¼ä¸Šæ‰¾åˆ°[ã€‚](https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection)

`timeout`:ç”¨æˆ·å¿…é¡»å“åº”æ³¨å†Œæç¤ºçš„æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚

`attestation`:ä»è®¤è¯å™¨è¿”å›ï¼ŒåŒ…å«å¯ç”¨äºè·Ÿè¸ªç”¨æˆ·çš„ä¿¡æ¯ã€‚å®ƒè¡¨æ˜è¯¥è¯æ˜å¯¹è¯¥æ³¨å†Œäº‹ä»¶æœ‰å¤šé‡è¦ã€‚æ¯”å¦‚ç”¨äº†`none`ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¸å…³å¿ƒã€‚`indirect`è¡¨ç¤ºæœåŠ¡å™¨å°†å…è®¸åŒ¿åè¯æ˜æ•°æ®ã€‚`direct`è¡¨ç¤ºæœåŠ¡å™¨éœ€è¦æ¥è‡ªè®¤è¯è€…çš„æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™æ˜¯å…³äºæ³¨å†Œæ—¶ç”¨æˆ·çš„éšç§ã€‚

ä»`create()`è°ƒç”¨è¿”å›çš„å¯¹è±¡åŒ…å«ä¸€ä¸ªå…¬é’¥å’Œå…¶ä»–ç”¨äºéªŒè¯ç”¨æˆ·çš„å±æ€§:

```
console.log(credential);

PublicKeyCredential {
    id: 'ADSUllKQmbqdGtpu4sjseh4cg2TxSvrbcHDTBsv4NSSX9...',
    rawId: ArrayBuffer(59),
    response: AuthenticatorAttestationResponse {
        clientDataJSON: ArrayBuffer(121),
        attestationObject: ArrayBuffer(306),
    },
    type: 'public-key'
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#verifying-the-registration-data-by-relying-party)ä¾èµ–æ–¹éªŒè¯æ³¨å†Œæ•°æ®

ä¸€æ—¦å…¬é’¥è¿åŒæ³¨å†Œæ•°æ®çš„å…¶ä»–å±æ€§ä¸€èµ·è¢«æ¥æ”¶åˆ°æœåŠ¡å™¨ï¼Œ[å°±æœ‰ä¸€ä¸ªè¿‡ç¨‹](https://w3c.github.io/webauthn/#registering-a-new-credential)æ¥éªŒè¯è¯¥æ•°æ®ã€‚

å½“ç„¶ï¼Œå®ç°å–å†³äºæ‚¨ä½¿ç”¨çš„è¯­è¨€ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³çŸ¥é“å¦‚ä½•å®ç°è¿™äº›æ­¥éª¤ï¼Œè¿™é‡Œæœ‰ä¸€äº›ä¾‹å­ã€‚Duo Labs åœ¨ [Go](https://github.com/duo-labs/webauthn) å’Œ [Python](https://github.com/duo-labs/py_webauthn) ä¸­æä¾›äº†å®Œæ•´çš„å®ç°ã€‚

## [](#authenticating-with-webauthn)ä½¿ç”¨ WebAuthn è¿›è¡Œè®¤è¯

å®Œæˆæ³¨å†Œåï¼Œç”¨æˆ·å°±å¯ä»¥é€šè¿‡ç½‘ç«™çš„è®¤è¯äº†ã€‚åœ¨æ³¨å†Œè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è·å¾—äº†ä¸€ä¸ªå£°æ˜ï¼Œè¡¨æ˜ä»–ä»¬æ‹¥æœ‰ç§é’¥ã€‚è¿™åŒ…å«ä½¿ç”¨ä¸Šè¿°ç§é’¥çš„ç­¾åã€‚Web æœåŠ¡å™¨åœ¨æ³¨å†Œè¿‡ç¨‹ä¸­ä½¿ç”¨å…¬é’¥æ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚

èº«ä»½éªŒè¯æµç¨‹å¦‚ä¸‹æ‰€ç¤º:

| ![Authentication process](../Images/734135e736f728f245779357dcc879b6.png) |
| --- |
| *å›¾ç‰‡æ¥è‡ª WebAuthn.io* |

è°ƒç”¨`navigator.credentials.get()`æ–¹æ³•æ¥ç”Ÿæˆä¸€ä¸ªæ–­è¨€ï¼Œä»¥è¯æ˜ç”¨æˆ·æ‹¥æœ‰ç§é’¥ã€‚è¿™å°†æ£€ç´¢æ³¨å†ŒæœŸé—´ç”Ÿæˆçš„åŒ…å«ç­¾åçš„å‡­æ®ã€‚

```
const credential = await navigator.credentials.get(
  {
    publicKey: publicKeyCredentialRequestOptions,
  }
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`publicKeyCredentialRequestOptions`å¯¹è±¡åŒ…å«è®¸å¤šç”±æœåŠ¡å™¨æŒ‡å®šçš„å¼ºåˆ¶å’Œå¯é€‰å±æ€§:

```
const publicKeyCredentialRequestOptions = {
  challenge: Uint8Array.from(
    randomStringFromServer,
    c => c.charCodeAt(0)
  ),
  allowCredentials: [
    {
      id: Uint8Array.from(credentialId, c =>
        c.charCodeAt(0)
      ),
      type: 'public-key',
      transports: ['usb', 'ble', 'nfc'],
    },
  ],
  timeout: 60000,
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸ªå¯¹è±¡ä¸­æœ€æœ‰è¶£çš„éƒ¨åˆ†æ˜¯ä¼ è¾“å±æ€§ã€‚æœåŠ¡å™¨å¯ä»¥é€‰æ‹©æŒ‡ç¤ºå®ƒå–œæ¬¢çš„ä¼ è¾“æ–¹å¼ï¼Œå¦‚ USBã€NFC å’Œè“ç‰™ã€‚

è¿”å›çš„å¯¹è±¡æ˜¯ä¸€ä¸ª`PublicKeyCredential`å¯¹è±¡ï¼Œä½†ä¸ä¹‹å‰æ³¨å†Œçš„å¯¹è±¡ç•¥æœ‰ä¸åŒã€‚

```
console.log(assertion);

PublicKeyCredential {
    id: 'SSX9lKQmbqdGtbcHDTBsvpu4sjseh4cg2TxSvr4ADSUlN...',
    rawId: ArrayBuffer(59),
    response: AuthenticatorAssertionResponse {
        authenticatorData: ArrayBuffer(191),
        clientDataJSON: ArrayBuffer(118),
        signature: ArrayBuffer(70),
        userHandle: ArrayBuffer(10),
    },
    type: 'public-key'
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å…³äºæ­¤å¯¹è±¡[çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒè§„æ ¼](https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-userhandle)ã€‚

### [](#validating-authentication-data)éªŒè¯è®¤è¯æ•°æ®

è·å–æ–­è¨€åï¼Œå®ƒè¢«å‘é€åˆ°æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ã€‚éªŒè¯ä¹‹åï¼Œç”¨å­˜å‚¨çš„å…¬é’¥éªŒè¯ç­¾åã€‚

```
const storedCredential = await getCredentialFromDatabase(
  userHandle,
  credentialId
)

const signedData =
  authenticatorDataBytes + hashedClientDataJSON

const signatureIsValid = storedCredential.publicKey.verify(
  signature,
  signedData
)

if (signatureIsValid) {
  return 'Hooray! User is authenticated! ğŸ‰'
} else {
  return 'Verification failed. ğŸ˜­'
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#further-reading-and-resources)è¿›ä¸€æ­¥é˜…è¯»å’Œèµ„æº

ä»¥ä¸‹èµ„æºæ˜¯ä»»ä½•è¿›ä¸€æ­¥é˜…è¯»çš„è‰¯å¥½èµ·ç‚¹:

*   [Webauthn.io](https://webauthn.io) : Due Labs åˆ›å»ºäº†è¿™ä¸ªæœ‰ç”¨çš„èµ„æºï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰æºä»£ç å’Œå¸¦æœ‰æ¼‚äº®æ’å›¾çš„ç¤ºä¾‹ç”¨ä¾‹ã€‚
*   WebAuthn å’Œ FIDO2 æ¡†æ¶çš„å‘å±•:ä¸€ç¯‡å†…å®¹ä¸°å¯Œçš„åšå®¢æ–‡ç« ï¼Œä»‹ç»äº†ä¸€äº›è¿›å±•ï¼Œå¹¶å±•ç¤ºäº†æ¯ä¸ªä¸»è¦æµè§ˆå™¨å’Œè´¡çŒ®è€…å¯¹è¯¥é¢†åŸŸçš„å…¼å®¹æ€§ã€‚
*   [æºä»£ç ](https://github.com/duo-labs/webauthn.io):è¿™ä¸ª GitHub repo åŒ…å«äº† Due Labs ä¸ºå±•ç¤ºå…¶èƒ½åŠ›è€Œåˆ›å»ºçš„æ‰€æœ‰æºä»£ç ã€‚
*   äº’è”ç½‘çš„å¤§æ—¥å­: [W3C æ ‡å‡†åŒ– WebAuthn](https://www.yubico.com/2019/03/w3c-standardizes-webauthn/)
*   Yubico çš„æ¼”ç¤ºç«™ç‚¹:ä»æœ€ç»ˆç”¨æˆ·çš„è§’åº¦æ¼”ç¤ºè¯¥æµç¨‹

# [](#summary)æ€»ç»“

æˆ‘ä»¬çœ‹åˆ°äº†å®ç°è¿™ä¸ªæƒŠäººçš„åŠŸèƒ½æ˜¯å¤šä¹ˆç®€å•å’Œç›´æ¥ï¼Œæˆ‘å¼ºçƒˆå»ºè®®å¦‚æœä½ æ­£åœ¨åšä¸€ä¸ªç»¿è‰²é¢†åŸŸçš„é¡¹ç›®ï¼Œä¸€å®šè¦è€ƒè™‘å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œç»™ç”¨æˆ·æ— å¯†ç ç”Ÿæ´»çš„èƒ½åŠ›ğŸ”¥ğŸ‘ŠğŸ»ã€‚å¯¹äºç›®å‰çš„äº§å“ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªè½¬æŠ˜ç‚¹ï¼Œé€šè¿‡ç®€åŒ–æµç¨‹ä¸­æœ€é‡è¦çš„éƒ¨åˆ†æ¥è·å¾—æ›´å¤šçš„ç”¨æˆ·ğŸ˜Šã€‚