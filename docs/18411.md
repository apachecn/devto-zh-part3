# PHP-OpenBSD 6.4 ä¸Šçš„ FPM 7.2

> åŸæ–‡:[https://dev.to/nabbisen/php-fpm-on-openbsd-2iof](https://dev.to/nabbisen/php-fpm-on-openbsd-2iof)

### [](#summary)æ€»ç»“

[PHP-FPM](https://php-fpm.org/) ï¼ŒPHP FastCGI è¿›ç¨‹ç®¡ç†å™¨ï¼Œæ˜¯ç°ä»Š OpenBSD åŒ…ä¸­ [PHP](https://www.php.net/) åŒ…çš„ä¸€éƒ¨åˆ†ã€‚
æ‰€ä»¥å®‰è£… PHP ( `php-7.?`ç”±äºç‰ˆæœ¬åŸå› )ä¼šè‡ªåŠ¨é™„å¸¦`php7?_fpm`ğŸ’ƒæˆ‘ä¼šåœ¨è¿™ç¯‡æ–‡ç« ä¸­å‘Šè¯‰ä½ å¦‚ä½•è®¾ç½®å®ƒğŸ˜ƒ

##### [](#environment)ç¯å¢ƒ

*   æ“ä½œç³»ç»Ÿ:OpenBSD 6.4 amd64
*   PHP: 7.2

<center>âœ¿ âœ¿ âœ¿</center>

### [](#installation)å®‰è£…

ç¬¬ä¸€æ­¥æ˜¯å®‰è£… PHP åŒ…:

```
#  pkg_add php
Ambiguous: choose package for php a       0: <None>  1: php-5.6.38p0
        2: php-7.0.32p1
        3: php-7.1.22
        4: php-7.2.10
Your choice: 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘é€‰æ‹©â€œ4â€æ˜¯å› ä¸º PHP ç‰ˆæœ¬çš„æ¯ä¸ªæ”¯æŒæœ¯è¯­[ã€‚](https://www.php.net/supported-versions.php)

ç„¶åè¿™äº›ç›®å½•/æ–‡ä»¶è¢«åˆ¶ä½œ:

```
$  ls /etc/php*
/etc/php-7.2.ini          /etc/php-fpm.conf

/etc/php-7.2:
server
/etc/php-7.2.sample:
gd.ini       opcache.ini 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å—¯ï¼Œ`/etc/php-7.2.sample`ä¸­çš„`.ini`æ–‡ä»¶æ˜¯ PHP æ‰©å±•ã€‚
æ ¹æ®éœ€è¦ï¼Œå°†æ¯ä¸ªå‰¯æœ¬å¤åˆ¶åˆ°`/etc/php-7.2/`æ¥æ¿€æ´»æ‰©å±•:

```
#  ln -sf /etc/php-7.2.sample/%target-ini-files% /etc/php-7.2/ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ ¹æ®éœ€è¦ç¼–è¾‘`/etc/php-7.2.ini`ã€‚
æ¯”å¦‚:

```
; Maximum allowed size for uploaded files.
; http://php.net/upload-max-filesize
;upload_max_filesize = 2M upload_max_filesize = 5M 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­¤å¤–ï¼Œæœ¬æ‰‹å†Œä¹Ÿä½œä¸º`/usr/local/share/doc/pkg-readmes/php-7.2`å®‰è£…ï¼Œå…¶ä¸­å£°æ˜:

> ä¸»è¦çš„ OpenBSD php åŒ…åŒ…æ‹¬ php-fpmï¼ŒFastCGI è¿›ç¨‹ç®¡ç†å™¨ã€‚ç®¡ç† FastCGI è¿›ç¨‹æ± :å¯åŠ¨/é‡å¯å®ƒä»¬ï¼Œå¹¶æ ¹æ®é…ç½®ç»´æŠ¤æœ€å°å’Œæœ€å¤§æ•°é‡çš„å¤‡ç”¨è¿›ç¨‹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ rcctl(8)åœ¨å¼•å¯¼æ—¶å¯ç”¨ php-fpmï¼Œå¹¶åœ¨è¿è¡Œæ—¶å¯åŠ¨å®ƒ:2
> 
> rcctl ä½¿èƒ½ php72_fpm
> rcctl å¯åŠ¨ php72_fpm

å¥½çš„ã€‚æˆ‘ä»¬å‡†å¤‡å¥½äº†ã€‚
è®©æˆ‘ä»¬å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹:

```
#  rcctl enable php72_fpm
#  rcctl start php72_fpm 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ•…éšœæ’é™¤:å¦‚æœ`php72_fpm`(æˆ–`php71_fpm`)[æ— æ³•å¯åŠ¨ï¼Œå¯èƒ½æ˜¯å·²çŸ¥çš„ bug](https://obsd.solutions/en/blog/2018/11/24/fixing-php72_fpm-on-openbsd-64-doesnt-work-by-default/index.html) ã€‚*

### [](#usage)ç”¨æ³•

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦å‡†å¤‡ä¸€ä¸ª web æœåŠ¡å™¨ã€‚
æ‰€ä»¥è®©æˆ‘ä»¬ç¼–è¾‘ [`/etc/httpd.conf`](https://man.openbsd.org/httpd.conf.5) ä»¥åœ¨[æœåŠ¡å™¨](https://man.openbsd.org/httpd.conf.5#SERVERS)éƒ¨åˆ†æ·»åŠ `fastcgi socket`å¦‚ä¸‹:

```
types {
    include "/usr/share/misc/mime.types"
}

ext_addr="egress"

server "default" {
    listen on $ext_addr port 80

    root "/htdocs"
    directory index index.php

    location "*.php*" {
        fastcgi socket "/run/php-fpm.sock"
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ³¨æ„ [`chroot`](https://man.openbsd.org/httpd.conf.5#chroot) åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­èµ·ä½œç”¨ã€‚
å› æ­¤ï¼Œ`/etc/httpd.conf`ä¸­çš„`fastcgi socket "/run/php-fpm.sock"`å…¶å®å°±æ˜¯`fastcgi socket "/var/www/run/php-fpm.sock"`çš„æ„æ€ã€‚
è¿™å’Œ`root "/htdocs"`çš„æ„æ€`"/var/www/htdocs"`æ˜¯ä¸€æ ·çš„ã€‚

### [](#testing)æµ‹è¯•

è®©æˆ‘ä»¬æŠŠ`/var/www/htdocs/index.php`åšæˆè¿™æ ·æ¥æµ‹è¯•:

```
#  echo "<?php phpinfo(); ?>" > /var/www/htdocs/index.php
#  # delete the file above afterwards as needed 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åæµè§ˆä½ çš„ä¸»æœºå°±ä¼šçœ‹åˆ°æ•´ä¸ª phpinfoï¼

<center>âœ¿ âœ¿ âœ¿</center>

å¿«ä¹æœåŠ¡ğŸ’ƒ