# ä¼˜åŒ– javascript

> åŸæ–‡ï¼š<https://dev.to/yashints/optimising-javascript-1f8b>

æœ€è¿‘ï¼Œæˆ‘æœ‰æœºä¼šåœ¨æ‚‰å°¼ NDC åšäº†ä¸€ä¸ªå…³äºç½‘ç»œæ€§èƒ½çš„æ¼”è®²ï¼Œå¾—åˆ°äº†å¾ˆå¥½çš„åé¦ˆã€‚

è¿™å¯å‘äº†æˆ‘å°±æˆ‘åœ¨é‚£æ¬¡æ¼”è®²ä¸­æ¶‰åŠçš„æ¯ä¸ªä¸»é¢˜å†™äº†ä¸€ç³»åˆ—çš„å¸–å­ï¼Œè°çŸ¥é“å‘¢ï¼Œä¹Ÿè®¸æœ‰ä¸€å¤©è¿™äº›å¸–å­ä¸­çš„æ¯ä¸€ä¸ªéƒ½ä¼šæˆä¸ºä¸€æ¬¡å•ç‹¬çš„æ¼”è®²ğŸ˜ƒã€‚

æ‰€æœ‰å…¶ä»–é›¶ä»¶:

[å…³äº HTML å’Œ CSS çš„ç¬¬ 1 éƒ¨åˆ†](https://dev.to/blog/2018/09/29/web-perf-1)

[ç¬¬ 2 éƒ¨åˆ†ä½¿ç”¨é¢„åŠ è½½/é¢„å–æ¥å¢åŠ åŠ è½½æ—¶é—´](https://dev.to/blog/2018/10/06/web-perf-2)

[ç¬¬å››éƒ¨åˆ†å›¾åƒä¼˜åŒ–](https://dev.to/blog/2018/11/12/web-perf-4)

[ç¬¬äº”éƒ¨åˆ†ç½‘ç»œå­—ä½“ä¼˜åŒ–](https://dev.to/blog/2018/11/23/web-perf-5)

æ˜¯æ—¶å€™çœ‹çœ‹æˆ‘ä»¬èƒ½ä¸ºè€æœ‹å‹ JavaScript åšäº›ä»€ä¹ˆäº†ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ã€‚

# åˆ‡æ¢åˆ° HTTP/2

éšç€è¶Šæ¥è¶Šå¤šçš„ä¸»æœºæä¾›å•†æ”¯æŒ [HTTP/2](https://en.wikipedia.org/wiki/HTTP/2) ï¼Œç°åœ¨æ˜¯è½¬è€Œä½¿ç”¨è¿™ç§åè®®å¹¶ä»å…¶å¤ç”¨ç‰¹æ€§ä¸­è·ç›Šçš„å¥½æ—¶æœºã€‚å°±æ€§èƒ½è€Œè¨€ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¸éœ€è¦å°†æ‰€æœ‰çš„ JavaScript æ†ç»‘æˆå¤§çš„åŒ…æ¥å‡å°‘å¯¹æœåŠ¡å™¨çš„è°ƒç”¨æ¬¡æ•°ã€‚

ä½¿ç”¨ä¸ºå¤„ç†å¤§é‡è¯·æ±‚è€Œè®¾è®¡çš„ **HTTP/2** ï¼Œæ‚¨ç°åœ¨å¯ä»¥å¢åŠ å‘ˆç°é¡µé¢æ‰€éœ€çš„æ–‡ä»¶æ•°é‡ã€‚ä¸è¿‡åˆ†:

> å¥½äº‹è¿‡çŠ¹ä¸åŠã€‚

# å¼‚æ­¥&å»¶è¿Ÿ

æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼ŒJavaScript å’Œ CSS ä¸€æ ·æ˜¯ä¸€ä¸ª**æ¸²æŸ“é˜»å¡**å…ƒç´ ã€‚è¿™ä»…ä»…æ„å‘³ç€æµè§ˆå™¨éœ€è¦ç­‰å¾…å®ƒçš„åŠ è½½å’Œæ‰§è¡Œï¼Œç„¶åæ‰èƒ½è§£æ`HTML`æ–‡æ¡£çš„å…¶ä½™éƒ¨åˆ†ã€‚

è¿™æå¤§åœ°å¢åŠ äº†æˆ‘ä»¬ç¬¬ä¸€æ¬¡æœ‰æ„ä¹‰çš„ç—›è‹¦ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªä¸å¸¸ç”¨ä½†éå¸¸æœ‰æ•ˆçš„åŠŸèƒ½ã€‚

### æ­£å¸¸æ‰§è¡Œ

å½“æ‚¨ä½¿ç”¨`<script>`åŠ è½½ JavaScript æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šä¸­æ–­æ–‡æ¡£çš„è§£æã€‚æµè§ˆå™¨è·å–èµ„æºï¼Œæ‰§è¡Œè¯¥èµ„æºï¼Œç„¶åç»§ç»­é…å¯¹:

[![Normal execution](img/0be6de8b64a984cd0ccf3a3261f6d50d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--GjessZ-2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://yashints.dev/static/d562503683c7b6a3c0ee5ed90085f60c/b4133/normaljsexec.jpg)

### `Async`å±æ€§

`Async`å±æ€§ç”¨äºè¡¨ç¤ºè¯¥èµ„æºå¯ä»¥å¼‚æ­¥æ‰§è¡Œã€‚è§£æä¸éœ€è¦æš‚åœï¼Œå®ƒå¯ä»¥åœ¨èµ„æºä»ç½‘ç»œä¸­è·å–å¹¶å‡†å¤‡å¥½ä¹‹åç«‹å³è¿›è¡Œã€‚

```
<script async src="script.js"> 
```

Enter fullscreen mode Exit fullscreen mode

è¯¥å±æ€§åªèƒ½ç”¨äºå¤–éƒ¨ JavaScript æ–‡ä»¶ã€‚æ–‡ä»¶å°†è¢«å¹¶è¡Œä¸‹è½½ï¼Œä¸€æ—¦ä¸‹è½½å®Œæˆï¼Œå°†æš‚åœè§£æä»¥æ‰§è¡Œè„šæœ¬:

[![Async execution](img/2915f7a554f454ae42b52224a7a58982.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--bk14wi9v--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://yashints.dev/static/7d5975f30349a8282be6f1d8b956cde5/b4133/asyncjs.jpg)

### `Defer`å±æ€§

`Defer`å±æ€§ç”¨äºå‘Šè¯‰æµè§ˆå™¨åœ¨è§£ææ•´ä¸ªæ–‡æ¡£åæ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚

```
<script defer src="script.js"> 
```

Enter fullscreen mode Exit fullscreen mode

åƒ`Async`ä¸€æ ·ï¼Œè¿™ä¸ªæ–‡ä»¶è¢«å¹¶è¡Œä¸‹è½½ï¼Œä½†æ˜¯åªæœ‰å½“æ•´ä¸ª`HTML`æ–‡æ¡£è¢«è§£ææ—¶æ‰æ‰§è¡Œ:

[![Deferred execution](img/dbff6a3e2b921bc2280190d95344a912.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--hWErzYlO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://yashints.dev/static/61e576b9875fc024a3679482e7e2398a/b4133/deferjs.jpg)

æœ€åï¼Œè®°å¾—å°†æ‰€æœ‰çš„`script`æ ‡ç­¾æ”¾åœ¨`body`çš„æœ«å°¾ï¼Œä»¥é˜²æ­¢è§£æ`HTML`æ—¶çš„æ›´å¤šå»¶è¿Ÿã€‚

è‡³äºæµè§ˆå™¨æ”¯æŒï¼Œå¹¸è¿çš„æ˜¯æ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½å®Œå…¨æ”¯æŒè¿™äº›å±æ€§ã€‚

# ä»£ç æ‹†åˆ†

å¤§å¤šæ•°ç°ä»£ç½‘ç«™ä¼šå°†æ‰€æœ‰çš„ JavaScript æ†ç»‘æˆä¸€ä¸ªï¼Œå¯¼è‡´åŠ è½½æ—¶é—´å¢åŠ ï¼Œå½±å“åŠ è½½æ€§èƒ½ã€‚

ä»£ç åˆ†å‰²å…è®¸æ‚¨å°†åº”ç”¨ç¨‹åºä»£ç åˆ†å‰²æˆå•ç‹¬çš„å—ï¼Œå¹¶åœ¨éœ€è¦æ—¶å»¶è¿ŸåŠ è½½å®ƒä»¬ã€‚è¿™ä¹Ÿæ„å‘³ç€å®¢æˆ·ç«¯æ‰€éœ€çš„ä»£ç æœ€å°‘ï¼Œå¹¶ç¼©çŸ­äº†é¡µé¢åŠ è½½æ—¶é—´ã€‚

æ‚¨å¯ä»¥å°†ä»£ç åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:

*   ä¾›åº”å•†ä»£ç 
*   å…¥å£ç‚¹
*   åŠ¨æ€åˆ†è£‚

## ä¾›åº”å•†ä»£ç 

ä¾›åº”å•†ä»£ç ï¼Œå¦‚è§’åº¦ã€åä½œç”¨åŠ›ã€åŠ›çŸ©ç­‰ã€‚å¯ä»¥å’Œä½ çš„ä¸»ä»£ç åˆ†å¼€ã€‚Webpack å®Œå…¨æ”¯æŒè¿™ç§æ–¹æ³•å’Œå…¶ä»–æ–¹æ³•ã€‚è¿™ç§æŠ€æœ¯å…è®¸æ‚¨æ›´å¥½åœ°æ§åˆ¶åŒ…çš„ç¼“å­˜å¤±æ•ˆï¼Œæ— è®ºä½•æ—¶æ‚¨çš„åº”ç”¨ç¨‹åºæˆ–ä¾›åº”å•†ä»£ç ç›¸äº’ç‹¬ç«‹åœ°æ›´æ”¹ã€‚

è¿™æ˜¯æ¯ä¸ª app éƒ½åº”è¯¥åšçš„ã€‚

## è¿›å…¥ç‚¹

è¿™ç§æŠ€æœ¯é€šè¿‡åº”ç”¨ç¨‹åºä¸­çš„å…¥å£ç‚¹æ¥åˆ†éš”ä»£ç ã€‚å½“åƒ webpack è¿™æ ·çš„æ†ç»‘å™¨æ„å»ºåº”ç”¨ç¨‹åºçš„ä¾èµ–æ ‘æ—¶ï¼Œè¿™äº›ç‚¹å°±æ˜¯å®ƒä»¬çš„èµ·ç‚¹ã€‚

è¿™æ˜¯è¿„ä»Šä¸ºæ­¢åˆ†å‰²ä»£ç æœ€ç®€å•çš„æ–¹æ³•ï¼Œä½†æ˜¯å®ƒæ˜¯æ‰‹åŠ¨çš„ï¼Œå¹¶ä¸”æœ‰ä¸€äº›ç¼ºé™·:

*   å¦‚æœå…¥å£ç‚¹ä¹‹é—´æœ‰ä»»ä½•é‡å¤çš„æ¨¡å—ï¼Œå®ƒä»¬å°†è¢«æ†ç»‘åœ¨ä¸¤ä¸ªå…¥å£ç‚¹ä¸­ã€‚
*   å®ƒä¸å¤Ÿçµæ´»ï¼Œå¹¶ä¸”ä¸èƒ½ç”¨äºåŠ¨æ€æ‹†åˆ†ä»£ç å’Œåº”ç”¨ç¨‹åºé€»è¾‘ã€‚

è¿™ç§æŠ€æœ¯ä¸é€‚ç”¨äºå®¢æˆ·ç«¯è·¯ç”±æˆ–è€…æ··åˆäº†æœåŠ¡å™¨ç«¯å‘ˆç°å’Œå•é¡µé¢åº”ç”¨çš„æƒ…å†µã€‚

## åŠ¨æ€æ‹†åˆ†

ä½¿ç”¨åŠ¨æ€`import`æ—¶å•ç‹¬ç¼–ç ã€‚è¿™æ˜¯å•é¡µåº”ç”¨ç¨‹åºçš„æœ€ä½³é€‰æ‹©ã€‚åœ¨æ‚¨çš„æ°´ç–—ä¸­å¿ƒä¸ºä¸åŒçš„è·¯çº¿è®¾ç½®ä¸åŒçš„æ¨¡å—å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚

## æˆ‘ç”šè‡³éœ€è¦ä»£ç æ‹†åˆ†å—ï¼Ÿ

è¿™æ˜¯ä½ å¬åˆ°æˆ‘è¯´è§†æƒ…å†µè€Œå®šçš„è®¸å¤šæ¬¡ä¹‹ä¸€(æ¯•ç«Ÿæˆ‘æ˜¯ä¸€åé¡¾é—®ğŸ˜‰).å¦‚æœä½ çš„åº”ç”¨æœ‰å¾ˆå¤šç‹¬ç«‹çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¤§é‡ä½¿ç”¨æ¡†æ¶å’Œåº“ï¼Œè¿™ä¸ªç­”æ¡ˆå¾ˆå¯èƒ½æ˜¯ **YES** ã€‚

ä½†æ˜¯ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±å¯¹åº”ç”¨ç»“æ„å’Œä»£ç çš„ç†è§£æ¥å†³å®šæ˜¯å¦éœ€è¦å®ƒã€‚

# æ˜æ™ºåœ°å¯¼å…¥

å¦‚æœæ‚¨ä½¿ç”¨`npm`æˆ–å…¶ä»–åŒ…ç®¡ç†ç³»ç»Ÿæ¥ç®¡ç†æ‚¨çš„ä¾èµ–é¡¹ï¼Œé‚£ä¹ˆæ‚¨çš„ buid æ–‡ä»¶å¤¹ä¸­ä¼šæœ‰å¾ˆå¤šå¤šä½™çš„å’Œä¸éœ€è¦çš„æ–‡ä»¶ã€‚

å½“ä½¿ç”¨ä¸€ä¸ªæ¡†æ¶æˆ–è€…ä¸€ä¸ªåº“çš„æ—¶å€™ï¼Œç¡®ä¿ä½ è°ƒæŸ¥ä»–ä»¬æ˜¯å¦æœ‰ä½ å¯ä»¥å¯¼å…¥çš„ç‹¬ç«‹æ¨¡å—ï¼Œå¦‚æœæœ‰ï¼Œåªå¯¼å…¥ä½ éœ€è¦çš„ã€‚

ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬å‡è®¾æ‚¨ä½¿ç”¨äº†[ä¸‹åˆ’çº¿](https://underscorejs.org/)ï¼Œä½†æ˜¯åªä½¿ç”¨äº†`groupBy`ã€`shuffle`å’Œ`partition`ã€‚å¤§å¤šæ•°äººéƒ½æ˜¯è¿™æ ·å¯¼å…¥æ•´ä¸ªåº“çš„:

```
import * as _ from 'underscore' 
```

Enter fullscreen mode Exit fullscreen mode

ç›¸åï¼Œä½ å¯ä»¥åªå¯¼å…¥ä½ éœ€è¦çš„:

```
import {
  groupBy,
  shuffle,
  partition,
} from 'underscore' 
```

Enter fullscreen mode Exit fullscreen mode

è¿™æ ·ä½ åªéœ€è¦å¸¦ä½ éœ€è¦çš„ä¸œè¥¿ï¼Œæ‰“åŒ…å·¥ä¼šå¸®ä½ å¤„ç†å‰©ä¸‹çš„ä¸œè¥¿ã€‚æ‚¨çš„æ€»åŒ…å¤§å°ï¼Œå› æ­¤æ‚¨çš„é¡µé¢åŠ è½½æ—¶é—´å°†å‡å°‘ã€‚

# èŠ‚æµå’Œå»æŠ–

å¥½äº†ï¼Œå…³äºå°ºå¯¸å·²ç»è¯´å¾—å¤Ÿå¤šäº†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹è¿˜æœ‰å“ªäº›åœ°æ–¹å¯ä»¥æ”¹è¿›æˆ‘ä»¬çš„æ€§èƒ½ã€‚

å¾ˆå¤šæ—¶å€™ä½ å¿…é¡»æ·»åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨æ¥åšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚ç›‘å¬é¡µé¢æ»šåŠ¨ã€‚ç„¶åæˆ‘ä»¬å¿˜è®°äº†ä¾¦å¬å™¨åœ¨æ¯æ¬¡äº‹ä»¶è¢«è§¦å‘æ—¶è§¦å‘ã€‚

```
window.addEventListener('scroll', function() {
  console.log('page scrolled')
}) 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ¯å½“ä½ æ»šåŠ¨æ—¶ï¼Œæ¶ˆæ¯è¢«æ‰“å°åˆ°æ§åˆ¶å°ã€‚å‡è®¾æ‚¨åœ¨å›è°ƒå‡½æ•°ä¸­æœ‰ä¸€äº›ç¹é‡æ“ä½œï¼Œè¿™å°†å˜æˆä¸€ä¸ªå¾ˆå¤§çš„æ€§èƒ½ç“¶é¢ˆã€‚

å¦‚æœæ‚¨ä¸èƒ½åˆ é™¤äº‹ä»¶ç›‘å¬å™¨å¹¶ä½¿ç”¨ä¸åŒæ–¹æ³•ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨`debounce`æˆ–`throttle`æ¥ç¼“è§£è¿™ç§æƒ…å†µã€‚

## å»æŠ–

è¯¥ç‰¹æ€§å¼ºåˆ¶å‡½æ•°è°ƒç”¨åœ¨ä¸Šæ¬¡è°ƒç”¨åè¿‡äº†ä¸€æ®µæ—¶é—´åæ‰ä¼šå‘ç”Ÿã€‚ä¾‹å¦‚ï¼Œå¦‚æœè·ç¦»ä¸Šæ¬¡è°ƒç”¨å·²ç»è¿‡å»äº† 100 æ¯«ç§’ï¼Œåˆ™è°ƒç”¨è¯¥å‡½æ•°ã€‚

ä»ä¸‹åˆ’çº¿å¼€å§‹çœ‹è¿™ä¸ªå®ç°:

```
const debounce = (func, delay) => {
  let inDebounce
  return function() {
    const context = this
    const args = arguments
    clearTimeout(inDebounce)
    inDebounce = setTimeout(
      () => func.apply(context, args),
      delay
    )
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨æˆ‘ä»¬å¯ä»¥æ¯éš” 100 æ¯«ç§’å»æŠ–ä¸€æ¬¡äº‹ä»¶ç›‘å¬å™¨:

```
var efficientScrollListener = debounce(
  function() {
    console.log('page scrolled')
  },
  100
)

window.addEventListener(
  'scroll',
  efficientScrollListener
) 
```

Enter fullscreen mode Exit fullscreen mode

## æ²¹é—¨

èŠ‚æµç±»ä¼¼äºå»æŠ–ï¼Œä½†æœ‰æ‰€ä¸åŒï¼Œå› ä¸ºå®ƒå°†å¼ºåˆ¶ä¸€ä¸ªå‡½æ•°åœ¨ä¸€æ®µæ—¶é—´å†…å¯ä»¥è¢«è°ƒç”¨çš„æœ€å¤§æ¬¡æ•°ã€‚ä¾‹å¦‚æ¯ 100 æ¯«ç§’æ‰§è¡Œä¸€æ¬¡è¿™ä¸ªå‡½æ•°ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å®ç°:

```
const throttle = (func, limit) => {
  let inThrottle
  return function() {
    const args = arguments
    const context = this
    if (!inThrottle) {
      func.apply(context, args)
      inThrottle = true
      setTimeout(
        () => (inThrottle = false),
        limit
      )
    }
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒèŠ‚æˆ‘ä»¬çš„æ»šåŠ¨äº‹ä»¶ç›‘å¬å™¨:

```
var efficientScrollListener = throttle(
  function() {
    console.log('page scrolled')
  },
  100
)

window.addEventListener(
  'scroll',
  efficientScrollListener
) 
```

Enter fullscreen mode Exit fullscreen mode

# é‚£åˆæ€æ ·

æˆ‘å¸Œæœ›æˆ‘å·²ç»ç»™äº†æ‚¨è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œè®©æ‚¨åœ¨ä½¿ç”¨ JavaScript æ—¶å¯ä»¥é›†ä¸­ç²¾åŠ›æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚å¦‚æœä½ æƒ³è®¨è®ºå…¶ä»–è¯é¢˜ï¼Œè¯·åœ¨ä¸‹é¢è¯„è®ºï¼Œæˆ‘ä¼šæŠŠå®ƒä»¬æ·»åŠ åˆ°è¿™é‡Œæˆ–å¦ä¸€ç¯‡æ–‡ç« ä¸­ã€‚

ä¸€å¦‚æ—¢å¾€ï¼Œä¸è¦å¿˜è®°åˆ†äº«â¤ï¸.