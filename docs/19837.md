# OpenBSD 6.4 ä¸Šçš„ php72_fpm é»˜è®¤ä¸å·¥ä½œ:å¦‚ä½•ä¿®å¤

> åŸæ–‡:[https://dev.to/nabbisen/fixing-php72fpm-on-openbsd-64-f0f](https://dev.to/nabbisen/fixing-php72fpm-on-openbsd-64-f0f)

**å°é¢å›¾ç‰‡ç”± [pixel2013](https://pixabay.com/en/users/pixel2013-2364555) åŸåˆ›ï¼Œç»è¿‡ç²¾å¿ƒç¼–è¾‘ã€‚*

## [](#summary)æ€»ç»“

åœ¨ OpenBSD ä¸­ï¼Œç”±`ports`çš„`pkg_add`å®‰è£… PHP æ˜¯[ä¹‹åè‡ªåŠ¨å®‰è£… PHP-fpm](https://github.com/openbsd/ports/commit/5b4e47f8261f71072cc15e7f1e23cb6fafb81f9e)ã€‚(å¾ˆå¥½çœ‹ğŸ˜ƒ)

ç„¶è€Œï¼Œåœ¨ PHP 7.2(å’Œ 7.1)çš„æƒ…å†µä¸‹ï¼Œå®ƒä¸èƒ½ä½œä¸ºç°æˆçš„å®ˆæŠ¤è¿›ç¨‹å·¥ä½œã€‚
è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡**æ‰‹åŠ¨æ·»åŠ å…¶æ± å®šä¹‰**æ¥è§£å†³ã€‚
è¿™ç¯‡æ–‡ç« å°†å±•ç¤ºå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚

è€Œä¸”æ˜¯[å›ºå®šåœ¨`-current`ç‰ˆ](https://github.com/openbsd/ports/commit/8c40c6d028d47ad4d1ecbb2e88c1a50d654230f0)é‡Œã€‚

**æ³¨:ä»¥ä¸Šé“¾æ¥æ˜¯ç»™ Github æäº¤çš„ï¼Œä½†æ˜¯ã€OpenBSD å®é™…ä½¿ç”¨çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ˜¯ CVS ã€‚*

### [](#environment)ç¯å¢ƒ

*   æ“ä½œç³»ç»Ÿ:OpenBSD 6.4 amd64
*   PHP ç‰ˆæœ¬:7.2

<center>âœ¿ âœ¿ âœ¿</center>

## [](#a-problem)ä¸€ä¸ªé—®é¢˜

OpenBSD 6.4 æœ‰ 4 ä¸ªç‰ˆæœ¬çš„ PHP:

```
#  pkg_add php
quirks-3.16 signed on 2018-10-12T15:26:25Z
Ambiguous: choose package for php a       0: <None>  1: php-5.6.38p0
        2: php-7.0.32p1
        3: php-7.1.22
        4: php-7.2.10
Your choice: 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[æ ¹æ®ä»–ä»¬çš„æ”¯æŒæ¡æ¬¾](http://php.net/supported-versions.php)ï¼ŒPHP 5.6 å‡ ä¹ä¸å†å®‰å…¨ã€‚
æ‰€ä»¥æˆ‘é€‰æ‹© PHP 7ã€‚*ï¼Œå°¤å…¶æ˜¯ 7.2:

```
Your choice: 4
php-7.2.10: ok 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› æ­¤ï¼Œè¿™äº›æ–‡ä»¶åœ¨`/etc` :
ä¸­åˆ›å»º

```
$  ls /etc/php*
/etc/php-7.2.ini    /etc/php-fpm.conf

/etc/php-7.2:

/etc/php-7.2.sample:
opcache.ini 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯æ‚²çš„æ˜¯ï¼Œ`php-7.2.10`ä¸­çš„`php72_fpm`é»˜è®¤ä¸èµ·ä½œç”¨:

```
#  rcctl -d start php72_fpm
doing _rc_parse_conf ... php72_fpm_flags empty, using default ><
doing _rc_parse_conf /var/run/rc.d/php72_fpm
doing _rc_quirks
doing rc_check
php72_fpm
doing rc_start
doing _rc_wait start
doing rc_check
[10-Nov-2018 23:32:18] WARNING: Nothing matches the include pattern '/etc/php-fpm.d/*.conf' from /etc/php-fpm.conf at line 125.
[10-Nov-2018 23:32:18] ERROR: No pool defined. at least one pool section must be specified in config file
[10-Nov-2018 23:32:18] ERROR: failed to post process the configuration
[10-Nov-2018 23:32:18] ERROR: FPM initialization failed
doing _rc_rm_runfile
(failed) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#the-reason)åŸå› 

è¿™æ˜¯å› ä¸ºç¼ºä¹â€œæ± å®šä¹‰â€ã€‚

æè¿°åœ¨`/etc/php-fpm.ini` :
çš„åº•éƒ¨

```
;;;;;;;;;;;;;;;;;;;;
; Pool Definitions ;
;;;;;;;;;;;;;;;;;;;;

; Multiple pools of child processes may be started with different listening
; ports and different management options.  The name of the pool will be
; used in logs and stats. There is no limitation on the number of pools which
; FPM can handle. Your system will tell you anyway :)

; Include one or more files. If glob(3) exists, it is used to include a bunch of
; files from a glob(3) pattern. This directive can be used everywhere in the
; file.
; Relative path can also be used. They will be prefixed by:
;  - the global prefix if it's been set (-p argument)
;  - /usr/local otherwise
include=/etc/php-fpm.d/*.conf 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†æ˜¯æ²¡æœ‰`/etc/php-fpm.d/*.conf`ã€‚

### [](#the-solution)è§£

æ‰‹åŠ¨åˆ›å»ºç›®å½•å’Œæ–‡ä»¶:

```
#  mkdir /etc/php-fpm.d
#  touch /etc/php-fpm.d/default.conf 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`/etc/php-fpm.d/default.conf`åº”è¯¥å†™ä»€ä¹ˆï¼Ÿ
æˆ‘ä»¬å¯ä»¥é€šè¿‡å®‰è£…(å’Œå¸è½½)è·å¾—å®ƒğŸ˜œ)PHP 7.0 ( `php-7.0.32p1`)åŒ…ã€‚
å…¶`/etc/php-fpm.conf`åŒ…æ‹¬æ‰€éœ€çš„æ± å®šä¹‰ã€‚

å®šä¹‰çš„æœ¬è´¨æ˜¯è¿™æ ·çš„:

```
;;;;;;;;;;;;;;;;;;;;
; Pool Definitions ;
;;;;;;;;;;;;;;;;;;;;

[www]
user = www
group = www
listen = /var/www/run/php-fpm.sock
listen.owner = www
listen.group = www
listen.mode = 0660
pm = dynamic
pm.max_children = 5
pm.start_servers = 2
pm.min_spare_servers = 1
pm.max_spare_servers = 3
chroot = /var/www 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦å¤–[è¿™é‡Œ](https://gist.github.com/nabbisen/4f55fa3889010d1121ac2e3b0376fe6a)æ˜¯ä½œä¸ºä¸»æ—¨çš„å®Œæ•´ç‰ˆ(423 è¡ŒåŠ æ³¨é‡Š)ã€‚

å†™å…¥`/etc/php-fpm.d/default.conf`ï¼Œå‡†å¤‡å®Œæ¯•ã€‚
ç»“æœæ˜¯:

```
#  rcctl start php72_fpm
(ok) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½ğŸ˜†

<center>âœ¿ âœ¿ âœ¿</center>

ä¸ºğŸ•ŠæœåŠ¡æ„‰å¿«