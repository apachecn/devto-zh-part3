# ä½¿ç”¨åˆ©ç‰¹å°”æ³•åˆ™ä¼°ç®— VPC è‡ªåŠ¨æ°”è±¡ç«™çš„çŸ¥è¯†äº§æƒå®¹é‡

> åŸæ–‡:[https://dev . to/vladusenko 48/using-Littles-law-to-estimate-IP-capacity-in-VPC-for-AWS-lambda-JPN](https://dev.to/vladusenko48/using-littles-law-to-estimate-ip-capacity-in-vpc-for-aws-lambda-jpn)

[![Network](../Images/6de7cc3ff8148f25b586968a51e3c3fb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jVyp4tqc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/0%2AWJDpVCgj4hBfVXXB)

*åŸè´´[æ­¤å¤„](https://medium.com/@vu4848/using-littles-law-to-estimate-ip-capacity-in-vpc-for-aws-lambda-46711eb55fe3)T3ã€‘*

åœ¨ 2019 å¹´æ‰¾åˆ°ä¸€ä¸ªæ²¡æœ‰å¬è¯´è¿‡æ— æœåŠ¡å™¨è®¡ç®—çš„äººå°†æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚AWS Lambdaã€GCF å’Œ Azure å‡½æ•°â€”â€”æˆ‘ä»¬éƒ½çŸ¥é“è¿™äº›ä¸œè¥¿æ„å‘³ç€ä»€ä¹ˆã€‚èŠ‚çœæˆæœ¬çš„åŸºç¡€æ¶æ„ã€æ— é™çš„å¯æ‰©å±•æ€§ã€æ— è¿è¥ã€æ— ç³»ç»Ÿç®¡ç†å‘˜â€”â€”è¿™å¤šé…·å•Šï¼æˆ‘ä»¬é˜…è¯»äº†è®¸å¤šå¤§å…¬å¸çš„æ¡ˆä¾‹ç ”ç©¶ï¼Œè¿™äº›å…¬å¸å£°ç§°ï¼Œä»–ä»¬é€šè¿‡è½¬å‘ AWS Lambda æˆ–ä»»ä½•å…¶ä»–äº‘å¸‚åœº FaaS è§£å†³æ–¹æ¡ˆï¼ŒæˆåŠŸåœ°å°†äº‘è®¡ç®—æˆæœ¬é™ä½äº† X å€ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œåœ¨è½¯ä»¶å·¥ç¨‹çš„ä¸–ç•Œé‡Œæ²¡æœ‰ä»€ä¹ˆçµä¸¹å¦™è¯ï¼Œåªæœ‰é€‚åˆç‰¹å®šé—®é¢˜çš„æŠ˜è¡·æ–¹æ¡ˆã€‚

ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ AWSã€‚è™½ç„¶æˆ‘ä»¬çœŸæ­£ä» Lambdas çš„ä»»ä½•æœåŠ¡å™¨ç®¡ç†ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œä½†æˆ‘ä»¬æ„Ÿè§‰å¾ˆæ£’ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦æˆ‘ä»¬æ„è¯†åˆ°ç”±äºæŸç§ç‰¹æ®ŠåŸå› ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å°†æˆ‘ä»¬çš„åŠŸèƒ½æ”¾åœ¨ VPC ä¸­(ä¾‹å¦‚ï¼Œlambdas éœ€è¦ä¸ RDSã€ElastiCache æˆ–ä»»ä½•æ²¡æœ‰å…¬å…± IP/DNS åç§°çš„ä¸œè¥¿è¿›è¡Œå¯¹è¯)ï¼Œç¬¬ä¸€æ¬¡å†·å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬æ„è¯†åˆ°æˆ‘ä»¬å®Œè›‹äº†ã€‚æ˜¯çš„ï¼Œåœ¨ VPC å¯åŠ¨ Lambda æ˜¯ä¸ªé—®é¢˜ã€‚ç»†èŠ‚æˆ‘å°±ä¸å¤šè¯´äº†ï¼Œä½ å¯ä»¥åœ¨ AWS å®˜æ–¹ [docs](https://docs.aws.amazon.com/lambda/latest/dg/best-practices.html) ä¸Šè¯»åˆ°å¾ˆå¤šå…³äº VPC å†·å¯åŠ¨é—®é¢˜çš„å†…å®¹ã€‚é•¿è¯çŸ­è¯´ï¼Œå‡½æ•°å¿…é¡»ä¸ ENI ç›¸å…³è”æ‰èƒ½ä¸ VPC çš„å®ä¾‹è¿›è¡Œå¯¹è¯ï¼ŒENI åˆ†é…å¯èƒ½éœ€è¦ 10 ç§’é’Ÿï¼Œè¿™æ„å‘³ç€ VPC ä¸­ä»»ä½•å‡½æ•°çš„å†·å¯åŠ¨å¾ˆå¯èƒ½éœ€è¦ 10 ç§’é’Ÿä»¥ä¸Šï¼å¤šé…·å•Šã€‚ä¸å®Œå…¨æ˜¯ã€‚

æ€»ä¹‹ï¼ŒVPC å†·å¯åŠ¨ä¸æ˜¯æˆ‘ä»¬åº”è¯¥è€ƒè™‘çš„å”¯ä¸€é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å½±å“äº†æˆ‘ä»¬åº”ç”¨çš„æ€§èƒ½å’Œå»¶è¿Ÿï¼Œä½†èƒŒåè¿˜æœ‰æ›´å¤šä¸œè¥¿ã€‚å¦‚æœæˆ‘ä»¬æŠŠ Lambdas æ”¾åœ¨ VPC ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»è®°ä½å®ƒçš„å­ç½‘çš„ IP å®¹é‡ã€‚è¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨[è¿™é‡Œ](https://docs.aws.amazon.com/lambda/latest/dg/vpc.html)æ‰¾åˆ°ï¼Œä½†æ˜¯ç®€å•æ¥è¯´ï¼Œå¦‚æœæœ‰éå¸¸å¤šçš„å¹¶å‘è¯·æ±‚è¿›æ¥ï¼ŒVPC å°±æœ‰å¯èƒ½ç”¨å®Œç©ºé—²çš„ IP åœ°å€ã€‚å‡ºäºè¿™ä¸ªç‰¹æ®ŠåŸå› ï¼ŒAWS ä¸ºæˆ‘ä»¬æä¾›äº†è¿™ä¸ªè‘—åè€Œç®€å•çš„å…¬å¼æ¥è®¡ç®— ENI å®¹é‡:

*ENI å®¹é‡=é¢„è®¡çš„å¹¶å‘æ‰§è¡Œå³°å€¼*(ä»¥ GB / 3GB ä¸ºå•ä½çš„å†…å­˜å®¹é‡)*

ç»™å®šæˆ‘ä»¬ä¸º Lambda å‡½æ•°åˆ†é…çš„ CIDR å—(ä¾‹å¦‚ 10.0.0.0/24)å’Œ RAMï¼Œæˆ‘ä»¬å¯ä»¥ä¼°è®¡å­ç½‘èƒ½å¤Ÿå¤„ç†å¤šå°‘å¹¶å‘è¯·æ±‚ï¼Œè¿™åœ¨æˆ‘ä»¬è®¾è®¡å­ç½‘å’Œåˆ†é… IP åœ°å€æ—¶éå¸¸æœ‰ç”¨ã€‚

ç„¶è€Œï¼Œæˆ‘è¯•å›¾å‘å‰è¿ˆè¿›ä¸€æ­¥ï¼Œå°è¯•å°†åˆ©ç‰¹å°”å®šå¾‹ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¿™ä¸ªå®šå¾‹ç»™æˆ‘ä»¬æä¾›äº†è¿™æ ·çš„å…¬å¼:

[![Little's Law](../Images/c248d09ea9f87c0a019a2c3762573d62.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--OB95uYwB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AenQvkMWpUl1Gpil_j0wpyw.png)

å¦‚æœæˆ‘ä»¬å°† lambda ç¬¦å·è§†ä¸ºæ¯ç§’çš„è¯·æ±‚æ•°é‡ï¼Œå°† W è§†ä¸ºæ¯ä¸ªè¯·æ±‚å®Œæˆçš„å¹³å‡æ—¶é—´ï¼ŒL å°†ä»£è¡¨åœ¨ä»»ä½•æ—¶åˆ»ç³»ç»Ÿä¸­å¹¶å‘è¯·æ±‚çš„å¹³å‡æ•°é‡ã€‚è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªå•†åº—çš„ä¾‹å­ã€‚å‡è®¾äººä»¬ä»¥æ¯å°æ—¶ 10 è‹±é•‘çš„é€Ÿåº¦åˆ°è¾¾å•†åº—ï¼Œå¹¶åœ¨é‚£é‡Œåœç•™åŠä¸ªå°æ—¶ã€‚æ‰€ä»¥åœ¨ä»»ä½•æ—¶åˆ»ï¼Œå•†åº—é‡Œçš„å¹³å‡äººæ•°éƒ½ç­‰äº 10 x 0.5 = 5ã€‚å¾ˆç®€å•ã€‚

åˆ©ç‰¹å°”æ³•åˆ™å¹¿æ³›åº”ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿååé‡çš„ä¼°è®¡ã€‚ä½†æ˜¯ï¼Œå®ƒç»™å‡ºäº†ä¸€ä¸ªå¹³å‡å€¼ï¼Œå®é™…ä¸Šå¹¶ä¸é€‚åˆç²¾ç¡®ä¼°è®¡ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è€ƒè™‘ç°å®ä¸–ç•Œçš„å‰¯ä½œç”¨ã€‚ç”±äºèµ„æºåˆ†é…ã€ç½‘ç»œé—®é¢˜æˆ–å…¶ä»–åŸå› ï¼Œç³»ç»Ÿçš„å»¶è¿Ÿ(W)å¾€å¾€ä¼šéšæ—¶é—´è€Œå˜åŒ–ã€‚mark Brooker(AWS Lambda å›¢é˜Ÿçš„é¦–å¸­å·¥ç¨‹å¸ˆ)æœ‰ä¸€ç¯‡å…³äºå®ƒçš„å¾ˆå¥½çš„åšå®¢æ–‡ç« ï¼Œä»–æè¿°äº†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ›´æ¥è¿‘çœŸå®ä¸–ç•Œçš„åˆ©ç‰¹å°”å®šå¾‹çš„æ–¹æ³•ã€‚

ç„¶è€Œï¼Œå³ä½¿æ³•å¾‹æ²¡æœ‰ç»™æˆ‘ä»¬ä¸€ä¸ªç²¾ç¡®çš„ä¼°è®¡ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿåœ¨æŸäº›æƒ…å†µä¸‹åˆ©ç”¨å®ƒã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥å¾ˆå®¹æ˜“åœ°è®¡ç®—å‡ºä¸€ä¸ª VPC ä¸­çš„ IP åœ°å€æ•°é‡ï¼Œè¿™æ ·å®ƒå°±èƒ½å¤Ÿä»¥æ¯ç§’çš„é€Ÿç‡å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚

å‡è®¾æœ‰ä¸€ä¸ªæ„å»ºåœ¨ VPC ä¸­ Lambda ä¹‹ä¸Šçš„ç³»ç»Ÿè¦æ±‚æ¯ç§’èƒ½å¤Ÿå¤„ç† 1000 ä¸ªè¯·æ±‚ã€‚æˆ‘ä»¬éœ€è¦ç¡®ä¿æˆ‘ä»¬çš„å­ç½‘ä¸­æœ‰è¶³å¤Ÿçš„ IP åœ°å€æ¥æ»¡è¶³éœ€æ±‚ã€‚æ‰€ä»¥è®©æˆ‘ä»¬åšä¸€äº›ç®€å•çš„æ•°å­¦è®¡ç®—ï¼

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¼„æ¸…æ¥š lambda ä¸­çš„ä»£ç éœ€è¦è¿è¡Œå¤šå°‘æ—¶é—´ï¼Œæ¶ˆè€—å¤šå°‘ RAMï¼Œè¿™æ ·æ‰èƒ½ä¸ºæˆ‘ä»¬çš„å‡½æ•°è®¾ç½®åˆé€‚çš„å†…å­˜é‡ã€‚ä½¿ç”¨ CloudWatch æ—¥å¿—å¾ˆå®¹æ˜“åšåˆ°è¿™ä¸€ç‚¹ï¼Œå…¶ä¸­ AWS ä¸ºæˆ‘ä»¬æä¾›ä»¥æ¯«ç§’ä¸ºå•ä½çš„æŒç»­æ—¶é—´å’Œä»¥å…†å­—èŠ‚ä¸ºå•ä½çš„å·²ç”¨å†…å­˜ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å‘ç°å¹³å‡æŒç»­æ—¶é—´å’Œå†…å­˜æ¶ˆè€—åˆ†åˆ«ä¸º 500 æ¯«ç§’å’Œ 128 å…†å­—èŠ‚ã€‚è®°ä½ VPC å†·å¯åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å¢åŠ  10 ç§’çš„æŒç»­æ—¶é—´ï¼Œç»“æœå°†æ˜¯ W åœ¨åˆ©ç‰¹å°”å®šå¾‹ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¡ç®— L:

L = 1000(è¯·æ±‚/ç§’)* (10 + 0.5)(ç§’)
L = 10500(è¯·æ±‚)

è¿™ä¸ªæ•°å­—å‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨ VPC å†·å¯åŠ¨æœŸé—´ï¼Œæˆ‘ä»¬å°†è‡³å°‘æœ‰ 10500 ä¸ªå¹¶å‘ lambda å‡½æ•°åœ¨è¿è¡Œã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦è®¡ç®—å¿…è¦çš„ IP åœ°å€æ•°é‡ã€‚åœ¨ AWS ä¸ºæˆ‘ä»¬æä¾›çš„è®¡ç®— ENI å®¹é‡çš„å…¬å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°† L æ›¿æ¢ä¸ºé¢„è®¡çš„å¹¶å‘æ‰§è¡Œå³°å€¼ï¼Œå°† 128 MB (0.125 GB)æ›¿æ¢ä¸º Lambda RAM:

ENI = 10500 * (0.125 / 3)
ENI = 4375

å¦‚æˆ‘ä»¬æ‰€è§ï¼Œ4375 ä¸ª IP åœ°å€è¶³ä»¥ç¡®ä¿æˆ‘ä»¬ä¸€åˆ‡é¡ºåˆ©ã€‚æ»¡è¶³è¿™ä¸€è¦æ±‚çš„æœ€æ¥è¿‘çš„ CIDR å—å°†æ˜¯ 10.0.0.0/19ï¼Œå³ 8192(å®é™…ä¸Šæ˜¯ 8187ï¼Œå› ä¸º AWS å£°ç§°ä¸ºå†…éƒ¨éœ€æ±‚ä¿ç•™äº† 5 ä¸ªåœ°å€)ã€‚10.0.0.0/20 ä¼šç»™æˆ‘ä»¬ 4096 (4091)ï¼Œæ¯”æˆ‘ä»¬éœ€è¦çš„å°‘ä¸€ç‚¹ã€‚

å°½ç®¡å¦‚æ­¤ï¼Œå®ƒè¿˜æ˜¯ä¸å¤ªç²¾ç¡®ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒLambdas ä½äº VPC ä¸­ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦è¿æ¥åˆ° RDSã€‚è¿™æ„å‘³ç€ä»–ä»¬å°†æ‰“å¼€æ•°æ®åº“è¿æ¥ï¼Œè¿™è‚¯å®šä¼šå¤§å¤§é™ä½æ•°æ®åº“æ€§èƒ½ï¼Œè¿™å°†åæ˜ åœ¨åˆ©ç‰¹å°”å®šå¾‹ä¸­çš„ W ä¸Šã€‚ä½ å¯èƒ½ä¼šå‘ç°æåˆ°çš„é©¬å…‹Â·å¸ƒæ³½å°”çš„åšå®¢æ–‡ç« éå¸¸æœ‰ç”¨ï¼Œä»–è¶…è¶Šäº†åŸå§‹çš„åˆ©ç‰¹å°”å®šå¾‹ã€‚

## [](#important-note)é‡è¦æç¤º

å½“ç„¶ï¼Œæˆ‘ä¸å¾—ä¸è¯´ï¼Œåœ¨ Re:Invent 2018 æœŸé—´ï¼ŒAWS å®£å¸ƒäº†ä¸€ä¸ªé’ˆå¯¹ VPC å†·å¯åŠ¨çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€äº›èŠ±å“¨çš„è¿œç¨‹ NATã€‚å¾ˆå¯èƒ½åœ¨ä¸ä¹…çš„å°†æ¥ï¼Œæˆ‘ä»¬å°†ä¸å†éœ€è¦è®¡ç®— IP åœ°å€ï¼Œä¸å†æœ‰è¿™ 10 ç§’é’Ÿçš„å»¶è¿Ÿï¼Œè¿™å¤ªæ£’äº†ã€‚

> ![unknown tweet media content](../Images/599a4ff711a68b807ba98e67fc2fd651.png)![Jeremy Daly @ re:Invent profile image](../Images/5c3022920d172e08238e744e32c93674.png)æ°ç‘ç±³Â·è¾¾åˆ©@ re:Invent[@æ°ç‘ç±³ _ è¾¾åˆ©](https://dev.to/jeremy_daly)![twitter logo](../Images/65e26e35707d96169ec8af6b3cbf2003.png)çœ‹èµ·æ¥ [@awscloud](https://twitter.com/awscloud) æœ‰äº›æƒ³æ³•æå®š [#Lambda](https://twitter.com/hashtag/Lambda) å†·å¯åŠ¨ä¸€ä¸ª [#VPC](https://twitter.com/hashtag/VPC) ã€‚ğŸ™Œ2019 å¹´å³å°†åˆ°æ¥ï¼[#æ— æœåŠ¡å™¨](https://twitter.com/hashtag/serverless)[#å½»åº•æ”¹é€ ](https://twitter.com/hashtag/reInvent)2018 å¹´ 11 æœˆ 29 æ—¥ 22:36 ç‚¹[![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1068272580556087296)[![Twitter retweet action](../Images/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1068272580556087296)60[![Twitter like action](../Images/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1068272580556087296)146

ä½†æˆ‘åªæ˜¯è§‰å¾—å†™èµ·æ¥å¾ˆæœ‰è¶£ã€‚æ„Ÿè°¢æ‚¨çš„å…³æ³¨ï¼