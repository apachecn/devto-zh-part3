# å‡¤å‡°åŸ:æ”¹å˜è€…å¾·Â·é‚¦å¾·å‹’

> åŸæ–‡:# t0]https://dev . to/jeansmaug/phoenix-change de bundler-4339

ä» 1.4 ç‰ˆå¼€å§‹ï¼ŒPhoenix å¼€å§‹å¼•å…¥ Webpack ä»¥æ†ç»‘ä¸åŒçš„ä¾èµ–é¡¹ã€‚æˆ‘ä»¬ä¼šçœ‹åˆ°ä»¥[åœ°å—](https://parceljs.org)ä¸ºä¾‹ï¼Œå¾ˆå®¹æ˜“æ›´æ¢å·¥å…·ã€‚
æ­¤å·¥å…·çš„ä¼˜ç‚¹æ˜¯æ— éœ€é…ç½®å³å¯è¿è¡Œã€‚

## åˆå§‹åŒ–

åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œä¸éœ€è¦â€œectoâ€ï¼Œè¿™æ ·å°±ä¸éœ€è¦è®¾ç½®æ•°æ®åº“ã€‚

```
mix phx.new app --no-ecto 
```

è®©æˆ‘ä»¬å¯åŠ¨å‡¤å‡°åŸçš„æœåŠ¡å™¨ã€‚

```
mix phx.server 
```

Phoenix ä¸ºæˆ‘ä»¬è¿è¡Œ Webpack å¹¶ä¾¦å¬æ–‡ä»¶æ›´æ”¹ï¼Œä»¥ä¾¿å¯¹æˆ‘ä»¬è¿›è¡Œçƒ­é‡è£…æ›´æ”¹ã€‚

[![phoenix-launch-webpack](../Images/cba21a07f8676d57cb8cf1e0dd535f8f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ulu-enA_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/e5vss7cdew0xx0rzvtyo.png)

å¦‚æœç¼–è¾‘æ–‡ä»¶`assets/css/app.css`æ›´æ”¹æ­£æ–‡çš„èƒŒæ™¯é¢œè‰²ï¼Œåˆ™æ— éœ€é‡æ–°åŠ è½½é¡µé¢å³å¯çœ‹åˆ°æ›´æ”¹ã€‚

```
/* This file is for your main application css. */

@import "./phoenix.css";

body {
  background: darkgray;
} 
```

[![webpack-change-color](../Images/941d73c0d56a5a0c97b249380d61864b.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Y0ibsU2u--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/m9gzbiqplq37po3bghfn.png)

å› æ­¤ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¿æŒè¿™ç§è¡Œä¸ºï¼Œè¿™ç§è¡Œä¸ºæä¾›äº†å‘å±•çš„ä¾¿åˆ©ï¼Œä½†ä½¿ç”¨äº†å¦ä¸€ç§å·¥å…·ã€‚

Webpack ä¸ºâ€œ`priv/static`â€æ„å»ºæˆ‘ä»¬çš„èµ„äº§ã€‚Phoenix éœ€è¦å°†æˆ‘ä»¬çš„é™æ€æ–‡ä»¶æ„å»ºåˆ°æ­¤æ–‡ä»¶å¤¹ä¸­ã€‚[è¿™ä»ç„¶æ˜¯å¯é…ç½®çš„](https://hexdocs.pm/plug/Plug.Static.html)

[![webpack-build](../Images/2a209679bfdca4ff0b5b4bfed0853170.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--e3pZVJ52--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/rddnm8321om1epvab885.png)

åœ¨ç»§ç»­æ“ä½œä¹‹å‰ï¼Œè¯·æ–­å¼€æœåŠ¡å™¨ç”µæºï¼Œå¹¶åˆ é™¤ Webpack ç”Ÿæˆçš„æ–‡ä»¶å¤¹ï¼Œä»¥ä¾¿åœ¨å¹²å‡€çš„åŸºç¡€ä¸Šè¿è¡Œ

```
rm -rf priv/static 
```

## [](#configuration-de-parcel-au-sein-de-phoenix)å‡¤å‡°åŸå†…çš„åœ°å—é…ç½®

è®©æˆ‘ä»¬å®‰è£…éƒ¨åˆ†æ’ä»¶å’Œä¸€ä¸ªä¸åœ¨æœ¬æ–‡èŒƒå›´ä¹‹å†…çš„é­”æ³•æ’ä»¶ã€‚

```
cd assets/ && npm install --save-dev parcel-bundler parcel-plugin-static-files-copy 
```

åœ¨æ–‡ä»¶
ä¸­åº”æ›¿æ¢

```
config :app, AppWeb.Endpoint,
  http: [port: 4000],
  debug_errors: true,
  code_reloader: true,
  check_origin: false,
  watchers: [
    node: [
      "node_modules/webpack/bin/webpack.js",
      "--mode",
      "development",
      "--watch-stdin",
      cd: Path.expand("../assets", __DIR__)
    ]
  ] 
```

æ ‡å‡†æ†

```
config :app, AppWeb.Endpoint,
  http: [port: 4000],
  debug_errors: true,
  code_reloader: true,
  check_origin: false,
  watchers: [
    node: [
      "node_modules/.bin/parcel",
      "watch",
      "js/app.js",
      "-d",
      "../priv/static",
      cd: Path.expand("../assets", __DIR__)
    ]
  ] 
```

ç°åœ¨ï¼Œå½“æˆ‘ä»¬æ¨å‡ºâ€˜t0â€™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡¤å‡°ç°åœ¨æ¨å‡ºäº†éƒ¨åˆ†ã€‚

[![phoenix-launch-parcel](../Images/04a72628e8fc562bd3c6c6b1a382651f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--tf_wbqUk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vrnxkb0eqfiesej2yogc.png)

å¹¶ä¸”ç›®çš„åœ°æ–‡ä»¶å¤¹æ˜¯`priv/static`

[![build-parcel-priv](../Images/6d23ac4027ab8474fc108a1eaa8352d8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ybeBVC9_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/i9nujjx3va2vkbgdaus2.png)

ä½†ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬çš„ css å’Œ js ä¸å†åŠ è½½

[![broken-page](../Images/b456c17fc7d18fe6ef50a9f89c934ea7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Rhi0mOV_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/xdg3nkxf08k5a93kg2e1.png)

Webpack ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å¤¹â€œ`css`â€å’Œä¸€ä¸ªæ–‡ä»¶å¤¹â€œ`js`â€åˆ†åˆ«åŒ…å«å…¶è½¯ä»¶åŒ…ã€‚â€œåœ°å—â€å°†è·³è¿‡ä¸­é—´æ–‡ä»¶å¤¹ã€‚å› æ­¤ï¼Œå¿…é¡»æ›´æ–°å¯¼å…¥åˆ°æ¨¡æ¿â€œ`lib/app_web/templates/layout/app.html.eex`â€ä¸­çš„æ–‡ä»¶çš„è·¯å¾„ã€‚

æ›´æ¢ã€”t0ã€•

```
<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="<%= Routes.static_path(@conn, "/css/app.css") %>"/>
  </head>
  <body>
    ###
    <script type="text/javascript" src="<%= Routes.static_path(@conn, "/js/app.js") %>"></script>
  </body>
</html> 
```

æ ‡å‡†æ†

```
<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="<%= Routes.static_path(@conn, "/app.css") %>"/>
  </head>
  <body>
    ###
    <script type="text/javascript" src="<%= Routes.static_path(@conn, "/app.js") %>"></script>
  </body>
</html> 
```

è¿˜æœ‰å‘¢ğŸ‰è¿™æ˜¯è¡Œä¸é€šçš„ğŸ˜¢ã€‚

è¿™æ˜¯å› ä¸º Phoenix ä»…å…è®¸å°†ç¬¦åˆç‰¹å®šæ¨¡å¼çš„æ–‡ä»¶ç”¨ä½œé™æ€æ–‡ä»¶ã€‚è¿™äº›å›¾æ¡ˆå¯åœ¨æ–‡ä»¶â€œ`lib/app_web/endpoint.ex`t1â€ä¸­é…ç½®

```
 plug Plug.Static,
    at: "/",
    from: :app,
    gzip: false,
    only: ~w(css fonts images js favicon.ico robots.txt) 
```

è¿™ç§é…ç½®æ„å‘³ç€å‡¤å‡°åªå…è®¸ä½¿ç”¨ä½äº`fonts` `images` `js`æˆ–`favicon.ico`å’Œ`robots.txt`æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ã€‚å½“ç„¶ï¼Œè¿™äº›æ¡£æ¡ˆå¿…é¡»å­˜åœ¨äº`priv/static`ğŸ˜‰ã€‚

```
 plug Plug.Static,
    at: "/",
    from: :app,
    gzip: false,
    only: ~w(app.css fonts images app.js favicon.ico robots.txt) 
```

å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¸­é—´çš„æ¡£æ¡ˆ`js`å’Œ`js`ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šç”¨`app.css`å’Œ`app.js`ä»¥éƒ¨åˆ†äº§ç”Ÿçš„æ¡£æ¡ˆæ¥å–ä»£å®ƒä»¬ã€‚

ç°åœ¨åº”ç”¨ç¨‹åºå·¥ä½œæ­£å¸¸ã€‚å¦‚æœç¼–è¾‘æ–‡ä»¶`assets/js/app.js`ä»¥åœ¨å…¶ä¸­æ·»åŠ `console.log`

```
import "phoenix_html"
import css from "../css/app.css"

console.log("Meeeeeeeeh") 
```

â€œmeeeeeeeehâ€å‡ºç°åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ï¼Œæ— éœ€é‡æ–°åŠ è½½é¡µé¢ğŸ‰ã€‚

[![meeeeeh](../Images/39d214e6812d2c8b0517339732679747.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--VBJTwU80--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hfxw2yb5q9qzcrz0joxh.png)

## [](#nettoyage)æ¸…æ´

ç°åœ¨æˆ‘ä»¬æ·»åŠ äº†éƒ¨åˆ†ï¼Œåªå‰©ä¸‹æ¸…é™¤ Webpack çš„æ®‹é¦€ç‰©:

```
cd assets && npm uninstall babel-loader copy-webpack-plugin css-loader mini-css-extract-plugin optimize-css-assets-webpack-plugin uglifyjs-webpack-plugin webpack webpack-cli && rm webpack.config.js 
```

## [](#conclusion)ç»“è®º

æ— è®ºæ‚¨æ˜¯å¦é€‰æ‹©ä¿ç•™ Webpackã€ä½¿ç”¨ Rollupã€parcelâ€¦ã€‚å¦‚æœæ‚¨é€‰æ‹©æ›´æ”¹ bundler çš„é…ç½®ï¼Œè¯·è€ƒè™‘:

*   æ­£ç¡®é…ç½®å…¶ bundler(æ˜“äºä½¿ç”¨ partial)
*   æ›´æ”¹ç›‘è§†æ–‡ä»¶æ›´æ”¹çš„è„šæœ¬(dev.exs)
*   ç¡®ä¿å¯ä»¥æ­£ç¡®ä½¿ç”¨é™æ€æ–‡ä»¶(endpoint.ex)
*   ç¼–è¾‘æ¨¡æ¿ä¸­çš„è·¯å¾„(app.html.eex)

## [](#liens-utiles)æœ‰ç”¨çš„é“¾æ¥

*   æˆ‘çµæ„Ÿæ¥è‡ªäºè¿™ä¸ª Github å­˜æ¬¾ã€‚ä»£ç åº“é‡‡ç”¨æ—§ç‰ˆ Phoenix çš„ç»“æ„ï¼Œä¸è¦åƒè¦æ›´æ–°ä¸€æ ·ä½¿ç”¨å®ƒã€‚
*   [æˆ‘ä»¥å‰çš„æ–‡ç« ](https://medium.com/@_MaximeBlanc/phoenix-changer-de-bundler-e53f00110740)
*   [ç«¯ç‚¹é…ç½®æ–‡ä»¶](https://hexdocs.pm/phoenix/Phoenix.Endpoint.html#module-runtime-configuration)