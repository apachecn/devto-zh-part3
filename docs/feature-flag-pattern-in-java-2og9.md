# java ä¸­çš„ç‰¹å¾æ ‡å¿—æ¨¡å¼

> åŸæ–‡ï¼š<https://dev.to/apium_hub/feature-flag-pattern-in-java-2og9>

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ç®€è¦ä»‹ç» java ä¸­çš„ç‰¹æ€§æ ‡å¿—æ¨¡å¼ï¼Œå®ƒå…è®¸å°†å°šæœªå®Œæˆçš„ç‰¹æ€§ä¸Šä¼ åˆ°äº§å“ä¸­ã€‚

ä½¿ç”¨ç‰¹æ€§åˆ†æ”¯æœºåˆ¶çš„é¡¹ç›®æ˜¯å¾ˆå¸¸è§çš„ï¼Œç›®çš„æ˜¯æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹ç‰¹æ€§çš„æ‰€æœ‰å¼€å‘ï¼Œå¹¶ä¸”ä¸€æ—¦å®ƒè¢«æœ€ç»ˆç¡®å®šï¼Œå®ƒå¯ä»¥è¢«é›†æˆåˆ°å‘å¸ƒæµç¨‹ä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬ã€‚

ä¸å»è®¨è®ºç‰¹æ€§åˆ†æ”¯å’Œä¸»ç‰¹æ€§çš„ä¼˜ç¼ºç‚¹ï¼Œç‰¹æ€§åˆ†æ”¯ç­–ç•¥æœ‰ä¸€ä¸ªéå¸¸æ˜‚è´µçš„éšœç¢ï¼Œå³åé¦ˆï¼Œå¦‚æœç‰¹æ€§éœ€è¦ä¸€ä¸ªæœˆæ‰èƒ½å®Œæˆï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´å°†æ˜¯æœ€å°‘çš„ï¼Œä¸èƒ½ä¸ä»£ç çš„å…¶ä½™éƒ¨åˆ†åˆå¹¶ï¼Œä¸èƒ½ä¸å…¶ä»–åŠŸèƒ½ä¸€èµ·æµ‹è¯•ï¼Œç­‰ç­‰ã€‚

æ˜¯çš„ï¼Œå¾ˆæ˜æ˜¾ï¼Œä½¿ç”¨åŠŸèƒ½åˆ†æ”¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è·å¾—â€œå¿«é€Ÿâ€åé¦ˆï¼Œä½†ä¸ºæ­¤æˆ‘ä»¬éœ€è¦è°ƒæ•´æˆ‘ä»¬çš„ç®¡é“ï¼Œä»¥ä¾¿å®ƒçŸ¥é“ä»»ä½•åˆ›å»ºçš„åˆ†æ”¯ï¼Œå¹¶å¯ä»¥ä¸ºæ¯ä¸ªåˆ†æ”¯è¿è¡Œä¸€ä¸ªå…¨æ–°çš„ç¯å¢ƒï¼Œè¿™æ„å‘³ç€æˆæœ¬ï¼Œä¸ä»…æ˜¯åœ¨èµ„é‡‘å±‚é¢ï¼Œè€Œä¸”æ˜¯å‡†å¤‡ç¯å¢ƒã€æ•°æ®ç­‰ã€‚ï¼Œå³ä½¿è¿™æ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šæµ‹è¯•è¯¥åŠŸèƒ½ä¸å…¶ä»–åŠŸèƒ½çš„é›†æˆã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œå³ä½¿æ²¡æœ‰å®Œæˆçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é›†æˆæˆ‘ä»¬çš„ä»£ç ï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†å®ƒæ”¾å…¥æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„å‘å¸ƒå‘¨æœŸä¸­ï¼Œæœ€æ˜æ˜¾çš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯åœ¨å°†æˆ‘ä»¬çš„ä»£ç ä¸åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†é›†æˆæ—¶çš„å¿«é€Ÿåé¦ˆï¼Œå› ä¸ºå®ƒæœ€å°åŒ–äº†æ‹…å¿ƒçš„æœªæ¥åˆå¹¶å†²çªã€‚

## ç‰¹è‰²æ——å¸œå›¾æ¡ˆæ•‘é©¾ï¼

Feature Flagï¼Œä¹Ÿç§°ä¸º Feature Toogleï¼Œæ˜¯å°†[æŒç»­é›†æˆ](https://dev.to/apium_hub/back-to-the-roots-towards-true-continuous-integration-part-one-14m7)åº”ç”¨äºæˆ‘ä»¬é•¿æœŸè¿è¡Œçš„ç‰¹æ€§çš„å®Œç¾æ¨¡å¼ã€‚

é€šè¿‡ä»£ç ä¸­çš„æ¡ä»¶å’Œé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶æ¿€æ´»æˆ–ä¸æ¿€æ´»åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼Œä¸€æ—¦åŠŸèƒ½å®Œæˆï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¿€æ´»å®ƒã€‚

æœ€ç®€å•çš„å®ç°æ˜¯æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ï¼Œè¡¨ä¸­æœ‰ç‰¹æ€§çš„åç§°å’ŒçŠ¶æ€(æ´»åŠ¨æˆ–ä¸æ´»åŠ¨)ï¼Œåœ¨ä»£ç ä¸­æœ‰ä¸€ä¸ª if(æ´»åŠ¨)show else notshowã€‚

ä½†è¿™ç§æ¨¡å¼èµ°å¾—æ›´è¿œï¼Œå…è®¸ä¸ºä¸€ç»„ç”¨æˆ·ã€å›½å®¶ã€ç”¨æˆ·çš„æµè§ˆå™¨ã€è¡Œä¸ºæˆ–éšæœºåœ°æ¿€æ´»ä¸€ä¸ªç‰¹æ€§ã€‚

æ¯ä¸ªå®ç°éƒ½æœ‰ä¸åŒçš„åå­—ï¼ŒAbTestingï¼ŒCanary Release..ä½†ä¸€åˆ‡éƒ½å·®ä¸å¤šï¼Œæš´éœ²ç‰¹å¾ä¸å¦å–å†³äºæ¡ä»¶ã€‚

## Java çš„ç‰¹å¾æ ‡å¿—æ¨¡å¼

å¦‚æœæˆ‘ä»¬çš„æŠ€æœ¯å †æ ˆæ˜¯ç”± java æˆ– jvm çš„ä»»ä½•è¯­è¨€ç»„æˆçš„ï¼Œæˆ‘ä»¬æ˜¯å¹¸è¿çš„ã€‚

FF4J æ˜¯ç‰¹æ€§åˆ‡æ¢æ¨¡å¼çš„å®ç°ã€‚å‡ ä¹ä¸éœ€è¦ä»»ä½•åŠªåŠ›ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ä¸åŒç±»å‹çš„æ•°æ®æºé›†æˆï¼Œä»¥ä¾¿èƒ½å¤Ÿä¿å­˜æˆ‘ä»¬çš„åŠŸèƒ½åŠå…¶çŠ¶æ€ï¼Œå®ƒè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†åŠŸèƒ½åº”ç”¨æ¬¡æ•°çš„å®¡è®¡ï¼ŒåŒ…æ‹¬æ€»æ•°ã€ç”¨æˆ·å’Œæ¥æºã€‚

å®ƒä¹Ÿæœ‰ä¸åŒçš„å†³ç­–ç­–ç•¥ï¼Œç™½åå•ï¼Œé»‘åå•ï¼Œå®¢æˆ·ç«¯è¿‡æ»¤å™¨ï¼ŒæœåŠ¡å™¨è¿‡æ»¤å™¨ï¼ŒåŠ æƒç­‰ã€‚å®ƒä»¬ä¹Ÿå…è®¸æˆ‘ä»¬åˆ›å»ºè‡ªå·±çš„ç­–ç•¥ã€‚

æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥é€šè¿‡ web æ§åˆ¶å°æˆ– API è¿›è¡Œé…ç½®ï¼Œè¿™æå¤§åœ°æ–¹ä¾¿äº†ç‰¹æ€§çš„åˆ›å»ºå’Œç»´æŠ¤ã€‚

## ç»™æˆ‘çœ‹çœ‹ä»£ç ï¼

è™½ç„¶åœ¨è¿™ä¸ªé¡¹ç›®çš„èµ„æºåº“ä¸­ï¼Œæœ‰è®¸å¤šä¸ä¸åŒç‰¹æ€§æº(jdbcã€cassandraã€mongo ç­‰)ç›¸å…³çš„ä¾‹å­ï¼Œä½†æˆ‘å‘ç°åˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨çš„ä¾‹å­å¾ˆæœ‰è¶£ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨äºé…ç½®æ‰€æœ‰åŠŸèƒ½çš„æœåŠ¡ï¼Œå…¶ä»–æœåŠ¡é€šè¿‡ http è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡æ¥æŸ¥è¯¢æ´»åŠ¨çš„åŠŸèƒ½ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæœåŠ¡çš„å¤šæ¨¡å—:

## Ffconsole

è¿™ä¸ªæœåŠ¡åªæœ‰ç®¡ç†æ§åˆ¶å°æ¥åˆ›å»ºç‰¹æ€§ï¼Œè¿˜æœ‰ä¸€ä¸ªæ’ä»¶é€šè¿‡ rest æ¥å…¬å¼€å®ƒã€‚ä¸ºäº†ç®€åŒ–ç¤ºä¾‹ï¼Œå®ƒé…ç½®ä¸ºå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ²¡æœ‰ä»»ä½•å®‰å…¨æ€§(ä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ [![ğŸ˜œ](img/c73bf606a2a3a219e922a14c9fc808c8.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--iNMHH3Bq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s.w.oimg/core/emoji/2.2.1/72x72/1f61c.png) )ã€‚

æˆ‘ä»¬æ‹¥æœ‰çš„å”¯ä¸€é…ç½®æ˜¯åœ¨ç±» FF4jServletConfiguration.kt ä¸­ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­æ³¨å†Œäº† FF4J çš„ beanã€servlet å’Œ web æ§åˆ¶å°ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°è¯¥ç±»ï¼Œä»¥ä¾¿å®ƒå¯¼å…¥å…¬å¼€ api æ‰€å¿…éœ€çš„ beanã€‚æ­¤å¤–ï¼Œä¸ºäº†ç®€åŒ–ç¤ºä¾‹ï¼Œæˆ‘å·²ç»æ³¨å†Œäº†è¯¥åŠŸèƒ½ï¼Œè¿™åº”è¯¥é€šè¿‡ç®¡ç†é¢æ¿æ¥å®Œæˆã€‚

```
 @Bean
fun getFF4j(): FF4j = FF4j().apply {
        createFeature("AwesomeFeature", true)
    }

@Bean
fun getFF4JServlet(): FF4jDispatcherServlet =
    FF4jDispatcherServlet().apply { ff4j = getFF4j() }

@Bean
fun ff4jDispatcherServletRegistrationBean(): ServletRegistrationBean =
    ServletRegistrationBean(getFF4JServlet(), "/ff4j-web-console/*") 
```

## æˆ‘çš„-ç‰›é€¼-ç½‘ç»œ

ä¸€ä¸ª spring boot åº”ç”¨ç¨‹åºï¼Œå¸¦æœ‰ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œæ ¹æ®ç‰¹æ€§æ˜¯å¦æ´»åŠ¨æ¥åº”ç”¨ä¸€ä¸ªæˆ–å¦ä¸€ä¸ªé€»è¾‘ã€‚è¯¥åº”ç”¨ç¨‹åºå°†ä½¿ç”¨ http è¿æ¥åˆ° ffconsoleã€‚é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€å‘Šè¯‰æ‚¨å­˜å‚¨æ˜¯ä»€ä¹ˆ:

```
 @Bean
fun ff4j(): FF4j =
    FF4j().apply {
        featureStore = FeatureStoreHttp("http://ff4j-console:8080/api/ff4j")
    } 
```

åœ¨æ§åˆ¶å™¨ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç«¯ç‚¹ï¼Œå¦‚æœè¯¥ç‰¹æ€§æ˜¯æ´»åŠ¨çš„ï¼Œå®ƒå°†è¿”å› HTTP_200ï¼Œå¦‚æœä¸æ˜¯æ´»åŠ¨çš„ï¼Œå®ƒå°†è¿”å› HTTP_404ã€‚

```
 @GetMapping("/")
fun home(): ResponseEntity =
    ff.operateWith("AwesomeFeature",
        ResponseEntity("Not available", HttpStatus.NOT_FOUND),
        ResponseEntity("This is the awesome Feature", HttpStatus.OK)) 
```

è¿™æ˜¯å”¯ä¸€çš„ä»£ç ï¼Œä¸€æ—¦ç‰¹æ€§å·²ç»åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®ç°å¹¶ç»è¿‡è¶³å¤Ÿçš„æµ‹è¯•ï¼Œå°±åº”è¯¥æ¸…é™¤å¹¶åº”ç”¨å®ƒï¼Œè€Œä¸ä¾èµ–äºæ ‡å¿—æ˜¯å¦æ˜¯æ´»åŠ¨çš„ã€‚

è¿™é‡Œæ˜¯æˆ‘å¯¹è¿™ä¸ªåº“çš„å”¯ä¸€éšœç¢ï¼Œåœ¨ä¸€äº›åŠŸèƒ½ä¸­ä½¿ç”¨ç‰¹æ€§çš„ apiï¼Œä¾‹å¦‚ï¼Œåœ¨æ²¡æœ‰å‘å¸ƒ runtimeException çš„æƒ…å†µä¸‹ï¼Œæˆ–è€…å¤„ç†è¿™äº›ç‰¹æ€§æ˜¯å¿…é¡»çš„ï¼Œæ‰€ä»¥æˆ‘è‡ªç”±åœ°é€‰æ‹©äº†è¿™ä¸ªä¾‹å­æ¥åˆ¶ä½œä¸€ä¸ªå°çš„åŒ…è£…å™¨å¹¶ä½¿å®ƒæ›´â€œåŠŸèƒ½åŒ–â€,ç”¨å®ƒæˆ‘å…¬å¼€äº†ä¸‰ç§ä½¿ç”¨è¿™äº›ç‰¹æ€§çš„æ–¹æ³•:

```
 fun enabled(featureID: String): Boolean =
    getFeature(featureID)
        .map { it.isEnable }
        .orElse(false)

fun getFeature(featureID: String): Optional =
    try {
        Optional.of(ff4j.getFeature(featureID))
    } catch (nf: FeatureNotFoundException) {
        Optional.empty()
    }

fun operateWith(featureId: String, nonExistsValue: T, existsValue: T): T =
    getFeature(featureId)
        .filter{it.isEnable}
        .map { existsValue }
        .orElse(nonExistsValue) 
```

è¯¥é¡¹ç›®ç”±ä¸€ä¸ª docker compose ç»„è£…ï¼Œè¯¥ compose ä½¿ç”¨ make all ç”Ÿæˆå·¥ä»¶ï¼Œå¹¶è°ƒç”¨ä¸¤ä¸ª docker æ¥è¿›è¡Œæµ‹è¯•ã€‚ç®¡ç†éƒ¨åˆ†çš„ url æ˜¯ http://apiumhub . com:9090/ff4j-we b-console/

æ•´ä¸ªé¡¹ç›®åœ¨ [github](https://github.com/jcaromiq/ff4j-sample) ä¸­ã€‚

## ç»“è®º:java ä¸­çš„ç‰¹å¾æ ‡å¿—æ¨¡å¼

è¿™ç§æ¨¡å¼ä¸åº”è¯¥åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½ç”¨åšé”¤å­ã€‚

æœ€å¥½çš„ç­–ç•¥æ€»æ˜¯èƒ½å¤Ÿå°†åŠŸèƒ½/ç”¨æˆ·æ•…äº‹åˆ†å‰²æˆæ›´å°çš„éƒ¨åˆ†ï¼Œä»¥ä¾¿èƒ½å¤Ÿå°½å¿«åœ°å°†å®ƒä»¬é›†æˆèµ·æ¥ï¼Œä½†æ˜¯æ€»æ˜¯æœ‰è¿™æ ·çš„æƒ…å†µï¼Œå³ç›´åˆ°åŠŸèƒ½ 100%å®Œæˆï¼Œå¹¶ä¸”åœ¨å®ƒé€‚ç”¨çš„åœ°æ–¹æ‰å¯ä»¥äº¤ä»˜ã€‚

æœ€å¥½çš„ç­–ç•¥æ€»æ˜¯èƒ½å¤Ÿå°†åŠŸèƒ½/ç”¨æˆ·æ•…äº‹åˆ†å‰²æˆæ›´å°çš„éƒ¨åˆ†ï¼Œä»¥ä¾¿èƒ½å¤Ÿå°½å¿«åœ°å°†å®ƒä»¬é›†æˆèµ·æ¥ï¼Œä½†æ˜¯æ€»æ˜¯æœ‰è¿™æ ·çš„æƒ…å†µï¼Œå³ç›´åˆ°åŠŸèƒ½ 100%å®Œæˆï¼Œå¹¶ä¸”åœ¨å®ƒé€‚ç”¨çš„åœ°æ–¹æ‰å¯ä»¥äº¤ä»˜ã€‚

å¯¹äºåº”ç”¨ç¨‹åºçš„æ­£ç¡®å‘å±•å’Œç»´æŠ¤æ¥è¯´ï¼Œåœ¨çº¦å®šçš„æ—¶é—´å†…éƒ¨ç½²å’Œæµ‹è¯•ç‰¹æ€§ä¹‹åï¼Œæ¸…ç†ä»£ç çš„é˜¶æ®µæ˜¯éå¸¸é‡è¦çš„ã€‚

## å‚è€ƒä¹¦ç›®:java ä¸­çš„ç‰¹æ€§æ ‡å¿—æ¨¡å¼

*   [ç‰¹å¾è§’åº¦](https://martinfowler.com/bliki/FeatureToggle.html)
*   [FF4J ç»´åŸº](https://github.com/ff4j/ff4j/wiki)

å¦‚æœä½ æƒ³è·å¾—æ›´å¤šå…³äº java ç‰¹æ€§æ ‡å¿—æ¨¡å¼çš„ä¿¡æ¯ï¼Œæˆ‘å¼ºçƒˆæ¨èä½ ç‚¹å‡»[è¿™é‡Œ](http://eepurl.com/cC96MY)è®¢é˜…æˆ‘ä»¬çš„æ¯æœˆæ—¶äº‹é€šè®¯ã€‚

## å¦‚æœä½ è§‰å¾—è¿™ç¯‡å…³äº Java ç‰¹æ€§æ ‡å¿—æ¨¡å¼çš„æ–‡ç« å¾ˆæœ‰ç”¨ï¼Œä½ å¯èƒ½ä¼šå–œæ¬¢â€¦

[ä½¿ç”¨ Vavr åœ¨ Java ä¸­åŠŸèƒ½æ›´å¼ºå¤§](https://dev.to/apium_hub/be-more-functional-in-java-with-vavr-5b4i)

[Scala æ³›å‹ I: Scala ç±»å‹ç•Œé™](https://dev.to/apium_hub/scala-generics-i--scala-type-bounds-38)

[Scala generics II:åæ–¹å·®å’Œé€†å˜](https://dev.to/apium_hub/scala-generics-ii-covariance-and-contravariance-in-generics-5dib)

[Scala generics III:é€šç”¨ç±»å‹çº¦æŸ](https://dev.to/apium_hub/scala-generics-iii-generalized-type-constraints-58km)

BDD:ç”¨æˆ·ç•Œé¢æµ‹è¯•

[Scala ä¸­æ³›å‹ç±»å‹çš„ F-bound](https://apiumhub.com/tech-blog-barcelona/f-bound-scala-generics/)

[å¾®æœåŠ¡ vs æ•´ä½“æ¶æ„](https://apiumhub.com/tech-blog-barcelona/microservices-vs-monolithic-architecture/)

[â€œå‡ ä¹æ— é™â€çš„å¯æ‰©å±•æ€§](https://apiumhub.com/tech-blog-barcelona/almost-infinite-scalability/)

[iOS Objective-C app:æˆåŠŸæ¡ˆä¾‹ç ”ç©¶](https://dev.to/apium_hub/protected-ios-objective-c-app-cornerjob-successfull-case-study-89e)

[å¹´åº¦ç§»åŠ¨åº”ç”¨å¼€å‘è¶‹åŠ¿](https://dev.to/apium_hub/mobile-app-development-trends-of-the-year)

[Banco Falabella å¯ç©¿æˆ´è®¾å¤‡æ¡ˆä¾‹ç ”ç©¶](https://apiumhub.com/tech-blog-barcelona/banco-falabella-wearable-ios-android/)

[ç§»åŠ¨å¼€å‘é¡¹ç›®](https://apiumhub.com/software-projects-barcelona/)

[é¢å‘ iOS åº”ç”¨çš„ Viper æ¶æ„ä¼˜åŠ¿](https://apiumhub.com/tech-blog-barcelona/viper-architecture/)

[ä¸ºä»€ä¹ˆæ˜¯ç§‘ç‰¹æ—ï¼Ÿ](https://dev.to/apium_hub/why-kotlin-language-android-why-did-google-choose-kotlin--639)

[è½¯ä»¶æ¶æ„ä¼šè®®](https://dev.to/apium_hub/apiumhub-software-architecture-meetups-in-barcelona-31df)

[å®‰å“çº¯ MVP](https://dev.to/apium_hub/pure-model-view-presenter-in-android-1736)

java ä¸­çš„ post [ç‰¹å¾æ ‡å¿—æ¨¡å¼æœ€æ—©å‡ºç°åœ¨](https://apiumhub.com/tech-blog-barcelona/feature-flag-pattern/) [Apiumhub](https://apiumhub.com) ä¸Šã€‚