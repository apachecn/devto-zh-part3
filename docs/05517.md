# Node.js v12 åˆšåˆšå‘å¸ƒçš„å‡ºè‰²ç‰¹æ€§

> åŸæ–‡:[https://dev . to/bnb/the-awesome-features-that-just-landed-with-node-js-v 12-178d](https://dev.to/bnb/the-awesome-features-that-just-landed-with-node-js-v12-178d)

æœ¬å‘¨ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† Node.js v12 çš„å‘å¸ƒï¼Œè¿™æ˜¯å°†æˆä¸º LTS çš„ä¸‹ä¸€ä¸ª Node.js å‘å¸ƒç³»åˆ—ã€‚æˆ‘æƒ³æµè§ˆå‘å¸ƒçš„å„ç§å¸–å­å’Œå˜æ›´æ—¥å¿—ï¼Œå¹¶å°†ä¿¡æ¯æµ“ç¼©æˆæ˜“äºä½¿ç”¨çš„ Node.js v12.x ä¸­æ–°å¢å†…å®¹çš„æ‘˜è¦ï¼Œä¸å¤§å®¶åˆ†äº«ã€‚ğŸ’–

## [](#the-changes)è¿™ä¸ªğŸ”¥å˜åŒ–

è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ v12.0.0 ä¸­æœ€é‡è¦ã€æœ€æ˜¾è‘—çš„å˜åŒ–å§ï¼

### [](#new-es-modules-who-dis)æ–°å¢ ES æ¨¡å—ï¼Œå« dis

éšç€ Node.js v12.0.0 çš„å‘å¸ƒï¼Œæˆ‘ä»¬çœ‹åˆ° Node.js ä¸­å¼•å…¥äº† ES æ¨¡å—çš„æ–°å®ç°ã€‚ğŸ‰

> **æ³¨æ„:** ES æ¨¡å—åŠŸèƒ½ä»åœ¨**å®éªŒä¸­**ï¼Œå› æ­¤*ä¸åº”*ç”¨äºç”Ÿäº§ä»£ç ä¸­ï¼Œç›´åˆ°å®ƒä»¬æœ€ç»ˆç¡®å®šã€‚

åœ¨å‘å¸ƒæ—¶ï¼Œè¿™ä¸ªæ–°çš„å®ç°å·²ç»å–ä»£äº†ä»¥å‰çš„å®ç°ï¼Œéšè—åœ¨`--experimental-modules`æ ‡å¿—ä¹‹åã€‚è¿™æ˜¯ä¸ºäº†å¸®åŠ©è·å¾—æ–°çš„å®ç°å¹¶è¿›è¡Œæµ‹è¯•ï¼Œè¿™æ ·é¡¹ç›®å°±å¯ä»¥å¾—åˆ°åé¦ˆã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©(ğŸ¤)ï¼Œä¸€æ—¦ Node.js v12 åœ¨ 10 æœˆä»½è¿›å…¥ LTSï¼Œå®ƒå°±å¯ä»¥ä¸å¸¦æ ‡ç­¾å‘è´§äº†ï¼

é¦–å…ˆï¼Œæˆ‘æƒ³è¯´è¿™å°†æ˜¯ä¸€ä¸ª TLï¼›åšå£«ï¼Œå¦‚æœä½ æœ‰å…´è¶£æ·±å…¥äº†è§£ Node.js ä¸­ ESM çš„æ–°çƒ­ç‚¹ï¼Œè¯·æŸ¥çœ‹æ¨¡å—å›¢é˜Ÿåœ¨ Medium ä¸Šå‘è¡¨çš„åšæ–‡ã€‚

#### [](#previous-implementation)å…ˆå‰å®ç°

ä»¥å‰å®ç°çš„è®¸å¤šåŠŸèƒ½éƒ½ä¿ç•™äº†ä¸‹æ¥ã€‚è¿™åŒ…æ‹¬ ES2015 `import`è¯­å¥ï¼Œå„ç§`export`ï¼ŒNode.js `export`å¯¹æ‰€æœ‰æ ¸å¿ƒæ¨¡å—çš„æ”¯æŒï¼ŒCommonJS çš„ WIP å¯¼å…¥ï¼Œ **very** WIP loader APIï¼Œä»¥åŠå¦‚æœ`.mjs`æ–‡ä»¶æ‰©å±•åå­˜åœ¨çš„è¯ï¼Œæ˜ç¡®çš„ ESM è§£æã€‚

#### [](#new-implementation-features)æ–°å¢å®ç°åŠŸèƒ½

è¿™äº›ç‰¹æ€§ 100%æ˜¯æ–°çš„ï¼Œæ¨¡å—å›¢é˜Ÿä¸€ç›´åœ¨è¿›è¡Œå¢å¼ºï¼Œå¹¶ä¸”åœ¨ Node.js v12.0.0 ä¸­çš„`--experimental-modules`æ ‡å¿—åé¢å¯ç”¨ã€‚

*   åœ¨`.js`æ–‡ä»¶ä¸­å¯¼å…¥å’Œå¯¼å‡ºè¯­æ³•
    *   æœ‰å¾ˆå¤šåé¦ˆè®¤ä¸º Node.js éœ€è¦æä¾›ä¸€ç§åœ¨`.js`æ–‡ä»¶ä¸­ä½¿ç”¨å¯¼å…¥/å¯¼å‡ºçš„æ–¹æ³•ã€‚
    *   ä¸ºæ­¤å®æ–½äº†ä¸¤ç§ä¸åŒçš„è§£å†³æ–¹æ¡ˆ(ç»§ç»­é˜…è¯»ï¼)
*   æ”¯æŒ`package.json`ä¸­çš„`"type": "module"`
    *   å¦‚æœæ£€æµ‹åˆ°è¿™ç§æƒ…å†µï¼ŒNode.js ä¼šå°†é¡¹ç›®ä¸­çš„æ‰€æœ‰ `.js`æ–‡ä»¶*è§†ä¸º es æ¨¡å—ã€‚*
    *   å¦‚æœä»ç„¶æœ‰ CommonJS æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ–‡ä»¶æ‰©å±•å`.cjs`é‡å‘½åå®ƒä»¬ï¼Œè¿™å°†å‘Šè¯‰ Node.js æ˜¾å¼åœ°å°†å®ƒä»¬è§£æä¸º CommonJS
    *   ä¸€ä¸ª`--input-type`æ ‡å¿—ï¼Œç”¨äºç±»ä¼¼`--eval`å’Œ STDIN çš„æƒ…å†µ

#### [](#current-wip-features)å½“å‰åœ¨åˆ¶å“ç‰¹å¾

è¿™äº›ç‰¹æ€§ç›®å‰æ­£ç”±æ¨¡å—å›¢é˜Ÿå¼€å‘ï¼Œè¦ä¹ˆå·²ç»å®ç°ï¼Œä½†å¯èƒ½ä¼šæ”¹å˜*æˆ–*æ­£åœ¨å¼€å‘ï¼Œä½†å°šæœªåœ¨ Node.js v12.0.0 ä¸­å‘å¸ƒã€‚

*   JSON å¯¼å…¥
    *   ç›®å‰ä¸å·¥ä½œï¼Œä½†æ­£åœ¨ç§¯æå·¥ä½œã€‚
*   å¯¼å…¥å¹¶è¦æ±‚äº’æ“ä½œ
    *   ï¸ï¸âš ï¸æ¨¡å—å›¢é˜Ÿè¦æ±‚ä½ åœ¨é—®é¢˜è§£å†³ä¹‹å‰ä¸è¦å‘å¸ƒå¯ä»¥åœ¨ Node.js ä¸­ä½¿ç”¨çš„ es æ¨¡å—ã€‚æˆ‘è®¤ä¸ºåœ¨è¿™ä¸ªé—®é¢˜è§£å†³ä¹‹å‰å‘å¸ƒçš„æ¨¡å—å¯èƒ½ä¼šå´©æºƒã€‚
*   æ¨¡å—åŠ è½½å™¨
    *   éå¸¸ WIP
    *   ç¬¬ä¸€ä¸ªå®ç°çš„`--loader` API å·²ç»å‘å¸ƒï¼Œä½†å®ƒå°†è¢«æ”¹è¿›ï¼Œå› æ­¤ï¼Œ*æ”¹å˜*ã€‚
*   ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•æ¥`require`ES æ¨¡å—ä¸­çš„ä»£ç ã€‚
    *   å½“å‰çš„å®ç°æœ‰ç‚¹ç¬¨æ‹™ã€‚æ¨¡å—å›¢é˜Ÿæ­£åœ¨åŠªåŠ›é™ä½éšœç¢ã€‚
*   åŒ…è·¯å¾„æ˜ å°„
    *   è¿™å°†å…è®¸åœ¨æŸäº›æƒ…å†µä¸‹è¿›è¡Œä¸å¤ªå†—é•¿çš„å¯¼å…¥
*   è‡ªåŠ¨å…¥å£ç‚¹æ¨¡å—ç±»å‹æ£€æµ‹
    *   å®é™…ä¸Šï¼Œé™æ€åˆ†æå…è®¸ Node.js åˆ¤æ–­ä¸€ä¸ªæ¨¡å—æ˜¯ CommonJS æ¨¡å—è¿˜æ˜¯ ES æ¨¡å—ã€‚

#### [](#quick-esm-examples)å¿«é€Ÿ ESM ç¤ºä¾‹

å¦‚æœä½ æœ‰å…´è¶£çœ‹çœ‹ Node.js ä¸­çš„ ESM æ˜¯ä»€ä¹ˆæ ·å­ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘æ˜¨å¤©æ¨é€çš„ä¸¤ä¸ªå›è´­:

*   [simple-esm](https://github.com/bnb/simple-esm)â€“node . js ä¸­çš„ ESM åœ¨å½“å‰ ESM å®æ–½ä¸­çš„è¡¨ç°ç¤ºä¾‹
*   [simple-esm-usage](https://github.com/bnb/simple-esm-usage)â€“è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜å¦‚æœå½“å‰çš„å®ç°ä¿æŒä¸å˜(å®ƒå°†ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤è¿™æ›´å¤šæ˜¯ç†è®ºè€Œä¸æ˜¯å®è·µ)ï¼Œå¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨æ¥è‡ª npm çš„ ESM æ¨¡å—

æˆ‘è®¡åˆ’ä¿æŒè¿™äº›å›è´­åè®®(ä»¥åŠå‘å¸ƒç»™ npm çš„ simple-esm ç‰ˆæœ¬)éƒ½æ˜¯æœ€æ–°çš„ï¼Œå› ä¸º esm å®æ–½æ ¹æ®æˆ‘è‡ªå·±çš„ç†è§£å‘ç”Ÿäº†å˜åŒ–ï¼Œå¹¶ä¸”ä½œä¸ºä¸€ç§ç¤¾åŒºèµ„æºï¼Œåœ¨ Node.js ä¸­æœ‰ä¸€ä¸ªæœ€å°å¯è¡Œçš„ ESM ç¤ºä¾‹ã€‚

### [](#v8-74)V8 7.4

è¿™ä¸ªç‰ˆæœ¬åŒ…æ‹¬ä¸€ä¸ªé‡è¦çš„ **V8 å‡çº§**ï¼Œåœ¨å‘å¸ƒæ—¶å‘å‰è·³è·ƒäº†å‡ ä¸ªç‰ˆæœ¬åˆ° V8 çš„æœ€æ–°ç‰ˆæœ¬ã€‚è¿™æ¬¡å‡çº§åŒ…æ‹¬äº†è®¸å¤šéå¸¸æ£’çš„å¢å¼ºåŠŸèƒ½ã€‚æˆ‘ä¸ªäººæœ€æ„Ÿå…´è¶£çš„æ˜¯[é›¶æˆæœ¬å¼‚æ­¥å †æ ˆè·Ÿè¸ª](https://v8.dev/blog/v8-release-72#async-stack-traces)ï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„å¢å¼ºåŠŸèƒ½ï¼ŒV8 å›¢é˜Ÿçš„ Mathias Bynens å¯¹æ­¤åšäº†æ›´å¥½çš„æ¦‚è¿°:

> ![Mathias Bynens profile image](../Images/dedf260f16ec3783dd7e70f43cf5ca29.png)ã€é©¬è’‚äºšæ–¯Â·æ‹œä»ã€‘[@é©¬è’‚äºšæ–¯](https://dev.to/mathias)ä¸­çš„æ–° JavaScript åŠŸèƒ½{ListFormatï¼Œlocaleï¼Œrelative format }
> object . fromentries
> ç¨³å®šæ•°ç»„# sort
> ã€string # match allã€‘
> ã€symbol # descriptionã€‘
> ã€well formed JSON . stringifyã€‘ä¸‹åˆ 14:45-

### [](#tls-13)TLS 1.3

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æœ‰**å®˜æ–¹ TLS 1.3 æ”¯æŒ**ã€‚è¿™æ˜¯å¯¹ä»¥å‰çš„ TLS ç‰ˆæœ¬çš„ä¸€ä¸ªä»¤äººéš¾ä»¥ç½®ä¿¡çš„æ”¹è¿›ï¼Œæˆ‘éå¸¸å…´å¥‹ï¼Œå®ƒç°åœ¨åœ¨å³å°†åœ¨ LTS å‘è¡Œçš„å‘è¡Œç‰ˆä¸­å¾—åˆ°æ”¯æŒï¼å¹¸è¿çš„æ˜¯ï¼Œç”±äº OpenSSL 1.1.1 ä¸­çš„åº•å±‚å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘åå…¼å®¹çš„å˜åŒ–ã€‚å¦å¤–ï¼Œåœ¨ PR ä¸­æåˆ°[å®ƒåº”è¯¥è¢«åå‘ç§»æ¤åˆ°å…¶ä»– LTS å‘å¸ƒçº¿ä¸Šã€‚](https://github.com/nodejs/node/pull/26209)

å¦‚æœä½ å¯¹ TLS 1.3 çš„ç²¾å½©éƒ¨åˆ†æ„Ÿåˆ°å¥½å¥‡ï¼Œæˆ‘æ¨èè¿™ç¯‡æ¥è‡ª IETF çš„[åšå®¢æ–‡ç« ](https://www.ietf.org/blog/tls13/)ã€‚

### [](#worker-threads)å·¥ä½œè€…çº¿ç¨‹

è¿™æ˜¯ç¬¬ä¸€ä¸ª LTS å‘å¸ƒçº¿ï¼Œå°†åŒ…æ‹¬ç›®å‰æ­£åœ¨å®éªŒçš„å·¥ä½œçº¿ç¨‹ã€‚è¿™ä¸ªç‰ˆæœ¬ä¸å†éœ€è¦è¿è¡Œå¸¦æ ‡å¿—çš„å·¥ä½œçº¿ç¨‹ï¼Œæœ‰æœ›é™ä½åœ¨ Node.js ä¸­æ›´å¹¿æ³›ä½¿ç”¨å¹¶è¡ŒåŒ–å·¥ä½œå·¥å…·çš„éšœç¢ã€‚

å¦‚æœæ‚¨ç°åœ¨å¯¹å°è¯•å·¥ä½œè€…çº¿ç¨‹æ„Ÿå…´è¶£ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›èµ„æºæ¥å¼€å§‹:

*   [åœ¨ Node.js ä¸­ä½¿ç”¨ worker _ threads](https://medium.com/@Trott/using-worker-threads-in-node-js-80494136dbb6)
*   [node . js å·¥ä½œçº¿ç¨‹ä¸­çš„ç®€å•åŒå‘æ¶ˆæ¯ä¼ é€’](https://hackernoon.com/simple-bidirectional-messaging-in-node-js-worker-threads-7fe41de22e3c)
*   Node.js å¤šçº¿ç¨‹:ä»€ä¹ˆæ˜¯å·¥ä½œçº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆå®ƒä»¬å¾ˆé‡è¦ï¼Ÿ
*   [å®˜æ–¹ Node.js Worker Threads Docs](https://nodejs.org/api/worker_threads.html)

### [](#builtin-heap-snapshotting)å†…ç½®å †å¿«ç…§

åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ°äº†ä» npm ä¸Šçš„ [heapdump æ¨¡å—](https://www.npmjs.com/package/heapdump)æ”¹ç¼–è€Œæ¥çš„å†…ç½®å †å¿«ç…§ã€‚è¿™é€šè¿‡`v8.getHeapSnapshot()`å…¬å¼€ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯è¯»çš„æµã€‚

## [](#other-notable-changes-and-improvements)å…¶ä»–å€¼å¾—æ³¨æ„çš„å˜åŒ–å’Œæ”¹è¿›

*   æ ¸å¿ƒä¾èµ–å…³ç³»:
    *   å‡çº§åˆ° OpenSSL[1 . 1 . 1 b](https://www.openssl.org/news/cl111.txt)([nodejs/node # 26327](https://github.com/nodejs/node/pull/26327))
    *   å‡çº§åˆ° ICU 63 ( [nodejs/node#25852](https://github.com/nodejs/node/pull/25852) )
    *   ç›®å‰è¿˜æœ‰ä¸€ä¸ª[å¼€æ”¾ PR](https://github.com/nodejs/node/pull/27361) è¿›ä¸€æ­¥æ›´æ–°åˆ° ICU 64.2
*   Node.js å·²ç»å¼€å§‹ä½¿ç”¨ [llhttp](https://github.com/nodejs/llhttp) ä½œä¸ºå®ƒçš„é»˜è®¤è§£æå™¨( [nodejs/node#24730](https://github.com/nodejs/node/issues/24730)
*   `package.json`ä¸­æ— æ•ˆçš„`main`æ¡ç›®ç°åœ¨å°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯( [nodejs/node#26823](https://github.com/nodejs/node/pull/26823)
*   `node --debug`ç°å·²åœäº§â€”â€”è¯·æ”¹ç”¨`node --inspect`([nodejs/node # 25828](https://github.com/nodejs/node/pull/25828))
*   TLS 1.0 å’Œ 1.1 ç°åœ¨é»˜è®¤ç¦ç”¨( [nodejs/node#23814](https://github.com/nodejs/node/pull/23814) )

## [](#fin)é³

å¸Œæœ›è¿™ä¸ªæ–°ç‰ˆæœ¬çš„æ¦‚è¿°å¯¹ä½ æœ‰å¸®åŠ©ï¼å¦‚æœæ‚¨å¯¹å·²ç»å‘å¸ƒçš„æ–°åŠŸèƒ½æœ‰ä»»ä½•ç–‘é—®ï¼Œä½•æ—¶æ‚¨å¯ä»¥å¼€å§‹æœŸæœ›åœ¨ Node.js ä¸­ä½¿ç”¨ ESMï¼Œæˆ–è€…å…³äº Node.js v12 çš„ä»»ä½•å…¶ä»–å†…å®¹ï¼Œæˆ‘å¾ˆé«˜å…´æˆä¸ºæ‚¨çš„èµ„æºï¼Œå¸Œæœ›æ‚¨èƒ½æ‰¾åˆ°æ‚¨æ­£åœ¨å¯»æ‰¾çš„ç­”æ¡ˆï¼