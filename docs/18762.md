# â¤ï¸'s æ‹‰å§†è¾¾

> åŸæ–‡:[https://dev.to/royalaid/cljs-s-lambda-697](https://dev.to/royalaid/cljs-s-lambda-697)

# clo jure æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆå…³å¿ƒï¼Ÿ

å› ä¸ºæ¯ä¸€ä¸ªå…³äº Clojure æˆ–è€… Clojurescript (CLJS)çš„å¸–å­éƒ½è¦è§£é‡Š Clojure(script)æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦ç”¨:

> ![unknown tweet media content](../Images/2e8e619fb215c77ce2491e7ad5929644.png)![Play butt](../Images/980e9fb12d58fa9423fc94c33003fc4f.png)<video loop="" controls=""><source src="https://video.twimg.com/ext_tw_video/1068978070999027712/pu/vid/320x180/35NWMY5p0HOuar_f.mp4?tag=5" type="video/mp4"></video>![Amperity profile image](../Images/c9985e5fbeca579da84c2a74a7a834f5.png)Amperity@ Amperity![twitter logo](../Images/65e26e35707d96169ec8af6b3cbf2003.png)æˆ‘ä»¬å¦‚æ­¤çƒ­çˆ± [#Clojure](https://twitter.com/hashtag/Clojure) ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªéå¸¸å²è¯—èˆ¬çš„ã€å®Œå…¨åˆæ³•çš„å•†ä¸šä½œå“æ”¾åœ¨ä¸€èµ·ï¼Œè®©æ›´å¤šçš„äººæ‹¥æŠ±è¿™é—¨è¯­è¨€ï¼ŒåŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºã€‚å°½æƒ…äº«å—å§ï¼[# NoCodeOnlyData](https://twitter.com/hashtag/NoCodeOnlyData)21:23PM-01 2018 å¹´ 12 æœˆ[![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1068978794910777344)[![Twitter retweet action](../Images/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1068978794910777344)146[![Twitter like action](../Images/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1068978794910777344)363

ä½†æ˜¯ä¸¥è‚ƒåœ°è¯´ï¼Œå¾ˆå¤šäººå·²ç»å¯¹ Clojure åšäº†æ›´å¥½çš„ä»‹ç»ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°†ä¼š:

*   å‹‡æ•¢å’ŒçœŸå®çš„ clo jure
    *   æˆ‘æ˜¯å¦‚ä½•å­¦ä¹  Clojure (Long)çš„
*   [Y åˆ†é’Ÿå­¦ä¼š clo jure](https://learnxinyminutes.com/docs/clojure/)
    *   ä½ å¯ä»¥åœ¨ [REPL](https://clojure.org/guides/repl/introduction) è¿è¡Œä¸€ä¸ªæ–‡ä»¶æ¥æµ‹è¯•è¿™ç§è¯­è¨€
*   [Hypi å¯¹ Clojure å¸–å­çš„ä»‹ç»](https://hypi.io/blog/solutions/introduction-to-clojure/)
    *   ä»‹äºä¸Šè¿°ä¸¤è€…ä¹‹é—´çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¸­é—´åœ°å¸¦

# [](#serverless)ğŸ”¥æ— æœåŠ¡å™¨ğŸ”¥

ä¸å¹¸çš„æ˜¯ï¼Œæ²¡æœ‰ä¸€ä¸ªä»¤äººæƒŠè®¶çš„æ¨¡ä»¿æ— æœåŠ¡å™¨å¹¿å‘Šï¼Œæ‰€ä»¥è®©æˆ‘ä»¬è¯•ç€æ¿€å‘ä½ ä¸ºä»€ä¹ˆåº”è¯¥å…³å¿ƒå®ƒã€‚æ— æœåŠ¡å™¨åªæ˜¯æè¿°ä¸€ç§ä¸ç”¨æ‹…å¿ƒåŸºç¡€è®¾æ–½å°±èƒ½è¿è¡Œä»£ç çš„æ–¹å¼çš„ç®€å†™ã€‚è¿™å®é™…ä¸Šæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿç»™ä»–ä»¬å’Œ zipï¼Œä»–ä»¬å°±æ‰”åœ¨ä¸€äº›æ²¡ç”¨çš„ç¡¬ä»¶ä¸Šï¼Œå°±æ˜¯è¿™æ ·ï¼

å®ƒæ”¯æŒåœ¨ [AWS](https://aws.amazon.com/lambda/) ã€[è°·æ­Œäº‘](https://cloud.google.com/functions/)ã€ [Azure](https://azure.microsoft.com/en-us/services/functions/) ä»¥åŠå…¶ä»–äº‘ä¸Šè¿è¡Œã€‚å› ä¸ºè¿™äº›ä¾‹å­æ˜¯ç”¨ AWS æ„å»ºçš„ï¼Œè¿™æ˜¯æˆ‘ä»¬è¦å…³æ³¨çš„åœ°æ–¹ã€‚

æˆ–è®¸è¿ç§»åˆ°æ— æœåŠ¡å™¨æˆ–è€…ç”¨æ— æœåŠ¡å™¨æ„å»ºæ–°æœåŠ¡çš„æœ€å¤§åŠ¨åŠ›æ˜¯[æˆæœ¬](https://www.troyhunt.com/brief-lessons-on-handling-huge-traffic-spikes/)ã€‚[å…è´¹å±‚](https://aws.amazon.com/lambda/pricing/)éå¸¸æ…·æ…¨ï¼Œè€Œä¸”æ˜¯éšç”¨éšä»˜ï¼Œæ‰€ä»¥å¯ä»¥å…è´¹åˆ¶ä½œåŸå‹ï¼

[![Eyes popping](../Images/2db435b47b9665d9b1998d7f8bd88499.png)T2ã€‘](https://i.giphy.com/media/12eOoLezVypVWo/giphy.gif)

æ‚¨è¿˜å¯ä»¥è½»æ¾éƒ¨ç½²/æ“ä½œï¼Œå¹¶ä¸æ‚¨çš„äº‘æä¾›å•†è¿›è¡Œæœ¬æœºé›†æˆï¼Œä»è€Œéå¸¸å®¹æ˜“åœ°åˆ©ç”¨äº‘æä¾›çš„æ•°æ®åº“ã€æŒ‡æ ‡/åˆ†æã€é˜Ÿåˆ—ã€ç”µå­é‚®ä»¶æœåŠ¡ç­‰æœåŠ¡ã€‚

# CLJS+Î»

è™½ç„¶æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥å°† Clojurescript å’Œ Lambda ç»“åˆåœ¨ä¸€èµ·ï¼Œä½†æ˜¯å®ƒä»¬ä¸ç‰¹å®šçš„æ„å»ºå·¥å…·ç›¸ç»“åˆï¼Œå¯¹æˆ‘æ¥è¯´æœ‰ç‚¹åƒé»‘ç›’ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å€Ÿå£æ¥äº†è§£æ‰€æœ‰çš„éƒ¨åˆ†æ˜¯å¦‚ä½•è¿æ¥åœ¨ä¸€èµ·çš„ã€‚è¿™ç¯‡æ–‡ç« æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„ç²¾åã€‚åœ¨æœ€ç»ˆè¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜å¾—ä»‹ç»ä¸€ä½é€‰æ‰‹ä¸Šå°ã€‚

## [](#shadowcljs)å½±å­-CLJS

Shadow-CLJS æ˜¯ Clojurescript ç¼–è¯‘å™¨çš„å¦ä¸€ä¸ªå‰ç«¯ï¼Œå¦‚æœä½ ç†Ÿæ‚‰è¿™ä¸ªé¢†åŸŸï¼Œå®ƒä¸ [lein-cljsbuild](https://github.com/emezeske/lein-cljsbuild) æˆ– [Figwheel-main](https://github.com/bhauman/figwheel-main) çš„ä½œç”¨ç›¸åŒã€‚ä¸å…¶ä»–å·¥å…·ç›¸æ¯”ï¼Œå®ƒæœ€å¤§çš„ä¼˜åŠ¿æ˜¯[å¼ºå¤§çš„ npm æ”¯æŒ](https://code.thheller.com/blog/shadow-cljs/2017/11/10/js-dependencies-in-practice.html)ã€‚æˆ‘ä»¬åŸºæœ¬ä¸Šå¯ä»¥é€šè¿‡ Shadow å°†æ‰€æœ‰ npm ä¸ CLJS ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ©ç”¨åƒ [AppSync](https://aws.amazon.com/appsync/) æˆ– [AWS Node SDK](https://aws.amazon.com/sdk-for-node-js/) è¿™æ ·çš„ä¸œè¥¿ï¼Œè¿™å¾ˆé‡è¦ã€‚

# [](#make-the-damn-lambda-already)è®©é‚£è¯¥æ­»çš„æ‹‰å§†è¾¾ç´§ç€

## [](#setup)è®¾ç½®

å¥½å§ï¼Œè®©æˆ‘ä»¬åšä¸€ä¸ª lambdaï¼Œæœ€ç»ˆæˆ‘ä»¬ä¼šæ‰”æ‰å®ƒé‡Œé¢çš„æ‰€æœ‰ä¸œè¥¿ï¼Œä½†æ˜¯ç°åœ¨å°±è®©å®ƒå»å§ã€‚
[![](../Images/5c00c49696a0ae22d55b3d0bfec91a7f.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--k4oGtY4Z--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thumbs.gfycat.com/CraftyGroundedGrassspider-size_restricted.gif) 
è€Œæœ‰äº†æˆ‘ä»¬çš„åŸºæœ¬ lambda æˆ‘ä»¬åªéœ€è¦æˆ‘ä»¬çš„å·¥å…·å’Œä¸€äº›ç¤ºä¾‹ä»£ç ï¼Œé¦–å…ˆå·¥å…·:
`brew install yarn #Or your OS equiv, apt-get, yum, etc`
å°±è¿™æ ·ï¼

## [](#example-code)ç¤ºä¾‹ä»£ç 

å¯¹äºç¤ºä¾‹ä»£ç ï¼Œæˆ‘å·²ç»åˆ†å‰äº†[é™ˆå‹‡çš„](https://github.com/chenyong)æœ€å°[é˜´å½±+èŠ‚ç‚¹ç¤ºä¾‹](https://github.com/minimal-xyz/minimal-shadow-cljs-nodejs)æ¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰é˜´å½±çš„ hello world lambda:

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png) [çš‡å®¶æ´åŠ©](https://github.com/royalaid) / [æå°é˜´å½±-cljs-nodejs](https://github.com/royalaid/minimal-shadow-cljs-nodejs)

### Node.js çš„ shadow-cljs çƒ­ä»£ç äº¤æ¢

<article class="markdown-body entry-content container-lg" itemprop="text">

## [shadow-cljs](https://github.com/thheller/shadow-cljs) çš„ Node.js ç¤ºä¾‹

### å‘å±•

ä½¿ç”¨çƒ­é‡è£…è¿›è¡Œç›‘è§†ç¼–è¯‘:

```
yarn
yarn shadow-cljs watch app
```

å¼€å§‹ç¨‹åº:

```
node target/main.js
```

### å–ä»£

å¯åŠ¨ä¸€ä¸ªè¿æ¥åˆ°å½“å‰è¿è¡Œç¨‹åºçš„ REPLï¼Œ`app`ä¸º`:build-id`:

```
yarn shadow-cljs cljs-repl app
```

### å»ºè®¾

```
shadow-cljs release app
```

ç¼–è¯‘åˆ°`target/main.js`ã€‚

ä½ å¯èƒ½ä¼šåœ¨[http://doc.shadow-cljs.org/](http://doc.shadow-cljs.org/)ä¸Šæ‰¾åˆ°æ›´å¤šé…ç½®ã€‚

### æ­¥ä¼

*   å°†`shadow-cljs.edn`æ·»åŠ åˆ°é…ç½®ç¼–è¯‘ä¸­
*   ç¼–è¯‘ ClojureScript
*   è¿è¡Œ`node target/main.js`å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶è¿æ¥é‡æ–°åŠ è½½æœåŠ¡å™¨

### è®¸å¯è¯

ç”¨å®ƒ

</article>

[View on GitHub](https://github.com/royalaid/minimal-shadow-cljs-nodejs)

```
git clone https://github.com/royalaid/minimal-shadow-cljs-nodejs.git /tmp/lambda-example
cd /tmp/lambda-example
yarn 
```

ç°åœ¨ä½ æ‰€æœ‰çš„éƒ¨é—¨éƒ½è®¾ç½®å¥½äº†ï¼

## [](#code-breakdown)ä»£ç åˆ†è§£

è™½ç„¶è¿™ä¸ªé¡¹ç›®åº”è¯¥æ˜¯ä¸è¨€è‡ªæ˜çš„ï¼Œä½†æˆ‘å°†ç»™å‡ºé‡è¦éƒ¨åˆ†çš„é«˜çº§æ¦‚è¿°ï¼Œå³`shadow-cljs.edn`å’Œ`src/server/main.cljs`æ–‡ä»¶ã€‚

### [T1ã€‘shadow-cljs . edn](#shadowcljsedn)

`shadow-cljs.edn`ç›¸å½“äº lein çš„`project.clj`æˆ– boot çš„`boot.clj`ï¼Œå®ƒæ˜¯ Shadow çš„æ„å»ºé…ç½®æ–‡ä»¶ã€‚å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œè¯¥æ–‡ä»¶æœ€é‡è¦éƒ¨åˆ†æ˜¯`:target :node-library`è¡Œï¼Œå®ƒå‘Šè¯‰ shadow è®¾ç½®`module.exports`ä¾› node ä½¿ç”¨ï¼Œè¿™æ˜¯ CLJS ä»£ç ä¸ Node è¯»å–çš„ Javascript ä¹‹é—´çš„æ¡¥æ¢ã€‚ç¬¬äºŒæ¡æœ€é‡è¦çš„çº¿æ˜¯`:exports {:handler server.main/handler}`ã€‚è¿™ä¸€è¡Œå‘Šè¯‰ Shadow è°ƒç”¨ä»€ä¹ˆå¯¼å‡ºï¼Œç„¶åç»‘å®šä»€ä¹ˆ CLJS å‡½æ•°ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ Clojurescript åç§°ç©ºé—´ä¸­çš„ handler å‡½æ•°`server.main`ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ lambda æ—¶ï¼ŒAWS å°†æœ€ç»ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚

### [](#maincljs)main.cljs

è‡³äº`src/server/main.cljs`ï¼Œåœ¨ Shadow ä¸ºæˆ‘ä»¬ä¼ è¾“ä¹‹åï¼Œè¿™å°†æœ€ç»ˆç”± AWS è¿è¡Œã€‚åç§°ç©ºé—´ä¸­å”¯ä¸€çš„å‡½æ•°å°±æ˜¯å®é™…è°ƒç”¨çš„å‡½æ•°ã€‚é‡è¦è¯´æ˜ï¼Œå‡½æ•°ç­¾åå¿…é¡»æœ‰ 3 ä¸ªå‚æ•°(å¦‚æœä½¿ç”¨ async/awaitï¼Œåˆ™ä¸º 2 ä¸ªï¼Œä½†æˆ‘ä»¬æ²¡æœ‰),å¹¶ä¸”å¿…é¡»é€šè¿‡è°ƒç”¨`cb`å‚æ•°å¹¶å°†ç»“æœä¼ é€’ç»™å›è°ƒ(`cb`)è°ƒç”¨çš„ç¬¬äºŒä¸ªå‚æ•°æ¥â€œè¿”å›â€å…¶å€¼ã€‚

æˆ‘ä»¬éœ€è¦è¿™æ ·åšï¼Œå› ä¸º Lambda å¸Œæœ›ç»“æœæ˜¯ä¸€ä¸ªæ‰¿è¯ºæˆ–è€…æ¥è‡ªä¼ å…¥çš„å›è°ƒã€‚è¿™èŠ±äº†æˆ‘å¤ªé•¿æ—¶é—´æ‹¼å‡‘ï¼Œå¸Œæœ›è¿™ä¸ä¼šç»Šå€’ä»»ä½•äººã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿è¿”å› Javascript å€¼ï¼Œè€Œä¸æ˜¯ Clojurescript å€¼ï¼Œå› æ­¤å¯¹æ•°ç»„ä½¿ç”¨äº†`#js`ã€‚

## [](#build-and-release-time)æ„å»ºå’Œå‘å¸ƒæ—¶é—´

###### [](#note-i-am-going-to-skip-the-process-of-actually-developing-the-code-but-check-out-the-earlier-linked-shadow-node-example-for-details-and-workflow-for-how-to-use-shadow-with-nodejs-and-hotreloading)æ³¨æ„:æˆ‘å°†è·³è¿‡å®é™…å¼€å‘ä»£ç çš„è¿‡ç¨‹ï¼Œä½†è¯·æŸ¥çœ‹ä¹‹å‰é“¾æ¥çš„[é˜´å½±+èŠ‚ç‚¹ç¤ºä¾‹](https://github.com/minimal-xyz/minimal-shadow-cljs-nodejs)ä»¥äº†è§£å¦‚ä½•å°†é˜´å½±ç”¨äº Nodejs å’Œçƒ­é‡è½½çš„è¯¦ç»†ä¿¡æ¯å’Œå·¥ä½œæµç¨‹ã€‚

```
cd /tmp/lambda-example # Get you back to the correct directory
yarn shadow-cljs release app # This transpiles and optimizes your CLJS
zip -r archive.zip target # Prep your output for upload to Lambda 
```

ç„¶åï¼Œæˆ‘ä»¬åªéœ€å°†æ–°çš„ zip æ–‡ä»¶ä¸Šä¼ åˆ°æ—§çš„ Lambda ä¸­ï¼Œå¹¶å°†å¤„ç†å‡½æ•°æŒ‡å‘æˆ‘ä»¬çš„ CLJS å‡½æ•°(å°†ä¼šæ˜¯ã€‚è®°å½•ä¸­çš„ handlerï¼Œmain.handler)ã€‚

[![](../Images/700af3aede02fac47402171e1b548d1e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--gLO6mMFI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thumbs.gfycat.com/IllTinyApisdorsatalaboriosa-size_restricted.gif)

# [](#)ğŸ‰ğŸ‰ğŸ‰

æˆ‘ä»¬åšåˆ°äº†ï¼å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–åé¦ˆï¼Œè¯·åœ¨æ¨ç‰¹ã€[ä¹³é½¿è±¡](https://royalaid.me/@admin)æˆ– [@royalaid](https://dev.to/royalaid) ä¸Šè”ç³» Clojurians [Slack](https://clojurians.slack.com/) æˆ– [Zulip](http://clojurians.zulipchat.com/)