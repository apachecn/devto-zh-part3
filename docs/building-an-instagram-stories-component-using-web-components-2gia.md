# ä½¿ç”¨ Web ç»„ä»¶æ„å»º Instagram/Whatsapp stories å…‹éš†ğŸ”¥

> åŸæ–‡ï¼š<https://dev.to/gugadev/building-an-instagram-stories-component-using-web-components-2gia>

## ![GitHub logo](img/292a238c61c5611a7f4d07a21d9e8e0a.png) [å¤åŠ æ·å¤«](https://github.com/gugadev) / [æ–¯æ‰˜ç‘æ–¯](https://github.com/gugadev/storify)

### åŸºäº Web ç»„ä»¶å’Œ Web åŠ¨ç”» API æ„å»ºçš„ Instagram/Whatsapp stories å…‹éš†ã€‚ğŸ”¥

<article class="markdown-body entry-content container-lg" itemprop="text">

# wc <g-emoji class="g-emoji" alias="globe_with_meridians" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f310.png">ğŸŒ</g-emoji>æ•…äº‹

Instagram/Whatsapp æ•…äº‹ï¼Œå¦‚åŸºäº Web ç»„ä»¶å’Œ Web åŠ¨ç”» API æ„å»ºçš„æ•…äº‹

## æ°‘ä¼—

| [![](img/89b01f4193ba33dea4af488374a74635.png)](https://github.com/gugadev/storify) 
é¦™è‰ JS | [![](img/a382a8e4d965e75f4942ceb27c945766.png)](https://github.com/gugadev/storify) 
æ£±è§’åˆ†æ˜ | [![](img/f5401c26784fee6bd5757991096cc23d.png)](https://github.com/gugadev/storify) 
æœ‰ä»€ä¹ˆååº” | [![](img/af32d3c6f632efe02e856f87ae7a4b4c.png)](https://github.com/gugadev/storify) 
è§†å›¾ |
| --- | --- | --- | --- |
| [é“¾æ¥](https://gugadev.github.io/wc-stories) | [é“¾æ¥](https://angular-yhsvse.stackblitz.io/) | [é“¾æ¥](https://react-zf2tfr.stackblitz.io/) | [é“¾æ¥](https://vue-et4qky.stackblitz.io/) |

## æµè§ˆå™¨æ”¯æŒ

| [![IE / Edge](img/0d7406188dca3af88f338de22a3d7b43.png)](http://godban.github.io/browsers-support-badges/) 
IE / Edge | [![Firefox](img/ff9cc1628eb13a3a3281081c389d5b25.png)](http://godban.github.io/browsers-support-badges/) 
ç«ç‹ | [![Chrome](img/14a8c8b5bedb6533375b6062749af19c.png)](http://godban.github.io/browsers-support-badges/) 
é“¬ | [![Safari](img/acc403ea226add6eeb284ed36db195ad.png)](http://godban.github.io/browsers-support-badges/) 
æ¸¸çŒ | [![Opera](img/24055376a7eaea42846d151d51746d1e.png)](http://godban.github.io/browsers-support-badges/) 
æˆæ›² |
| --- | --- | --- | --- | --- |
| IE11ï¼Œè¾¹ç¼˜ | æœ€è¿‘ 10 ä¸ªç‰ˆæœ¬ | æœ€è¿‘ 10 ä¸ªç‰ˆæœ¬ | æœ€è¿‘ 10 ä¸ªç‰ˆæœ¬ | æœ€è¿‘ 10 ä¸ªç‰ˆæœ¬ |

* * *

## <g-emoji class="g-emoji" alias="package" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f4e6.png">ğŸ“¦</g-emoji>å®‰è£…

```
npm i @gugadev
/wc-stories
```

Enter fullscreen mode Exit fullscreen mode

## <g-emoji class="g-emoji" alias="bulb" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f4a1.png">ğŸ’¡å®ƒçš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ</g-emoji>

åªæ˜¯å¥½ç©è€Œå·²<g-emoji class="g-emoji" alias="slightly_smiling_face" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f642.png">ğŸ™‚</g-emoji>ã€‚æˆ‘å–œæ¬¢å­¦ä¹ å’Œç¼–ç ï¼Œæ‰€ä»¥ï¼Œæ¯æ¬¡æˆ‘æœ‰ç©ºçš„æ—¶å€™ï¼Œæˆ‘éƒ½ä¼šæŒ‘é€‰ä¸€äº›ç–¯ç‹‚çš„æƒ³æ³•æˆ–è€…ä»å…¶ä»–é¡¹ç›®ä¸­å¾—åˆ°çµæ„Ÿï¼Œç„¶åæŠŠå®ƒåšå‡ºæ¥ã€‚<g-emoji class="g-emoji" alias="yum" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f60b.png">ğŸ˜‹</g-emoji>

## <g-emoji class="g-emoji" alias="unicorn" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f984.png">ğŸ¦„</g-emoji>çµæ„Ÿ

å½“æˆ‘çœ‹åˆ° Mohit çš„é¡¹ç›®æ—¶ï¼Œ [react-insta-stories](https://github.com/mohitk05/react-insta-stories) ï¼Œç«‹åˆ»æƒ³çŸ¥é“ä½¿ç”¨ **Web ç»„ä»¶**åšåŒæ ·çš„äº‹æƒ…ä¼šæœ‰å¤šå¤æ‚ã€‚æ‰€ä»¥ï¼Œæˆ‘åšäº†è¿™ä¸ªã€‚è°¢è°¢ä½ ï¼Œè«å¸Œç‰¹ï¼<g-emoji class="g-emoji" alias="smiley" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f603.png">ğŸ˜ƒ</g-emoji>

## <g-emoji class="g-emoji" alias="gear" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/2699.png">âš™ï¸</g-emoji> å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

æœ‰ä¸‰ä¸ªç»„ä»¶ååŒå·¥ä½œ:

*   `<wc-stories-story>`:è¿™ä¸ªç»„ä»¶æ˜¾ç¤ºä¸€ä¸ªå›¾åƒã€‚å›¾åƒçš„æœ€å¤§å°ºå¯¸æ˜¯â€¦

</article>

[View on GitHub](https://github.com/gugadev/storify)

> **æ³¨:**æœ¬å¸–ä¸è´´ç»„ä»¶æ ·å¼ï¼Œé‡ç‚¹æ˜¯é€»è¾‘ã€‚ç„¶è€Œï¼Œä½ å¯ä»¥åœ¨ [Github å›è´­](https://github.com/gugadev/wc-stories)ä¸­æ‰¾åˆ°å®ƒä»¬ã€‚

## ğŸ¦„çµæ„Ÿ

å‡ å¤©å‰ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªæ¥è‡ª *Mohit Karekar* çš„åä¸º [react-insta-stories](https://github.com/mohitk05/react-insta-stories) çš„é¡¹ç›®ã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯æœ‰è¶£çš„å»ºç«‹ç›¸åŒçš„æƒ³æ³•ï¼Œä½†ä½¿ç”¨ Web ç»„ä»¶ä»£æ›¿ã€‚æ‰€ä»¥ï¼Œæˆ‘æ‹¿èµ·æˆ‘çš„ç”µè„‘ï¼Œå¼€å§‹ç¼–ç ã€‚ğŸ˜‰

## è®¾ç½®

åœ¨ä»»ä½•é¡¹ç›®ä¸­ï¼Œæ‚¨éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯è®¾ç½®å¼€å‘ç¯å¢ƒã€‚åœ¨ä¸€ä¸ªå¸¸è§„çš„å‰ç«¯é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†æœ€ç»ˆä½¿ç”¨ Webpack ä½œä¸º transpiler å’Œ bundlerã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [lit-element](https://github.com/polymer/lit-element) æ¥ç¼–å†™æˆ‘ä»¬çš„ Web ç»„ä»¶å’Œ PostCSS è¿›è¡Œé€ å‹ï¼Œå¹¶ä½¿ç”¨ä¸€äº›æ’ä»¶ï¼Œå¦‚ *cssnano* ã€‚

ğŸ› ï¸å¼€å‘ä¾èµ–:

```
yarn add --dev webpack webpack-cli webpack-dev-server uglifyjs-webpack-plugin html-webpack-plugin clean-webpack-plugin webpack-merge typescript tslint ts-node ts-loader postcss-loader postcss-preset-env cross-env cssnano jest jest-puppeteer puppeteer npm-run-all 
```

Enter fullscreen mode Exit fullscreen mode

âš™ï¸è¿è¡Œæ—¶ä¾èµ–:

```
yarn add lit-element core-js @types/webpack @types/webpack-dev-server @types/puppeteer @types/node @types/jest @types/jest-environment-puppeteer @types/expect-puppeteer 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬çš„æºä»£ç å¿…é¡»åœ¨`src/`æ–‡ä»¶å¤¹ä¸­ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª`demo/`æ–‡ä»¶å¤¹ï¼Œå¹¶å°†ä¸€äº›å›¾åƒæ”¾å…¥å…¶ä¸­ã€‚

### Webpack

è®©æˆ‘ä»¬å°† Webpack é…ç½®åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:

*   `webpack.common.ts`:ä¸ºä¸¤ç§ç¯å¢ƒæä¾›å…±äº«é…ç½®ã€‚
*   `webpack.dev.ts`:ä»…ç”¨äºå¼€å‘çš„é…ç½®ã€‚
*   `webpack.prod.ts`:ä»…ç”¨äºç”Ÿäº§çš„é…ç½®ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¿…é¡»è¿›è¡Œä¸€äº›è°ƒæ•´ï¼Œå¦‚æ†ç»‘ä¼˜åŒ–ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹é‚£äº›æ–‡ä»¶ã€‚

**webpack.common.js**

```
import path from 'path'
import CleanWebpackPlugin from 'clean-webpack-plugin'
import webpack from 'webpack'

const configuration: webpack.Configuration = {
  entry: {
    index: './src/index.ts'
  },
  output: {
    filename: '[name].js',
    path: path.resolve(__dirname, 'dist')
  },
  resolve: {
    extensions: [
      '.ts',
      '.js'
    ]
  },
  module: {
    rules: [
      {
        test: /\.(ts|js)?$/,
        use: [
          'ts-loader'
        ],
        exclude: [
          /node_modules\/(?!lit-element)/
        ]
      },
      {
        test: /\.pcss?$/,
        use: [
          'css-loader',
          'postcss-loader'
        ]
      }
    ]
  },
  plugins: [
    new CleanWebpackPlugin(['dist'])
  ]
}

export default configuration 
```

Enter fullscreen mode Exit fullscreen mode

è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†åŸºæœ¬çš„é…ç½®ï¼Œæ¯”å¦‚ï¼Œ`entry`å’Œ`output`è®¾ç½®ï¼Œè§„åˆ™å’Œä¸€ä¸ªæ’ä»¶ï¼Œç”¨äºåœ¨æ¯æ¬¡ç¼–è¯‘ä¹‹å‰æ¸…ç†è¾“å‡ºæ–‡ä»¶å¤¹ã€‚

**webpack.dev.js**

```
import webpack from 'webpack'
import merge from 'webpack-merge'
import HtmlWebpackPlugin from 'html-webpack-plugin'
import common from './webpack.common'

const configuration: webpack.Configuration = {
  mode: 'development',
  devtool: 'inline-source-map',
  devServer: {
    contentBase: './demo',
    publicPath: '/',
    compress: true,
    port: 4444
  },
  plugins: [
    new HtmlWebpackPlugin({
      filename: './demo/index.html'
    })
  ]
}

export default merge(common, configuration) 
```

Enter fullscreen mode Exit fullscreen mode

å¼€å‘é…ç½®åªæ·»åŠ äº† webpack-dev-server è®¾ç½®å’Œä¸€ä¸ªé¢å¤–çš„æ’ä»¶ï¼Œä»¥ä½¿ç”¨ HTML æ–‡ä»¶ä½œä¸ºä¸ºå¼€å‘æœåŠ¡å™¨æä¾›çš„*index.html*ã€‚

**webpack.prod.js**

```
import webpack from 'webpack'
import merge from 'webpack-merge'
import UglifyPlugin from 'uglifyjs-webpack-plugin'
import common from './webpack.common'

const configuration: webpack.Configuration = {
  mode: 'production',
  devtool: 'source-map',
  optimization: {
    minimizer: [
      new UglifyPlugin({
        sourceMap: true,
        uglifyOptions: {
          output: { comments: false }
        }
      })
    ]
  }
}

export default merge(common, configuration) 
```

Enter fullscreen mode Exit fullscreen mode

æœ€åï¼Œæˆ‘ä»¬çš„ç”Ÿäº§é…ç½®åªæ˜¯è°ƒæ•´äº†ä¸€äº›ğŸš€ä½¿ç”¨ uglifyjs-webpack-plugin åŒ…çš„ä¼˜åŒ–é€‰é¡¹ã€‚

è¿™å°±æ˜¯æ‰€æœ‰çš„ webpack é…ç½®ã€‚æœ€åä¸€æ­¥æ˜¯åœ¨æˆ‘ä»¬çš„ *package.json* ä¸­åˆ›å»ºä¸€äº›è„šæœ¬æ¥è¿è¡Œå¼€å‘æœåŠ¡å™¨å¹¶ç”Ÿæˆä¸€ä¸ªâš™ï¸ *ç”Ÿäº§ç‰ˆæœ¬* :

```
"start":  "cross-env TS_NODE_PROJECT=tsconfig.webpack.json webpack-dev-server --config webpack.dev.ts",  "build":  "cross-env TS_NODE_PROJECT=tsconfig.webpack.json webpack --config webpack.prod.ts", 
```

Enter fullscreen mode Exit fullscreen mode

### PostCSS

æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„`.postcssrc`æ–‡ä»¶ï¼Œä»¥æ­£ç¡®å¤„ç†æˆ‘ä»¬çš„*ã€‚pcs æ–‡ä»¶:

```
{  "plugins":  {  "postcss-preset-env":  {  "stage":  2,  "features":  {  "nesting-rules":  true  }  },  "cssnano":  {}  }  } 
```

Enter fullscreen mode Exit fullscreen mode

### æ‰“å­—ç¨¿

æœ€åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª`tsconfig.json`æ–‡ä»¶æ¥é…ç½®æˆ‘ä»¬çš„ç±»å‹è„šæœ¬ç¯å¢ƒ:

```
{  "compilerOptions":  {  "target":  "es5",  "module":  "commonjs",  "allowJs":  true,  "esModuleInterop":  true,  "moduleResolution":  "node",  "emitDecoratorMetadata":  true,  "experimentalDecorators":  true,  "sourceMap":  true,  "removeComments":  true  },  "include":  [  "src/"  ],  "exclude":  [  "node_modules/"  ]  } 
```

Enter fullscreen mode Exit fullscreen mode

å¦å¤–ï¼Œåˆ›å»ºä¸€ä¸ª`tsconfig.webpack.json`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†ç”± ts-node ä½¿ç”¨ Typescript:
è¿è¡Œ Webpack

```
{  "compilerOptions":  {  "target":  "es5",  "module":  "commonjs",  "esModuleInterop":  true  }  } 
```

Enter fullscreen mode Exit fullscreen mode

## ğŸ­ç»“æ„

è®©æˆ‘ä»¬æŠŠäº‹æƒ…ç®€å•åŒ–ã€‚æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸‰ä¸ªç»„ä»¶:

*   å®¹å™¨
*   æ•…äº‹
*   è¿›åº¦æ¡

å®¹å™¨æ˜¯é€»è¾‘å°†è¢«å†™å…¥çš„åœ°æ–¹ã€‚åœ¨è¿™é‡Œ*æˆ‘ä»¬æ§åˆ¶å“ªä¸ªå›¾åƒåº”è¯¥å¯è§ï¼Œå“ªä¸ªä¸å¯è§*ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¤„ç†*å‰ä¸€ä¸ª*å’Œ*åä¸€ä¸ª*çš„ç‚¹å‡»ã€‚*æ•…äº‹*ç»„ä»¶æ˜¯*ç»„ä»¶ï¼Œå›¾åƒå°†åœ¨è¿™é‡Œæ˜¾ç¤º*ï¼Œè€Œ*è¿›åº¦æ¡*ç»„ä»¶æ˜¯*ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œå¯è§†åŒ–å½“å‰å›¾åƒçš„å®šæ—¶*ã€‚

## ğŸ“¦`<story>`ç»„ä»¶ã€‚

è¿™ä¸ªç»„ä»¶å¾ˆç®€å•ï¼Œå®ƒåªåŒ…å«ä¸€ä¸ªå†…éƒ¨æœ‰ä¸€ä¸ª`img`çš„`div`ã€‚è¯¥å›¾åƒçš„åŒ…è£…æ˜¯å¿…è¦çš„ï¼Œä½¿åŠ¨ç”»ã€‚

è®©æˆ‘ä»¬åœ¨`stories/`æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ª`index.ts`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:

```
import {
  LitElement,
  html,
  customElement,
  property
} from 'lit-element'
import styles from './index.pcss'

@customElement('wc-stories-story')
class Story extends LitElement {

  /**
   * @description image absolute or relative url
   */
  @property({ type: String }) src = ''
  /**
   * @description checks if an image is available to show
   */
  @property({ type: Boolean }) visible = false

  render() {
    return html`
      <div class="${this.cssClass}">
        <img src="${this.src}" />
      </div>
      <style> ${styles.toString()} </style>
    `
  }

  get cssClass() {
    return [
      'stories__container__story',
      this.visible ? 'visible' : ''
    ].join('  ')
  }
}

export { Story } 
```

Enter fullscreen mode Exit fullscreen mode

ä½¿ç”¨ lit-element çš„ Web ç»„ä»¶çš„ç»“æ„å¾ˆç®€å•ã€‚æ‚¨éœ€è¦å®ç°çš„å”¯ä¸€**å¼ºåˆ¶æ–¹æ³•æ˜¯`render`ã€‚æ­¤æ–¹æ³•å¿…é¡»è¿”å›å°†è¢«éšè—çš„ html å†…å®¹ã€‚**

è¿™ä¸ªç»„ä»¶æ¥å—ä¸¤ä¸ªå±æ€§ã€‚ç¬¬ä¸€ä¸ªæ˜¯è¦æ˜¾ç¤ºçš„å›¾åƒçš„ç›¸å¯¹æˆ–ç»å¯¹ URL(`src`)ï¼Œç¬¬äºŒä¸ªæ˜¯é€šçŸ¥ç»„ä»¶ä½•æ—¶åº”è¯¥æ˜¾ç¤ºçš„æ ‡å¿—(`visible`)ã€‚

æ‚¨å°†æ„è¯†åˆ°æ¯ä¸ªç»„ä»¶ä»ä¸€ä¸ªç‹¬ç«‹çš„`.pcss`æ–‡ä»¶ä¸­å¯¼å…¥å®ƒçš„æ ·å¼ï¼Œè¯¥æ–‡ä»¶åŒ…å« PostCSS ä»£ç ã€‚å¤šäºäº† *postcss-loader* å’Œ*style-loader*webpacks loadersï¼Œè¿™æ‰æˆä¸ºå¯èƒ½ã€‚

å°±è¿™æ ·ğŸ™‚å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹ä¸‹ä¸€ä¸ªç»„ä»¶ã€‚

## ğŸ“¦`<progress>`ç»„ä»¶

è¿™ä¸ªç»„ä»¶å¾ˆå°ï¼Œä½†æ˜¯å¾ˆæœ‰è¶£ã€‚è¿™ä¸ªæ¨¡å—çš„èŒè´£æ˜¯ä¸ºæ¯ä¸ªå›¾åƒæä¾›ä¸€ä¸ªåŠ¨ç”»ã€‚åŠ¨ç”»åªæ˜¯ä¸€ä¸ªè¿›åº¦æ¡ï¼Œç”¨çš„æ˜¯**ç½‘ç»œåŠ¨ç”» API** ï¼

```
import {
  LitElement,
  html,
  property,
  customElement
} from 'lit-element'
import styles from './index.pcss'
/* Array.from polyfill. The provided by Typescript
 * does not work properly on IE11.
 */
import 'core-js/modules/es6.array.from'

@customElement('wc-stories-progress')
class Progress extends LitElement {

  /**
   * @description count of images
   */
  @property({ type: Number }) segments = 0

  /**
   * @description current image index to show
   */
  @property({ type: Number, attribute: 'current' }) currentIndex = 0

  /**
   * @description progress' animation duration
   */
  @property({ type: Number }) duration = 0

  /**
   * @description object that
   * contains the handler for onanimationend event.
   */
  @property({ type: Object }) handler: any = {}

  /**
   * Current animation
   */
  private animation: Animation

  render() {
    const images = Array.from({ length: 5}, (_, i) => i)

    return html` ${
        images.map(i => (
          html`
            <section
              class="progress__bar"
              style="width: calc(100% / ${this.segments || 1})"
            >
              <div id="track-${i}" class="bar__track">
              </div>
            </section>
          `
        ))
      } <style> ${styles.toString()} </style>
    `
  }

  /**
   * Called every time this component is updated.
   * An update for this component means that a
   * 'previous' or 'next' was clicked. Because of
   * it, we need to cancel the previous animation
   * in order to run the new one.
   */
  updated() {
    if (this.animation) { this.animation.cancel() }

    const i = this.currentIndex
    const track = this.shadowRoot.querySelector(`#track-${i}`)

    if (track) {
      const animProps: PropertyIndexedKeyframes = {
        width: ['0%', '100%']
      }
      const animOptions: KeyframeAnimationOptions = {
        duration: this.duration
      }
      this.animation = track.animate(animProps, animOptions)
      this.animation.onfinish = this.handler.onAnimationEnd || function () {}
    }
  }
}

export { Progress } 
```

Enter fullscreen mode Exit fullscreen mode

è¯¥ç»„ä»¶å…·æœ‰ä»¥ä¸‹å±æ€§:

*   `duration`:åŠ¨ç”»çš„æŒç»­æ—¶é—´ã€‚
*   `segments`:å›¾åƒçš„è®¡æ•°ã€‚
*   `current`:è¦æ˜¾ç¤ºçš„å½“å‰å›¾åƒ(ç´¢å¼•)ã€‚
*   `handler`:åŒ…å«`onanimationend`äº‹ä»¶å¤„ç†ç¨‹åºçš„å¯¹è±¡ã€‚

*å¤„ç†ç¨‹åº*å±æ€§æ˜¯ä¸€ä¸ªæ–‡å­—å¯¹è±¡ï¼ŒåŒ…å«ä¸€ä¸ªåä¸º`onAnimationEnd`çš„å‡½æ•°(æ‚¨å°†åœ¨æœ€åä¸€ä¸ªç»„ä»¶ä¸­çœ‹åˆ°å®ƒ)ã€‚æ¯æ¬¡å½“å‰åŠ¨ç”»ç»“æŸæ—¶ï¼Œè¯¥å‡½æ•°åœ¨çˆ¶ç»„ä»¶ä¸Šæ‰§è¡Œï¼Œæ›´æ–°å½“å‰ç´¢å¼•å¹¶æ˜¾ç¤ºä¸‹ä¸€ä¸ªå›¾åƒã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å°†å½“å‰åŠ¨ç”»å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œä»¥ä¾¿âŒåœ¨éœ€è¦åˆ¶ä½œä¸‹ä¸€æ¡åŠ¨ç”»æ—¶å–æ¶ˆå½“å‰åŠ¨ç”»ã€‚å¦åˆ™æ¯ä¸€ä¸ªåŠ¨ç”»éƒ½ä¼šä¸€ç›´å¯è§ã€‚

## ğŸ“¦`<stories>`ç»„ä»¶

è¿™æ˜¯æˆ‘ä»¬çš„æœ€åä¸€ä¸ªç»„ä»¶ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†å›¾åƒæµï¼Œä»¥ç¡®å®šå¿…é¡»æ˜¾ç¤ºå“ªä¸ªå›¾åƒã€‚

```
import {
  LitElement,
  customElement,
  property,
  html
} from 'lit-element'
import styles from './index.pcss'
import { Story } from '../story'
import '../progress'

@customElement('wc-stories')
class WCStories extends LitElement {

  /**
   * @description
   * Total time in view of each image
   */
  @property({ type: Number }) duration = 5000

  /**
   * @description
   * Array of images to show. This must be URLs.
   */
  @property({ type: Array }) images: string[] = []

  /**
   * @NoImplemented
   * @description
   * Effect of transition.
   * @version 0.0.1 Only support for fade effect.
   */
  @property({ type: String }) effect = 'fade'

  /**
   * @description
   * Initial index of image to show at start
   */
  @property({ type: Number }) startAt = 0

  /**
   * @description
   * Enables or disables the shadow of the container
   */
  @property({ type: Boolean }) withShadow = false

  @property({ type: Number }) height = 480

  @property({ type: Number }) width = 320

  /**
   * Handles the animationend event of the
   * <progress> animation variable.
   */
  private handler = {
    onAnimationEnd: () => {
      this.startAt = 
        this.startAt < this.children.length - 1
        ? this.startAt + 1
        : 0
      this.renderNewImage()
    }
  }

  /**
   * When tap on left part of the card,
   * it shows the previous story if any
   */
  goPrevious = () => {
    this.startAt = 
      this.startAt > 0
      ? this.startAt - 1
      : 0
    this.renderNewImage()
  }

  /**
   * When tap on right part of the card,
   * it shows the next story if any, else
   * shows the first one.
   */
  goNext = () => {
    this.startAt = 
      this.startAt < this.children.length - 1
      ? this.startAt + 1
      : 0
    this.renderNewImage()
  }

  render() {
    return html`
      <wc-stories-progress
        segments="${this.images.length}"
        duration="${this.duration}"
        current="${this.startAt}"
        .handler="${this.handler}"
      >
      </wc-stories-progress>
      <section class="touch-panel">
        <div @click="${this.goPrevious}"></div>
        <div @click="${this.goNext}"></div>
      </section>
      <!-- Children -->
      <slot></slot>
      <style> ${styles.toString()} :host {
          box-shadow: ${
            this.withShadow
            ? '0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);'
            : 'none;'
          } height: ${this.height}px;
          width: ${this.width}px;
        }
      </style>
    `
  }

  firstUpdated() {
    this.renderNewImage()
  }

  /**
   * Iterate over children stories to know
   * which story we need to render.
   */
  renderNewImage() {
    Array.from(this.children).forEach((story: Story, i) => {
      if (story instanceof Story) {
        story.visible = this.startAt === i
      }
    })
  }
}

export { WCStories } 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬çš„ä¸»è¦ç»„ä»¶é€šè¿‡ä¸€äº›å±æ€§æ¥å—åˆå§‹é…ç½®:

*   `duration`:å›¾åƒå¯è§çš„æ—¶é—´ã€‚
*   `startAt`:å¯åŠ¨æ—¶æ˜¾ç¤ºçš„å›¾åƒã€‚
*   `height`:ä¸è¨€è‡ªæ˜ã€‚
*   `width`:ä¸è¨€è‡ªæ˜ã€‚
*   `withShadow`:å¯ç”¨æˆ–ç¦ç”¨æŠ•å½±ã€‚

æ­¤å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€äº›æ§åˆ¶è¿‡æ¸¡æµçš„æ–¹æ³•:

*   `goPrevious`:æ˜¾ç¤ºä¸Šä¸€å¼ å›¾ç‰‡ã€‚
*   `goNext`:æ˜¾ç¤ºä¸‹ä¸€å¹…å›¾åƒã€‚
*   `renderNewImage`:éå† stories ç»„ä»¶ï¼Œé€šè¿‡ç´¢å¼•å’Œ`startAt`å±æ€§ä¹‹é—´çš„æ¯”è¾ƒï¼Œå†³å®šå¿…é¡»æ˜¾ç¤ºå“ªä¸ªå›¾åƒã€‚

æ‰€æœ‰çš„æ•…äº‹éƒ½æ˜¯è¿™ä¸ªç»„ä»¶çš„å­ç»„ä»¶ï¼Œæ”¾åœ¨ä¸€ä¸ªæ§½ä¸­:

```
<!-- Children -->
<slot></slot> 
```

Enter fullscreen mode Exit fullscreen mode

å½“å½±å­ DOM è¢«æ„å»ºæ—¶ï¼Œæ‰€æœ‰çš„å­å¯¹è±¡éƒ½å°†è¢«æ’å…¥åˆ°æ’æ§½ä¸­ã€‚

## ğŸš€è¯¥è·‘äº†ï¼

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„`demo/`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª`index.html`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:

```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <!-- Open Sans font -->
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="preload" as="font">
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">
  <!-- CSS reset -->
  <link href="https://necolas.github.io/normalize.css/8.0.1/normalize.css" rel="stylesheet">
  <!-- polyfills -->
  <script src="https://unpkg.com/web-animations-js@2.3.1/web-animations.min.js"></script>
  <script src="https://unpkg.com/@webcomponents/webcomponentsjs@2.2.7/custom-elements-es5-adapter.js"></script>
  <script src="https://unpkg.com/@webcomponents/webcomponentsjs@2.2.7/webcomponents-loader.js"></script>
  <!-- our script -->
  <script defer src="index.js"></script>
  WC Stories
  <style>
  .container {
    display: flex;
    justify-content: center;
    padding: 50px;
  }
  </style>
</head>
<body>
  <main class="container">
    <wc-stories height="480" width="320" withShadow>
      <wc-stories-story src="img/01.jpg"></wc-stories-story>
      <wc-stories-story src="img/02.jpg"></wc-stories-story>
      <wc-stories-story src="img/03.jpg"></wc-stories-story>
      <wc-stories-story src="img/04.jpg"></wc-stories-story>
      <wc-stories-story src="img/05.jpg"></wc-stories-story>
    </wc-stories>
  </main>
</body>
</html> 
```

Enter fullscreen mode Exit fullscreen mode

æŒ‰ä½è¿™ä¸ªä½ç½®ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º`img/`çš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢ç²˜è´´ä¸€äº›å›¾ç‰‡ã€‚è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦å°†æ¯ä¸ªå›¾åƒæ˜ å°„ä¸ºä¸€ä¸ª`<wc-stories-story>`ç»„ä»¶ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘æœ‰ 5 ä¸ªå›¾åƒï¼Œåˆ†åˆ«å«åš 01.jpg çš„*ã€*ã€02.jpg çš„*ç­‰ç­‰ã€‚*

ä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨æˆ‘ä»¬çš„å¼€å‘æœåŠ¡å™¨äº†ã€‚è¿è¡Œ`yarn start`å‘½ä»¤ï¼Œè¿›å…¥ *localhost:4444* ã€‚ä½ ä¼šçœ‹åˆ°åƒè¿™æ ·çš„ä¸œè¥¿ã€‚

## âœˆï¸å¥–é‡‘:æƒå¨è¯æ˜

web ç»„ä»¶çš„ä¸»è¦ç›®æ ‡æ˜¯**åˆ›å»ºå¯é‡ç”¨çš„ UI å—ï¼Œå®ƒå¯ä»¥åœ¨ä»»ä½•åŸºäº Web çš„å¹³å°ä¸Šå·¥ä½œ**ï¼Œè¿™å½“ç„¶**åŒ…æ‹¬å‰ç«¯æ¡†æ¶**ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªç»„ä»¶æ˜¯å¦‚ä½•åœ¨ä¸»æµæ¡†æ¶ä¸Šå·¥ä½œçš„:Reactã€Angular å’Œ vueã€‚

### åšå‡ºååº”

[https://stackblitz.com/edit/react-wcstories?embed=1&view=preview&](https://stackblitz.com/edit/react-wcstories?embed=1&view=preview&)

### è§†å›¾

[https://stackblitz.com/edit/vue-wcstories?embed=1&view=preview&](https://stackblitz.com/edit/vue-wcstories?embed=1&view=preview&)

### æ£±è§’åˆ†æ˜

[https://stackblitz.com/edit/angular-wcstories?embed=1&view=preview&](https://stackblitz.com/edit/angular-wcstories?embed=1&view=preview&)

é…·ï¼æ˜¯ä½œå“ï¼ğŸ˜ƒ ğŸ‰

* * *

## ğŸ¤”ç»“è®º

å»ºè®®:**å­¦ä¹ ã€é‡‡çº³ã€ä½¿ç”¨ã€ç¼–å†™** Web ç»„ä»¶ã€‚ä½ å¯ä»¥æŠŠå®ƒå’Œæ™®é€šçš„ JS æˆ–è€…æ¡†æ¶ä¸€èµ·ä½¿ç”¨ã€‚**æ˜¯æœ¬åœ°çš„å’Œæ ‡å‡†åŒ–çš„**ï¼Œå®¹æ˜“ç†è§£å’Œä¹¦å†™å—ğŸ¤“ï¼Œå¼ºå¤§ğŸ’ªå¹¶æœ‰å‡ºè‰²è¡¨ç°çš„âš¡.