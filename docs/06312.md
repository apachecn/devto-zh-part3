# å…·æœ‰è°·æ­Œäº‘åŠŸèƒ½çš„æ— æœåŠ¡å™¨ Python å¿«é€Ÿå…¥é—¨

> åŸæ–‡:[https://dev . to/Google cloud/server less-python-quick start-with-Google-cloud-functions-19bb](https://dev.to/googlecloud/serverless-python-quickstart-with-google-cloud-functions-19bb)

è¿™é‡Œæœ‰ä¸€ä¸ªæ–°çš„è¿è¡Œæ—¶:Google Cloud å›¢é˜Ÿé€šè¿‡å‘å¸ƒé™¤ç°æœ‰ Node.js è¿è¡Œæ—¶ä¹‹å¤–çš„ Python 3.7 è¿è¡Œæ—¶ï¼Œå°† Python çš„ä¸€åˆ‡éƒ½å¸¦åˆ°äº† Google Cloud å‡½æ•°ä¸­ã€‚

äº‘å‡½æ•°éå¸¸é€‚åˆç¼–å†™è½»é‡çº§ã€è‡ªåŒ…å«çš„å¾®åº”ç”¨ç¨‹åºï¼Œè¿™äº›å¾®åº”ç”¨ç¨‹åºå¯ä»¥å•ç‹¬æ‰©å±•(å¹¶ä¸”æ˜¯éƒ¨ç½²å®Œæ•´ webapp æˆæœ¬çš„ä¸€å°éƒ¨åˆ†)ã€‚å®ƒä»¬ä¹Ÿå¯ä»¥ç”¨ä½œâ€œè§¦å‘å™¨â€:ä¾‹å¦‚ï¼Œä¸€æ—¦ä¸Šä¼ åˆ°è°·æ­Œäº‘å­˜å‚¨æ¡¶ï¼Œå°±è‡ªåŠ¨å°†å›¾åƒè°ƒæ•´ä¸ºæ›´å°çš„ç¼©ç•¥å›¾ã€‚

ç°åœ¨æ‚¨å¯ä»¥ç”¨ Python ç¼–å†™äº‘å‡½æ•°äº†ï¼Œæ‚¨å¯ä»¥ä»»æ„ä½¿ç”¨ Python è¯­è¨€çš„å…¨éƒ¨åŠŸèƒ½(ä»¥åŠæ¥è‡ª PyPI çš„ä»»ä½•åŒ…)ã€‚

# [](#initial-setup)åˆå§‹è®¾ç½®

äº‘å‡½æ•°æœ‰ä¸€ä¸ªç®€å•çš„ç›®å½•ç»“æ„:

```
.
â”œâ”€â”€ main.py
â””â”€â”€ requirements.txt 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨`main.py`ä¸­ï¼Œæˆ‘ä»¬å°†å®šä¹‰æˆ‘ä»¬çš„å‡½æ•°ã€‚åœ¨`requirements.txt`ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ æˆ‘ä»¬å¯èƒ½éœ€è¦ä» PyPI å®‰è£…çš„ä»»ä½•éœ€æ±‚(æˆ–è€…å¦‚æœæ²¡æœ‰ä»»ä½•éœ€æ±‚ï¼Œå°±å°†å…¶ç•™ç©º)ã€‚

# [](#writing-our-function)ç¼–å†™æˆ‘ä»¬çš„å‡½æ•°

é¦–å…ˆï¼Œè®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„`main.py`æ–‡ä»¶ä¸­å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå®ƒåªè¯´ hello:

```
def hello(request):
    return "Hello World!" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#running-locally)æœ¬åœ°è¿è¡Œ

ä¸ºäº†å¿«é€Ÿæµ‹è¯•æˆ‘ä»¬çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨éƒ¨ç½²ä¹‹å‰åœ¨æœ¬åœ°è¿è¡Œå®ƒã€‚

æ‚¨éœ€è¦å®‰è£… Python æ¥å®Œæˆè¿™ä¸€éƒ¨åˆ†ã€‚å¦‚æœæ‚¨è¿˜ä¸çŸ¥é“ï¼Œè¯·å‚è§[â€œè®¾ç½® Python å¼€å‘ç¯å¢ƒâ€](https://cloud.google.com/python/setup)ã€‚

ä¸€æ—¦æ‚¨åœ¨æœ¬åœ°è·å¾—äº† Python ç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸‹é¢çš„ä»£ç æ·»åŠ åˆ°æˆ‘ä»¬çš„`main.py`æ–‡ä»¶çš„æœ«å°¾:

```
if __name__ == '__main__':
    from flask import Flask, request
    app = Flask(__name__)
    app.route('/')(lambda: hello(request))
    app.run() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œæ¿€æ´»å®ƒï¼Œå¹¶å®‰è£… Flask:

```
$ python -m venv env
$ source env/bin/activate
(env) $ pip install flask
Collecting flask
  ...
Successfully installed Jinja2-2.10 MarkupSafe-1.0 Werkzeug-0.14.1 click-6.7
flask-1.0.2 itsdangerous-0.24 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿è¡Œå¦‚ä¸‹:

```
$ python main.py 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

...å¹¶è®¿é—® [http://localhost:5000](http://localhost:5000) åœ¨æœ¬åœ°æŸ¥çœ‹æ‚¨çš„ç«¯ç‚¹ã€‚

# [](#deploying-our-function)éƒ¨ç½²æˆ‘ä»¬çš„åŠŸèƒ½

æˆ‘ä»¬çš„åŠŸèƒ½åªæœ‰éƒ¨ç½²äº†æ‰æœ‰ç”¨ï¼åœ¨éƒ¨ç½²æˆ‘ä»¬çš„åŠŸèƒ½ä¹‹å‰ï¼Œæ‚¨éœ€è¦[å®‰è£…å¹¶åˆå§‹åŒ–`gcloud`å‘½ä»¤è¡Œå·¥å…·](https://cloud.google.com/sdk/docs/)ã€‚

ä¸€æ—¦å®‰è£…äº†`gcloud` SDKï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸€è¡Œä»£ç æ¥éƒ¨ç½²æˆ‘ä»¬çš„åŠŸèƒ½:

```
$ gcloud beta functions deploy hello --trigger-http --runtime python37 --project YOUR_PROJECT_NAME 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

éƒ¨ç½²åï¼Œè¯¥å‘½ä»¤å°†ä¸ºæ‚¨æä¾›ä¸€ä¸ªåˆ°å®æ—¶åŠŸèƒ½çš„é“¾æ¥ã€‚

# [](#passing-in-variables)ä¼ å…¥å˜é‡

ä½ å¯èƒ½æƒ³è¦ä¼ é€’ä¸€äº›æ•°æ®åˆ°ä½ çš„å‡½æ•°ä¸­ã€‚ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡ URL å‚æ•°ï¼Œæ¯”å¦‚`http://foo.bar/hello?name=Dustin`ã€‚è®©æˆ‘ä»¬åœ¨ä¾‹å­ä¸­é€‰æ‹©ä¸€ä¸ªåä¸º`name`çš„å‚æ•°ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥ä»£æ›¿â€œä¸–ç•Œâ€:

```
def hello(request):
    name = request.args.get('name', 'World')
    return f"Hello {name}!" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åå½“æˆ‘ä»¬é‡æ–°éƒ¨ç½²æˆ‘ä»¬çš„å‡½æ•°ï¼Œå¹¶è®¿é—®`https://YOUR_PROJECT_NAME.cloudfunctions.net/hello?name=dev.to`ï¼Œå®ƒä¼šè¯´:

> ä½ å¥½ï¼Œæˆ´å¤«Â·æ‰˜ï¼

# [](#adding-dependencies)æ·»åŠ ä¾èµ–å…³ç³»

äº‘å‡½æ•°çš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œæ‚¨å¯ä»¥ä» PyPI å®‰è£…æ‚¨é€šå¸¸ä¼šåœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨çš„ç›¸åŒçš„ä¾èµ–é¡¹ã€‚

è®©æˆ‘ä»¬åœ¨ [`emoji`](https://pypi.org/project/emoji/) åŒ…ä¸­æ·»åŠ ä¸€ä¸ªä¾èµ–é¡¹ï¼Œè¿™æ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ¶ˆæ¯çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªå¯é€‰çš„è¡¨æƒ…ç¬¦å·ã€‚

æˆ‘ä»¬å°†æŠŠåŒ…çš„åç§°å’Œç‰ˆæœ¬æ·»åŠ åˆ°æˆ‘ä»¬çš„`requirements.txt`æ–‡ä»¶:

```
emoji==0.5.1 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†åœ¨æˆ‘ä»¬é‡æ–°éƒ¨ç½²è¯¥åŠŸèƒ½æ—¶è‡ªåŠ¨å®‰è£…ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨æˆ‘ä»¬çš„å‡½æ•°ä¸­å¯¼å…¥å¹¶ä½¿ç”¨è¿™ä¸ªåº“:

```
import emoji

def hello(request):
    name = request.args.get('name', 'World')
    reaction = emoji.emojize(request.args.get('reaction', '!'))
    return f"Hello {name}  {reaction}" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åæˆ‘ä»¬å¯ä»¥è®¿é—®`https://YOUR_PROJECT_NAME.cloudfunctions.net/hello?name=dev.to&reaction=:wave:`ï¼Œå®ƒä¼šè¯´:

> ä½ å¥½ï¼Œæˆ´å¤«Â·æ‰˜ğŸ‘‹

# [](#next-steps)ä¸‹ä¸€æ­¥

ä½ å¯ä»¥ç”¨äº‘å‡½æ•°åšæ›´å¤šçš„äº‹æƒ…ï¼ç‚¹å‡»ä»¥ä¸‹é“¾æ¥ï¼Œäº†è§£å¦‚ä½•:

*   [ç¼–å†™å“åº”äº‹ä»¶](https://cloud.google.com/functions/docs/writing/background)çš„â€œåå°â€è§¦å‘å‡½æ•°
*   [ä½¿ç”¨ Stackdriver ç›‘æ§é«˜çº§åŠŸèƒ½](https://cloud.google.com/functions/docs/monitoring/)
*   [å‚è§é™„åŠ æç¤º&ç¼–å†™äº‘å‡½æ•°çš„æŠ€å·§](https://cloud.google.com/functions/docs/bestpractices/tips)

*æ‰€æœ‰ä»£ç è°·æ­Œ w/ Apache 2 è®¸å¯è¯*