# å®ç”¨çš„ React é’©å­:å¦‚ä½•é‡æ„ä½ çš„åº”ç”¨ç¨‹åºæ¥ä½¿ç”¨é’©å­

> åŸæ–‡:[https://dev . to/bnevilleoneill/practical-react-hooks-how-to-refactor-your-app-to-use-hooks-1mj 4](https://dev.to/bnevilleoneill/practical-react-hooks-how-to-refactor-your-app-to-use-hooks-1mj4)

[![](../Images/228bdf6967a95add3f637a032819da7c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--nXu0oDnM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2A-re5tZymal4yNn9J0O0K7w.png)

ç›¸å½“å¤šçš„äººå¯¹å¢åŠ é’©å­æ¥ä½œå‡ºååº”æ„Ÿåˆ°å…´å¥‹â€”â€”æˆ‘æ°å¥½æ˜¯è¿™äº›äººä¸­çš„ä¸€å‘˜ï¼

ä¸€æ—¦ä½ é€šè¿‡äº†å…³äºå¦‚ä½•å¼€å§‹ä½¿ç”¨é’©å­çš„æ•™ç¨‹,ä½ çš„ä¸‹ä¸€ä¸ªé—®é¢˜å°±å˜å¾—æ˜¾è€Œæ˜“è§äº†:ä½ å¦‚ä½•é‡æ„ä½ ç°æœ‰çš„åº”ç”¨ç¨‹åºæˆ–è€…ç»„ä»¶æ¥ä½¿ç”¨é’©å­ï¼Ÿä½ å¯èƒ½ä¼šé¢ä¸´å“ªäº›æŒ‘æˆ˜ï¼Ÿ

### [](#introduction)ç®€ä»‹

è¿™ç¯‡æ–‡ç« çš„ç›®æ ‡å¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒçš„æ–¹æ³•å¯èƒ½æ˜¯ç‹¬ç‰¹çš„ã€‚å¯¹äºè¿™ä¸ªä¸»é¢˜ï¼Œå¤§å¤šæ•°ä½œè€…å¯èƒ½ä¼šä½¿ç”¨ç°æœ‰çš„åº”ç”¨ç¨‹åºï¼Œå¹¶å‘æ‚¨å±•ç¤ºé‡æ„å®ƒä»¥ä½¿ç”¨é’©å­çš„æ­¥éª¤ã€‚è¿™å¾ˆå¥½ï¼Œä½†è¿œéå®Œç¾ã€‚

ä¸ºä»€ä¹ˆï¼Ÿæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æ˜¯ä¸åŒçš„ï¼Œéƒ½æœ‰è‡ªå·±ç‰¹å®šçš„ä½¿ç”¨æ¡ˆä¾‹å’Œåœºæ™¯ã€‚

æˆ‘ä¸ä¼šå‘æ‚¨å±•ç¤ºå¦‚ä½•é‡æ„å•ä¸ªåº”ç”¨ç¨‹åºæ¥ä½¿ç”¨ React Hooksï¼Œè€Œæ˜¯å‘æ‚¨ä»‹ç»ä¸€äº›é€‚ç”¨äºå„ç§åº”ç”¨ç¨‹åºç±»å‹çš„ä¸€èˆ¬æ€§æŒ‘æˆ˜ã€‚åˆ«æ‹…å¿ƒï¼Œæˆ‘å°†ä»åŸºæœ¬çš„å…³æ³¨ç‚¹å¼€å§‹ï¼Œç„¶åè½¬åˆ°æ›´é«˜çº§çš„ç”¨ä¾‹ã€‚

### [](#why-refactor-to-use-react-hooks)ä¸ºä»€ä¹ˆé‡æ„è¦ç”¨ React é’©å­ï¼Ÿ

æˆ‘ä¸æ‰“ç®—è§£é‡Šä¸ºä»€ä¹ˆä½ åº”è¯¥è€ƒè™‘é‡æ„ä½ çš„ç»„ä»¶æ¥ä½¿ç”¨é’©å­ã€‚å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€äº›åƒæ ·çš„è®ºæ®ï¼Œå®˜æ–¹æ–‡ä»¶æœ‰ä¸€äº›ã€‚

### [](#prerequisites)å…ˆå†³æ¡ä»¶

æœ¬æ–‡å‡è®¾æ‚¨å¯¹ React Hooks çš„å·¥ä½œåŸç†æœ‰æ‰€äº†è§£ã€‚å¦‚æœä½ éœ€è¦é’©å­å¦‚ä½•å·¥ä½œçš„æç¤ºï¼Œçœ‹çœ‹è¿™ä¸ªæœ‰ç”¨çš„ä»‹ç»ã€‚

ä¸€æ—¦æˆ‘ä»¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨å°±å¯ä»¥å¼€å§‹åº”å¯¹æ‚¨åœ¨ä½¿ç”¨ React é’©å­é‡æ„åº”ç”¨ç¨‹åºæ—¶æ‰€é¢ä¸´çš„æŒ‘æˆ˜(å’Œè§£å†³æ–¹æ¡ˆ)ã€‚

[![](../Images/18c623c22aecb029a54b76acf9d59712.png)T2ã€‘](https://logrocket.com/signup/)

### [](#the-first-problem-everyone-faces-how-to-convert-a-class-component-to-a-function-component)å¤§å®¶é¢ä¸´çš„ç¬¬ä¸€ä¸ªé—®é¢˜:å¦‚ä½•å°†ç±»ç»„ä»¶è½¬æ¢æˆå‡½æ•°ç»„ä»¶

å½“æ‚¨å¼€å§‹ä½¿ç”¨ React é’©å­é‡æ„åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨å°†é¢ä¸´çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ°å¥½æ˜¯å…¶ä»–æŒ‘æˆ˜çš„æ ¹æºã€‚

æŒ‘æˆ˜å¾ˆç®€å•:å¦‚ä½•åœ¨ä¸ç ´åä»»ä½•åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œå°†ç±»ç»„ä»¶é‡æ„ä¸ºåŠŸèƒ½ç»„ä»¶ï¼Ÿ

å¥½å§ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä½ ä¼šé‡åˆ°çš„ä¸€äº›æœ€å¸¸è§çš„æƒ…å†µï¼Œä»æœ€ç®€å•çš„å¼€å§‹ã€‚

#### [](#1-class-component-without-state-or-lifecycle-methods)1ã€‚æ²¡æœ‰çŠ¶æ€æˆ–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„ç±»ç»„ä»¶

[![](../Images/f4072b7a67df4a43bd2434307f45353a.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ocV21Vz---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2AJQoBxHguCpt6JIrzC3O-Bg.gif)

<figcaption>3 ç§’é‡æ„ç±»ç»„ä»¶â€”â€”ç­‰å¾…åŠ¨ç”»ğŸ˜Š</figcaption>

**N.B.** ï¼Œè¿™å¼  GIF å¯¹äºæ›´é«˜çº§çš„è¯»è€…æ¥è¯´å¯èƒ½è¶³ä»¥çœ‹å‡ºè¿™ç§ä»ç±»åˆ°å‡½æ•°ç»„ä»¶çš„é‡æ„çš„ä¸åŒä¹‹å¤„ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œä¹Ÿä¸ºäº†å…¶ä»–éœ€è¦æ›´å¤šä¸Šä¸‹æ–‡çš„äººï¼Œæˆ‘å°†è§£é‡Šå¹¶å†™å‡ºä»£ç ã€‚

è¿™æ˜¯æœ€åŸºæœ¬çš„æƒ…å†µ:ä¸€ä¸ªéå¸¸æ„šè ¢çš„ç±»ç»„ä»¶ã€‚å®ƒåªæ˜¯æ¸²æŸ“ä¸€äº› JSXã€‚

```
// before
import React, {Component} from 'react';

class App extends Component {
  handleClick = () => {
    console.log("helloooooo")
  }

  render() {
    return <div> 
      Hello World 
      <button onClick={this.handleClick}>
        Click me! 
      </button>
    </div>  
  }
}

export default App 
```

é‡æ„è¿™ä¸ªç»„ä»¶éå¸¸ç®€å•ã€‚ç»™ä½ :

```
// after 
import React from 'react'

function App() {
  const handleClick = () => {
    console.log("helloooooo")
  }

  return <div> 
      Hello World 
      <button onClick={handleClick}> Click me! </button>
    </div>  
}

export default App 
```

è¿™é‡Œæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

*   æ²¡æœ‰`class`å…³é”®å­—ï¼›æ›¿æ¢ä¸º JavaScript å‡½æ•°
*   åŠŸèƒ½ç»„ä»¶ä¸­æ²¡æœ‰`this`ï¼›æ›¿æ¢ä¸ºå‡½æ•°èŒƒå›´å†…çš„ JavaScript å€¼

å°±è¿™äº›â€”â€”æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ã€‚æˆ‘ä»¬ç»§ç»­å§ã€‚

#### [](#2-class-component-with-props-some-default-prop-values-and-proptype-declarations)2ã€‚å…·æœ‰å±æ€§ã€ä¸€äº›é»˜è®¤å±æ€§å€¼å’Œå±æ€§ç±»å‹å£°æ˜çš„ç±»ç»„ä»¶

[![Refactoring the class component in 3 secs ğŸ’ª](../Images/5ab3a017df747c83c5372cd8a026c5e2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--2f3J4YXD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2AyPtj5MVeJfmn5n89kMunaA.gif)

<figcaption>3 ç§’é‡æ„ç±»ç»„ä»¶ã€‚</figcaption>

è¿™æ˜¯å¦ä¸€ä¸ªæ²¡æœ‰å¤ªå¤šå¼€é”€çš„ç®€å•ä¾‹å­ã€‚è€ƒè™‘ä¸‹é¢çš„ç±»ç»„ä»¶:

```
// before
class App extends Component {
  static propTypes = {
    name: PropTypes.string
  }
  static defaultProps = {
    name: "Hooks"
  }

  handleClick = () => {
    console.log("helloooooo")
  }

  render() {
    return <div> 
      Hello {this.props.name} 
      <button onClick={this.handleClick}> Click me! </button>
    </div>  
  }
} 
```

ç»è¿‡é‡æ„ï¼Œæˆ‘ä»¬å¾—åˆ°äº†è¿™ä¸ª:

```
function App({name = "Hooks"}) {
  const handleClick = () => {
    console.log("helloooooo")
  }

  return <div> 
      Hello {name} 
      <button onClick={handleClick}>Click me! </button>
    </div>
}

App.propTypes = {
  name: PropTypes.number
} 
```

ä½œä¸ºä¸€ä¸ªåŠŸèƒ½ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶çœ‹èµ·æ¥ç®€å•å¤šäº†ã€‚props å˜æˆå‡½æ•°å‚æ•°ï¼Œé»˜è®¤ props é€šè¿‡ ES6 é»˜è®¤å‚æ•°è¯­æ³•å¤„ç†ï¼Œé™æ€ propTypes æ›¿æ¢æˆ App.propTypesï¼Œå°±è¿™æ ·ï¼

#### [](#3-class-component-with-state-single-or-few-multiple-keys)3ã€‚å…·æœ‰çŠ¶æ€çš„ç±»ç»„ä»¶(å•ä¸ªæˆ–å°‘æ•°å¤šä¸ªé”®)

å½“æ‚¨æ‹¥æœ‰ä¸€ä¸ªå¸¦æœ‰å®é™…çŠ¶æ€å¯¹è±¡çš„ç±»ç»„ä»¶æ—¶ï¼Œè¿™ä¸ªåœºæ™¯ä¼šå˜å¾—æ›´åŠ æœ‰è¶£ã€‚ä½ çš„å¾ˆå¤šç±»ç»„ä»¶éƒ½å±äºè¿™ä¸ªç±»åˆ«ï¼Œæˆ–è€…è¿™ä¸ªç±»åˆ«çš„ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ç‰ˆæœ¬ã€‚

è€ƒè™‘ä¸‹é¢çš„ç±»ç»„ä»¶:

```
class App extends Component {
  state = {
    age: 19
  }

  handleClick = () => {
    this.setState((prevState) => ({age: prevState.age + 1}))
  }

  render() {
    return <div> 
      Today I am {this.state.age} Years of Age 
      <div> 
        <button onClick={this.handleClick}>Get older! </button>
      </div>
    </div>
  }
} 
```

è¯¥ç»„ä»¶ä»…è·Ÿè¸ªçŠ¶æ€å¯¹è±¡ä¸­çš„å•ä¸ªå±æ€§ã€‚å¾ˆç®€å•ï¼

[![The magic of useState in 3 secs âœŒï¸](../Images/1b0203021854066d38cb954da7774e0c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--al1SxKWs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2AE7XwHTCp2i9DJuJxWM9R8g.gif)

<figcaption>3 ç§’å†…ä½¿ç”¨çŠ¶æ€çš„é­”æ³•ã€‚</figcaption>

æˆ‘ä»¬å¯ä»¥å¯¹æ­¤è¿›è¡Œé‡æ„ï¼Œä½¿ç”¨ useState é’©å­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
function App() {
  const [age, setAge] = useState(19);
  const handleClick = () => setAge(age + 1)

  return <div> 
      Today I am {age} Years of Age 
      <div> 
        <button onClick={handleClick}>Get older! </button>
      </div>
   </div>
} 
```

é‚£çœ‹èµ·æ¥ç®€å•å¤šäº†ï¼

[![](../Images/864aa4ffdcb12657f6e588a4c8575be3.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--FDPdcQZC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2Av-UwlMqt7iW9BE1jzMYmYw.gif) 

<figcaption>é‡æ„æˆåŠŸäº†ã€‚è€¶ï¼</figcaption>

å¦‚æœè¯¥ç»„ä»¶æœ‰æ›´å¤šçš„çŠ¶æ€å¯¹è±¡å±æ€§ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ª useState è°ƒç”¨ã€‚é‚£å®Œå…¨æ²¡é—®é¢˜ï¼Œå¦‚ä¸‹å›¾:

```
function App() {
  const [age, setAge] = useState(19);
  const [status, setStatus] = useState('married')
  const [siblings, setSiblings] = useState(10)

  const handleClick = () => setAge(age + 1)

  return <div> 
      Today I am {age} Years of Age 
      <div> 
        <button onClick={handleClick}>Get older! </button>
      </div>
   </div>
} 
```

è¿™æ˜¯æœ€åŸºæœ¬çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½ éœ€è¦æ›´å¤šçš„ä¾‹å­ï¼Œä½ å¯ä»¥åœ¨[è¿™æœ¬æœ‰ç”¨çš„æŒ‡å—](https://scotch.io/tutorials/5-ways-to-convert-react-class-components-to-functional-components-w-react-hooks)ä¸­æ‰¾åˆ°ã€‚

### [](#making-tradeoffs-for-incremental-hooks-adoption)ä¸ºå¢é‡æŒ‚é’©çš„é‡‡ç”¨åšå‡ºæƒè¡¡

è™½ç„¶é‡æ–°ç¼–å†™åº”ç”¨ç¨‹åº/ç»„ä»¶æ¥ä½¿ç”¨é’©å­å¬èµ·æ¥å¾ˆæ£’ï¼Œä½†è¿™æ˜¯æœ‰ä»£ä»·çš„â€”â€”é¦–å…ˆæ˜¯æ—¶é—´å’ŒäººåŠ›ã€‚

å¦‚æœæ‚¨ç¢°å·§æ­£åœ¨å¤„ç†ä¸€ä¸ªå¤§å‹ä»£ç åº“ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½éœ€è¦åœ¨ Hooks é‡‡ç”¨çš„æ—©æœŸé˜¶æ®µåšå‡ºä¸€äº›æƒè¡¡ã€‚ä¸‹é¢æè¿°äº†ä¸€ä¸ªè¿™æ ·çš„åœºæ™¯ã€‚

è€ƒè™‘ä»¥ä¸‹ç»„ä»¶:

```
const API_URL = "https://api.myjson.com/bins/19enqe";

class App extends Component {
  state = {
    data: null,
    error: null,
    loaded: false,
    fetching: false,
  }

  async componentDidMount() {
    const response = await fetch(API_URL)
    const { data, status } = {
      data: await response.json(),
      status: response.status
    }

    // error? 
    if (status !== 200) {
      return this.setState({
        data,
        error: true,
        loaded: true,
        fetching: false,
      })
    }

    // no error 
    this.setState({
      data,
      error: null,
      loaded: true,
      fetching: false,
    })
  }

  render() {
    const { error, data } = this.state;

    return error ? <div> Sorry, and error occured :( </div> :
      <pre>{JSON.stringify(data, null, '  ')}</pre>
  }
} 
```

è¯¥ç»„ä»¶åœ¨è£…è½½æ—¶å‘è¿œç¨‹æœåŠ¡å™¨å‘å‡ºè·å–ä¸€äº›æ•°æ®çš„è¯·æ±‚ï¼Œç„¶åæ ¹æ®ç»“æœè®¾ç½®çŠ¶æ€ã€‚

æˆ‘ä¸å¸Œæœ›ä½ æŠŠæ³¨æ„åŠ›æ”¾åœ¨å¼‚æ­¥é€»è¾‘ä¸Šï¼Œæ‰€ä»¥ä½ åº”è¯¥æ³¨æ„çš„æ˜¯:setState è°ƒç”¨ã€‚

```
class App extends Component {
 ... 

  async componentDidMount() {
    ...

    if (status !== 200) {
      return **this.setState** ({
        data,
        error: true,
        loaded: true,
        fetching: false,
      })
    }

**this.setState** ({
      data,
      error: null,
      loaded: true,
      fetching: false,
    })
  }

  render() {
    ...
  }
} 
```

è¿™é‡Œçš„ setState è°ƒç”¨æ¥æ”¶ä¸€ä¸ªå…·æœ‰å››ä¸ªå±æ€§çš„å¯¹è±¡ã€‚è¿™åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä½†è¿™é‡Œçš„ä¸€èˆ¬æƒ…å†µæ˜¯ï¼Œ**ä½ æœ‰ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒç”¨è®¸å¤šå¯¹è±¡å±æ€§**è¿›è¡Œ **setState è°ƒç”¨ã€‚**

ç°åœ¨ï¼Œä½¿ç”¨ React é’©å­ï¼Œæ‚¨å¯èƒ½ä¼šå°†æ¯ä¸ªå¯¹è±¡å€¼æ‹†åˆ†æˆå•ç‹¬çš„ useState è°ƒç”¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å¸¦æœ‰ useState çš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™äº›å±æ€§æ˜¯ä¸ç›¸å…³çš„ï¼Œåœ¨è¿™é‡Œä½¿ç”¨ object å¯èƒ½ä¼šä½¿ä»¥åå°†å®ƒåˆ†è§£æˆç‹¬ç«‹çš„å®šåˆ¶é’©å­æ›´åŠ å›°éš¾ã€‚

ä¸‹é¢æ˜¯é‡æ„çš„æ ·å­:

```
... 
  const [data, setData] = useState(null);
  const [error, setError] = useState(null);
  const [loaded, setLoading] = useState(false);
  const [fetching, setFetching] = useState(false);
... 
```

ç­‰ç­‰â€”â€”è¿˜æ²¡å®Œå‘¢ï¼

this.setState è°ƒç”¨ä¹Ÿå¿…é¡»ä¿®æ”¹æˆè¿™æ ·:

```
// no more this.setState calls - use updater functions. 
 setData(data);
  setError(null);
  setLoading(true);
  fetching(false); 
```

æ˜¯çš„ï¼Œè¿™æ˜¯å¯è¡Œçš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨ç»„ä»¶ä¸­æœ‰è®¸å¤š setState è°ƒç”¨ï¼Œé‚£ä¹ˆæ‚¨å°†å¤šæ¬¡ç¼–å†™è¿™äº›è°ƒç”¨ï¼Œæˆ–è€…å°†å®ƒä»¬åˆ†ç»„åˆ°å¦ä¸€ä¸ªè‡ªå®šä¹‰é’©å­ä¸­ã€‚

ç°åœ¨ï¼Œå¦‚æœæ‚¨å¸Œæœ›åœ¨ä»£ç åº“ä¸­é€æ¸é‡‡ç”¨é’©å­ï¼Œåœ¨ä¿æŒç¨å¾®ç›¸ä¼¼çš„ setState ç­¾åçš„åŒæ—¶å‡å°‘ä»£ç æ›´æ”¹ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿè¿™å¯èƒ½å—ï¼Ÿ

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»åšå‡ºå–èˆã€‚å¦‚æœæ‚¨æ­£åœ¨å¼€å‘åæœŸä»£ç åº“ï¼Œè¿™å¾ˆå®¹æ˜“å‘ç”Ÿï¼åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä»‹ç» useReducer é’©å­ã€‚

useReducer å…·æœ‰ä»¥ä¸‹ç­¾å:

```
const [state, dispatch] = useReducer(reducer) 
```

reducer æ˜¯ä¸€ä¸ªæ¥å—çŠ¶æ€å’ŒåŠ¨ä½œå¹¶è¿”å›æ–°çŠ¶æ€çš„å‡½æ•°ã€‚

```
const [state, dispatch] = useReducer((state, action) => newState) 
```

ç„¶åï¼Œä» reducer è¿”å›çš„æ–°çŠ¶æ€ç”±ç»„ä»¶é€šè¿‡çŠ¶æ€å˜é‡ä½¿ç”¨ã€‚

å¦‚æœæ‚¨ä»¥å‰ä½¿ç”¨è¿‡ reduxï¼Œé‚£ä¹ˆæ‚¨çŸ¥é“æ‚¨çš„åŠ¨ä½œå¿…é¡»æ˜¯å…·æœ‰æŸç§ç±»å‹å±æ€§çš„å¯¹è±¡ã€‚ç„¶è€Œï¼ŒuseReducer çš„æƒ…å†µå¹¶éå¦‚æ­¤ã€‚ç›¸åï¼Œreducer å‡½æ•°æ¥å—çŠ¶æ€å’Œä¸€äº›åŠ¨ä½œï¼Œç„¶å**è¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€å¯¹è±¡**ã€‚

æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œè¿›è¡Œä¸é‚£ä¹ˆç—›è‹¦çš„é‡æ„ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
... 
function AppHooks() {
  ... 
 const [state, setState] = useReducer((state, newState) => (
{...state, ...newState}
  ));

 setState({
    data,
    error: null,
    loaded: true,
    fetching: false,
  })
} 
```

ä¸Šé¢æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ

æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ²¡æœ‰åœ¨ç»„ä»¶çš„ä»»ä½•åœ°æ–¹æ›´æ”¹å¤§é‡çš„ this.setState è°ƒç”¨ï¼Œè€Œæ˜¯é€‰æ‹©äº†ä¸€ç§æ›´ç®€å•çš„å¢é‡æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•ä¸æ¶‰åŠå¤§é‡çš„ä»£ç æ›´æ”¹ã€‚

è€Œä¸æ˜¯ this.setState({dataï¼Œerror: nullï¼Œloaded: nullï¼Œfetching: false})ï¼Œåªæ˜¯åˆ é™¤ thisã€‚ï¼ŒsetState è°ƒç”¨ä»ç„¶å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯æœ‰é’©å­ï¼

è®©è¿™ä¸€åˆ‡æˆä¸ºå¯èƒ½çš„æ˜¯:

```
const [state, setState] = useReducer((state, newState) => (
{ ...state, ...newState }
)); 
```

å½“æ‚¨è¯•å›¾æ›´æ–°çŠ¶æ€æ—¶ï¼Œä¼ é€’ç»™ setState(é€šå¸¸ç§°ä¸º dispatch)çš„ä»»ä½•å†…å®¹éƒ½ä¼šä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ reducerã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºæ–°çŠ¶æ€ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬ä¸ç”¨åšä¸€äº›èŠ±å“¨çš„ switch è¯­å¥(å¦‚ Redux ä¸­)ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ state å¯¹è±¡ï¼Œç”¨ä¼ å…¥çš„æ–°å€¼è¦†ç›–ä»¥å‰çš„çŠ¶æ€â€”â€”ç±»ä¼¼äº setState çš„å·¥ä½œæ–¹å¼ï¼Œå³é€šè¿‡æ›´æ–°çŠ¶æ€å±æ€§è€Œä¸æ˜¯æ›¿æ¢æ•´ä¸ªå¯¹è±¡ã€‚

æœ‰äº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå°±å¯ä»¥æ›´å®¹æ˜“åœ°åœ¨æ‚¨çš„ä»£ç åº“ä¸­é‡‡ç”¨å¢é‡å¼é’©å­â€”â€”ä¸éœ€è¦å¤§é‡çš„ä»£ç æ›´æ”¹ï¼Œå¹¶ä¸”å…·æœ‰ç±»ä¼¼çš„ setState ç­¾åã€‚

ä»¥ä¸‹æ˜¯å®Œæ•´çš„é‡æ„ä»£ç ï¼Œä»£ç æ”¹åŠ¨è¾ƒå°‘:

[![Complete refactor with very little code change ğŸ‘](../Images/46ee277822e346b87d73b19805c7ec79.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--dwVLWVD_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2A9NJD97N2LJWL0WHMsI9ydw.gif) 

<figcaption>å®Œæˆé‡æ„ï¼Œä»£ç æ”¹åŠ¨å¾ˆå°‘ğŸ‘</figcaption>

```
function AppHooks() {
  const initialState = {
    data: null,
    error: null,
    loaded: false,
    fetching: false,
  }
  const reducer = (state, newState) => ({ ...state, ...newState })
  const [state, setState] = useReducer(reducer, initialState);

  async function fetchData() {
    const response = await fetch(API_URL);
    const { data, status } = {
      data: await response.json(),
      status: response.status
    }

    // error? 
    if (status !== 200) {
      return setState({
        data,
        error: true,
        loaded: true,
        fetching: false,
      })
    }

    // no error 
    setState({
      data,
      error: null,
      loaded: true,
      fetching: false,
    })
  }

  useEffect(() => {
    fetchData()
  }, [])

  const { error, data } = state
  return error ?  Sorry, and error occured :(  :
    <pre>{JSON.stringify(data, null, '  ')}</pre>
} 
```

### [](#simplifying-lifecycle-methods)ç®€åŒ–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

æ‚¨å°†é¢ä¸´çš„å¦ä¸€ä¸ªå¸¸è§æŒ‘æˆ˜æ˜¯é‡æ„ç»„ä»¶çš„ componentDidMountã€componentWillUnmount å’Œ componentDidUpdate ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­çš„é€»è¾‘ã€‚

useEffect é’©å­æ˜¯æå–è¿™ä¸ªé€»è¾‘çš„æœ€ä½³åœ°æ–¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒuseEffect ä¸­çš„æ•ˆæœå‡½æ•°å°†åœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œã€‚å¦‚æœä½ ç†Ÿæ‚‰é’©å­ï¼Œè¿™æ˜¯å¸¸è¯†ã€‚

```
import { useEffect } from 'react'
useEffect(() => {
   // your logic goes here
   // optional: return a function for canceling subscriptions 
   return () = {}
}) 
```

é‚£ä¹ˆè¿™é‡Œå¯èƒ½æœ‰ä»€ä¹ˆæ–°ä¸œè¥¿å‘¢ï¼Ÿ

useEffect æŒ‚é’©çš„ä¸€ä¸ªæœ‰è¶£ç‰¹æ€§æ˜¯å¯ä»¥ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°:ä¾èµ–æ•°ç»„ã€‚

è€ƒè™‘ä¸€ä¸ªç©ºçš„ä¾èµ–æ•°ç»„çš„ä¾‹å­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
import { useEffect } from 'react'
useEffect(() => {

}, []) // ğŸ‘ˆ array argument 
```

åœ¨è¿™é‡Œä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„å°†ä½¿ effect å‡½æ•°ä»…åœ¨ç»„ä»¶æŒ‚è½½æ—¶è¿è¡Œï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…é™¤ã€‚è¿™éå¸¸é€‚åˆäºåœ¨ç»„ä»¶æŒ‚è½½æ—¶å¸Œæœ›è·Ÿè¸ªæˆ–è·å–ä¸€äº›æ•°æ®çš„æƒ…å†µã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå‘ä¾èµ–æ•°ç»„ä¼ é€’å€¼çš„ä¾‹å­:

```
import { useEffect } from 'react'
useEffect(() => {

}, [name]) // ğŸ‘ˆ array argument with a value 
```

è¿™é‡Œçš„å«ä¹‰æ˜¯ï¼Œå½“ç»„ä»¶æŒ‚è½½æ—¶ï¼Œæ•ˆæœå‡½æ•°å°†è¢«è°ƒç”¨ï¼ŒåŒæ ·ï¼Œæ¯å½“ name å˜é‡çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ•ˆæœå‡½æ•°ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚

### [](#comparing-useeffect-object-values)æ¯”è¾ƒ useEffect å¯¹è±¡å€¼

useEffect æŒ‚é’©æ¥å—ä¸€ä¸ªå‡½æ•°å‚æ•°ï¼Œè¯¥å‚æ•°å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›å‰¯ä½œç”¨ã€‚

```
useEffects(doSomething) 
```

ç„¶è€Œï¼ŒuseEffect é’©å­è¿˜æ¥å—ç¬¬äºŒä¸ªå‚æ•°:å‡½æ•°ä¸­çš„æ•ˆæœæ‰€ä¾èµ–çš„å€¼çš„æ•°ç»„ã€‚ä¾‹å¦‚:

```
useEffects(doSomething, [name]) 
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒdoSomething å‡½æ•°å°†åªåœ¨ name å€¼æ›´æ”¹æ—¶è¿è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œå› ä¸ºæ‚¨å¯èƒ½ä¸å¸Œæœ›æ•ˆæœåœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œï¼Œè¿™æ˜¯é»˜è®¤è¡Œä¸ºã€‚

ç„¶è€Œï¼Œè¿™å¼•èµ·äº†å¦ä¸€ä¸ªé—®é¢˜ã€‚ä¸ºäº†ä½¿ useEffects ä»…åœ¨ name å·²æ›´æ”¹æ—¶è°ƒç”¨ doSomething å‡½æ•°ï¼Œå®ƒå°†ä»¥å‰çš„ name å€¼ä¸å…¶å½“å‰å€¼è¿›è¡Œæ¯”è¾ƒï¼Œä¾‹å¦‚ prevName === nameã€‚

è¿™å¯¹åŸå§‹çš„ JavaScript å€¼ç±»å‹éå¸¸æœ‰ç”¨ã€‚

ä½†æ˜¯å¦‚æœåå­—æ˜¯ä¸€ä¸ªå¯¹è±¡å‘¢ï¼ŸJavaScript ä¸­çš„å¯¹è±¡æ˜¯é€šè¿‡å¼•ç”¨æ¥æ¯”è¾ƒçš„ï¼ä»æŠ€æœ¯ä¸Šè®²ï¼Œå¦‚æœ name æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶æ€»æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æ£€æŸ¥ prevName === name å°†æ€»æ˜¯ä¸º **false** ã€‚

è¿™æ„å‘³ç€ï¼ŒdoSomething å‡½æ•°å°†åœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œâ€”â€”è¿™å¯èƒ½æ˜¯ä¸€ä¸ªæ€§èƒ½é—®é¢˜ï¼Œå…·ä½“å–å†³äºæ‚¨çš„åº”ç”¨ç¨‹åºç±»å‹ã€‚å¯¹æ­¤æœ‰ä»€ä¹ˆè§£å†³åŠæ³•å—ï¼Ÿ

è€ƒè™‘ä¸‹é¢è¿™ä¸ªå¾®ä¸è¶³é“çš„ç»„ä»¶:

```
function RandomNumberGenerator () {
  const name = 'name'

  useEffect(
    () => {
      console.log('Effect has been run!')
    },
    [name]
  )

  const [randomNumber, setRandomNumber] = useState(0)

  return (
    <div>
      <h1>{randomNumber}</h1>
      <button
        onClick={() => {
          setRandomNumber(Math.random())
        }}
      >
        Generate random number!
      </button>
    </div>
  )
} 
```

è¯¥ç»„ä»¶å‘ˆç°ä¸€ä¸ªæŒ‰é’®å’Œä¸€ä¸ªéšæœºæ•°ã€‚ç‚¹å‡»æŒ‰é’®åï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„éšæœºæ•°ã€‚

[![](../Images/1a758b1a1a5c132aa18abcbd22640d88.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--TmRuACLZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2AZVLW8R33-opRzmBCUXG-Kg.gif) 

<figcaption>éšæœºæ•°ç”Ÿæˆå™¨ã€‚è¿˜è¦æ³¨æ„è®°å½•åˆ°æ§åˆ¶å°çš„å€¼ã€‚</figcaption>

æ³¨æ„ï¼ŒuseEffect é’©å­çš„æ•ˆæœä¾èµ–äº name å˜é‡ã€‚

```
useEffect(() => {
    console.log("Effect has been run!")
  }, [name]) 
```

åœ¨æœ¬ä¾‹ä¸­ï¼Œname å˜é‡æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ã€‚è¯¥æ•ˆæœå°†åœ¨ç»„ä»¶æŒ‚è½½æ—¶è¿è¡Œï¼›å› æ­¤ï¼Œconsole.log("æ•ˆæœå·²ç»è¿è¡Œï¼")å°†è¢«è°ƒç”¨ã€‚

åœ¨éšåçš„æ¸²æŸ“ä¸­ï¼Œå°†è¿›è¡Œæµ…å±‚æ¯”è¾ƒï¼Œä¾‹å¦‚ï¼ŒprevName === nameï¼Œå…¶ä¸­ prevName è¡¨ç¤ºæ–°æ¸²æŸ“ä¹‹å‰åç§°çš„å…ˆå‰å€¼ã€‚

å­—ç¬¦ä¸²æ˜¯æŒ‰å€¼æ¯”è¾ƒçš„ï¼Œæ‰€ä»¥â€œnameâ€= = =â€œnameâ€æ€»æ˜¯ **true** ã€‚å› æ­¤ï¼Œæ•ˆæœä¸ä¼šè¿è¡Œã€‚

å› æ­¤ï¼Œä½ å¾—åˆ°çš„æ—¥å¿—è¾“å‡ºæ•ˆæœå·²ç»è¿è¡Œäº†ï¼å°±ä¸€æ¬¡ï¼

[![](../Images/1a758b1a1a5c132aa18abcbd22640d88.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--TmRuACLZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2AZVLW8R33-opRzmBCUXG-Kg.gif) 

<figcaption>å€¼åªè®°å½•ä¸€æ¬¡ï¼</figcaption>

ç°åœ¨ï¼Œå°† name å˜é‡æ”¹ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚

```
function RandomNumberGenerator() {
  // look here ğŸ‘‡
  const name = {firstName: "name"}

  useEffect(() => {
    console.log("Effect has been run!")
  }, [name])

  const [randomNumber, setRandomNumber] = useState(0);    

  return
{randomNumber}
{ setRandomNumber(Math.random()) }}>Generate random number! } 
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åï¼Œå†æ¬¡æ‰§è¡Œæµ…å±‚æ£€æŸ¥ã€‚ä½†æ˜¯ï¼Œç”±äºå¯¹è±¡æ˜¯é€šè¿‡å¼•ç”¨è¿›è¡Œæ¯”è¾ƒçš„â€” *è€Œä¸æ˜¯é€šè¿‡å€¼è¿›è¡Œæ¯”è¾ƒâ€”*,æ‰€ä»¥æ¯”è¾ƒå¤±è´¥ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹è¡¨è¾¾å¼è¿”å› false:

`{firstName: "name"} === {firstName: "name"}`

å› æ­¤ï¼Œæ¯æ¬¡æ¸²æŸ“åï¼Œæ•ˆæœéƒ½ä¼šåœ¨**ä¹‹åè¿è¡Œï¼Œä½ ä¼šå¾—åˆ°å¾ˆå¤šæ—¥å¿—ã€‚**

[![](../Images/4d0b430063ef43ae5fd60510800a239d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--W76ANyh_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/proxy/1%2AzM7WWz43YN7950GK3Ka6yg.gif) 

<figcaption>æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼Ÿ</figcaption>

æˆ‘ä»¬å¦‚ä½•é˜»æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Ÿ

#### [](#solution-1-use-jsonstringify)è§£å†³æ–¹æ¡ˆ 1:ä½¿ç”¨ JSON.stringify

è¿™ä¸ªè§£å†³æ–¹æ¡ˆçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
...
...useEffect(() => {
    console.log("Effect has been run!")
}, [JSON.stringify(name)]) 
```

é€šè¿‡ä½¿ç”¨ JSON.stringify(name ),è¢«æ¯”è¾ƒçš„å€¼ç°åœ¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå› æ­¤å°†é€šè¿‡å€¼è¿›è¡Œæ¯”è¾ƒã€‚

è¿™æ˜¯å¯è¡Œçš„ï¼Œä½†è¦å°å¿ƒè¡Œäº‹ã€‚ä»…å¯¹å…·æœ‰ä¸å¤ªå¤æ‚çš„å€¼å’Œæ˜“äºåºåˆ—åŒ–çš„æ•°æ®ç±»å‹çš„å¯¹è±¡ä½¿ç”¨ JSON.stringifyã€‚

#### [](#solution-2-use-a-manual-conditional-check)è§£å†³æ–¹æ¡ˆ 2:ä½¿ç”¨æ‰‹åŠ¨æ¡ä»¶æ£€æŸ¥

è¿™ä¸ªè§£å†³æ–¹æ¡ˆåŒ…æ‹¬è·Ÿè¸ªä»¥å‰çš„å€¼â€”â€”åœ¨æœ¬ä¾‹ä¸­æ˜¯ nameâ€”â€”å¹¶å¯¹å…¶å½“å‰å€¼è¿›è¡Œæ·±å…¥çš„æ¯”è¾ƒæ£€æŸ¥ã€‚

ä»£ç æœ‰ç‚¹å¤šï¼Œä½†å·¥ä½œåŸç†æ˜¯è¿™æ ·çš„:

```
// the isEqual function can come from anywhere 
// - as long as you perform a deep check. 
// This example uses a utility function from Lodash
import {isEqual} from 'lodash'

function RandomNumberGenerator() {
  const name = {firstName: "name"}

  useEffect(() => {
    if(!isEqual(prevName.current, name)) {
      console.log("Effect has been run!")
    }
  })

  const prevName = useRef; 
  useEffect(() => {
    prevName.current = name
  })

  const [randomNumber, setRandomNumber] = useState(0);

  return <div>
    <h1> {randomNumber} </h1>
    <button onClick={() => { setRandomNumber(Math.random()) }}>
       Generate random number!
    </button>
  </div>
} 
```

ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨è¿è¡Œæ•ˆæœä¹‹å‰æ£€æŸ¥è¿™äº›å€¼æ˜¯å¦ä¸ç›¸ç­‰:

```
!isEqual(prevName.current, name) 
```

ä½†æ˜¯ prevName.current æ˜¯ä»€ä¹ˆï¼Ÿé€šè¿‡é’©å­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ useRef é’©å­æ¥è·Ÿè¸ªå€¼ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè´Ÿè´£è¿™ä¸ªçš„ä»£ç ä½æ˜¯:

```
const prevName = useRef; 
useEffect(() => {
    prevName.current = name
}) 
```

è¿™å°†è·Ÿè¸ªåœ¨æ—©æœŸçš„ useEffect é’©å­ä¸­ä½¿ç”¨çš„å‰ä¸€ä¸ªåç§°ã€‚æˆ‘çŸ¥é“è¿™å¾ˆéš¾ç†è§£ï¼Œæ‰€ä»¥æˆ‘åœ¨ä¸‹é¢æä¾›äº†å®Œæ•´ä»£ç çš„æ³¨é‡Šç‰ˆæœ¬:

```
/**
 * To read the annotations correctly, read all turtle comments first ğŸ¢ 
 // - from top to bottom. 
 * Then come back to read all unicorns ğŸ¦„ - from top to bottom. 
 */

function RandomNumberGenerator() {
  // ğŸ¢ 1\. The very first time this component is mounted, 
  // the value of the name variable is set below
  const name = {firstName: "name"}

  // ğŸ¢ 2\. This hook is NOT run. useEffect only runs sometime after render
  // ğŸ¦„ 6\. After Render this hook is now run. 
  useEffect(() => {

  // ğŸ¦„ 7\. When the comparison happens, the hoisted value 
  // of prevName.current is "undefined". 
  // Hence, "isEqual(prevName.current, name)" returns "false" 
  // as {firstName: "name"} is NOT equal to undefined.
    if(!isEqual(prevName.current, name)) {

  // ğŸ¦„ 8\. "Effect has been run!" is logged to the console. 
  //console.log("Effect has been run!")
    }
  })

  // ğŸ¢ 3\. The prevName constant is created to hold some ref. 
  const prevName = useRef; 

  // ğŸ¢ 4\. This hook is NOT run 
  // ğŸ¦„ 9\. The order of your hooks matter! After the first useEffect is run, 
  // this will be invoked too. 
  useEffect(() => {
    // ğŸ¦„ 10\. Now "prevName.current" will be set to "name". 
    prevName.current = name; 
   // ğŸ¦„ 11\. In subsequent renders, the prevName.current will now hold the same 
    // object value - {firstName: "name"} which is alsways equal to the current 
    // value in the first useEffect hook. So, nothing is logged to the console. 
  // ğŸ¦„ 12\. The reason this effect holds the "previous" value is because 
    // it'll always be run later than the first hook. 
   })

  const [randomNumber, setRandomNumber] = useState(0)

  // ğŸ¢ 5\. Render is RUN now - note that here, name is equal to the object, 
  // {firstName: "name"} while the ref prevName.current holds no value. 
  return
{randomNumber}
{ setRandomNumber(Math.random()) }}> Generate random number! } 
```

#### [](#solution-3-use-the-usememo-hook)è§£å†³æ–¹æ¡ˆ 3:ä½¿ç”¨ useMemo é’©å­

åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆéå¸¸ä¼˜é›…ã€‚ä¸‹é¢æ˜¯å®ƒçš„æ ·å­:

```
function RandomNumberGenerator() {
  // look here ğŸ‘‡
  const name = useMemo(() => ({
    firstName: "name"
  }), [])

  useEffect(() => {
      console.log("Effect has been run!")
  }, [name])

  const [randomNumber, setRandomNumber] = useState(0)
  return
{randomNumber}
{ setRandomNumber(Math.random()) }}> Generate random number! } 
```

useEffect æŒ‚é’©ä»ç„¶ä¾èµ–äº name å€¼ï¼Œä½†æ˜¯è¿™é‡Œçš„ name å€¼æ˜¯ memoizedï¼Œç”± useMemo æä¾›ã€‚

```
const name = useMemo(() => ({
    firstName: "name"
}), []) 
```

useMemo æ¥å—ä¸€ä¸ªè¿”å›æŸä¸ªå€¼çš„å‡½æ•°ï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯å¯¹è±¡{firstName: "name"}ã€‚

useMemo çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ç»„ä¾èµ–é¡¹ï¼Œå…¶å·¥ä½œæ–¹å¼ä¸ useEffect ä¸­çš„ç±»ä¼¼ã€‚å¦‚æœæ²¡æœ‰ä¼ é€’æ•°ç»„ï¼Œåˆ™æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šé‡æ–°è®¡ç®—è¯¥å€¼ã€‚

ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„æ¥è®¡ç®—æŒ‚è½½ç»„ä»¶**æ—¶çš„å€¼ï¼Œè€Œä¸éœ€è¦**è·¨æ¸²æŸ“é‡æ–°è®¡ç®—è¯¥å€¼ã€‚è¿™ä½¿åç§°å€¼åœ¨æ¸²æŸ“ä¸­ä¿æŒç›¸åŒ(é€šè¿‡å¼•ç”¨)ã€‚

ç”±äºä¸Šé¢çš„è§£é‡Šï¼Œå³ä½¿ name æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒuseEffect é’©å­ç°åœ¨ä¹Ÿå¯ä»¥åƒé¢„æœŸçš„é‚£æ ·å·¥ä½œï¼Œè€Œä¸éœ€è¦å¤šæ¬¡è°ƒç”¨ Effectã€‚

name ç°åœ¨æ˜¯ä¸€ä¸ªè®°å¿†åŒ–çš„å¯¹è±¡ï¼Œåœ¨ä¸åŒçš„æ¸²æŸ“ä¸­å…·æœ‰ç›¸åŒçš„å¼•ç”¨ã€‚

```
...useEffect(() => {
      console.log("Effect has been run!")
}, [name]) // ğŸ‘ˆ name is memoized! 
```

### ä½ çš„æµ‹è¯•ç°åœ¨å› ä¸º useEffect è€Œä¸­æ–­ï¼Ÿ

å½“ä½ é‡æ„ä½ çš„åº”ç”¨ç¨‹åº(æˆ–ç»„ä»¶)æ¥ä½¿ç”¨é’©å­æ—¶ï¼Œä½ å¯èƒ½ä¼šé¢ä¸´çš„ä¸€ä¸ªæ›´ä»¤äººä¸å®‰çš„é—®é¢˜æ˜¯ï¼Œä½ çš„ä¸€äº›æ—§æµ‹è¯•ç°åœ¨å¯èƒ½ä¼šå¤±è´¥â€”â€”ä¼¼ä¹æ²¡æœ‰ä»»ä½•åŸå› ã€‚

å¦‚æœä½ å‘ç°è‡ªå·±å¤„äºè¿™ç§å¢ƒåœ°ï¼Œè¯·ç†è§£å¤±è´¥çš„æµ‹è¯•ç¡®å®æ˜¯æœ‰åŸå› çš„ã€‚

å¯¹äº useEffectï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ•ˆæœå›è°ƒä¸æ˜¯åŒæ­¥è¿è¡Œçš„â€”â€”å®ƒåœ¨æ¸²æŸ“åçš„*æ™š*æ—¶é—´è¿è¡Œã€‚å› æ­¤ï¼ŒuseEffect ä¸å®Œå…¨æ˜¯ componentidmount+componentiddupdate+componentWillUnmountã€‚

ç”±äºè¿™ç§â€œå¼‚æ­¥â€è¡Œä¸ºï¼Œå½“æ‚¨å¼•å…¥ useEffect æ—¶ï¼Œæ‚¨çš„ä¸€äº›(å¦‚æœä¸æ˜¯å…¨éƒ¨)æ—§æµ‹è¯•ç°åœ¨å¯èƒ½ä¼šå¤±è´¥ã€‚

[![](../Images/cca094c3842d8e6f05baea3e345b8c6e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--e6GJqIej--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2Aldu54Ang6lvOVa2JXXG1Dw%402x.png)

æœ‰ä»€ä¹ˆè§£å†³åŠæ³•å—ï¼Ÿ

ä½¿ç”¨æ¥è‡ª[çš„](https://reactjs.org/docs/test-utils.html) [act](https://reactjs.org/docs/test-utils.html#act) å®ç”¨ç¨‹åº react-test-utils åœ¨è¿™äº›ç”¨ä¾‹ä¸­å¸®åŠ©å¾ˆå¤§ã€‚å¦‚æœæ‚¨ä½¿ç”¨ [react-testing-library](https://github.com/kentcdodds/react-testing-library) è¿›è¡Œæµ‹è¯•ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥å¾ˆå¥½åœ°(åœ¨å¼•æ“ç›–ä¸‹)ä¸ act é›†æˆã€‚ä½¿ç”¨ react-testing-libraryï¼Œæ‚¨ä»ç„¶éœ€è¦å°†æµ‹è¯•ä¸­çš„æ‰‹åŠ¨æ›´æ–°ï¼Œæ¯”å¦‚çŠ¶æ€æ›´æ–°æˆ–è§¦å‘äº‹ä»¶ï¼ŒåŒ…è£…åˆ° act_ ä¸­ã€‚_

```
act.
act(() => {
    /* fire events that update state */
});
/* assert on the output */ 
```

åœ¨[è¿™ä¸ªè®¨è®º](https://github.com/kentcdodds/react-testing-library/issues/281#issuecomment-461145962)ä¸­æœ‰ä¸€ä¸ªä¾‹å­ã€‚åœ¨ act ä¸­è¿›è¡Œå¼‚æ­¥è°ƒç”¨ï¼Ÿ[è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå…³äºè¿™ä¸ªçš„è®¨è®º](https://github.com/kentcdodds/react-testing-library/issues/281)ã€‚

ç­‰ç­‰ï¼Œä»€ä¹ˆï¼Ÿ

æ‚¨å¯èƒ½è®¤ä¸ºæˆ‘æ©é¥°äº†ä½¿ç”¨ act test å®ç”¨å‡½æ•°çš„è§£å†³æ–¹æ¡ˆã€‚_ æˆ‘æœ¬æ‰“ç®—å†™ä¸€ä»½æ›´è¯¦ç»†çš„è§£é‡Šï¼Œä½† Sunil Pai(T1)æŠ¢å…ˆäº†ä¸€æ­¥ã€‚å¦‚æœä½ è®¤ä¸º[çš„ React æ–‡æ¡£](https://reactjs.org/docs/test-utils.html#act)æ²¡æœ‰å¾ˆå¥½åœ°è§£é‡Šè¿™ä¸ªæ¦‚å¿µâ€”â€”æˆ‘åŒæ„â€”â€”ä½ ä¼šåœ¨[è¿™ä¸ªå›è´­](https://github.com/threepointone/react-act-examples)ä¸­æ‰¾åˆ° act å¦‚ä½•å·¥ä½œçš„æƒŠäººä¾‹å­ã€‚

å¦‚æœæ‚¨ä½¿ç”¨åƒ [Enzyme](https://github.com/airbnb/enzyme) è¿™æ ·çš„æµ‹è¯•åº“ï¼Œå¹¶ä¸”åœ¨æ‚¨çš„æµ‹è¯•ä¸­æœ‰ä¸€äº›å®ç°ç»†èŠ‚ï¼Œä¾‹å¦‚è°ƒç”¨ instance()å’Œ state()è¿™æ ·çš„æ–¹æ³•ï¼Œå°±ä¼šå‡ºç°å¦ä¸€ä¸ªä¸æµ‹è¯•å¤±è´¥ç›¸å…³çš„é—®é¢˜ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä»…ä»…é€šè¿‡å°†ç»„ä»¶é‡æ„ä¸ºåŠŸèƒ½ç»„ä»¶ï¼Œæ‚¨çš„æµ‹è¯•å°±å¯èƒ½å¤±è´¥ã€‚

### ä¸€ç§æ›´å®‰å…¨çš„é‡æ„æ¸²æŸ“é“å…· API çš„æ–¹æ³•

æˆ‘ä¸çŸ¥é“ä½ ï¼Œä½†æˆ‘åˆ°å¤„éƒ½åœ¨ä½¿ç”¨æ¸²æŸ“é“å…· APIã€‚

é‡æ„ä¸€ä¸ªä½¿ç”¨ render props API çš„ç»„ä»¶æ¥ä½¿ç”¨åŸºäºé’©å­çš„å®ç°æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ã€‚ä¸è¿‡ï¼Œæœ‰ä¸ªå°é—®é¢˜ã€‚

è€ƒè™‘ä»¥ä¸‹å±•ç¤ºæ¸²æŸ“å±æ€§ API çš„ç»„ä»¶:

```
class TrivialRenderProps extends Component {
  state = {
    loading: false,
    data: []
  }
  render() {
    return this.props.children(this.state)
  }
} 
```

è¿™æ˜¯ä¸€ä¸ªäººä¸ºçš„ä¾‹å­ï¼Œä½†è¶³å¤Ÿå¥½äº†ï¼è¿™é‡Œæœ‰ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨è¿™ä¸ªç»„ä»¶çš„ä¾‹å­:

```
function ConsumeTrivialRenderProps() {
  return <TrivialRenderProps>
    {({loading, data}) => {
      return <pre>
        {`loading: ${loading}`} <br />
        {`data: [${data}]`}
      </pre>
    }}
  </TrivialRenderProps>
} 
```

å‘ˆç° ConsumeTrivialRenderProps ç»„ä»¶ä»…æ˜¾ç¤ºä»å‘ˆç°å±æ€§ API æ¥æ”¶çš„åŠ è½½å€¼å’Œæ•°æ®å€¼ã€‚

[![](../Images/55c108edc98bff24b8fe229941842569.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--tzXur-Em--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/348/1%2ArLBl0-pfLUwSjzae8Y4ljQ.png)

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡é¡ºåˆ©ï¼

render props çš„é—®é¢˜æ˜¯å®ƒä¼šè®©ä½ çš„ä»£ç çœ‹èµ·æ¥æ¯”ä½ æƒ³è¦çš„æ›´åŠ åµŒå¥—ã€‚å¹¸è¿çš„æ˜¯ï¼Œå¦‚å‰æ‰€è¿°ï¼Œå°† TrivialRenderProps ç»„ä»¶é‡æ„ä¸º Hooks å®ç°å¹¶ä¸æ˜¯ä»€ä¹ˆå¤§äº‹ã€‚

ä¸ºæ­¤ï¼Œæ‚¨åªéœ€å°†ç»„ä»¶å®ç°åŒ…è£…åœ¨ä¸€ä¸ªè‡ªå®šä¹‰é’©å­ä¸­ï¼Œå¹¶è¿”å›ä¸ä»¥å‰ç›¸åŒçš„æ•°æ®ã€‚å¦‚æœåšå¯¹äº†ï¼Œä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨é‡æ„åçš„é’©å­ API:

```
function ConsumeTrivialRenderProps() {
  const { loading, setLoading, data } = useTrivialRenderProps()
  return <pre>
    {`loading: ${loading}`} <br />
    {`data: [${data}]`}
  </pre>
} 
```

çœ‹èµ·æ¥æ•´æ´å¤šäº†ï¼

ä¸‹é¢æ˜¯è‡ªå®šä¹‰é’©å­ useTrivialRenderProps:

```
function useTrivialRenderProps() {
  const [data, setData] = useState([])
  const [loading, setLoading] = useState(false)
 return {
    data,
    loading,
  }
} 
```

å°±æ˜¯è¿™æ ·ï¼

```
// before 
class TrivialRenderProps extends Component {
  state = {
    loading: false,
    data: []
  }
  render() {
    return this.props.children(this.state)
  }
}

// after 
function useTrivialRenderProps() {
  const [data, setData] = useState([])
  const [loading, setLoading] = useState(false)

  return {
    data,
    loading,
  }
} 
```

é‚£ä¹ˆè¿™é‡Œçš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

åœ¨å¤„ç†å¤§å‹ä»£ç åº“æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šåœ¨è®¸å¤šä¸åŒçš„åœ°æ–¹ä½¿ç”¨æŸä¸ªæ¸²æŸ“å±æ€§ APIã€‚å°†ç»„ä»¶çš„å®ç°æ›´æ”¹ä¸ºä½¿ç”¨é’©å­æ„å‘³ç€æ‚¨å¿…é¡»æ›´æ”¹ç»„ä»¶åœ¨è®¸å¤šä¸åŒåœ°æ–¹çš„ä½¿ç”¨æ–¹å¼ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œåšäº›äº¤æ˜“å—ï¼Ÿç»å¯¹çš„ï¼

æ‚¨å¯ä»¥é‡æ„ç»„ä»¶ä»¥ä½¿ç”¨é’©å­ï¼Œä½†ä¹Ÿå¯ä»¥å…¬å¼€ä¸€ä¸ªå‘ˆç°é“å…· APIã€‚é€šè¿‡è¿™æ ·åšï¼Œä½ å¯ä»¥åœ¨ä½ çš„ä»£ç åº“ä¸­é€æ­¥é‡‡ç”¨é’©å­ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ”¹å˜å¾ˆå¤šä»£ç ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­:

```
// hooks implementation 
function useTrivialRenderProps() {
  const [data, setData] = useState([])
  const [loading, setLoading] = useState(false)
  return {
    data,
    loading,
  }
}
// render props implementation 
const TrivialRenderProps = ({children, ...props}) => children(useTrivialRenderProps(props));
// export both 
export { useTrivialRenderProps };  
export default TrivialRenderProps; 
```

ç°åœ¨ï¼Œé€šè¿‡å¯¼å‡ºè¿™ä¸¤ä¸ªå®ç°ï¼Œæ‚¨å¯ä»¥åœ¨æ•´ä¸ªä»£ç åº“ä¸­é€æ­¥é‡‡ç”¨é’©å­ï¼Œå› ä¸ºä»¥å‰çš„æ¸²æŸ“é“å…·æ¶ˆè´¹è€…å’Œæ–°çš„é’©å­æ¶ˆè´¹è€…éƒ½å¯ä»¥å®Œç¾åœ°å·¥ä½œï¼

```
// this will work ğŸ‘‡
function ConsumeTrivialRenderProps() {
  return <TrivialRenderProps>
    {({loading, data}) => {
      return <pre>
        {`loading: ${loading}`} <br />
        {`data: [${data}]`}
      </pre>
    }}
  </TrivialRenderProps>
}
// so will this ğŸ‘‡
function ConsumeTrivialRenderProps() {
  const { loading, setLoading, data } = useTrivialRenderProps()
  return <pre>
    {`loading: ${loading}`} <br />
    {`data: [${data}]`}
  </pre>
} 
```

æˆ‘å‘ç°æœ‰è¶£çš„æ˜¯ï¼Œæ–°çš„æ¸²æŸ“é“å…·å®ç°ä¹Ÿåœ¨é’©å­ä¸‹ä½¿ç”¨é’©å­ã€‚

```
// render props implementation 
const TrivialRenderProps = ({children, ...props}) => children(useTrivialRenderProps(props)); 
```

### [](#handling-state-initializers)å¤„ç†çŠ¶æ€åˆå§‹å€¼

åŸºäºæŸäº›è®¡ç®—åˆå§‹åŒ–æŸäº›çŠ¶æ€å±æ€§çš„ç±»ç»„ä»¶å¹¶ä¸å°‘è§ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­:

```
class MyComponent extends Component {
  constructor(props) {
    super(props)
    this.state = { token: null }
    if (this.props.token) {
      this.state.token = this.props.token
    } else {
      token = window.localStorage.getItem('app-token');
      if (token) {
        this.state.token = token
      }
    }
  }
} 
```

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½†å®ƒæ˜¾ç¤ºäº†ä¸€ä¸ªä¸€èˆ¬æ€§çš„é—®é¢˜ã€‚æœ‰å¯èƒ½ä½ çš„ç»„ä»¶ä¸€æŒ‚è½½ï¼Œä½ å°±æ ¹æ®ä¸€äº›è®¡ç®—åœ¨æ„é€ å‡½æ•°ä¸­è®¾ç½®ä¸€äº›åˆå§‹çŠ¶æ€ã€‚

åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æœ‰ä»¤ç‰Œå±æ€§ä¼ å…¥ï¼Œæˆ–è€…æœ¬åœ°å­˜å‚¨ä¸­æ˜¯å¦æœ‰ app-token å¯†é’¥ï¼Œç„¶åæˆ‘ä»¬åŸºäºæ­¤è®¾ç½®çŠ¶æ€ã€‚åœ¨é‡æ„é’©å­æ—¶ï¼Œå¦‚ä½•å¤„ç†è¿™æ ·çš„é€»è¾‘æ¥è®¾ç½®åˆå§‹çŠ¶æ€ï¼Ÿ

æˆ–è®¸ useState é’©å­ä¸€ä¸ªä¸å¤ªä¸ºäººæ‰€çŸ¥çš„ç‰¹æ€§æ˜¯ï¼Œä½ ä¼ é€’ç»™ useState é’©å­çš„ initialState å‚æ•°â€”â€”useState(initial state)â€”â€”ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼

ä»è¿™ä¸ªå‡½æ•°è¿”å›çš„ä»»ä½•å†…å®¹éƒ½å°†è¢«ç”¨ä½œåˆå§‹çŠ¶æ€ã€‚ä¸‹é¢æ˜¯ç»„ä»¶è¢«é‡æ„ä½¿ç”¨é’©å­åçš„æ ·å­:

```
function MyComponent(props) {
   const [token, setToken] = useState(() => {
     if(props.token) {
       return props.token 
     } else {
       tokenLocal = window.localStorage.getItem('app-token');
       if (tokenLocal) {
         return tokenLocal
       }
     }
   })   
} 
```

ä»æŠ€æœ¯ä¸Šè®²ï¼Œé€»è¾‘å‡ ä¹ä¿æŒä¸å˜ã€‚è¿™é‡Œé‡è¦çš„æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦æ ¹æ®æŸäº›é€»è¾‘åˆå§‹åŒ–çŠ¶æ€ï¼Œæ‚¨å¯ä»¥åœ¨ useState ä¸­ä½¿ç”¨å‡½æ•°ã€‚

### [](#conclusion)ç»“è®º

é‡æ„åº”ç”¨ç¨‹åºæ¥ä½¿ç”¨é’©å­å¹¶ä¸æ˜¯ä½ å¿…é¡»åšçš„äº‹æƒ…ã€‚ä¸ºä½ è‡ªå·±å’Œä½ çš„å›¢é˜Ÿæƒè¡¡é€‰æ‹©ã€‚å¦‚æœæ‚¨é€‰æ‹©é‡æ„ç»„ä»¶æ¥ä½¿ç”¨æ–°çš„ Hooks APIï¼Œé‚£ä¹ˆæˆ‘å¸Œæœ›æ‚¨å·²ç»åœ¨æœ¬æ–‡ä¸­æ‰¾åˆ°äº†ä¸€äº›å¾ˆå¥½çš„æŠ€å·§ã€‚

å›å¤´è§ï¼

* * *

### [](#plug-logrocket-a-dvr-for-web-apps)Plug: [LogRocket](https://logrocket.com/signup/) ï¼Œä¸€æ¬¾é€‚ç”¨äºç½‘ç»œåº”ç”¨çš„ DVR

[![](../Images/d56be9e9e36d8fa98c6959f7097b7787.png)](https://logrocket.com/signup/)

<figcaption>[https://logrocket.com/signup/](https://logrocket.com/signup/)</figcaption>

LogRocket æ˜¯ä¸€ä¸ªå‰ç«¯æ—¥å¿—å·¥å…·ï¼Œå¯ä»¥è®©ä½ å›æ”¾é—®é¢˜ï¼Œå°±åƒå®ƒä»¬å‘ç”Ÿåœ¨ä½ è‡ªå·±çš„æµè§ˆå™¨ä¸­ä¸€æ ·ã€‚LogRocket ä¸éœ€è¦çŒœæµ‹é”™è¯¯å‘ç”Ÿçš„åŸå› ï¼Œä¹Ÿä¸éœ€è¦å‘ç”¨æˆ·è¯¢é—®æˆªå›¾å’Œæ—¥å¿—è½¬å‚¨ï¼Œè€Œæ˜¯è®©æ‚¨é‡æ”¾ä¼šè¯ä»¥å¿«é€Ÿäº†è§£å“ªé‡Œå‡ºé”™äº†ã€‚å®ƒå¯ä»¥ä¸ä»»ä½•åº”ç”¨ç¨‹åºå®Œç¾é…åˆï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ¡†æ¶ï¼Œå¹¶ä¸”æœ‰æ’ä»¶å¯ä»¥è®°å½•æ¥è‡ª Reduxã€Vuex å’Œ@ngrx/store çš„é¢å¤–ä¸Šä¸‹æ–‡ã€‚

é™¤äº†è®°å½• Redux æ“ä½œå’ŒçŠ¶æ€ï¼ŒLogRocket è¿˜è®°å½•æ§åˆ¶å°æ—¥å¿—ã€JavaScript é”™è¯¯ã€å †æ ˆè·Ÿè¸ªã€å¸¦æœ‰å¤´+æ­£æ–‡çš„ç½‘ç»œè¯·æ±‚/å“åº”ã€æµè§ˆå™¨å…ƒæ•°æ®å’Œè‡ªå®šä¹‰æ—¥å¿—ã€‚å®ƒè¿˜ä½¿ç”¨ DOM æ¥è®°å½•é¡µé¢ä¸Šçš„ HTML å’Œ CSSï¼Œç”šè‡³ä¸ºæœ€å¤æ‚çš„å•é¡µé¢åº”ç”¨ç¨‹åºé‡æ–°åˆ›å»ºåƒç´ çº§å®Œç¾è§†é¢‘ã€‚

[å…è´¹è¯•ç”¨](https://logrocket.com/signup/)ã€‚

* * *

å¸–å­[å®ç”¨çš„ React é’©å­:å¦‚ä½•é‡æ„ä½ çš„åº”ç”¨ç¨‹åºä»¥ä½¿ç”¨é’©å­](https://blog.logrocket.com/practical-react-hooks-how-to-refactor-your-app-to-use-hooks-b1867e7b0a53/)æœ€å…ˆå‡ºç°åœ¨[åšå®¢](https://blog.logrocket.com)ä¸Šã€‚