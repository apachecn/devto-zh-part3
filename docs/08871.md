# åˆ›å»ºè§’åº¦ UI ç»„ä»¶å¹¶å°†å®ƒä»¬è¿æ¥åˆ° graph QL app sync APIâ€”â€”ç¬¬ 2 éƒ¨åˆ†

> åŸæ–‡:[https://dev . to/beave arony/creating-angular-ui-components-and-connecting-them-to-the-graph QL-app sync-API-part-2-33n 0](https://dev.to/beavearony/creating-angular-ui-components-and-connecting-them-to-the-graphql-appsync-api-part-2-33n0)

åœ¨æœ¬ç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªå·¥ä½œåŒºï¼Œåœ¨ä¸€ä¸ªå…±äº«åº“ä¸­é…ç½®äº† AWS äº‘èµ„æºï¼Œæ·»åŠ äº†èº«ä»½éªŒè¯ä»¥ä¿æŠ¤ç§æœ‰æ•°æ®ï¼Œä¸º GraphQL API ç”Ÿæˆäº†ç±»å‹ï¼Œç¼–å†™äº†ä¸€ä¸ªçªå˜åŠ©æ‰‹åŒ…è£…å‡½æ•°ï¼Œå¹¶è®¨è®ºäº†ä¸æ­¤ç›¸å…³çš„å„ç§ä¸»é¢˜ã€‚

[![beavearony image](../Images/d4a98c8b3973de5b2679b8ac142d8db9.png)](/beavearony) [## AWS Amplify GraphQL API æ”¯æŒçš„ Angular/NX å·¥ä½œç©ºé—´å…¥é—¨â€”â€”ç¬¬ 1 éƒ¨åˆ†

### è¿ˆå…‹å°”Â·å¤ç‰¹æ›¼

#angular #graphql #awsamplify #awsappsync](/beavearony/getting-started-with-a-angularnx-workspace-backed-by-an-aws-amplify-graphql-api---part-1-24m0)
We were busy, but until this point, we still haven't done much towards our UI. Let's create some components using the Angular CLI in this second part!

å‡ºäºç®€æ´çš„åŸå› ï¼Œæˆ‘å°†çœç•¥ä¸€äº›æ ·å¼ï¼Œä½†æ˜¯ä½ å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°å®ƒä»¬[ã€‚](https://github.com/BeaveArony/amplify-angular-nx-todo)

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png) [æ¯”ç“¦ç½—å°¼](https://github.com/BeaveArony) / [æ”¾å¤§-è§’åº¦-nx-todo](https://github.com/BeaveArony/amplify-angular-nx-todo)

<article class="markdown-body entry-content container-lg" itemprop="text">

# ç”± AWS Amplify GraphQL åç«¯æ”¯æŒçš„ NX å¤šåº”ç”¨ç¨‹åºè®¾ç½®

[![](../Images/a0933fe2c7de5900d55d5895db66a8cf.png)T2ã€‘](https://raw.githubusercontent.com/BeaveArony/amplify-angular-nx-todo/master/app-screenshot.png)

## å…¥é—¨æŒ‡å—

è¦éƒ¨ç½²æ­¤é¡¹ç›®ï¼Œè¯·ç‚¹å‡»æ­¤æŒ‰é’®...

[![Deploy to Amplify Console](../Images/655d874f17e48001226716c9475089d5.png)](https://console.aws.amazon.com/amplify/home#/deploy?repo=https://github.com/BeaveArony/amplify-angular-nx-todo) 

...æˆ–è€…ç»å†ä»¥ä¸‹æ­¥éª¤:

1.  å…‹éš†æ­¤å›è´­

```
git clone https://github.com/BeaveArony/amplify-angular-nx-todo.git
```

2.  è½¬åˆ°ç›®å½•å¹¶å®‰è£…ä¾èµ–é¡¹

```
npm install

# or

yarn
```

3.  åˆå§‹åŒ–æ”¾å¤§é¡¹ç›®

```
amplify init
```

4.  åœ¨æ‚¨çš„å¸æˆ·ä¸­åˆ›å»ºèµ„æº

```
amplify push
```

5.  å¯åŠ¨åº”ç”¨ç¨‹åº

```
npm start
```

</article>

[View on GitHub](https://github.com/BeaveArony/amplify-angular-nx-todo)

## [](#building-the-ui)æ„å»º UI

1.  åŒ…è£…æ•´ä¸ªç”¨æˆ·ç•Œé¢çš„ todo é¡µã€‚è¯¥ç»„ä»¶å°†ç”± app-component å¯¼å…¥ï¼Œå¹¶å°†æˆä¸ºè¯¥åº“çš„å”¯ä¸€å®¹å™¨/æ™ºèƒ½ç»„ä»¶
2.  åˆ›å»ºæ–°å¾…åŠäº‹é¡¹çš„è¡¨å•
3.  ç”¨äºåˆ‡æ¢*å·²å®Œæˆ*å±æ€§çš„å¯è§æ€§çš„è¿‡æ»¤å™¨ç»„ä»¶
4.  å¾…åŠäº‹é¡¹åˆ—è¡¨ç»„ä»¶åŠå…¶å¾…åŠäº‹é¡¹ç»„ä»¶
5.  æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯çš„ç»„ä»¶

```
ng g c --project=todo-ui --export  todo-page
ng g c --project=todo-ui -c=OnPush create-form
ng g c --project=todo-ui -c=OnPush todo-list
ng g c --project=todo-ui -c=OnPush todo-item
ng g c --project=todo-ui -c=OnPush filter-bar
ng g c --project=todo-ui -c=OnPush error-alert 
```

æˆ‘æƒ³åƒ AWS è®¤è¯ç»„ä»¶çš„åº”ç”¨ç¨‹åºé£æ ¼ã€‚ä¸ºäº†æœ‰åŠ©äºæ ·å¼ï¼Œå°†`apps/todo-app/src/styles.css`çš„å†…å®¹æ›¿æ¢ä¸º:

```
/* You can add global styles to this file, and also import other style files */
@import '~aws-amplify-angular/theme.css';

html,
body {
  height: 100%;
}
body {
  margin: 0;
  background-color: var(--color-accent-brown);
}

/* Amplify UI fixes */
.amplify-form-input {
  width: calc(100% - 1em);
  box-sizing: border-box;
}
.amplify-alert {
  margin-top: 2em;
}
.amplify-greeting > * {
  white-space: nowrap;
}
.amplify-greeting-flex-spacer {
  width: 100%;
}

.card,
.amplify-authenticator {
  width: var(--component-width-desktop);
  margin: 1em auto;
  border-radius: 6px;
  background-color: var(--color-white);
  box-shadow: var(--box-shadow);
}
.card-container {
  width: 400px;
  margin: 0 auto;
  padding: 1em;
}

@media (min-width: 320px) and (max-width: 480px) {
  .card,
  .amplify-authenticator {
    width: var(--component-width-mobile);
    border-radius: 0;
    margin: 0.5em auto;
  }
  .card-container {
    width: auto;
  }
  .amplify-alert {
    left: 4%;
  }
} 
```

æˆ‘ä»¬æ­£åœ¨å»ºç«‹ html / body å’Œ card ç±»ï¼Œå®ƒä»¬çœ‹èµ·æ¥éå¸¸ç±»ä¼¼äº Amplify ç»„ä»¶æ ·å¼ã€‚æˆ‘ä»¬æ­£åœ¨é‡ç”¨ä¹‹å‰å¯¼å…¥çš„ CSS å˜é‡ã€‚amplify-authenticator åœ¨ç§»åŠ¨è§†å›¾ä¸­æœ‰åœ†è§’ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿåœ¨åª’ä½“æŸ¥è¯¢ä¸­å¯¹æ­¤è¿›è¡Œäº†æ›´æ”¹ã€‚

æˆ‘ä»¬è¿˜ä¿®å¤äº† html è¾“å…¥æ ‡ç­¾çš„æ ·å¼ï¼Œå› ä¸ºå®ƒä»¬åœ¨ç§»åŠ¨è®¾å¤‡ä¸­å‘å³å»¶ä¼¸å¾—å¤ªè¿œäº†ã€‚

amplify angular authenticator ç»„ä»¶ä»ç„¶å­˜åœ¨ä¸€äº›æ ·å¼é—®é¢˜ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºå¯¹äºä¸€ä¸ªç®€å•çš„ UI ç»„ä»¶æ¥è¯´ï¼Œæ”¯æŒä¸€èˆ¬çš„æ³¨å†Œ/ç™»å½•è¿‡ç¨‹å·²ç»è¶³å¤Ÿå¥½äº†ã€‚

## [](#todopage)å¾…åŠäº‹å®œ-é¡µé¢

todo-page ç»„ä»¶æ˜¯ todo-ui æ¨¡å—çš„èµ·ç‚¹ã€‚å®ƒæ˜¯å”¯ä¸€å¯¼å‡ºçš„ç»„ä»¶ï¼Œå…¶ä»–æ‰€æœ‰ç»„ä»¶éƒ½åœ¨è¿™ä¸ªåº“å†…éƒ¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ç¨åé˜¶æ®µå¼•å…¥è·¯ç”±ï¼Œç”šè‡³å»¶è¿ŸåŠ è½½è¿™ä¸ªæ¨¡å—ï¼Œä»¥ä¾¿æ›´å¿«åœ°å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚

è¯¥ç»„ä»¶ä¹Ÿå°†æ˜¯å¤„ç† API é€šä¿¡å¹¶å‘è¯¥æ¨¡å—ä¸­çš„å…¶ä»–è¡¨ç¤ºç»„ä»¶æä¾›æ•°æ®çš„å”¯ä¸€å®¹å™¨ç»„ä»¶ã€‚å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰åœ¨æˆ‘ä»¬çš„ç»„ä»¶ä¸­ç¼–å†™ä»»ä½•ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ç›®å‰ä¸ºæ­¢å¾—åˆ°çš„å†…å®¹æ¥æ„å»ºæˆ‘ä»¬çš„è§†å›¾ã€‚æ‰€æœ‰ç»„ä»¶éƒ½æ˜¯ç”±`ng generate`å‘½ä»¤ç”Ÿæˆçš„ï¼Œå¯ä»¥åœ¨æˆ‘ä»¬çš„ HTML æ ‡è®°ä¸­å¼•ç”¨ã€‚

å°†`libs/todo-ui/src/lib/todo-page/todo-page.component.html`æ›´æ”¹ä¸ºæ­¤

```
<div class="card">
  <div class="card-container">
    <my-create-form></my-create-form>
    <my-filter-bar></my-filter-bar>
  </div>
</div>
<my-error-alert></my-error-alert>
<div class="card">
  <div class="card-container"><my-todo-list></my-todo-list></div>
</div> 
```

å¹¶åœ¨æˆ‘ä»¬çš„æ ¹åº”ç”¨ç¨‹åºæ¨¡å—`apps/todo-app/src/app/app.module.ts`ä¸­å¯¼å…¥ todo-ui æ¨¡å—ï¼Œå°±åƒè¿™æ ·

```
// ... other imports
import { TodoUiModule } from '@my/todo-ui';

@NgModule({
  declarations: [AppComponent],
  imports: [BrowserModule, AppsyncModule, TodoUiModule],
  bootstrap: [AppComponent]
})
export class AppModule {} 
```

è¦åœ¨åº”ç”¨ç¨‹åºä¸­æ˜¾ç¤ºå¾…åŠäº‹é¡¹é¡µé¢ï¼Œè¯·å°†`apps/todo-app/src/app/app.component.html`æ›´æ”¹ä¸º

```
<my-todo-page></my-todo-page> 
```

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™åªæ˜¯æˆ‘ä»¬ UI çš„èµ·ç‚¹ã€‚ä½ å¯ä»¥ç”¨`npm start`è¿è¡Œåº”ç”¨ç¨‹åºï¼Œæµè§ˆä¸€ä¸ªåŸºæœ¬çš„éª¨æ¶ã€‚

## [](#aws-authenticator-uicomponent)AWS è®¤è¯å™¨ UI-ç»„ä»¶

AWS Amplify ä¸º Angular/Ionicã€React å’Œ Vue æä¾›äº†å‡ ä¸ªåµŒå…¥å¼ UI ç»„ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©

*   è®¤è¯è€…
*   ç…§ç‰‡æ‹¾å–å™¨
*   å”±ç‰‡
*   èŠå¤©æœºå™¨äºº

è¦å°† AWS éªŒè¯å™¨æ·»åŠ åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¯·æ›´æ”¹`apps/todo-app/src/app/app.component.html`ä»¥åŒ…å«å®ƒå’Œ todo-page ç»„ä»¶ã€‚

```
<amplify-authenticator></amplify-authenticator>
<my-todo-page *ngIf="hydrated && isLoggedIn"></my-todo-page> 
```

`apps/todo-app/src/app/app.component.ts`å’Œ
çš„å†…å®¹

```
import { Component, OnInit } from '@angular/core';
import { AppSyncClient } from '@my/appsync';
import { AmplifyService } from 'aws-amplify-angular';

@Component({
  selector: 'my-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent implements OnInit {
  hydrated = false;
  isLoggedIn = false;

  constructor(private amplifyService: AmplifyService) {}

  ngOnInit(): void {
    AppSyncClient.hydrated().then(client => (this.hydrated = !!client));
    this.amplifyService.authStateChange$.subscribe(authState => {
      if (authState.state === 'signedOut' && this.isLoggedIn) {
        AppSyncClient.clearStore().then(() =>
          console.log('User signed out, store cleared!')
        );
      }
      this.isLoggedIn =
        authState.state === 'signedIn' || authState.state === 'confirmSignIn';
    });
  }
} 
```

AppSyncClient æŒä¹…åŒ–å®ƒçš„ redux å­˜å‚¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥åªåœ¨å­˜å‚¨è¢«æ¢å¤æ—¶å‘ˆç° todo-uiã€‚AppSyncClient æä¾›äº†ä¸€ä¸ª`AppSyncClient.hydrated()`å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒã€‚
AmplifyService æä¾›äº†ä¸€ä¸ªå¯è§‚å¯Ÿçš„`authStateChange$`,æˆ‘ä»¬å¯ä»¥è®¢é˜…å®ƒï¼Œåªåœ¨ç”¨æˆ·ç™»å½•æ—¶æ˜¾ç¤º todo-uiã€‚ä¸ºäº†åœ¨ç”¨æˆ·é€€å‡ºæ—¶ä¸ç•™ä¸‹ä»»ä½•ç¼“å­˜é¡¹ï¼Œæˆ‘ä»¬åœ¨è¯¥äº‹ä»¶æ—¶æ¸…é™¤äº†å­˜å‚¨ã€‚å½“å®¢æˆ·ç«¯æ²¡æœ‰æ¢å¤æˆ–è€…æ²¡æœ‰ç”¨æˆ·ä½¿ç”¨`*ngIf`æŒ‡ä»¤ç™»å½•æ—¶ï¼Œ`<my-todo-page>`ç»„ä»¶æ˜¯éšè—çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`<amplify-authenticator>`ä¼šæ˜¾ç¤ºä¸€æ¡é—®å€™æ¶ˆæ¯ï¼Œå½“ç”¨æˆ·ç™»å½•æ—¶ä¼šæ˜¾ç¤ºä¸€ä¸ªé€€å‡ºé“¾æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦éšè—å®ƒã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥ä¸€ä¸ªé…ç½®å¯¹è±¡
æ¥é…ç½®è¿™ä¸ªç»„ä»¶

```
<amplify-authenticator [signUpConfig]="signUpConfig"></amplify-authenticator> 
```

æˆ–è€…å°†æ¡†æ¶æ”¹ä¸º Ionic å¹¶éšè—æŸäº›éƒ¨åˆ†ï¼Œæ¯”å¦‚é€€å‡ºé“¾æ¥

```
<amplify-authenticator
  framework="ionic"
  [hide]="['SignOut']"
></amplify-authenticator> 
```

## [](#creating-the-presentational-ui)åˆ›å»ºæ¼”ç¤ºç•Œé¢

æˆ‘ä»¬ä»è¡¨ç¤ºç»„ä»¶å¼€å§‹ï¼Œå®ƒä»¬ä¸ä½¿ç”¨ä»»ä½• APIï¼Œåªé€šè¿‡`@Input()`è·å–æ•°æ®ï¼Œå¹¶ä½¿ç”¨ Angular çš„`EventEmitter`é€šè¿‡`@Output()`å‘å‡ºäº‹ä»¶ã€‚ç¨åæˆ‘ä»¬
åœ¨ todo-page ç»„ä»¶ä¸­è¿æ¥å®ƒä»¬ã€‚

### [](#model)å‹å·

åˆ›å»ºä¸€ä¸ªæ–‡ä»¶`libs/todo-ui/src/lib/model.ts`æ¥ä¿å­˜ç‰¹å®šäºè¿™ä¸ª UI åº“çš„ç±»å‹ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªè¾“å…¥ Todo çš„å¯è§æ€§çŠ¶æ€ã€‚

```
export type TodoFilterType = 'SHOW_ALL' | 'SHOW_ACTIVE' | 'SHOW_COMPLETED'; 
```

### [](#createform-component)åˆ›å»º-è¡¨å•ç»„ä»¶

å½“æäº¤ååº”å¼è¡¨å•æ—¶ï¼Œè¿™ä¸ªåˆ›å»ºè¡¨å•ç»„ä»¶å‘å‡ºä¸€ä¸ªæ–°çš„ todo åç§°ã€‚å½“å¿…å¡«çš„æ–‡æœ¬å­—æ®µä¸ºç©ºæ—¶ï¼Œæˆ‘ä»¬è¿˜ä¼šç¦ç”¨æäº¤æŒ‰é’®ã€‚ä¸€æ—¦æˆ‘ä»¬å‘å‡ºä¸€ä¸ªæ–°çš„ todoï¼Œæˆ‘ä»¬æ¸…é™¤è¾“å…¥å­—æ®µã€‚ä½¿ç”¨ form æ ‡ç­¾å’Œ submit æŒ‰é’®å¯ä»¥è®©æˆ‘ä»¬åœ¨è¾“å…¥ todo æ–‡æœ¬åç‚¹å‡»â€œEnterâ€ã€‚

`libs/todo-ui/src/lib/create-form/create-form.component.html`

```
<form [formGroup]="form" (ngSubmit)="createTodo()">
  <input type="text" formControlName="todoName" required />
  <button type="submit" [disabled]="!form.valid">+</button>
</form> 
```

`libs/todo-ui/src/lib/create-form/create-form.component.ts`

```
import {
  ChangeDetectionStrategy,
  Component,
  EventEmitter,
  Output
} from '@angular/core';
import { FormControl, FormGroup } from '@angular/forms';

@Component({
  selector: 'my-create-form',
  templateUrl: './create-form.component.html',
  styleUrls: ['./create-form.component.css'],
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class CreateFormComponent {
  @Output() created = new EventEmitter<string>();
  form = new FormGroup({ todoName: new FormControl('') });

  createTodo() {
    const todoName = this.form.value.todoName.trim();
    if (todoName) {
      this.created.emit(todoName);
      this.form.setValue({ todoName: '' });
    }
  }
} 
```

### [](#filterbar-component)æ»¤æ£’ç»„ä»¶

filter-bar ç»„ä»¶åŒ…å«ä¸€ä¸ªåˆ‡æ¢æŒ‰é’®æ ï¼Œç”¨äºæ›´æ”¹ todo åˆ—è¡¨çš„å¯è§æ€§ã€‚é€‰å®šçš„æŒ‰é’®å°†è¢«ç¦ç”¨å’Œæ ·å¼ï¼Œä½¿å…¶çœ‹èµ·æ¥æ´»è·ƒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ”¾å¤§è§’åº¦ä¸»é¢˜ä¸­çš„ CSS å˜é‡ã€‚

`libs/todo-ui/src/lib/filter-bar/filter-bar.component.html`

```
<nav>
  <button
    *ngFor="let btn of buttons"
    (click)="filter(btn.value)"
    [disabled]="currentFilter === btn.value"
  >
    {{ btn.name }}
  </button>
</nav> 
```

`libs/todo-ui/src/lib/filter-bar/filter-bar.component.css`

```
nav {
  margin-top: 0.5em;
  display: flex;
  justify-content: space-between;
}
button {
  border: 1px solid var(--color-blue);
  height: var(--button-height);
  width: 128px;
  color: var(--color-blue);
  text-transform: uppercase;
  cursor: pointer;
}

button:hover {
  background-color: var(--color-accent-blue);
}

button:disabled {
  background-color: var(--color-blue);
  color: white;
  border: none;
  cursor: auto;
} 
```

`libs/todo-ui/src/lib/filter-bar/filter-bar.component.ts`

```
import {
  ChangeDetectionStrategy,
  Component,
  EventEmitter,
  Output
} from '@angular/core';
import { TodoFilterType } from '../model';

@Component({
  selector: 'my-filter-bar',
  templateUrl: './filter-bar.component.html',
  styleUrls: ['./filter-bar.component.css'],
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class FilterBarComponent {
  @Output() filtered = new EventEmitter<TodoFilterType>();

  currentFilter: TodoFilterType = 'SHOW_ALL';
  buttons: { value: TodoFilterType; name: string }[] = [
    { value: 'SHOW_ALL', name: 'All' },
    { value: 'SHOW_ACTIVE', name: 'Active' },
    { value: 'SHOW_COMPLETED', name: 'Completed' }
  ];

  filter(query: TodoFilterType) {
    this.currentFilter = query;
    this.filtered.emit(this.currentFilter);
  }
} 
```

æˆ‘ä»¬æ ¹æ®æ‰€é€‰æ‹©çš„æŒ‰é’®å‘å‡ºä¸€ä¸ªè¿‡æ»¤æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚çˆ¶ todo-page ç»„ä»¶å°†å¯¹æ­¤è¿›è¡Œç›‘å¬ï¼Œå¹¶å°†æŸ¥è¯¢ä½œä¸ºè¾“å…¥ä¼ é€’ç»™å…¶å­ todo-list ç»„ä»¶ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥æ ¹æ® *completed* å±æ€§è¿‡æ»¤åˆ—è¡¨ã€‚

### [](#todoitem-component)å¾…åŠäº‹é¡¹ç»„ä»¶

todo-list å‘ˆç° todo-item ç»„ä»¶çš„åˆ—è¡¨ã€‚è¿™äº›é¡¹ç›®è´Ÿè´£æ˜¾ç¤ºæ‰€æä¾›çš„è¾“å…¥å€¼ã€‚æˆ‘ä»¬ä½¿ç”¨ HTML å®ä½“ä½œä¸ºå›¾æ ‡ã€‚å½“ç‚¹å‡»åˆ é™¤å›¾æ ‡æ—¶ï¼Œæˆ‘ä»¬å‘å‡º`deleted`äº‹ä»¶ï¼Œå½“ç‚¹å‡»è¯¥é¡¹ç›®çš„å…¶ä½™éƒ¨åˆ†æ—¶ï¼Œå‘å‡ºä¸€ä¸ª`toggled`äº‹ä»¶æ¥æ”¹å˜è¯¥ todo é¡¹çš„*å®Œæˆ*å±æ€§ã€‚

`libs/todo-ui/src/lib/todo-item/todo-item.component.html`

```
<div class="item" *ngIf="todo">
  <div
    class="checkmark"
    [class.checked]="todo.completed"
    (click)="toggled.emit()"
  >
    {{ todo.completed ? 'âœ”' : 'ğŸ—¸' }}
  </div>
  <div
    class="content"
    [ngStyle]="{ textDecoration: todo.completed ? 'line-through' : 'none' }"
    (click)="toggled.emit()"
  >
    {{ todo.name }}
  </div>
  <div class="delete" (click)="deleted.emit()">âœ—</div>
</div> 
```

`libs/todo-ui/src/lib/todo-item/todo-item.component.ts`

```
import {
  ChangeDetectionStrategy,
  Component,
  EventEmitter,
  Input,
  Output
} from '@angular/core';
import { ListTodos_listTodos_items } from '@my/appsync';

@Component({
  selector: 'my-todo-item',
  templateUrl: './todo-item.component.html',
  styleUrls: ['./todo-item.component.css'],
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class TodoItemComponent {
  @Input() todo: ListTodos_listTodos_items;
  @Output() toggled = new EventEmitter<boolean>();
  @Output() deleted = new EventEmitter<boolean>();
} 
```

### [](#todolist-component)å¾…åŠäº‹é¡¹ç»„ä»¶

todo-list ç»„ä»¶é€šè¿‡å…ˆå‰åˆ›å»ºçš„ todo-item ç»„ä»¶å‘ˆç°æ¯ä¸ª todo é¡¹ç›®ã€‚ä¸ºäº†å¯¹è¾“å…¥åšå‡ºååº”ä»¥è¿‡æ»¤ todosï¼Œæˆ‘ä»¬ä½¿ç”¨ getters å’Œ settersã€‚ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæŒ‚é’©`ngOnChanges`åœ¨è¿™é‡Œä¹Ÿå¯ä»¥å·¥ä½œã€‚

å¯è§æ€§è¿‡æ»¤å™¨æ˜¯æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å”¯ä¸€çš„å®¢æˆ·ç«¯çŠ¶æ€ï¼Œåœ¨æˆ‘ä»¬çš„ç»„ä»¶ä¸­è¿›è¡Œç®¡ç†ã€‚AWSAppSyncClient åœ¨å¹•åä½¿ç”¨çš„ Apollo å®¢æˆ·ç«¯å°†æ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªè§„èŒƒåŒ–çš„ redux å­˜å‚¨ä¸­ã€‚

å½“æˆ‘ä»¬è€ƒè™‘æˆ‘ä»¬çš„æ¶æ„æ—¶ï¼Œæˆ‘ä»¬æœ‰è®¸å¤šé€‰æ‹©:

*   ä½¿ç”¨è¡Œä¸ºä¸»ä½“ç®¡ç†è§’åº¦æä¾›ç¨‹åºä¸­çš„çŠ¶æ€
*   ç¼–å†™æ“ä½œå’Œ reducers æ¥æ‰©å±•åº•å±‚ redux å­˜å‚¨
*   ä¸ºæˆ‘ä»¬çš„å®¢æˆ·ç«¯çŠ¶æ€ä½¿ç”¨å•ç‹¬çš„çŠ¶æ€ç®¡ç†åº“
*   æ‰©å±• Apollo å®¢æˆ·æœºä»¥ä½¿ç”¨ apollo-link-stateï¼Œå®ƒæä¾›ç”¨ GraphQL æ“ä½œæŸ¥è¯¢å’Œæ”¹å˜æœ¬åœ°çŠ¶æ€
*   ä¿æŒå®ƒåœ¨æˆ‘ä»¬çš„ç»„ä»¶ä¸­
*   ...

æ‰©å±•åº•å±‚ redux å­˜å‚¨æœ‰ç‚¹å†’é™©ï¼Œå› ä¸º AWSAppSyncClient å¯ä»¥éšæ—¶æ›´æ”¹å®ç°å†…éƒ¨ã€‚æˆ‘ä»¬ä¼šè¢«æŸä¸ªç‰ˆæœ¬å¡ä½ï¼Œæˆ–è€…éœ€è¦é‡æ„æˆ‘ä»¬çš„å®¢æˆ·ç«¯çŠ¶æ€ã€‚

å¯¹äºè¿™ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨è¡Œä¸ºä¸»é¢˜å¯èƒ½æ˜¯æœ€ç®€å•çš„ã€‚å¯¹äºé‡è¦çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä¼šä½¿ç”¨çŠ¶æ€ç®¡ç†åº“ã€‚ä½¿ç”¨ apollo-link-state æ„Ÿè§‰æ˜¯æœ€å¹²å‡€çš„è§£å†³æ–¹æ¡ˆï¼Œå°†æœ¬åœ°å’Œè¿œç¨‹çŠ¶æ€æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚

```
<!-- libs/todo-ui/src/lib/todo-list/todo-list.component.html -->
<my-todo-item
  *ngFor="let todo of visibleTodos"
  [todo]="todo"
  (toggled)="toggled.emit(todo)"
  (deleted)="deleted.emit(todo)"
></my-todo-item>
<div *ngIf="!visibleTodos || visibleTodos?.length === 0">No todos</div> 
```

```
// libs/todo-ui/src/lib/todo-list/todo-list.component.ts
import {
  ChangeDetectionStrategy,
  Component,
  EventEmitter,
  Input,
  Output
} from '@angular/core';
import { ListTodos_listTodos_items } from '@my/appsync';
import { TodoFilterType } from '../model';

@Component({
  selector: 'my-todo-list',
  templateUrl: './todo-list.component.html',
  styleUrls: ['./todo-list.component.css'],
  changeDetection: ChangeDetectionStrategy.Default
})
export class TodoListComponent {
  @Output() toggled = new EventEmitter<ListTodos_listTodos_items>();
  @Output() deleted = new EventEmitter<ListTodos_listTodos_items>();

  private _filter: TodoFilterType;
  private _todos: ListTodos_listTodos_items[];

  @Input()
  public get filter(): TodoFilterType {
    return this._filter;
  }
  public set filter(value: TodoFilterType) {
    this._filter = value;
    this.visibleTodos = this.getVisibleTodos(this.todos, value);
  }

  @Input()
  public get todos(): ListTodos_listTodos_items[] {
    return this._todos;
  }
  public set todos(value: ListTodos_listTodos_items[]) {
    this._todos = value;
    this.visibleTodos = this.getVisibleTodos(value, this.filter);
  }

  visibleTodos: ListTodos_listTodos_items[];

  private getVisibleTodos(
    todos: ListTodos_listTodos_items[],
    filter: TodoFilterType
  ) {
    switch (filter) {
      case 'SHOW_ALL':
        return todos;
      case 'SHOW_COMPLETED':
        return todos.filter(t => t.completed);
      case 'SHOW_ACTIVE':
        return todos.filter(t => !t.completed);
      default:
        return todos;
    }
  }
} 
```

æ¯å½“è¿‡æ»¤å™¨æŸ¥è¯¢æˆ–æä¾›çš„ todo å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬è®¡ç®—å¯è§çš„ todo å¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨*visible todo*ä¸­ã€‚

## [](#erroralert-component)é”™è¯¯æç¤ºç»„ä»¶

å¦‚æœå•å‡»å…³é—­æŒ‰é’®ï¼Œè¿™ä¸ªå¯é‡ç”¨çš„ç»„ä»¶ä¼šæ”¶åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯å¹¶å‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚

```
<div class="card" *ngIf="errorMessage">
  <div class="card-container">
    <div class="flex-row">
      <span class="icon">âš </span>
      <div class="msg">{{ errorMessage }}</div>
      <a class="close" (click)="closed.emit()">Ã—</a>
    </div>
  </div>
</div> 
```

```
.flex-row {
  display: flex;
  justify-content: space-between;
}
.close {
  color: var(--color-gray);
  font-size: 32px;
  cursor: pointer;
}
.msg {
  width: 100%;
  margin: 10px 2em;
}
.icon {
  color: var(--red);
  font-size: 32px;
  width: 38px;
} 
```

```
import {
  ChangeDetectionStrategy,
  Component,
  Input,
  Output,
  EventEmitter
} from '@angular/core';

@Component({
  selector: 'my-error-alert',
  templateUrl: './error-alert.component.html',
  styleUrls: ['./error-alert.component.css'],
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class ErrorAlertComponent {
  @Input() errorMessage: string | null = null;
  @Output() closed = new EventEmitter();
} 
```

## [](#watching-todos)è§‚çœ‹ todos

ç°åœ¨æˆ‘ä»¬å·²ç»æ„å»ºäº†è¡¨ç¤ºç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å›åˆ°åŒ…è£…ç»„ä»¶ï¼Œå®ƒå¤„ç†æ‰€æœ‰äº‹ä»¶ï¼Œä¸æˆ‘ä»¬çš„ API äº¤äº’å¹¶æ˜¾ç¤ºå¯èƒ½çš„é”™è¯¯ã€‚

```
// imports ...
@Component({
  selector: 'my-todo-page',
  templateUrl: './todo-page.component.html',
  styleUrls: ['./todo-page.component.css'],
  changeDetection: ChangeDetectionStrategy.Default
})
export class TodoPageComponent implements OnInit {
  todos: ListTodos_listTodos_items[];
  errorMessage: string | null = null;

  ngOnInit() {
    AppSyncClient.watchQuery<ListTodos, ListTodosVariables>({
      query: LIST_TODOS
    }).subscribe(todoList => {
      this.todos = todoList.data
        ? todoList.data.listTodos.items.sort((a, b) =>
            a.createdOnClientAt.localeCompare(b.createdOnClientAt)
          )
        : [];
    }, this.handleError);
  }

  handleError = (err: ApolloError) => {
    this.errorMessage = err.message;
  };
} 
```

æˆ‘ä»¬åœ¨ *ngOnInit* ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­å€¾å¬æˆ‘ä»¬ todos çš„ä»»ä½•å±€éƒ¨å˜åŒ–ã€‚ä¸ºæ­¤ä½¿ç”¨ *watchQuery()* ï¼Œé€šçŸ¥æˆ‘ä»¬çš„ç»„ä»¶æœ¬åœ°æ“ä½œï¼Œå¦‚æ·»åŠ æˆ–åˆ é™¤é¡¹ç›®ã€‚ä¸ºäº†ç›‘å¬è¿œç¨‹æ›´æ”¹ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ª GraphQL è®¢é˜…ã€‚å¹¸è¿çš„æ˜¯ *watchQuery()* æ˜¯é€šç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‡å®šå…ˆå‰ç”Ÿæˆçš„æŸ¥è¯¢å’Œå˜é‡ç±»å‹ã€‚è¿™åœ¨è®¢é˜…å—ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†å®Œæ•´çš„æ™ºèƒ½æ„ŸçŸ¥ï¼å¦‚æœæˆ‘ä»¬æ”¶åˆ°æ•°æ®ï¼Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯çš„ *createdOnClientAt* å±æ€§ä¸Šå¯¹å®ƒä»¬è¿›è¡Œæ’åºã€‚

> *watchQuery()* è¿”å›ä¸€ä¸ª zen-observableï¼Œè€Œä¸æ˜¯æ¥è‡ª rxjs çš„ï¼å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨è¿™é‡Œä½¿ç”¨å¼‚æ­¥ç®¡é“ã€‚æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªè½¬æ¢å™¨ï¼Œæˆ–è€…ç®€å•åœ°ä½¿ç”¨ apollo-angular æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚

è¿™é‡Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘å˜åŒ–æ£€æµ‹ã€‚å¦‚æœè¿™ä¸ªç»„ä»¶ä½¿ç”¨ OnPush ChangeDetectionStragyï¼Œæˆ‘ä»¬çš„ UI å°†ä¸ä¼šå¯¹æ¥è‡ªè¿™ä¸ªå¯è§‚å¯Ÿå¯¹è±¡çš„å˜åŒ–åšå‡ºååº”ã€‚æˆ‘ä»¬å¯ä»¥åƒä¸Šé¢ä¸€æ ·æ›´æ”¹ä¸ºé»˜è®¤ç­–ç•¥ï¼Œæˆ–è€…æ³¨å…¥*changededetorref*æ¥è°ƒç”¨è®¢é˜…å—ä¸­çš„ *markForCheck()* ã€‚

å¤§æ¦‚æ˜¯è¿™æ ·ï¼Œé‡ç‚¹æ˜¯å˜åŒ–:

```
import { ChangeDetectorRef } from '@angular/core';
// ...
@Component({
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class TodoPageComponent {
  constructor(private cd: ChangeDetectorRef) {}

  ngOnInit() {
    AppSyncClient.watchQuery<ListTodos, ListTodosVariables>({
      query: LIST_TODOS
    }).subscribe(todoList => {
      // ...
      this.cd.markForCheck();
    });
  }
} 
```

Angular çš„å¼‚æ­¥ç®¡é“ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬å¤„ç†è¿™ä¸ªé—®é¢˜ï¼

æ›´æ”¹ html æ–‡ä»¶ä¸­çš„ä¸€è¡Œï¼Œå°†æˆ‘ä»¬çš„ todo ä¼ é€’ç»™ todo-list ç»„ä»¶:

```
<my-todo-list [todos]="todos"></my-todo-list> 
```

å½“*å…³é—­*äº‹ä»¶å‘å‡º
æ—¶ï¼Œé€šè¿‡ä¼ é€’é”™è¯¯æ¶ˆæ¯å¹¶å°†å…¶è®¾ç½®ä¸º *null* æ¥ä¸é”™è¯¯è­¦æŠ¥ç»„ä»¶äº¤äº’

```
<my-error-alert
  (closed)="errorMessage = null"
  [errorMessage]="errorMessage"
></my-error-alert> 
```

## [](#creating-todos)åˆ›å»ºå¾…åŠäº‹é¡¹

è¦åœ¨æˆ‘ä»¬çš„åˆ—è¡¨ä¸­æ˜¾ç¤ºé¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„ todoã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬åœ¨ç»„ä»¶ç±»ä¸­å®ç°ä¸€ä¸ªå¤„ç†ç¨‹åºï¼Œå¹¶å‘å®ƒä¼ é€’ create-form ç»„ä»¶çš„ *created* äº‹ä»¶çš„äº‹ä»¶æœ‰æ•ˆè½½è·ã€‚

```
<my-create-form (created)="create($event)"></my-create-form> 
```

```
// ...
export class TodoPageComponent {
  // ...
  create(name: string) {
    executeMutation<CreateTodoVariables, CreateTodo_createTodo>({
      mutation: CREATE_TODO,
      variablesInfo: {
        input: {
          name,
          completed: false,
          createdOnClientAt: new Date().toISOString()
        }
      },
      cacheUpdateQuery: [LIST_TODOS],
      typename: 'Todo'
    }).catch(this.handleError);
  }
} 
```

åœ¨ä¸€æ¡è¯­å¥ä¸­å‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ã€‚æˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹ï¼

æˆ‘ä»¬è°ƒç”¨æˆ‘ä»¬çš„é€šç”¨åŠ©æ‰‹å‡½æ•° *executeMutation()* å¹¶ä¼ é€’ç»™å®ƒä¸€ä¸ªå¯¹è±¡ã€‚è¯¥å¯¹è±¡éœ€è¦ä¸‹åˆ—å±æ€§:

*   **çªå˜**:graph QL çªå˜æ“ä½œ
*   **variablesInfo** :æˆ‘ä»¬æƒ³è¦å‘é€ç»™æˆ‘ä»¬çš„ API çš„è¾“å…¥å¯¹è±¡
*   **cacheUpdateQuery** :æˆ‘ä»¬å¸Œæœ›åœ¨ç¼“å­˜ä¸­æ›´æ–°çš„æŸ¥è¯¢åˆ—è¡¨
*   **typename** :å±æ€§ *__typename* çš„å€¼

ç”±äºæˆ‘ä»¬å‘åˆ—è¡¨ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–°æ¡ç›®ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°ç¼“å­˜ä¸­çš„ *LIST_TODOS* æŸ¥è¯¢ã€‚å°±åƒæŠŠå®ƒæ·»åŠ åˆ°*çš„ cacheUpdateQuery* çš„æ•°ç»„ä¸­ä¸€æ ·ç®€å•ã€‚è¿™æ ·åšå°†è°ƒç”¨ä¸¤æ¬¡ watchQuery observableã€‚é¦–å…ˆæ˜¯ä½¿ç”¨ä¸´æ—¶ ID çš„ä¹è§‚å“åº”ï¼Œå°±åƒæˆ‘ä»¬æœŸæœ›çš„é‚£æ ·ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæˆ‘ä»¬çš„ API ä¼šåšå‡ºå“åº”ï¼Œæœ€åæ˜¯æ¥è‡ªæœåŠ¡å™¨çš„å®é™…ç»“æœã€‚

å¦‚æœæˆ‘ä»¬åœ¨å°è¯•åˆ›å»º todo æ—¶æ”¶åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªè°ƒç”¨å°†ä¸å†åŒ…å«è¿™ä¸ªæ–°çš„ todoï¼Œä»è€Œå¦å®šä¹è§‚ UI æ›´æ–°ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ­£åœ¨å¤„ç†è¿”å›æ‰¿è¯ºçš„ *catch* éƒ¨åˆ†ä¸­çš„é”™è¯¯ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬çš„é”™è¯¯è­¦å‘Šç»„ä»¶æ˜¾ç¤ºå®ƒã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç”¨æˆ·å¯ä»¥å¾—åˆ°åˆšåˆšå‘ç”Ÿçš„äº‹æƒ…çš„æç¤ºï¼Œå³ä½¿é”™è¯¯æ¶ˆæ¯æ˜¯éå¸¸æŠ€æœ¯æ€§çš„ã€‚

> æ³¨æ„ï¼Œä¸€åˆ‡éƒ½æ˜¯ç±»å‹å®‰å…¨çš„ï¼Œç”šè‡³æ˜¯ *typename* å­—ç¬¦ä¸²ï¼

## [](#updating-a-todo)æ›´æ–°å¾…åŠäº‹å®œ

ä¸ºäº†æ›´æ–° todo çš„ completed å±æ€§ï¼Œæˆ‘ä»¬ç›‘å¬ todo-list ç»„ä»¶çš„ *toggled* äº‹ä»¶ã€‚æˆ‘ä»¬å°†æœ‰æ•ˆè½½è·ä¼ é€’ç»™ *toggle()* å‡½æ•°ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ææ„å®ƒã€‚

```
<my-todo-list [todos]="todos" (toggled)="toggle($event)"></my-todo-list> 
```

```
// ...
export class TodoPageComponent {
  // ...
  toggle({
    id,
    completed,
    createdOnClientAt,
    name
  }: ListTodos_listTodos_items) {
    executeMutation<UpdateTodoVariables, UpdateTodo_updateTodo>({
      mutation: UPDATE_TODO,
      variablesInfo: {
        input: {
          completed: !completed,
          id,
          createdOnClientAt,
          name
        }
      },
      cacheUpdateQuery: null,
      typename: 'Todo'
    }).catch(this.handleError);
  }
} 
```

è¿™çœ‹èµ·æ¥éå¸¸ç±»ä¼¼äºåˆ›å»ºçªå˜ã€‚æˆ‘ä»¬æä¾›æ›´æ–°çš„é¡¹ç›®ï¼Œè¿™æ¬¡æˆ‘ä»¬ä¸éœ€è¦æ›´æ–°ç¼“å­˜ã€‚Apollo å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ç©ºæ•°ç»„ä¼ é€’ç»™ T2 çš„ cacheUpdateQueryã€‚

> ä½œä¸ºè¾“å…¥ç±»å‹ï¼Œçœ‹èµ·æ¥å¾ˆå¥‡æ€ªã€‚è¿™æ˜¯åˆ—è¡¨ä¸­æŸä¸€é¡¹çš„ç±»å‹ï¼Œä½†æˆ‘æƒ³è¿™æ˜¯æˆ‘ä»¬åœ¨è‡ªåŠ¨ç”Ÿæˆæ—¶å¿…é¡»ä»˜å‡ºçš„ä»£ä»·ï¼

## [](#deleting-a-todo)åˆ é™¤å¾…åŠäº‹é¡¹

ä¸ºäº†åˆ é™¤ todoï¼Œæˆ‘ä»¬ç›‘å¬ todo-list ç»„ä»¶çš„ *deleted* äº‹ä»¶ã€‚æˆ‘ä»¬å°†æœ‰æ•ˆè½½è·ä¼ é€’ç»™ *toggle()* å‡½æ•°ï¼Œåªææ„ *id* ã€‚

```
<my-todo-list
  [todos]="todos"
  (toggled)="toggle($event)"
  (deleted)="delete($event)"
></my-todo-list> 
```

```
// ...
export class TodoPageComponent {
  // ...
  delete({ id }: ListTodos_listTodos_items) {
    executeMutation<DeleteTodoVariables, DeleteTodo_deleteTodo>({
      mutation: DELETE_TODO,
      variablesInfo: {
        input: { id }
      },
      cacheUpdateQuery: [LIST_TODOS],
      typename: 'Todo'
    }).catch(this.handleError);
  }
} 
```

ä»åˆ—è¡¨ä¸­åˆ é™¤ä¸€ä¸ªé¡¹ç›®éœ€è¦æˆ‘ä»¬å†æ¬¡å¤„ç†ç¼“å­˜ã€‚

## [](#handling-the-filter)å¤„ç†è¿‡æ»¤å™¨

å‰©ä¸‹çš„å”¯ä¸€äº‹æƒ…å°±æ˜¯ç›‘å¬è¿‡æ»¤å™¨æ ç»„ä»¶ï¼Œå¹¶å°†å€¼ä¼ é€’ç»™ todo-list ç»„ä»¶ã€‚æˆ‘ä»¬ä»*â€˜SHOW _ ALLâ€™*å¼€å§‹ï¼Œä½†æ˜¯ä¸è¦å¯¹è¿‡æ»¤å™¨å˜é‡åšä»»ä½•å…¶ä»–äº‹æƒ…ã€‚

```
<my-filter-bar (filtered)="filter = $event"> </my-filter-bar>
<!-- ... -->
<my-todo-list
  [todos]="todos"
  [filter]="filter"
  (toggled)="toggle($event)"
  (deleted)="delete($event)"
></my-todo-list> 
```

```
filter: TodoFilterType = 'SHOW_ALL'; 
```

å°±æ˜¯è¿™æ ·ã€‚è¯·çœ‹ä¸€ä¸‹[è¿™ä¸ªå›è´­](https://github.com/BeaveArony/amplify-angular-nx-todo)çœ‹å®Œæ•´çš„æºä»£ç ã€‚

## [](#taking-it-for-a-spin)å¸¦å®ƒå…œé£

è®©æˆ‘ä»¬è·‘èµ·æ¥ï¼Œä»¥ä¾¿æœ‰æœºä¼šæ¬£èµæˆ‘ä»¬çš„ä½œå“ã€‚è¿™é‡Œæœ‰å‡ æ ·ä¸œè¥¿ä¾›ä½ ç©ç©:

*   åˆ›å»ºè‡³å°‘ä¸¤ä¸ªç”¨æˆ·ï¼ŒæŸ¥çœ‹æ¯ä¸ªç”¨æˆ·å¦‚ä½•æ‹¥æœ‰è‡ªå·±çš„å¾…åŠäº‹é¡¹
*   æ·»åŠ æ–°å¾…åŠäº‹é¡¹
*   å°è¯•å“åº”å¼ç”¨æˆ·ç•Œé¢
*   æ‰“å¼€å¼€å‘å·¥å…·ï¼Œå‹¾é€‰*ç¦»çº¿*å¤é€‰æ¡†ï¼Œåšä¸€äº›æ“ä½œï¼Œæœ€åå†æ¬¡ä¸Šçº¿ã€‚
*   æ‰“å¼€ redux dev-tools(å¦‚æœå®‰è£…çš„è¯)ï¼Œæ£€æŸ¥ redux-offline çš„ *outbox* ï¼Œapollo å®¢æˆ·ç«¯çš„ InMemoryCache çš„è§„èŒƒåŒ–å®ä½“ï¼Œä»¥åŠ redux-persist çš„è¡¥æ¶²åŠ¨ä½œ
*   çœ‹çœ‹å­˜å‚¨åœ¨ IndexedDB ä¸­çš„ä¸œè¥¿å’Œæœ¬åœ°å­˜å‚¨ä¸­çš„ JWT
*   åœ¨ *watchQuery()* ä¸­è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼Œè§‚å¯Ÿä¹è§‚å“åº”çš„ä½œç”¨
*   åœ¨ *create()* ä¸­å°†åç§°å˜é‡æ”¹ä¸º *null* ,äº«å—åˆ—è¡¨ä¸­å‘ç”Ÿçš„æ’¤é”€ä»¥åŠæ˜¾ç¤ºçš„ç²¾å½©é”™è¯¯æ¶ˆæ¯
*   é‡æ–°åŠ è½½åº”ç”¨ç¨‹åºä»¥æ¬£èµæŒä¹…ç¼“å­˜
*   ç™»å½• AWS ç®¡ç†æ§åˆ¶å°ï¼Œåˆ†æåˆ›å»ºçš„ DynamoDB è¡¨æ¡ç›®

## [](#recap)é‡è¿°

æˆ‘ä»¬ç”¨æœ‰è§’åº¦çš„ç»„ä»¶åˆ›å»ºäº†æˆ‘ä»¬çš„ UIã€‚åŒ…è£…ç»„ä»¶é€šè¿‡è¿æ¥è¡¨ç¤ºç»„ä»¶ã€ç›‘å¬ç¼“å­˜ä¸­çš„å˜åŒ–ä»¥åŠä½¿ç”¨æˆ‘ä»¬åœ¨ç¬¬ 1 éƒ¨åˆ†ä¸­è®¾ç½®çš„åŠ©æ‰‹ä¸ API å¯¹è¯æ¥åè°ƒä¸€åˆ‡ã€‚

## [](#next)æ¥ä¸‹æ¥

åœ¨[ç¬¬ 3 éƒ¨åˆ†](https://dev.to/beavearony/personal-growth-with-git-flow-and-aws-amplify-console-part-3-1f6c)ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢å¦‚ä½•ä½¿ç”¨ amplify æ§åˆ¶å°ç®€å•æ·»åŠ  CI/CD ç®¡é“ï¼Œç”šè‡³çœ‹çœ‹å¦‚ä½•æ·»åŠ ç¬¬äºŒä¸ªå‰ç«¯åº”ç”¨ç¨‹åºã€‚