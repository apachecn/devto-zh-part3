# ååº”æµ…å±‚å¿«ç…§

> åŸæ–‡:[https://dev.to/thekashey/reach-shallow-snapshot-506](https://dev.to/thekashey/reach-shallow-snapshot-506)

æ­£å¦‚æˆ‘çš„ä¸€ä¸ªæœ‹å‹æ›¾ç»è¯´è¿‡çš„ï¼Œæ¯ä¸ªç¬‘è¯ä¸­éƒ½æœ‰ä¸€ä¸ªç¬‘è¯ã€‚*å†…å¿ƒçš„ç¬‘è¯*ã€‚

è¿™æ˜¯ç›¸å½“æ·±åˆ»çš„å“²å­¦è§‚å¯Ÿï¼Œè¿™æ„å‘³ç€åŸºæœ¬ä¸Š-ä½ å¯ä»¥ä»ä¸€ä¸ªç¬‘è¯è¡ç”Ÿå‡ºå¦ä¸€ä¸ªï¼Œä½¿ç¬¬ä¸€ä¸ªæ›´æœ‰è¶£ã€‚ä½ å¯èƒ½ä¼šå‘ç°æ— ç©·æ— å°½çš„æ€è€ƒå’Œç»†å¾®å·®åˆ«ï¼Œè®©ä¸€ä¸ªå°ç¬‘è¯æˆä¸ºç°å®ã€‚

è¿™æ˜¯æˆ‘çš„ç¬‘è¯:

> ![unknown tweet media content](../Images/42007b604c160f08991938a03f644dff.png)![Mark Dalgleish profile image](../Images/ddf61c86d2313bf42901381a53c5cb5c.png)Mark Dalgleish[@ markdalgleish](https://dev.to/markdalgleish)![twitter logo](../Images/65e26e35707d96169ec8af6b3cbf2003.png)ä¿çš®è¯å¿«ç…§é…æµ…å±‚æ¸²æŸ“ã€‚2019 å¹´ 3 æœˆ 23 æ—¥ä¸Šåˆ 01:11[![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1109261285881835521)[![Twitter retweet action](../Images/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1109261285881835521)122[![Twitter like action](../Images/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1109261285881835521)592

å¬èµ·æ¥ä¸å¥½ç¬‘å—ï¼Ÿæ‰€ä»¥è®©æˆ‘ä»¬åœ¨è¿™ä¸ªç¬‘è¯ä¸­æ‰¾åˆ°ä¸€ä¸ªçœŸæ­£çš„ç¬‘è¯ï¼Œå°±åƒå®ƒæ‰€è¯´çš„é‚£æ ·â€”â€”è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‚¤æµ…çš„å¿«ç…§ï¼:)

```
import React from 'react';
import Link from 'react-router';
import Section from './section';

// const Section = ({children}) => <section><SomeStuff/>{children}</section>

describe('Mark-testing', () => {
  it('should match snapshot', () => {
    expect(shallow(<Section><Link>click me</Link></Section>)).toMatchSnapshot());    
  });
}); 
```

æˆ‘ä»¬åˆšåˆšåšäº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬æµ‹è¯•äº†ä¸€ä¸ª`skeleton`ï¼Œè¯´æ¥è¯é•¿*æ‹äº†*ï¼Œç»“æœä¼šæ˜¯....

```
<section>
  <SomeStuff />
  <Link to=\\"#\\">
    click me
  </Link> </section> 
```

> æˆ‘ä»¬ä»€ä¹ˆä¹Ÿæ²¡æµ‹è¯•ã€‚

è¿™æ˜¯*æ‰€æœŸæœ›çš„*ã€‚è¿™å°±æ˜¯æµ…å±‚æ¸²æŸ“çš„å·¥ä½œåŸç†ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹æ€§ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚ä¸€ä¸ªç†ç”±[ä¸ºä»€ä¹ˆæˆ‘æ€»æ˜¯ç”¨æµ…æ¸²æŸ“](https://hackernoon.com/why-i-always-use-shallow-rendering-a3a50da60942)ã€‚

ä½†æ˜¯...ä½ è¯´å¾—å¯¹â€”â€”é‚£ç»å¯¹æ²¡ç”¨ğŸ˜¢

> ![Mark Dalgleish profile image](../Images/ddf61c86d2313bf42901381a53c5cb5c.png)Mark Dalgleish[@ markdalgleish](https://dev.to/markdalgleish)![twitter logo](../Images/65e26e35707d96169ec8af6b3cbf2003.png)[@ gunar](https://twitter.com/gunar)æµ…å±‚æ¸²æŸ“åŸºæœ¬ä¸Šæ˜¯å¯¹ç»„ä»¶çš„è‡ªåŠ¨å˜²è®½ã€‚
> 
> ä»¥æˆ‘çš„ç»éªŒæ¥çœ‹ï¼Œå¦‚æœä½ å˜²è®½ä¸€åˆ‡ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯æ— ç”¨çš„æµ‹è¯•ã€‚23:41PM-2019 å¹´ 3 æœˆ 23 æ—¥[![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1109601176268369920)[![Twitter retweet action](../Images/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1109601176268369920)0[![Twitter like action](../Images/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1109601176268369920)0

æ‰€ä»¥- `shallow`æ— åŠ©äºå‘ç°å†…å¿ƒçš„ç©ç¬‘ã€‚é‚£å°±`mount`å§ï¼

```
describe('Mark-mount-testing', () => {
  it('should match snapshot', () => {
    expect(mount(<Section><Link>click me</Link></Section>)).toMatchSnapshot());    
  });
}); 
```

æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼ŸğŸ˜‰`Error: Uncaught [Error: Invariant failed: You should not use <Link> outside a <Router>]`

æ‰€ä»¥è®©æˆ‘ä»¬æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½æ‰“åŒ…æˆè·¯ç”±å™¨ï¼Œç„¶åé‡æ–°è¿è¡Œã€‚ç°åœ¨æˆ‘ä»¬çš„å¿«ç…§æ˜¯:

```
<StaticRouter>
  <Router history={{...}} staticContext={{...}}>
    <Section>
      <section>
        <SomeStuff>
          <div>
            Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry&#39;s standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.
          </div>
        </SomeStuff>
        <Link to=\\"#\\">
          <a onClick={[Function: onClick]} href=\\"/\\">
            click me
          </a>
        </Link>
      </section>
    </Section>
  </Router> </StaticRouter> 
```

ä½ çŸ¥é“â€”â€”è¿™æ¯”ä»¥å‰å¥½å¾—å¤šï¼Œä½†åŒæ—¶ä¹Ÿæ¯”æˆ‘é¢„æœŸçš„å¤šä¸€ç‚¹â€”â€”T2ã€‚

ä»¥æˆ‘ä¸ªäººçš„ç»éªŒï¼Œå¯¹äº StyledComponetsï¼Œæ›´å¤šçš„ç»„ä»¶å’Œæ›´æ·±çš„ç»„ä»¶ï¼Œå¿«ç…§å¯èƒ½ä¼šå¾ˆå¤§ï¼Œé™¤äº†å™ªéŸ³ä¹‹å¤–ä»€ä¹ˆä¹Ÿä¸èƒ½æä¾›ã€‚å¥¥ç‰¹åƒåœ¾ï¼

# æˆ‘ä»¬èƒ½æ‰¾åˆ°ä»‹äºä¸¤è€…ä¹‹é—´çš„ä¸œè¥¿å—ï¼Ÿ

[React æµ‹è¯•æ–¹æ³•](https://reactjs.org/docs/testing-recipes.html)ç»™å‡ºäº†ä¸€äº›è®©å¿«ç…§æµ‹è¯•æ›´å¥½çš„æç¤º:

> åšå‡ºæ›´å…·ä½“çš„æ–­è¨€é€šå¸¸æ¯”ä½¿ç”¨å¿«ç…§æ›´å¥½ã€‚è¿™ç§ç±»å‹çš„æµ‹è¯•åŒ…æ‹¬å®ç°ç»†èŠ‚ï¼Œå› æ­¤å®ƒä»¬å¾ˆå®¹æ˜“è¢«ç ´åï¼Œå¹¶ä¸”å›¢é˜Ÿå¯èƒ½å¯¹å¿«ç…§ç ´åä¸æ•æ„Ÿã€‚æœ‰é€‰æ‹©åœ°æ¨¡ä»¿ä¸€äº›å­ç»„ä»¶å¯ä»¥å¸®åŠ©å‡å°‘å¿«ç…§çš„å¤§å°ï¼Œå¹¶ä¿æŒå®ƒä»¬å¯¹ä»£ç å®¡æŸ¥çš„å¯è¯»æ€§ã€‚
> 
> åˆ°`mocking`æ—¶ï¼Œä»–ä»¬å‡è®¾`jest.mock`ï¼Œä½†æ˜¯æˆ‘å·²ç»ä¸ºä½ å‡†å¤‡äº†å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆâ€”â€”æ¨¡ä»¿**ç»„ä»¶**ï¼Œè€Œä¸æ˜¯**æ¨¡å—**ã€‚

æ˜¯çš„ï¼Œåˆ‡ä¸€å—è›‹ç³•ã€‚è®©æˆ‘ä»¬ç”¨ä¸€ä¸ª**æœ‰é™åˆ†é‡**çš„æƒ³æ³•ï¼Œæˆ‘å·²ç»åœ¨è¿™é‡Œæ·±å…¥è§£é‡Šè¿‡äº†:

[![thekashey image](../Images/638fcfb14e5c451b9d2dc31d89e5b034.png)](/thekashey) [## æœ‰é™æˆ˜äº‰

### å®‰ä¸œÂ·ç§‘å°”ç¥–è¯ºå¤« 1 æœˆ 1 æ—¥ 196 åˆ†é’Ÿé˜…è¯»

#react #testing #javascript](/thekashey/infinite-war-995)

```
import React from 'react';
import Link from 'react-router';
import { createElement, remock } from 'react-remock';
import Section from './section';

describe('Mark-finite-mount-testing', () => {
  it('should match snapshot', () => {
    remock.push();

    // replace Link by another component
    remock.mock(Link, (_, props) => createElement('router-link', props));

    expect(shallow(<Section><Link>click me</Link></Section>)).toMatchSnapshot());   
    remock.pop(); 
  });
}); 
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªæ˜¯**æ¨¡ä»¿äº†**çš„ä¸€ä¸ª`Link`ç»„ä»¶ï¼Œå»æ‰äº†å¯¹`Router`çš„ä¾èµ–ï¼Œå…¶ä½™çš„ä¿æŒä¸å˜ã€‚æ›´æ–°çš„å¿«ç…§æ˜¯:

```
<Section>
  <section>
    <SomeStuff>
      <div>
        Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry&#39;s standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.
      </div>
    </SomeStuff>
    <router-link to="#">
      click me
    </router-link>
  </section> </Section> 
```

å¹²å‡€å®Œå¥½ã€‚åªæ˜¯æ²¡æœ‰ä¸€äº›åˆ†æ”¯ï¼Œæˆ‘ä»¬**å‰ªæ‰äº†**ï¼Œè®©ä½ çš„å¿«ç…§æ›´æµ…ï¼Œä½†ä¸åƒç”¨çœŸå®çš„`shallow`é‚£æ ·æµ…ğŸ¤¯

ä½ å¯èƒ½ä¼šå˜²ç¬‘ä»»ä½•æä¾›`variable`çš„ä¸œè¥¿ï¼Œåƒæˆ‘ä¸€æ ·ï¼Œæˆ–è€…`name`ï¼Œæˆ–è€…`regexp`ã€‚æ ¹æ®éœ€è¦å‰Šå‡æˆ–æ›¿æ¢(æˆ‘ä»¬ä¿ç•™äº†ä¸€ä¸ª`Link`çš„å­©å­)ã€‚

ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ä¸€ä¸ª **FancyButton** ï¼Œå®ƒå®é™…ä¸Šæ˜¯ 2 ä¸ª`<ThemeProviders>`ã€å‡ ä¸ª`<StyledComponents>`å’Œå‡ ä¸ª`HOCs`çš„ç»„åˆã€‚

è¿™æ˜¯ç»™ä½ çš„ä¸€ä¸ªç»„ä»¶

[![Oh CRAP](../Images/d94f5b9112e45e700a47b9fc5e70914e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s---BagpePN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/48r1bz6j450d10kekf4l.png)

ä½¿ç”¨ remockï¼Œæ‚¨å¯ä»¥è®©å®ƒæˆä¸ºå¿«ç…§çš„ä¸€ä¸ªç»„ä»¶ã€‚

#### [](#ps)PS

Jest è¯­æ³•ä¸­æä¾›äº†ç¤ºä¾‹ï¼Œè€Œå¿«ç…§æ˜¯ä½¿ç”¨`mocha` + `chai-jest-snapshot`
ç”Ÿæˆçš„

```
const wrapper = mount(<Section><Link to="#">click me</Link></Section>);
expect(wrapper.debug()).to.matchSnapshot();
// ^ yes, wrapper.debug() ^ produces the best code, 
// while `.html()` or `.render` or hides some details(props) 
// you might wanna use, or generates a single line of code, 
// you will not able to review/merge. 
```

> æ‰€ä»¥ï¼Œä½ ä¸ä¼šç›¸ä¿¡ï¼Œä½†æ˜¯æœ‰é™çš„åˆ†é‡å’Œ[çš„ååº”â€”â€”remock](https://github.com/theKashey/react-remock)å¯ä»¥è®©*çš„æµ…å¿«ç…§*æˆä¸ºä¸€ä¸ªä¸œè¥¿ã€‚å¦‚æœä½ ç”¨ä¸€ä¸ª`mount`...é‚£æ˜¯ä¸ªç¬‘è¯:)

> ![unknown tweet media content](../Images/1fa56dcdb9002852ccb6fd926d0fcc16.png)![Play butt](../Images/980e9fb12d58fa9423fc94c33003fc4f.png)<video loop="" controls=""><source src="https://video.twimg.com/tweet_video/D4YvmCoU8AAwARD.mp4" type="video/mp4"></video>![Mark Dalgleish profile image](../Images/ddf61c86d2313bf42901381a53c5cb5c.png)Mark Dalgleish[@ markdalgleish](https://dev.to/markdalgleish)![twitter logo](../Images/65e26e35707d96169ec8af6b3cbf2003.png)[@ pie6k](https://twitter.com/pie6k)21:54PM-2019 å¹´ 4 æœˆ 17 æ—¥[![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1118633897460240385)

è¯„å‡ºä½œè€…çš„æœ€ä½³æ¨¡å› ã€‚æˆ‘å–œæ¬¢è¿™ä¸ªã€‚

> PS:å¦ä¸€ä¸ªâ€”â€”ä¹Ÿæœ‰ä¸€ä¸ªå…³äºä¾èµ–å˜²è®½çš„ç¬‘è¯...å¯¹äºåƒ[æ›´ä¸¥æ ¼çš„](https://github.com/stricter/stricter)è¿™ç§äº‹æƒ…æ¥è¯´æ˜¯ä¸€ç§ä¹è¶£ï¼