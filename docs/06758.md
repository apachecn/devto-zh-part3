# ä½¿ç”¨ React.memo æ›´å¿«åœ°æ¸²æŸ“

> åŸæ–‡:[https://dev . to/the johnstew/faster-renders-with-react-memo-4hi 7](https://dev.to/thejohnstew/faster-renders-with-react-memo-4hi7)

æˆ‘æ­£åœ¨è¿›å…¥`React.memo`çš„è¿™ä¸ªå¸–å­ï¼Œä»¥åŠå®ƒå¦‚ä½•è¢«ç”¨æ¥åŠ é€Ÿä¸€ä¸ª React åº”ç”¨ç¨‹åºã€‚æˆ‘å°†ä»ä¸€ä¸ªåŒ…å«ä¸€äº›æœªä¼˜åŒ–çš„ React ä»£ç çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºå¼€å§‹ã€‚ä½¿ç”¨ React Devtools Profilerï¼Œæˆ‘çš„ç›®æ ‡æ˜¯æ¼”ç¤ºå¦‚ä½•å¾®è°ƒ React åº”ç”¨ç¨‹åºï¼Œä½¿å…¶å°½å¯èƒ½å…·æœ‰é«˜æ€§èƒ½ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•å°†å…è®¸æ‚¨é€æ­¥å®Œæˆ React åº”ç”¨ç¨‹åºçš„æ¯ä¸ªéƒ¨åˆ†ï¼Œå¹¶åœ¨æ‚¨è®¤ä¸ºåˆé€‚çš„åœ°æ–¹æé«˜æ€§èƒ½ã€‚

## [](#example-app)ç¤ºä¾‹ App

[https://codesandbox.io/embed/l22p644jq7](https://codesandbox.io/embed/l22p644jq7)

è¿™ä¸ªåº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªå±äºå­ç»„çš„é¡¹ç›®çš„å¤§åˆ—è¡¨ï¼Œè¿™äº›å­ç»„å±äºæ ‡è®°ä¸º Aï¼ŒBï¼ŒC ç­‰çš„çˆ¶ç»„ã€‚æ¯ä¸ªå­ç»„ä¸­æœ‰ 15 ä¸ªé¡¹ç›®ï¼Œæ¯ä¸ªçˆ¶ç»„æœ‰ 2 ä¸ªå­ç»„ï¼Œé¡¹ç›®æ€»æ•°ä¸º 780ã€‚é‚£å¤ªå¤šäº†ã€‚

å°±åŠŸèƒ½è€Œè¨€ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­è¿›è¡Œé€‰æ‹©ã€‚å•å‡»æŸä¸ªé¡¹ç›®æ—¶ï¼Œè¯¥é¡¹ç›®åº”ä»¥çº¢è‰²çªå‡ºæ˜¾ç¤ºã€‚

## [](#baseline-app-performance)åŸºçº¿åº”ç”¨æ€§èƒ½

æ˜¯æ—¶å€™äº†è§£åº”ç”¨ç¨‹åºå½“å‰çš„è¿è¡Œæƒ…å†µäº†ã€‚ä½¿ç”¨ React Devtools Profilerï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€äº›æµ‹é‡ã€‚

[![react-memo-1](../Images/5edfc7b2b9bfad4b4413b8c2cb217f0f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Yv6bHZqH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/pgda4jsp0dftbi5nozji.gif)

ä¸Šé¢æ˜¯æ˜¾ç¤ºåº”ç”¨ç¨‹åºèŠ±è´¹æ—¶é—´çš„åˆ†æå™¨ã€‚æ¯ä¸ªæ¨¡å—éƒ½æ˜¯ä¸€ä¸ªååº”å…ƒä»¶ã€‚é¢œè‰²ä»è“è‰²åˆ°æ©™è‰²ä¸ç­‰ã€‚è“è‰²è¡¨ç¤ºå¿«ï¼Œæ©™è‰²è¡¨ç¤ºæ…¢ã€‚

ä¸Šé¢ä½ è¿˜å¯ä»¥çœ‹åˆ°ï¼Œæ¯å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªç»„ä»¶è¿›è¡Œæ›´æ–°æ—¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½åœ¨åšä¸€äº›äº‹æƒ…ã€‚æˆ‘ä»¬åªæƒ³æ›´æ–°æˆ‘ä»¬æ­£åœ¨æ“ä½œçš„å•ä¸ªç»„ä»¶æˆ–è€…åˆ°é‚£ä¸ªå•ç‹¬ç»„ä»¶çš„ç»„ä»¶è·¯å¾„ã€‚

æœ€åï¼Œåœ¨å³è¾¹ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªå«åš`Render duration`çš„æŒ‡æ ‡ã€‚æˆ‘ä»¬å°è¯•æ›´æ–°çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ä½¿ç”¨äº†`55.5ms`æ¥è®© React å°†æ›´æ”¹æäº¤ç»™ DOMã€‚

## [](#reactmemo)React.memo

åœ¨ç¤ºä¾‹ä¸­ï¼ŒReact å¤„ç†æ‰€æœ‰ç»„ä»¶å¹¶é€‰æ‹©åˆ—è¡¨ä¸­çš„å•ä¸ªé¡¹ç›®ï¼Œè¿™æ„å‘³ç€åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ779 ä¸ªé¡¹ç›®ä¿æŒä¸å˜ã€‚React ä¸ºè¿™ç§ç”¨ä¾‹å…¬å¼€äº†`React.memo`ã€‚

```
import React from "react";

function Item({ item, selectItem, group, subgroup }) {
  return (
    <div
      className={`item${item.selected ? " item--selected" : ""}`}
      onClick={() => selectItem(group, subgroup, item.id)}
    >
      <div className="item-img">
        <img src="https://placehold.it/64x64" />
      </div>
      <span>{item.name}</span>
    </div>
  );
}

const MemoItem = React.memo(Item, (prevProps, nextProps) => {
  if (prevProps.item.selected === nextProps.item.selected) {
    return true;
  }
  return false;
});

export default MemoItem; 
```

ä¸Šé¢æ˜¯`Item`ç»„ä»¶ã€‚åœ¨åº•éƒ¨ï¼Œå®ƒå·²ç»è¢«æ›´æ–°ä¸ºå¯¼å‡ºä¸€ä¸ªè®°å¿†ç‰ˆæœ¬çš„`Item`ç»„ä»¶ã€‚å‡½æ•°ç­¾åçœ‹èµ·æ¥åƒè¿™æ ·`React.memo(MyReactComponent, compareFn(prevProps, nextProps))`ã€‚åœ¨æ¯”è¾ƒåŠŸèƒ½ä¸­ï¼Œæ‚¨å‘Šè¯‰ React ç»„ä»¶æ˜¯å¦ç›¸åŒ(`true`)æˆ–ä¸åŒ(`false`)ã€‚

æ—¶é—´æ¥è¡¡é‡ã€‚

[![react-memo-2](../Images/4b453549bc4367e13b73015e5f398a0d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--3dX-t3Xs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/i8pyu1jhcpjq9c69zvwn.gif)

ä»€ä¹ˆå˜äº†ï¼Ÿæ¸²æŸ“æŒç»­æ—¶é—´ç°åœ¨åœ¨`14.7ms`ğŸ‘ã€‚è¿›ä¸€æ­¥æ·±å…¥ç»„ä»¶ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„`Item`ç»„ä»¶ç°åœ¨éƒ½æ˜¯ç°è‰²çš„ï¼Œé™¤äº†è¿›è¡Œäº†æ›´æ”¹çš„ç»„ä»¶ã€‚é‚£å°±æ›´æ¥è¿‘ç›®æ ‡äº†ï¼

ä¸å¹¸çš„æ˜¯ï¼Œä»ç„¶æœ‰ä¸å¿…è¦çš„é¢å¤–å¤„ç†è¦åšã€‚å½“åªæœ‰ä¸€ä¸ªç»„ä»¶è¢«æ›´æ–°æ—¶ï¼Œæ¯ä¸ªç»„ä»¶ä»ç„¶åœ¨å·¥ä½œã€‚å›åˆ°`React.memo`ã€‚

```
import React from "react";
import Item from "./Item";

function ItemGroup({ items, selectItem, group }) {
  return (
    <div className="item-group">
      <div className="item-group--a">
        {items.SUB_GROUPA.items.map(item => (
          <Item
            group={group}
            subgroup={"SUB_GROUPA"}
            key={`item-${item.id}`}
            item={item}
            selectItem={selectItem}
          />
        ))}
      </div>
      <div className="item-group--b">
        {items.SUB_GROUPB.items.map(item => (
          <Item
            group={group}
            subgroup={"SUB_GROUPB"}
            key={`item-${item.id}`}
            item={item}
            selectItem={selectItem}
          />
        ))}
      </div>
    </div>
  );
}

const MemoItemGroup = React.memo(ItemGroup, (prevProps, nextProps) => {
  if (prevProps.updatedAt === nextProps.updatedAt) {
    return true;
  }
  return false;
});

export default MemoItemGroup; 
```

ä¸Šé¢åŒ…å«äº†å¤„ç†æ¯ç»„é¡¹ç›®çš„`ItemGroup`ç»„ä»¶ã€‚é»˜è®¤çš„å¯¼å‡ºç°åœ¨æ˜¯`ItemGroup`çš„è®°å¿†åŒ–ç‰ˆæœ¬ï¼Œå®ƒåŒ…å«äº†`updatedAt`æ—¶é—´æˆ³å˜é‡ä¹‹é—´çš„æ¯”è¾ƒã€‚

[![react-memo-3](../Images/76db4cac067ddecaebcfac5cda00b98a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s---0YYSVSa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8ssaqcgzwm7it676weq7.gif)

ç»è¿‡æœ€åä¸€æ¬¡ä¿®æ”¹ï¼Œæ¸²æŸ“æŒç»­æ—¶é—´ç°åœ¨æ˜¯`4.3ms`ï¼ğŸš€

## [](#thoughts)æ€æƒ³

å¯ä»¥å¯¹é“å…·è¿›è¡Œä»»ä½•ç±»å‹çš„æ¯”è¾ƒã€‚æˆ‘å°è¯•ä½¿ç”¨å¸ƒå°”å€¼å’Œæ•°å­—(æ—¶é—´æˆ³),å› ä¸ºä¸æ¯”è¾ƒå¯¹è±¡ç›¸æ¯”ï¼Œå®ƒä»¬ä¼¼ä¹æ›´å®¹æ˜“å¤„ç†ã€‚

æ‰€æœ‰è¿™äº›ä¸­çš„å¦ä¸€ä¸ªé‡è¦éƒ¨åˆ†æ˜¯åœ¨é¡¹ç›®é›†åˆä¸Šæ­£ç¡®ä½¿ç”¨é”®ã€‚æˆ‘è‰°éš¾åœ°å‘ç°è¿™æœ‰å¤šé‡è¦ã€‚æ‰€ä»¥è¯·ç¡®ä¿è¿™äº›è®¾ç½®æ­£ç¡®ã€‚

æœ€åï¼ŒReact Devtools Profiler æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ React åº”ç”¨ã€‚æˆ‘ä»¬ç»å¸¸è¢«è¿«èµ¶åœ¨æˆªæ­¢æ—¥æœŸå‰å®Œæˆä»»åŠ¡ï¼Œå‰Šå‡æ€§èƒ½æŒ‡æ ‡ã€‚å¦‚æœå¯ä»¥çš„è¯ï¼ŒèŠ±å‡ å¤©æ—¶é—´è¯•ç€æ·±å…¥ç†è§£ React åº”ç”¨çš„å„ä¸ªéƒ¨åˆ†ï¼Œè¯•ç€æ‰¾å‡ºåœ¨å“ªé‡Œåˆ›å»ºæ¸²æŸ“çš„å¿«é€Ÿè·¯å¾„ã€‚

## [](#links)é“¾æ¥

*   [React.memo](https://reactjs.org/docs/react-api.html#reactmemo)
*   [Codesandbox ç¤ºä¾‹ 1 (No Reactã€‚å¤‡å¿˜å½•)](https://codesandbox.io/s/l22p644jq7?fontsize=14)
*   [Codesandbox ç¤ºä¾‹ 2 (React.memo)](https://codesandbox.io/s/yj8yj60r2x?fontsize=14)

æœ€åˆå‘å¸ƒåœ¨æˆ‘çš„åšå®¢ä¸Šï¼Œåœ°å€ä¸º [johnstewart.io](https://bit.ly/2Dcsu4c) ã€‚