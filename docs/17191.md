# Ruby & AWS Lambdaï¼ŒğŸ’–æœ€å¥½çš„æœ‹å‹ğŸ’–

> åŸæ–‡:[https://dev.to/codegram/ruby-aws-lambda-bff-6mf](https://dev.to/codegram/ruby-aws-lambda-bff-6mf)

*æœ€åˆå‘è¡¨äº [Codegram çš„åšå®¢](https://www.codegram.com/blog/ruby-lambda-bff)T3ã€‘*

ä½œä¸ºä¸€ä¸ª Codegram çš„æ— æœåŠ¡å™¨çˆ±å¥½è€…ï¼Œè‡ªä» AWS Lambda å¼•å…¥äº†å¯¹ Ruby çš„å®˜æ–¹æ”¯æŒä»¥æ¥ï¼Œæ˜¯æ—¶å€™å‘è¡¨ä¸€ç¯‡æ–°çš„åšæ–‡äº†ğŸ‰ã€‚

ä½ å¯ä»¥åœ¨[å®˜æ–¹å‘å¸ƒçš„åšå®¢æ–‡ç« ](https://aws.amazon.com/blogs/compute/announcing-ruby-support-for-aws-lambda/)ä¸­é˜…è¯»æ›´å¤šå†…å®¹ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸€ä¸ªã€Sinatra åº”ç”¨ç¨‹åºçš„ä¾‹å­ã€‚å¦‚æœä½ æƒ³å¯¹ä¾‹å­å’Œå‘å¸ƒè¿›è¡Œæ·±å…¥çš„è¯„è®ºï¼Œæˆ‘æ¨è[è¿™ç¯‡æ¥è‡ª EquiValent çš„ç²¾å½©è¯„è®º](https://blog.eq8.eu/article/sinatra-on-aws-lambda.html)ã€‚

å¾—çŸ¥æˆ‘ç»ˆäºå¯ä»¥å°† Ruby ä¸ Lambda ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæˆ‘éå¸¸æ¿€åŠ¨ï¼Œä½†æ˜¯ç”¨ Sinatra ä½œä¸ºä¾‹å­æ„Ÿè§‰æ˜¯é”™è¯¯çš„ã€‚å¦‚æœæ‚¨æƒ³ç”¨å®ƒæ„å»ºä¸€ä¸ª APIï¼Œæ‚¨ä¼šå¸Œæœ›è®© API Gateway å®Œæˆæ‰€æœ‰çš„è·¯ç”±å’Œè¯·æ±‚å¤„ç†ã€‚æ·»åŠ ä¸€ä¸ªé¢å¤–çš„å±‚æ¥åœ¨åº”ç”¨ç¨‹åºçº§åˆ«åšåŒæ ·çš„äº‹æƒ…æ˜¯ä¸å¿…è¦çš„ï¼Œå¹¶ä¸”ä¼¼ä¹æ˜¯ä¸€ç§åæ¨¡å¼(æˆ‘çŸ¥é“å®ƒè¢«ç”¨ä½œè¿ç§»å¾®æœåŠ¡çš„ç¤ºä¾‹ï¼Œä½†å®ƒä»ç„¶ä»¤äººå›°æƒ‘)ã€‚

* * *

åœ¨ä¸æˆ‘çš„ç¨‹åºå‘˜åŒäº‹è®¨è®ºåï¼Œæˆ‘å†³å®šç”¨ Ruby å’Œ Lambda æ„å»ºä¸€ä¸ªå°å‹çš„æ¦‚å¿µéªŒè¯ GraphQL APIï¼Œä½¿ç”¨[æ— æœåŠ¡å™¨](https://serverless.com)æ¥ç®€åŒ–éƒ¨ç½²å’ŒåŸºç¡€è®¾æ–½ï¼Œæ²¡æœ‰ Sinatraã€Rack æˆ–ä»»ä½•æ ·æ¿æ–‡ä»¶ã€‚

ç›®æ ‡æ˜¯è¯æ˜æ‚¨å¯ä»¥æ„å»ºä¸€ä¸ª APIï¼Œå¹¶ä¸”å‡ ä¹å¿˜è®°æ‚¨å®é™…ä¸Šæ˜¯åœ¨å¤„ç† web è¯·æ±‚ï¼Œåªéœ€å…³æ³¨ GraphQL æ¨¡å¼å’Œä¸šåŠ¡é€»è¾‘ã€‚å®ƒçœ‹èµ·æ¥æ€ä¹ˆæ ·ï¼Ÿæœ‰ä¸‰ä¸ªå…³é”®å…ƒç´ : ***serverless.yml*** é€šè¿‡ HTTP POST å…¬å¼€æˆ‘ä»¬çš„å‡½æ•°:

```
service: serverless-ruby-graphql

provider:
  name: aws
  runtime: ruby2.5
  region: eu-west-1
  stage: dev

functions:
  api:
    handler: app.request
    events:
      - http:
          path: api
          method: post

plugins:
  - serverless-hooks-plugin

custom:
  hooks:
    package:initialize:
      - bundle install --deployment
    deploy:finalize:
      - rm -fr .bundle
      - rm -fr vendor
      - bundle install 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

***app.rb*** å¤„ç†ä¼ å…¥çš„è¯·æ±‚ï¼Œå¹¶å°†æ‰€æœ‰å·¥ä½œå§”æ‰˜ç»™ GraphQL Ruby:

```
require 'json'
require_relative "app/graphql/schema"

def request(event:, context:)
  puts "Received Request: #{event}"

  body = Schema.execute(event["body"]).to_json

  {
    statusCode: 200,
    body: body
  }
rescue StandardError => e
  puts e.message
  puts e.backtrace.inspect

  {
    statusCode: 400,
    body: JSON.generate("Bad request, please POST a request body!")
  }
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œ ***app/*** ä¸€ä¸ªåŒ…å«æ‰€æœ‰ GraphQL æ¨¡å¼å’Œæ¨¡å‹çš„æ–‡ä»¶å¤¹:

[https://github . com/oriolgual/server less-ruby-graph QL/tree/master/app](https://github.com/oriolgual/serverless-ruby-graphql/tree/master/app)

è™½ç„¶è¿™æ ·åšæ²¡é—®é¢˜ï¼Œä½†è¯·è®°ä½ï¼Œè¿™ä¸æ˜¯ç”Ÿäº§å°±ç»ªä»£ç ã€‚

## è®©æˆ‘ä»¬ç”¨ Lambda æ„å»ºä¸€åˆ‡

[![](../Images/8c713ca583e4851be06ff8c2f2d378b6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ZQIavaLx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/q5p5yd19rvspce1wyxnf.jpg)

å—¯ï¼Œä¹Ÿè®¸ä¸æ˜¯ã€‚ç”¨ AWS Lambda å’Œ Ruby æ„å»ºä¸œè¥¿å¾ˆç®€å•ï¼Œä½†æ˜¯æˆ‘ä¼šç”¨å®ƒæ¥æ„å»ºæˆ‘çš„ä¸‹ä¸€ä¸ª GraphQL API å—ï¼Ÿå¤§æ¦‚ä¸ä¼šã€‚

æˆ‘å¹¶ä¸å®Œå…¨èµåŒå°† AWS Lambda ä¸é¢å‘ç”¨æˆ·çš„ API ç»“åˆä½¿ç”¨ï¼›å“åº”æ—¶é—´å¤ªä¸å¯é¢„æµ‹ï¼Œè€Œä¸”ç›¸å½“é«˜(æ˜¯çš„ï¼Œå³ä½¿ä½ è®©ä½ çš„ Lambdas [ä¿æŒæ¸©æš–](https://serverless.com/blog/keep-your-lambdas-warm/))ã€‚å¦‚æœæ‚¨çš„ lambda éœ€è¦è®¿é—® vpc å†…éƒ¨çš„èµ„æº(ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è¦è®¿é—®æ•°æ®åº“ï¼Œè¿™æ˜¯å¿…éœ€çš„)ï¼Œäº‹æƒ…ä¼šå˜å¾—[ç”šè‡³]([https://www . robertvojta . com/AWS-journey-API-gateway-Lambda-VPC-performance/](https://www.robertvojta.com/aws-journey-api-gateway-lambda-vpc-performance/))[æ›´æ…¢](https://www.reddit.com/r/aws/comments/6lfubn/aws_lambda_vpc_redis_slow/)ã€‚

æˆ‘çœŸçš„å¾ˆå–œæ¬¢ Lambdaï¼Œä½†æˆ‘è®¤ä¸ºå®ƒåœ¨ç”¨äºå“åº”äº‹ä»¶(å¦‚ S3 ä¸Šä¼ æˆ– Kinesis æµ)æ—¶ä¼šå¤§æ”¾å¼‚å½©ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¸ä¼šçœŸçš„å…³å¿ƒä¸€äº›é¢å¤–çš„å»¶è¿Ÿï¼Œä½†å¯ä¼¸ç¼©æ€§å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚

æˆ‘æ¸´æœ›å°è¯•ä¸ [Knative](https://github.com/knative/docs/) ã€ [Kubeless](https://kubeless.io) æˆ– [OpenWhisk](https://openwhisk.apache.org) ç±»ä¼¼çš„ä¸œè¥¿ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘åªä½¿ç”¨äº† AWS Lambdaï¼Œæˆ‘æƒ³å°†å®ƒä¸å…¶ä»–è§£å†³æ–¹æ¡ˆè¿›è¡Œæ¯”è¾ƒï¼Œå¹¶æ›´å¥½åœ°äº†è§£å®ƒæ˜¯å¦æ˜¯éƒ¨ç½²æ— æœåŠ¡å™¨ã€é¢å‘ç”¨æˆ·çš„ API çš„å¥½é€‰æ‹©ã€‚