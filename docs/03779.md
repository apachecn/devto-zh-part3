# JavaScript ä¸­çš„é”™è¯¯ä»¥åŠå¦‚ä½•é¿å…è¿™ç§å¸¸è§é”™è¯¯

> åŸæ–‡:[https://dev . to/michi/iifes-in-JavaScript-and-how-avoid-this-common-error-5b0e](https://dev.to/michi/iifes-in-javascript-and-how-to-avoid-this-common-error-5b0e)

> æœ€åˆå‘å¸ƒäº[michaelzanggl.com](https://michaelzanggl.com/articles/javascript-iifes)ã€‚è®¢é˜…[æˆ‘çš„ç®€è®¯](https://michaelzanggl.com/)æ°¸è¿œä¸è¦é”™è¿‡æ–°å†…å®¹ã€‚

ç”±äº JavaScript è¿˜ä¸æ”¯æŒé¡¶çº§ç­‰å¾…ï¼Œå…¸å‹çš„èŠ‚ç‚¹ç´¢å¼•æ–‡ä»¶å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·

```
const http = require('http')

(async () => {
  // await ...
})() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬éœ€è¦ http åº“ï¼Œç„¶åæœ‰ä¸€ä¸ªç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼(IIFE ),è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¼‚æ­¥ awaitã€‚

ä½¿ç”¨ IIFEsï¼Œæˆ‘ä»¬ç¼–å†™å‡½æ•°å¹¶ç«‹å³æ‰§è¡Œå®ƒä»¬ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‡½æ•°ä¸­å‘ç”Ÿçš„ä¸€åˆ‡éƒ½åœç•™åœ¨å‡½æ•°å†…éƒ¨ï¼Œè€Œä¸èƒ½ä»å‡½æ•°å¤–éƒ¨è®¿é—®ã€‚è¿™ä¹Ÿæ˜¯åˆ°ç›®å‰ä¸ºæ­¢åœ¨é¡¶å±‚ä½¿ç”¨ await çš„ç¬¬**ç§æ–¹å¼ã€‚**

# [](#problem)é—®é¢˜

æˆ‘ç¡®ä¿¡ä½ ä»¬ä¸­çš„è®¸å¤šäººå·²ç»æ‰è¿›äº†è¿™ä¸ªé™·é˜±ï¼Œå› ä¸ºä¸Šé¢çš„ä»£ç å®é™…ä¸Šå·²ç»å´©æºƒäº†ã€‚

> `Uncaught TypeError: require(...) is not a function`

å´©æºƒçš„åŸå› æ˜¯å› ä¸º JavaScript è¯•å›¾æ‰§è¡Œè¿™ä¸ª(å°è¯•åœ¨ä½ çš„ç¼–è¾‘å™¨ä¸­æ ¼å¼åŒ–ä¸Šé¢çš„ä»£ç ä»¥è·å¾—ç›¸åŒçš„ç»“æœ)

```
const http = require('http')(async () => {
  // ...
})() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒæœŸæœ›`require`æ–¹æ³•è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­æˆ‘ä»¬ä¼ é€’ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œç„¶åæˆ‘ä»¬æ‰§è¡Œè¿™ä¸ªå‡½æ•°çš„ç»“æœã€‚ğŸ¤¯

å½“ä½ æœ‰ä¸¤ä¸ªè¿ç»­çš„ç”Ÿå‘½æ—¶ï¼Œè¿™ä¸ªé”™è¯¯å°±å˜å¾—ç‰¹åˆ«éš¾ä»¥æ•æ‰ã€‚

> `Uncaught TypeError: (intermediate value)(...) is not a function`

# [](#common-workarounds)å¸¸è§å˜é€šåŠæ³•

æœ‰ä¸€äº›å¸¸è§çš„è§£å†³æ–¹æ³•ï¼Œéƒ½æ˜¯å‘Šè¯‰ JavaScript ç”Ÿæ´»ç¡®å®æ˜¯ä¸€ç§æ–°çš„é™ˆè¿°ï¼Œæœ€è‘—åçš„æ˜¯

```
const http = require('http')

void (async () => { // < note the void at the beginning

})() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ–è€…

```
const http = require('http'); // < note the semicolon

(async () => {

})() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç”šè‡³

```
const http = require('http')

!(async () => { // < note the exclamation mark

})() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#labels)æ ‡ç­¾

ä¸Šè¿°è§£å†³æ–¹æ³•å¹¶ä¸æ–°é²œï¼Œä½†è¿™é‡Œæœ‰ä¸€äº›ä½ å¯èƒ½è¿˜æ²¡è§è¿‡çš„ä¸œè¥¿ã€‚

```
const http = require('http')

IIFE: (async () => {

})() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ˜¯çš„ï¼Œæ ‡ç­¾ä¹Ÿå¯ä»¥ã€‚æ‚¨å¯ä»¥åœ¨ä»»ä½•è¯­å¥å‰æ”¾ç½®æ ‡ç­¾ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œåªè¦ç¬¦åˆè¯­æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•ä¸œè¥¿æ›¿æ¢`IIFE`ã€‚å¦‚æœå®ƒä½œä¸ºä¸€ä¸ªå˜é‡åï¼Œå®ƒå°±ä½œä¸ºä¸€ä¸ªæ ‡ç­¾æ ‡è¯†ç¬¦ã€‚

```
ä¸€ã‹å…«ã‹: 1 + 1 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[æ ‡ç­¾](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/label)å…¶å®æŒºæœ‰æ„æ€çš„ã€‚è¯·çœ‹ä¸‹é¢æ‘˜è‡ª MDN çš„ä»£ç ç‰‡æ®µã€‚

```
foo: {
  console.log('this will be executed');
  break foo;
  console.log('this will not be executed');
}
console.log('this will be executed as well'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#conclusion)ç»“è®º

ç”±äºæ ‡ç­¾å¹¶ä¸å¹¿ä¸ºäººçŸ¥ï¼ŒåšæŒä½¿ç”¨åˆ†å·æˆ– void å¯èƒ½æ›´å¥½ï¼Œä½†è¿™ä»ç„¶å¾ˆæœ‰è¶£ã€‚æˆ‘å–œæ¬¢ä»–ä»¬ç»™ç”Ÿæ´»æ·»åŠ ä¸€äº›æ–‡æ¡£ã€‚å¥½å§ï¼Œè®©æˆ‘ä»¬å†ç­‰ä¸€ä¼šå„¿æœ€é«˜çº§åˆ«çš„ç­‰å¾…ã€‚