# å¦‚ä½•åœ¨å›¾åƒä¸Šåˆ¶ä½œåŠ¨æ€æ–‡æœ¬å åŠ 

> åŸæ–‡:[https://dev . to/xenox dev/how-to-make-dynamic-text-overlays-on-images-DCC](https://dev.to/xenoxdev/how-to-make-dynamic-text-overlays-on-images-dcc)

å¦‚æœä½ æ›¾ç»åšè¿‡ webappï¼Œä½ ä¸€å®šå¯¹è¿™ä¸ªåœºæ™¯å¾ˆç†Ÿæ‚‰ã€‚å¾ˆå¤šæ—¶å€™ï¼Œä½ ä¼šå‘ç°è‡ªå·±å¤„äºè¿™æ ·ä¸€ç§æƒ…å†µï¼Œä½ ä¸å¾—ä¸æŠŠä¸€äº›æ–‡å­—æ”¾åœ¨å›¾ç‰‡ä¸Šã€‚å¦‚æœå›¾ç‰‡æ˜¯ç”±ç”¨æˆ·ä¸Šä¼ çš„ï¼Œé‚£ä¹ˆå¾ˆéš¾é¢„æµ‹å›¾ç‰‡ä¼šé…ä»€ä¹ˆé¢œè‰²çš„æ–‡å­—ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­:

[![](../Images/f942ec22d14fb03d23064ae01a6a9998.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--BChnM00u--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/hUikRsI.png)

æ–‡æœ¬ *Rachel Rose* åœ¨æ·±è‰²èƒŒæ™¯ä¸‹çœ‹èµ·æ¥å¾ˆå®Œç¾ï¼Œä½†æ˜¯å¦‚æœèƒŒæ™¯æ˜¯ç™½è‰²çš„å‘¢ï¼Ÿè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºä½ æ°¸è¿œæ— æ³•é¢„æµ‹ç”¨æˆ·ä¼šä¸Šä¼ ä»€ä¹ˆã€‚

ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•æ˜¯åœ¨å›¾åƒä¸Šä½¿ç”¨æ¨¡ç³Šæ»¤é•œï¼Œå°±åƒè¿™æ ·...

```
 .image-blur{
        filter: blur(1px);
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

...æˆ–è€…åœ¨å›¾åƒä¸Šåšä¸€ä¸ªæš—è¦†ç›–ã€‚æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥åšåˆ°ï¼Œå®ƒä»¬éƒ½ä¾èµ–äºå¯¹å›¾åƒè¿›è¡Œä¿®æ”¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¸æ”¹å˜å›¾åƒï¼Œè€Œæ˜¯æ”¹å˜æ–‡æœ¬çš„é¢œè‰²å‘¢ï¼Ÿ

â€œå—¯ï¼Œä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿâ€è¿™æ˜¯æˆ‘æœ€è¿‘æœ‰è¿™ç§æƒ³æ³•æ—¶å‘Šè¯‰è‡ªå·±çš„ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­æ¢ç´¢å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚

[![](../Images/7c90ee3ac02e498faba08ff95aa2555d.png)T2ã€‘](https://i.giphy.com/media/xT0xemNCRU4TRrGDAI/giphy.gif)

### [](#how-to-do-it)æ€ä¹ˆåšï¼Ÿ

æˆ‘åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„é¡µé¢æ¥æ¼”ç¤ºè¿™ä¸ªé—®é¢˜ã€‚å¦‚æœä½ æƒ³è¾¹å­¦è¾¹åšï¼Œå°±å¤åˆ¶è¿™ä¸ªå›è´­ã€‚

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png) [å·¥è‰ºå­¦](https://github.com/sarthology) / [åŠ¨æ€æ¼”ç¤º](https://github.com/sarthology/dynalay-demo)

### å¦‚ä½•åœ¨å›¾åƒä¸Šå åŠ ä¸€ä¸ªåŠ¨æ€æ–‡æœ¬

<article class="markdown-body entry-content container-lg" itemprop="text">[![](../Images/0afc1c7793173a3477d8ef79ba3b3f15.png)](https://camo.githubusercontent.com/de66b3305b0d2ba249b3e0d032a9ada2df582e219af74b2b34d9c0f0716077bb/68747470733a2f2f692e696d6775722e636f6d2f503432655066702e706e67)

## Dynalay æ¼”ç¤º

ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œä½¿ä¸€ä¸ªåŠ¨æ€çš„æ–‡å­—è¦†ç›–åœ¨å›¾åƒä¸Šã€‚[æŸ¥çœ‹æ­¤å¤„](https://sarthology.github.io/dynalay-demo/)

## å±å¹•ä¸Šæ˜¾ç¤ºç¨‹åºè¿è¡Œçš„å›¾ç‰‡

[![](../Images/6f870de809105c3209330d567aff5af2.png)](https://camo.githubusercontent.com/66f9523d578ec5610a3a01faf63a8e48f940be3ff83a640dbb1ee3105297d9d5/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f70726163746963616c6465762f696d6167652f66657463682f732d2d5232736b6d3353702d2d2f635f6c696d6974253243665f6175746f253243666c5f70726f6772657373697665253243715f3636253243775f3838302f68747470733a2f2f74686570726163746963616c6465762e73332e616d617a6f6e6177732e636f6d2f692f68746f7166733563736d7970386f3667773875672e676966)

## å…ˆå†³æ¡ä»¶

åœ¨æœ¬åœ°è¿è¡Œä¹‹å‰ï¼Œæ‚¨å¿…é¡»å®‰è£…è¿™äº›ç¨‹åº

*   ç»“èŠ‚
*   ç½‘ç»œåŒ…

## å®‰è£…

å®ƒå†…ç½®äºèŠ‚ç‚¹ä¸­ï¼Œå› æ­¤å¯åŠ¨è¿‡ç¨‹éå¸¸ç®€å•

1.  `npm install`
2.  `npm run start:dev`

å°±æ˜¯è¿™æ ·ï¼Œæ‚¨å°†çœ‹åˆ°å®ƒåœ¨ localhost:8080 ä¸Šè¿è¡Œ

## è´¡çŒ®çš„

è¯·éšæ„å‚ä¸è¿™ä¸ªé¡¹ç›®ï¼Œå¹¶åƒå¯¹å¾…è‡ªå·±çš„é¡¹ç›®ä¸€æ ·å¯¹å¾…å®ƒã€‚<g-emoji class="g-emoji" alias="blush" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f60a.png">ğŸ˜Š</g-emoji>

## ä½œè€…

è¨å°”å¡”å…‹Â·å¤å°”é©¬

</article>

[View on GitHub](https://github.com/sarthology/dynalay-demo)

å…‹éš†å®Œæˆåï¼Œä½¿ç”¨è¿™ä¸ªæäº¤æ¥æ£€æŸ¥æœªè§£å†³çš„é—®é¢˜ã€‚

```
 git checkout 0817434   
   npm install npm run start:dev 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥ç›®å‰ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç½‘é¡µï¼Œæœ‰ä¸¤ç§ç±»å‹çš„èƒŒæ™¯:é»‘æš—å’Œå…‰æ˜ã€‚å®ƒè¿˜æœ‰ä¸¤ä¸ªæŒ‰é’®å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´åˆ‡æ¢ã€‚è¿™æ˜¯å®ƒå¼€å§‹æ—¶çš„æ ·å­ã€‚

[![](../Images/b20942f24fcb7aa0f51d3d5829e424ce.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--MoWgzEpx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hwp2buzhp7c1wb8nkjog.gif)

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç”»å¸ƒã€‚æƒ³æ³•æ˜¯åœ¨ç”»å¸ƒä¸­åŠ è½½å›¾åƒï¼Œç„¶åæˆ‘ä»¬å°†è·å–å›¾åƒçš„æ¯ä¸ªåƒç´ ã€‚ç„¶åæ¯ä¸ªåƒç´ çš„é¢œè‰²å°†è¢«è½¬æ¢æˆå®ƒçš„ *RGB* å€¼ã€‚æ‰€ä»¥å¦‚æœä½ å¹³å‡è¿™ä¸‰ä¸ªå€¼ï¼Œä½ ä¼šå¾—åˆ°é‚£ä¸ªåƒç´ çš„äº®åº¦(åœ¨è¿™é‡Œé˜…è¯»æ›´å¤š)ã€‚è¿™äº›å€¼å°†ä»‹äº 0(æœ€æš—)å’Œ 255(æœ€äº®)ä¹‹é—´ã€‚å› æ­¤ï¼Œé€šè¿‡å¯¹æ¯ä¸ªåƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œæˆ‘ä»¬å°†å¾—åˆ°å›¾åƒæ˜¯å¦æš—ã€‚

å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬ç†è§£äº†ç®—æ³•ï¼Œè®©æˆ‘ä»¬å†™ä¸€äº›ä»£ç ã€‚
[![](../Images/498b144e0cc4f624cb50b62609614e1a.png)T3ã€‘](https://i.giphy.com/media/CFoV7AtVdp1sc/giphy.gif)

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå°† src ä»åå°åŠ è½½åˆ°ä¸€ä¸ªéšè—çš„`img`å…ƒç´ ä¸­ã€‚

```
 const isDark = (src)=>{
        //create a hidden img element
        let img = document.createElement("img");
        img.src = src;
        img.style.display = "none";
        document.body.appendChild(img);
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åä½¿ç”¨
åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶å›¾åƒ

```
const isDark = (src)=>{

    //create a hidden img element
    let img = document.createElement("img");
    img.src = src;
    img.style.display = "none";
    document.body.appendChild(img);

    img.onload = function() {
        // create canvas
        let canvas = document.createElement("canvas");
        canvas.width = this.width;
        canvas.height = this.height;

        let ctx = canvas.getContext("2d");
        ctx.drawImage(this,0,0);
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬éœ€è¦å¾—åˆ°æ¯ä¸ªåƒç´ çš„ RGB å€¼ã€‚ä¸ºæ­¤ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨`getImageData`

```
 let imageData = ctx.getImageData(0,0,canvas.width,canvas.height); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¾“å‡ºå°†ç±»ä¼¼äº

[![](../Images/7fdce15df7efac44a06c318686cbddff.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--1kmUzMtS--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5s83lt1pq4afl9gf93cd.png)

å¤ªå¥½äº†ï¼ç°åœ¨æˆ‘ä»¬æœ‰äº†æ•°æ®ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªåƒç´ çš„ RGB å€¼éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå°±åƒè¿™æ ·
[![](../Images/d00fb8d11558fd0fde82dd48daa71559.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--a0-52FTl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/lgilubqqzfulus4vfz1l.png)

æ‰€ä»¥æˆ‘ä»¬å¿…é¡»åƒ
ä¸€æ ·ä¸€èµ·å¾ªç¯éå†å…¶ä¸­çš„å››ä¸ª

```
 let imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
        let data = imageData.data;
        let r,g,b,avg;
        for(let x = 0, len = data.length; x < len; x+=4) {
            r = data[x];
            g = data[x+1];
            b = data[x+2];
            avg = Math.floor((r+g+b)/3);
        } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`avg`ç°åœ¨æœ‰äº†æ¯ä¸ªåƒç´ çš„å¹³å‡ RGB å€¼ã€‚æ¥ä¸‹æ¥ï¼Œå°†æ‰€æœ‰åƒç´ çš„å¹³å‡å€¼ç›¸åŠ ï¼Œç„¶åé™¤ä»¥å›¾åƒä¸­çš„æ€»åƒç´ ï¼Œå¾—åˆ°å¹³å‡äº®åº¦ã€‚

```
 let brightness = Math.floor(colorSum / (this.width*this.height)); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥æœ€ç»ˆçš„å‡½æ•°çœ‹èµ·æ¥ä¼šåƒè¿™æ ·:

```
const isDark = (src) => {
    return new Promise((resolve, reject) => {
        //create a hidden img element
        let img = document.createElement("img");
        img.src = src;
        img.style.display = "none";
        document.body.appendChild(img);

        let colorSum = 0;
        img.onload = function () {
            // create canvas
            let canvas = document.createElement("canvas");
            canvas.width = this.width;
            canvas.height = this.height;

            let ctx = canvas.getContext("2d");
            ctx.drawImage(this, 0, 0);

            let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let data = imageData.data;
            let r, g, b, avg;
            for (let x = 0, len = data.length; x < len; x += 4) {
                r = data[x];
                g = data[x + 1];
                b = data[x + 2];

                avg = Math.floor((r + g + b) / 3);
                colorSum += avg;
            }

            let brightness = Math.floor(colorSum / (this.width * this.height));
            resolve(brightness >= 128 ? false : true);
        }
    });
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬ç”¨è¿™ä¸ªå‡½æ•°æ¥æ£€æŸ¥å›¾åƒæ˜¯å¦æš—ã€‚

```
 isDark('./images/dbg.jpg').then((data) => {
        dynamicHeader.classList.remove("light-text");
        if(data) dynamicHeader.classList.add("light-text");
    }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‰€ä»¥è¿™é‡Œæ˜¯æˆ‘ä»¬çš„ç»“æœ:
[![](../Images/31237e28a6e9677d5d180cd769431f73.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Wk8IKxOp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/uqzltnyx2cxdavq6a299.gif)

ä½†æ˜¯å°‘äº†ç‚¹ä»€ä¹ˆã€‚å•Šå“ˆï¼Œæœ‰äº›é£æ ¼ï¼

```
.dynamic-header {
    transition: color 2s;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[![](../Images/7404507ec3d6668df44fc9bb429d5802.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--R2skm3Sp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/htoqfs5csmyp8o6gw8ug.gif)

ç°åœ¨å®Œç¾äº†ã€‚

#### [](#conclusion)ç»“è®º

å¸Œæœ›ä½ ä»¬å–œæ¬¢è¿™ä¸ªå°å®éªŒï¼Œå¹¶ä»ä¸­å­¦åˆ°ä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿ã€‚æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œå¦‚æœä½ æœ‰ï¼Œè¯·åœ¨ä¸‹é¢éšæ„è¯„è®ºã€‚ä½ å¯èƒ½æƒ³ä¹Ÿå¯èƒ½ä¸æƒ³åœ¨ä½ çš„çœŸå®é¡¹ç›®ä¸­ä½¿ç”¨å®ƒï¼Œä½†æ˜¯æˆ‘æƒ³åšä¸€ä¸ª npm åŒ…ï¼ŒæŠŠå®ƒå¸¦åˆ°ä¸‹ä¸€ä¸ªå±‚æ¬¡ã€‚å¦‚æœä½ æƒ³åŠ å…¥ï¼Œè¯·ç»™æˆ‘å‘çŸ­ä¿¡ [@sarthology](https://twitter.com/sarthology) æˆ–è€…åœ¨ä¸‹é¢è¯„è®ºã€‚

å¥½äº†ä¼™è®¡ä»¬ã€‚ä¸‹æ¬¡å†è§ã€‚æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚

[![](../Images/cc2ba079a3d79b669834f3f3910a2a9c.png)T2ã€‘](https://i.giphy.com/media/DjclSiVtiB11C/giphy.gif)