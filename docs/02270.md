# æˆ‘å¦‚ä½•æ¯” Prisma æ›´å¿«åœ°åˆ¶ä½œ PostGraphile:ä¸€å¹´å

> åŸæ–‡:[https://dev . to/graphile/how-I-made-post graphile-fast-than-prisma-1 å¹´å-4 read](https://dev.to/graphile/how-i-made-postgraphile-faster-than-prisma-1-year-later-4ead)

### [](#thanks-in-part-to-the-incredible-performance-increases-in-node-12)è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå½’åŠŸäºèŠ‚ç‚¹ 12 ä»¤äººéš¾ä»¥ç½®ä¿¡çš„æ€§èƒ½æå‡

å»å¹´ 5 æœˆï¼Œæˆ‘å‘å¸ƒäº†ã€Šæˆ‘å¦‚ä½•åœ¨ 8 å°æ—¶å†…è®© PostGraphile æ¯” Prisma æ›´å¿«ã€‹,ä»¥æ­ç©¿ Prisma æ•´åˆåˆ°ä»–ä»¬è¥é”€ç½‘ç«™ä¸­çš„æå…·è¯¯å¯¼æ€§çš„å›¾è¡¨ã€‚

<figure>[![](../Images/8974e6192f136e164aacb56eca614021.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--iEhFyzL_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/a14p95pgd0g1pprwmozy.gif) 

<figcaption>æˆ‘å¸Œæœ›æˆ‘æœ‰é¢„ç®—ç”¨ç›¸å½“æ¼‚äº®çš„è®¾è®¡å’ŒåŠ¨ç”»æ­ç©¿è¿™å¼ å›¾è¡¨ã€‚</figcaption>

</figure>

PostGraphile å…³æ³¨çš„æ˜¯ GraphQL æŸ¥è¯¢çš„æ€§èƒ½ï¼Œè¿™ç§æŸ¥è¯¢æ˜¯æ‚¨åœ¨æŒ‰ç…§æœ€ä½³å®è·µæ„å»º web åº”ç”¨ç¨‹åºæ—¶ä¼šçœ‹åˆ°çš„ï¼Œå³å•ä¸ª GraphQL æŸ¥è¯¢ä¸ºä¸€ä¸ªå•ç‹¬çš„ web é¡µé¢æå–æ‰€æœ‰éœ€è¦çš„æ•°æ®ã€‚Prisma å¯¹ä¸€ä¸ªä¸åˆ‡å®é™…çš„å°æŸ¥è¯¢(`byArtistId`ï¼Œè§ä¸‹æ–‡)è¿›è¡Œäº†åŸºå‡†æµ‹è¯•ï¼Œè¿™å®é™…ä¸Šæ„å‘³ç€ä»–ä»¬åœ¨å¯¹ HTTP å±‚è€Œä¸æ˜¯ GraphQL è§£ææœ¬èº«è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚ä¸€ç‚¹å‹å¥½çš„ç«äº‰å¯¹ç”Ÿæ€ç³»ç»Ÿæœ‰å¥½å¤„ï¼Œæˆ‘è¿˜æ²¡æœ‰ä¼˜åŒ– PostGraphile ä¸­çš„ HTTP å±‚ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç†ç”±ï¼Œå¯ä»¥åœ¨é‚£å‘¨æ™šäº›æ—¶å€™ç•™å‡ºä¸€å¤©æ¥åšä¸€äº›æ€§èƒ½å·¥ä½œã€‚å³ä½¿åœ¨è¿™ä¸ªå¾®ä¸è¶³é“çš„å°æŸ¥è¯¢ä¸Šï¼ŒPostGraphile ä¹Ÿå¾ˆå¿«æ‰“è´¥äº† Prisma æˆ‘å–œæ¬¢ä¼˜åŒ–ï¼

> ![Benjie ğŸ˜ profile image](../Images/e12333ec3c963923d64e8b90eb9a3be0.png)æœ¬æ°ğŸ˜[@ benjie](https://dev.to/benjie)![twitter logo](../Images/65e26e35707d96169ec8af6b3cbf2003.png)æ‰€ä»¥æˆ‘ä»¬åœ¨ç©åˆæˆåŸºå‡†æµ‹è¯•æ¸¸æˆæ˜¯å—ï¼ŸğŸ˜ˆğŸ˜2018 å¹´ 5 æœˆ 17 æ—¥ä¸Šåˆ 10:40[![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=997064259220770816)[![Twitter retweet action](../Images/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=997064259220770816)0[![Twitter like action](../Images/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=997064259220770816)3

å…­ä¸ªæœˆåï¼ŒPrisma è®©æˆ‘çŸ¥é“ä»–ä»¬å·²ç»æŠŠå›¾è¡¨å–ä¸‹æ¥äº†ï¼Œå¹¶ä¸”æ˜¾è‘—æé«˜äº†ä»–ä»¬è‡ªå·±çš„è¡¨ç°ã€‚ä»–ä»¬è¦æ±‚æˆ‘é‡æ–°è¿è¡ŒåŸºå‡†æµ‹è¯•ã€‚ä½œä¸ºä¸€ä¸ª[ä¼—ç­¹çš„å¼€æºå¼€å‘è€…](https://www.graphile.org/sponsor/)ï¼ŒèŠ±äº†ä¸€æ®µæ—¶é—´æ‰æ‰¾åˆ°æ›´å¤šçš„æ—¶é—´æ¥åˆ†é…ç»™æ€§èƒ½å’ŒåŸºå‡†æµ‹è¯•å·¥ä½œã€‚

åœ¨[PostGraphile 4.4](https://www.graphile.org/news/postgraphile-version-4-4/)å‘å¸ƒä¹‹åï¼Œä½œä¸ºå¯¹ Node 12 å‘å¸ƒçš„åº†ç¥ï¼Œæˆ‘å…è®¸è‡ªå·±èŠ±ä¸€äº›æ—¶é—´æ·±å…¥ç ”ç©¶ Node çš„å¼€å‘å·¥å…·ï¼Œå¯»æ‰¾æˆ‘ä»¬çš„æ€§èƒ½å¯ä»¥è¿›ä¸€æ­¥æ”¹è¿›çš„åœ°æ–¹ã€‚åœ¨è¿™æ–¹é¢éå¸¸æœ‰ç”¨ã€‚

Node 12 æœ¬èº«å¸¦æ¥äº†ä¸€äº›ä»¤äººå°è±¡æ·±åˆ»çš„æ€§èƒ½æå‡ï¼Œå®ƒè¿˜å¼€æ”¾äº†å¯¹ç°ä»£ JavaScript ç‰¹æ€§çš„æ›´å¹¿æ³›æ”¯æŒï¼Œå…è®¸æˆ‘ä»¬å‘Šè¯‰ TypeScript ç¼–è¯‘åˆ°æ›´æ–°çš„ ECMAScript ç›®æ ‡ï¼Œå¹¶åˆ©ç”¨å„ç§æ€§èƒ½æå‡ï¼Œè€Œä¸å¿…å¤šå¡«å……è¡¨è¾¾æ€§è¯­æ³•ã€‚ä¸ºäº†ä¿æŒå‘åå…¼å®¹æ€§ï¼Œè¿™äº›ä¼˜åŒ–æ˜¯é€šè¿‡`GRAPHILE_TURBO`ç¯å¢ƒå˜é‡é€‰æ‹©åŠ å…¥çš„ã€‚Node 12 è¿˜å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„ HTTP è§£æå™¨`llhttp`ï¼Œå®ƒæ˜¾ç„¶ä¹Ÿå¿«äº†ä¸€ç‚¹ã€‚æ€»è€Œè¨€ä¹‹ï¼Œä»…ä»…é€šè¿‡æ›´æ”¹ä¸€äº›ç¼–è¯‘å™¨æ ‡å¿—å’Œä½¿ç”¨æ–°çš„ Node.js ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å°±è·å¾—äº†å¾ˆå¤§çš„æ€§èƒ½æå‡ï¼

åœ¨ PostGraphile çš„ä»£ç åº“ä¸­ï¼Œæˆ‘ä»¬è®¾æ³•åœ¨ä¸€äº›åœ°æ–¹æŒ¤å‡ºäº†æ›´å¤šçš„æ€§èƒ½ã€‚æˆ‘å°†å¾ˆå¿«ä¸º Node.js å¼€å‘äººå‘˜å‘å¸ƒä¸€ä¸ªå¸–å­ï¼Œè§£é‡Šæˆ‘ä»¬åˆ°åº•åšäº†ä»€ä¹ˆ([æ³¨å†Œæˆ‘ä»¬çš„é‚®ä»¶åˆ—è¡¨](http://eepurl.com/gfV9LD)ä»¥è·å¾—å…³äºè¿™ä¸ªå’Œå…¶ä»–å›¾å½¢æ–°é—»çš„é€šçŸ¥)ï¼Œä½†ä¸»è¦çš„äº‹æƒ…æ˜¯å‡å°‘æˆ‘ä»¬ä»£ç çš„åƒåœ¾æ”¶é›†å¼€é”€ï¼Œæ‰§è¡Œæ›´å¤šæå‰è®¡ç®—ï¼Œä»¥åŠè‡ªåŠ¨è·Ÿè¸ªå’Œé‡ç”¨ PostgreSQL å‡†å¤‡å¥½çš„è¯­å¥ã€‚

<figure>[![](../Images/c76909d07b3f57541cf86bb528a3cb10.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--5Ty--onX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/aq2tpiyw09ni2d1yt4ay.png) 

<figcaption>ä»å¤§çº¦ 6:28:33 åˆ°å¤§çº¦ 6:30:18ï¼Œæˆ‘ä»¬é’ˆå¯¹ PostGraphile çš„ä¸€ä¸ªæ’è£…å®ä¾‹è¿è¡Œäº† 200ï¼Œ000 ä¸ªè¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ [node-clinic](https://github.com/nearform/node-clinic) è·Ÿè¸ªå†…å­˜ä½¿ç”¨æƒ…å†µ(é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™éå¸¸é…·)ã€‚è¿™ä¸ªâ€œé”¯é½¿â€å›¾æ˜¾ç¤ºäº† Node å®šæœŸè¿è¡Œåƒåœ¾æ”¶é›†(GC)æ¥é‡Šæ”¾ä¸å†ä½¿ç”¨çš„å†…å­˜ã€‚</figcaption>

</figure>

åœ¨è¿™äº›ä¼˜åŒ–ä¹‹åï¼Œæˆ‘é‡æ–°è¿è¡Œäº†åŸºå‡†æµ‹è¯•ï¼Œæµ‹è¯•äº†æœ€æ–°ç‰ˆæœ¬çš„ Prisma (1.32)ï¼Œåœ¨èŠ‚ç‚¹ 10 ä¸Šè¿è¡Œçš„ postgrapile 4 . 0 . 0ï¼Œä»¥åŠåœ¨å¯ç”¨äº†`GRAPHILE_TURBO`çš„æƒ…å†µä¸‹åœ¨èŠ‚ç‚¹ 12 ä¸Šè¿è¡Œçš„ postgrapile 4 . 4 . 1 çš„ alphaã€‚æˆ‘ä»¬å¯¹åŸºå‡†æ‰€åšçš„å”¯ä¸€é‡å¤§æ”¹å˜æ˜¯å‡å°‘é¢„çƒ­å¹¶å‘æ€§(å‚è§ä¸‹é¢çš„`albums_tracks_genre_all`äº†è§£åŸå› )ã€‚

æ•…äº‹è®²å®Œäº†â€”â€”ç»™æˆ‘ä»¬çœ‹çœ‹æ•°å­—ï¼T3ã€‘

åœ¨[å»å¹´çš„å›¾](https://graphql-bench-visualizer.now.sh/)ä¸­ï¼Œæœ€æ–°ç‰ˆæœ¬çš„ PostGraphile(æ ‡ç­¾ä¸º`postgraphile-next`ï¼Œå®é™…ä¸Šæ˜¯ [v4.0.0-beta.10](https://github.com/graphile/postgraphile/releases/tag/v4.0.0-beta.10) )æ˜¯ç²‰çº¢è‰²çš„ã€‚postgrapile v 4 . 0 . 0 æœ‰ä¸€ä¸ªä¸è¿™ä¸ªç‰ˆæœ¬ç›¸ä¼¼çš„æ€§èƒ½é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ–°çš„å›¾å½¢ä¸­ä½¿ç”¨äº†ç²‰çº¢è‰²[ä½œä¸ºå‚è€ƒã€‚æˆ‘ä»¬ä¸ºæœ€æ–°ç‰ˆæœ¬æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ç»¿è‰²è¡Œ:`postgraphile@alpha` (v4.4.1-alpha.4)ã€‚](https://graphql-bench-visualizer2.now.sh/)

æˆ‘è¿˜åœ¨å»¶è¿Ÿå›¾è¡¨ä¸­æ·»åŠ äº†å‰å·ï¼Œä»¥æŒ‡ç¤º 0.1%æˆ–æ›´å¤šçš„è¯·æ±‚å¤±è´¥çš„æ—¶é—´(å¹¶ç”¨å¤±è´¥è¯·æ±‚çš„ç™¾åˆ†æ¯”æ ‡è®°å‰å·)ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªé‡è¦çš„æŒ‡æ ‡ï¼Œå¦‚æœæ²¡æœ‰äº¤å‰å¼•ç”¨ç›¸å…³çš„â€œæˆåŠŸçš„è¯·æ±‚â€å›¾è¡¨ï¼Œä»¥å‰æ˜¯çœ‹ä¸åˆ°çš„ã€‚æ­¤å¤–ï¼ŒY è½´å·²è¢«æ‰©å±•ä»¥æ˜¾ç¤ºç¨é«˜çš„å»¶è¿ŸèŒƒå›´ã€‚

æ¥ä¸‹æ¥æ˜¯ 5 ä¸ªåŸºå‡†æµ‹è¯•æŸ¥è¯¢ä¸­æ¯ä¸€ä¸ªçš„éƒ¨åˆ†ã€‚åŸºå‡†è®¾ç½®å’Œå»å¹´å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œå°±ä¸å†èµ˜è¿°äº†(å‚è§[å»å¹´å¸–å­](https://medium.com/graphile/how-i-made-postgraphile-faster-than-prisma-graphql-server-in-8-hours-e66b4c511160)çš„â€œåŸºå‡†â€éƒ¨åˆ†)ã€‚

#### [](#prismadeeplynested)prisma_deeplyNested

è¿™ä¸ªæŸ¥è¯¢æ˜¾ç¤ºäº†å„ç§è½¯ä»¶å¦‚ä½•å¤„ç†æ¶‰åŠå¤§é‡æ•°æ®åº“è¡¨ã€å…³ç³»å’Œåˆ—çš„æŸ¥è¯¢ã€‚Prisma å°†è¿™ä¸ªè¯·æ±‚å‘½åä¸ºâ€œæ·±åº¦åµŒå¥—â€,ä½†æ˜¯å¯¹äºä¸€ä¸ªé¢å‘å‰ç«¯çš„ GraphQL API æ¥è¯´ï¼Œå¤„ç†ç±»ä¼¼çš„æŸ¥è¯¢å¹¶ä¸ç½•è§ã€‚

```
query prisma_deeplyNested {
  allAlbumsList(condition: {artistId: 127}) {
    albumId
    title
    tracksByAlbumIdList {
      trackId
      name
      genreByGenreId { name }
    }
    artistByArtistId {
      albumsByArtistIdList {
        tracksByAlbumIdList {
          mediaTypeByMediaTypeId { name }
          genreByGenreId { name }
        }
      }
    }
  }
} 
```

<figure>[![](../Images/7abe86c54b9eb601f668e4ff1395816d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--3GE0TYD1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/0z4co0litdiwwfa4ysf6.png) 

<figcaption>æ­¤å›¾è¡¨æ˜¾ç¤ºäº†å„ç§è½¯ä»¶åœ¨å¼€å§‹ä¸¢å¼ƒè¯·æ±‚(æˆ–æœªè¾¾åˆ° 5s å»¶è¿Ÿæˆªæ­¢æ—¶é—´)ä¹‹å‰æ¯ç§’å¯ä»¥å¤„ç†çš„è¯·æ±‚æ•°ã€‚Prisma ä»å»å¹´çš„ 100rps å¢åŠ åˆ° 225 RPSâ€”â€”æ˜¾è‘—å¢åŠ ã€‚PostGraphile ç°åœ¨æ›´ä¼˜é›…åœ°å¤„ç†æ›´é«˜çš„è´Ÿè½½â€”â€”å°½ç®¡æˆ‘ä»¬åœ¨ 700rps åå¼€å§‹ä¸¢å¼ƒè¯·æ±‚ï¼Œå³ä½¿åœ¨ 800rps æˆ‘ä»¬ä¹Ÿåªä¸¢å¼ƒäº† 2.26%ã€‚</figcaption>

</figure>

<figure>[![](../Images/589939718e6a73cc33045ff3ec026918.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--jg0RLSpu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/w3vmlqu5kwlaylpmtgoc.png) 

<figcaption>è¿™å¼  95%å»¶è¿Ÿå›¾è¡¨æ˜¾ç¤ºäº†ä¸åŒè´Ÿè½½ä¸‹å„ç§è½¯ä»¶å“åº”è¯·æ±‚çš„é€Ÿåº¦ã€‚æœ€æ–°çš„ PostGraphile å·²ç»å…¨é¢é™ä½äº†å»¶è¿Ÿï¼Œå¹¶ä¸”åœ¨è¶…è¿‡ 600rps çš„å³°å€¼åä»ç„¶è¡¨ç°è‰¯å¥½ã€‚</figcaption>

</figure>

#### [](#albumstracksgenreall)ä¸“è¾‘ _ æ›²ç›® _ æµæ´¾ _ å…¨éƒ¨

å»å¹´æˆ‘ä»¬ä¸å¾—ä¸æ’é™¤è¿™ä¸ªæŸ¥è¯¢ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä» Prisma å¾—åˆ°ä»»ä½•ç»“æœï¼Œä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚ä»Šå¹´æˆ‘ä»¬å‘ç°äº†è¿™ä¸ªé—®é¢˜:Prisma åœ¨çƒ­èº«é˜¶æ®µå˜å¾—ä¸çŸ¥æ‰€æªï¼Œåœ¨ä¸»è¦åŸºå‡†æµ‹è¯•å¼€å§‹æ—¶æ— æ³•åšå‡ºååº”ã€‚è§£å†³æ–¹æ¡ˆæ˜¯å°† 5 åˆ†é’Ÿé¢„çƒ­æœŸé—´çš„å¹¶å‘æ€§ä» 100rps å‡å°‘åˆ° 10rps(æ‚¨å¯ä»¥åœ¨å»å¹´çš„å¸–å­ä¸­äº†è§£ä¸ºä»€ä¹ˆé¢„çƒ­æ˜¯å¿…è¦çš„)ã€‚

è¯¥æŸ¥è¯¢æ˜¾ç¤ºäº†ä»æ•°æ®åº“çš„ç‰¹å®šé›†åˆä¸­è·å–æ‰€æœ‰è¡Œï¼Œä»¥åŠä¸€äº›ç›¸å…³è®°å½•ã€‚é€šå¸¸ï¼Œåƒè¿™æ ·çš„å‰ç«¯ GraphQL è¯·æ±‚åº”è¯¥åœ¨æ ¹çº§åˆ«è¿›è¡Œåˆ†é¡µ(ä¾‹å¦‚ï¼Œä¸€æ¬¡é™åˆ¶ä¸º 50 ä¸ªç›¸å†Œ)ï¼Œä½†æ˜¯å› ä¸ºç›¸å†Œè¡¨ä¸­åªæœ‰ 347 è¡Œï¼Œæ‰€ä»¥è¿™å¹¶ä¸å¤ªç³Ÿç³•ã€‚è¿™ä¸ªæŸ¥è¯¢æ›´å¥½åœ°ä»£è¡¨äº†æ‚¨å¯èƒ½ä»åç«¯è€Œä¸æ˜¯ä» web å‰ç«¯è¿›è¡Œçš„ GraphQL æŸ¥è¯¢ã€‚

```
query albums_tracks_genre_all {
  allAlbumsList {
    albumId
    title
    tracksByAlbumIdList {
      trackId
      name
      genreByGenreId {
        name
      }
    }
  }
} 
```

<figure>[![](../Images/81560b7faa835d03955abbaa2fa1a28d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--bIUVyBY---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/az5qznbw7qr5usnb09d9.png)

<figcaption>postgrapile ä» 70rps æé«˜åˆ° 80rps è€Œä¸ä¸¢å¼ƒä»»ä½•è¯·æ±‚ã€‚</figcaption>

</figure>

<figure>[![](../Images/b0b1ba0c4f9b9ef184082807ae7425a1.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--EtOnxWX5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zqigo3kprmp4eermdofg.png) 

<figcaption>å³ä½¿æ˜¯ 80rpsï¼ŒPostGraphile ä¹Ÿèƒ½åœ¨ 250 æ¯«ç§’å†…å¤„ç† 95%çš„è¯·æ±‚ã€‚æœ€æ–°çš„ postgraphile@alpha æ˜¾ç¤ºå‡ºå»¶è¿Ÿçš„æ˜¾è‘—å‡å°‘å’Œååé‡çš„å¢åŠ ã€‚</figcaption>

</figure>

#### [](#albumstracksgenresome)ä¸“è¾‘ _ æ›²ç›® _ æµæ´¾ _ ä¸€äº›

è¿™ä¸ªæŸ¥è¯¢ä¸å‰ä¸€ä¸ªæŸ¥è¯¢å‡ ä¹ç›¸åŒï¼Œåªæ˜¯é€šè¿‡è¿‡æ»¤ç‰¹å®šçš„è‰ºæœ¯å®¶å‡å°‘äº†ç»“æœçš„æ•°é‡(ä» 347 ä¸ªå‡å°‘åˆ° 3 ä¸ª)ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å‰ç«¯ GraphQL æŸ¥è¯¢çš„ç›¸å½“å¥½çš„ä¾‹å­ã€‚

```
query albums_tracks_genre_some {
  allAlbumsList(condition: {artistId: 127}) {
    artistId
    title
    tracksByAlbumIdList {
      trackId
      name
      genreByGenreId {
        name
      }
    }
  }
} 
```

<figure>[![](../Images/fcbdf56788522b6628278d073b6e27f1.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--qrC-jcCT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/18n4dp9smdh365nx0vrf.png) 

<figcaption>Prisma å¤§å¹…æå‡â€”â€”ä»å»å¹´çš„ 300rps æå‡åˆ°ä»Šå¹´çš„ 800rpsã€‚postgrapile ä» 1500rps å¢åŠ åˆ° 1700rpsï¼Œå¹¶ä¸”æ›´ä¼˜é›…åœ°å¤„ç†è¶…è¿‡å…¶æœ€å¤§å€¼çš„æƒ…å†µ:åœ¨ 1800rps æ—¶ï¼Œpostgrapile ä»…ä¸¢å¼ƒ 0.7%çš„ä¼ å…¥è¯·æ±‚ã€‚</figcaption>

</figure>

<figure>[![](../Images/b6996f900c1ab7337693555c08b48968.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--qLBgW10I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/v4rysbafborvjyzjoogx.png)

<figcaption>PostGraphile çš„å»¶è¿Ÿæ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½ä½ï¼Œåœ¨ 50 æ¯«ç§’å†…ä»¥ 1700rps çš„é€Ÿåº¦æ»¡è¶³ 95%çš„è¯·æ±‚ã€‚</figcaption>

</figure>

#### [](#byartistid)åŸå¸‚è‰ºæœ¯æ—¶é—´

è¿™ä¸ªæŸ¥è¯¢éå¸¸ç®€å•ï¼Œåªéœ€è¦ä»æ•°æ®åº“çš„ä¸€è¡Œä¸­è¯·æ±‚ä¸¤ä¸ªå­—æ®µã€‚åœ¨ä¸€ä¸ªé‡è¦çš„åº”ç”¨ç¨‹åºçš„ web å‰ç«¯ï¼Œå¾ˆå°‘ä¼šæœ‰å¦‚æ­¤ç®€å•çš„ GraphQL è¯·æ±‚â€”â€”å®ƒæ˜¾ç¤ºäº† HTTP å±‚çš„åº•å±‚æ€§èƒ½ï¼Œè€Œä¸æ˜¯ GraphQL è§£ææœ¬èº«ã€‚

```
query artistByArtistId {
  artistByArtistId(artistId: 3) {
    artistId
    name
  }
} 
```

<figure>[![](../Images/a2915863059407a7c39ca2df6275ba8d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--G21aDXj9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hiucjbszte10r2xi9fvn.png) 

<figcaption>è¿™å¼ å›¾çœ‹èµ·æ¥å’Œå»å¹´æƒŠäººçš„ç›¸ä¼¼ï¼Œé™¤äº†ä¸€åˆ‡éƒ½å‘å³ç§»åŠ¨äº†ï¼PostGraphile ç°åœ¨å¯ä»¥å¤„ç†ä»¤äººå°è±¡æ·±åˆ»çš„ 3700rps(ç›¸æ¯”å»å¹´çš„ 3000rps)è€Œä¸ä¸¢å¼ƒä»»ä½•è¯·æ±‚ï¼Œå¹¶ä¸”è¾¾åˆ° 4000rps(ç›¸æ¯”å»å¹´çš„ 3200rps)è€Œåªä¸¢å¼ƒ 0.8%çš„è¯·æ±‚ã€‚Prisma ä¹Ÿæœ‰æ‰€æ”¹è¿›ï¼Œä» 2750rps(æ²¡æœ‰æ”¾å¼ƒè¯·æ±‚)æé«˜åˆ° 3600rpsã€‚</figcaption>

</figure>

<figure>[![](../Images/7b9997b78528abfe3983414911204882.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--uGCZwFUL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1xg3uboe4fkrhib5ban3.png) 

<figcaption>è¡¨ç¤ºå¤±è´¥ç™¾åˆ†æ¯”çš„å‰å·ç¡®å®æœ‰åŠ©äºè§£é‡Šè¿™é‡Œçš„å»¶è¿Ÿç»“æœï¼›åœ¨ 3000rps ä¹‹åï¼ŒPrisma è®¾æ³•åœ¨çŸ­æ—¶é—´å†…å®ç°æ¯” PostGraphile ç¨ä½çš„å»¶è¿Ÿï¼Œç›´åˆ°ä»–ä»¬å¼€å§‹ä»¥ 3700rps ä¸¢å¼ƒè¯·æ±‚ã€‚è¿™å¯èƒ½æ˜¯ç”±äº Scala(åœ¨ JVM ä¸Šè¿è¡Œ)å’Œ Node.js å¤„ç†åƒåœ¾æ”¶é›†çš„æ–¹å¼ä¸åŒã€‚</figcaption>

</figure>

#### [](#tracksmediafirst20)æ›²ç›® _ åª’ä½“ _ é¦–å‘ _20

ä¸ºäº†å®Œæ•´èµ·è§ï¼Œè¿™ä¸ªæŸ¥è¯¢è¯·æ±‚å•ä¸ªæ•°æ®åº“è¡¨ä¸­ 20 è¡Œä¸­çš„ 2 åˆ—â€”â€”å°±åƒä¸€ä¸ªç¨å¾®å¤§ä¸€ç‚¹çš„ byArtistId ç‰ˆæœ¬ã€‚æ¥è‡ªç½‘é¡µçš„ GraphQL è¯·æ±‚å¾ˆå°‘è¿™ä¹ˆç®€å•ã€‚

```
query tracks_media_first_20 {
  allTracksList(first: 20) {
    trackId
    name
  }
} 
```

<figure>[![](../Images/840c2354e7b7061644625ddae8f47268.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--9xdKybU_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/wt069fda2w77p1aklcal.png) 

<figcaption>Prisma ä»å»å¹´çš„ 2000rps æå‡åˆ°ä»Šå¹´çš„ 3000rpsã€‚PostGraphile ä»¥ 3500rps å¢åŠ äº†é¢†å…ˆä¼˜åŠ¿ã€‚</figcaption>

</figure>

<figure>[![](../Images/c8bcfad83a898161b56ccc48e5f8b03d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--mFfkI2UI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/r21g8j1632tn9tyvzu2v.png) 

<figcaption>åŒæ ·ï¼Œè¯¥å›¾æ˜¾ç¤ºäº† Node.js ä¸ Scala åœ¨åƒåœ¾æ”¶é›†ã€HTTP å¼€é”€å’Œå…¶ä»–ç›¸å…³æˆæœ¬æ–¹é¢çš„å·®å¼‚ï¼ŒNode å®ç°äº†æ›´é«˜çš„ååé‡ï¼Œä½†åœ¨é«˜å¹¶å‘æ—¶å»¶è¿Ÿç¨é«˜ã€‚
</figcaption>

</figure>

#### [](#is-speed-really-that-important)é€Ÿåº¦çœŸçš„é‚£ä¹ˆé‡è¦å—ï¼Ÿ

æ˜¯ä¹Ÿä¸æ˜¯ã€‚æˆ‘åšä¼˜åŒ–æ˜¯å› ä¸ºè¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„æŒ‘æˆ˜ï¼Œçœ‹çœ‹æˆ‘å¯ä»¥ç”¨ä¸€ç§è§£é‡Šå‹è¯­è¨€æŠŠè®¡ç®—æœºæ¨è¿›å¤šè¿œï¼Œè€Œä¸ç”¨æŠŠæˆ‘çš„ä»£ç å¼„å¾—å¤ªä¹±ã€‚PostGraphile çš„ç”¨æˆ·ç°åœ¨å°†ä»æ›´å¿«çš„æ€§èƒ½å’Œæ›´æ»¡æ„çš„æœ€ç»ˆç”¨æˆ·ä¸­å—ç›Šï¼Œåªéœ€æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬å³å¯â€”â€”ä»–ä»¬æ ¹æœ¬ä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä»£ç ã€‚æˆ‘æƒ³é‚£çœŸçš„æ˜¯ coolâœ¨

ä½†æ˜¯æ€§èƒ½ä¸æ˜¯ä¸€åˆ‡â€”â€”æˆ‘ä»¬åœ¨ PostGraphile å…³æ³¨çš„äº‹æƒ…ä¹‹ä¸€æ˜¯å¯æ‰©å±•æ€§ã€‚æˆ‘ä»¬çš„å·¥ä½œä¸æ˜¯ç®€å•åœ°å°†æ‚¨çš„æ•°æ®åº“ä» SQL è½¬æ¢æˆ GraphQLã€‚æˆ‘ä»¬çš„å·¥ä½œæ˜¯å¸®åŠ©æ‚¨å°½å¿«æ„å»ºç†æƒ³çš„ GraphQL APIã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°½å¯èƒ½åœ°ä¸ºæ‚¨åšäº†å¤§é‡çš„æ ·æ¿å·¥ä½œï¼Œä½†éšåæˆ‘ä»¬ä¼šä¸ºæ‚¨æä¾›æ·»åŠ ã€å®šåˆ¶å’Œå®šåˆ¶ GraphQL æ¨¡å¼çš„æ–¹æ³•ã€‚æˆ‘ä»¬æ ¹æœ¬ä¸ç›¸ä¿¡æˆ‘ä»¬çš„å·¥ä½œæ˜¯å‘æ‚¨çš„æœ€ç»ˆç”¨æˆ·å…¬å¼€æ•°æ®åº“çš„æ‰€æœ‰åŠŸèƒ½ï¼›ç›¸åï¼Œæˆ‘ä»¬è®¤ä¸ºæˆ‘ä»¬åº”è¯¥å…è®¸æ‚¨åˆ©ç”¨æ•°æ®åº“çš„åŠŸèƒ½æ¥æ„å»ºæ‚¨çš„å‰ç«¯å¼€å‘äººå‘˜éœ€è¦çš„ GraphQL APIï¼Œè€Œæ— éœ€ä»–ä»¬æ‹…å¿ƒå¤æ‚çš„è¿æ¥ã€å­æŸ¥è¯¢ã€å…¬å…±è¡¨è¡¨è¾¾å¼ã€`ON CONFLICT DO UPDATE`ã€ç´¢å¼•ã€SQL æŸ¥è¯¢ä¼˜åŒ–ä»¥åŠå…¶ä»–ç±»ä¼¼çš„äº‹æƒ…ã€‚å°½ç®¡ PostGraphile å…·æœ‰å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œä½†å®ƒè¿˜æ˜¯è·å¾—äº†ä»¤äººéš¾ä»¥ç½®ä¿¡çš„è‰¯å¥½æ€§èƒ½ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šè¦å½’åŠŸäºé€‰æ‹© Node.js ä½œä¸ºå¼€å‘å¹³å°ã€‚

#### [](#so-whats-next)é‚£ä¹ˆæ¥ä¸‹æ¥å‘¢ï¼Ÿ

ä½ ç°åœ¨å°±å¯ä»¥ç”¨`yarn install postgraphile@alpha`æ¥ä½“éªŒä¸€ä¸‹æ–°çš„æµ·æŠ¥ã€‚å®ƒé€šè¿‡äº†æ‰€æœ‰çš„æµ‹è¯•ï¼Œä½†è¿˜æ²¡æœ‰å®Œå…¨é€šè¿‡ç¤¾åŒºçš„å®¡æŸ¥ï¼Œå› æ­¤æœ‰äº†â€œalphaâ€æ ‡ç­¾â€”â€”å¦‚æœä½ è¯•ç”¨å®ƒï¼Œè¯·åœ¨æˆ‘ä»¬çš„ Discord chat ä¸Šç»™æˆ‘ä»¬ç•™è¨€[,è®©æˆ‘ä»¬çŸ¥é“ä½ çš„è¿›å±•å¦‚ä½•ï¼](http://discord.gg/graphile)

> `yarn install postgraphile@alpha`

å¦‚æœä½ æ¬£èµæˆ‘ä»¬çš„å·¥ä½œï¼Œè¯·[èµåŠ©æˆ‘ä»¬](https://www.graphile.org/sponsor/)â€”â€”æˆ‘ä»¬éå¸¸æ„Ÿè°¢æˆ‘ä»¬çš„ Patreon èµåŠ©å•†ï¼Œä»–ä»¬å¸®åŠ©æˆ‘ä»¬ä¸æ–­å‰è¿›ã€‚

> å¦‚æœæ‚¨æ¬£èµæˆ‘ä»¬çš„å·¥ä½œï¼Œè¯·[èµåŠ©æˆ‘ä»¬](https://www.graphile.org/sponsor/)ã€‚

æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œæˆ‘å°†å¾ˆå¿«åœ¨ Node.js æ€§èƒ½ä¼˜åŒ–ä¸Šå‘å¸ƒå¦ä¸€ç¯‡æ–‡ç« ï¼Œè¿™æ˜¯æˆ‘ç”¨æ¥å®ç°è¿™ä¸€ç‚¹çš„â€” [æ³¨å†Œæˆ‘ä»¬çš„é‚®ä»¶åˆ—è¡¨](http://eepurl.com/gfV9LD)ä»¥è·å¾—å…³äºè¿™ä¸€ç‚¹å’Œå…¶ä»–å›¾å½¢æ–°é—»çš„é€šçŸ¥ã€‚

> [æ³¨å†Œæˆ‘ä»¬çš„é‚®ä»¶åˆ—è¡¨](http://eepurl.com/gfV9LD)