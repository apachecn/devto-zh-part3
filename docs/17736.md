# Node.js ä¸Šçš„ GRPC æ›´ç®€å•

> åŸæ–‡:[https://dev.to/yoshiyukikato/grpc-on-nodejs-more-simply-h1](https://dev.to/yoshiyukikato/grpc-on-nodejs-more-simply-h1)

åœ¨ Node.js ä¸Šå¼€å‘ GRPC åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [`grpc`](https://www.npmjs.com/package/grpc) å’Œ [`@grpc/proto-loader`](https://www.npmjs.com/package/@grpc/proto-loader) ã€‚è™½ç„¶è¿™äº›æ¼‚äº®çš„åŒ…æä¾›äº†ç»Ÿä¸€çš„ API æ¥æ„å»º GRPC æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œä½†æ˜¯å®ƒä»¬å¤ªåŸå§‹äº†ï¼Œæˆ‘ä¸èƒ½ç›´æ¥åœ¨æˆ‘çš„åº”ç”¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨ã€‚æˆ‘æƒ³è¦æ›´ç®€åŒ–çš„ APIï¼Œæ¯”å¦‚`createServer`å’Œ`createClient`ã€‚

æ‰€ä»¥ï¼Œæˆ‘æ­£åœ¨å¼€å‘ [grpc-kit](https://github.com/YoshiyukiKato/grpc-kit) ã€‚æ˜¯ä¸€ä¸ª`grpc`å’Œ`@grpc/proto-loader`çš„å°å‹åŒ…è£…å™¨åº“ã€‚å½“ç„¶å®ƒæä¾›äº†`createServer`å’Œ`createClient`ğŸ˜†

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚

**greeter.proto**

```
syntax="proto3";

package greeter;

service Greeter {
  rpc Hello (RequestGreet) returns (ResponseGreet) {}
  rpc Goodbye (RequestGreet) returns (ResponseGreet) {}
}

message RequestGreet {
  string name = 1;
}

message ResponseGreet {
  string message = 1;
} 
```

**server.js**

```
const {createServer} = require("grpc-kit");
const server = createServer();

server.use({
  protoPath: "/path/to/greeter.proto",
  packageName: "greeter",
  serviceName: "Greeter",
  routes: {
    hello: (call, callback) => {
      callback(null, { message: `Hello, ${call.request.name}` });
    },
    goodbye: async (call) => {
      return { message: `Goodbye, ${call.request.name}` };
    }
  }
});

server.listen("0.0.0.0:50051"); 
```

`createServer`è¿”å›`grpc.Server`çš„åŒ…è£…ç±»çš„å®ä¾‹ã€‚è¯¥ç±»æä¾›äº†ç”¨äºæ·»åŠ æœåŠ¡çš„`use`æ–¹æ³•ã€‚æ‚¨å¯ä»¥ç”¨è·¯ç”±æ˜ å°„æ¥å£°æ˜æ€§åœ°é…ç½®æœåŠ¡ã€‚è·¯ç”±å›¾ç”±åœ¨`greeter.proto`ä¸­å£°æ˜çš„æ–¹æ³•å¯¹å’Œå¤„ç†å‡½æ•°ç»„æˆ(åŒæ­¥/å¼‚æ­¥å‡½æ•°éƒ½å¯ç”¨ğŸ˜).æœåŠ¡é…ç½®å®Œæˆåï¼Œé€šè¿‡`listen`æ–¹å¼å¯åŠ¨æœåŠ¡å™¨ã€‚

**client.js**

```
//client.js
const {createClient} = require("grpc-kit");
const client = createClient({
  protoPath: "/path/to/greeter.proto",
  packageName: "greeter",
  serviceName: "Greeter"
}, "0.0.0.0:50051");

client.hello({ name: "Jack" }, (err, response) => {
  if(err) throw err;
  console.log(response.message);
});

client.goodbye({ name: "John" }, (err, response) => {
  if(err) throw err;
  console.log(response.message);
}); 
```

`createClient`è¿”å›`grpc.Client`çš„ä¸€ä¸ªå®ä¾‹ã€‚å®ƒè°ƒç”¨åœ¨`greeter.proto`ä¸­å£°æ˜çš„æ–¹æ³•ï¼Œå¹¶åœ¨å›è°ƒä¸­æ¥æ”¶å“åº”ã€‚

å…³äº API çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[åº“](https://github.com/YoshiyukiKato/grpc-kit)ã€‚å›¾ä¹¦é¦†æ­£åœ¨å»ºè®¾ä¸­ã€‚æ¬¢è¿ä»»ä½•æ„è§å’Œå»ºè®®ã€‚è°¢è°¢å¤§å®¶ï¼

## ![](../Images/375dfcc32199b4dedf2b526645c27ff7.png) [å‰è¡ŒåŠ è—¤](https://github.com/YoshiyukiKato) / [ grpc-kit](https://github.com/YoshiyukiKato/grpc-kit)

### åœ¨ Node.js ä¸Šæ›´ç®€å•åœ°ä½¿ç”¨ grpc

<article class="markdown-body entry-content" itemprop="text">

# grpc-kit

[![npm version](../Images/62e4c77e30673d80c112b8271b862ba7.png)T2ã€‘](https://badge.fury.io/js/grpc-kit)

åœ¨ Node.js ä¸Šæ›´ç®€å•åœ°ä½¿ç”¨ grpcã€‚

## å¿«é€Ÿå¯åŠ¨

### å®‰è£…

```
$ npm install grpc @grpc/proto-loader grpc-kit
```

### æ ·æœº

```
syntax="proto3"
package greeter
service Greeter {
  rpc Hello (RequestGreet) returns (ResponseGreet) {}
  rpc Goodbye (RequestGreet) returns (ResponseGreet) {}
}
message RequestGreet {
  string name = 1;
}

message ResponseGreet {
  string message = 1;
}
```

### è®¡ç®—æœºç½‘ç»œæœåŠ¡å™¨

```
const {createServer} = require("grpc-kit")
const server = createServer();

server.use({
  protoPath: "/path/to/greeter.proto",
  packageName: "greeter",
  serviceName: "Greeter",
  routes: {
    hello: (call, callback) => {
      callback(null, { message: `Hello, ${call.request.name}` });
    },
    goodbye: async (call) => {
      return { message: `Goodbye, ${call.request.name}`
```

â€¦</article>

[View on GitHub](https://github.com/YoshiyukiKato/grpc-kit)