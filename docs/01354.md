# æŠ“å–æ— é™åŠ è½½(å³:äº§å“æœç´¢)é¡µé¢ï¼ä¸ç”¨ ajaxï¼

> åŸæ–‡:[https://dev . to/vanila-io/scraping-infinite-loading-ie-product-hunt-pages-without-use-Ajax-6e 5](https://dev.to/vanila-io/scraping-infinite-loading-ie-product-hunt-pages-without-using-ajax-6e5)

å¦‚æœä½ å–œæ¬¢æ„å»ºç½‘é¡µæŠ“å–å™¨ï¼Œä½ å°±ä¼šçŸ¥é“æŠ“å–æ— é™åŠ è½½çš„ç½‘é¡µæœ‰å¤šéš¾ã€‚ä½ åœ¨è°·æ­Œä¸Šçœ‹åˆ°çš„å¤§å¤šæ•°æœç´¢ç»“æœéƒ½é›†ä¸­åœ¨ä¸¤ç§æ–¹æ³•ä¸Šã€‚

1.  åœ¨ç½‘ç»œé€‰é¡¹å¡ä¸Šæ‰¾åˆ° ajaxï¼Œå°è¯•ä»å®ƒé‚£é‡Œåˆ®ã€‚
2.  ä½¿ç”¨`document.body.scrollHeight`ã€`window.scrollTo`å’Œä¸€äº› for å¾ªç¯çš„ç»„åˆã€‚![](../Images/a8f5f4aaf4510ff9e2438e4b874863b0.png)

ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä»¬ä¸­çš„å¤§å¤šæ•°éƒ½ä¸èƒ½å¾ˆå¥½åœ°å¤„ç†å»¶è¿ŸåŠ è½½çš„å›¾åƒï¼Œæˆ–è€…ç”±**å¹³æ»‘æ»šåŠ¨**è§¦å‘æ— é™åŠ è½½çš„é¡µé¢ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ‘†å¼„ç½‘ç»œæ ‡ç­¾ä¼¼ä¹ä¼šé€‚å¾—å…¶åï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“åœ¨ä¸€äº›ç½‘ç«™ä¸Šè¢«è§¦å‘ä¸ºæœºå™¨äººã€‚

å‡ å¹´æ¥ï¼Œæˆ‘ä¸€ç›´åœ¨æ€è€ƒè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚å°è¯•äº†æ‰€æœ‰ä¸åŒçš„æ–¹æ³•ï¼Œä½†éƒ½å¤±æœ›äº†ï¼Œå› ä¸ºç½‘ç«™ä¹‹é—´çš„å·®å¼‚å¾ˆå¤§ã€‚

æœ€åï¼Œå½“æˆ‘åœ¨ stackoverflow ä¸Šæ›´æ–°[è¿™ä¸ª](https://stackoverflow.com/a/52671691/6161265)å’Œ[è¿™ä¸ª](https://stackoverflow.com/a/56349839/6161265)æ—¶ï¼Œå®ƒè¸¢äº†æˆ‘ä¸€è„šã€‚è¯·éšæ„æ¢ç´¢å®ƒä»¬ã€‚

è¿™æ˜¯æˆ‘ä»¬ä»Šå¤©å°†æ„å»ºçš„å°é¢„è§ˆã€‚è¿™æ˜¯ä¸€ä¸ªä¸€åˆ†é’Ÿçš„è§†é¢‘(å¯¹ä¸èµ·ï¼Œæ²¡æœ‰éŸ³é¢‘)ã€‚
[https://www.youtube.com/embed/hUNeD4TMwbk](https://www.youtube.com/embed/hUNeD4TMwbk)T2ã€‘

# [](#case)æ¡ˆä¾‹:

ä½ éœ€è¦ä»äº§å“æœç´¢ä¸­æ”¶é›† 100 ä¸ªç»“æœã€‚ç»“æœåº”è¯¥åŒ…å«ä»¥ä¸‹ç»“æ„çš„æ–‡ç« æ ‡é¢˜å’Œå›¾åƒ urlã€‚ä¸€æ—¦è¾¾åˆ°æé™æˆ–æ²¡æœ‰å‰©ä½™å…ƒç´ ï¼Œå®ƒå¿…é¡»åœæ­¢åˆ®æ“¦ã€‚

```
[  {  "title":  "Some product title",  "img":  "https://ph-files.imgix.net/123456-abcdefghijkl"  }  ] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°†ä½¿ç”¨åä¸º`window.scrollTo`çš„å¯é æ–¹æ³•ï¼Œä½†ä¸ä½¿ç”¨`document.body.scrollHeight`ã€‚

# [](#solution)è§£:

PS:å¦‚æœè¦è¯»ç ï¼Œè·³è½¬åˆ°[æœ€ç»ˆç ](#final-code)ã€‚

æˆ‘ä»¬è¦åšçš„æ˜¯ï¼Œ

*   æˆ‘ä»¬å°†æå–é€‰æ‹©å™¨(æ˜¾ç„¶ğŸ¤·).
*   ç„¶åï¼Œæˆ‘ä»¬å°†åœ¨é¡µé¢ä¸Šæ‰¾åˆ°è¯¥é€‰æ‹©å™¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæ²¡æœ‰å…ƒç´ ï¼Œæˆ‘ä»¬å°±ä¸ä¼šç»§ç»­ã€‚
*   å°†å…ƒç´ æ»šåŠ¨åˆ°è§†å›¾ä¸­ã€‚
*   **å¯é€‰ï¼**ç­‰å¾…å‡ æ¯«ç§’ï¼Œè®©å®ƒåŠ è½½å›¾åƒï¼Œåä¹‹äº¦ç„¶ã€‚
*   ä»å…ƒç´ ä¸­æå–ä¿¡æ¯ã€‚
*   **é‡è¦ï¼**ä» dom ä¸­ç§»é™¤å…ƒç´ ã€‚
*   **é‡è¦ï¼**æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨ã€‚
*   æ‰§è¡Œä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæˆ–è€…åœ¨è¾¾åˆ°é™åˆ¶æ—¶åœæ­¢ã€‚

æ ‡è®°ä¸º**é‡è¦**çš„æ­¥éª¤æ˜¯å…³é”®ã€‚å®ƒä»¬å°†è§¦å‘é¡µé¢ä¸Šçš„æ»šåŠ¨äº‹ä»¶ï¼Œç”šè‡³ä¸éœ€è¦åƒå…¶ä»–äººä½¿ç”¨`document.body.scrollHeight`ç­‰ç­‰é‚£æ ·æ‰‹åŠ¨æ»šåŠ¨ã€‚

å¥½äº†ï¼Œç°åœ¨ä½ çŸ¥é“äº†è§£å†³æ–¹æ¡ˆï¼Œä½ å¯ä»¥ä»ä¸Šé¢çš„è§†é¢‘ä¸­ç¼–ç å‰©ä¸‹çš„éƒ¨åˆ†ã€‚

[![](../Images/b1ef4ba3146cfa974b63af9faee842dc.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--EYHKnC2t--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgflip.com/2fm7cm.jpg)

æˆ‘å¼€ç©ç¬‘çš„ğŸ˜…ï¼ä¸‹é¢æ˜¯æ­¥éª¤ï¼

## [](#extracting-the-selectors)æå–é€‰æ‹©å™¨

ä½ å¯èƒ½åšè¿‡å¾ˆå¤šæ¬¡äº†ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªç®€çŸ­çš„å›é¡¾ã€‚æˆ‘ä¸ä¼šåœ¨è¿™é‡Œç›´æ¥å†™é€‰æ‹©å™¨ï¼Œå› ä¸ºåœ¨ä½ è¯»è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å®ƒä»¬å¯èƒ½ä¼šæ”¹å˜ã€‚
æ‰“å¼€ chromeï¼ŒåŠ è½½ producthunt é¡µé¢ã€‚ç„¶åå³å‡»æ ‡é¢˜ã€‚

[![](../Images/48b963c9dc7f5ae64b3892fb772f0d52.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--BmtG-iBD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/Qg2Yh1L.png)

ç°åœ¨é€‰æ‹©ä»»ä½•ä¸€ä¸ªç±»ã€‚ä¸‹ä¸€æ­¥æˆ‘ä»¬ä¼šæ‰¾åˆ°åˆé€‚çš„ã€‚

[![](../Images/e509d36db8995056010414f5a3df0fea.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--CAs0aquo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/cd06ERt.png)

åœ¨æ§åˆ¶å°ä¸Šè®°ä¸‹ç±»åã€‚å®ƒä¼šåšä¸€ä¸ªå³æ—¶è¯„ä¼°ï¼Œæ‰€ä»¥ä½ ä¼šé©¬ä¸ŠçŸ¥é“é€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®ã€‚

[![](../Images/b7a70510752610f0fce4031e0e663ee4.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--nnQdOGQN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/4VVFsws.png)

å› ä¸ºæˆ‘ä»¬æœ‰ 27 ä¸ªç»“æœï¼Œæˆ‘ä»¬å¯èƒ½åœ¨æ­£ç¡®çš„é“è·¯ä¸Šã€‚å› ä¸ºç¬¬ä¸€æ¬¡åŠ è½½é¡µé¢æ—¶ï¼Œå¤§çº¦ä¼šæœ‰ 20-30 ä¸ªç»“æœã€‚

å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥æå–å›¾åƒçš„é€‰æ‹©å™¨ã€‚

å¹¸è¿çš„æ˜¯ï¼Œå›¾åƒé€‰æ‹©å™¨æ›´åŠ ç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ•°æ®å±æ€§ã€‚

[![](../Images/3e183efafe2dbd80fff01678b517dbf5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--aSdaNujT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/ePZ7CBS.png)

ä½†æ˜¯ï¼Œå¦‚æœç¨å¾®è°ƒæ•´ä¸€ä¸‹é€‰æ‹©å™¨ï¼Œæ‚¨ä¼šçœ‹åˆ° 27 ä¸ªäº§å“ä¸­æœ‰ 25 ä¸ªç»“æœã€‚è¿™æ„å‘³ç€å®ƒæ²¡æœ‰åŠ è½½æœ€åä¸¤ä¸ªå›¾åƒã€‚

[![](../Images/2a6e9f3389dcf5af95b2198edb23d634.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--MJxufJRV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/JklwfUQ.png)

å¦‚æœæ‚¨ç°åœ¨æ”¾å¼ƒè¿™ä¸ªé¡µé¢ï¼Œæ‚¨å°†å¾—åˆ° 25 ä¸ªåˆé€‚çš„ç»“æœã€‚å¦å¤–ï¼Œæˆ‘æå–äº†æ¯ä¸ªäº§å“åˆ—è¡¨çš„çˆ¶å…ƒç´ ã€‚

[![](../Images/5166e1d5a9434794c95fb33e7a36b310.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--u2MPqJCw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/m3fQBHQ.png)

ç°åœ¨æˆ‘çœ‹åˆ°ä¸€äº›å¥‡æ€ªçš„ä¸œè¥¿ï¼Œå®ƒè¯´ 34 ä¸ªç»“æœã€‚è¿™æ„å‘³ç€å®ƒç”šè‡³æ²¡æœ‰åŠ è½½æœ€å 7 ä¸ªç»“æœã€‚ç”šè‡³ä¸æ˜¯æ ‡é¢˜ã€‚å®ƒåœ¨é‚£é‡Œï¼Œä½†ç›®å‰æ²¡æœ‰åŠ è½½ã€‚

æœ€åï¼Œæˆ‘ä»¬æœ‰ä¸‰ä¸ªé€‰æ‹©å™¨ã€‚

*   äº§å“æ¡ç›®(å¯é€‰):`div.white_09016 ul li`
*   Title: `.title_9ddaf`
*   å›¾ç‰‡:`[data-test="post-thumbnail"] img`

è¿™äº›é€‰æ‹©å™¨å¯ä»¥éšæ—¶æ”¹å˜ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåŸºäº react çš„ç½‘ç«™ã€‚

## [](#scrape-the-data)åˆ®å–æ•°æ®

ä½ å¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸Šæ‰§è¡Œè¿™äº›ä»£ç ï¼Œæˆ–è€…ä½¿ç”¨ä¸€äº›è„šæœ¬/åº“ ie: puppeteer æœ‰ä¸€ä¸ªæ‰§è¡Œå‡½æ•°çš„`page.evaluate`æ–¹æ³•ã€‚æˆ‘å°†ä½¿ç”¨ [Scratch JS](https://chrome.google.com/webstore/detail/scratch-js/alploljligeomonipppgaahpkenfnfkn) æ¥è¿è¡Œé¡µé¢ä¸Šçš„ä»£ç ã€‚

**æŠ“å–å•ä¸ªäº§å“**
è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º`scrollAndExtract`çš„å¼‚æ­¥å‡½æ•°ï¼Œå®ƒæ¥å—åä¸º`selector`å’Œ`leaf`çš„ä¸¤ä¸ªå‚æ•°ã€‚å¶æ˜¯`innerText`å’Œ`src`ç­‰ã€‚

æˆ‘ä»¬éœ€è¦`async`,å› ä¸ºæˆ‘ä»¬å°†åœ¨å‡½æ•°ä¸­ä½¿ç”¨å»¶è¿Ÿæ¥å±•ç¤ºã€‚

```
const scrollAndExtract = async (selector, leaf) => {
  const element = document.querySelector(selector);
  if (element) {
    element.scrollIntoView();
    return element[leaf];
  }
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬è¿è¡Œå®ƒï¼Œ

```
scrollAndExtract(".title_9ddaf", "innerText").then(console.log);
scrollAndExtract('[data-test="post-thumbnail"] img', "src").then(console.log); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[![](../Images/a242dd34c1f3010b952eed7cbdf06262.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--CcTJ10b6--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/87fq1Ez.png)

é…·ï¼æˆ‘ä»¬å¾—åˆ°äº†ç¬¬ä¸€ä¸ªæ ‡é¢˜å’Œå›¾ç‰‡ urlã€‚

**æ»šåŠ¨å¹¶ç§»é™¤å…ƒç´ **

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»è§†å›¾ä¸­åˆ é™¤è¯¥å…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ å¦ä¸€ä¸ªå‚æ•°å¹¶ç¨å¾®è°ƒæ•´æˆ‘ä»¬çš„å‡½æ•°æ¥ä»¥æ›´ç®€å•çš„æ–¹å¼åšåˆ°è¿™ä¸€ç‚¹ã€‚

æˆ‘ä»¬æ¥æ·»åŠ ä¸€ä¸ª`remove`å‚æ•°ã€‚å¦‚æœæä¾›äº†ï¼Œæˆ‘ä»¬å°†åˆ é™¤è¯¥å…ƒç´ ï¼Œè€Œä¸æ˜¯æå–æ•°æ®ã€‚

```
const scrollAndExtract = async (selector, leaf, remove) => {
  const element = document.querySelector(selector);
  if (element) {
    element.scrollIntoView();
    if (remove) return element.remove(); // <-- Remove and exit
    return element[leaf];
  }
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œ

```
scrollAndExtract(".title_9ddaf", "innerText").then(() => {
  scrollAndExtract(".title_9ddaf", null, true);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

äº§å“åç§°æ¶ˆå¤±äº†ï¼Œ

[![](../Images/db189dba40427d4d13f200af6780ffae.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Pe_w9u89--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/Ktxgd56.png)

**åˆ®å›¾åƒ**

ç°åœ¨æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼æŠ“å–å›¾åƒã€‚

```
scrollAndExtract('[data-test="post-thumbnail"] img', "src").then(() => {
  scrollAndExtract('[data-test="post-thumbnail"] img', "src", true);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†ä»å›¾åƒä¸­æå– src å±æ€§ã€‚

å®ƒä»¬éƒ½å¯ä»¥åˆå¹¶æˆä¸€ä¸ªè¿”å›å¯¹è±¡çš„å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥ç¨åå°†å…¶æ¨é€åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚

```
async function extractor() {
  const title = await scrollAndExtract(".title_9ddaf", "innerText");
  await scrollAndExtract(".title_9ddaf", null, true);

  const img = await scrollAndExtract('[data-test="post-thumbnail"] img', "src");
  await scrollAndExtract('[data-test="post-thumbnail"] img', null, true);

  return { title, img };
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œ

```
extractor().then(console.log); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[![](../Images/7c5e6cbcbff8be573294c3ce45eef47f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--DGMbq_TG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/YsZ64Fw.png)

**å¯é€‰:ç§»é™¤æ ‡é¢˜å’Œå›¾åƒçš„çˆ¶å®¹å™¨**
è®©æˆ‘ä»¬åœ¨æŠ“å–æ ‡é¢˜åç§»é™¤çˆ¶å…ƒç´ ã€‚

è¿™æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºå³ä½¿æ²¡æœ‰å®ƒï¼Œé€»è¾‘ä¹Ÿèƒ½å·¥ä½œã€‚ä½†æ˜¯è¿™å°†ä¸ºæˆ‘ä»¬èŠ‚çœä¸€äº›è§†çª—ç©ºé—´å’Œå†…å­˜ï¼Œå› ä¸ºæˆ‘ä»¬åˆ é™¤äº† dom å…ƒç´ ã€‚

æˆ‘ä»¬å¯ä»¥åˆ é™¤çˆ¶å®¹å™¨ï¼Œä¸å¿…æ‹…å¿ƒåˆ é™¤å›¾åƒæˆ–æ ‡é¢˜å…ƒç´ ï¼Œå› ä¸ºå®ƒä¹Ÿä¼šè¢«åˆ é™¤ã€‚

```
async function extractor() {
  const title = await scrollAndExtract(".title_9ddaf", "innerText");
  const img = await scrollAndExtract('[data-test="post-thumbnail"] img', "src");

  // remove the parent here
  await scrollAndExtract("div.white_09016 ul li", null, true);
  return { title, img };
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒåº”è¯¥å¯ä»¥å®Œç¾çš„å·¥ä½œï¼Œ

[![](../Images/009a5010a029cf11742654eab77057bb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--wxsHiran--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/jFyI3rb.png)

**éå† 100 ä¸ªå…ƒç´ **
æˆ‘ä»¬ä¸ä¼šä½¿ç”¨ä¼ ç»Ÿçš„ for å¾ªç¯ã€‚æˆ‘ä»¬å°†ä½¿ç”¨é€’å½’æ¥ä»£æ›¿ã€‚

è®©æˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ªå‡½æ•°æ¥é€ä¸ªéå†å…ƒç´ ã€‚æˆ‘ä»¬å°†ç»“æœå­˜å‚¨åœ¨ä¸€ä¸ªç»“æœæ•°ç»„ä¸­ã€‚

```
const products = [];
async function hundredProducts() {
  if (products.length < 100) {
    const data = await extractor();
    if (!data.title || !data.img) return null;

    products.push(data);
    return hundredProducts();
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†ä¸ºæˆ‘ä»¬æŠ“å–å‰ä¸€ç™¾ä¸ªå…ƒç´ ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå¦‚æœæå–å™¨æ²¡æœ‰ç»“æœï¼Œå®ƒå°†åœæ­¢å¾ªç¯ã€‚

æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹`products`æ•°ç»„æ¥è·å–æˆ‘ä»¬çš„ç»“æœã€‚

```
hundredProducts().then(() => console.log(products)); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[![](../Images/3177a37bf84453706190c40087d0e6d9.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--jRjhY2bd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/CXFoJqD.png)

ç„¶åç °ï¼

æˆ‘ä»¬å¾—åˆ°äº† 7 ä¸ªç»“æœï¼

[![](../Images/3d8977fc32d38e6e7cba136d2f2eb9f8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--aYh0aMz0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/gDvnQEu.png)

ç­‰ç­‰æ„¤æ€’ï¼Ÿ

**ç»™å»¶è¿ŸåŠ è½½çš„äº§å“æ•°æ®åŠ ä¸Šå›¾ç‰‡**
å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬åªå¾—åˆ° 7 ä¸ªç»“æœã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å‘Šè¯‰å®ƒåœæ­¢å¾ªç¯ï¼Œå¦‚æœæ²¡æœ‰å›¾åƒ/æ ‡é¢˜ã€‚å®ƒæ»šåŠ¨å¾—å¤ªå¿«ï¼Œæ— æ³•è§¦å‘ä»»ä½•æ»šåŠ¨äº‹ä»¶å’ŒåŠ è½½æ–°æ•°æ®ã€‚

è®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å»¶è¿Ÿå‡½æ•°ï¼Œå®ƒä¼šåœ¨è¿è¡Œå¾ªç¯ä¹‹å‰ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚

```
const delay = d => new Promise(r => setTimeout(r, d)); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨ã€‚

```
const products = [];
async function hundredProducts() {
  if (products.length < 100) {
    // Let's wait 0.5 seconds before moving to next one
    await delay(500);
    // also trigger a scroll event just in case
    window.scrollTo(0, 0);

    const data = await extractor();
    if (!data.title || !data.img) return null;

    products.push(data);
    return hundredProducts();
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

[![](../Images/58622fc583ddeedbfb91bd2bde743185.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--QpoPJ2Nt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/bbxF2lp.png)

**æœ€ç»ˆç»“æœ**
å¥½å§ï¼è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å¸–å­ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªè„šæœ¬å’Œé€»è¾‘æ¥æŠ“å–åƒ producthunt è¿™æ ·çš„æ— é™æ»šåŠ¨é¡µé¢ã€‚

ä¸‹é¢æ˜¯æ‚¨å¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸Šè¿è¡Œçš„å®Œæ•´ä»£ç ã€‚ç¡®ä¿å–æ¶ˆæ³¨é‡Šè¿è¡Œ`hundredProducts()`çš„è¡Œï¼Œç„¶åè®°å½•`products`æ•°ç»„ã€‚

```
const delay = d => new Promise(r => setTimeout(r, d));

const scrollAndExtract = async (selector, leaf, remove) => {
  const element = document.querySelector(selector);
  if (element) {
    element.scrollIntoView();
    if (remove) return element.remove(); // <-- Remove and exit
    return element[leaf];
  }
};

async function extractor() {
  const title = await scrollAndExtract(".title_9ddaf", "innerText");
  const img = await scrollAndExtract('[data-test="post-thumbnail"] img', "src");

  // remove the parent here
  await scrollAndExtract("div.white_09016 ul li", null, true);
  return { title, img };
}

const products = [];
async function hundredProducts() {
  if (products.length < 100) {
    await delay(500);
    window.scrollTo(0, 0);

    const data = await extractor();
    if (!data.title || !data.img) return null;

    products.push(data);
    return hundredProducts();
  }
}

// hundredProducts().then(() => console.log(products)) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#optional-puppeteer-script)å¯é€‰:æœ¨å¶å‰§æœ¬

å¦‚æœä½ æƒ³ç”¨ puppeteer è‡ªåŠ¨å®Œæˆï¼Œä½ å¯ä»¥æŠŠä»£ç æ”¾åœ¨ä¸€ä¸ª`page.evaluate`å‡½æ•°ä¸­ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªç‰‡æ®µï¼Œè¿™é‡Œæ˜¯æœ‰å®Œæ•´ä»£ç çš„ [**git repo**](https://github.com/entrptaher/plaground-scrape-infinity-load) ã€‚

```
const puppeteer = require("puppeteer");

(async () => {
  const browser = await puppeteer.launch();
  const page = await browser.newPage();
  await page.goto("https://www.producthunt.com");
  const productList = await page.evaluate(async () => {
    // paste the final code here
    // ...
    // run the function to grab data
    await hundredProducts();
    // and return the product from inside the page
    return products;
  });

  await browser.close();
})(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#closing-thoughts)å…³é—­æ€ç»ª

è¿™çœ‹èµ·æ¥æ¯”äº’è”ç½‘ä¸Šæ‰€æœ‰å…¶ä»–å¸–å­å¤§åå€ã€‚ä½†æ˜¯ä½ çŸ¥é“ä¸Šé¢çš„åŸå§‹ç‰ˆæœ¬ä¹Ÿè¦å°å¾—å¤šã€‚æ²¡æœ‰ç–¯ç‹‚çš„æ»šåŠ¨é«˜åº¦æˆ–å…¶ä»–ã€‚

ä½†å¸Œæœ›æˆ‘èƒ½å‘ä½ å±•ç¤ºä¸€ç§ä¸åŒäºä½ é€šå¸¸åˆ®çš„æ–¹å¼ã€‚è¯·éšæ„æ‘†å¼„å’Œè¯•éªŒè¿™äº›æ•°æ®ã€‚

è®©æˆ‘çŸ¥é“ä½ å¯¹è¿™ç§æ–¹æ³•çš„çœ‹æ³•ï¼Œä»¥åŠä½ è®¤ä¸ºä¸€èˆ¬æ¥è¯´æŠ“å–æ— é™æ»šåŠ¨é¡µé¢çš„æœ€å¥½æ–¹æ³•ã€‚