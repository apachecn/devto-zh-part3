# æ³¨æ„ App -ç¬¬ 1 éƒ¨åˆ†:è®¾ç½®èŠ‚ç‚¹ API

> åŸæ–‡:[https://dev . to/akhilaariyachandra/note-app-part-1-setup-the-node-API-48p 9](https://dev.to/akhilaariyachandra/note-app-part-1-setup-the-node-api-48p9)

> è¿™æœ€åˆå‘å¸ƒåœ¨æˆ‘çš„åšå®¢ä¸Šã€‚å¦‚æœæ‚¨æƒ³äº†è§£ React å’Œ JavaScript çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹å®ƒï¼

åœ¨è¿™ä¸ªç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Nodeã€MongoDB & React åˆ›å»ºä¸€ä¸ª notes åº”ç”¨ç¨‹åºã€‚å¯¹äºç¬¬ä¸€éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬è®¾ç½® APIã€‚

æˆ‘å°†ä½¿ç”¨ **yarn** ä½œä¸ºæˆ‘çš„åŒ…ç®¡ç†å™¨ï¼Œä½†ä¹Ÿå¯ä»¥éšæ„ä½¿ç”¨ **npm** æˆ– **pnpm** æ¥ä»£æ›¿ã€‚

# [](#initialize-the-project)åˆå§‹åŒ–é¡¹ç›®

é¦–å…ˆè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º**â€˜notes-APIâ€™**çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­ä½¿ç”¨
åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®

```
yarn init --yes 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°†ä½¿ç”¨ [Backpack](https://github.com/jaredpalmer/backpack) æ¥æ„å»ºå’Œè¿è¡Œæˆ‘ä»¬çš„ APIï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æŠŠå®ƒä½œä¸ºä¸€ä¸ªå¼€å‘ä¾èµ–é¡¹æ¥å®‰è£…ã€‚**èƒŒåŒ…**æœ‰ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å½“ä»»ä½•æ–‡ä»¶æ”¹å˜æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½æœåŠ¡å™¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨æ²¡æœ‰ä»»ä½•é…ç½®çš„æƒ…å†µä¸‹è¿è¡Œ ES6 ä»£ç ã€‚

```
yarn add backpack-core -D 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åå°†ä»¥ä¸‹è„šæœ¬æ·»åŠ åˆ°`package.json`ã€‚

```
{  "scripts":  {  "dev":  "backpack",  "build":  "backpack build"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`yarn dev`ç”¨äºå¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œ`yarn build`ç”¨äºè·å¾—ç”Ÿäº§ç‰ˆæœ¬ã€‚

# [](#setup-the-database)è®¾ç½®æ•°æ®åº“

æ¥ä¸‹æ¥è®©æˆ‘ä»¬è®¾ç½® MongoDB æ•°æ®åº“ã€‚å¦‚æœä½ æƒ³è¦ä¸€ä¸ªå…³äºè®¾ç½®æ•°æ®åº“çš„æ›´è¯¦ç»†çš„è§£é‡Šï¼Œä½ å¯ä»¥çœ‹çœ‹æˆ‘ä»¥å‰çš„å¸–å­[ç”¨ mongose](https://akhilaariyachandra.com/post/setup-mongodb-in-nodejs-with-mongoose/)åœ¨ Node.js ä¸­è®¾ç½® MongoDBã€‚

æˆ‘ä»¬å°†ç”¨ [mLab](https://mlab.com/) åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ã€‚åˆ›å»ºä¹‹åï¼Œåº”è¯¥ä¸ºæ•°æ®åº“åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶è®°ä¸‹å®ƒçš„è·¯å¾„ã€‚è·¯å¾„åº”è¯¥ç±»ä¼¼äº`mongodb://<dbuser>:<dbpassword>@ds250607.mlab.com:38485/notes-db`ï¼Œå…¶ä¸­`<dbuser>`å’Œ`<dbpassword>`åˆ†åˆ«æ˜¯æ‚¨ä¸ºæ•°æ®åº“åˆ›å»ºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚

ç„¶åå®‰è£…**çŒ«é¼¬**ä¾èµ–ã€‚

```
yarn add mongoose 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¹‹åï¼Œåœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªåä¸º**â€˜srcâ€™**çš„æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º`database.js`çš„æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æ’å…¥ä»¥ä¸‹ä»£ç ã€‚

```
// src/database.js
// Import the dependency
import mongoose from "mongoose";

// The database path
const dbPath =
  "mongodb://<dbuser>:<dbpassword>@ds250607.mlab.com:38485/test-db";

// Connect the database
mongoose.connect(dbPath, {
  useNewUrlParser: true
});

// Check if the API successfully connected to the database
const db = mongoose.connection;
db.on("error", () => {
  console.log("> error occurred from the database");
});
db.once("open", () => {
  console.log("> successfully opened the database");
});

// Export the database instance
export default mongoose; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç”¨æ•°æ®åº“çš„è·¯å¾„æ›¿æ¢`dbPath`çš„å€¼ã€‚

# [](#create-the-notes-model)åˆ›å»º notes æ¨¡å‹

ä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†æ•°æ®åº“çš„è®¾ç½®ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ¨¡å‹æ¥å¯¹æ•°æ®åº“æ‰§è¡Œ **CRUD** (åˆ›å»ºã€æ£€ç´¢ã€æ›´æ–°&åˆ é™¤)æ“ä½œã€‚

é¦–å…ˆåœ¨**ã€srcã€‘**ä¸­åˆ›å»ºä¸€ä¸ªåä¸º**ã€è½¦å‹ã€‘**çš„æ–‡ä»¶å¤¹ã€‚ç„¶ååœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`noteModel.js`çš„æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ã€‚

```
// src/models/noteModel.js
// Import the database instance
import mongoose from "../database";

// Define the schema for a note
const schema = {
  title: { type: mongoose.SchemaTypes.String, required: true },
  content: { type: mongoose.SchemaTypes.String, required: true }
};

const collectionName = "notes"; // Name of the collection of documents
const noteSchema = mongoose.Schema(schema);
const Note = mongoose.model(collectionName, noteSchema);

// Export the Note model
export default Note; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#setup-the-server-and-routes)è®¾ç½®æœåŠ¡å™¨å’Œè·¯ç”±

ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®äº†æ•°æ®åº“å’Œç”¨æˆ·æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ä¸º API åˆ›å»ºæœåŠ¡å™¨å’Œè·¯ç”±äº†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ [Express](https://expressjs.com/) åˆ›å»ºæœåŠ¡å™¨ã€‚

è®©æˆ‘ä»¬å®‰è£…ä¾èµ–é¡¹

```
yarn add express body-parser cors 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¾èµ–é¡¹å®‰è£…å®Œæˆåï¼Œåœ¨**â€˜srcâ€™**ä¸­åˆ›å»ºæ–‡ä»¶`index.js`ï¼Œä»£ç ä¸º

```
// src/index.js
// Import the dependencies
import express from "express";
import bodyParser from "body-parser";
import cors from "cors";
import Note from "./models/noteModel";

// Create a new instance of the express server
const app = express();

// Apply middleware
app.use(bodyParser.json({ type: "application/json" })).use(
  cors({
    methods: ["POST", "GET", "PUT", "DELETE"],
    allowedHeaders: [
      "Access-Control-Allow-Origin",
      "Content-Type",
      "x-access-token"
    ]
  })
);

/**
 * We'll define our routes here for the CRUD operations
 */

// Set port number
const portNo = process.env.PORT || 8080;

// Start server
app.listen(portNo, () => {
  console.log(`> Server listening at http://localhost:${portNo}`);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åªæ˜¯ä¸ºäº†ç¡®ä¿æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢æ‰€åšçš„å·¥ä½œè¿è¡Œè‰¯å¥½ã€‚å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå®ƒåº”è¯¥æ˜¾ç¤º

```
> Server listening at http://localhost:8080
> successfully opened the database 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬ç”¨ **Ctrl+C** åœæ­¢æœåŠ¡å™¨ï¼Œå¹¶ç»§ç»­åœ¨ API ä¸­æ·»åŠ è·¯ç”±ã€‚

æˆ‘ä»¬çš„ç¬¬ä¸€æ¡è·¯çº¿å°†æ˜¯åˆ›å»ºæ–°çš„ç¬”è®°ã€‚

```
// Route to save a new note - POST method
app.post("/note", async (req, res) => {
  try {
    // Save note to DB
    const result = await Note.create({
      title: req.body.title,
      content: req.body.content
    });

    // Send the result of the save function as the server response
    return res.json(result);
  } catch (error) {
    // Handle error
    // Display error in console
    console.log(error);
  }
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸‹ä¸€æ¡è·¯çº¿æ˜¯è·å–æ•´ä¸ªç¬”è®°åˆ—è¡¨

```
// Route to get all the notes - GET method
app.get("/note", async (req, res) => {
  try {
    // Get all notes from the database
    const result = await Note.find({}).exec();

    // Send the results as the server response
    return res.json(result);
  } catch (error) {
    // Handle error
    // Display error in console
    console.log(error);
  }
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬éœ€è¦ä¸€æ¡è·¯çº¿æ¥æ ¹æ® ID å¾—åˆ°ä¸€å¼ çº¸æ¡ã€‚

```
// Route to get one note based on the ID - GET method
app.get("/note/:id", async (req, res) => {
  try {
    // Get the ID
    const id = req.params.id;

    // Find the note from the ID
    const result = await Note.findById(id).exec();

    // Send the result as the server response
    return res.json(result);
  } catch (error) {
    // Handle error
    // Display error in console
    console.log(error);
  }
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å€’æ•°ç¬¬äºŒæ¡è·¯çº¿æ˜¯æ›´æ–°ä¸€æ¡æ³¨é‡Šã€‚

```
// Route to update a note - PUT method
app.put("/note/:id", async (req, res) => {
  try {
    // Get the ID
    const id = req.params.id;

    // Update the note
    const result = await Note.findByIdAndUpdate(id, {
      title: req.body.title,
      content: req.body.content
    }).exec();

    // Send the result as the server response
    return res.json(result);
  } catch (error) {
    // Handle error
    // Display error in console
    console.log(error);
  }
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æœ€åçš„æ–¹æ³•æ˜¯åˆ é™¤ä¸€æ¡æ³¨é‡Šã€‚

```
// Route to delete a note - DELETE method
app.delete("/note/:id", async (req, res) => {
  try {
    // Get the ID
    const id = req.params.id;

    // Delete the note
    const result = await Note.findByIdAndDelete(id).exec();

    // Send the result as the server response
    return res.json(result);
  } catch (error) {
    // Handle error
    // Display error in console
    console.log(error);
  }
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€å`index.js`åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚

```
// src/index.js
// Import the dependencies
import express from "express";
import bodyParser from "body-parser";
import cors from "cors";
import Note from "./models/noteModel";

// Create a new instance of the express server
const app = express();

// Apply middleware
app.use(bodyParser.json({ type: "application/json" })).use(
  cors({
    methods: ["POST", "GET", "PUT", "DELETE"],
    allowedHeaders: [
      "Access-Control-Allow-Origin",
      "Content-Type",
      "x-access-token"
    ]
  })
);

// Route to save a new note - POST method
app.post("/note", async (req, res) => {
  try {
    // Save note to DB
    const result = await Note.create({
      title: req.body.title,
      content: req.body.content
    });

    // Send the result of the save function as the server response
    return res.json(result);
  } catch (error) {
    // Handle error
    // Display error in console
    console.log(error);
  }
});

// Route to get all the notes - GET method
app.get("/note", async (req, res) => {
  try {
    // Get all notes from the database
    const result = await Note.find({}).exec();

    // Send the results as the server response
    return res.json(result);
  } catch (error) {
    // Handle error
    // Display error in console
    console.log(error);
  }
});

// Route to get one note based on the ID - GET method
app.get("/note/:id", async (req, res) => {
  try {
    // Get the ID
    const id = req.params.id;

    // Find the note from the ID
    const result = await Note.findById(id).exec();

    // Send the result as the server response
    return res.json(result);
  } catch (error) {
    // Handle error
    // Display error in console
    console.log(error);
  }
});

// Route to update a note - PUT method
app.put("/note/:id", async (req, res) => {
  try {
    // Get the ID
    const id = req.params.id;

    // Update the note
    const result = await Note.findByIdAndUpdate(id, {
      title: req.body.title,
      content: req.body.content
    }).exec();

    // Send the result as the server response
    return res.json(result);
  } catch (error) {
    // Handle error
    // Display error in console
    console.log(error);
  }
});

// Route to delete a note - DELETE method
app.delete("/note/:id", async (req, res) => {
  try {
    // Get the ID
    const id = req.params.id;

    // Delete the note
    const result = await Note.findByIdAndDelete(id).exec();

    // Send the result as the server response
    return res.json(result);
  } catch (error) {
    // Handle error
    // Display error in console
    console.log(error);
  }
});

// Set port number
const portNo = process.env.PORT || 8080;

// Start server
app.listen(portNo, () => {
  console.log(`> Server listening at http://localhost:${portNo}`);
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#wrapping-up)åŒ…è£…å®Œæ¯•

æˆ‘æ•…æ„çœç•¥äº†æµ‹è¯• APIï¼Œå› ä¸ºæˆ‘ä¸æƒ³è®©è¿™ç¯‡æ–‡ç« å¤ªé•¿ï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨åƒ[é‚®å·®](https://www.getpostman.com/)æˆ–[å¤±çœ ](https://insomnia.rest/)è¿™æ ·çš„è½¯ä»¶æ¥æµ‹è¯• APIã€‚
æˆ‘çš„ä¸‹ä¸€ç¯‡æ–‡ç« å°†æ˜¯å…³äºåˆ›å»ºä¸€ä¸ªä½¿ç”¨ React çš„å‰ç«¯æ¥ä½¿ç”¨è¿™ä¸ª APIã€‚
æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ã€‚å¦‚æœä½ å¯¹æˆ‘å¦‚ä½•æ”¹è¿›æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åœ¨ä¸‹é¢ç•™è¨€ï¼ğŸ˜Š