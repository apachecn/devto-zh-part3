# ä½¿ç”¨ GitLab CI å‘ Sentry æä¾› Angular çš„æºä»£ç 

> åŸæ–‡:[https://dev . to/kapros/make-angular-s-source-code-available-to-sentry-with-git lab-ci-2 ngj](https://dev.to/kapros/make-angular-s-source-code-available-to-sentry-with-gitlab-ci-2ngj)

<figure>[![](../Images/08d68bc3fb5040fa04f74109d9bdb882.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Y4Uc4yWI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2A3I5cszV_0FUDtgaO_Z1oIA.jpeg) 

<figcaption>æ¥æº:[pixabay.com](https://pixabay.com/en/gummib%C3%A4rchen-fruit-gums-bear-359950/)</figcaption>

</figure>

åœ¨ [COVIS](https://twitter.com/COVIS_GmbH) æˆ‘ä»¬å·²ç»ä½¿ç”¨ [GitLab](https://about.gitlab.com/) ã€ [Sentry](https://sentry.io/welcome/) å’Œ [Angular](https://angular.io/) ä¸€æ®µæ—¶é—´äº†ã€‚ç›´åˆ°æœ€è¿‘ï¼Œä¸º Angular åº”ç”¨ç¨‹åºæ„å»ºå¿…è¦çš„æºåœ°å›¾æ–‡ä»¶å¹¶è®©å®ƒä»¬å¯¹ Sentry å¯ç”¨è¿˜ä¸æ˜¯å¾ˆç®€å•ã€‚å¦‚æœæ²¡æœ‰æºæ˜ å°„æ–‡ä»¶ï¼Œå¼‚å¸¸çš„å †æ ˆè·Ÿè¸ªå°±ä¸æ˜¯å¾ˆæœ‰ç”¨ã€‚

åœ¨æœ¬å¸–ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•:

1.  å°† Sentry ä¸ GitLab é›†æˆ
2.  è®¾ç½® GitLab CI ç®¡é“ï¼Œå°† Angular åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° GitLab é¡µé¢
3.  æ‰©å±•æˆ‘ä»¬çš„ç®¡é“ï¼Œä»¥å»ºç«‹æºåœ°å›¾æ–‡ä»¶ï¼Œå¹¶ä¸Šä¼ åˆ°å“¨å…µ

æ³¨æ„:è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡å¸–å­ï¼Œæ‰€ä»¥è¯·æ¸©å’Œä¸€ç‚¹ï¼Œæˆ‘æœŸå¾…ä½ çš„åé¦ˆğŸ˜Šã€‚æˆ‘ä»¬å°†åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä½¿ç”¨ SaaS ç‰ˆæœ¬çš„å“¨å…µã€‚ä½ å¿…é¡»åœ¨ GitLab å’Œ Sentry ä¸Šåˆ›å»ºè´¦æˆ·(å…è´¹å±‚ä¹Ÿå¯ä»¥)ã€‚

### [](#introduction)ç®€ä»‹

ç°åœ¨å¾ˆéš¾æƒ³è±¡æ²¡æœ‰ git ç¼–å†™ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ [GitLab](https://about.gitlab.com/) æ˜¯ä¸€ä¸ªå®Œæ•´çš„ DevOps å·¥å…·ï¼Œå¯ä»¥ä½œä¸ºæºä»£ç åº“ã€æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜å·¥å…·ã€‚GitLab å»å¹´å› ä¸º [#movetogitlab](https://about.gitlab.com/2018/06/03/movingtogitlab/) çš„äº‹æƒ…å˜å¾—éå¸¸å—æ¬¢è¿(é¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘ä¹Ÿå–œæ¬¢ GitHub)ã€‚

Sentry æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œåœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæŠ•å…¥ç”Ÿäº§åï¼Œå®ƒå¯ä»¥æä¾›å¸®åŠ©ã€‚å®ƒæä¾›äº†ä¸€å¥—ä¸°å¯Œçš„[åŠŸèƒ½](https://sentry.io/features/)ï¼Œç”¨äºæ”¶é›†ã€è¯†åˆ«å’Œç†è§£å¯èƒ½å‡ºç°çš„é—®é¢˜ã€‚

ä½†æ˜¯ Angular åº”ç”¨ç¨‹åºæ˜¯ç”¨ TypeScript ç¼–å†™çš„ï¼Œæˆ‘ä»¬çš„æºä»£ç è¢«ç¼–è¯‘ã€ç¼©å°ã€ä¸‘åŒ–ï¼Œç°åœ¨è¦ç†è§£æˆ‘ä»¬è®°å½•çš„å¼‚å¸¸å †æ ˆè·Ÿè¸ªå¹¶æ‰¾å‡ºé”™è¯¯æ˜¯ä»€ä¹ˆå˜å¾—éå¸¸å›°éš¾ï¼

åœ¨æœ¬å¸–ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ„å»ºè¿‡ç¨‹ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ Sentry çš„å¼‚å¸¸å †æ ˆè·Ÿè¸ªä¸­çœ‹åˆ°åŸå§‹çš„ TypeScript æºä»£ç ã€‚

### [](#integrate-sentry-with-gitlab)é›†æˆå“¨å…µå’Œ GitLab

æˆ‘ä»¬å°†ä»åˆ›å»ºä¸€ä¸ªæ–°çš„ GitLab ç»„å’Œå­˜å‚¨åº“å¼€å§‹ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†åˆ›å»ºæˆ‘ä»¬çš„ Sentry é¡¹ç›®ï¼Œå¹¶å®ç° Sentry é¡¹ç›®å’Œ GitLab å­˜å‚¨åº“ä¹‹é—´çš„é›†æˆã€‚

åœ¨ GitLab ä¸Šï¼Œä»é¡¶éƒ¨èœå•ç‚¹å‡»**ç»„**ï¼Œç‚¹å‡»ç»¿è‰²æŒ‰é’®**æ–°å»ºç»„**ã€‚æˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„å°ç»„å‘½åä¸º*ã€è§’å½¢å“¨å…µæ¼”ç¤ºã€‘*

ä¸€æ—¦ç»„è¢«åˆ›å»ºï¼Œç‚¹å‡»ç»¿è‰²æŒ‰é’®**æ–°å»ºé¡¹ç›®**ã€‚æˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„é¡¹ç›®å‘½åä¸º*â€œdemo-ng-appâ€*

<figure>[![](../Images/45d7716faa808760b0ab36446c9e4b89.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--fux45ZTR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2A4P2a1aO2rmJRzd-PUcOLZg.png) 

<figcaption>åˆ›å»º GitLab é¡¹ç›®</figcaption>

</figure>

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å“¨å…µé¡¹ç›®ã€‚å¯¼èˆªåˆ°[https://sentry.io/signup](https://sentry.io/signup/)å¹¶åˆ›å»ºä¸€ä¸ªå¸æˆ·(å¦‚æœæ‚¨è¿˜æ²¡æœ‰)ã€‚ä¸€æ—¦ä½ æœ‰äº†è‡ªå·±çš„è´¦æˆ·ï¼Œç‚¹å‡»*â€œåˆ›å»ºé¡¹ç›®â€*æŒ‰é’®ã€‚æˆ‘ä»¬å°†æˆ‘ä»¬çš„é¡¹ç›®å‘½åä¸º*â€œdemo-git lab-ngâ€ï¼Œå¹¶é€‰æ‹© Angular SDK:*

[![](../Images/777dad3f80c5a913943b95a4cf8eae39.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--JN9VJsRy--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/699/1%2As7IBK7zqIdZhB3Uy650iaw.png)

<figure>[![](../Images/36ef96e3442f91cf21a9749225001a9d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--FEqEyNlw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AS4pg8KfUDRalTvZ1ZW2DOA.png) 

<figcaption>dempSentry é¡¹ç›®åˆ›å»º</figcaption>

</figure>

ä¸€æ—¦æ‚¨çš„é¡¹ç›®å‡†å¤‡å°±ç»ªï¼Œå¿«é€Ÿå…¥é—¨ç¤ºä¾‹ä»£ç å°†ä¼šå‘ˆç°ç»™æ‚¨ï¼Œæ˜¾ç¤ºæ‚¨çš„é¡¹ç›®çš„ DSNã€‚DSN æ˜¯æœ€é‡è¦çš„ï¼Œå› ä¸ºå®ƒå‘Šè¯‰ SDK å°†äº‹ä»¶å‘é€åˆ°å“ªé‡Œã€‚ä½ å¯ä»¥åœ¨ Sentry çš„â€œé¡¹ç›®è®¾ç½®â€çš„â€œå®¢æˆ·ç«¯å¯†é’¥â€éƒ¨åˆ†æ‰¾åˆ°é¡¹ç›®çš„ DSNã€‚æˆ‘ä»¬å°†åœ¨ç¨åé…ç½® SDK æ—¶ä½¿ç”¨ DSNã€‚

å¤ªå¥½äº†ï¼ç°åœ¨è®©æˆ‘ä»¬æ‰§è¡Œä¸ GitLab çš„é›†æˆã€‚è¯·éµå¾ªå“¨å…µæ‰‹å†Œä¸­çš„æ­¥éª¤ 1-9:

[GitLab](https://docs.sentry.io/workflow/integrations/global-integrations/gitlab/)

ğŸ‘æˆ‘ä»¬å·²ç»æˆåŠŸæ•´åˆäº† GitLab å’Œ Sentryï¼ç°åœ¨è®©æˆ‘ä»¬ç»§ç»­åˆ›å»ºæˆ‘ä»¬çš„ç¤ºä¾‹è§’åº¦åº”ç”¨ç¨‹åºã€‚

### [](#setup-gitlab-ci-pipelines-that-deploys-an-angular-app-to-gitlab-pages)è®¾ç½® GitLab CI ç®¡é“ï¼Œå°† Angular åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° GitLab é¡µé¢

æˆ‘ä»¬ç°åœ¨å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ Angular åº”ç”¨ç¨‹åºå¹¶å®‰è£… Sentry SDKã€‚è¿™å°†å…è®¸æˆ‘ä»¬ä»åº”ç”¨ç¨‹åºä¸­æ•è·å¼‚å¸¸ï¼Œä½†æ˜¯æ˜¯åœ¨ç”Ÿæˆçš„ä»£ç ä¸Šã€‚åœ¨æœ€åä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†æ”¹å˜è¿™ä¸€ç‚¹ã€‚

#### [](#create-new-angular-app)æ–°å»º Angular app

æˆ‘ä»¬å°†ä½¿ç”¨ [Angular CLI](https://cli.angular.io/) :
çš„ ng new å‘½ä»¤åˆ›å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åº

```
ng new demo-ng-app
cd demo-ng-app 
```

ç„¶åï¼Œæˆ‘ä»¬å°†æŠŠç”Ÿæˆçš„åº”ç”¨ç¨‹åºæ·»åŠ åˆ° GitLab å­˜å‚¨åº“ä¸­:

```
git remote add origin git@gitlab.com:angular-sentry-demo/demo-ng-app.git
git push -u origin master 
```

#### [](#add-sentry-sdk-to-angular)ç»™ Angular æ·»åŠ å“¨å…µ SDK

è®©æˆ‘ä»¬åœ¨æ–°åˆ›å»ºçš„åº”ç”¨ç¨‹åºä¸Šå®‰è£… Sentry SDKã€‚æˆ‘ä»¬å°†éµå¾ªæŒ‡ä»¤

```
npm i -S [@sentry/browser](http://twitter.com/sentry/browser) 
```

ç°åœ¨ï¼Œæˆ‘ä»¬å°†æŒ‰ç…§ Sentry æ–‡æ¡£ä¸­çš„è¯´æ˜é…ç½® SDK:

[è§’åº¦](https://docs.sentry.io/platforms/javascript/angular/)

**æ³¨æ„** : Sentry æ–‡æ¡£è¶³å¤Ÿæ™ºèƒ½ï¼Œå¯ä»¥ä¸ºæ‚¨æä¾›å¸¦æœ‰æ‚¨è‡ªå·±çš„ DSN çš„ç‰‡æ®µã€‚

å°±æ˜¯è¿™æ ·ï¼ç°åœ¨ä»»ä½•æœªå¤„ç†çš„å¼‚å¸¸å°†è¢«å‘é€åˆ°å“¨å…µï¼ä½†æ˜¯è¿™æ˜¯æ€ä¹ˆå‘ç”Ÿçš„å‘¢ï¼Ÿä¸Šé¢çš„ä»£ç ç‰‡æ®µå®ç°äº† Angular çš„ ErrorHandler ç±»ï¼Œå®ƒä¸ºé›†ä¸­å¼å¼‚å¸¸å¤„ç†æä¾›äº†ä¸€ä¸ªé’©å­ã€‚åœ¨ handleError æ–¹æ³•ä¸­ï¼Œåœ¨æˆ‘ä»¬é‡æ–°æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œä½¿ç”¨ captureException()æ–¹æ³•å°†å¼‚å¸¸å‘é€ç»™ Sentryã€‚å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹ä¸¤ä¸ªé“¾æ¥:

*   [è§’åº¦](https://angular.io/api/core/ErrorHandler)
*   [æ•æ‰äº‹ä»¶](https://docs.sentry.io/error-reporting/capturing/?platform=browser#capturing-errors--exceptions)

ç°åœ¨æ˜¯å‘å“¨å…µå‘å‡ºç¬¬ä¸€ä¸ªä¾‹å¤–çš„æ—¶å€™äº†ã€‚æˆ‘ä»¬å°†å®ç°ä¸€ä¸ªå¼•å‘å¼‚å¸¸ç®€å•æŒ‰é’®: