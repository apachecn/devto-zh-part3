# ååº”ä¸Šä¸‹æ–‡ API

> åŸæ–‡:[https://dev.to/gugadev/react-ä¸Šä¸‹æ–‡-api-490](https://dev.to/gugadev/react---context-api-490)

ç›´åˆ°å‘è¡Œç‰ˆæœ¬ 16 ä¹‹å‰ï¼Œåªæœ‰ä¸€ç§åŸç”Ÿæ–¹å¼-åœ¨å…ƒä»¶ä¹‹é—´å…±ç”¨å±æ€§ï¼Œæ˜¯é€è¿‡ã€Œ*prop drilling*æˆ–*drill*è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå±æ€§åœ¨é¢„å…ˆè®¾å®šçš„é˜¶å±‚ä¸­ç”±ä¸Šè€Œä¸‹æµåŠ¨ã€‚

## [](#prop-drilling-y-redux)æ”¯æŸ±é’» y Redux

é€šå¸¸æœ‰å¦‚ä¸‹éƒ¨ä»¶:

```
class Me extends React.Component<P, S> {
  state = {
    lastName = 'Garzaki'
  }
  render = _ => (
    <div>
      <p>Hola, yo soy Gustavo {this.state.lastName} y mi niÃ±a se llama </p>
      <Child lastName={this.state.lastName} />
    </div>
  )
}

class Child extends React.Component<P, S> {
  render = _ => (
    <p>MÃ­a {this.props.lastName}</p>
  )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°±æ˜¯æ‰€è°“çš„*å±æ€§é’»*ï¼Œå®ƒä¸è¿‡æ˜¯æŠŠè´¢äº§ä»çˆ¶ä¼ ç»™å­ã€ä»å­ä¼ ç»™å­™ã€ä»å­™ä¼ ç»™å­™ç­‰ç­‰ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¯¸å¦‚ Reduxã€Mobx ç­‰ React çš„æ–°çš„è¡¥å……åº“é™†ç»­é—®ä¸–ï¼Œå®ƒä»¬æ‰€æä¾›çš„æ˜¯ä¸€ç§â€œT4â€äº’è¿çŠ¶æ€å¤„ç†ï¼Œè¿™ç§å¤„ç†æ˜¯å…¨çƒæ€§çš„ï¼Œå› æ­¤æ— éœ€é’»å–æ•´ä¸ªç»„ä»¶å±‚æ¬¡ç»“æ„å³å¯å°†å±æ€§ä»ç»„ä»¶`A`ä¼ é€’åˆ°é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä»¬è¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§çœŸæ­£ç®€å•çš„æ–¹æ³•ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨å…„å¼Ÿä¹‹é—´å…±äº«è´¢äº§ã€‚

[![68747470733a2f2f766963746f72766870672e6769746875622e696f2f6173736574732f636f6e746575646f2d706f7374732f323031382f72656475782f72656475782e706e67](../Images/a31fdcfe3280aebbc40fbe507fa129cc.png)T2ã€‘](https://camo.githubusercontent.com/777e7ba1d6296e1b17660f11a3d53bf619048a73/68747470733a2f2f766963746f72766870672e6769746875622e696f2f6173736574732f636f6e746575646f2d706f7374732f323031382f72656475782f72656475782e706e67)

ä½†æ˜¯ï¼Œè¿™å¸¦æ¥äº†è¿«åœ¨çœ‰ç«ã€ä¸å¯é¿å…çš„åæœ:å¤æ‚æ€§ã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘ middlewares è½¯ä»¶ã€è‚¡ç¥¨ã€é…ç½®å•†åº—ç­‰ï¼Œå› ä¸ºå®ƒè¿‡å»å’Œç°åœ¨éƒ½ä½¿ Redux éƒ¨ç½²èµ·æ¥ç›¸å½“å¤æ‚ã€‚

## [](#context-api-alternativa-a-redux)ä¸Šä¸‹æ–‡ API - Alternativa a Reduxï¼ŸğŸ¤”

ä» React 16 å¼€å§‹ï¼Œå®æ–½äº†ä¸€ç§ç§°ä¸ºä¸Šä¸‹æ–‡ API çš„æ–°å·¥å…·ã€‚è¯¥æ–°å·¥å…·æ˜¯ä½œä¸ºå¯¹*å±æ€§é’»*å’Œã€Reduxã€‘çš„å»ºè®®è€Œåˆ›å»ºçš„ã€‚Context API èƒŒåçš„æƒ³æ³•ä¸ Redux ç›¸åŒï¼Œä½†è¦è½»å¾—å¤šï¼Œç®€æ´å¾—å¤šï¼Œæœ€å¥½çš„ï¼Œè­¦å®˜ã€‚

æ­¤æ–°åŠŸèƒ½é€šè¿‡åˆ›å»ºä¸€ä¸ªâ€œ*â€ä¸Šä¸‹æ–‡*æ¥å·¥ä½œï¼Œè¯¥ä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªä¿å­˜æŸäº›æ•°æ®(å¦‚å˜é‡ã€å‡½æ•°ç­‰)çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚æ­¤ä¸Šä¸‹æ–‡åˆ†ä¸ºä¸¤éƒ¨åˆ†:`Provider`å’Œ`Consumer`ã€‚

[![prop-drilling-v-context.png](../Images/9a20cec9fcc760e88ccad738cdd9f221.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zc37DLsB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.carlrippon.com/wp-content/uploads/2018/04/prop-drilling-v-context.png)

è¦åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œåªéœ€ä½¿ç”¨æ–¹æ³•
:

```
const AppContext = React.createContext({})
export const AppProvider = AppContext.Provider
export const AppConsumer = AppContext.Consumer 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æä¾›è€…**æ˜¯å­˜å‚¨è¦æ¶ˆè´¹çš„ä¿¡æ¯çš„åœ°æ–¹ï¼›æ­¤ä¿¡æ¯é€šè¿‡ä¸€ä¸ªåä¸ºâ€œ`value`â€çš„å±æ€§ä¼ é€’ã€‚æŠŠå®ƒæƒ³æˆæ˜¯ä¸€ä¸ªæˆ‘ä»¬è¦æ¶ˆè´¹çš„èœœèœ‚ã€‚

å¦ä¸€æ–¹é¢ï¼Œ**æ¶ˆè´¹è€…**åˆ™æ˜¯è´Ÿè´£æ¶ˆè´¹åŒ…å«**æä¾›è€…**çš„æ•°æ®çš„å…ƒç´ ï¼Œå› æ­¤å®ƒå¯¹æˆ‘ä»¬çš„ç»„ä»¶èµ·ç€*ä»£ç†ä½œç”¨ã€‚* 

```
import { AppProvider, AppConsumer } from './context'

class App extends Component<P, S> {
  state = {
    title: 'Hello from App',
    updateTitle: title => {
      this.setState({ title })
    }
  }
  render = _ => (
    <AppProvider value={this.state}>
      <Header />
      {this.props.children}
    </AppProvider>
  )
}

export default App 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`Provider`ä¸€æ—¦æœ‰äº†æ•°å€¼ï¼Œæ— è®ºæƒ³è¦æ¶ˆè€—ä¿¡æ¯çš„å…ƒä»¶æ‰€åœ¨çš„æ·±åº¦å¦‚ä½•ï¼Œéƒ½å¯ä»¥æ¶ˆè€—:

```
const Header = _ => (
  <header className="header">
    <Title />
  </header> ) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
const Title = _ => (
  <AppConsumer>
  {
    context => (
      <h1 className="header__title">
        { context.title }
      </h1>
    )
  }
) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­£å¦‚æˆ‘ä»¬çœ‹åˆ°çš„ï¼Œå°½ç®¡ç»„ä»¶`Title`ä¸æ˜¯`App`çš„ç›´æ¥å­ä»£ï¼Œä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶çŠ¶æ€è€Œä¸ç”¨ç»§æ‰¿ä¸ºå±æ€§ï¼Œå³ä½¿`Title`å¤„äºå¾ˆå¤šæ›´æ·±çš„å±‚æ¬¡ã€‚

ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡æ›´æ–°æä¾›å®ƒçš„ç»„ä»¶çš„çŠ¶æ€æ¥æ›´æ–°â€œ`Provider`â€çš„å€¼ã€‚å¯èƒ½æ€§å¾ˆå¤§ï¼Œè¦ç”±å¼€å‘äººå‘˜æ¥å†³å®šå¦‚ä½•ä½¿ç”¨å®ƒã€‚

* * *

## ç»“è®º

Context API æ˜¯ Redux çš„ä¸€ä¸ªç›¸å½“å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚å¦‚æœä½ è¦æ‰¾çš„æ˜¯ç®€å•å®ç”¨çš„ä¸œè¥¿ï¼Œé‚£æ˜¯ä½ çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å®ƒå¯èƒ½å¯¹ä½ ä¸å¤Ÿæœ‰ç”¨ï¼Œä½ æƒ³ä½¿ç”¨ Redux å’Œå¦ä¸€ç§é€‰æ‹©ã€‚å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘åªéœ€è¦ Context APIï¼Œç”šè‡³å¯ä»¥åˆ›å»ºè‡ªå·±åŸºäºå®ƒçš„ Reduxï¼Œå¦‚[ååº”ç€‘å¸ƒ](https://github.com/didierfranc/react-waterfall)ã€‚