# å®£å¸ƒ docker-image-size-limit:ç•™æ„ä½ çš„ docker å›¾åƒå¤§å°

> åŸæ–‡:[https://dev . to/we make-services/announcing-docker-image-size-limit-keep-a-eye-on-your-docker-image-size-4p M8](https://dev.to/wemake-services/announcing-docker-image-size-limit-keep-an-eye-on-your-docker-image-size-4pm8)

åŸå‘è¡¨äºæˆ‘çš„åšå®¢:[https://sobolevn . me/2019/03/announcing-docker-image-size-limit](https://sobolevn.me/2019/03/announcing-docker-image-size-limit)

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png)[we make-services](https://github.com/wemake-services)/[docker-image-size-limit](https://github.com/wemake-services/docker-image-size-limit)

### ğŸ³ç•™æ„ä½ çš„ docker å›¾ç‰‡å¤§å°ï¼Œé˜²æ­¢å®ƒå˜å¾—å¤ªå¤§

<article class="markdown-body entry-content container-lg" itemprop="text">

# docker-å›¾åƒ-å¤§å°-é™åˆ¶

[![wemake.services](../Images/e779a35745bf1bc131027b7712420e90.png)](https://wemake.services)[![Build status](../Images/becc03c0d544ec5c4088f4ac53d5fba1.png)](https://github.com/wemake-services/docker-image-size-limit/actions?query=workflow%3Atest)[![codecov](../Images/d1372b2363c9f9e15357c84561abf695.png)](https://codecov.io/gh/wemake-services/docker-image-size-limit)[![Python Version](../Images/2be3c9f4c6d1d449dcd5a932a829463f.png)](https://pypi.org/project/docker-image-size-limit/)[![wemake-python-styleguide](../Images/29fd18d70d1bbea101ed0c3c08584cba.png)](https://github.com/wemake-services/wemake-python-styleguide)

ä½¿ç”¨ç®€å•çš„ CLI å‘½ä»¤é™åˆ¶æ‚¨çš„`docker`å›¾åƒå¤§å°ï¼Œéå¸¸é€‚åˆåœ¨æ‚¨çš„ CI æµç¨‹ä¸­ä½¿ç”¨ã€‚

é˜…è¯»[å…¬å‘Šå¸–](https://sobolevn.me/2019/03/announcing-docker-image-size-limit)ã€‚

## è£…ç½®

```
pip install docker-image-size-limit
```

æˆ–è€…ä½¿ç”¨æˆ‘ä»¬çš„ [Github åŠ¨ä½œ](https://github.com/wemake-services/docker-image-size-limit#github-action)æˆ–è€…[é¢„ç½®çš„ docker é•œåƒ](https://github.com/wemake-services/docker-image-size-limit#docker-image)ã€‚

## ä½¿ç”¨

æˆ‘ä»¬åªæ”¯æŒä¸€ä¸ªå‘½ä»¤:

```
$ disl your-image-name:label 300MiB
your-image-name:label exceeds 300MiB limit by 114.4 MiB
```

## é€‰æ‹©

æ‚¨å¯ä»¥å°†å›¾åƒæŒ‡å®šä¸º:

*   å›¾åƒåç§°:`python`
*   å¸¦æ ‡ç­¾çš„å›¾åƒåç§°:`python:3.6.6-alpine`

æ‚¨å¯ä»¥å°†æ‚¨çš„å°ºå¯¸æŒ‡å®šä¸º:

*   åŸå§‹å­—èŠ‚æ•°:`1024`
*   äººç±»å¯è¯»çš„å…†å­—èŠ‚:`30 MB`æˆ–`30 MiB`
*   äººç±»å¯è¯»çš„åƒå…†å­—èŠ‚:`1 GB`æˆ–`1 GiB`
*   [`humanfriendly`](https://humanfriendly.readthedocs.io/en/latest/api.html#humanfriendly.parse_size) æ”¯æŒçš„ä»»ä½•å…¶ä»–å°ºå¯¸

## ç¨‹åºç”¨æ³•

æ‚¨ä¹Ÿå¯ä»¥å¯¼å…¥å¹¶ä½¿ç”¨è¿™ä¸ªåº“ä½œä¸º`python`ä»£ç :

```
from docker import from_env
from docker_image_size_limit import check_image_size
oversize = check_image_size(from_env(), 'image-name:latest', '1 GiB')
assert oversize < 0, 'Too big image!'  # negative oversize - is a good thing!
```

â€¦

</article>

[View on GitHub](https://github.com/wemake-services/docker-image-size-limit)

## [](#my-story)æˆ‘çš„æ•…äº‹

é‚£æ˜¯ä¸€ä¸ªæ¸…æ™¨ã€‚æˆ‘æ­£åœ¨å–æˆ‘çš„ç¬¬ä¸€æ¯èŒ¶ğŸµä»¥åŠæ£€æŸ¥æ¥è‡ªå¦ä¸€ä¸ªå¼€å‘äººå‘˜çš„æ‹‰è¯·æ±‚ã€‚

çœ‹èµ·æ¥ç›¸å½“ä¸é”™ã€‚åªæ˜¯ä¸€äº›æ–°çš„`python`ä¾èµ–é¡¹æ¥ç”Ÿæˆæ¼‚äº®çš„æŠ¥å‘Šã€‚å’Œä¸€å †æ–°çš„`alpine`åº“æ¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ã€‚

æ‰€ä»¥ï¼Œæˆ‘æ¯«ä¸çŠ¹è±«åœ°åˆå¹¶äº†å®ƒã€‚

å‡ ä¸ªå°æ—¶åï¼Œæˆ‘å‘ç°æˆ‘ä»¬çš„å›¾åƒå°ºå¯¸ä»`~200 MiB`å¢åŠ åˆ°äº†`~1.5 GiB`ã€‚ğŸ’¥è¿™æ˜¯ä¸å¯æ¥å—çš„ï¼

æ‰€ä»¥ï¼Œæˆ‘å†™äº†è¿™ä¸ªè„šæœ¬æ¥é™åˆ¶æœªæ¥çš„æœ€å¤§å›¾åƒå¤§å°:

```
LIMIT=1024
IMAGE='your-image-name:latest'

SIZE="$(docker image inspect "$IMAGE" --format='{{.Size}}')"
test "$SIZE" -gt "$LIMIT" && echo 'Limit exceeded'; false 
```

è¿™å°±å¥½æ¯”`js` [`size-limit`](https://github.com/ai/size-limit) å›¾ä¹¦é¦†ï¼Œä½†å¯¹äº`docker`ã€‚

æ•ˆæœéå¸¸å¥½ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„ CI åœ¨æ¯”æˆ‘ä»¬çš„`$LIMIT`æ›´å¤§çš„å›¾åƒä¸Šä¼šå¤±è´¥ã€‚ä½†æ˜¯ï¼Œä½ çŸ¥é“æˆ‘ä»¬åœ¨ç”¨[ã€æ— å¯æŒ‡è´£çš„ç¯å¢ƒã€‘](https://sobolevn.me/2018/12/blameless-environment)çš„æ–¹æ³•å—ï¼Ÿå¦‚æœæŸä¸ªé¡¹ç›®å¤±è´¥äº†ï¼Œå°±ä¸€åŠ³æ°¸é€¸åœ°è§£å†³å®ƒï¼ŒåŒ…æ‹¬å…¶ä»–é¡¹ç›®ã€‚ç°åœ¨ï¼Œæˆ‘å¿…é¡»é€šè¿‡å¤åˆ¶ç²˜è´´è¿™å››è¡Œä»£ç ï¼Œå°†è¿™äº›ä»£ç åˆ†å‘åˆ°æˆ‘ä»¬æ‰€æœ‰çš„é¡¹ç›®ä¸­ã€‚å½“ç„¶ï¼Œè¿™ä¸æ˜¯æˆ‘å–œæ¬¢çš„ä»£ç åˆ†å‘æ–¹å¼ã€‚

## [](#new-project)æ–°å»ºé¡¹ç›®

å› æ­¤ï¼Œæˆ‘å°†è¿™ä¸ªè„šæœ¬å¼€æºä¸ºä¸€ä¸ªç‹¬ç«‹çš„`python` CLIï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ†å‘ã€å®‰è£…å’Œä½¿ç”¨:

```
$ pip install docker-image-size-limit
$ disl your-image-name:label 300MiB
your-image-name:label exceeds 300MiB limit by 1200 MiB 
```

ä»…æ­¤è€Œå·²ã€‚

ç°åœ¨ï¼Œæ‚¨å¯ä»¥ç¡®ä¿¡æ‚¨çš„å›¾åƒå¤§å°å°†å§‹ç»ˆåœ¨æ§åˆ¶ä¹‹ä¸­ã€‚ç­¾å‡º[æ–‡æ¡£](https://github.com/wemake-services/docker-image-size-limit)ä¸­æ‰€æœ‰å¯èƒ½çš„é€‰é¡¹ã€‚å¹¶å°†å…¶é›†æˆåˆ°æ‚¨çš„ CI ä¸­ï¼Œä»¥é¿å…çŠ¯æˆ‘å·²ç»ä¿®å¤çš„é”™è¯¯ã€‚ğŸ”§