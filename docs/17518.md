# ä½¿ç”¨ firestorm æ„å»º hugo å†…å®¹

> åŸæ–‡:[https://dev . to/codingcatdev/use-firestore-to-build-Hugo-content-1 ob4](https://dev.to/codingcatdev/use-firestore-to-build-hugo-content-1ob4)

åŸå¸–:[https://ajonp . com/lessons/use-firestore-to-build-Hugo-content/](https://ajonp.com/lessons/use-firestore-to-build-hugo-content/)

[https://www.youtube.com/embed/rMcpwucRlnU](https://www.youtube.com/embed/rMcpwucRlnU)

# [](#firestore-to-hugo)å‡¡å£«å¤šç»™é›¨æœ

æœ¬è¯¾å°†æ¢ç´¢ä¸€äº›ç›¸å½“å¤æ‚çš„è§¦å‘å™¨å’Œ Git å®è·µã€‚

ğŸŒæ¼”ç¤º:
[è§’ç®¡ç†ç«™ç‚¹](https://ajonp-lesson-8-admin.firebaseapp.com)
[é›¨æœä¸»ç«™ç‚¹](https://ajonp-lesson-8-hugo.firebaseapp.com/)

## [](#lesson-steps)ä¸Šè¯¾æ­¥éª¤

1.  [è®¡è´¹é™é¢æé†’](#billing-limit-reminder)
2.  [å‰/å…‹éš†ç¬¬å…«è¯¾â€”â€”é›¨æœ](#fork-clone-lesson-8-hugo)
3.  [åˆ›å»º Hugo firebase æ‰˜ç®¡ç½‘ç«™](#create-hugo-firebase-hosting-site)
4.  [åˆ›å»º Hugo å†…å®¹è°·æ­Œäº‘æ„å»ºè§¦å‘å™¨](#create-hugo-content-google-cloud-build-trigger)
5.  [æµ‹è¯•äº‘æ„å»ºè§¦å‘å™¨](#test-cloud-build-trigger)
6.  [åˆ†å‰/å…‹éš†ç¬¬å…«è¯¾-firestore-åŠŸèƒ½](#fork-clone-lesson-8-firestore-functions)
7.  [å»ºè§’å·¥ç¨‹](#build-angular-project)
8.  [ä» CLI éƒ¨ç½² Firebase ä¸»æœº](#deploy-firebase-hosting-from-cli)
9.  [æ›´æ–° Firestore è§¦å‘å™¨ä»¥åŒ¹é…æ‚¨çš„ GitHub repo](#update-firestore-trigger-to-match-your-github-repo)
10.  [ä» CLI éƒ¨ç½² Firebase åŠŸèƒ½](#deploy-firebase-functions-from-cli)
11.  [æ·»åŠ ä¸€æœ¬ä¹¦ï¼Œè§‚çœ‹å®ƒåœ¨ Hugo ç½‘ç«™çš„å±•ç¤º](#add-a-book-watch-it-show-in-hugo-site)

å¯é€‰æ‹©çš„

*   é’ˆå¯¹ CI/CD çš„äº‘æ„å»º

# [](#billing-limit-reminder)è®¡è´¹é™é¢æé†’

> æé†’ä½ å°½é‡ä¿æŒè‡ªç”±ã€‚ä½ ä¸åº”è¯¥é‡åˆ°é—®é¢˜ï¼Œä½†ä»¥é˜²ä¸‡ä¸€ã€‚åœ¨ä½ çš„[è´¦å•](https://console.cloud.google.com/billing/)é¢æ¿ä¸­ï¼Œä¸ºä½ çš„é¡¹ç›®åˆ›å»ºä¸€ä¸ªæ–°çš„é¢„ç®—ï¼Œä»¥é˜²ä½ å°è¯•è¿™ä¸ªè¶…è¿‡ 50 æ¬¡ã€‚

å¦‚æœä½ æƒ³ç»™æ„å»ºè®¾ç½®ä¸€ä¸ªç¡¬çš„ä¸Šé™ï¼Œç­¾å‡º[å°é¡¶ API ä½¿ç”¨](https://cloud.google.com/apis/docs/capping-api-usage)ã€‚

å¯¹äºæ„å»º APIï¼Œæ‚¨å¯ä»¥è½¬åˆ°[äº‘æ„å»º API é…é¢](https://console.cloud.google.com/apis/api/cloudbuild.googleapis.com/quotas)

æ›´æ–°ç»“å¸ [IAM & Admin- >é…é¢](https://console.cloud.google.com/iam-admin/quotas)

# [](#forkclone-lesson8hugo)å‰å­/å…‹éš†äººç¬¬å…«è¯¾-é›¨æœ

ä½ å¯ä»¥å…‹éš†ç¬¬å…«è¯¾â€”â€”Hugoâ€”â€”T1ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³ä¸ºè°·æ­Œäº‘çš„æ„å»ºåˆ¶é€ ä»»ä½•è§¦å‘å™¨ï¼Œæˆ‘ä¼šå»ºè®®ä½ ä½¿ç”¨è‡ªå·±çš„å›è´­ã€‚

## [](#clone-your-fork)å…‹éš†ä½ çš„å‰å­

æˆ‘å°†é€šè¿‡åˆ†å‰åˆ°æˆ‘çš„ ajonp å¸æˆ·æ¥è¿è¡Œæˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°å®ƒâ€œåˆ†å‰è‡ª AJONPLLC/lesson-8-hugoâ€

[![Fork Example](../Images/30568b5a553484cb974bfddc70c187a8.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--5Mz03xPN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545864186/ajonp-ajonp-com/8-lesson-firestore-functions/qvn7dthjxnhelvyg20rv.jpg)

æ‚¨å¯ä»¥é€šè¿‡åœ¨è¯¥å‘½ä»¤ä¸­æ›¿æ¢æ‚¨çš„ _name æ¥å®ç°è¿™ä¸€ç‚¹ã€‚

```
git clone https://github.com/<your_name>/lesson-8-hugo.git && cd lesson-8-hugo 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#test-serving-hugo-locally)æµ‹è¯•æœ¬åœ°æœåŠ¡ hugo

ä½ çš„ä¸»é¢˜æ–‡ä»¶å¤¹å°†æ˜¯ç©ºçš„ï¼Œå› ä¸ºå®ƒå¼•ç”¨äº†ä¸€ä¸ª git å­æ¨¡å—ã€‚é¦–å…ˆç¡®ä¿æœ¬åœ°å…‹éš†äº†æ‰€æœ‰å­æ¨¡å—ã€‚

```
git submodule init && git submodule update --remote 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œ hugo serve å‘½ä»¤ã€‚è¿™å‘Šè¯‰ hugo ä½¿ç”¨ ajonp-hugo-ionic ä¸»é¢˜æä¾›æœåŠ¡ï¼Œå¹¶ä½¿ç”¨ config.toml æ–‡ä»¶ã€‚

```
hugo server -t ajonp-hugo-ionic --config config.toml 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨ç°åœ¨åº”è¯¥ä¼šçœ‹åˆ°ä¸»é¡µä¸Šåˆ—å‡ºäº†`http://localhost:1313/`çš„æœ€æ–°ä¹¦ç±ã€‚

[![Latest Books](../Images/7585a27820b7ed4f2eb0f83a8d13d773.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--mtMOFvH---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545864982/ajonp-ajonp-com/8-lesson-firestore-functions/dcrwjvqsbycdqflpo4nj.jpg)

è¿˜å¯ä»¥åœ¨`http://localhost:1313/books/`ä»¥åˆ—è¡¨æ ¼å¼æŸ¥çœ‹æ‰€æœ‰ä¹¦ç±ã€‚

[![All Books](../Images/038822e786f977458b5bc72dfb58616b.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--wAjKZCWQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545865091/ajonp-ajonp-com/8-lesson-firestore-functions/g6mu7mmskbfdb2pdpvdv.jpg)

è¿™å°†åŸºäº`AJONPLLC/lesson-8-hugo`ä¸­çš„æœ€æ–°å†…å®¹ï¼Œå¦‚æœæ‚¨ä¸æƒ³è¦ä»»ä½•å†…å®¹ï¼Œè¯·éšæ„æ¸…é™¤`content/books`ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚

> è®°ä½ Hugo æ˜¯åŠ¨æ€æ„å»ºæ–‡ä»¶çš„ï¼Œæ‰€ä»¥å¦‚æœä½ åˆ é™¤äº†`content/books`ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä½ ä¼šåœ¨`http://localhost:1313/books/`ä¸­å¾—åˆ°ä¸€ä¸ª 404ã€‚

# [](#create-hugo-firebase-hosting-site)åˆ›å»º Hugo firebase æ‰˜ç®¡ç«™ç‚¹

## [](#create-firebase-project)åˆ›å»º firebase é¡¹ç›®

ä»æ·»åŠ æ–°é¡¹ç›®å¼€å§‹

[![Add Project](../Images/c128fa54d6dfb898089964ca013b930e.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Msb98O-p--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545865510/ajonp-ajonp-com/8-lesson-firestore-functions/mlcfmsxq3egli5llns6i.jpg)

ç»™é¡¹ç›®èµ·ä¸ªå¥½åå­—ã€‚

[![Name Project](../Images/2a246148f12df0e031de66f4ea559041.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--xnh5s9Lg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545866565/ajonp-ajonp-com/8-lesson-firestore-functions/s7cmb6rmkkft4v0ag7ps.jpg)

ç„¶åï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä¸»æœºä¸‹çš„å…¥é—¨ï¼Œæˆ–æŒ‰ç…§æ›´æ–°æœ¬åœ° firebase æ–‡ä»¶ã€‚[![](../Images/e0c872b58e0c5078cc668e50af599865.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ZFg3l_YO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545866746/ajonp-ajonp-com/8-lesson-firestore-functions/ragqsnmidwfuv1kcb51n.jpg)

## [](#update-local-firebase-files)æ›´æ–°æœ¬åœ° firebase æ–‡ä»¶

æœ‰å‡ ä¸ª firebase å‘½ä»¤å¯ä»¥ç”¨æ¥æ‰‹åŠ¨æ·»åŠ æ­£ç¡®çš„ä¸»æœºè®¾ç½®`firebase use ajonp-lesson-8`å’Œ`firebase target:apply hosting ajonp-lesson-8-hugo ajonp-lesson-8-hugo`ã€‚ä½†æ˜¯ï¼Œæˆ‘è§‰å¾—åªæ›´æ–°ä¸¤ä¸ªæ–‡ä»¶æ›´å®¹æ˜“ã€‚

.firebaserc

```
{  "projects":  {  "default":  "ajonp-lesson-8"  },  "targets":  {  "ajonp-lesson-8":  {  "hosting":  {  "ajonp-lesson-8-hugo":  [  "ajonp-lesson-8-hugo"  ]  }  }  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨çš„æ›´æ–°
ã€‚firebaserc

```
{  "projects":  {  "default":  "your-project"  },  "targets":  {  "your-project":  {  "hosting":  {  "your-hosting-name":  [  "your-hosting-name"  ]  }  }  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæ›¿æ¢é»˜è®¤é¡¹ç›®ä»¥åŒ¹é…æ‚¨çš„é¡¹ç›®ã€‚å¯¹äºç›®æ ‡ï¼Œè¿™æ˜¯å°†æ‚¨çš„é¡¹ç›®æ˜ å°„åˆ°æ‚¨çš„ä¸»æœºåç§°ï¼Œæˆ‘ä»¬å°† firebase.json ä¸­çš„ä¸»æœºåç§°å®šä¹‰ä¸ºç›®æ ‡ã€‚

firebase.json

```
{  "hosting":  {  "target":  "ajonp-lesson-8-hugo",  "public":  "public",  "ignore":  [  "firebase.json",  "**/.*",  "**/node_modules/**"  ]  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨çš„æ›´æ–°
firebase.json

```
{  "hosting":  {  "target":  "your-hosting-name",  "public":  "public",  "ignore":  [  "firebase.json",  "**/.*",  "**/node_modules/**"  ]  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæ‚¨å°†èƒ½å¤Ÿä½¿ç”¨ firebase CLI éƒ¨ç½²æ‚¨çš„ç«™ç‚¹ã€‚

```
firebase deploy 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªåŒ…å«å¤§çº¦ 53 ä¸ªæ–‡ä»¶çš„ç»“æœã€‚

> å¦‚æœä½ åªçœ‹åˆ°å‡ ä¸ªæ£€æŸ¥ï¼Œä½ è¿è¡Œå­æ¨¡å—æ›´æ–°ã€‚

[![firebase deploy result](../Images/f9dfa0d24fa85a754ec6b96d1c0c3ea6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--y4PJz_yj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545874713/ajonp-ajonp-com/8-lesson-firestore-functions/nwsqimwac9suyzhrtdje.jpg)

# [](#create-hugo-content-google-cloud-build-trigger)åˆ›å»º Hugo å†…å®¹è°·æ­Œäº‘æ„å»ºè§¦å‘å™¨

æ—¢ç„¶æˆ‘ä»¬å·²ç»æ‰‹åŠ¨æµ‹è¯•äº†ä¸€åˆ‡æ­£å¸¸ï¼Œæˆ‘ä»¬æƒ³è¦éªŒè¯æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡æäº¤æ—¶è§¦å‘ Hugo æ„å»ºã€‚

## [](#google-cloud-project)è°·æ­Œäº‘é¡¹ç›®

æ¯ä¸ª Firebase é¡¹ç›®å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªè°·æ­Œå¹³å°é¡¹ç›®ã€‚ä¸ºäº†ä½¿ç”¨äº‘æ„å»ºå™¨ï¼Œæˆ‘ä»¬éœ€è¦å¯ç”¨è®¡è´¹ï¼Œæˆ‘å»ºè®®åˆ‡æ¢åˆ° Blaze è®¡åˆ’ï¼Œå› ä¸ºå¦‚æœæ‚¨ä¿æŒåœ¨é™é¢å†…ï¼Œæ‚¨å°†æ— éœ€æ”¯ä»˜ä»»ä½•è´¹ç”¨ã€‚
[![Blaze Plan](../Images/6e8ab832b2d78a47a656ad5698a5ff74.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Otmwl50F--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/f_auto%2Cfl_lossy%2Cq_auto/v1545875585/ajonp-ajonp-com/8-lesson-firestore-functions/rsuwpz0erldnoexzhowl.jpg)

ç°åœ¨å¼€å§‹è¿›å…¥[è°·æ­Œäº‘æ§åˆ¶å°](https://console.cloud.google.com)ã€‚

æ‚¨åº”è¯¥çœ‹åˆ°é¡¹ç›®çš„ä¸‹æ‹‰é€‰æ‹©ï¼Œé€‰æ‹©æ­£ç¡®çš„é¡¹ç›®ã€‚
[![Project Dropdown](../Images/e5a94c8e2534af7d93f72030ec696733.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--OS6gL5UO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545875207/ajonp-ajonp-com/8-lesson-firestore-functions/ufwyzjjozoxruj7zwqpi.jpg)

### [](#google-cloud-trigger-enable)è°·æ­Œäº‘è§¦å‘å¯ç”¨

ç°åœ¨ï¼Œæ‚¨å¯ä»¥å¯¼èˆªåˆ°[äº§å“- >å·¥å…·- >äº‘æ„å»º- >è§¦å‘å™¨](https://console.cloud.google.com/cloud-build/triggers)

[![Cloud Trigger](../Images/b0d75f110d43e05880f2474b031cd522.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--JZZkzA_V--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545875313/ajonp-ajonp-com/8-lesson-firestore-functions/somhpisvlmnmitqf8apr.jpg)

å¦‚æœè¿™æ˜¯ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œæ‚¨å°†éœ€è¦å¯ç”¨äº‘æ„å»º APIã€‚

[![Cloud Build Enable API](../Images/d1a7bf6693437be09ef98bfcfab5f9c7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--3t_fRUKX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545875377/ajonp-ajonp-com/8-lesson-firestore-functions/mkfsasxbko8bx70oahfy.jpg)

> å¦‚æœæ‚¨æ”¶åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»åœ¨ Firebase ä¸­æ›´æ”¹ä¸ºç«ç„°è®¡åˆ’ã€‚[![Builder Error](../Images/018e911aa60e4d94f3b9232db037a2c1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--dbbJKmcA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545875470/ajonp-ajonp-com/8-lesson-firestore-functions/jgp7vmvazhyi4c5p2y64.jpg)

### [](#google-cloud-trigger-create)è°·æ­Œäº‘è§¦å‘åˆ›å»º

å¦‚æœä½ åœ¨æœ¬è¯¾ä¸­éœ€è¦æ›´å¤šå¸®åŠ©ï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬çš„[Google Cloud Repositories CI/CD](https://ajonp.com/lessons/2-firebase-ci/)ä»¥è·å¾—å®Œæ•´çš„æ¼”ç¤ºã€‚

æ·»åŠ æ–°è§¦å‘å™¨

ä» GitHub é€‰æ‹©æ¥æºï¼Œå¹¶åŒæ„ã€‚

[![Select Source](../Images/07c74b7c4f0a8aa6b115efa868627ab5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--NATJYbOj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545876414/ajonp-ajonp-com/8-lesson-firestore-functions/zc1t0zguz0xnccruayzq.jpg)

åœ¨æ‚¨é€šè¿‡ GitHub è®¤è¯åï¼Œé€‰æ‹©æ‚¨çš„é¡¹ç›®å¹¶ç»§ç»­ã€‚

[![Choose GitHub project](../Images/d1fb4724793f2c4a6d9d951ea4a5cec0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--h4gIQi24--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545876452/ajonp-ajonp-com/8-lesson-firestore-functions/knehapxggrolfxkpaeor.jpg)

è®¾ç½®

*   åç§°:é›¨æœ CI/CD
*   åˆ†æ”¯:ä¸»
*   æ„å»ºé…ç½®:cloudbuild.yaml
*   æ›¿ä»£å˜é‡:_FIREBASE_TOKEN = yourtokenã€‚![Final steps](../Images/5865163351c46eed3142cc1b51a98ad3.png)

# [](#test-cloud-build-trigger)æµ‹è¯•äº‘æ„å»ºè§¦å‘å™¨

åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘ä»¬æƒ³ç¡®å®šä½ çš„è§¦å‘å™¨æ­£åœ¨å·¥ä½œã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å°†ä¸€ä¸ªæ ·æœ¬æ–‡ä»¶åŠ è½½åˆ°`content/books`æ–‡ä»¶å¤¹ä¸­ã€‚å°† examplebook.md é‡å‘½åä¸º testtrigger.mdï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚

content/books/test trigger . MD

```
+++
title = "Example Book"
date = 2018-11-26T14:45:13-05:00
images = ["https://res.cloudinary.com/ajonp/image/upload/w_500,f_auto,fl_lossy,q_auto/v1545282630/ajonp-ajonp-com/8-lesson-firestore-functions/bookExample.jpg"]
+++

This is a commit test creating a book.ğŸ˜¸ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#local-git-push)æœ¬åœ° git æ¨é€

å¦‚æœéœ€è¦ï¼Œæ·»åŠ æ–°æ–‡ä»¶ã€‚

```
git add . 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ¬åœ°æäº¤

```
git commit -m "Trigger Commit" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åæ¨é€åˆ°è¿œç¨‹ GitHub å­˜å‚¨åº“ã€‚

```
git push origin 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#trigger-history)è§¦å‘å†å²

ç°åœ¨ï¼Œæ‚¨åº”è¯¥å¯ä»¥åœ¨ [Google Cloud æ„å»ºå†å²](https://console.cloud.google.com/cloud-build/builds)
[![Trigger History](../Images/3f4ae1a28be8477a3b1415fe022cf245.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--POc9fGZt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545877459/ajonp-ajonp-com/8-lesson-firestore-functions/llkuo8erhprsak23frtv.jpg) ä¸­çœ‹åˆ°è¿™ä¸ªè§¦å‘å™¨çš„å†å²

## [](#automatically-deployed-to-firebase)è‡ªåŠ¨éƒ¨ç½²åˆ° Firebase

cloudbuild.yaml ä¸­çš„æœ€åä¸€æ­¥æ˜¯éƒ¨ç½²åˆ° firebaseï¼Œæ‚¨åº”è¯¥ä¼šåœ¨äº‘æ„å»ºæ—¥å¿—ä¸­çœ‹åˆ°ä¸€æ¡æˆåŠŸéƒ¨ç½²çš„æ¶ˆæ¯ã€‚

```
Starting Step #5
Step #5: Already have image: gcr.io/ajonp-lesson-8/firebase
Step #5: 
Step #5: === Deploying to 'ajonp-lesson-8'...
Step #5: 
Step #5: i  deploying hosting
Step #5: i  hosting[ajonp-lesson-8]: beginning deploy...
Step #5: i  hosting[ajonp-lesson-8]: found 54 files in public
Step #5: i  hosting: uploading new files [2/48] (4%)
Step #5: âœ”  hosting[ajonp-lesson-8]: file upload complete
Step #5: i  hosting[ajonp-lesson-8]: finalizing version...
Step #5: âœ”  hosting[ajonp-lesson-8]: version finalized
Step #5: i  hosting[ajonp-lesson-8]: releasing new version...
Step #5: âœ”  hosting[ajonp-lesson-8]: release complete
Step #5: 
Step #5: âœ”  Deploy complete!
Step #5: 
Step #5: Project Console: https://console.firebase.google.com/project/ajonp-lesson-8/overview
Step #5: Hosting URL: https://ajonp-lesson-8.firebaseapp.com
Finished Step #5 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> æé†’å¦‚æœæ‚¨çœ‹ä¸åˆ°æ–°æ–‡ä»¶ï¼Œå®ƒå¯èƒ½ç¼“å­˜åœ¨æµè§ˆå™¨/æœåŠ¡äººå‘˜ä¸­ï¼Œæ‚¨å¯ä»¥å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨æ¥æŸ¥çœ‹ã€‚

# [](#forkclone-lesson8firestorefunctions)åˆ†å‰/å…‹éš†ç¬¬å…«è¯¾-firestore-åŠŸèƒ½

ç¬¬å…«è¯¾-firestore-functions è®¾ç½®ä¸ºç½‘ç«™çš„ç®¡ç†ç«¯ï¼Œå°†ä¸ [Firebase Firestore](https://firebase.google.com/docs/firestore/) äº¤äº’ã€‚æˆ‘æ˜¯ç”¨ Angular å†™çš„ï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ç½‘ç»œæ¡†æ¶ï¼ŒiOSï¼ŒAndroidï¼ŒUnity...

## [](#install-npm-dependencies)å®‰è£… npm ä¾èµ–é¡¹

éªŒè¯æ‚¨æ˜¯å¦ä½äºåŸºæœ¬ç›®å½•

```
npm install 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#serve-locally)å°±åœ°æœåŠ¡

æ­¤æ—¶ï¼Œæ‚¨ä»ç„¶æŒ‡å‘ AJONPLLC é¡¹ç›®æ•°æ®åº“ï¼Œå› æ­¤æ‚¨ä¼šçœ‹åˆ°åˆ—å‡ºäº†ä¸€äº›ä¹¦ç±ã€‚æ‚¨å¿…é¡»åˆ‡æ¢åˆ°æˆ‘ä»¬åœ¨ä¸Šé¢åˆ›å»ºçš„æ–° firebase é¡¹ç›®ã€‚

## [](#update-the-firebase-configuration)æ›´æ–° firebase é…ç½®

> æ‚¨åªéœ€è¦ä¸€ä¸ªç¯å¢ƒæ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ç»å¸¸åŒæ—¶æ‹¥æœ‰å¼€å‘å’Œç”Ÿäº§è®¾ç½®ã€‚

åœ¨æ‚¨çš„ Firebase é¡¹ç›®æ¦‚è¿°ä¸­ï¼Œæœ‰ä¸€ä¸ªè®¾ç½®é½¿è½®->é¡¹ç›®è®¾ç½®ã€‚
[![Project Settings](../Images/dc2e9133116ba8e89f2c8e898df951ed.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zmDicVGA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545921872/ajonp-ajonp-com/8-lesson-firestore-functions/msoukza2h7qt3caep5op.jpg)

ç„¶ååœ¨â€œä½ çš„åº”ç”¨ç¨‹åºâ€éƒ¨åˆ†é€‰æ‹©â€œå°† Firebase æ·»åŠ åˆ°ä½ çš„ web åº”ç”¨ç¨‹åºâ€ã€‚
[![Your apps](../Images/604e84330a0cfa9833668b71b2be9995.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Z_FwKUgu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545921940/ajonp-ajonp-com/8-lesson-firestore-functions/dt6rddue4ra5oezt4fmi.jpg)

å¤åˆ¶åˆ†é…ç»™ config çš„ Javascript å¯¹è±¡ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬å°†æŠŠå®ƒç²˜è´´åˆ°æˆ‘ä»¬çš„ç¯å¢ƒæ–‡ä»¶ä¸­ã€‚

```
{
    apiKey: "your-apiKey",
    authDomain: "your-project.firebaseapp.com",
    databaseURL: "https://your-project.firebaseio.com",
    projectId: "your-project",
    storageBucket: "your-project.appspot.com",
    messagingSenderId: "your-messagingSenderId"
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

src/environments/environment . ts å’Œ src/environment/environment . prod . ts

[![environment files](../Images/7f34384046c4c0c5b2e67932ac7568e5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--5nyTT7ni--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545921794/ajonp-ajonp-com/8-lesson-firestore-functions/k4oljh0egz3ajrt9reo8.jpg)

## [](#authentication)è®¤è¯

ç°åœ¨ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œæˆ‘ä»¬æ­£åœ¨å¼•å¯¼è¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œå¦‚æœæ‚¨è¿”å›åˆ°`http://localhost:4200`ï¼Œæ‚¨å¾ˆå¯èƒ½ä¼šçœ‹åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºæˆ‘ä»¬å°šæœªæ›´æ–°æˆ‘ä»¬çš„èº«ä»½éªŒè¯è®¾ç½®ã€‚

[![Auth Error](../Images/cead3e0a651f802e94fbfcb345f83c09.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Rqi_iJPC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/f_auto%2Cfl_lossy%2Cq_auto/v1545922204/ajonp-ajonp-com/8-lesson-firestore-functions/tofhpbinmrcwi8c7kzyt.jpg)

æ‚¨å¯ä»¥åœ¨èº«ä»½éªŒè¯->ç™»å½•æ–¹æ³•ä¸­æ›´æ–°æ­¤ä¿¡æ¯ã€‚ç¼–è¾‘ Google ç™»å½•æä¾›ç¨‹åºå¹¶å¯ç”¨å®ƒã€‚
ä½ å¯ä»¥åœ¨ [Firebase è®¤è¯æ–‡æ¡£](https://firebase.google.com/docs/auth/)ä¸­æ‰¾åˆ°æ›´å¤š

## [](#firestore-database)Firestore æ•°æ®åº“

å›åˆ° Firestore é¡¹ç›®ï¼Œé€‰æ‹©æ•°æ®åº“->åˆ›å»ºæ•°æ®åº“

[![Create Database](../Images/ac7da831d85e1378d6bb378057ccc033.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--a6G4x5nC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_800%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545922532/ajonp-ajonp-com/8-lesson-firestore-functions/ni4xs9bhwfsexfdf6jho.jpg)

æˆ‘å»ºè®®æ€»æ˜¯åœ¨é”å®šæ¨¡å¼ä¸‹å¼€å§‹ï¼Œè¿™æœ‰åŠ©äºä½ äº†è§£åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½ éœ€è¦ä»€ä¹ˆæ ·çš„å®‰å…¨æ€§ï¼Œè€Œä¸ä¼šå¿˜è®°ä¸€äº›äº‹æƒ…ã€‚æœ‰æ—¶å®ƒç”šè‡³æœ‰åŠ©äºä½ çš„æ•°æ®æ¨¡å‹ï¼Œå› ä¸ºä¸€äº›å®‰å…¨è®¾ç½®å®åœ¨æ˜¯å¤ªç³Ÿç³•äº†ã€‚

[![Firestore Lock Mode](../Images/0b8de8a01eab59afd0c3beb50da0c217.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--v_Srvr3Q--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545922666/ajonp-ajonp-com/8-lesson-firestore-functions/qcgjr0ld7j9n9vyqji1n.jpg)

> è¯·æ³¨æ„ï¼Œæ­¤æ—¶ç”±äºæ‚¨çš„é¡¹ç›®å¤„äºé”å®šæ¨¡å¼ï¼Œæ‚¨å°†æ— æ³•æˆåŠŸæ›´æ–° Firestore æ•°æ®åº“ï¼Œå¹¶ä¸”ä¼šçœ‹åˆ°å¤±è´¥ï¼Œå› ä¸ºæ¯æ¬¡ç™»å½•æˆ‘ä»¬éƒ½ä¼šæ›´æ–°ä¸€æ¡ç”¨æˆ·è®°å½•ã€‚

ä»é¡¹ç›®
ä¸Šä¼  Firestore è§„åˆ™

```
firebase deploy --only firestore:rules 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#firebase-hosting-updates)Firebase æ‰˜ç®¡æ›´æ–°

### [](#update-the-project-name-everywhere)åˆ°å¤„æ›´æ–°é¡¹ç›®åç§°

ä½ å¯ä»¥åšä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®æŸ¥æ‰¾å’Œæ›¿æ¢ï¼ŒæŸ¥æ‰¾`ajonp-lesson-8-admin`å¹¶ç”¨ä½ çš„åå­—æ›¿æ¢ã€‚

ä¾‹æˆ‘æŠŠæˆ‘çš„ä»`ajonp-lesson-8-admin`æ”¹æˆäº†`ajonp-lesson-8-admin2`ã€‚å¦‚æœæ‚¨ä½¿ç”¨ VSCodeï¼Œæ‚¨å¯ä»¥åƒä¸‹é¢è¿™æ ·åšã€‚
T3![Find and Replace](../Images/e31d5bad7c1b6336fe9d0e08aa222143.png)T5ã€‘

### [](#update-styles)æ›´æ–°æ ·å¼

src/styles/ajonp-lesson-8-admin->æ‚¨çš„å§“å

å¦‚æœä½ å¾—åˆ°ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„é”™è¯¯ï¼Œé‚£æ˜¯å› ä¸ºæ ·å¼æ–‡ä»¶è¢«æ”¹å˜äº†ï¼Œæˆ‘ä»¬åªæ˜¯äº¤æ¢äº†ä¸Šé¢ä¸€è¡Œä¸­çš„æ‰€æœ‰å¼•ç”¨ã€‚

[![Style Error](../Images/0352d02cba2d62fc938bca18f2408590.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--mN5ZMhoa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545921409/ajonp-ajonp-com/8-lesson-firestore-functions/hpldbf8rxw9a4f4c2ztj.jpg)

æˆ‘æŠŠæˆ‘çš„ä»`ajonp-lesson-8-admin-app-theme.scss`æ”¹æˆäº†`ajonp-lesson-8-admin2-app-theme.scss`ã€‚

> æ­¤æ—¶ï¼Œæ‚¨å¯ä»¥æµ‹è¯•ä»æ•°æ®åº“ä¸­æ·»åŠ å’Œåˆ é™¤ä¹¦ç±ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦åšä¸€äº›å‡†å¤‡å·¥ä½œæ¥æ„å»º Hugo ç«™ç‚¹ã€‚

# [](#build-angular-project)æ„å»ºæœ‰è§’åº¦çš„é¡¹ç›®

ç›®å‰æˆ‘è¿˜æ²¡æœ‰å¼€å§‹ä½¿ç”¨ Ivy æ¸²æŸ“å¼•æ“ï¼Œä½†æ˜¯æˆ‘å¸Œæœ›å®ƒåœ¨å°†æ¥å¯ä»¥æ›´å¿«åœ°å®Œæˆæ„å»ºã€‚å½“ä½ è·‘å®Œè¿™ä¸€è¶Ÿæ—¶ï¼Œèµ¶ç´§å–æ¯å’–å•¡ã€‚

```
ng build --prod 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç»“æœ
[![Angular Build Results](../Images/0e6895af246ee63c0e3d154cd7dcdcca.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--2iETZcBZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545923774/ajonp-ajonp-com/8-lesson-firestore-functions/jzryeqykv2bhtzqvyvem.jpg)

ç°åœ¨ä½ çš„æ•´ä¸ªç½‘ç«™å·²ç»å‡†å¤‡å¥½æ‰˜ç®¡ï¼Œä½ å¯ä»¥å°è¯•åœ¨æœ¬åœ°è¿è¡Œ`firebase serve`ã€‚

# [](#deploy-firebase-hosting-from-cli)ä» CLI éƒ¨ç½² Firebase ä¸»æœº

ç°åœ¨æˆ‘ä»¬åœ¨`dist/ajonp-lesson-8-admin2`æœ‰äº†ä¸€ä¸ªäº§å“è§’åº¦æ„å»ºï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒéƒ¨ç½²åˆ°æˆ‘ä»¬çš„ Firebase ä¸»æœºä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªæˆæƒçš„æ–°ç«™ç‚¹ã€‚

## [](#create-new-site)åˆ›å»ºæ–°ç«™ç‚¹

æ‰˜ç®¡->ä»ªè¡¨æ¿->é«˜çº§é€‰æ‹©â€œæ·»åŠ å¦ä¸€ä¸ªç«™ç‚¹â€

```
firebase deploy --only hosting 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç»“æœ
[![Hosting Deploy Result](../Images/606634e7930171b93030cd007d651705.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--VmzooG3t--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545924120/ajonp-ajonp-com/8-lesson-firestore-functions/bmvevp4ss4g85fnax9jc.jpg)

## [](#update-authorized-domains)æ›´æ–°æˆæƒåŸŸ

å› ä¸ºæˆ‘ä»¬æ˜¯ä»ä¸€ä¸ªä¸åŒçš„åŸŸæä¾›æœåŠ¡ï¼Œä½ éœ€è¦æŠŠå®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„æˆæƒåŸŸã€‚ä½ å¯ä»¥åœ¨è®¤è¯->ç™»å½•æ–¹å¼->æˆæƒåŸŸä¸­æ‰¾åˆ°ï¼Œé€‰æ‹©â€œæ·»åŠ åŸŸâ€ã€‚

è¿™å°†æ˜¯`your-project-admin` .firebaseapp.com

ä½ ç°åœ¨åº”è¯¥çœ‹åˆ°ä¸‰ä¸ªæœ¬åœ°ä¸»æœºï¼Œé»˜è®¤(æˆ‘ä»¬çš„ Hugo ç½‘ç«™)ï¼Œä½ çš„é¡¹ç›®ç®¡ç†ç½‘ç«™ã€‚
[![Auth Domains](../Images/abe36372cce500c08fc6a9c251797a27.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--UnRHqrP7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545924515/ajonp-ajonp-com/8-lesson-firestore-functions/tjwkte0y4bcml9whonre.jpg)

# [](#update-firestore-trigger-to-match-your-github-repo)æ›´æ–° Firestore è§¦å‘å™¨ä»¥åŒ¹é…æ‚¨çš„ GitHub repo

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª Hugo ç«™ç‚¹å’Œä¸€ä¸ª Angular admin ç«™ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ª Firebase å‡½æ•°ï¼Œåœ¨æ¯æ¬¡æ·»åŠ /åˆ é™¤ä¸€æœ¬ä¹¦æ—¶è§¦å‘ã€‚

## [](#create-your-github-personal-token)åˆ›å»ºæ‚¨çš„ Github ä¸ªäººä»¤ç‰Œ

æ‚¨éœ€è¦[åˆ›å»º Github ä¸ªäººä»¤ç‰Œ](https://github.com/settings/tokens)ï¼Œå¦åˆ™æ‚¨å°†ä¸ºæ¯ä¸ªè¯·æ±‚å‘é€æ‚¨çš„å¯†ç ã€‚ä½ å¯ä»¥åœ¨>è®¾ç½®- >ä¸ªäººè®¿é—®ä»¤ç‰Œä¸­æ‰¾åˆ°è¿™ä¸ªï¼Œé€‰æ‹©â€œç”Ÿæˆæ–°ä»¤ç‰Œâ€ã€‚è¿™ç±»ä¼¼äºå¯†ç ï¼Œä½†æ˜¯æ‚¨å¯ä»¥é™åˆ¶ä»¤ç‰Œå…è®¸çš„è®¿é—®ã€‚

ä¸ºæ­¤ï¼Œä½ å¯ä»¥ç»™å‡ºå›è´­å’Œé˜…è¯»:ç”¨æˆ·è®¿é—®ï¼Œå‘½åä¸€äº›æœ‰æ„ä¹‰çš„ä¸œè¥¿ã€‚
[![Personal Token](../Images/a3b38093e84acf0d33ea0e6147f96435.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--dt_hQNLz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545925555/ajonp-ajonp-com/8-lesson-firestore-functions/suutevgobgp1hsgvja3k.jpg)

## [](#add-github-personal-token-to-firebase-functions)ç»™ Firebase åŠŸèƒ½æ·»åŠ  GitHub ä¸ªäººä»¤ç‰Œ

æ‚¨ä¸èƒ½è¿è¡Œæ­¤å‘½ä»¤æ¥ä¿å­˜æ‚¨çš„ä»¤ç‰Œï¼Œå› ä¸ºåªæœ‰ Firebase å‡½æ•°å¯ä»¥è®¿é—®ã€‚åœ¨ä»¥åçš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•æ›´å¥½åœ°ä¿æŠ¤å®ƒä»¬ã€‚

```
firebase functions:config:set git.token=your-token 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°è¿™æ ·çš„æ¶ˆæ¯ã€‚
[![Firebase Config](../Images/68cb4caa451e0a0631c582b1a849146c.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--pQTLhmWG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545925916/ajonp-ajonp-com/8-lesson-firestore-functions/w2goczy3ydk6ypbf1hny.jpg)

# [](#deploy-firebase-functions-from-cli)ä» CLI éƒ¨ç½² Firebase åŠŸèƒ½

ç°åœ¨éƒ¨ç½²æ‚¨çš„å‡½æ•°ï¼Œè¿™å°†å¯¹ typescript è¿›è¡Œä»£ç è½¬æ¢ï¼Œå¹¶å°† js æ–‡ä»¶æ”¾åœ¨ lib ç›®å½•ä¸­ã€‚æˆ‘å°†è¿™ä¸¤è€…éƒ½è®¾ç½®ä¸ºåœ¨èŠ‚ç‚¹ 8 ä¸Šè¿è¡Œã€‚

```
firebase deploy --only functions 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€æ¡æˆåŠŸæ¶ˆæ¯
[![Successfully Deploy Functions](../Images/404c7cfc79c5e2bf06e2e1feeadcf94e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--he3k9mvs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545926029/ajonp-ajonp-com/8-lesson-firestore-functions/mneaigflqyxmqoqp557b.jpg)

# [](#add-a-book-watch-it-show-in-hugo-site)æ·»åŠ ä¸€æœ¬ä¹¦ï¼Œè§‚çœ‹å®ƒåœ¨ Hugo ç½‘ç«™çš„å±•ç¤º

> è­¦å‘Šæ‚¨å¯èƒ½ä¼šå‡ºç°äº‰ç”¨æƒ…å†µï¼Œå³æ‚¨çš„ç¬¬ä¸€ä¸ªæ„å»ºè§¦å‘å™¨å‘ç”Ÿåœ¨æ‚¨çš„æœ€åä¸€ä¸ªè§¦å‘å™¨ä¹‹åã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œæœ‰ä¸€äº›å·¥ä½œæˆ‘æ²¡æœ‰åœ¨æœ¬è¯¾ä¸­ä»‹ç»ã€‚è¯·è®°ä½ï¼Œæ¯æ¬¡ä¿å­˜æ„å»ºæ—¶ï¼ŒGoogle Cloud Build éƒ½ä¼šé‡æ–°ç”Ÿæˆæ•´ä¸ª Hugo ç«™ç‚¹ã€‚

åœ¨å³ä¸‹è§’ä½ å¯ä»¥ç‚¹å‡»+ fab æŒ‰é’®ï¼Œè¿™å°†æ‰“å¼€ä¸€æœ¬æ–°ä¹¦çš„è¡¨å•ã€‚
[![New Book Form](../Images/d54f8d164c72d92e5704966c0e2c453c.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--NtHUUvf---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/w_500%2Cf_auto%2Cfl_lossy%2Cq_auto/v1545933791/ajonp-ajonp-com/8-lesson-firestore-functions/xyn381bujrehp021yeju.jpg)

ä¸€æ—¦ä½ ç‚¹å‡»ä¿å­˜ï¼Œè¿™å°†è§¦å‘äº‘åŠŸèƒ½`gitBookCreateHugoCommit`ã€‚æ£€æŸ¥[æ—¥å¿—](https://console.cloud.google.com/logs/viewer)

[![Git Creat Log](../Images/dd13b91162fc5eaee58f97582cf93839.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--wea1ZHrS--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res.cloudinary.com/ajonp/image/upload/f_auto%2Cfl_lossy%2Cq_auto/v1545934369/ajonp-ajonp-com/8-lesson-firestore-functions/bcnequcgzehwyx9hjf1a.jpg)

åœ¨ [Google Coud Builder å†å²](https://console.cloud.google.com/cloud-build/builds)ä¸­è§‚å¯Ÿæ„å»ºçš„å‘ç”Ÿ

ç„¶åï¼Œæ‚¨å¯ä»¥å¯¼èˆªåˆ°æ‚¨çš„ Hugo ç½‘ç«™(å¤§çº¦ 2 åˆ†é’Ÿå)å¹¶æŸ¥çœ‹æ–°ä¹¦ã€‚

## [](#delete-a-book)åˆ é™¤ä¸€æœ¬ä¹¦

é™¤äº†ä¼šè§¦å‘`gitBookDeleteHugoCommit`äº‘å‡½æ•°ä¹‹å¤–ï¼Œè¿™ä¸æ·»åŠ çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚