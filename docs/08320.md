# è®°å¿†å‹¿å¿˜æˆ‘ç‚¸å¼¹

> åŸæ–‡ï¼š<https://dev.to/thekashey/memoization-forget-me-bomb-34kh>

ä½ å¬è¯´è¿‡`memoization`å—ï¼Ÿé¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿™æ˜¯ä¸€ä»¶è¶…çº§ç®€å•çš„äº‹æƒ…â€”â€”åªè¦è®°ä½ä½ ä»ç¬¬ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­å¾—åˆ°çš„ç»“æœï¼Œå¹¶ä½¿ç”¨å®ƒè€Œä¸æ˜¯ç¬¬äºŒæ¬¡è°ƒç”¨å®ƒâ€”â€”ä¸è¦æ¯«æ— ç†ç”±åœ°è°ƒç”¨çœŸå®çš„ä¸œè¥¿ï¼Œä¸è¦æµªè´¹ä½ çš„æ—¶é—´ã€‚

è·³è¿‡ä¸€äº›å¯†é›†å‹æ“ä½œæ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ä¼˜åŒ–æŠ€æœ¯ã€‚æ¯æ¬¡ä½ å¯èƒ½ä¸åšæŸäº‹çš„æ—¶å€™â€”â€”ä¸è¦åšã€‚å°½é‡ä½¿ç”¨ç¼“å­˜â€” `memcache`ã€`file cache`ã€`local cache` â€”ä»»æ„ç¼“å­˜ï¼åç«¯ç³»ç»Ÿçš„å¿…å¤‡å·¥å…·ï¼Œä¹Ÿæ˜¯è¿‡å»å’Œç°åœ¨ä»»ä½•åç«¯ç³»ç»Ÿçš„å…³é”®éƒ¨åˆ†ã€‚

> æ˜ç™½äº†å—ï¼Ÿç®—äº†å§ï¼

[![](img/0fc34023773e3f69a84f6e302b73d739.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--PTGEcEf0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/znvvvubx5wtlp9s8dzna.png)

# è®°å¿†ä¸ç¼“å­˜

> è®°å¿†åŒ–å°±åƒç¼“å­˜ã€‚åªæ˜¯æœ‰ç‚¹ä¸åŒã€‚ä¸æ˜¯ cacheï¼Œå§‘ä¸”ç§°ä¹‹ä¸º kashe å§ã€‚

é•¿è¯çŸ­è¯´ï¼Œä½†æ˜¯è®°å¿†åŒ–ä¸æ˜¯ç¼“å­˜ï¼Œä¹Ÿä¸æ˜¯æ°¸ä¹…ç¼“å­˜ã€‚å®ƒå¯èƒ½æ˜¯æœåŠ¡å™¨ç«¯çš„ï¼Œä½†ä¸å¯èƒ½ä¹Ÿä¸åº”è¯¥æ˜¯å®¢æˆ·ç«¯çš„ç¼“å­˜ã€‚æ›´å¤šçš„æ˜¯å…³äºå¯ç”¨èµ„æºã€ä½¿ç”¨æ¨¡å¼å’Œä½¿ç”¨åŸå› ã€‚

## é—®é¢˜â€”â€”ç¼“å­˜éœ€è¦ä¸€ä¸ªâ€œç¼“å­˜é”®â€

ç¼“å­˜ä½¿ç”¨ä¸€ä¸ª**å­—ç¬¦ä¸²**ç¼“å­˜`key`æ¥å­˜å‚¨å’Œè·å–æ•°æ®ã€‚æ„é€ ä¸€ä¸ªå”¯ä¸€çš„ã€å¯ç”¨çš„é”®å·²ç»æ˜¯ä¸€ä¸ªé—®é¢˜äº†ï¼Œä½†æ˜¯ä½ å¿…é¡»å¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œç„¶åå†å­˜å‚¨åœ¨åŸºäºå­—ç¬¦ä¸²çš„ä»‹è´¨ä¸­â€¦â€¦ç®€è€Œè¨€ä¹‹ï¼Œç¼“å­˜å¯èƒ½æ²¡æœ‰ä½ æƒ³è±¡çš„é‚£ä¹ˆå¿«ã€‚å°¤å…¶æ˜¯åˆ†å¸ƒå¼ç¼“å­˜ã€‚

## è®°å¿†ä¸éœ€è¦ä»»ä½•ç¼“å­˜é”®

åŒæ—¶ï¼Œè®°å¿†ä¸éœ€è¦é’¥åŒ™ã€‚*é€šå¸¸** å®ƒæŒ‰åŸæ ·ä½¿ç”¨å‚æ•°ï¼Œä¸è¯•å›¾ä»å®ƒä»¬åˆ›å»ºå•ä¸ªé”®ï¼Œä¹Ÿä¸åƒç¼“å­˜é€šå¸¸åšçš„é‚£æ ·ï¼Œä½¿ç”¨ä¸€äº›å…¨å±€å¯ç”¨çš„å…±äº«å¯¹è±¡æ¥å­˜å‚¨ç»“æœã€‚

> å†…å­˜åŒ–å’Œç¼“å­˜çš„åŒºåˆ«åœ¨ **API æ¥å£**ï¼

*é€šå¸¸** ä¸ä»£è¡¨æ°¸è¿œã€‚ [Lodash.memoize](https://github.com/lodash/lodash/blob/4.17.11/lodash.js#L10547) é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨`JSON.stringify`å°†ä¼ é€’çš„å‚æ•°è½¬æ¢æˆå­—ç¬¦ä¸²ç¼“å­˜(æœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•ï¼Ÿä¸è¦ï¼).å› ä¸ºä»–ä»¬è¦ç”¨è¿™ä¸ªé”®æ¥è®¿é—®ä¸€ä¸ªå†…éƒ¨å¯¹è±¡ï¼Œä¿å­˜ä¸€ä¸ªç¼“å­˜çš„å€¼ã€‚ [fast-memoize](https://community.risingstack.com/the-worlds-fastest-javascript-memoization-library/) â€œæœ€å¿«çš„è®°å¿†åº“â€ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸¤ä¸ªå‘½ååº“éƒ½ä¸æ˜¯å†…å­˜åŒ–åº“ï¼Œè€Œæ˜¯ç¼“å­˜åº“ã€‚

> å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒJSON.stringify å¯èƒ½æ¯”ä¸€ä¸ªå‡½æ•°æ…¢ 10 å€ï¼Œä½ è¦è®°ä½ã€‚

æ˜¾ç„¶ï¼Œè¿™ä¸ªé—®é¢˜æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸ä½¿ç”¨ç¼“å­˜é”®ï¼Œä¹Ÿä¸ä½¿ç”¨é‚£ä¸ªé”®è®¿é—®ä¸€äº›å†…éƒ¨ç¼“å­˜ã€‚è¿˜è®°å¾—ä½ æœ€åä¸€æ¬¡è¢«ä¼ å”¤çš„ç†ç”±å—ï¼Ÿåƒ[memoizeric](https://github.com/thinkloop/memoizerific)æˆ–è€…[é‡æ–°é€‰æ‹©](https://github.com/reduxjs/reselect)åšã€‚

> Memoizerific å¯èƒ½æ˜¯ä½ å”¯ä¸€æƒ³ä½¿ç”¨çš„é€šç”¨ç¼“å­˜åº“ã€‚

# ç¼“å­˜å¤§å°

æ‰€æœ‰åº“ä¹‹é—´çš„ç¬¬äºŒå¤§åŒºåˆ«æ˜¯ç¼“å­˜å¤§å°å’Œç¼“å­˜ç»“æ„ã€‚

ä½ æœ‰æ²¡æœ‰æƒ³è¿‡â€”â€”ä¸ºä»€ä¹ˆ`reselect`æˆ–`memoize-one`åªæœ‰ä¸€ä¸ªï¼Œæœ€åçš„ç»“æœï¼Ÿä¸æ˜¯ä¸ºäº†*â€œä¸ä½¿ç”¨ç¼“å­˜é”®æ¥å­˜å‚¨ä¸€ä¸ªä»¥ä¸Šçš„ç»“æœâ€*ï¼Œè€Œæ˜¯å› ä¸º**æ²¡æœ‰ç†ç”±å­˜å‚¨ä¸€ä¸ªä»¥ä¸Šçš„ç»“æœ**ã€‚

â€¦å®ƒæ›´å¤šçš„æ˜¯å…³äº:

*   å¯ç”¨èµ„æºâ€”â€”å•ä¸ªç¼“å­˜è¡Œæ˜¯éå¸¸èµ„æºå‹å¥½çš„
*   ä½¿ç”¨æ¨¡å¼â€”â€”è®°ä½â€œåŸåœ°â€çš„ä¸œè¥¿æ˜¯ä¸€ä¸ªå¥½çš„æ¨¡å¼ã€‚â€œå°±åœ°â€ä½ é€šå¸¸åªéœ€è¦ä¸€ä¸ªï¼Œæœ€åä¸€ä¸ªï¼Œç»“æœã€‚
*   ä½¿ç”¨çš„ç†ç”±â€”â€”æ¨¡å—åŒ–ã€éš”ç¦»å’Œå†…å­˜å®‰å…¨æ˜¯å¾ˆå¥½çš„ç†ç”±ã€‚å°±ç¼“å­˜å†²çªè€Œè¨€ï¼Œä¸ä¸åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å…±äº«ç¼“å­˜æ›´å®‰å…¨ã€‚

# å•ä¸€ç»“æœï¼Ÿï¼

æ˜¯çš„â€”â€”å”¯ä¸€çš„ç»“æœã€‚ä¸€ä¸ªç»“æœæ˜¯è®°å¿†äº†ä¸€äº›ç»å…¸çš„ä¸œè¥¿ï¼Œæ¯”å¦‚è®°å¿†äº†çš„æ–æ³¢é‚£å¥‘æ•°ç”Ÿæˆ(ä½ å¯èƒ½ä¼šåœ¨æ¯ç¯‡å…³äºè®°å¿†çš„æ–‡ç« ä¸­æ‰¾åˆ°ä¸€ä¸ªä¾‹å­*)**æ˜¯ä¸å¯èƒ½çš„**ã€‚ä½†æ˜¯ï¼Œé€šå¸¸ï¼Œä½ åœ¨åšåˆ«çš„äº‹æƒ…â€”â€”è°éœ€è¦å‰ç«¯çš„æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Ÿåœ¨åç«¯ï¼Ÿç°å®ä¸–ç•Œçš„ä¾‹å­ä¸æŠ½è±¡çš„*ç›¸å»ç”šè¿œã€‚**

 *ä½†æ˜¯ï¼Œå…³äºå•å€¼è®°å¿†ç±»å‹è¿˜æœ‰ä¸¤ä¸ªå¤§é—®é¢˜ã€‚

## é—®é¢˜ 1â€”â€”å®ƒâ€œè„†å¼±â€

é»˜è®¤æƒ…å†µä¸‹â€”â€”æ‰€æœ‰å‚æ•°éƒ½åº”è¯¥åŒ¹é…ï¼Œæ°å¥½æ˜¯â€œ===â€ç›¸åŒã€‚å¦‚æœä¸€ä¸ªè®ºç‚¹ä¸åŒ¹é…ï¼Œæ¸¸æˆå°±ç»“æŸäº†ã€‚å³ä½¿è¿™æ¥è‡ªè®°å¿†åŒ–çš„æƒ³æ³•â€”â€”é‚£å¯èƒ½ä¸æ˜¯ä½ ç°åœ¨æƒ³è¦çš„ä¸œè¥¿ã€‚æˆ‘çš„æ„æ€æ˜¯â€”â€”ä½ æƒ³å°½å¯èƒ½å¤šåœ°ã€å°½å¯èƒ½é¢‘ç¹åœ°å›å¿†ã€‚

> å³ä½¿ç¼“å­˜æœªå‘½ä¸­ä¹Ÿæ˜¯ç¼“å­˜æ“¦é™¤çˆ†å¤´ã€‚

â€œç°åœ¨â€å’Œâ€œè¿‡å»â€ä¹‹é—´æœ‰ä¸€ç‚¹ç‚¹ä¸åŒâ€”â€”ä¸å¯å˜çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚åœ¨ Redux ä¸­ä½¿ç”¨çš„ã€‚

```
const getSomeDataFromState = memoize(state => compute(state.tasks)); 
```

å¥½çœ‹å—ï¼Ÿå‘å³çœ‹ï¼Ÿç„¶è€Œï¼Œå½“ä»»åŠ¡æ²¡æœ‰æ”¹å˜æ—¶ï¼ŒçŠ¶æ€å¯èƒ½ä¼šæ”¹å˜ï¼Œæ‚¨åªéœ€è¦åŒ¹é…ä»»åŠ¡ã€‚

ç»“æ„é€‰æ‹©å™¨åœ¨è¿™é‡Œç”¨ä»–ä»¬æœ€å¼ºçš„æˆ˜å£«**é‡æ–°é€‰æ‹©**æ¥æ‹¯æ•‘ä¸–ç•Œï¼Œå¬å€™ä½ çš„å¬å”¤ã€‚é‡æ–°é€‰æ‹©ä¸ä»…ä»…æ˜¯è®°å¿†åº“ï¼Œå®ƒçš„åŠ›é‡æ¥è‡ªè®°å¿†**çº§è”**ï¼Œæˆ–è€…é€é•œ(å®ƒä»¬ä¸æ˜¯ï¼Œä½†æ˜¯æŠŠé€‰æ‹©å™¨æƒ³è±¡æˆå…‰å­¦é€é•œ)ã€‚

```
// every time `state` changes, cached value would be rejected
const getTasksFromState = createSelector(state => state.tasks);
const getSomeDataFromState = createSelector(
  // `tasks` "without" `state`
  getTasksFromState,   // <---------- 
  // and this operation would be memoized "more often"
  tasks => compute(state.tasks) 
); 
```

å› æ­¤ï¼Œåœ¨ä¸å¯å˜æ•°æ®çš„æƒ…å†µä¸‹â€”â€”ä½ æ€»æ˜¯å¿…é¡»é¦–å…ˆ**â€œèšç„¦â€åˆ°ä½ çœŸæ­£éœ€è¦çš„æ•°æ®å—ï¼Œç„¶åâ€”â€”æ‰§è¡Œè®¡ç®—ï¼Œå¦åˆ™ç¼“å­˜å°†è¢«æ‹’ç»ï¼Œæ‰€æœ‰è®°å¿†åŒ–èƒŒåçš„æƒ³æ³•å°†ä¼šæ¶ˆå¤±ã€‚**

 **è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå°¤å…¶æ˜¯å¯¹æ–°æ‰‹æ¥è¯´ï¼Œä½†æ˜¯ä½œä¸ºä¸å¯å˜æ•°æ®ç»“æ„èƒŒåçš„æ€æƒ³ï¼Œå®ƒæœ‰ä¸€ä¸ªæ˜¾è‘—çš„å¥½å¤„- **å¦‚æœæŸæ ·ä¸œè¥¿æ²¡æœ‰è¢«æ”¹å˜-å®ƒå°±æ²¡æœ‰è¢«æ”¹å˜ã€‚å¦‚æœæŸä¸ªä¸œè¥¿å‘ç”Ÿäº†å˜åŒ–â€”â€”å¾ˆå¯èƒ½å°±æ˜¯å‘ç”Ÿäº†å˜åŒ–**ã€‚è¿™ç»™äº†æˆ‘ä»¬ä¸€ä¸ªè¶…çº§å¿«é€Ÿçš„æ¯”è¾ƒï¼Œä½†æœ‰ä¸€äº›å‡é˜´æ€§ï¼Œå°±åƒç¬¬ä¸€ä¸ªä¾‹å­ã€‚

> è¿™ä¸ªæƒ³æ³•æ˜¯å…³äºâ€œå…³æ³¨â€ä½ æ‰€ä¾èµ–çš„æ•°æ®

æœ‰ä¸¤ä¸ªæ—¶åˆ»æˆ‘åº”è¯¥æåˆ°:

*   `lodash.memoize`å’Œ`fast-memoize`æ­£åœ¨å°†æ‚¨çš„æ•°æ®è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨ä½œä¸€ä¸ªé”®ã€‚è¿™æ„å‘³ç€å®ƒä»¬ 1)ä¸å¿« 2)ä¸å®‰å…¨ 3)å¯èƒ½äº§ç”Ÿè¯¯æŠ¥â€”â€”ä¸€äº›**ä¸åŒçš„æ•°æ®**å¯èƒ½æœ‰**ç›¸åŒçš„å­—ç¬¦ä¸²è¡¨ç¤º**ã€‚è¿™å¯èƒ½ä¼šæé«˜â€œç¼“å­˜çƒ­ç‡â€ï¼Œä½†å®é™…ä¸Šæ˜¯ä¸€ä»¶éå¸¸ç³Ÿç³•çš„äº‹æƒ…ã€‚
*   æœ‰ä¸€ç§ ES6 ä»£ç†æ–¹æ³•ï¼Œå¯ä»¥è·Ÿè¸ªæ‰€æœ‰ä½¿ç”¨è¿‡çš„ç»™å®šå˜é‡ï¼Œå¹¶ä¸”åªæ£€æŸ¥é‡è¦çš„é”®ã€‚è™½ç„¶æˆ‘ä¸ªäººæƒ³åˆ›å»ºæ— æ•°çš„æ•°æ®é€‰æ‹©å™¨â€”â€”ä½ å¯èƒ½ä¸å–œæ¬¢æˆ–ä¸ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œä½†å¯èƒ½æƒ³è¦å¼€ç®±å³ç”¨çš„é€‚å½“è®°å¿†â€”â€”ç„¶åä½¿ç”¨ [memoize-state](https://github.com/theKashey/memoize-state) ã€‚

## é—®é¢˜ 2â€”â€”æ˜¯â€œä¸€æ¡ç¼“å­˜çº¿â€

æ— é™çš„ç¼“å­˜å¤§å°æ˜¯ä¸€ä¸ªæ€æ‰‹ã€‚åªè¦å†…å­˜éå¸¸æœ‰é™ï¼Œä»»ä½•ä¸å—æ§åˆ¶çš„ç¼“å­˜éƒ½æ˜¯æ€æ‰‹ã€‚æ‰€ä»¥â€”â€”æ‰€æœ‰æœ€å¥½çš„åº“éƒ½æ˜¯â€œä¸€ä¸ªç¼“å­˜è¡Œé•¿â€ã€‚è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å’Œå¼ºå¤§çš„è®¾è®¡å†³ç­–ã€‚æˆ‘åªæ˜¯å†™äº†å®ƒæ˜¯å¤šä¹ˆæ­£ç¡®ï¼Œè€Œä¸”ï¼Œç›¸ä¿¡æˆ‘â€”â€”è¿™æ˜¯ä¸€ä»¶**çœŸæ­£æ­£ç¡®çš„äº‹æƒ…**ï¼Œä½†å®ƒä»ç„¶æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ä¸€ä¸ªå¤§é—®é¢˜ã€‚

```
const tasks = getTasks(state);

// let's get some data from state1 (function was defined above)
getDataFromTask(tasks[0]); 
// ğŸš€
equal(getDataFromTask(tasks[0]), getDataFromTask(tasks[0])) 
//ğŸ”¥
getDataFromTask(tasks[1]); 
// a different task? What the heck?
// oh! That's another argument? How dare you!?
// TLDR -> task[0] in the cache got replaced by task[1]
ğŸ¤·â€â™‚ï¸ you cannot use getDataFromTask to get data from different tasks 
```

ä¸€æ—¦åŒä¸€ä¸ªé€‰æ‹©å™¨ä¸å¾—ä¸å¤„ç†ä¸åŒçš„æºæ•°æ®ï¼Œç”šè‡³æ›´å¤šçš„æºæ•°æ®â€”â€”ä¸€åˆ‡éƒ½å®Œäº†ã€‚è€Œä¸”å¾ˆå®¹æ˜“ç¢°åˆ°è¿™æ ·çš„é—®é¢˜:

*   åªè¦æˆ‘ä»¬ä½¿ç”¨é€‰æ‹©å™¨ä»ä¸€ä¸ªçŠ¶æ€ä¸­è·å–ä»»åŠ¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç›¸åŒçš„é€‰æ‹©å™¨ä»ä¸€ä¸ªä»»åŠ¡ä¸­è·å–æŸäº›ä¸œè¥¿ã€‚æ¿€çƒˆæ¥è‡ªäº API æœ¬èº«ã€‚ä½†å®ƒä¸å·¥ä½œï¼Œé‚£ä¹ˆä½ åªèƒ½è®°ä½æœ€åä¸€æ¬¡è°ƒç”¨ï¼Œä½†å¿…é¡»ä¸å¤šä¸ªæ•°æ®æºã€‚
*   å¤šä¸ª React ç»„ä»¶ä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜â€”â€”å®ƒä»¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æœ‰ä¸€ç‚¹ä¸åŒï¼Œè·å–ä¸åŒçš„ä»»åŠ¡ï¼Œåˆ é™¤å½¼æ­¤çš„ç»“æœã€‚

æœ‰ 3 ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ:

*   åœ¨é‡å¤çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ mapStateToProps å·¥å‚ã€‚å®ƒå°†åˆ›å»ºæ¯ä¸ªå®ä¾‹çš„è®°å¿†ã€‚

```
const mapStateToProps = () => {
   const selector = createSelector(...); 
   // ^ you have to define per-instance selectors here
   // usually that's not possible :) 
   return state => ({
      data: selector(data), // a usual mapStateToProps
   });
} 
```

*   ç¬¬äºŒä¸ªå˜ä½“å‡ ä¹ç›¸åŒ(å¯¹äº redux ä¹Ÿæ˜¯å¦‚æ­¤)â€”â€”å®ƒæ˜¯å…³äºä½¿ç”¨[é‡æ–°é€‰æ‹©](https://github.com/toomuchdesign/re-reselect)ã€‚è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„åº“ï¼Œé€šè¿‡åŒºåˆ†ç»„ä»¶å¯ä»¥åŒ–é™©ä¸ºå¤·ã€‚å®ƒå¯ä»¥ç†è§£ï¼Œæ–°çš„è°ƒç”¨æ˜¯é’ˆå¯¹â€œå¦ä¸€ä¸ªâ€ç»„ä»¶çš„ï¼Œå¹¶ä¸”å®ƒå¯ä»¥ä¸ºâ€œå‰ä¸€ä¸ªâ€ç»„ä»¶ä¿ç•™ç¼“å­˜ã€‚![](img/c1c29b5c2b1f8a97c0e5bcc71a891a07.png)

è¿™ä¸ªåº“å¯ä»¥å¸®åŠ©ä½ â€œä¿ç•™â€è®°å¿†ç¼“å­˜ï¼Œä½†ä¸èƒ½åˆ é™¤å®ƒã€‚å°¤å…¶æ˜¯å› ä¸ºå®ƒæ­£åœ¨å®ç° 5(äº”ï¼)é€‚åˆä»»ä½•æƒ…å†µçš„ä¸åŒç¼“å­˜ç­–ç•¥ã€‚é‚£æ˜¯ä¸€è‚¡éš¾é—»çš„æ°”å‘³ã€‚é€‰é”™äº†æ€ä¹ˆåŠï¼Ÿä½ è®°ä½çš„æ‰€æœ‰æ•°æ®â€”â€”ä½ è¿Ÿæ—©ä¼šå¿˜è®°çš„ã€‚é‡ç‚¹ä¸åœ¨äºè®°ä½æœ€åä¸€æ¬¡å‡½æ•°è°ƒç”¨â€”â€”é‡ç‚¹æ˜¯åœ¨é€‚å½“çš„æ—¶å€™å¿˜è®°å®ƒã€‚ä¸è¦å¤ªå¿«ï¼Œç ´åè®°å¿†ï¼Œä¹Ÿä¸è¦å¤ªæ™šã€‚

> æ˜ç™½äº†å—ï¼Ÿç°åœ¨ç®—äº†å§ï¼ç¬¬ä¸‰ç§å˜ä½“åœ¨å“ªé‡Œï¼Ÿï¼Ÿ

# ç¨ä½œåœé¡¿

åœä¸‹æ¥ã€‚æ”¾æ¾ç‚¹ã€‚åšä¸€ä¸ªæ·±å‘¼å¸ã€‚å›ç­”ä¸€ä¸ªç®€å•çš„é—®é¢˜-ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å¿…é¡»åšäº›ä»€ä¹ˆæ¥è¾¾åˆ°ç›®æ ‡ï¼Ÿä»€ä¹ˆèƒ½æ‹¯æ•‘è¿™ä¸€å¤©ï¼Ÿ

> æç¤º:â€œç¼“å­˜â€åœ¨å“ªé‡Œï¼

[![](img/1d4ab593fae49be5ae139736e4ccfd0f.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--iOgK4cbc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ocqzv58ryy472thyu1wy.jpeg)

â€œç¼“å­˜â€åœ¨å“ªé‡Œï¼Ÿæ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ­£ç¡®çš„é—®é¢˜ã€‚è°¢è°¢ä½ çš„æé—®ã€‚ç­”æ¡ˆå¾ˆç®€å•â€”â€”å®ƒä½äºä¸€ä¸ªé—­åŒ…é‡Œã€‚åœ¨ä¸€ä¸ªè®°å¿†å‡½æ•°çš„éšè—ç‚¹ã€‚ä¸¾ä¸ªä¾‹å­â€”â€”è¿™é‡Œæ˜¯`memoize-one`ä»£ç :

```
function(fn) {
  let lastArgs;  // the last arguments
  let lastResult;// the last result   <--- THIS IS THE CACHE
// the memoized function
const memoizedCall = function(...newArgs) {
    if (isEqual(newArgs, lastArgs)) {
      return lastResult;
    }
    lastResult = resultFn.apply(this, newArgs);
    lastArgs = newArgs;
    return lastResult;
  };
return memoizedCall;
} 
```

æ‚¨å°†è·å¾—ä¸€ä¸ª`memoizedCall`ï¼Œå®ƒå°†ä¿å­˜æœ€è¿‘çš„ç»“æœï¼Œåœ¨å®ƒçš„æœ¬åœ°é—­åŒ…å†…ï¼Œé™¤äº† memoizedCallï¼Œä»»ä½•äººéƒ½ä¸èƒ½è®¿é—®ã€‚ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ã€‚è¿™æ˜¯ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ã€‚

`Reselect`åšåŒæ ·çš„äº‹æƒ…ï¼Œå”¯ä¸€çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªâ€œfork â€,ç”¨å¦ä¸€ä¸ª cacheâ€”â€”åˆ›å»ºä¸€ä¸ªæ–°çš„ memoization é—­åŒ…ã€‚

ä½†æ˜¯(å¦ä¸€ä¸ª)ä¸»è¦é—®é¢˜æ˜¯â€”â€”å®ƒ(ç¼“å­˜)ä»€ä¹ˆæ—¶å€™ä¼šâ€œæ¶ˆå¤±â€ï¼Ÿ

> TLDR:å½“å‡½æ•°å®ä¾‹è¢«åƒåœ¾æ”¶é›†å™¨åƒæ‰æ—¶ï¼Œå®ƒå°±å’Œå‡½æ•°ä¸€èµ·â€œæ¶ˆå¤±â€äº†ã€‚

å®ä¾‹ï¼Ÿå®ä¾‹ï¼é‚£ä¹ˆâ€”â€”æ¯ä¸ªå®ä¾‹çš„è®°å¿†æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿåœ¨ [React æ–‡æ¡£](https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#what-about-memoization)ä¸­æœ‰ä¸€æ•´ç¯‡å…³äºå®ƒçš„æ–‡ç« 

ç®€è€Œè¨€ä¹‹â€”â€”å¦‚æœä½ ä½¿ç”¨åŸºäºç±»çš„ React ç»„ä»¶ï¼Œä½ å¯ä»¥:

```
import memoize from "memoize-one";
class Example extends Component {
  filter = memoize(          // <-- bound to the instance
    (list, filterText) => list.filter(...);
  // ^ that is "per instance" memoization
  // we are creating "own" memoization function
  // with the "own" lastResult
render() {
    // Calculate the latest filtered list. 
    // If these arguments haven't changed since the last render, 
    // `memoize-one` will reuse the last return value.
    const filteredList = this.filter(something, somehow);
    return <ul>{filteredList.map(item => ...}</ul>
  }
} 
```

é‚£ä¹ˆâ€”â€”åœ¨å“ªé‡Œå­˜å‚¨**â€œlast resultâ€**ï¼Ÿåœ¨å†…å­˜åŒ–çš„**è¿‡æ»¤å™¨**çš„å±€éƒ¨èŒƒå›´å†…ï¼Œåœ¨è¿™ä¸ªç±»å®ä¾‹å†…ã€‚å®ƒä»€ä¹ˆæ—¶å€™ä¼šâ€œæ¶ˆå¤±â€ï¼Ÿ

è¿™ä¸€æ¬¡ï¼Œå®ƒå°†éšç€ä¸€ä¸ªç±»å®ä¾‹â€œæ¶ˆå¤±â€ã€‚ä¸€æ—¦ç»„ä»¶è¢«å¸è½½ï¼Œå®ƒå°±æ¶ˆå¤±å¾—æ— å½±æ— è¸ªã€‚è¿™æ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œæ¯ä¸ªå®ä¾‹â€ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`this.lastResult`æ¥ä¿å­˜ä¸€ä¸ªæ—¶æ€ç»“æœï¼Œå…·æœ‰å®Œå…¨ç›¸åŒçš„â€œè®°å¿†åŒ–â€æ•ˆæœã€‚

## æœ‰ä»€ä¹ˆååº”ã€‚é’©ä½

æˆ‘ä»¬è¶Šæ¥è¶Šè¿‘äº†ã€‚Redux æŒ‚é’©æœ‰å‡ ä¸ªå¯ç–‘çš„å‘½ä»¤ï¼Œå¯èƒ½æ˜¯å…³äºå†…å­˜åŒ–çš„ã€‚å–œæ¬¢- `useMemo`ã€`useCallback`ã€`useRef`

[![](img/092ddf5bd29c74370d4c5a84c7baf081.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--C-LG_ZiC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/bcaigenjb8t9hnpe0oho.png)

> ä½†é—®é¢˜æ˜¯ï¼Œè¿™æ¬¡å®ƒåœ¨å“ªé‡Œå­˜å‚¨ä¸€ä¸ªè®°å¿†å€¼ï¼Ÿ

ç®€è€Œè¨€ä¹‹â€”â€”å®ƒæŠŠå®ƒå­˜å‚¨åœ¨â€œé’©å­â€é‡Œï¼Œåœ¨ VDOM å…ƒç´ çš„ä¸€ä¸ªç‰¹æ®Šéƒ¨åˆ†ï¼Œå³ä¸å½“å‰å…ƒç´ ç›¸å…³çš„çº¤ç»´é‡Œã€‚åœ¨å¹¶è¡Œæ•°æ®ç»“æ„ä¸­ã€‚

ä¸é‚£ä¹ˆçŸ­â€”â€”é’©å­æ­£åœ¨æ”¹å˜ä½ çš„ç¨‹åºå·¥ä½œæ–¹å¼ï¼ŒæŠŠä½ çš„å‡½æ•°ç§»åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œåœ¨çˆ¶é—­åŒ…çš„*éšè—ç‚¹ä¸­æœ‰ä¸€äº›å˜é‡ã€‚è¿™æ ·çš„å‡½æ•°è¢«ç§°ä¸º*å¯æŒ‚èµ·çš„*æˆ–*å¯æ¢å¤çš„*å‡½æ•°-åç¨‹ã€‚åœ¨ JavaScript ä¸­ï¼Œå®ƒä»¬é€šå¸¸è¢«ç§°ä¸º`generators`æˆ–`async functions`ã€‚*

ä½†è¿™æœ‰ç‚¹æç«¯ã€‚åœ¨ä¸€ä¸ªå¾ˆçŸ­çš„æ—¶é—´å†…ï¼ŒMemo å°†å­˜å‚¨çš„å€¼å­˜å‚¨åœ¨è¿™é‡Œã€‚åªæ˜¯â€œè¿™ä¸ªâ€æœ‰ç‚¹ä¸ä¸€æ ·ã€‚

> å¦‚æœæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªæ›´å¥½çš„è®°å¿†åº“ï¼Œæˆ‘ä»¬åº”è¯¥æ‰¾åˆ°ä¸€ä¸ªæ›´å¥½çš„â€œè¿™ä¸ªâ€ã€‚

Zingï¼

[![](img/26e9e28676848b9f4bd00eafb38a0bac.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ZDQxOGpg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/269y6jgh6hdi9vs5uuyo.gif)

# WeakMapsï¼

æ˜¯å•Šï¼å­¬ç§ï¼å­˜å‚¨ key-valueï¼Œè¿™é‡Œçš„ key åº”è¯¥æ˜¯ thisï¼Œåªè¦ WeakMap ä¸æ¥å—é™¤ this ä»¥å¤–çš„ä»»ä½•ä¸œè¥¿ï¼Œå³â€œobjectsâ€ã€‚

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ä¾‹å­:

```
const createHiddenSpot = (fn) => {
  const map = new WeakMap(); // a hidden "closure"
  const set = (key, value) => (map.set(key, value), value);
  return (key) => { 
     return map.get(key) || set(key, fn(key))
  }
}
const weakSelect = createHiddenSpot(selector);
weakSelect(todos);    // create a new entry
weakSelect(todos);    // return an existing entry
weakSelect(todos[0]); // create a new entry
weakSelect(todos[1]); // create a new entry
weakSelect(todos[0]); // return an existing entry!
weakSelect(todos[1]); // return an existing entry!!
weakSelect(todos);    // return an existing entry!!! 
```

è¿™éå¸¸ç®€å•ï¼Œè€Œä¸”éå¸¸â€œæ­£ç¡®â€ã€‚æ‰€ä»¥â€œå®ƒä»€ä¹ˆæ—¶å€™ä¼šæ¶ˆå¤±â€ï¼Ÿ

*   å¿˜è®° weakSelectï¼Œæ•´ä¸ªâ€œåœ°å›¾â€éƒ½ä¼šæ¶ˆå¤±
*   å¿˜è®° todos[0],ä»–ä»¬çš„å¼±å…¥å£å°±ä¼šæ¶ˆå¤±
*   å¿˜è®°å¾…åŠäº‹é¡¹â€”â€”è®°å¿†çš„æ•°æ®å°†ä¼šæ¶ˆå¤±ï¼

> å¾ˆæ¸…æ¥šä»€ä¹ˆæ—¶å€™æŸæ ·ä¸œè¥¿ä¼šâ€œæ¶ˆå¤±â€â€”â€”åªæœ‰åœ¨å®ƒåº”è¯¥æ¶ˆå¤±çš„æ—¶å€™ï¼

ç¥å¥‡çš„æ˜¯ï¼Œæ‰€æœ‰çš„é‡é€‰é—®é¢˜éƒ½æ¶ˆå¤±äº†ã€‚æ¿€è¿›è®°å¿†åŒ–çš„é—®é¢˜â€”â€”ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚

è¿™ç§æ–¹æ³•**è®°ä½**çš„æ•°æ®ï¼Œç›´åˆ°**å¿˜è®°**ä¸ºæ­¢ã€‚è¿™ä»¤äººéš¾ä»¥ç½®ä¿¡ï¼Œä½†æ˜¯ä¸ºäº†æ›´å¥½åœ°è®°ä½ä¸€äº›äº‹æƒ…ï¼Œä½ å¿…é¡»èƒ½å¤Ÿæ›´å¥½åœ°å¿˜è®°å®ƒã€‚

å”¯ä¸€æŒä¹…çš„æ˜¯â€”â€”ä¸ºè¿™ç§æƒ…å†µåˆ›å»ºä¸€ä¸ªæ›´å¥å£®çš„ API

# Kashe -æ˜¯ç¼“å­˜

kashe æ˜¯ä¸€ä¸ªåŸºäº WeakMap çš„è®°å¿†åº“ï¼Œå¯ä»¥èŠ‚çœæ‚¨çš„æ—¶é—´ã€‚

## ![GitHub logo](img/a73f630113876d78cff79f59c2125b24.png) [å–€ä»€](https://github.com/theKashey) / [å–€ä»€](https://github.com/theKashey/kashe)

### åŸºäº weakmaps çš„è®°å¿†åº“ã€‚ğŸ¤¯æœ‰æ—¶ç¼“å­˜æ˜¯ kashe

<article class="markdown-body entry-content container-lg" itemprop="text">

# å–€ä»€ã€”t0ã€•ğŸ”¥

It's like **cache**, but with forget-me-bomb... remember it? No
[![](img/ccd237913228465844fa9f95bbc81b12.png) ](https://www.npmjs.com/package/kashe) [![Travis](img/704f634708f044f756676f62ec073866.png)](https://travis-ci.org/theKashey/kashe) 

ä¸€ä¸ªåŸºäº WeakMap çš„å†…å­˜åº“ï¼Œç”¨äºæ›´å¥½æ›´å®‰å…¨çš„ç¼“å­˜

## è®°å¿†åŒ–

è®°å¿†æ˜¯å¾ˆé…·çš„æŠ€æœ¯ã€‚ä½†æ˜¯å®ƒå¯é *å®‰å…¨*å—ï¼Ÿ

`lodash.memoize`ã€`memoize-one`ã€`React.useMemo`æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

*   lodash.memoize æ˜¯ä¸ªå¾ˆé…·çš„ä¸œè¥¿ã€‚ä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæœ‰æ— é™çš„ç¼“å­˜å¤§å°ã€‚
*   åªæœ‰è®°å¾—æœ€è¿‘çš„äº‰è®ºå’Œç»“æœã€‚ä¸éœ€è¦æ‹…å¿ƒ**ç¼“å­˜ç ´å**æœºåˆ¶ï¼Œä¾‹å¦‚ maxAgeã€maxSizeã€exclusions ç­‰ç­‰ï¼Œè¿™äº›æœºåˆ¶å®¹æ˜“å¯¼è‡´**å†…å­˜æ³„æ¼**ã€‚
*   [react.useMemo](https://reactjs.org/docs/hooks-reference.html#usememo) æ˜¯æœ€ä¼Ÿå¤§çš„ã€‚ä»ç„¶åªè®°å¿†**ä¸€ä¸ª**è°ƒç”¨ï¼Œä½†æ˜¯åœ¨æ¯ä¸ªç»„ä»¶çº§åˆ«ä¸Šè¿™æ ·åš`useMemo`çš„ç¼ºç‚¹æ˜¯ååº”ã€‚æ‚¨ä¸èƒ½åœ¨åŠŸèƒ½ç»„ä»¶ä¹‹å¤–ä½¿ç”¨å®ƒã€‚

é‚£ä¹ˆ`reselect`ï¼Œä¸€ä¸ªä¸ºæ•´ä¸ª`redux`ç”Ÿæ€ç³»ç»Ÿæä¾›åŠ¨åŠ›çš„å·¥å…·å‘¢ï¼Ÿè¿˜- **å•ä¸ªç¼“å­˜é¡¹**ã€‚

*   å®ƒå¯¹æœåŠ¡å™¨ç«¯å‹å¥½å—ï¼Ÿä¸ï¼ŒæœåŠ¡å™¨å¤„ç†è®¸å¤šè¯·æ±‚â€¦

</article>

[View on GitHub](https://github.com/theKashey/kashe)

è¿™ä¸ªåº“å…¬å¼€äº† 4 ä¸ªå‡½æ•°

*   `kashe`-ç”¨äºè®°å¿†ã€‚
*   `box` -å¯¹äºå‰ç¼€è®°å¿†ï¼Œåˆ°*å¢åŠ *è®°å¿†çš„å‡ ç‡ã€‚
*   `inbox` -åµŒå¥—å‰ç¼€è®°å¿†åŒ–ï¼Œä»¥*å‡å°‘*å˜åŒ–çš„è®°å¿†åŒ–
*   `fork` -åˆ°*å‰*(æ˜æ˜¾)è®°å¿†åŒ–ã€‚

## ã€kashe(fn)=>è®°å¿†ç (â€¦args)

å®ƒå®é™…ä¸Šæ˜¯ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­çš„ createHiddenSpotã€‚å®ƒå°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå†…éƒ¨ WeakMap çš„å¯†é’¥ã€‚

```
const selector = (state, prop) => ({result: state[prop]});
const memoized = kashe(selector);
const old = memoized(state, 'x')
memoized(state, 'x') === old
memoized(state, 'y') === memoized(state, 'y') 
// ^^ another argument
// but
old !== memoized(state, 'x') // 'y' wiped 'x' cache in `state` 
```

ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé”®ï¼Œå¦‚æœä½ å†æ¬¡è°ƒç”¨åŒä¸€ä¸ªé”®çš„å‡½æ•°ï¼Œä½†æ˜¯ä¸åŒçš„å‚æ•°â€”â€”ç¼“å­˜å°†è¢«æ›¿æ¢ï¼Œå®ƒä»ç„¶æ˜¯ä¸€ä¸ªç¼“å­˜è¡Œé•¿çš„å†…å­˜åŒ–ã€‚è¦ä½¿å®ƒå·¥ä½œï¼Œä½ å¿…é¡»ä¸ºä¸åŒçš„æƒ…å†µæä¾›ä¸åŒçš„é”®ï¼Œæ­£å¦‚æˆ‘åœ¨ weakSelect ä¾‹å­ä¸­æ‰€åšçš„é‚£æ ·ï¼Œä»¥æä¾›ä¸åŒçš„ this to hold ç»“æœã€‚é‡é€‰ç€‘å¸ƒ A è¿˜æ˜¯é‚£ä¸ªä¸œè¥¿ã€‚ä¸æ˜¯æ‰€æœ‰çš„åŠŸèƒ½éƒ½æ˜¯å¯è®°å¿†çš„ã€‚ç¬¬ä¸€ä¸ªå‚æ•°*è®©*æˆä¸ºä¸€ä¸ªå¯¹è±¡ã€æ•°ç»„æˆ–å‡½æ•°ã€‚å®ƒåº”è¯¥å¯ä»¥ä½œä¸º WeakMap çš„é’¥åŒ™ã€‚

## box(fn)=>memoizedfn 2(boxï¼Œâ€¦args)

è¿™æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼Œåªæ˜¯åº”ç”¨äº†ä¸¤æ¬¡ã€‚ä¸€æ¬¡ç”¨äº fnï¼Œä¸€æ¬¡ç”¨äº memoizedFnï¼Œä¸ºå‚æ•°æ·»åŠ ä¸€ä¸ªå‰å¯¼é”®ã€‚å®ƒå¯èƒ½ä¼šä½¿ä»»ä½•åŠŸèƒ½å˜å¾—å¯è®°å¿†ã€‚

> è¿™æ˜¯ç›¸å½“å£°æ˜æ€§çš„-å˜¿åŠŸèƒ½ï¼æˆ‘ä¼šæŠŠç»“æœå‚¨å­˜åœ¨è¿™ä¸ªç›’å­é‡Œã€‚

```
// could not be "kashe" memoized
const addTwo = (a,b) => ({ result: a+b }); 
const bAddTwo = boxed(addTwo);
const cacheKey = {}; // any object
bAddTwo(cacheKey, 1, 2) === bAddTwo(cacheKey, 1, 2) === { result: 3} 
```

å¦‚æœä½ å°†å·²ç»è®°å¿†çš„å‡½æ•°è£…ç®±ï¼Œä½ å°†å¢åŠ è®°å¿†çš„æœºä¼šï¼Œå°±åƒæ¯ä¸ªå®ä¾‹è®°å¿†ä¸€æ ·ï¼Œä½ å¯ä»¥åˆ›å»ºè®°å¿†çº§è”ã€‚

```
const selectSomethingFromTodo = (state, prop) => ...
const selector = kashe(selectSomethingFromTodo);
const boxedSelector = kashe(selector);
class Component {
  render () {
    const result = boxedSelector(this, todos, this.props.todoId);
    // 1\. try to find result in `this`
    // 2\. try to find result in `todos`
    // 3\. store in `todos`
    // 4\. store in `this`
    // if multiple `this`(components) are reading from `todos` - 
    // selector is not working (they are wiping each other)
    // but data stored in `this` - exists.
    ...
  }
} 
```

## æ”¶ä»¶ç®±(fn) = > memoizedFn2(boxï¼Œâ€¦args)

è¿™ä¸ªä¸ç›’å­ç›¸åï¼Œä½†åšçš„å‡ ä¹ä¸€æ ·ï¼Œå‘½ä»¤åµŒå¥—ç¼“å­˜å°†æ•°æ®å­˜å‚¨åˆ°æä¾›çš„ç›’å­ä¸­ã€‚ä»ä¸€ä¸ªè§’åº¦æ¥çœ‹â€”â€”å®ƒé™ä½äº†å†…å­˜åŒ–çš„å¯èƒ½æ€§(æ²¡æœ‰å†…å­˜åŒ–çº§è”),ä½†ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹â€”â€”å®ƒæ¶ˆé™¤äº†ç¼“å­˜å†²çªï¼Œå¹¶æœ‰åŠ©äºéš”ç¦»è¿›ç¨‹(å¦‚æœå®ƒä»¬ä¸ä¼šå› ä»»ä½•åŸå› è€Œç›¸äº’å¹²æ‰°çš„è¯)ã€‚

> ç›¸å½“å…·æœ‰å®£ç¤ºæ€§â€”â€”å˜¿ï¼æ‰€æœ‰äººéƒ½è¿›å»ï¼è¿™é‡Œæœ‰ä¸€ä¸ªæ¡†å¯ä»¥ä½¿ç”¨

```
const getAndSet = (task, number) => task.value + number;
const memoized = kashe(getAndSet);
const inboxed = inbox(getAndSet);
const doubleBoxed = inbox(memoized);
memoized(task, 1) // ok
memoized(task, 2) // previous result wiped
inboxed(key1, task, 1) // ok
inboxed(key2, task, 2) // ok
// inbox also override the cache for any underlaying kashe calls
doubleBoxed(key1, task, 1) // ok
doubleBoxed(key2, task, 2) // ok 
```

## å‰(kashe-memo ized)=>kashe-memo ized

Fork æ˜¯ä¸€ä¸ªçœŸæ­£çš„ forkâ€”â€”å®ƒè·å–ä»»ä½• kashe-memoized å‡½æ•°ï¼Œå¹¶è¿”å›ç›¸åŒçš„ç»“æœï¼Œä½†å¸¦æœ‰å¦ä¸€ä¸ªå†…éƒ¨ç¼“å­˜æ¡ç›®ã€‚è¿˜è®°å¾— redux mapStateToProps å·¥å‚æ–¹æ³•å—ï¼Ÿ

```
const mapStateToProps = () => {
   // const selector = createSelector(...); // 
   const selector = fork(realSelector);
   // just fork existing selector. Or box it, or don't do anything
   // kashe is more "stable" than reselect.
   return state => ({
      data: selector(data),
   });
} 
```

## é‡æ–°é€‰æ‹©

è¿˜æœ‰ä¸€ä»¶äº‹ä½ åº”è¯¥çŸ¥é“â€”â€”kashe å¯ä»¥ä»£æ›¿ reselectã€‚å­—é¢ä¸Šã€‚

```
import { createSelector } from 'kashe/reselect'; 
```

å®ƒå®é™…ä¸Šæ˜¯ç›¸åŒçš„é‡é€‰ï¼Œåªæ˜¯ç”¨ kashe ä½œä¸ºè®°å¿†å‡½æ•°åˆ›å»ºçš„ã€‚

# Codesandbox

è¿™é‡Œæœ‰ä¸€ä¸ª[å°ä¾‹å­](https://codesandbox.io/s/v8953mz17l?from-embed)å¯ä»¥ç©ã€‚ä½ ä¹Ÿå¯ä»¥åŠ å€[æ£€æŸ¥æµ‹è¯•](https://github.com/theKashey/kashe/tree/master/__tests__) -ä»–ä»¬æ˜¯ç´§å‡‘å’Œå¥å…¨çš„ã€‚
å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºç¼“å­˜å’Œè®°å¿†åŒ–çš„çŸ¥è¯†â€”â€”çœ‹çœ‹ä¸€å¹´å‰[æˆ‘æ˜¯å¦‚ä½•ç¼–å†™æœ€å¿«çš„è®°å¿†åŒ–åº“](https://itnext.io/how-i-wrote-the-worlds-fastest-react-memoization-library-535f89fc4a17)çš„ã€‚

æ˜¯çš„ï¼Œä½ çŸ¥é“åœ¨å“ªé‡Œèƒ½æ‰¾åˆ°æˆ‘

> ![Anton Korzunov profile image](img/951d3be8c74f47ad2b91e2cc0080bd91.png)å®‰ä¸œÂ·ç§‘å°”ç¥–è¯ºå¤«[@ the kashey](https://dev.to/thekashey)![twitter logo](img/65e26e35707d96169ec8af6b3cbf2003.png)[@ Alexander eardon](https://twitter.com/alexandereardon)è€¶â€”â€”â€˜ä¸å¯é‡Šæ”¾â€™ç¼“å­˜æ˜¯ memoize çš„é˜´æš—é¢â€”â€”one æˆ– reselectã€‚å‡ å¤©åä¼šä¿®å¥½çš„ã€‚2019 å¹´ 03 æœˆ 03 æ—¥ 21 ç‚¹ 54 åˆ†[![Twitter reply action](img/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1102326464563695617)[![Twitter retweet action](img/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1102326464563695617)0[![Twitter like action](img/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1102326464563695617)0

> PS:å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ¯”è¿™ç§æ–¹æ³•æ›´ç®€å•çš„ç‰ˆæœ¬â€”â€”weak-memo izeâ€”â€”åœ¨ emotion-js ä¸­ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ã€‚æ²¡æœ‰æŠ±æ€¨ã€‚nano-memoize è¿˜ä½¿ç”¨ WeakMaps æ¥å¤„ç†å•ä¸ªå‚æ•°çš„æƒ…å†µã€‚

æ˜ç™½äº†å—ï¼Ÿä¸€ä¸ªæ›´â€œå¼±â€çš„æ–¹æ³•ä¼šå¸®åŠ©ä½ æ›´å¥½åœ°è®°ä½ä¸€äº›ä¸œè¥¿ï¼Œæ›´å¥½åœ°å¿˜è®°å®ƒã€‚

æ˜¯çš„ï¼Œå…³äºå¿˜è®°ä¸€äº›ä¸œè¥¿ï¼Œä½ èƒ½çœ‹çœ‹è¿™é‡Œå—ï¼Ÿ

[![](img/924233ba361b135cea53efbfdd87573b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--RHq_jESO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/b53ypzy1mp0w1uenftsj.png)***