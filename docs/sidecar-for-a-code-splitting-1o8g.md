# ğŸš—ç”¨äºä»£ç åˆ†å‰²çš„è¾¹è½¦

> åŸæ–‡ï¼š<https://dev.to/thekashey/sidecar-for-a-code-splitting-1o8g>

ä»£ç åˆ†å‰²ã€‚ä»£ç æ‹†åˆ†æ— å¤„ä¸åœ¨ã€‚ç„¶è€Œï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿä»…ä»…å› ä¸ºç°åœ¨æœ‰å¤ªå¤šçš„ javascriptï¼Œè€Œä¸”ä¸æ˜¯æ‰€æœ‰çš„éƒ½åœ¨åŒä¸€æ—¶é—´ç‚¹ä½¿ç”¨ã€‚

JS æ˜¯ä¸€ä¸ªå¾ˆ*é‡*çš„ä¸œè¥¿ã€‚ä¸æ˜¯ä¸ºä½ çš„ iPhone Xs æˆ–å…¨æ–°çš„ i9 ç¬”è®°æœ¬ç”µè„‘ï¼Œè€Œæ˜¯ä¸ºæ•°ç™¾ä¸‡(å¯èƒ½æ˜¯æ•°åäº¿)è¾ƒæ…¢çš„*è®¾å¤‡æ‹¥æœ‰è€…ã€‚æˆ–è€…è‡³å°‘æ˜¯ä½ çš„æ‰‹è¡¨ã€‚*

æ‰€ä»¥- JS æ˜¯ä¸å¥½çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬**ç¦ç”¨å®ƒ**ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢-é—®é¢˜ä¼šæ¶ˆå¤±...å¯¹äºä¸€äº›ç½‘ç«™æ¥è¯´ï¼Œå’ŒåŸºäº React çš„ç½‘ç«™ä¸€èµ·æ¶ˆå¤±ã€‚ä½†æ˜¯ä¸ç®¡æ€æ ·ï¼Œæœ‰äº›ç½‘ç«™ä¸éœ€è¦ JS ä¹Ÿèƒ½å·¥ä½œ...æˆ‘ä»¬åº”è¯¥å‘ä»–ä»¬å­¦ä¹ ä¸€äº›ä¸œè¥¿...

# ä»£ç æ‹†åˆ†

ä»Šå¤©ï¼Œæˆ‘ä»¬æœ‰ä¸¤æ¡è·¯å¯èµ°ï¼Œä¸¤æ¡è®©å®ƒå˜å¾—æ›´å¥½æˆ–ä¸å˜å¾—æ›´ç³Ÿçš„è·¯:

## 1ã€‚å°‘å†™ä»£ç 

é‚£æ˜¯ä½ èƒ½åšçš„æœ€å¥½çš„äº‹æƒ…ã€‚è™½ç„¶`React Hooks`å¯ä»¥è®©ä½ å‘å¸ƒæ›´å°‘çš„ä»£ç ï¼Œåƒ`Svelte`è¿™æ ·çš„è§£å†³æ–¹æ¡ˆå¯ä»¥è®©ä½ ç”Ÿæˆæ¯”*é€šå¸¸çš„*æ›´å°‘çš„ä»£ç ï¼Œä½†è¿™å¹¶ä¸å®¹æ˜“åšåˆ°ã€‚

è¿™ä¸ä»…ä¸ä»£ç æœ‰å…³ï¼Œè¿˜ä¸*åŠŸèƒ½*æœ‰å…³â€”â€”ä¸ºäº†ä¿æŒä»£ç â€œç´§å‡‘â€ï¼Œä½ å¿…é¡»ä¿æŒå®ƒâ€œç´§å‡‘â€ã€‚å¦‚æœ application bundle è¦åšè¿™ä¹ˆå¤šäº‹æƒ…(å¹¶ä¸”æœ‰ 20 ç§è¯­è¨€ç‰ˆæœ¬)ï¼Œå°±æ²¡æœ‰åŠæ³•ä¿æŒå®ƒçš„å°ã€‚

æœ‰åŠæ³•å†™å‡º*ç®€çŸ­è€Œå¥å…¨çš„*ä»£ç ï¼Œä¹Ÿæœ‰åŠæ³•å†™å‡ºç›¸åçš„å®ç°â€”â€”*è¡€æˆ˜ä¼ä¸š*ã€‚ä½ çŸ¥é“ï¼Œä¸¤è€…éƒ½æ˜¯åˆæ³•çš„ã€‚

[![](img/03fa269c6ae0c9e723cca1cac356247b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--lG6PDbQr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/owpecb2mbhg4bg2bck7s.png)

ä½†ä¸»è¦é—®é¢˜æ˜¯ä»£ç æœ¬èº«ã€‚ä¸€ä¸ªç®€å•çš„ react åº”ç”¨ç¨‹åºå¯ä»¥è½»æ¾ç»•è¿‡â€œæ¨èâ€çš„ 250kbã€‚ä½ å¯èƒ½ä¼šèŠ±ä¸€ä¸ªæœˆçš„æ—¶é—´ä¼˜åŒ–å®ƒï¼Œè®©å®ƒå˜å¾—æ›´å°ã€‚â€œå°â€ä¼˜åŒ–è¢«å¾ˆå¥½åœ°è®°å½•ä¸‹æ¥å¹¶ä¸”éå¸¸æœ‰ç”¨â€”â€”åªéœ€ç”¨`size-limit`å¾—åˆ°`bundle-analyzer`,ç„¶åæ¢å¤åŸçŠ¶ã€‚
æœ‰è®¸å¤šåº“ï¼Œå®ƒä»¬äº‰å¤ºæ¯ä¸€ä¸ªå­—èŠ‚ï¼Œè¯•å›¾è®©ä½ ä¿æŒåœ¨ä½ çš„æé™å†…â€”â€”[preact](https://preactjs.com/)å’Œ [storeon](https://github.com/storeon/storeon) ï¼Œä»…ä¸¾å‡ ä¾‹ã€‚

ä½†æ˜¯æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¶…è¿‡äº† 200kbã€‚æ›´æ¥è¿‘ **100Mb** ã€‚åˆ é™¤åƒå­—èŠ‚æ²¡æœ‰æ„ä¹‰ã€‚å³ä½¿åˆ é™¤å…†å­—èŠ‚ä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚

> è¿‡ä¸€ä¼šå„¿ï¼Œä½ å°±ä¸å¯èƒ½è®©ä½ çš„åº”ç”¨ç¨‹åºä¿æŒå°äº†ã€‚å®ƒä¼šæ…¢æ…¢å˜å¤§ã€‚

## 2ã€‚æ— èˆ¹ä»£ç 

æˆ–è€…ï¼Œ`code split`ã€‚æ¢å¥è¯è¯´â€”â€”**æŠ•é™**ã€‚æ‹¿ä½ çš„ 100mb åŒ…ï¼Œåš 20 ä¸ª 5mb åŒ…ã€‚è€å®è¯´â€”â€”å¦‚æœä½ çš„åº”ç”¨ç¨‹åºå˜å¤§äº†ï¼Œè¿™æ˜¯å”¯ä¸€å¯èƒ½çš„å¤„ç†æ–¹æ³•â€”â€”ç”¨å®ƒåˆ›å»ºä¸€ä¸ªå°åº”ç”¨ç¨‹åºåŒ…ã€‚

> æ—¢ç„¶æˆ‘ä»¬æ­£åœ¨è®¨è®ºå®ƒï¼Œä½ å¯èƒ½å¸Œæœ›ç¡®ä¿åœ¨ 2019 å¹´åº”å¯¹ä»£ç æ‹†åˆ†æ—¶ï¼Œä½ æ˜¯æœ€æ–°å’Œæœ€æ£’çš„ã€‚æˆ–è€…åªæ˜¯é˜…è¯»ä¸€äº›å®ç°ç»†èŠ‚ã€‚

[![thekashey image](img/7af672ebf5c7bceac7469e8a0f64ea0d.png)](/thekashey) [## ğŸ’¡2019 å¹´ååº”ä»£ç æ‹†åˆ†

### Anton Korzunov 3 æœˆ 19 æ—¥ 7 åˆ†é’Ÿè¯»å–

#react #javascript #ssr #codesplitting](/thekashey/react-code-splitting-in2019-3cmg)

ä½†æ˜¯ç°åœ¨æœ‰ä¸€ä»¶äº‹ä½ åº”è¯¥çŸ¥é“:æ— è®ºä½ é€‰æ‹©å“ªä¸ªé€‰é¡¹ï¼Œå®ƒéƒ½æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚ï¼Œè€Œæˆ‘ä»¬æ­£åœ¨å¯»æ‰¾æ›´å¯é çš„ä¸œè¥¿ã€‚

# å…³äºä»£ç æ‹†åˆ†çš„çœŸç›¸

å…³äºä»£ç æ‹†åˆ†çš„çœŸç›¸æ˜¯ï¼Œå®ƒçš„æœ¬è´¨æ˜¯**æ—¶é—´åˆ†éš”**ã€‚ä½ ä¸ä»…ä»…æ˜¯*åˆ†å‰²*ä½ çš„ä»£ç ï¼Œä½ è¿˜ä»¥ä¸€ç§æ–¹å¼åˆ†å‰²å®ƒï¼Œè®©**åœ¨ä¸€ä¸ªæ—¶é—´ç‚¹å°½å¯èƒ½å°‘åœ°ä½¿ç”¨**ã€‚

åªæ˜¯ä¸è¦å‘å¸ƒä½ ç°åœ¨ä¸éœ€è¦çš„ä»£ç ã€‚æ‘†è„±å®ƒã€‚

[![seee yaa](img/010fc1cfe217d14a93dd35fd623bbb6f.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Zpy8sx-3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5hh0jid2m3la0t8o5b2x.png)

è¯´èµ·æ¥å®¹æ˜“ï¼Œåšèµ·æ¥éš¾ã€‚æˆ‘æœ‰å‡ ä¸ªæ²‰é‡çš„ï¼Œä½†æ²¡æœ‰å……åˆ†åˆ†è£‚çš„åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­ä»»ä½•ä¸€ä¸ªé¡µé¢åŠ è½½äº†å¤§çº¦ 50%çš„ä¸œè¥¿ã€‚æœ‰æ—¶`code splitting`å˜æˆäº†`code separation`ï¼Œæˆ‘çš„æ„æ€æ˜¯â€”â€”ä½ å¯ä»¥å°†ä»£ç ç§»åŠ¨åˆ°ä¸åŒçš„å—ä¸­ï¼Œä½†æ˜¯ä»ç„¶è¦å…¨éƒ¨ä½¿ç”¨ã€‚å›æƒ³ä¸€ä¸‹*â€œä¸è¦å‘å¸ƒä½ ç°åœ¨ä¸éœ€è¦çš„ä»£ç â€*ï¼Œâ€“æˆ‘*éœ€è¦* 50%çš„ä»£ç ï¼Œè¿™æ‰æ˜¯çœŸæ­£çš„é—®é¢˜ã€‚

> æœ‰æ—¶ä»…ä»…åœ¨è¿™é‡Œå’Œé‚£é‡ŒåŠ ä¸Š`import`æ˜¯ä¸å¤Ÿçš„ã€‚ç›´åˆ°ä¸æ˜¯**æ—¶é—´**åˆ†ç¦»ï¼Œè€Œåªæ˜¯**ç©ºé—´**åˆ†ç¦»â€”â€”è¿™ä¸€ç‚¹éƒ½ä¸é‡è¦ã€‚

æœ‰ 3 ç§å¸¸è§çš„ä»£ç æ‹†åˆ†æ–¹å¼:

1.  åªæ˜¯åŠ¨æ€`import`ã€‚è¿™å‡ å¤©å¾ˆå°‘å•ç‹¬ä½¿ç”¨ã€‚å®ƒæ›´å¤šçš„æ˜¯å…³äºè·Ÿè¸ªä¸€ä¸ª*çŠ¶æ€*çš„é—®é¢˜ã€‚
2.  å½“æ‚¨å¯èƒ½æ¨è¿Ÿ React ç»„ä»¶çš„å‘ˆç°å’ŒåŠ è½½æ—¶ã€‚å¦‚ä»Šå¤§æ¦‚ 90%çš„â€œååº”ä»£ç åˆ†å‰²â€ã€‚
3.  *æ‡’* `Library`ï¼Œå…¶å®å°±æ˜¯`.1`ï¼Œä½†æ˜¯ä¼šé€šè¿‡ React æ¸²æŸ“é“å…·ç»™ä½ ä¸€ä¸ªåº“ç ã€‚åœ¨ [react-imported-component](https://github.com/theKashey/react-imported-component#library-level-code-splitting) å’Œ [loadable-components](https://www.smooth-code.com/open-source/loadable-components/docs/library-splitting/) ä¸­å®ç°ã€‚ç›¸å½“æœ‰ç”¨ï¼Œä½†ä¸å¤ªä¸ºäººæ‰€çŸ¥ã€‚

## ç»„ä»¶çº§ä»£ç æ‹†åˆ†

è¿™ä¸ªæœ€å—æ¬¢è¿ã€‚ä½œä¸ºæ¯è·¯ç”±ä»£ç åˆ†å‰²æˆ–æ¯ç»„ä»¶ä»£ç åˆ†å‰²ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹å¹¶æœ€ç»ˆä¿æŒè‰¯å¥½çš„*æ„ŸçŸ¥æ•ˆæœ*å¹¶ä¸å®¹æ˜“ã€‚ä»`Flash of Loading Content`å¼€å§‹å°±æ˜¯æ­»äº¡ã€‚

å¥½çš„æŠ€å·§æ˜¯:

*   å¹¶è¡ŒåŠ è½½ä¸€æ¡è·¯çº¿çš„`js chunk`å’Œ`data`ã€‚
*   ä½¿ç”¨`skeleton`åœ¨é¡µé¢åŠ è½½å‰æ˜¾ç¤ºç±»ä¼¼é¡µé¢çš„å†…å®¹(å¦‚è„¸ä¹¦)ã€‚
*   ä¸ºäº†æ›´å¥½çš„é¢„æµ‹ï¼Œä½ ç”šè‡³å¯ä»¥ä½¿ç”¨ [guess-js](https://github.com/guess-js/guess) ã€‚
*   ä½¿ç”¨ä¸€äº›å»¶è¿Ÿã€åŠ è½½æŒ‡ç¤ºå™¨ã€`animations`å’Œ`Suspense`(å°†æ¥)æ¥è½¯åŒ–è¿‡æ¸¡ã€‚

è€Œä¸”ï¼Œä½ çŸ¥é“ï¼Œé‚£éƒ½æ˜¯å…³äº*æ„ŸçŸ¥*è¡¨ç°çš„ã€‚

[![](img/c3a6449079b02b06d0edb95031c87bbb.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--NP7f8YXF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/4tl08n169vx1ziat7nhc.png)

> å›¾ç‰‡æ¥è‡ª[ç”¨å¹½çµå…ƒç´ æ”¹è¿›çš„ UX](https://blog.angularindepth.com/https-medium-com-thomasburleson-animated-ghosts-bfc045a51fba)

# å¬èµ·æ¥ä¸å¤ªå¥½

ä½ çŸ¥é“ï¼Œæˆ‘å¯ä»¥ç§°è‡ªå·±ä¸ºä»£ç åˆ†è§£ä¸“å®¶ï¼Œä½†æˆ‘ä¹Ÿæœ‰è‡ªå·±çš„å¤±è´¥ã€‚

æœ‰æ—¶æˆ‘å¯èƒ½æ— æ³•å‡å°‘åŒ…çš„å¤§å°ã€‚æœ‰æ—¶æˆ‘å¯èƒ½æ— æ³•æé«˜ç»“æœæ€§èƒ½ï¼Œåªè¦`the _more_ code-splitting you are introducing - the more you spatially split your page - the more time you need to _reassemble_ your page back` *ã€‚è¿™å«åš**åŠ è½½æ³¢**ã€‚

> *   No SSR or pre-rendering. The appropriate SSR is the current game changer.

[![loading waves](img/725e79ba3809310c67e9027334968234.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--gZpfLwd---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/evzfftae04h5t868xhyw.jpeg)

ä¸Šå‘¨æˆ‘å¤±è´¥äº†ä¸¤æ¬¡:

*   æˆ‘åœ¨[ä¸€æ¬¡å›¾ä¹¦é¦†æ¯”è¾ƒ](https://github.com/mui-org/material-ui/issues/15450)ä¸­è¾“äº†ï¼Œåªè¦æˆ‘çš„å›¾ä¹¦é¦†æ›´å¥½ğŸ˜‰ï¼Œä½†æ¯”å¦ä¸€ä¸ªå¤§å¾—å¤šã€‚æˆ‘æ²¡èƒ½**1ã€‚**å°‘å†™ä»£ç ã€‚
*   ä¼˜åŒ–ä¸€ä¸ªå°ç½‘ç«™ï¼Œç”±æˆ‘çš„å¦»å­åœ¨ Reactã€‚å®ƒä½¿ç”¨åŸºäºè·¯ç”±çš„ç»„ä»¶åˆ†å‰²ï¼Œä½†æ˜¯`header`å’Œ`footer`è¢«ä¿ç•™åœ¨ä¸»åŒ…ä¸­ï¼Œä»¥ä½¿è½¬æ¢æ›´â€œå¯æ¥å—â€ã€‚ä»…ä»…å‡ ä»¶äº‹ï¼Œ**äº’ç›¸ç´§è€¦åˆ**æ†ç»‘ç«¯æš´æ¶¨åˆ° 320 kb(gzip ä¹‹å‰)ã€‚æ²¡æœ‰ä»€ä¹ˆé‡è¦çš„ä¸œè¥¿ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆæˆ‘çœŸçš„å¯ä»¥æ‹¿èµ°çš„ä¸œè¥¿ã€‚**åƒåˆ€ä¸‡å‰**ã€‚æˆ‘çš„**å‡ºè´§å¤±è´¥ä»£ç **ã€‚

> `React-Dom`ä¸º 20%ï¼Œ`core-js`ä¸º 10%ï¼Œ`react-router`ï¼Œ`jsLingui`ï¼Œ`react-powerplug`...20%çš„è‡ªæœ‰ä»£ç ...æˆ‘ä»¬å·²ç»åšå®Œäº†ã€‚

[![](img/32d74d5fbbd7fa8286c3b2ecda469976.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--oDpV2F7e--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vxnjfmzn6z63o9qhdlg6.png)

## è§£

æˆ‘å·²ç»å¼€å§‹æ€è€ƒå¦‚ä½•è§£å†³æˆ‘çš„é—®é¢˜ï¼Œä»¥åŠä¸ºä»€ä¹ˆ*å¸¸è§çš„è§£å†³æ–¹æ¡ˆ*å¯¹æˆ‘çš„ç”¨ä¾‹ä¸é€‚ç”¨ã€‚

> æˆ‘åšäº†ä»€ä¹ˆï¼Ÿæˆ‘å·²ç»åˆ—å‡ºäº†æ‰€æœ‰é‡è¦çš„ä½ç½®ï¼Œæ²¡æœ‰å®ƒä»¬åº”ç”¨ç¨‹åºæ ¹æœ¬æ— æ³•å·¥ä½œï¼Œå¹¶è¯•å›¾ç†è§£ä¸ºä»€ä¹ˆæˆ‘è¿˜æœ‰å…¶ä»–çš„ä½ç½®ã€‚

è¿™è®©æˆ‘å¤§åƒä¸€æƒŠâ€”â€”é—®é¢˜å‡ºåœ¨ CSS ä¸Šã€‚åœ¨æ™®é€š CSS è½¬æ¢ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†æ›´å¹³æ»‘çš„ç”¨æˆ·ç•Œé¢ï¼Œä»¥åŠæˆ‘å®ç°å®ƒçš„æ–¹å¼ã€‚é•¿è¯çŸ­è¯´â€”â€”åœ¨è½¬æ¢åŠ¨ç”»ä¹‹å‰ï¼Œåº•å±‚ DOM èŠ‚ç‚¹å¿…é¡»å­˜åœ¨ã€‚

è¿™æ˜¯ä»£ç 

*   ä¸€ä¸ª*æ§åˆ¶*å˜é‡- `componentControl`ï¼Œæœ€ç»ˆä¼šè¢«è®¾ç½®ä¸º`DisplayData`åº”è¯¥æ˜¾ç¤ºçš„ä¸œè¥¿ã€‚
*   ä¸€æ—¦è®¾å®šå€¼- `DisplayData`å˜å¾—å¯è§ï¼Œæ”¹å˜`className`ï¼Œä»è€Œè§¦å‘èŠ±å¼è¿‡æ¸¡ã€‚åŒæ—¶`FocusLock`å˜å¾—æ´»è·ƒï¼Œä½¿`DisplayData`æˆä¸º**æ¨¡æ€**ã€‚

```
<FocusLock
 enabled={componentControl.value} 
 // ^ initially it's "disabled". And when it's disabled - it's dead.
>
  {componentControl.value && <PageTitle title={componentControl.value.title}/>}
  // ^ it's does not exists. Dead-dead
  <DisplayData
    data={componentControl.value}
    visible={componentControl.value !== null}
    // ^ would change a className basing on visible state
  />
  // ^ that is just not visible, but EXISTS
</FocusLock> 
```

æˆ‘æƒ³å°†è¿™æ®µä»£ç ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæ‹†åˆ†ï¼Œä½†è¿™æ˜¯æˆ‘æ— æ³•åšåˆ°çš„ï¼ŒåŸå› æœ‰ä¸¤ä¸ª:

1.  ä¸€æ—¦éœ€è¦ï¼Œä¿¡æ¯åº”è¯¥ç«‹å³å¯è§ï¼Œæ²¡æœ‰ä»»ä½•å»¶è¿Ÿã€‚ä¸šåŠ¡éœ€æ±‚ã€‚æ‰€ä»¥æœ€å¥½ä¸è¦ç åˆ†**ä¿¡æ¯**ã€‚
2.  ä¿¡æ¯â€œéª¨æ¶â€åº”è¯¥å…ˆå­˜åœ¨ï¼Œæ‰èƒ½æ­£ç¡®å¤„ç† CSS è½¬æ¢ã€‚

è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ä½¿ç”¨ [CSSTransitionGroup](https://github.com/reactjs/react-transition-group) æˆ– [recondition](https://github.com/theKashey/recondition) æ¥éƒ¨åˆ†è§£å†³â€”â€”é¦–å…ˆåˆ›å»º hiddenï¼Œç„¶ååº”ç”¨ä¸€ä¸ª*visible*class nameâ€”â€”ä½†æ˜¯ï¼Œä½ çŸ¥é“ï¼Œä¿®å¤*ä¸€ä¸ªä»£ç *æ·»åŠ *å¦ä¸€ä¸ªä»£ç *å¬èµ·æ¥å¾ˆå¥‡æ€ªï¼Œå³ä½¿å®é™…ä¸Š*è¶³å¤Ÿäº†*ã€‚æˆ‘çš„æ„æ€æ˜¯æ·»åŠ æ›´å¤šçš„ä»£ç å¯ä»¥å¸®åŠ©åˆ é™¤æ›´å¤šçš„ä»£ç ã€‚ä½†æ˜¯...ä½†æ˜¯...

> åº”è¯¥æœ‰æ›´å¥½çš„åŠæ³•ï¼

TLï¼›åšå£«â€”â€”è¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®ç‚¹:

*   `DisplayData`å¿…é¡»è¢«**æŒ‚è½½**ï¼Œå¹¶ä¸”ä¹‹å‰å­˜åœ¨äº DOM ä¸­ã€‚
*   `FocusLock`ä¹Ÿåº”è¯¥å­˜åœ¨åœ¨å…ˆï¼Œä»¥ç‰µåˆ¶`DisplayData`ï¼Œä½†å®ƒçš„**å¤§è„‘åœ¨ä¸€å¼€å§‹å¹¶ä¸éœ€è¦**ã€‚

* * *

æ‰€ä»¥è®©æˆ‘ä»¬æ”¹å˜æˆ‘ä»¬çš„æ€ç»´æ¨¡å¼

# è™è ä¾ å’Œç½—å®¾

å‡è®¾æˆ‘ä»¬çš„ä»£ç æ˜¯è™è ä¾ å’Œç½—å®¾ã€‚è™è ä¾ å¯ä»¥å¯¹ä»˜å¤§å¤šæ•°çš„åäººï¼Œä½†æ˜¯å½“ä»–ä¸èƒ½çš„æ—¶å€™ï¼Œä»–çš„ä¼™ä¼´ç½—å®¾ä¼šæ¥æ‹¯æ•‘ä»–..

> è™è ä¾ å°†å†æ¬¡æŠ•å…¥æˆ˜æ–—ï¼Œç½—å®¾å°†ç¨ååˆ°è¾¾ã€‚

è¿™æ˜¯è™è ä¾ :

```
+<FocusLock - enabled={componentControl.value} +> -  {componentControl.value && <PageTitle title={componentControl.value.title}/>} +  <DisplayData
+    data={componentControl.value}
+    visible={componentControl.value !== null}
+  />
+</FocusLock> 
```

è¿™æ˜¯ä»–çš„ä¼™ä¼´ï¼Œç½—å®¾

```
-<FocusLock + enabled={componentControl.value} -> +  {componentControl.value && <PageTitle title={componentControl.value.title}/>} -  <DisplayData
-    data={componentControl.value}
-    visible={componentControl.value !== null}
-  />
-</FocusLock> 
```

è™è ä¾ å’Œç½—å®¾å¯ä»¥ç»„æˆä¸€ä¸ªå›¢é˜Ÿï¼Œä½†ä»–ä»¬å®é™…ä¸Šæ˜¯ä¸¤ä¸ªä¸åŒçš„äººã€‚

åˆ«å¿˜äº†â€”â€”æˆ‘ä»¬è¿˜åœ¨è®¨è®º**ä»£ç æ‹†åˆ†**ã€‚å¹¶ä¸”ï¼Œåœ¨ä»£ç åˆ†å‰²æ–¹é¢ï¼ŒåŠ©æ‰‹åœ¨å“ªé‡Œï¼Ÿç½—å®¾åœ¨å“ªé‡Œï¼Ÿ

[![Robin is in sidecar](img/27f9372e7a569ca97542d720e736bd96.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--EylBIQb0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/647ij80gvo56g2apw3tv.png)

> åœ¨è¾¹è½¦é‡Œã€‚ç½—å®¾æ­£åœ¨ä¸€è¾†**è¾¹è½¦é‡Œç­‰å¾…**ã€‚

# è¾¹è½¦

*   è¿™äº›éƒ½æ˜¯ä½ çš„é¡¾å®¢å¿…é¡»å°½å¿«çœ‹åˆ°çš„è§†è§‰ææ–™ã€‚æœ€å¥½æ˜¯ç«‹åˆ»ã€‚
*   è¿™é‡Œæ˜¯æ‰€æœ‰çš„é€»è¾‘å’Œå¥‡ç‰¹çš„äº¤äº’åŠŸèƒ½ï¼Œå®ƒä»¬å¯èƒ½åœ¨ä¸€ç§’é’Ÿåå¯ç”¨ï¼Œä½†ä¸æ˜¯åœ¨ä¸€å¼€å§‹ã€‚

æœ€å¥½ç§°ä¹‹ä¸º**å‚ç›´ä»£ç åˆ†å‰²**ï¼Œå…¶ä¸­ä»£ç åˆ†æ”¯å¹³è¡Œå­˜åœ¨ï¼Œä¸å¸¸è§çš„**æ°´å¹³ä»£ç åˆ†å‰²**ç›¸åï¼Œå…¶ä¸­ä»£ç åˆ†æ”¯è¢«*åˆ‡å‰²*ã€‚

*   åœ¨[ä¸€äº›å›½å®¶](https://github.com/respond-framework/rudy)ï¼Œè¿™ä¸‰äººç»„è¢«ç§°ä¸º`replace reducer`æˆ–å…¶ä»–æ–¹å¼æ¥å»¶è¿ŸåŠ è½½ redux é€»è¾‘å’Œå‰¯ä½œç”¨ã€‚
*   åœ¨[å…¶ä»–ä¸€äº›å›½å®¶](https://developers.facebook.com/videos/2019/building-the-new-facebookcom-with-react-graphql-and-relay/)ï¼Œå®ƒè¢«ç§°ä¸º`"3 Phased" code splitting`ã€‚

> è¿™åªæ˜¯å…³æ³¨ç‚¹çš„å¦ä¸€ç§åˆ†ç¦»ï¼Œåªé€‚ç”¨äºè¿™æ ·çš„æƒ…å†µï¼Œæ‚¨å¯ä»¥å»¶è¿ŸåŠ è½½ç»„ä»¶çš„æŸä¸ªéƒ¨åˆ†ï¼Œä½†ä¸èƒ½å»¶è¿ŸåŠ è½½å¦ä¸€ä¸ªéƒ¨åˆ†ã€‚

[![phase 3 code spliting](img/586882d845741f9f307f71a88b5151eb.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--nCax3xxB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/96yww94ggedak03dphz4.jpeg)

> å›¾ç‰‡æ¥è‡ª[ç”¨ Reactã€GraphQL å’Œ Relay](https://developers.facebook.com/videos/2019/building-the-new-facebookcom-with-react-graphql-and-relay/) å»ºé€ æ–° facebook.comï¼Œå…¶ä¸­`importForInteractions`æˆ–`importAfter`T5 æ˜¯`sidecar`T6ã€‚

è¿˜æœ‰ä¸€ä¸ª**æœ‰è¶£çš„**è§‚å¯Ÿâ€”â€”è™½ç„¶`Batman`å¯¹é¡¾å®¢æ¥è¯´æ›´æœ‰ä»·å€¼ï¼Œåªè¦æ˜¯é¡¾å®¢å¯èƒ½*çœ‹åˆ°çš„*ï¼Œä»–æ€»æ˜¯å¾ˆå¥åº·(å¹¶ä¸”æœ‰ä¸€ä¸ªç§˜å¯†çš„è…¹è‚Œ)...è€Œ`Robin`ï¼Œä½ çŸ¥é“ï¼Œä»–å¯èƒ½æœ‰ç‚¹*è¶…é‡*ï¼Œéœ€è¦æ›´å¤šçš„å­—èŠ‚æ¥ç”Ÿå­˜ã€‚

å› æ­¤ï¼Œå¯¹äºé¡¾å®¢æ¥è¯´ï¼Œè™è ä¾ æ˜¯å¯ä»¥å¿å—çš„ï¼Œä»–ä»¥æ›´ä½çš„æˆæœ¬æä¾›äº†æ›´å¤šçš„ä»·å€¼ã€‚ä½ æ˜¯æˆ‘çš„è‹±é›„è™è ï¼

## ä»€ä¹ˆä¸œè¥¿å¯ä»¥æ¬åˆ°è¾¹è½¦ä¸Š:

*   `useEffect`ã€`componentDidMount`å’Œæœ‹å‹å±…å¤šã€‚
*   åƒæ‰€æœ‰çš„*æ¨¡æ€*æ•ˆæœä¸€æ ·ã€‚å³`focus`å’Œ`scroll`é”ã€‚ä½ å¯ä»¥å…ˆå±•ç¤ºä¸€ä¸ªæ¨¡æ€ï¼Œç„¶å**å†**è®©æ¨¡æ€*æ¨¡æ€*ï¼Œå³â€œé”å®šâ€å®¢æˆ·çš„æ³¨æ„åŠ›ã€‚
*   è‡ªå®šä¹‰`Selects`â€”â€”ä»–ä»¬è‡ªç„¶åˆ†è£‚æˆè™è ä¾ (è¾“å…¥)å’Œç½—å®¾(Dropdrown)ã€‚è‡ªå®šä¹‰`Calendars`æˆ–ä»»ä½•å…¶ä»– UI ç»„ä»¶ä¸æ˜¾ç¤ºå¦ä¸€ä¸ª(æœ€å¤§å’Œæœ€å¤æ‚çš„)éƒ¨åˆ†æˆ–ç‚¹å‡»/æ‚¬åœæ˜¯ä¸€æ ·çš„ã€‚
*   è¡¨æ ¼ã€‚å°†æ‰€æœ‰é€»è¾‘å’ŒéªŒè¯è½¬ç§»åˆ°è¾¹è½¦ä¸Šï¼Œå¹¶é˜»æ­¢è¡¨å•æäº¤ï¼Œç›´åˆ°é€»è¾‘åŠ è½½å®Œæ¯•ã€‚å®¢æˆ·å¯èƒ½å¼€å§‹å¡«å†™è¡¨æ ¼ï¼Œè€Œä¸çŸ¥é“å®ƒåªæ˜¯`Batman`ã€‚
*   ä¸€äº›åŠ¨ç”»ã€‚å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€æ•´å—ã€‚
*   ä¸€äº›è§†è§‰ä¸Šçš„ä¸œè¥¿ã€‚æ¯”å¦‚[è‡ªå®šä¹‰æ»šåŠ¨æ¡](https://github.com/theKashey/React-stroller)ï¼Œå®ƒå¯èƒ½ä¼šåœ¨ä¸€ç§’é’Ÿåæ˜¾ç¤ºç²¾ç¾çš„æ»šåŠ¨æ¡ã€‚ğŸ¤·â€â™‚ï¸è®¾è®¡å¸ˆğŸ¤·â€â™‚ï¸

æ­¤å¤–ï¼Œä¸è¦å¿˜è®°â€”â€”å¸è½½åˆ° sidecar çš„æ¯ä¸€æ®µä»£ç ï¼Œä¹Ÿå¸è½½è¢«åˆ é™¤çš„ä»£ç ä½¿ç”¨çš„ core-js poly-å’Œ ponyfills ä¹‹ç±»çš„ä¸œè¥¿ã€‚

[![batman and robin](img/4d49b413b16c7c68ed98e2c1ac96b763.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Rc1jlNXq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kknd3t392m1lbxiy7hro.jpg)

ä»£ç åˆ†å‰²å¯ä»¥æ¯”æˆ‘ä»¬ä»Šå¤©çš„åº”ç”¨ç¨‹åºæ›´åŠ æ™ºèƒ½ã€‚æˆ‘ä»¬å¿…é¡»æ„è¯†åˆ°æœ‰ä¸¤ç§*ä»£ç *å¯ä»¥æ‹†åˆ†:1)è§†è§‰æ–¹é¢ 2)äº¤äº’æ–¹é¢ã€‚åè€…å¯ä»¥ç¨åå‡ºç°ã€‚`Sidecar`æ— ç¼åˆ†å‰²ä¸¤ä¸ªä»»åŠ¡ï¼Œè®©*æ„Ÿè§‰æ‰€æœ‰ä¸œè¥¿éƒ½åŠ è½½å¾—æ›´å¿«*ã€‚å®ƒä¼šçš„ã€‚

## æœ€å¤è€çš„ä»£ç æ‹†åˆ†æ–¹å¼

è™½ç„¶å¯èƒ½è¿˜ä¸å¤ªæ¸…æ¥šä»€ä¹ˆæ—¶å€™ä»€ä¹ˆæ˜¯`sidecar`,ä½†æˆ‘ä¼šç»™å‡ºä¸€ä¸ªç®€å•çš„è§£é‡Š:

> `Sidecar`æ˜¯**ä½ æ‰€æœ‰çš„å‰§æœ¬**ã€‚Sidecar æ˜¯æˆ‘ä»¬ä»Šå¤©å¾—åˆ°æ‰€æœ‰å‰ç«¯ä¸œè¥¿ä¹‹å‰*å¯¹*è¿›è¡Œä»£ç åˆ†å‰²çš„æ–¹å¼ã€‚

æˆ‘è¯´çš„æ˜¯æœåŠ¡å™¨ç«¯æ¸²æŸ“( **SSR** ï¼Œæˆ–è€…åªæ˜¯æ™®é€šçš„ **HTML** ï¼Œæˆ‘ä»¬æ˜¨å¤©éƒ½å·²ç»ä¹ æƒ¯äº†ã€‚å½“é¡µé¢åŒ…å«çš„ HTML å’Œé€»è¾‘åˆ†åˆ«ä½äºå¯åµŒå…¥çš„å¤–éƒ¨è„šæœ¬ä¸­æ—¶(å…³æ³¨ç‚¹åˆ†ç¦»)ï¼Œäº‹æƒ…ä¼šå˜å¾—åƒä»¥å‰ä¸€æ ·ç®€å•ã€‚

æˆ‘ä»¬æœ‰ HTMLï¼Œ**åŠ ä¸Š** CSSï¼Œ**åŠ ä¸Š**ä¸€äº›å†…åµŒçš„è„šæœ¬ï¼Œ**åŠ ä¸Š**å‰©ä¸‹çš„è„šæœ¬æå–åˆ°ä¸€ä¸ª`.js`æ–‡ä»¶ä¸­ã€‚

`HTML` + `CSS` + `inlined-js`æ˜¯`Batman`ï¼Œè€Œå¤–éƒ¨è„šæœ¬æ˜¯`Robin`ï¼Œè¯¥ç½‘ç«™èƒ½å¤Ÿåœ¨æ²¡æœ‰ç½—å®¾çš„æƒ…å†µä¸‹è¿è¡Œï¼Œè€å®è¯´ï¼Œéƒ¨åˆ†æ²¡æœ‰è™è ä¾ (ä»–å°†åœ¨åŒè…¿(å†…è”è„šæœ¬)éª¨æŠ˜çš„æƒ…å†µä¸‹ç»§ç»­æˆ˜æ–—)ã€‚è¿™åªæ˜¯æ˜¨å¤©çš„äº‹ï¼Œè®¸å¤šâ€œéç°ä»£å’Œé…·â€çš„ç½‘ç«™ä»Šå¤©ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

* * *

å¦‚æœä½ çš„åº”ç”¨æ”¯æŒ SSRâ€”â€”è¯•ç€**ç¦ç”¨ js** ,è®©å®ƒåœ¨æ²¡æœ‰å®ƒçš„æƒ…å†µä¸‹ä¹Ÿèƒ½å·¥ä½œã€‚è¿™æ ·å°±èƒ½æ¸…æ¥šåœ°çŸ¥é“ä»€ä¹ˆä¸œè¥¿å¯ä»¥æ¬åˆ°è¾¹è½¦é‡Œã€‚
å¦‚æœä½ çš„åº”ç”¨ç¨‹åºåªæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„ SPAâ€”â€”è¯•ç€æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœ SSR å­˜åœ¨ï¼Œå®ƒå°†å¦‚ä½•å·¥ä½œã€‚

> æ¯”å¦‚ç”¨ React å†™çš„-[theurge.com](https://theurge.com/en-au/)ï¼Œå…¨åŠŸèƒ½**æ²¡æœ‰ä»»ä½• js ä½¿èƒ½**ã€‚

æœ‰å¾ˆå¤šä¸œè¥¿ä½ å¯ä»¥å¸åˆ°ä¸€ä¸ªè¾¹è½¦ã€‚ä¾‹å¦‚:

*   è¯„è®ºã€‚æ‚¨å¯ä»¥å°†ä»£ç å‘å¸ƒåˆ°`display`æ³¨é‡Šï¼Œè€Œä¸æ˜¯`answer`ï¼Œåªè¦å®ƒå¯èƒ½éœ€è¦æ›´å¤šçš„ä»£ç (åŒ…æ‹¬ WYSIWYG ç¼–è¾‘å™¨)ï¼Œè¿™åœ¨æœ€åˆæ˜¯ä¸éœ€è¦çš„ã€‚æœ€å¥½å»¶è¿Ÿä¸€ä¸ª*è¯„è®ºæ¡†*ï¼Œæˆ–è€…ç”šè‡³åªæ˜¯å°†ä»£ç åŠ è½½éšè—åœ¨åŠ¨ç”»åé¢ï¼Œè€Œä¸æ˜¯å»¶è¿Ÿæ•´ä¸ªé¡µé¢ã€‚
*   è§†é¢‘æ’­æ”¾å™¨ã€‚è¿é€æ²¡æœ‰â€œæ§åˆ¶â€çš„â€œè§†é¢‘â€ã€‚ä¸€ç§’é’ŸååŠ è½½å®ƒä»¬ï¼Œå®¢æˆ·å¯èƒ½ä¼šå°è¯•ä¸ä¹‹äº¤äº’ã€‚
*   å›¾ç‰‡åº“ï¼Œåƒ`slick`ã€‚ç”»**ç”»**æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œä½†æ˜¯åˆ¶ä½œåŠ¨ç”»å’Œç®¡ç†èµ·æ¥å°±å›°éš¾å¤šäº†ã€‚å¾ˆæ¸…æ¥šä»€ä¹ˆå¯ä»¥è¢«ç§»åˆ°è¾¹è½¦ã€‚

> æƒ³æƒ³ä»€ä¹ˆå¯¹ä½ çš„åº”ç”¨ç¨‹åºæ˜¯å¿…è¦çš„ï¼Œä»€ä¹ˆä¸æ˜¯...

# å®ç°ç»†èŠ‚

## (DI)æ„ä»¶ä»£ç æ‹†åˆ†

æœ€ç®€å•çš„å½¢å¼`sidecar`å¾ˆå®¹æ˜“å®ç°â€”â€”åªè¦æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½ç§»åˆ°ä¸€ä¸ªå­ç»„ä»¶ä¸­ï¼Œä½ å°±å¯ä»¥ç”¨ä¸€ç§â€œæ—§â€çš„æ–¹å¼è¿›è¡Œä»£ç æ‹†åˆ†ã€‚è¿™å‡ ä¹æ˜¯æ™ºèƒ½ç»„ä»¶å’Œéæ™ºèƒ½ç»„ä»¶ä¹‹é—´çš„ä¸€ç§åˆ†ç¦»ï¼Œä½†è¿™ä¸€æ¬¡æ™ºèƒ½ç»„ä»¶å¹¶ä¸æ˜¯åŒ…å«éæ™ºèƒ½ç»„ä»¶çš„*-è€Œæ˜¯ç›¸åçš„ã€‚* 

```
const SmartComponent = React.lazy( () => import('./SmartComponent'));

class DumbComponent extends React.Component {
  render() {
    return (
      <React.Fragment>
       <SmartComponent ref={this} /> // <-- move smart one inside
       <TheActualMarkup />           // <-- the "real" stuff is here
      </React.Fragment>
  } 
} 
```

è¿™ä¹Ÿéœ€è¦å°†*åˆå§‹åŒ–*ä»£ç è½¬ç§»åˆ°ä¸€ä¸ªå“‘ä»£ç ä¸­ï¼Œä½†æ˜¯ä½ ä»ç„¶å¯ä»¥å¯¹ä»£ç ä¸­*æœ€é‡çš„*éƒ¨åˆ†è¿›è¡Œä»£ç æ‹†åˆ†ã€‚

> ä½ ç°åœ¨èƒ½çœ‹åˆ°ä¸€ä¸ª`parallel`æˆ–`vertical`ä»£ç åˆ†è£‚æ¨¡å¼å—ï¼Ÿ

## äºŒæ‰‹è½¦

ç”¨ Reactã€GraphQL å’Œ Relay å»ºé€ æ–° facebook.com[ï¼Œæˆ‘å·²ç»åœ¨è¿™é‡Œæåˆ°è¿‡ï¼Œæœ‰ä¸€ä¸ª`loadAfter`æˆ–`importForInteractivity`çš„æ¦‚å¿µï¼Œè¿™å¾ˆåƒ sidecar æ¦‚å¿µã€‚](https://developers.facebook.com/videos/2019/building-the-new-facebookcom-with-react-graphql-and-relay/)

åŒæ—¶ï¼Œæˆ‘ä¸å»ºè®®åˆ›å»ºç±»ä¼¼äº`useSidecar`çš„ä¸œè¥¿ï¼Œåªè¦ä½ å¯èƒ½æœ‰æ„å°è¯•åœ¨é‡Œé¢ä½¿ç”¨`hooks`ï¼Œä½†æ˜¯è¿™ç§å½¢å¼çš„ä»£ç åˆ†å‰²ä¼šæ‰“ç ´æŒ‚é’©çš„*è§„åˆ™ã€‚*

è¯·é€‰æ‹©æ›´å…·å£°æ˜æ€§çš„ç»„ä»¶æ–¹å¼ã€‚æ‚¨å¯èƒ½ä¼šåœ¨`SideCar`ç»„ä»¶ä¸­ä½¿ç”¨`hooks`ã€‚

```
const Controller = React.lazy( () => import('./Controller'));
const DumbComponent = () => {
 const ref = useRef();
 const state = useState();

 return (
  <>
   <Controller componentRef={ref} state={state} />
   <TheRealStuff ref={ref} state={state[0]} />
  </>
 )
} 
```

## é¢„å–

åˆ«å¿˜äº†â€”â€”ä½ å¯èƒ½ä¼šä½¿ç”¨[è£…è½½ä¼˜å…ˆçº§æç¤º](https://medium.com/webpack/link-rel-prefetch-preload-in-webpack-51a52358f84c)æ¥é¢„è½½æˆ–é¢„å–`sidecar`å¹¶ä½¿å…¶æ›´åŠ é€æ˜å’Œä¸å¯è§ã€‚

é‡è¦çš„ä¸œè¥¿â€”â€”é¢„å–è„šæœ¬å°†é€šè¿‡**ç½‘ç»œ**åŠ è½½å®ƒï¼Œä½†æ˜¯é™¤éå®ƒç¡®å®éœ€è¦ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œ(å¹¶æ¶ˆè€— CPU)ã€‚

## SSR

ä¸*æ­£å¸¸çš„*ä»£ç åˆ†è§£ä¸åŒï¼ŒSSR ä¸éœ€è¦ç‰¹æ®Šçš„åŠ¨ä½œã€‚`Sidecar`å¯èƒ½ä¸æ˜¯ SSR æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨`hydration`æ­¥éª¤ä¹‹å‰ä¸éœ€è¦ã€‚å®ƒå¯ä»¥è¢«â€œæ•…æ„â€æ¨è¿Ÿã€‚

å› æ­¤â€”â€”éšæ„ä½¿ç”¨`React.lazy`(ç†æƒ³çš„æ˜¯æ²¡æœ‰ `Suspense`çš„**ï¼Œè¿™é‡Œä½ ä¸éœ€è¦ä»»ä½•å›åˆ‡(åŠ è½½)æŒ‡ç¤ºå™¨)ï¼Œæˆ–è€…ä»»ä½•å…¶ä»–æœ‰ SSR æ”¯æŒçš„åº“ï¼Œä½†æ˜¯æœ€å¥½æ²¡æœ‰ SSR æ”¯æŒï¼Œä»¥ä¾¿åœ¨ SSR è¿‡ç¨‹ä¸­*è·³è¿‡*è¾¹è½¦å—ã€‚**

# åé›¶ä»¶

ä½†æ˜¯è¿™ä¸ªæƒ³æ³•ä¹Ÿæœ‰ä¸€äº›ä¸å¥½çš„åœ°æ–¹

## è™è ä¾ ä¸æ˜¯ä¸€ä¸ªåˆ¶ä½œåç§°

è™½ç„¶`Batman` / `Robin`å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ€ç»´æ¦‚å¿µï¼Œè€Œ`sidecar`æ˜¯æŠ€æœ¯æœ¬èº«çš„å®Œç¾åŒ¹é…â€”â€”å¯¹äº`maincar`æ²¡æœ‰â€œå¥½â€çš„åå­—ã€‚æ²¡æœ‰æ‰€è°“çš„`maincar`ï¼Œæ˜¾ç„¶`Batman`ã€`Lonely Wolf`ã€`Solitude`ã€`Driver`ã€`Solo`ä¸èƒ½ç”¨æ¥å‘½åéè¾¹è½¦é›¶ä»¶ã€‚

è„¸ä¹¦ä½¿ç”¨äº†`display`å’Œ`interactivity`ï¼Œè¿™å¯èƒ½æ˜¯æˆ‘ä»¬æ‰€æœ‰äººçš„æœ€ä½³é€‰æ‹©ã€‚

> å¦‚æœä½ æœ‰ä¸€ä¸ªå¥½åå­—ç»™æˆ‘ï¼Œè¯·åœ¨è¯„è®ºä¸­ç•™ä¸‹

## æ ‘æ‘‡æ™ƒ

è¿™æ›´å¤šçš„æ˜¯ä» T4 çš„è§’åº¦æ¥åˆ†ç¦»å…³æ³¨ç‚¹ã€‚å‡è®¾ä½ æœ‰`Batman`å’Œ`Robin`ã€‚è¿˜æœ‰`stuff.js`

```
export * from `./batman.js`
export * from `./robin.js` 
```

ç„¶åä½ å¯ä»¥å°è¯•åŸºäºç»„ä»¶çš„ä»£ç åˆ†å‰²æ¥å®ç°ä¸€ä¸ª sidecar

```
//main.js
import {batman} from './stuff.js'

const Robin = React.lazy( () => import('./sidecar.js'));

export const Component = () => (
  <>
   <Robin />  // sidecar
   <Batman /> // main content
  </> )

// and sidecar.js... that's another chunk as long as we `import` it
import {robin} from './stuff.js'
..... 
```

ç®€è€Œè¨€ä¹‹ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯ä¸èƒ½â€œå·¥ä½œâ€ã€‚

*   å¦‚æœä½ åªä½¿ç”¨æ¥è‡ª`stuff.js`çš„`batman`-æ ‘æŠ–åŠ¨å°†åªä¿ç•™å®ƒã€‚
*   å¦‚æœä½ åªä½¿ç”¨æ¥è‡ª`stuff.js`çš„`robin`-æ ‘æŠ–åŠ¨å°†åªä¿ç•™å®ƒã€‚
*   **ä½†æ˜¯**å¦‚æœä½ åŒæ—¶ä½¿ç”¨ä¸¤è€…ï¼Œå³ä½¿æ˜¯åœ¨ä¸åŒçš„å—ä¸­â€”â€”ä¸¤è€…éƒ½å°†è¢«æ†ç»‘åœ¨`stuff.js`çš„**ç¬¬ä¸€ä¸ª**äº‹ä»¶ä¸­ï¼Œå³**ä¸»æ†ç»‘åŒ…**ã€‚

> æ ‘æŠ–åŠ¨å¯¹ä»£ç åˆ†è§£ä¸å‹å¥½ã€‚æ‚¨å¿…é¡»é€šè¿‡æ–‡ä»¶æ¥åˆ†ç¦»å…³æ³¨ç‚¹ã€‚

## å–æ¶ˆå¯¼å…¥

å¦ä¸€ä»¶è¢«å¤§å®¶é—å¿˜çš„äº‹æƒ…æ˜¯ javascript çš„æˆæœ¬ã€‚åœ¨ jQuery æ—¶ä»£,`jsonp` payload åŠ è½½è„šæœ¬(ç”¨`json` payload ),è·å–æœ‰æ•ˆè½½è·ï¼Œç„¶å**ç§»é™¤**è„šæœ¬çš„æ—¶ä»£ï¼Œè¿™æ˜¯å¾ˆå¸¸è§çš„ã€‚

> å¦‚ä»Šæˆ‘ä»¬éƒ½åœ¨ç¼–å†™è„šæœ¬ï¼Œå³ä½¿ä¸å†éœ€è¦ï¼Œå®ƒä¹Ÿå°†æ°¸è¿œè¢«è¾“å…¥ã€‚

å°±åƒæˆ‘ä¹‹å‰è¯´çš„â€”â€”JS å¤ªå¤šäº†ï¼Œè¿Ÿæ—©æœ‰ä¸€å¤©ï¼Œéšç€*è¿ç»­å¯¼èˆª*ä½ ä¼šåŠ è½½æ‰€æœ‰çš„ JSã€‚æˆ‘ä»¬åº”è¯¥æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥å–æ¶ˆå¯¼å…¥ä¸å†éœ€è¦çš„å—ï¼Œæ¸…é™¤æ‰€æœ‰å†…éƒ¨ç¼“å­˜å¹¶é‡Šæ”¾å†…å­˜ï¼Œä»¥ä½¿ web æ›´åŠ å¯é ï¼Œè€Œä¸æ˜¯å› ä¸ºå†…å­˜ä¸è¶³å¼‚å¸¸è€Œå´©æºƒåº”ç”¨ç¨‹åºã€‚

å¤§æ¦‚èƒ½å¤Ÿ`un-import` (webpack [å¯ä»¥åšåˆ°](https://github.com/theKashey/wipeWebpackCache))æ˜¯æˆ‘ä»¬åº”è¯¥åšæŒä½¿ç”¨*åŸºäºç»„ä»¶çš„* API çš„åŸå› ä¹‹ä¸€ï¼Œåªè¦å®ƒèƒ½ç»™æˆ‘ä»¬å¤„ç†`unmount`çš„èƒ½åŠ›ã€‚

åˆ°ç›®å‰ä¸ºæ­¢â€”â€”ESM æ¨¡å—æ ‡å‡†æ²¡æœ‰å…³äºè¿™ç±»ä¸œè¥¿çš„å†…å®¹â€”â€”ä¹Ÿæ²¡æœ‰å…³äºç¼“å­˜æ§åˆ¶çš„å†…å®¹ï¼Œä¹Ÿæ²¡æœ‰å…³äºæ’¤é”€å¯¼å…¥æ“ä½œçš„å†…å®¹ã€‚

## åˆ›å»ºæ”¯æŒä¾§è¾¹æŸœçš„åº“

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåªæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åˆ›å»ºæ”¯æŒ`sidecar`çš„åº“:

*   å°†æ‚¨çš„ç»„ä»¶æ‹†åˆ†æˆå‡ ä¸ªéƒ¨åˆ†
*   é€šè¿‡`index`æš´éœ²ä¸€ä¸ª`main`éƒ¨åˆ†å’Œ`connected`éƒ¨åˆ†(ä¸ç ´å API)
*   é€šè¿‡å•ç‹¬çš„å…¥å£ç‚¹å…¬å¼€ä¸€ä¸ª`sidecar`ã€‚
*   åœ¨ç›®æ ‡ä»£ç ä¸­-å¯¼å…¥`main`éƒ¨åˆ†å’Œ`sidecar` -æ ‘æ‘‡åŠ¨åº”è¯¥åˆ‡å‰²ä¸€ä¸ª`connected`éƒ¨åˆ†ã€‚

è¿™ä¸€æ¬¡æ ‘æŠ–åŠ¨åº”è¯¥æ­£å¸¸å·¥ä½œï¼Œå”¯ä¸€çš„é—®é¢˜æ˜¯å¦‚ä½•å‘½å`main`éƒ¨åˆ†ã€‚

```
//main.js
export const Main = ({sidecar, ...props}) => (
  <div>
    {sidecar} 
    ....
  </div> );

// connected.js
import Main from './Component';
import Sidecar from './Sidecar';

export const Connected = props => (
  <Main
    sidecar={<Sidecar />}
    {...props}
  /> );

//index.js
export * from './Main';
export * from './Connected';

//sidecar.js
import * from './Sidecar';

// -------------------------

//your app BEFORE
import {Connected} from 'library'; //

// -------------------------

//your app AFTER, compare to `connected.js`
import {Main} from 'library';
const Sidecar = React.lazy(import( () => import('library/sidecar')));
// ^ all the difference ^

export SideConnected = props => (
  <Main
    sidecar={<Sidecar />}
    {...props}
  /> );

// ^ you will load only Main, Sidecar will arrive later. 
```

ç†è®ºä¸Šæ¥è¯´,`dynamic import`å¯ä»¥ç”¨åœ¨ node_modules å†…éƒ¨ï¼Œä½¿å¾—*ç»„è£…è¿‡ç¨‹*æ›´åŠ é€æ˜ã€‚

> åæ­£â€”â€”æ— éå°±æ˜¯`children` / `slot`çš„æ¨¡å¼ï¼Œåœ¨ React é‡Œé‚£ä¹ˆå¸¸è§ã€‚

## æœ€ç»ˆå½¢æˆ

ä¸Šé¢åˆ—å‡ºäº†æ‰€æœ‰çš„åŸåˆ™ï¼Œæœ€ç»ˆçš„`sidecar`å½¢å¼æ˜¯:

```
import {Main} from 'library';
const Sidecar = React.lazy(import(/* webpackPrefetch: true */ () => import('library/sidecar')));

export SideConnected = ({enabled, props}) => (
  <Main
    sidecar={enabled && <Sidecar />}
    {...props}
  /> ); 
```

å®ƒ**é¢„å–** sidecar å—ï¼Œå¹¶ä¸åœ¨ç»„ä»¶åˆšåˆšâ€œä½¿ç”¨â€æ—¶ä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨å®ƒä»¥â€œæ´»åŠ¨â€å½¢å¼ä½¿ç”¨æ—¶ä½¿ç”¨(å¦‚æœè¯¥å½¢å¼å­˜åœ¨)ã€‚

å¦‚æœä¸æå–â€œæ´»åŠ¨å½¢å¼â€, sidecar å°†æ”¹å–„æ¸²æŸ“æ—¶é—´ï¼Œå°†å…¶ä¸äº¤äº’æ—¶é—´åˆ†å¼€ï¼Œåªè¦â€œäº¤äº’â€ç”±`the main bundle`æœ¬èº«åŠ è½½ï¼Œç¬¬äºŒä¸ªæ—¶é—´å°±ä¼šç¨æœ‰å»¶è¿Ÿã€‚

> è¿™â€œä¸€ç‚¹â€å¯èƒ½æ˜¯ç¬¬ä¸€æ¬¡åŠ è½½ä¸»ç¨‹åºå—å’Œå‘ˆç°åº”ç”¨ç¨‹åºæ‰€éœ€çš„å…¨éƒ¨æ—¶é—´ã€‚

è®°ä½â€”â€”æå–å°çš„â€œæ±½è½¦â€,åœ¨æœ€åˆçš„æ¸²æŸ“ä¹‹åè¿›è¡Œå¯èƒ½ä¸æ˜¯æœ€å¥½çš„ä¸»æ„ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘èƒ½å¤Ÿâ€œæå–â€å‡ ä¹ 70%çš„ä»£ç ï¼Œå¤§å¤§ç¼©çŸ­äº†æ¸²æŸ“æ—¶é—´ã€‚

# æœªæ¥

`Facebook`è¯æ˜äº†è¿™ä¸ªæƒ³æ³•æ˜¯æ­£ç¡®çš„ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰çœ‹è¿‡é‚£ä¸ªè§†é¢‘â€”â€”ç°åœ¨å°±çœ‹ã€‚æˆ‘åˆšåˆšä»ä¸€ä¸ªç¨å¾®ä¸åŒçš„è§’åº¦è§£é‡Šäº†åŒæ ·çš„æƒ³æ³•(å¹¶åœ¨ F8 ä¼šè®®å‰ä¸€å‘¨å¼€å§‹å†™è¿™ç¯‡æ–‡ç« )ã€‚

ç°åœ¨å®ƒéœ€è¦å¯¹ä½ çš„ä»£ç åº“è¿›è¡Œä¸€äº›ä¿®æ”¹ã€‚å®ƒéœ€è¦æ›´æ˜ç¡®çš„å…³æ³¨ç‚¹åˆ†ç¦»æ¥å®é™…åˆ†ç¦»å®ƒä»¬ï¼Œå¹¶è®©ä»£ç ä¸æ˜¯æ°´å¹³åœ°è€Œæ˜¯å‚ç›´åœ°åˆ†ç¦»ï¼Œä¸ºæ›´å¤§çš„ç”¨æˆ·ä½“éªŒè¿é€æ›´å°‘çš„ä»£ç ã€‚

é™¤äº†ä¼ ç»Ÿçš„ SSRï¼Œè¿™å¯èƒ½æ˜¯å¤„ç†å¤§å‹ä»£ç åº“çš„å”¯ä¸€æ–¹æ³•ã€‚å½“æ‚¨æ‹¥æœ‰å¤§é‡ä»£ç æ—¶ï¼Œè¿™æ˜¯äº¤ä»˜æœ€å°‘é‡ä»£ç çš„æœ€åæœºä¼šã€‚

> å®ƒå¯ä»¥ä½¿ä¸€ä¸ªå¤§çš„åº”ç”¨ç¨‹åºå˜å¾—æ›´å°ï¼Œä¸€ä¸ªå°çš„åº”ç”¨ç¨‹åºç”šè‡³æ›´å°ã€‚

10 å¹´å‰ï¼Œåª’ä½“ç½‘ç«™åœ¨ 300 æ¯«ç§’å†…â€œå‡†å¤‡å°±ç»ªâ€ï¼Œå‡ æ¯«ç§’å*çœŸçš„*å‡†å¤‡å°±ç»ªäº†å—ï¼Ÿä»Šå¤©ï¼Œç§’ç”šè‡³è¶…è¿‡ 10 ç§’æ˜¯å¸¸è§çš„æ•°å­—ã€‚çœŸå¯æƒœã€‚

è®©æˆ‘ä»¬åœä¸‹æ¥ï¼Œæƒ³ä¸€æƒ³â€”â€”æˆ‘ä»¬æ€æ ·æ‰èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®© UX å†æ¬¡å˜å¾—ä¼Ÿå¤§...

[![should vs could](img/fc5dbdbb701b059be2c80d7c063038d0.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--zleHbamk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/j2ux5xt0hrka9wuoz3iq.jpg)

# æ•´ä½“

`sidecar`æä¾›**æ—¶é—´**å’Œ/æˆ–**ç©ºé—´**é—´éš”ã€‚ç¨åä½ å¯ä»¥`import`ä½ éœ€è¦çš„æ‰€æœ‰è„šæœ¬...ç¨åä½¿ç”¨åŠ¨æ€å¯¼å…¥ï¼Œæˆ–è€…ä½ å¯ä»¥`require`å®ƒä»¬ï¼Œå½“ä½ éœ€è¦å®ƒä»¬çš„æ—¶å€™ã€‚åœ¨ç¬¬äºŒæ¬¡ä¸­ï¼Œæ‚¨å°†ä½¿äº‹æƒ…å˜å¾—æ›´ç®€å•ï¼Œæ›´å¤šåœ°ä½¿ç”¨ synchorniosï¼Œä½†ä»ç„¶èƒ½å¤ŸèŠ‚çœä¸€äº›åˆå§‹åŒ…å¯åŠ¨æ—¶é—´ï¼Œæ¨è¿Ÿæ¨¡å—è¯„ä¼°ç¤ºä¾‹ã€‚

```
// time and space separation
const ImportSidecar = sidecar( () => import("./sidecar"));

export function ComponentCombination(props) {
  return (
    <ComponentUI
      {...props}
      sideCar={RequireSideCar}
    />
  );
}

// only time separation
const RequireSideCar = (props: any) => {
  const SideCar = require('./sidecar').default;
  return <SideCar {...props} />; };

export function ComponentCombination(props) {
  return (
    <ComponentUI
      {...props}
      sideCar={RequireSideCar}
    />
  );
} 
```

*   1.ç»„ä»¶ä»£ç åˆ†å‰²æ˜¯ä¸€ä¸ªæœ€å¼ºå¤§çš„å·¥å…·ï¼Œå®ƒè®©ä½ èƒ½å¤Ÿå®Œå…¨åˆ†å‰²æŸäº›ä¸œè¥¿ï¼Œä½†æ˜¯è¿™æ˜¯æœ‰ä»£ä»·çš„â€”â€”ä½ å¯èƒ½åœ¨ä¸€æ®µæ—¶é—´å†…é™¤äº†ä¸€ä¸ªç©ºç™½é¡µæˆ–è€…ä¸€ä¸ª T2 æ¡†æ¶ä¹‹å¤–ä»€ä¹ˆéƒ½ä¸ä¼šæ˜¾ç¤ºã€‚é‚£æ˜¯æ°´å¹³åˆ†ç¦»ã€‚
*   2.å½“ç»„ä»¶æ‹†åˆ†ä¸èµ·ä½œç”¨æ—¶ï¼Œåº“ä»£ç æ‹†åˆ†ä¼šæœ‰æ‰€å¸®åŠ©ã€‚é‚£æ˜¯æ°´å¹³åˆ†ç¦»ã€‚
*   3.ä»£ç ï¼Œå¸è½½åˆ° sidecar å°†å®Œæˆå›¾ç‰‡ï¼Œå¹¶å¯èƒ½è®©æ‚¨æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ä½†æ˜¯ä¹Ÿéœ€è¦ä¸€äº›å·¥ç¨‹ä¸Šçš„åŠªåŠ›ã€‚é‚£æ˜¯å‚ç›´åˆ†ç¦»ã€‚

**æˆ‘ä»¬æ¥èŠèŠè¿™ä¸ª**ã€‚

## åœï¼é‚£ä¹ˆä½ è¯•å›¾è§£å†³çš„é—®é¢˜å‘¢ï¼Ÿ

> [ååº”-èšç„¦-é”å®š](https://github.com/theKashey/react-focus-lock)ã€[ååº”-èšç„¦](https://github.com/theKashey/react-focus-on)å’Œ[ååº”-ç§»é™¤-æ»šåŠ¨](https://github.com/theKashey/react-remove-scroll)éƒ½å®ç°äº†è¿™ç§æ¨¡å¼ã€‚

è¿™åªæ˜¯ç¬¬ä¸€éƒ¨åˆ†ã€‚**æˆ‘ä»¬ç°åœ¨å¤„äºæœ€åé˜¶æ®µ**ï¼Œè¿˜éœ€è¦å‡ å‘¨æ—¶é—´æ¥å†™ä¸‹è¿™ä»½ææ¡ˆçš„ç¬¬äºŒéƒ¨åˆ†ã€‚åŒæ—¶...

[![](img/068ef7e2ca5d0b7b767d2d71a2ce0af1.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--b_tsuoKW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kpjsy69niqycdo17kp4u.png)