# æ¼”ç¤ºå¦‚ä½•å°† GraphQL ä¸ Node å’Œ Vue ä¸€èµ·ä½¿ç”¨

> åŸæ–‡:[https://dev . to/bnevilleoneill/demonstration-on-how-to-use-graphql-with-node-and-vue-in-bits-3im 2](https://dev.to/bnevilleoneill/demonstration-on-how-to-use-graphql-with-node-and-vue-in-bits-3im2)

[![](../Images/33f9fe48e7dc3cf02d63b47516e0aacb.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--I61x1Ftg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://storage.googleapis.com/blog-images-backup/1%2AuUXiDk5CNIwCgql8dh3pqQ.jpeg)T3ã€‘

å½“æˆ‘åœ¨ç½‘ä¸Šå†²æµªæ—¶ï¼Œæˆ‘çœ‹åˆ°äº†è¿™æ¡å¾®åšã€‚å‰ç«¯å¼€å‘äººå‘˜ä¼¼ä¹åŒå€¦äº†æ—¶ä¸æ—¶åœ°è¯·æ±‚ APIã€‚ğŸ˜„

> ![Ryan Florence profile image](../Images/12147af33d64e864028a13dd24d7f3c6.png)ç‘å®‰ä½›ç½—ä¼¦è¨[@ ryanflorence](https://dev.to/ryanflorence)![twitter logo](../Images/4c8a2313941dda016bf4d78d103264aa.png)graph QL æ²¡æœ‰åƒç«ç®­ä¸€æ ·èµ·é£çš„å”¯ä¸€åŸå› æ˜¯åç«¯å¼€å‘äººå‘˜ä¸ç†è§£ä»–ä»¬ç»™å‰ç«¯ä»£ç å¸¦æ¥çš„æ··ä¹±ï¼Œè®¤ä¸ºå‰ç«¯æ˜¯ä¸€ç§è¾ƒä½çº§çš„ç¼–ç¨‹å½¢å¼ã€‚2018 å¹´ 11 æœˆ 08 æ—¥ä¸‹åˆ 15:39[![Twitter reply action](../Images/44d8b042100e231770330321e5b63d65.png)](https://twitter.com/intent/tweet?in_reply_to=1060557386421723136)[![Twitter retweet action](../Images/93d9c70ccc54851d2e8e881b53c21dae.png)](https://twitter.com/intent/retweet?tweet_id=1060557386421723136)[![Twitter like action](../Images/2e93f7775eadefab8bcd34a4542cc5a7.png)](https://twitter.com/intent/like?tweet_id=1060557386421723136)

ç¬¬ä¸€æ¬¡å’Œ GraphQL äº’åŠ¨ï¼Œå°±çˆ±ä¸Šäº†å®ƒã€‚ä¸ºä»€ä¹ˆï¼ŸGraphQL ä¸ºæ‚¨æä¾›äº†è½»æ¾æ„å»º API çš„ç©ºé—´ï¼Œè®©æ‚¨ä¸å¿…é‡å¤åšåŒæ ·çš„äº‹æƒ…ã€‚æ€ä¹ˆä¼šï¼Ÿè®©æˆ‘ä»¬æ‰¾å‡ºç­”æ¡ˆã€‚

æˆ‘å‡è®¾æ‚¨å¯¹ä»¥ä¸‹å†…å®¹æœ‰åŸºæœ¬çš„äº†è§£:

*   java æè¿°è¯­è¨€
*   èŠ‚ç‚¹. js
*   view . js-æ£€è§†. js

æˆ‘ä»¬æ¥çœ‹çœ‹ GraphQL å’Œ REST çš„å¯¹æ¯”ã€‚

ä¸ºäº†å…¨é¢äº†è§£æœ¬æ–‡ï¼Œæˆ‘æƒ³è®©ä½ å…‹éš†è¿™ä¸ªé¡¹ç›®çš„[åº“](https://github.com/meshboy/recipe)ï¼Œå®ƒåŒ…å«æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å…³æ³¨ä»¥ä¸‹å‡ ç‚¹:

*   ä¸ºä»€ä¹ˆæ˜¯ GraphQL
*   GraphQL çš„å…³é”®ç»„ä»¶
*   è¯æ˜
*   æ–‡ä»¶ä¸Šä¼ 
*   å¸¦ Vue çš„ GraphQL

[![](../Images/2063f22e152ef36aa267c13ae9842601.png)T2ã€‘](https://logrocket.com/signup/)

#### [](#what-is-graphql)ä»€ä¹ˆæ˜¯ GraphQLï¼Ÿ

GraphQL æ˜¯ä¸€ç§æŸ¥è¯¢è¯­è¨€ï¼Œå®ƒæœ‰åŠ©äºå°†æ‰“å¼€ API å¤§é—¨çš„é’¥åŒ™äº¤ç»™è®¿é—®è€…(å®¢æˆ·)ï¼Œå½“ç„¶æ˜¯åœ¨æ‚¨å…è®¸çš„æƒ…å†µä¸‹ã€‚å—¯ï¼Œå¦‚æœç®¡ç†ä¸å½“ï¼Œä½ çš„è®¿å®¢å¯èƒ½ä¼šæŠŠäº‹æƒ…æç ¸ã€‚

æ— è®ºå¦‚ä½•ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºéƒ½å¿…é¡»ä¸å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ã€‚è¿™åªèƒ½é€šè¿‡å…¬å¼€éƒ¨åˆ†æˆ–å…¨éƒ¨ API æ¥å®ç°ã€‚å®ç°è¿™ä¸€ç‚¹çš„æ–¹æ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨ REST æ„å»ºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚åˆ°æœ¬æ–‡ç»“æŸæ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šæ˜ç™½ä¸ºä»€ä¹ˆåº”è¯¥åœ¨ä¸‹ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ GraphQLã€‚

> GraphQL æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§ç”¨ç°æœ‰æ•°æ®å®Œæˆè¿™äº›æŸ¥è¯¢çš„è¿è¡Œæ—¶è¯­è¨€ã€‚GraphQL ä¸º API ä¸­çš„æ•°æ®æä¾›äº†å®Œæ•´ä¸”æ˜“äºç†è§£çš„æè¿°ï¼Œä½¿å®¢æˆ·èƒ½å¤Ÿå‡†ç¡®åœ°è¦æ±‚ä»–ä»¬éœ€è¦çš„ä¸œè¥¿ï¼Œä½¿ API æ›´å®¹æ˜“éšæ—¶é—´å‘å±•ï¼Œå¹¶æ”¯æŒå¼ºå¤§çš„å¼€å‘å·¥å…·ã€‚

*REST Vs GraphQL*

*   GraphQL åªæœ‰ä¸€æ¡è·¯ç”±ï¼Œè€Œ REST æœ‰å¤šæ¡è·¯ç”±ã€‚éšç€å®¢æˆ·ç«¯éœ€æ±‚çš„å¢åŠ ï¼ŒREST ç«¯ç‚¹ä¹Ÿåœ¨ä¸æ–­å¢åŠ ã€‚
*   é™¤äº† REST æœ‰å¤šä¸ªç«¯ç‚¹ä¹‹å¤–ï¼Œå®ƒè¿˜é™„å¸¦äº† HTTP åŠ¨è¯(POSTã€PUTã€GET ç­‰),ä½†æ˜¯ GraphQL ä¹Ÿæ¶µç›–äº†æˆ‘ä»¬ï¼Œå› ä¸ºå®ƒä¸éœ€è¦è¿™äº›ä¸œè¥¿ã€‚
*   æ¯ä¸ª API éƒ½åº”è¯¥é™„å¸¦æ–‡æ¡£ï¼Œä½†æ˜¯ GraphQL ç»™äº†æˆ‘ä»¬ä¸€ä¸ªç°æˆçš„äº¤äº’å¼ API æ–‡æ¡£ã€‚
*   åœ¨ GraphQL ä¸­ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°å°½å¯èƒ½åœ°è§£ææ•°æ®ï¼Œä½†åœ¨ REST ä¸­å´ä¸è¡Œã€‚å®ƒè‚¯å®šä¼šæœ‰ä¸€ä¸ªæ–°çš„ç»ˆç‚¹ã€‚
*   GraphQL ä¸ä¼šè®©æ‚¨æ‹…å¿ƒå¦‚ä½•å¯¹ API è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå› ä¸ºå•ä¸€è·¯å¾„ä¸ä¼šæ”¹å˜ï¼Œä½†æ˜¯æ‚¨éœ€è¦å…³å¿ƒçš„æ˜¯ï¼Œå½“æ›´æ–°ä¸æ–­å‡ºç°æ—¶ï¼Œæ‚¨åº”è¯¥å¦‚ä½•åœ¨ä½¿ç”¨ REST çš„åŒæ—¶å¯¹ API è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚

è¯´æ•™åˆ°æ­¤ä¸ºæ­¢ï¼

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…¸å‹çš„ GraphQL æ–‡æ¡£ã€‚éšæ„å¤åˆ¶å¹¶ç²˜è´´[ç‰‡æ®µ](https://www.apollographql.com/docs/apollo-server/getting-started.html)ï¼Œåœ¨æ‚¨çš„æœºå™¨ä¸Šæ„Ÿå—ä¸€ä¸‹ã€‚

[![](../Images/866a7088f044bb531fc9e75867256f48.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--roSD4tCu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/fzktdqdyy8jfkdp0rlt0.gif)

åœ¨è¿™ä¸ªé¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å’Œ Apollo ä¸€èµ·æ¢ç´¢ GraphQLã€‚Apollo åŒæ—¶æ”¯æŒ NodeJs å’Œ VueJsã€‚ğŸ˜ƒ

è®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬é¡¹ç›®çš„æ¼”ç¤ºæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œè¿™åº”è¯¥ä¼šç»™ä½ ä¸€ä¸ªæœªæ¥çš„æƒ³æ³•ã€‚ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸‹ã€‚

[![](../Images/12322d94c247cabc4393a7258c7d3737.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--rY_AgSqB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ocziuc4ir2mhgt8y44uc.gif)

#### graph QL çš„å…³é”®ç»„ä»¶

æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨å››ä¸ªä¸»è¦éƒ¨åˆ†:

*   ç±»å‹
*   é—®é¢˜
*   å˜åŒ–
*   ä¸‹å†³å¿ƒè€…

**1ã€‚ç±»å‹:**åœ¨æ•°æ®åº“çº§åˆ«ä¸Šï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªæ¨¡å‹éƒ½æä¾›äº†ä¸€ä¸ªæ¨¡å¼ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åªæœ‰ä¸¤ä¸ªæ¨¡å‹(é…æ–¹å’Œç”¨æˆ·)ã€‚

```
const recipeSchema = new mongoose.Schema({
    name: {
        type: String,
    },
    description: {
        type: String,
    },
    difficultyLevel: {
        type: Number,
    },
    fileUrl: {
        type: String
    },
    steps: [{
        type: String
    }],
    averageTimeForCompletion: {
        type: Number,
    },
userId: {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'User'
    }
}, { timestamps: true });
export const Recipe = mongoose.model('Recipe', recipeSchema); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*æ•°æ®åº“çº§æ¨¡å¼*

æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ª API çº§åˆ«çš„æ¨¡å¼ï¼Œå®ƒå°†ç¬¦åˆä¸Šé¢çš„æ•°æ®åº“æ¨¡å¼ã€‚è¿™ä¸ªæ¨¡å¼ä¹Ÿåƒæ•°æ®åº“æ¨¡å¼ä¸Šçš„éªŒè¯å™¨ä¸€æ ·ã€‚å…·æœ‰ GraphQL æ— æ³•è¯†åˆ«çš„ç±»å‹çš„æŸ¥è¯¢å°†è¢«é€€å›ã€‚

```
type Recipe {
  id: ID!
  name: String!
  description: String!
  difficultyLevel: Int!
  image: String!
  steps: [String]!
  averageTimeForCompletion: Int!
  user: User!
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*API çº§æ¨¡å¼*

åœ¨ç¼–å†™æ¨¡å¼æ—¶ï¼ŒGraphQL æ”¯æŒä¸åŒçš„å¯¹è±¡ç±»å‹:Intã€Floatã€Stringã€Booleanã€IDï¼Œå°±åƒ MongoDB ä¸­çš„ _id ä¸€æ ·ã€‚å®ƒè¿˜æ”¯æŒ Listï¼Œä»¥é˜²æ‚¨çš„æ•°æ®åº“æ¨¡å¼æœ‰ä¸€ä¸ªå¯¹è±¡åˆ—è¡¨å’Œæ›´å¤šçš„å¯¹è±¡ã€‚

ï¼sign ç¡®ä¿å¯¹è±¡ä¸è¿”å›ç©ºå€¼ã€‚å½“ä½ å†æ¬¡ç¡®å®šæ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨å®ƒï¼Œä¸€ä¸ªå€¼å°†è¢«è¿”å›ã€‚å¦‚æœå®ƒä¼¼ä¹å·²è¢«ä½¿ç”¨å¹¶ä¸”å€¼ä¸º nullï¼Œå°†ä¼šå¼•å‘ä¸€ä¸ªé”™è¯¯ã€‚åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬ä¸å¸Œæœ› id ç±»å‹çš„ ID ä¸º nullã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‹¥æœ‰è‡ªå·±çš„è‡ªå®šä¹‰ç±»å‹ï¼Œå°±åƒæˆ‘ä»¬æ‹¥æœ‰æ–‡ä»¶ç±»å‹ä¸€æ ·ã€‚

```
type File {
    id: ID!
    url: String!
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**2ã€‚æŸ¥è¯¢:**åœ¨ REST ä¸­ï¼Œè·å–æ•°æ®çš„æ ‡å‡†æ–¹å¼æ˜¯ä½¿ç”¨ GETã€‚åŒæ ·çš„æ¦‚å¿µä¹Ÿé€‚ç”¨äº GraphQL æŸ¥è¯¢ã€‚æˆ‘ä»¬åœ¨éœ€è¦è·å–æ•°æ®çš„åœ°æ–¹ä½¿ç”¨æŸ¥è¯¢ã€‚æŸ¥è¯¢åœ¨ GraphQL ä¸­åªèƒ½å®šä¹‰ä¸€æ¬¡ã€‚

ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œæ¯ä¸ª GraphQL ç»„ä»¶åœ¨é¡¹ç›®ä¸­éƒ½æœ‰è‡ªå·±çš„æ–‡ä»¶ã€‚åœ¨ recipe é¡¹ç›®ä¸­ï¼Œå…³é”®å­— Query è¢«å¤šæ¬¡ä½¿ç”¨ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ç¼–å†™æŸ¥è¯¢æ¥è·å–ä¼šè¯ä¸­ç”¨æˆ·çš„å±æ€§ã€‚

```
type User {
    id: ID!
    email: String!
    name: String!
    token: String
    createdAt: String!
    updatedAt: String!
}
type Query {
    getMe: User!
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*æŸ¥è¯¢ç”¨æˆ·*

å› ä¸ºæˆ‘ä»¬å·²ç»åœ¨ç”¨æˆ·èµ„æºä¸­å£°æ˜äº†æŸ¥è¯¢ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¿…é¡»åœ¨é…æ–¹èµ„æºä¸­å£°æ˜æŸ¥è¯¢ã€‚ä½ åº”è¯¥çŸ¥é“å®ƒä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚å¥½å§ï¼Œæˆ‘ä»¬éƒ½å‡†å¤‡å¥½äº†ã€‚å¯¹äºå¤šæ¬¡ä½¿ç”¨çš„å…³é”®å­—æŸ¥è¯¢ï¼Œéœ€è¦ä½¿ç”¨å…³é”®å­— extend å¯¹å…¶è¿›è¡Œæ‰©å±•ã€‚

ä¸ºäº†è·å–ç”¨æˆ·é£Ÿè°±ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸è¯¥é£Ÿè°±ç›¸å…³è”çš„ç”¨æˆ· IDã€‚GraphQL æŸ¥è¯¢ä¹Ÿå¯ä»¥æ¥å—å‚æ•°ã€‚

```
extend type Query {
    Recipe(id: ID!): Recipe!
    Recipes: [Recipe]!
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*é…æ–¹*

ä¸Šé¢æœ‰ä¸¤ä¸ªä¸åŒçš„æŸ¥è¯¢ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°ä½¿ç”¨ id ç±»å‹çš„å‚æ•° ID è·å–ä¸€ä¸ªé…æ–¹ï¼Œè¯¥å‚æ•° ID ä¸èƒ½ä¸º nullï¼Œè€Œåè€…è¿”å›ç³»ç»Ÿä¸­çš„æ‰€æœ‰é…æ–¹ã€‚

**3ã€‚çªå˜:**ä¸€ä¸ª API ä¸ä»…ä»…æ˜¯è·å–ï¼Œåœ¨æŸäº›æ—¶å€™ï¼Œæ•°æ®å¿…é¡»è¢«å­˜å‚¨ã€æ›´æ–°æˆ–åˆ é™¤ä»¥ä¿æŒæˆ‘ä»¬å¹³å°çš„æ´»åŠ›ã€‚è¦æ‰§è¡Œè¿™ä¸ªæ“ä½œ(POSTã€PUTã€DELETE ç­‰)ï¼Œæœ€å¥½åœ¨ mutation ä¸‹å£°æ˜å®ƒã€‚

```
type Mutation {
    createUser(email: String!, name: String!, password: String)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*åˆ›å»ºä¸€ä¸ªç”¨æˆ·(çªå˜)*

createUser å˜å¼‚æœ¬å¯ä»¥å†™å¾—æ›´å¥½ï¼Œä½†æˆ‘æ›´å–œæ¬¢ä½¿ç”¨å˜é‡å£°æ˜é£æ ¼ã€‚æ˜¯çš„ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ºä½ çš„çªå˜å£°æ˜ä¸€ä¸ªå˜é‡ã€‚

å¦‚æœæ‚¨éœ€è¦å®¢æˆ·æœºåœ¨å‘é€å“åº”ä¹‹å‰æä¾›è¾“å…¥ï¼Œå˜é‡å°†ä¼šæ´¾ä¸Šç”¨åœºã€‚

```
type Mutation {
  createUser(input: NewUser!): User!
  loginUser(input: LoginUser!): User!
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*ç”¨æˆ·ç™»å½•å’Œæ³¨å†Œ*

å˜é‡å¯ä»¥æœ‰ä»»ä½•å½¢å¼ã€‚åªè¦é€šè¿‡åˆ›å»ºæˆ–å£°æ˜æ‚¨çš„å˜é‡ç±»å‹æ¥é€šçŸ¥ GraphQLï¼Œå°±ä¸ä¼šæœ‰è­¦æŠ¥ã€‚ğŸ˜‰

åœ¨ä¸Šé¢çš„å˜å¼‚ä¸­ï¼Œæˆ‘ä»¬æœ‰ loginUser å’Œ createUserï¼Œå®ƒä»¬æ¥å—å¿…é¡»è¿”å› User ç±»å‹çš„ NewUser ç±»å‹çš„è¾“å…¥å’Œä¹Ÿè¿”å› User çš„ LoginUser ç±»å‹çš„è¾“å…¥ã€‚æˆ‘ä»¬å·²ç»åœ¨ä¸Šé¢çœ‹åˆ°äº†ç”¨æˆ·çš„æ ·å­ã€‚

> è¾“å…¥æ˜¯å˜é‡çš„ä¸€ç§å½¢å¼ï¼Œä¸ºå…·æœ‰å£°æ˜ç±»å‹çš„å‚æ•°æä¾›æœåŠ¡ã€‚

```
input LoginUser {
  email: String!
  password: String!
}
input NewUser {
  email: String!
  name: String!
  password: String!
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç™»å½•å’Œæ³¨å†Œç±»å‹

```
type Recipe {
  id: ID!
  name: String!
  description: String!
  difficultyLevel: Int!
  image: String
  steps: [String]!
  averageTimeForCompletion: Int!
  user: User!
}
input NewRecipe {
  name: String!
  description: String!
  difficultyLevel: Int!
  image: Upload
  steps: [String]! 
  averageTimeForCompletion: Int!
}
input UpdateRecipe {
  id: ID!
  name: String
  description: String
  difficultyLevel: Int!
  image: String
  steps: [String]
  averageTimeForCompletion: Int!
}
input DeleteRecipe {
    id: ID!
}
# query is use when you want to get anything from 
#the server just like (GET) using REST
extend type Query {
    Recipe(id: ID!): Recipe!
    Recipes: [Recipe]!
}
# performing actions (that requires DELETE, PUT, POST) 
#just as in REST requires a mutation 
extend type Mutation {
    deleteRecipe(input: DeleteRecipe!): Recipe!
    updateRecipe(input: UpdateRecipe!): Recipe!
    newRecipe(input: NewRecipe!): Recipe!
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*é…æ–¹æ¨¡å¼*

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œç”¨æˆ·å¯ä»¥å†³å®šåˆ é™¤ä¸€ä¸ªé…æ–¹ï¼Œæ›´æ–°ä¸€ä¸ªé…æ–¹ï¼Œå¹¶æ ¹æ®æˆ‘ä»¬åœ¨ Mutation ä¸­çš„å£°æ˜åˆ›å»ºä¸€ä¸ªæ–°é…æ–¹ã€‚

æœ‰æ²¡æœ‰æ³¨æ„åˆ°ä¸€ä¸ªæ²¡æœ‰å£°æ˜ä½†æ˜¯ä½¿ç”¨äº† Upload çš„ç±»å‹ï¼Ÿä½†æ˜¯ GraphQL ä¼¼ä¹å¯¹æ­¤å¹¶ä¸ä»‹æ„ã€‚æˆ‘ä»¬å°†åœ¨æ–‡ä»¶éƒ¨åˆ†è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚

**4ã€‚** **è§£æå™¨:**æ—¢ç„¶æˆ‘ä»¬å·²ç»å£°æ˜äº†ç±»å‹ã€çªå˜å’ŒæŸ¥è¯¢ã€‚è¿™ä¸å®¢æˆ·å¯¹æˆ‘ä»¬æ•°æ®åº“çš„è¦æ±‚æœ‰ä»€ä¹ˆè”ç³»ï¼Ÿ

è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæµç¨‹â€¦

<figure>[![](../Images/54eac88e36fb40823e289ebe92026418.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--kWO0eJoP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/741/1%2Aa6F8kPNU5PT6NPH8zEyq3g.png)

<figcaption>graph QL å¦‚ä½•å¤„ç†æ•°æ®çš„æ¦‚è¿°</figcaption>

</figure>

æ‰€ä»¥åœ¨ GraphQL ä¸­ï¼Œæˆ‘ä»¬æœ‰æ ‡é‡ç±»å‹(å­—ç¬¦ä¸²ã€æ•´æ•°ã€å¸ƒå°”ã€æµ®ç‚¹ã€æšä¸¾)ã€‚å¦‚æœæˆ‘ä»¬è¶³å¤Ÿå¹¸è¿åœ°å°†æˆ‘ä»¬çš„æ•°æ®åº“å¯¹è±¡ä¸æˆ‘ä»¬æ‹¥æœ‰çš„ç±»å‹ç›¸åŒ¹é…ï¼ŒGraphQL å°†ä¸ºæˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

è®©æˆ‘ä»¬æ¥å¤„ç†æˆ‘ä»¬åœ¨çªå˜ä¸­å£°æ˜çš„åŠ¨ä½œã€‚è®°ä½æˆ‘ä»¬åœ¨çªå˜ä¸­å£°æ˜çš„å‚æ•°æ˜¯è¾“å…¥ã€‚æ— è®ºæˆ‘ä»¬æœŸæœ›ä»å®¢æˆ·é‚£é‡Œå¾—åˆ°ä»€ä¹ˆï¼Œéƒ½å¯ä»¥åœ¨å˜é‡è¾“å…¥ä¸­æ‰¾åˆ°ã€‚

```
import { User } from './user.model'; 
import { Recipe } from '../recipe/recipe.model'; 
import { signIn, verify } from '../../modules/auth';''
const loginUser = async(root, { input }) => {
    const { email, password } = input;
    const user = await User.findOne({ email }).exec();
    const errorMsg = 'Wrong credentials. Please try again';
    if(!user) {
        throw new Error (errorMsg);
    }
    if(user.comparePassword(password)) {
        user.token = signIn({ id: user._id, email: user.email });
        return user;
    }
    else{
        throw new Error (errorMsg);
    }
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*ç™»å½•ç”¨æˆ·*

è®©æˆ‘ä»¬èŠ±ç‚¹æ—¶é—´æ¥çœ‹çœ‹æŸ¥è¯¢å’Œçªå˜çš„å‚æ•°ã€‚ä»¥ loginUser ä¸ºä¾‹ã€‚

æ¯ä¸ªè§£æå™¨ä¸­æœ‰å››ä¸ªä¸»è¦å‚æ•°(æ ¹å€¼ã€å‚æ•°ã€ä¸Šä¸‹æ–‡å’Œä¿¡æ¯)ã€‚

*   rootValue:ä¸»è¦ç”¨äºå¤„ç†åµŒå¥—è§£æå™¨(ä¸»åˆ†æ”¯çš„å­åˆ†æ”¯)ã€‚

```
type User {
    id: ID!
    email: String!
    name: String!
    token: String
    recipes: [Recipe]!
    createdAt: String!
    updatedAt: String!
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*ç”¨æˆ·ç±»å‹*

çœ‹ä¸Šé¢çš„ç±»å‹ï¼Œåœ¨æˆ‘ä»¬çš„æ•°æ®åº“æ¨¡å‹ä¸­æœ‰ä¸€ä¸ªæˆ‘ä»¬æ²¡æœ‰å£°æ˜çš„å¯¹è±¡ã€‚è¿™æ„å‘³ç€ GraphQL æœŸæœ›æˆ‘ä»¬è§£å†³(å¤„ç†å®ƒå¹¶èµ‹å€¼)ã€‚

é…æ–¹å°†è¢«è§†ä¸ºåµŒå¥—è§£æå™¨ã€‚åˆ†æ”¯ä¸Šé¢çš„ rootValue å°±æ˜¯ç”¨æˆ·ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥è·å–ç”¨æˆ·åˆ›å»ºçš„é£Ÿè°±ã€‚

```
User: {
        recipes(user) {
           return Recipe.find({ userId: user.id }).exec()
        }
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*åµŒå¥—è§£æå™¨*

*   arguments:å®ƒä¿å­˜ä»å®¢æˆ·ç«¯ä¼ é€’çš„å‚æ•°ã€‚åœ¨æˆ‘ä»¬å®šä¹‰çš„çªå˜ä¸­ï¼Œæˆ‘ä»¬æœŸæœ›å®¢æˆ·ç«¯ä¼ å…¥ä¸€ä¸ªè¾“å…¥
*   ä¸Šä¸‹æ–‡:å®ƒåŒ…å«éœ€è¦åœ¨è§£æå™¨ä¹‹é—´å…±äº«çš„ä»»ä½•æ•°æ®ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†ç»è¿‡éªŒè¯çš„ç”¨æˆ·ä¼ é€’ç»™ä¸Šä¸‹æ–‡
*   ä¿¡æ¯:è¿™æ˜¯æˆ‘ä»¬å¯èƒ½æ°¸è¿œä¸ä¼šä½¿ç”¨çš„å”¯ä¸€å‚æ•°ã€‚è¿™æ˜¯åŸå§‹çš„ GraphQL æŸ¥è¯¢

å¯¹äº loginUserï¼Œç”¨æˆ·ä¼ é€’ä»å‚æ•°å¯¹è±¡ææ„çš„ç”µå­é‚®ä»¶å’Œå¯†ç ï¼Œå¹¶è¿”å›ä¸€ä¸ªç”¨æˆ·ï¼Œå°±åƒæˆ‘ä»¬åœ¨å˜å¼‚ä¸­å£°æ˜çš„é‚£æ ·(Userï¼)å¦‚æœå‡­è¯æ˜¯æ­£ç¡®çš„ï¼Œå¦åˆ™æˆ‘ä»¬æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚

æˆ‘ä»¬åœ¨çªå˜ç±»å‹(`server/api/resources/user/user.graphql file`)ä¸­çš„å£°æ˜ä¹Ÿå¿…é¡»ä¸ä¼ é€’ç»™è§£æå™¨çš„å£°æ˜ç›¸åŒã€‚

```
export const userResolvers = {
    Query: {
        getMe
    },
    Mutation: {
        createUser, //createUser: createUser
        loginUser //loginUser: loginUser
    },
    User: {
        recipes(user) {
           return Recipe.find({ userId: user.id }).exec()
        }
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*ç”¨æˆ·è§£æå™¨*

#### [](#authentication)è®¤è¯

æœ‰å‡ ç§æ–¹æ³•å¯ä»¥éªŒè¯æˆ‘ä»¬çš„ GraphQL åº”ç”¨ç¨‹åºï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬æƒ³è¦å…¬å¼€æŸ¥è¯¢æˆ–å˜å¼‚æ“ä½œæ—¶(loginUser å’Œ createUser)ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹å…¬å…±è·¯ç”±ä½¿ç”¨ REST å’Œå•ç‹¬ä¿æŠ¤å•ä¸€ GraphQL è·¯ç”±æ¥ä¿æŠ¤å®ƒã€‚å°±ä¸ªäººè€Œè¨€ï¼Œæˆ‘æ€»æ˜¯é€‰æ‹©è¿™ä¸ªé€‰é¡¹ï¼Œå› ä¸ºå®ƒä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›äº†çµæ´»æ€§ã€‚

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åœ¨è§£æå™¨çº§åˆ«è®¤è¯äº† GraphQLã€‚å½“ç”¨æˆ·æˆåŠŸç™»å½•æ—¶ï¼Œä½¿ç”¨ jwebtokens ç”Ÿæˆçš„ä»¤ç‰Œè¢«è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶è¢«ä¼ é€’ç»™å¤´éƒ¨ã€‚

```
import { verify } from './api/modules/auth';
const setMiddleware = (app) => {
    app.use(async (req, res, next) => {
        try{
            const token = req.headers.authorization || '';
            const user = await verify(token);
            req.user = user;
        }
        catch(e) {
            console.log(e)
            req.user = null;
        }
        next();
    });
};
export default setMiddleware; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#middleware)ä¸­é—´ä»¶

ä¸­é—´ä»¶äº¤å‰æ£€æŸ¥æ¯ä¸ªè¯·æ±‚ä¸­çš„æŠ¥å¤´ï¼Œè·å–ä»¤ç‰Œï¼ŒéªŒè¯å¹¶åœ¨æˆåŠŸçš„æƒ…å†µä¸‹ç»™å‡ºé€‚å½“çš„æœ‰æ•ˆè½½è·(ç”¨æˆ·)ã€‚ä¸­é—´ä»¶ç„¶åè¢«ä¼ é€’åˆ° Apollo æœåŠ¡å™¨ã€‚

å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ expressï¼Œapollo-server-express æ˜¯æˆ‘ä»¬æœ€å¥½çš„å·¥å…·ã€‚

```
setMiddleware(app);
const path = '/recipe'
graphQLRouter.applyMiddleware({ app, path});
const secret = process.env.TOKEN_SECRET;
const expiresIn = process.env.EXPIRES_IN || '1 day';
export const signIn = payload => jsonwebtoken.sign(payload, secret, { expiresIn });
export const verify = token => {
    return new Promise((resolve, reject) => {
        jsonwebtoken.verify(token, secret, {}, (err, payload) => {
            if(err){
                return reject(err);
            }
            return resolve(payload);
        })
    })
}
export const throwErrorIfUserNotAuthenticated = user => 
        {if(!user) throw new Error('hey!. You are not authenticated')} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*è®¤è¯*

è¿™æ˜¯å…³é”®ï¼Œæ¯ä¸ªçƒå‘˜éƒ½èµ°åˆ°äº†ä¸€èµ·ã€‚GraphQL æ ‡ç­¾(gql)ä½¿å¾—ç¼–å†™å’Œç»„åˆæ¨¡å¼å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

```
import { ApolloServer, gql } from 'apollo-server-express';
import merge from 'lodash.merge'
import { userType, userResolvers } from './resources/user';
import { recipeType, recipeResolvers } from './resources/recipe';
import { fileType } from './resources/file';
const typeDefs = gql`${userType}${recipeType}${fileType}`;
export const graphQLRouter = new ApolloServer(
    {
        typeDefs,
        resolvers: merge({}, userResolvers, recipeResolvers),
        context: ({req, res})=> ({ user: req.user })
    }
); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯¹äºæ¯ä¸ªè§£æå™¨ï¼Œæˆ‘ä»¬æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºç©ºï¼Œä¸€æ—¦ä¸ºç©ºï¼Œå®¢æˆ·ç«¯å°±è¢«é€€å›ã€‚ç³»ç»Ÿå‘Šè¯‰å®¢æˆ·ç«¯å¯¹è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚

```
const getRecipe = (root, { id }, { user }) => {
    throwErrorIfUserNotAuthenticated(user); 
    return Recipe.findById(id).exec();
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®æ­¤è§£æç¨‹åºã€‚

#### [](#file-upload)æ–‡ä»¶ä¸Šä¼ 

é™¤äº†å‘é€ç®€å•çš„æ•°æ®ï¼Œæˆ‘ä»¬è¿˜ä¼šä»¥æŸç§æ–¹å¼ä¸Šä¼ æ–‡ä»¶ã€‚Apollo server 2.0 ~é€šè¿‡å¼€ç®±å³ç”¨å¤„ç†æ–‡ä»¶ï¼Œè®©ç”Ÿæ´»å˜å¾—æ›´åŠ è½»æ¾ã€‚GraphQL è¯†åˆ«ä¸Šä¼ æ ‡é‡ã€‚å®ƒå¸®åŠ©å¤„ç†ä¸€ä¸ªå¯å˜æ–‡ä»¶å¯¹è±¡ã€‚å®ƒè¢«æ·»åŠ åˆ° NewRecipe è¾“å…¥ä¸­ï¼Œä»¥å¤„ç†è¯·æ±‚é™„å¸¦çš„æ–‡ä»¶ã€‚

```
const createRecipe = async (root, { input }, { user }) => {
  throwErrorIfUserNotAuthenticated(user);
  //    bring out the image from input for file processing
  const { image, ...recipeObject } = await input;
  let url = "";
  if (image) {
    const result = await uploadFile(image);
    url = result.url;
  }
  const recipe = await Recipe.findOne({ name: input.name.toLowerCase() });
  if (recipe) {
    throw new Error("Recipe already exists!");
  }
  Object.assign(recipeObject, { image: url, userId: user.id });
  return Recipe.create(recipeObject);
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*åˆ›å»ºæ–°é…æ–¹*

æ–‡ä»¶æµæ­£åœ¨è¢«å¤„ç†ï¼Œå®Œæˆåï¼ŒURL å°†ä¸ rest è¾“å…¥å¯¹è±¡ä¸€èµ·ä¿å­˜ã€‚

```
import cloudinary from "cloudinary";
import streamToBuffer from "stream-to-buffer";
cloudinary.config({
  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
  api_key: process.env.CLOUDINARY_API_KEY,
  api_secret: process.env.CLOUDINARY_API_SECRET
});
export const uploadFile = async file => {
  const { mimetype, stream } = await file;
  // process image
  return new Promise((resolve, reject) => {
    if (!Object.is(mimetype, "image/jpeg")) {
      throw new Error("File type not supported");
    }
    streamToBuffer(stream, (err, buffer) => {
      cloudinary.v2.uploader
        .upload_stream({ resource_type: "raw" }, (err, result) => {
          if (err) {
            throw new Error("File not uploaded!");
          }
          return resolve({ url: result.url });
        })
        .end(buffer);
    });
  });
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬çœ‹çœ‹åŒ»ç”Ÿã€‚å¦‚æœæ‚¨çš„ç«¯å£å·æ˜¯ 3000 å¹¶ä¸”æ‚¨çš„ MongoDB åœ¨æœ¬åœ°è¿è¡Œï¼Œé‚£ä¹ˆå¯ä»¥åœ¨[http://localhost:3000/recipe](http://localhost:3000/recipe)ä¸Šè®¿é—®å®ƒã€‚ä¸€æ—¦ä½ èƒ½ä¸æ–‡æ¡£å¾ˆå¥½åœ°äº’åŠ¨ï¼Œå®¢æˆ·ç«¯å°±å˜å¾—éå¸¸å®¹æ˜“ã€‚

#### [](#over-to-the-client)ç§»äº¤ç»™å®¢æˆ·ç«¯

å¦‚æœä½ ç†Ÿæ‚‰ä» Vue å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œä½¿ç”¨ vue-apollo æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚ä½ æ‰€éœ€è¦åšçš„å°±æ˜¯å†™å‡ºä½ çš„é—®é¢˜ã€‚Vue-apollo ä¸ºæ‚¨å¤„ç†å…¶ä½™çš„äº‹æƒ…ã€‚

é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬è®¾ç½®æˆ‘ä»¬çš„ Vue-apollo:

```
import Vue from 'vue';
import VueApollo from "vue-apollo";
import apolloUploadClient from "apollo-upload-client"
import { InMemoryCache } from "apollo-cache-inmemory";
import { ApolloClient } from "apollo-client";
import { setContext } from "apollo-link-context";
Vue.use(VueApollo);
const baseUrl = "http://localhost:3000/recipe";
const uploadClientLink = apolloUploadClient.createUploadLink({
  uri: baseUrl
});
const interceptor = setContext((request, previousContext) => {
  const token = localStorage.getItem("token");
  if(token) {
    return {
        headers: {
          authorization: token
        }
      };
  }
});
const apolloClient = new ApolloClient({
  link: interceptor.concat(uploadClientLink),
  cache: new InMemoryCache(),
  connectToDevTools: true
});
const instance = new VueApollo({
  defaultClient: apolloClient
});
export default instance;
view raw 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

apollo-link-context ä¸­çš„ setContext å…è®¸æˆ‘ä»¬åœ¨è¯·æ±‚ä¼ é€’åˆ°æœåŠ¡å™¨ä¹‹å‰æ‹¦æˆªå®ƒã€‚è®°ä½ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªä»¤ç‰Œä¼ é€’ç»™å¤´éƒ¨ï¼Œä»¥ä¾¿è®¿é—®ç»è¿‡èº«ä»½éªŒè¯çš„èµ„æºã€‚

æ¯ä¸ªå“åº”éƒ½è¢«ç¼“å­˜ã€‚cache: new InMemoryCache()ï¼Œä»ä¸Šé¢çš„æ¼”ç¤ºä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“ä¸€ä¸ªæ–°çš„èœè°±è¢«åˆ›å»ºæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒå’Œå…¶ä»–èœè°±ä¸€èµ·åæ˜ åœ¨æ‰€æœ‰èœè°±é¡µé¢ä¸­ã€‚ä½†æ˜¯å“åº”å·²ç»è¢«ç¼“å­˜äº†ã€‚å®ƒè¿”å›ä»å†…å­˜ä¸­è·å–çš„å“åº”ã€‚è¿™æœ‰åˆ©æœ‰å¼Šã€‚

è¿™ä¸ªã€‚$apollo ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¿é—® Vue apolloï¼Œåªè¦å®ƒå·²è¢«æ·»åŠ (Vue.use(VueApollo))åˆ° Vueã€‚

è®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„æŸ¥è¯¢:

```
import gql from "graphql-tag";
// user object pointing to loginUser to make the return response pretty
export const LOGIN_QUERY = gql`
  mutation LoginUser($input: LoginUser!) {
    user: loginUser(input: $input) {
      token
    }
  }
`;
export const REGISTERATION_QUERY = gql`
  mutation RegisterUser($input: NewUser!) {
    user: createUser(input: $input) {
      token
    }
  }
`;
export const ALL_RECIPES_QUERY = gql`
  query {
    recipeList: Recipes {
      id
      name
      image
    }
  }
`;
export const GET_USER_QUERY = gql`
  query {
    user: getMe {
      name
      email
      recipes {
        id
        name
        image
      }
    }
  }
`;
export const CREATE_RECIPE_QUERY = gql`
  mutation createRecipe($input: NewRecipe!) {
    newRecipe(input: $input) {
      id
    }
  }
`; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œçš„æŸ¥è¯¢ç»“æ„æ˜¯æˆ‘ä»¬åœ¨æœåŠ¡å™¨ç«¯æ‰€æœŸæœ›çš„ï¼ŒæŸ¥è¯¢çš„å“åº”æ˜¯åŸºäºé€‰æ‹©çš„ã€‚

`GET_USER_QUERY`è·å–ä¼šè¯ä¸­ç”¨æˆ·çš„å§“åã€ç”µå­é‚®ä»¶ã€é£Ÿè°±(idã€å§“åå’Œå›¾åƒ)ã€‚

```
apollo: {
    user: query.GET_USER_QUERY
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

apollo è¢«æ·»åŠ åˆ°ç»„ä»¶ä¸­ï¼Œä»¥è·å–ä¸å¯¹è±¡ç›¸å…³çš„ç‰¹å®šæŸ¥è¯¢ã€‚getMe æŸ¥è¯¢ä¸ç”¨æˆ·å¯¹è±¡ç›¸å…³è”ã€‚

åœ¨ my-recipe é¡µé¢ä¸Šï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å“åº”æ¥è‡ªç¼“å­˜å†…å­˜ã€‚

```
this.$apollo.queries.user.refetch(); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

refetch ä½¿ç”¨ç›¸åº”çš„(ç”¨æˆ·)æŸ¥è¯¢ä»æœåŠ¡å™¨è·å–æœ€æ–°æ•°æ®ã€‚è¿™åº”è¯¥è°¨æ…ä½¿ç”¨ã€‚

å¯ä»¥ä» apollo è®¿é—®ä¸€äº›æœ‰è¶£çš„é€‰é¡¹ï¼Œæ¯”å¦‚åŠ è½½çŠ¶æ€ã€é”™è¯¯ã€æš‚åœæŸ¥è¯¢æµç­‰ç­‰ã€‚

æˆ‘ä»¬å¦‚ä½•å¤„ç†çªå˜ï¼Ÿ

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åˆ›å»ºé£Ÿè°±:

å› ä¸ºæˆ‘ä»¬å¯¹å•ä¸ªæ–‡ä»¶æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥ file å¯¹è±¡è¢«ç»‘å®šåˆ° image(å¯¹è±¡çš„ä¸€éƒ¨åˆ†å°†è¢«å‘é€åˆ°æœåŠ¡å™¨)ã€‚

```
onFileChange(e) {
      const files = e.target.files || e.dataTransfer.files;
      this.image = files[0];
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

$this.apollo.mutate æ¥å—å˜å¼‚åŠå…¶å˜é‡ã€‚å› ä¸ºæœåŠ¡å™¨æ­£åœ¨è¯·æ±‚è¾“å…¥ã€‚ä¸€ä¸ªè¾“å…¥å¯¹è±¡è¢«ä¼ é€’ç»™å˜é‡ã€‚

```
async createRecipe() {
      const recipeObject = {
        name: this.recipeName,
        description: this.description,
        difficultyLevel: this.difficultyLevel
          ? parseInt(this.difficultyLevel)
          : 0,
        image: this.image,
        steps: this.stepsList,
        averageTimeForCompletion: this.averageTime
          ? parseInt(this.averageTime)
          : 0
      };
      await this.$apollo
        .mutate({
          mutation: query.CREATE_RECIPE_QUERY,
          variables: { input: recipeObject }
        })
        .then(({ data }) => {
            this.$router.push({ name: "my-recipes" });
        })
        .catch(err => {
          console.log(err);
          this.error =
            parseGraphqlError(err) || "Something went wrong. Try again...";
        });
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*åˆ›å»ºé…æ–¹*

#### [](#conclusion)ç»“è®º

å°±åƒæˆ‘å‰é¢è¯´çš„ï¼Œç›¸æ¯”æˆ‘ä»¬ä¹ æƒ¯çš„(REST)ï¼ŒGraphQL æ›´å®¹æ˜“è®¾ç½®ã€æ›´æ–°å’Œé‡æ„ã€‚

å¦‚æœæ‚¨çš„æ¨¡å¼è®¾è®¡å¾—ä¸å¥½ï¼Œæ‚¨çš„å®¢æˆ·ç«¯å¯ä»¥å¯¹æ‚¨çš„æ¨¡å¼è¿›è¡Œé€’å½’è°ƒç”¨ã€‚é¿å…ä¼šç»™å‡ºç›¸åŒç»“æœçš„æŸ¥è¯¢ã€‚å…³äº GraphQL with Apollo çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ç‚¹å‡»[è¿™é‡Œ](https://www.apollographql.com/docs/)ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº Vue Apollo çš„ä¿¡æ¯ï¼Œè¯·ç‚¹å‡»è¿™é‡Œçš„ã€‚

* * *

### [](#plug-logrocket-a-dvr-for-web-apps)Plug: [LogRocket](https://logrocket.com/signup/) ï¼Œä¸€æ¬¾é€‚ç”¨äºç½‘ç»œåº”ç”¨çš„ DVR

<figure>[![](../Images/d56be9e9e36d8fa98c6959f7097b7787.png)](https://logrocket.com/signup/)

<figcaption></figcaption>

</figure>

LogRocket æ˜¯ä¸€ä¸ªå‰ç«¯æ—¥å¿—å·¥å…·ï¼Œå¯ä»¥è®©ä½ å›æ”¾é—®é¢˜ï¼Œå°±åƒå®ƒä»¬å‘ç”Ÿåœ¨ä½ è‡ªå·±çš„æµè§ˆå™¨ä¸­ä¸€æ ·ã€‚LogRocket ä¸éœ€è¦çŒœæµ‹é”™è¯¯å‘ç”Ÿçš„åŸå› ï¼Œä¹Ÿä¸éœ€è¦å‘ç”¨æˆ·è¯¢é—®æˆªå›¾å’Œæ—¥å¿—è½¬å‚¨ï¼Œè€Œæ˜¯è®©æ‚¨é‡æ”¾ä¼šè¯ä»¥å¿«é€Ÿäº†è§£å“ªé‡Œå‡ºé”™äº†ã€‚å®ƒå¯ä»¥ä¸ä»»ä½•åº”ç”¨ç¨‹åºå®Œç¾é…åˆï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ¡†æ¶ï¼Œå¹¶ä¸”æœ‰æ’ä»¶å¯ä»¥è®°å½•æ¥è‡ª Reduxã€Vuex å’Œ@ngrx/store çš„é¢å¤–ä¸Šä¸‹æ–‡ã€‚

é™¤äº†è®°å½• Redux æ“ä½œå’ŒçŠ¶æ€ï¼ŒLogRocket è¿˜è®°å½•æ§åˆ¶å°æ—¥å¿—ã€JavaScript é”™è¯¯ã€å †æ ˆè·Ÿè¸ªã€å¸¦æœ‰å¤´+æ­£æ–‡çš„ç½‘ç»œè¯·æ±‚/å“åº”ã€æµè§ˆå™¨å…ƒæ•°æ®å’Œè‡ªå®šä¹‰æ—¥å¿—ã€‚å®ƒè¿˜ä½¿ç”¨ DOM æ¥è®°å½•é¡µé¢ä¸Šçš„ HTML å’Œ CSSï¼Œç”šè‡³ä¸ºæœ€å¤æ‚çš„å•é¡µé¢åº”ç”¨ç¨‹åºé‡æ–°åˆ›å»ºåƒç´ çº§å®Œç¾è§†é¢‘ã€‚

å…è´¹è¯•ç”¨ã€‚

* * *

å…³äºå¦‚ä½•å°† GraphQL ä¸ Node å’Œ Vue ä¸€èµ·ä½¿ç”¨çš„å¸–å­[é¦–å…ˆå‡ºç°åœ¨](https://blog.logrocket.com/demonstration-on-how-to-use-graphql-with-node-and-vue-in-bits-8981f0d65f94/)[çš„ LogRocket åšå®¢](https://blog.logrocket.com)ä¸Šã€‚