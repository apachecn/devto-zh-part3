# åœ¨ Postgres ä¸Šä½¿ç”¨ GraphQL æ„å»ºé™æ€ç½‘ç«™

> åŸæ–‡:[https://dev . to/hasurahq/build-react-static-sites-using-graph QL-on-postgres-ama](https://dev.to/hasurahq/build-react-static-sites-using-graphql-on-postgres-ama)

**TLï¼›DR:** ä¸ºæ‚¨çš„ [react-static](https://github.com/nozzle/react-static) ç«™ç‚¹æä¾›æ¥è‡ªæ‚¨ç°æœ‰ postgres æ•°æ®åº“çš„æºæ•°æ®ã€‚å³æ—¶è®¾ç½®ã€‚æ•™ç¨‹/æ ·æ¿æ–‡ä»¶ğŸ‘‰ [react-static-graphql](https://github.com/hasura/graphql-engine/tree/master/community/sample-apps/react-static-graphql)

<figure>[![](../Images/bb0ab1d04a9a0f090d14ea79143e1388.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--dsVAFpt7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.hasura.io/content/images/2019/02/reactstatic.png)

<figcaption>react-é™æ€<-graph QL<-Hasura<-Postgres</figcaption>

</figure>

react-static æ˜¯ä¸€ä¸ªç”¨äº react çš„æ¸è¿›å¼é™æ€ç«™ç‚¹ç”Ÿæˆå™¨ã€‚å®ƒè¢«è®¾è®¡æˆé«˜æ€§èƒ½çš„ï¼Œå¹¶æ”¯æŒåƒ GraphQL è¿™æ ·çš„å®šåˆ¶æŸ¥è¯¢å±‚ã€‚è¿™æ˜¯ä¸€ä¸ªæµè¡Œçš„ JAMStack æ¡†æ¶ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å…³æ³¨ **JAMStack** çš„ **API** éƒ¨åˆ†ï¼Œå®ƒå…è®¸æˆ‘ä»¬æ„å»ºå¼ºå¤§çš„é™æ€ç«™ç‚¹ã€‚æ‰€æœ‰çš„æ•°æ®åº“æ“ä½œéƒ½è¢«æŠ½è±¡æˆ GraphQL APIs(åœ¨æœ¬ä¾‹ä¸­æ˜¯ Hasura ),å¹¶é€šè¿‡ JavaScript åœ¨ HTTPS ä¸Šè®¿é—®ã€‚Hasura åœ¨ Postgres ä¹‹ä¸Šæä¾›äº† GraphQL APIsã€‚å› æ­¤å¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨å®ƒæ¥æ„å»ºä¸€ä¸ªå¸¦æœ‰ **react-static** çš„ç«™ç‚¹ï¼Œè¿™å°†æ˜¯ JAMStack çš„**æ ‡è®°**éƒ¨åˆ†ã€‚

<figure>[![](../Images/00f1d5dc2a6e6a44a41e9fc2158fa2b8.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--OFGWltS3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.hasura.io/content/images/2019/02/jamstack-4.png) 

<figcaption>JAMStack ä¸ Hasura GraphQL å’Œ react-static</figcaption>

</figure>

### [](#deploy-hasura)éƒ¨ç½² Hasura

æŒ‰ç…§[è‡ªè¿°æ–‡ä»¶](https://github.com/hasura/graphql-engine/blob/master/community/sample-apps/react-static-graphql/README.md)ä¸­çš„è¯´æ˜éƒ¨ç½² Hasuraï¼Œå¹¶åˆ›å»º app æ‰€éœ€çš„è¡¨æ ¼**ä½œè€…**å’Œ**æ–‡ç« **ã€‚æ³¨æ„ GraphQL ç«¯ç‚¹çš„ Heroku URLã€‚æ‚¨å°†åœ¨åº”ç”¨ç¨‹åºä¸­å¯¹æ­¤è¿›è¡Œé…ç½®ã€‚

### [](#clone-and-run-app)å…‹éš†å¹¶è¿è¡Œ app

[æ¼”ç¤ºåº”ç”¨](https://github.com/hasura/graphql-engine/tree/master/community/sample-apps/react-static-graphql)å¸¦ä½ æ„å»ºä¸€ä¸ªç®€å•çš„åšå®¢åº”ç”¨ï¼Œåˆ—å‡ºæ‰€æœ‰ä½œè€…å’Œæ¯ä¸ªä½œè€…å†™çš„æ–‡ç« ã€‚æ‚¨å¯ä»¥å…‹éš†å¹¶è¿è¡Œè¯¥åº”ç”¨ç¨‹åºè¿›è¡Œæ¼”ç¤ºã€‚

```
$ git clone git@github.com:hasura/graphql-engine.git
$ cd graphql-engine/community/sample-apps/react-static-graphql
$ yarn install 
```

å®‰è£…ä¹‹åï¼Œæ‚¨å¿…é¡»é…ç½®ä¸Šé¢å¾—åˆ°çš„ GraphQL ç«¯ç‚¹ã€‚

æ‰“å¼€`src/apollo.js`å¹¶é…ç½®ç«¯ç‚¹ã€‚

ç°åœ¨è¿è¡Œ app:

```
$ yarn start 
```

æ‚¨åº”è¯¥ä¼šçœ‹åˆ° react-static ä¸»é¡µå¦‚ä¸‹æ‰€ç¤º:

<figure>[![](../Images/d7b4a3e191b92b16a5d50d17a5750996.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--qkoCRFDX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.hasura.io/content/images/2019/02/Screenshot-2019-02-11-at-7.46.39-PM.png)

<figcaption>react-é™æ€æ¼”ç¤º app with Hasura GraphQL</figcaption>

</figure>

å¦‚æœæ‚¨å·²ç»å‘ readme ä¸­æåˆ°çš„ä½œè€…å’Œæ–‡ç« æ·»åŠ äº†ç¤ºä¾‹æ•°æ®ï¼Œæ‚¨å¯ä»¥å¯¼èˆªåˆ° **/blog** å¹¶åœ¨ UI ä¸ŠæŸ¥çœ‹æ•°æ®æ¨¡æ¿ã€‚

## [](#implementation-details)å®ç°ç»†èŠ‚

æ—¢ç„¶æ‚¨å·²ç»æŸ¥çœ‹äº†æ¼”ç¤ºåº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬æ¥çœ‹çœ‹å¹•åå‘ç”Ÿäº†ä»€ä¹ˆã€‚å¯¹äºè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦ä» Postgres è·å–æ•°æ®ï¼Œå¹¶åœ¨ react ç»„ä»¶ä¸Šå°†å…¶æ¨¡æ¿åŒ–ã€‚è¦æå–çš„æ•°æ®å¾ˆç®€å•ï¼›æ–‡ç« å’Œä½œè€…ã€‚

Hasura ä¸­è·å–æ‰€æœ‰ä½œè€…çš„ GraphQL æŸ¥è¯¢ç±»ä¼¼äº

```
query {
  author {
    id
    name
  }
} 
```

è·å–ä¸€ä¸ªä½œè€…å†™çš„æ‰€æœ‰æ–‡ç« çš„æŸ¥è¯¢çœ‹èµ·æ¥åƒè¿™æ ·

```
query($author: Int!) {
    article(where: {author_id: {_eq: $author}}) {
        id
        title
        content
        created_at
    }
} 
```

å°±æ˜¯è¿™æ ·ï¼è¿™äº›æ˜¯æ„å»ºè¿™ä¸ªæ¼”ç¤ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„å”¯ä¸€æŸ¥è¯¢ã€‚é‚£ä¹ˆè·¯çº¿å‘¢ï¼Ÿå—¯ï¼Œå®é™…ä¸Šå†™å®ƒä»¬å¾ˆå®¹æ˜“ã€‚react-static è¯»å–ä¸€ä¸ªåä¸º **static.config.js** çš„é…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥å¯¼å‡ºä¸€ç³»åˆ—é…ç½®é€‰é¡¹ï¼Œ [**getRoutes**](https://github.com/nozzle/react-static/blob/master/docs/config.md#getroutes) å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚å®ƒåº”è¯¥è§£æä¸€ä¸ªè·¯ç”±å¯¹è±¡æ•°ç»„ã€‚

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªåˆ—å‡ºæ‰€æœ‰ä½œè€…çš„è·¯å¾„å’Œä¸€ä¸ªåˆ—å‡ºç»™å®šä½œè€…å†™çš„æ‰€æœ‰æ–‡ç« çš„è·¯å¾„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ªæ˜¾ç¤ºä½œè€…åˆ—è¡¨çš„ **/blog** è·¯å¾„å’Œä¸€ä¸ªæ˜¾ç¤ºç‰¹å®šä½œè€…æ’°å†™çš„æ‰€æœ‰æ–‡ç« åˆ—è¡¨çš„ **/blog/:authorId** è·¯å¾„ã€‚

ç°åœ¨ä½¿ç”¨ä¸Šé¢çš„ GraphQL æŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™è¦†ç›–ä¸Šé¢ç”¨ä¾‹çš„è·¯ç”±ã€‚static.config.js çš„ä»£ç ç‰‡æ®µå¦‚ä¸‹æ‰€ç¤º: