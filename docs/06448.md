# å¦‚ä½•æµ‹è¯•è§†å›¾æ§åˆ¶å™¨å¯¼èˆª

> åŸæ–‡:[https://dev . to/moka gio/how-to-test-view-controllers-navigation-3 hhh](https://dev.to/mokagio/how-to-test-view-controllers-navigation-3hhh)

è¿™é‡Œæœ‰ä¸€ä¸ªåœ¨æµ‹è¯• iOS åº”ç”¨æ—¶ç»å¸¸å‡ºç°çš„é—®é¢˜:â€œå½“*å‘ç”Ÿ*äº‹æƒ…æ—¶ï¼Œæˆ‘å¦‚ä½•æµ‹è¯•*ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨*å‘ˆç°*å¦ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨*â€

æµ‹è¯•è§†å›¾æ§åˆ¶å™¨ä¹‹é—´çš„å¯¼èˆªå¯èƒ½å¾ˆæ£˜æ‰‹ã€‚
å¦‚æœä½ æƒ³æµ‹è¯•æ¨é€å¯¼èˆªï¼Œä½ éœ€è¦å°†ä½ çš„è§†å›¾æ§åˆ¶å™¨åŒ…è£…åœ¨ä¸€ä¸ª`UINavigationController`ä¸­ï¼Œæˆ–è€…å¦‚æœæ˜¯æ¨¡æ€å±•ç¤ºï¼Œä½ éœ€è¦å°†å®ƒæ·»åŠ åˆ°ä¸€ä¸ª`UIWindow`ä¸­ã€‚é€šå¸¸ä¼šæ¶‰åŠåˆ°åŠ¨ç”»ï¼Œè¿™åè¿‡æ¥è¦æ±‚è¦ä¹ˆä½ çš„æµ‹è¯•æ–­è¨€æ˜¯å¼‚æ­¥çš„ï¼Œè¦ä¹ˆä½ çš„ä»£ç å…è®¸ä»æµ‹è¯•ä¸­æ³¨å…¥`animated`æ ‡å¿—ä½œä¸º`false`ã€‚

è¿™äº›å’Œå…¶ä»–ä¸€äº›å°é—®é¢˜ä½¿å¾—æµ‹è¯•æ›´éš¾ç¼–å†™å’Œæ¨ç†ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•è€Œå»‰ä»·çš„æ¨¡å¼æ¥è½»æ¾æµ‹è¯•æ‚¨çš„è§†å›¾æ§åˆ¶å™¨å¦‚ä½•è§¦å‘å¯¼èˆªï¼Œä½¿æ‚¨çš„ä»£ç åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ›´å®¹æ˜“ä½¿ç”¨ã€‚

## [](#-raw-navigationdelegate-endraw-)`NavigationDelegate`

ä½¿è§†å›¾æ§åˆ¶å™¨ä¹‹é—´çš„å¯¼èˆªæ˜“äºæµ‹è¯•çš„å…³é”®åœ¨äºè®¤è¯†åˆ°**è§†å›¾æ§åˆ¶å™¨è´Ÿè´£å‘ˆç°å…¶ä»–è§†å›¾æ§åˆ¶å™¨**ã€‚

è§†å›¾æ§åˆ¶å™¨åº”è¯¥åªè§¦å‘å¯¼èˆªï¼Œç„¶å*å°†æ‰§è¡Œå¯¼èˆªçš„åŠ¨ä½œå§”æ‰˜ç»™*ç»™å¦ä¸€ä¸ªå¯¹è±¡ã€‚
æˆ‘å–œæ¬¢ç§°è¿™ç±»ä»£è¡¨`NavigationDelegate` s [<sup id="pattern-origin">*</sup>](#fn1) ã€‚

æœ‰äº†`NavigationDelegate`ä¹‹åï¼Œæµ‹è¯•è§†å›¾æ§åˆ¶å™¨å¦‚ä½•å¯¼èˆªç°åœ¨å°±æ˜¯æµ‹è¯•å®ƒå¦‚ä½•ä¸å…¶å§”æ‰˜äº¤äº’çš„é—®é¢˜äº†ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€ä¸ª[é—´è°](https://www.mokacoding.com/blog/swift-test-doubles/#spy)æ¥å®Œæˆã€‚

### [](#-raw-navigationdelegate-endraw-in-action)`NavigationDelegate`åœ¨è¡ŒåŠ¨

ä¸ºäº†æµ‹è¯•è§†å›¾æ§åˆ¶å™¨æ˜¯å¦è§¦å‘äº†é¢„æœŸçš„å¯¼èˆªï¼Œæ‚¨å¯ä»¥éªŒè¯å®ƒæ˜¯å¦è°ƒç”¨äº†å…¶`NavigationDelegate`çš„é€‚å½“æ–¹æ³•ã€‚

```
func testCallsShowRedWhenRedButtonTouched() {
    let viewController = loadViewController()
    let navigationDelegateSpy = ViewControllerNavigationDelegateSpy()
    viewController.navigationDelegate = navigationDelegateSpy

    viewController.redButton.sendActions(for: .touchUpInside)

    XCTAssertTrue(navigationDelegateSpy.showRedCalled)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
protocol ViewControllerNavigationDelegate: class {
    func showRedViewController()
}

class ViewController: UIViewController {

    @IBOutlet weak var redButton: UIButton!

    weak var navigationDelegate: ViewControllerNavigationDelegate?

    override func viewDidLoad() {
        super.viewDidLoad()

        redButton.addTarget(self, action: #selector(redButtonTouched), for: .primaryActionTriggered)
    }

    @objc func redButtonTouched() {
        navigationDelegate?.showRedViewController()
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
class ViewControllerNavigationDelegateSpy: ViewControllerNavigationDelegate {

    private(set) var showRedCalled = false

    func showRedViewController() {
        showRedCalled = true
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*æœ¬ä»£ç å…¨éƒ¨å¯åœ¨[æœ¬ GitHub å›è´­](https://github.com/mokagio/Navigation-Delegate-Example)T3ã€‘ä¸­è·å¾—ã€‚*

ä¸Šé¢çš„æµ‹è¯•çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä¸æ˜¯å—ï¼Ÿ
é€šè¿‡ä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œæ‚¨ä¸å†éœ€è¦è®¾ç½®åŒ…å«è¢«æµ‹è§†å›¾æ§åˆ¶å™¨çš„æ•´ä¸ªå¯¼èˆªæ ˆæ¥éªŒè¯å®ƒçš„è¡Œä¸ºã€‚
ä½ ä¹Ÿä¸éœ€è¦æŠŠè§†å›¾æ§åˆ¶å™¨æ”¾åœ¨`UIWindow`æˆ–è€…`UINavigationController`é‡Œé¢ï¼Œç®€åŒ–äº†æµ‹è¯•è®¾ç½®å’Œæ‹†å¸ã€‚

å”¯ä¸€çš„ç¼ºç‚¹æ˜¯ä½ å¿…é¡»ä¸º`NavigationDelegate`é€ ä¸€ä¸ªé—´è°æµ‹è¯•æ›¿èº«ã€‚é‰´äºè¿™æ¶‰åŠçš„ä»£ç å¦‚æ­¤ä¹‹å°‘ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æƒè¡¡ã€‚

å¦‚æœä½ æƒ³æµ‹è¯•ç¬¦åˆ`NavigationDelegate`çš„ç±»å‹å¦‚ä½•æ‰§è¡Œå¯¼èˆªâ€”â€”è¿™æ˜¯ä¸€ä¸ªæ˜æ™ºçš„åšæ³•â€”â€”ä½ å¯ä»¥ç‹¬ç«‹å®Œæˆã€‚

```
func testPushesRedViewController() {
    let navigator = Navigator(navigationController: UINavigationController(rootViewController: UIViewController()))

    navigator.showRedViewController()

    _ = expectation(
        for: NSPredicate { input, _ in
            return (input as? UINavigationController)?.topViewController is RedViewController
        },
        evaluatedWith: navigator.navigationController,
        handler: .none
    )
    waitForEnavigatorpectations(timeout: 1, handler: .none)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#you-can-adopt-raw-navigationdelegate-endraw-s-today)ä»Šå¤©ä½ å¯ä»¥é‡‡ç”¨`NavigationDelegate` s

æˆ‘å–œæ¬¢è¿™ä¸ªæƒ³æ³•çš„åŸå› æ˜¯å®ƒæ—¢ä¾¿å®œåˆä¾¿æºã€‚ä½ ä¸å¿…æ”¹å˜ä½ çš„åº”ç”¨æ¶æ„æ¥é‡‡ç”¨å®ƒã€‚
äº‹å®ä¸Šï¼Œå®ƒéå¸¸é€‚åˆå¤§å¤šæ•°æ¶æ„ã€‚

ä½ å¯ä»¥ä»ä»Šå¤©å¼€å§‹ä½¿ç”¨`NavigationDelegate` sã€‚

ä¸ºäº†å¼€å§‹å¹¶ä½¿æ‚¨çš„ä»£ç å¯æµ‹è¯•ï¼Œæ‚¨ç”šè‡³å¯ä»¥è®©è§†å›¾æ§åˆ¶å™¨æˆä¸ºå®ƒè‡ªå·±çš„å¯¼èˆªå§”æ‰˜ã€‚ä»é•¿è¿œæ¥çœ‹ï¼Œè¿™è‚¯å®šä¸æ˜¯æˆ‘èµåŒçš„äº‹æƒ…ï¼Œä½†å®ƒå¯èƒ½ä¼šå¸®åŠ©ä½ å¼€å§‹ã€‚
ä¸€æ—¦å§”æ‰˜åœ¨ä»£ç åº“ä¸­ï¼Œæ‚¨å¯ä»¥ç¨åå†å›åˆ°å®ƒå¹¶åœ¨ä¸“ç”¨å¯¹è±¡ä¸­æå–å®ç°ã€‚

## [](#benefits)å¥½å¤„

ä»¥è¿™ç§æ–¹å¼ä½¿è§†å›¾æ§åˆ¶å™¨çš„å¯¼èˆªç«¯æ›´å®¹æ˜“æµ‹è¯•è¿˜æœ‰å…¶ä»–å¥½å¤„ã€‚

å› ä¸ºæ‚¨çš„è§†å›¾æ§åˆ¶å™¨ç°åœ¨ä¸çŸ¥é“å¦‚ä½•å‘ˆç°æ–°çš„è§†å›¾æ§åˆ¶å™¨ï¼Œæ‰€ä»¥å½“æ›´æ–°å¯¼èˆªå·¥ä½œæ–¹å¼æ—¶ï¼Œå®ƒä»¬ä¸éœ€è¦æ”¹å˜(å‚è§ç¤ºä¾‹é¡¹ç›®ä¸­çš„[PR](https://github.com/mokagio/Navigation-Delegate-Example/pull/1))ã€‚

è¿˜è®°å¾—[å•ä¸€è´£ä»»åŸåˆ™](https://en.wikipedia.org/wiki/Single_responsibility_principle)çš„å®šä¹‰å—ï¼Ÿä¸€ä¸ªå¯¹è±¡åº”è¯¥åªæœ‰ä¸€ä¸ªæ”¹å˜çš„ç†ç”±ã€‚
è§†å›¾æ§åˆ¶å™¨æ˜¯ iOS åº”ç”¨çš„èƒ¶æ°´ä»£ç ï¼›ä»–ä»¬æœ€ç»ˆåšäº†å¾ˆå¤šäº‹æƒ…ã€‚æœ‰äº†è¿™ä¸ªï¼Œä»–ä»¬åˆå°‘äº†ä¸€ä»¶äº‹è¦åšã€‚ğŸ˜‰

å•ä¸€è´£ä»»ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘å–œæ¬¢ä½¿ç”¨ä¸€ä¸ªä¸“ç”¨çš„ä»…ç”¨äºå¯¼èˆªçš„å§”æ‰˜ï¼Œå³ä½¿è§†å›¾æ§åˆ¶å™¨å·²ç»æœ‰ä¸€ä¸ªå§”æ‰˜ã€‚æ˜¯çš„ï¼Œä½ æœ€ç»ˆä¼šæœ‰æ›´å¤šçš„å®šä¹‰å’Œå¯¹è±¡ï¼Œä½†æ˜¯æˆ‘å®æ„¿åœ¨ä¸€ä¸ªæœ‰å¾ˆå¤šå°çš„ã€å®¹æ˜“æ¨ç†çš„ä»£ç åº“ä¸­å·¥ä½œï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæœ‰å‡ ä¸ªç±»åšæ‰€æœ‰å·¥ä½œçš„ä»£ç åº“ã€‚

* * *

å¦‚æœä½ çŸ¥é“æ­£ç¡®çš„æ–¹æ³•ï¼Œæµ‹è¯•`UIViewController`å¦‚ä½•è§¦å‘å¯¼èˆªå°±åƒéªŒè¯ä»»ä½•å…¶ä»–å‰¯ä½œç”¨ä»£ç ä¸€æ ·ç®€å•ã€‚

`NavigationDelegate`æ¨¡å¼éµå¾ª*T2 æ³•åˆ™ï¼›åˆ†è€Œæ²»ä¹‹ã€‚
å°†å¯¼èˆªçš„å®ç°åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå¯åŠ¨å®ƒçš„ä»£ç å’Œæ‰§è¡Œå®ƒçš„ä»£ç ã€‚
å•ç‹¬æµ‹è¯•ä¸¤è€…æ¯”ä¸€èµ·æµ‹è¯•æ›´å®¹æ˜“ã€‚*

ä½¿ç”¨`NavigationDelegate` s ä¸ä»…ä¼šä½¿ä½ çš„åº”ç”¨ç¨‹åºçš„å…³é”®åŒºåŸŸæ›´å®¹æ˜“æµ‹è¯•ï¼Œæ¯”å¦‚å±å¹•æ˜¯å¦‚ä½•é“¾æ¥åœ¨ä¸€èµ·çš„ï¼Œè€Œä¸”è¿˜ä¼šä½¿åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒåŒºåŸŸé‡ç”¨è§†å›¾æ§åˆ¶å™¨æ›´å®¹æ˜“ã€‚
ä¸€ä¸ªæ°å½“çš„ä¾‹å­è¯´æ˜äº†å¦‚ä½•ä½¿æµ‹è¯•å˜å¾—å®¹æ˜“ä¹Ÿä½¿å®ƒä»¬å˜å¾—å®¹æ˜“ä½¿ç”¨ã€‚

è¯¥æ¨¡å¼ä¹Ÿå¯ä»¥å¾ˆå¥½åœ°æ‰©å±•ã€‚
æ‚¨å¯ä»¥æƒ³è±¡ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨åŸºäºæŸç§å†…éƒ¨çŠ¶æ€è§¦å‘ä¸åŒå±å¹•çš„å‘ˆç°ã€‚
ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰è®¢é˜…ï¼Œä¸€ä¸ªæŒ‰é’®å¯ä»¥æ˜¾ç¤ºä¸€ä¸ªå±å¹•å‘ç”¨æˆ·è¿½åŠ é”€å”®è®¢é˜…ï¼Œæˆ–è€…å¦‚æœç”¨æˆ·æœ‰è®¢é˜…ï¼Œå¯ä»¥æ¨é€åˆ°åŠŸèƒ½å±å¹•ã€‚
è¿™ä¸¤ä¸ªä¸åŒçš„æµç¨‹ç”±`NavigationDelegate`ä¸­çš„ä¸¤ç§ä¸åŒæ–¹æ³•è§¦å‘ã€‚
åœ¨æµ‹è¯•ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨è§†å›¾æ§åˆ¶å™¨ä¸­è®¾ç½®çŠ¶æ€ï¼Œåˆæˆåº”è¯¥è§¦å‘è¡¨ç¤ºçš„ç”¨æˆ·åŠ¨ä½œï¼Œå¹¶é€šè¿‡ spy éªŒè¯è°ƒç”¨äº†æ­£ç¡®çš„å¯¼èˆªæ–¹æ³•ã€‚

ä½ è®¤ä¸ºè¿™ç§æ–¹æ³•æ€ä¹ˆæ ·ï¼Ÿå¦‚æœä½ ä½¿ç”¨å®ƒï¼Œæˆ‘å¾ˆæƒ³å¬å¬ä½ çš„æƒ³æ³•ï¼Œä»¥åŠä½ å¯¹å®ƒçš„çœ‹æ³•ã€‚
åœ¨ Twitter ä¸Šé€šè¿‡ [@mokagio](https://twitter.com/mokagio) è”ç³»æˆ–è€…åœ¨ä¸‹é¢ç•™è¨€ã€‚

è¿™æ˜¯æˆ‘çš„åšå®¢[mokacoding.com](https://www.mokacoding.com/blog/navigation-delegate-pattern/)çš„ä¸€ç¯‡äº¤å‰æ–‡ç« ã€‚

### [](#related-posts)ç›¸å…³å²—ä½

[![mokagio image](../Images/2732dd67ac527aa93174267b602adff5.png)](/mokagio) [## å¦‚ä½•åœ¨ Swift ä¸­è¿›è¡Œ TDDï¼Œåˆ†æ­¥æŒ‡å—

### å‰å¥¥ç½—æ 2 æœˆ 13 æ—¥ 1914 åˆ†é’Ÿé˜…è¯»

#tdd #swift #testing](/mokagio/how-to-tdd-in-swift-a-step-by-step-guide-8jg)[![mokagio image](../Images/2732dd67ac527aa93174267b602adff5.png)](/mokagio) [## è¿…æ·ä¸­çš„æµ‹è¯•æ›¿èº«:å‡äººã€å‡è´§ã€æ ‘æ¡©å’Œé—´è°ã€‚

### å‰å¥¥ç½—æ 2 æœˆ 15 æ—¥ 196 åˆ†é’Ÿé˜…è¯»

#swift #testing #tdd](/mokagio/test-doubles-in-swift-dummies-fakes-stubs-and-spies-2e9e)[![mokagio image](../Images/2732dd67ac527aa93174267b602adff5.png)](/mokagio) [## å¦‚ä½•åœ¨ Xcode ä¸­è¿è¡Œå•ä¸ªæµ‹è¯•

### å‰å¥¥ç½—æ 1919 å¹´ 4 æœˆ 24 æ—¥ 4 åˆ†é’Ÿé˜…è¯»

#xcode #testing #productivity](/mokagio/how-to-run-a-single-test-in-xcode-5h72)

### [](#footnotes)è„šæ³¨

[*](#pattern-origin) ã€‚å§”æ´¾ä»è§†å›¾æ§åˆ¶å™¨æ‰§è¡Œå¯¼èˆªçš„è´£ä»»çš„æƒ³æ³•å¹¶ä¸æ–°é¢–ã€‚è¿™ä¸ªæ¦‚å¿µä½¿å¾—åƒ[åè°ƒå™¨](http://khanlou.com/2015/10/coordinators-redux/)ã€[å¯¼èˆªå™¨](https://www.swiftbysundell.com/posts/navigation-in-swift)å’Œ[è·¯ç”±å™¨](https://clean-swift.com/routing-in-clean-swift/)è¿™æ ·çš„æ¨¡å¼æˆä¸ºå¯èƒ½ã€‚
æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ç§å½¢å¼åŒ–æ˜¯åœ¨ Alberto De Bortoli 2014 å¹´çš„å¸–å­â€œiOS ä¸Šçš„[æµé‡æ§åˆ¶å™¨ï¼Œä»¥å®ç°æ›´å¥½çš„å¯¼èˆªæ§åˆ¶](https://albertodebortoli.com/2014/09/03/flow-controllers-on-ios-for-a-better-navigation-control/)â€ä¸­ã€‚
å°½ç®¡ä»–åœ¨è§†å›¾æ§åˆ¶å™¨ä¸­æ³¨å…¥äº†è´Ÿè´£å¯¼èˆªçš„å¯¹è±¡ï¼Œä½†ç»“æœå‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚