# è°ƒè¯•æ‚¨çš„ã€‚å¸¦æœ‰ VS ä»£ç çš„ Docker åº”ç”¨ç¨‹åºä¸­çš„ NET Core

> åŸæ–‡:[https://dev . to/azure/debugging-your-net-core-in-docker-applications-with-vs-code-3g5d](https://dev.to/azure/debugging-your-net-core-in-docker-applications-with-vs-code-3g5d)

æ„å»ºåº”ç”¨ç¨‹åºçš„æœ€å¤§å¥½å¤„ä¹‹ä¸€ã€‚NET çš„æ ¸å¿ƒåœ¨äºå®ƒçš„è·¨å¹³å°æ”¯æŒæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº[éƒ¨ç½²ä¸º Docker å®¹å™¨](https://docs.microsoft.com/en-us/dotnet/core/docker/intro-net-docker?WT.mc_id=devto-blog-aapowell)ã€‚å¦‚æœä½ ç”¨çš„æ˜¯ Visual Studioï¼Œå®ƒå†…ç½®äº†å¯¹ Docker çš„æ”¯æŒ[ï¼Œä½†å¦‚æœä½ ç”¨çš„æ˜¯ Mac æˆ– Linuxï¼Œé‚£å°±ä¸è¡Œäº†ï¼Œæˆ–è€…åƒæˆ‘ä¸€æ ·ï¼Œä½ æ›´å–œæ¬¢ç”¨](https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/docker/visual-studio-tools-for-docker?view=aspnetcore-2.2&WT.mc_id=devto-blog-aapowell) [VS Code](https://code.visualstudio.com/?WT.mc_id=devto-blog-aapowell) ä½œä¸ºä½ çš„ç¼–è¾‘å™¨ã€‚

æ‰€ä»¥å¦‚æœä½ ä¸ºã€‚NET å®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
FROM mcr.microsoft.com/dotnet/core/sdk:2.2
WORKDIR /app
COPY ./bin/Debug/netcoreapp2.2/publish .
ENTRYPOINT ["dotnet", "MyApplication.dll"] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¤ªå¥½äº†ï¼æˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡æ„å»ºæ˜ åƒå’Œå¯åŠ¨å®¹å™¨æ¥è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è°ƒè¯•å®ƒï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

## [](#enabling-remote-debugging)å¯ç”¨è¿œç¨‹è°ƒè¯•

å¦‚æœä½ ä»é€»è¾‘ä¸Šè€ƒè™‘ï¼Œå½“åœ¨ Docker ä¸­è¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯è¿œç¨‹è¿è¡Œçš„ã€‚å½“ç„¶ï¼Œå®ƒå¯èƒ½è¿œç¨‹åœ°åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œä½†æ˜¯å®ƒä»ç„¶æ˜¯â€œè¿œç¨‹çš„â€ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘è°ƒè¯•çš„æ–¹å¼ï¼

è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å°† [MIEngine](https://github.com/Microsoft/MIEngine) å®‰è£…åˆ°æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„ Docker æ˜ åƒä¸­ï¼Œä¸ºæ­¤æˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„`Dockerfile` :
ä¸­æ·»åŠ ä¸€ä¸ªæ–°å±‚

```
FROM mcr.microsoft.com/dotnet/core/sdk:2.2
RUN apt update && \
    apt install unzip && \
    curl -sSL https://aka.ms/getvsdbgsh | /bin/sh /dev/stdin -v latest -l /vsdbg
WORKDIR /app
COPY ./bin/Debug/netcoreapp2.2/publish .
ENTRYPOINT ["dotnet", "MyApplication.dll"] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ–°çš„`RUN`å±‚å°†é¦–å…ˆæ›´æ–°`apt`ä»¥è·å¾—æ‰€æœ‰æœ€æ–°çš„åŒ…å¼•ç”¨ï¼Œç„¶åå®‰è£…`unzip`ï¼Œæœ€åæ‰§è¡Œ`curl`å“ªäº›ç®¡é“åˆ°`/bin/sh`ã€‚è¿™å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹æ··ä¹±ï¼Œä½†è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å°†ä¸‰ä¸ªå‘½ä»¤é“¾æ¥åˆ°ä¸€ä¸ªå±‚ä¸­ï¼Œä»¥å‡å° Docker å›¾åƒçš„å¤§å°ã€‚çœŸæ­£æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯è¿™ä¸€è¡Œ:

```
curl -sSL https://aka.ms/getvsdbgsh | /bin/sh /dev/stdin -v latest -l /vsdbg 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†ä»`https://aka.ms/getvsdbgsh`ä¸‹è½½ä¸€ä¸ª`sh`è„šæœ¬ï¼Œå¹¶é€šè¿‡ç®¡é“ç›´æ¥ä¼ è¾“åˆ°`/bin/sh`æ‰§è¡Œï¼Œå¹¶æä¾›ä¸€äº›å‚æ•°ï¼Œæœ€é‡è¦çš„æ˜¯`/vsdbg`ï¼Œè¿œç¨‹è°ƒè¯•å™¨å°†è¢«æå–åˆ°è¿™é‡Œã€‚

ç°åœ¨æˆ‘ä»¬çš„æ˜ åƒå·²ç»å®‰è£…äº†è°ƒè¯•å™¨ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® VS ä»£ç æ¥é™„åŠ å®ƒã€‚

## [](#attaching-vs-code-to-a-remote-debugger)å°† VS ä»£ç é™„åŠ åˆ°è¿œç¨‹è°ƒè¯•å™¨

æˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„`launch.json`æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ–°æ¡ç›®ï¼Œå®ƒå±äº`"type": "coreclr"`å’Œ`"request": "attach"`ã€‚è¿™å°†å¯¼è‡´ VS ä»£ç å¯åŠ¨è¿›ç¨‹é€‰æ‹©å™¨ï¼Œå¹¶å…è®¸æˆ‘ä»¬é€‰æ‹©æˆ‘ä»¬çš„ã€‚NET æ ¸å¿ƒè¿›ç¨‹ã€‚

ä½†æ˜¯ç­‰ç­‰ï¼Œé‚£æ˜¯åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œçš„ï¼Œæˆ‘å¦‚ä½•é€‰æ‹©é‚£ä¸ªè¿›ç¨‹å‘¢ï¼Ÿ

å¹¸è¿çš„æ˜¯ï¼Œè¿›ç¨‹é€‰æ‹©å™¨å¯¹è¯æ¡†èƒ½å¤Ÿæ‰§è¡Œä¸€ä¸ªå‘½ä»¤æ¥è·å–è¿›ç¨‹åˆ—è¡¨ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œã€‚

å®ƒå°†æ‰§è¡Œ`docker exec -i <container name> /vsdbg/vsdbg`æ¥åˆ—å‡ºå®¹å™¨ä¸­çš„è¿›ç¨‹ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šåšå¾—æ›´å¥½ä¸€ç‚¹:

```
{  "name":  ".NET Core Docker Attach",  "type":  "coreclr",  "request":  "attach",  "processId":  "${command:pickRemoteProcess}",  "pipeTransport":  {  "pipeProgram":  "docker",  "pipeArgs":  ["exec",  "-i",  "sunshine-downloader"],  "debuggerPath":  "/vsdbg/vsdbg",  "pipeCwd":  "${workspaceRoot}",  "quoteArgs":  false  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå¦‚æœæ‚¨è¿è¡Œæ‚¨çš„å®¹å™¨ï¼Œç„¶ååœ¨ VS ä»£ç ä¸­å¯åŠ¨è°ƒè¯•å™¨ï¼Œæ‚¨å°†èƒ½å¤Ÿåœ¨æ‚¨çš„åº”ç”¨ç¨‹åºæ­£åœ¨ä½¿ç”¨çš„å®¹å™¨ä¸­é€‰æ‹©`dotnet`è¿›ç¨‹ã€‚

## [](#conclusion)ç»“è®º

ç°åœ¨ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ VS ä»£ç ä½œä¸ºç¼–è¾‘å™¨ï¼Œä¹Ÿå¯ä»¥è°ƒè¯• Docker å®¹å™¨ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚æ‚¨å¯ä»¥å¤„ç†æ›´é«˜çº§çš„åœºæ™¯ï¼ŒåŒ…æ‹¬é€šè¿‡ SSH è¿›è¡Œè°ƒè¯•ï¼Œæ‰€æœ‰è¿™äº›éƒ½åŒ…å«åœ¨ OmniSharp çš„ wiki ä¸­ã€‚

äº‹å®ä¸Šï¼Œæˆ‘æ­£åœ¨ç”¨å®ƒæ¥è°ƒè¯•ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ F#åº”ç”¨ç¨‹åºã€‚ç½‘èŠ¯ã€‚ğŸ˜‰

è°ƒè¯•æ„‰å¿«ï¼ğŸ˜

## [](#bonus-idea-removing-the-additional-layer-with-volumes)é¢å¤–åˆ›æ„:ç§»é™¤å¸¦æœ‰ä½“ç§¯çš„é™„åŠ å±‚

å½“æˆ‘åœ¨å†…éƒ¨åˆ†äº«è¿™ä¸ªå¸–å­æ—¶ï¼Œæˆ‘çš„åŒäº‹[è‚–æ©Â·åšè€¶](https://twitter.com/spboyer)æå‡ºäº†ä¸€ä¸ªæƒ³æ³•ï¼Œå¦‚ä½•åœ¨ä¸å¢åŠ æ–°å±‚çš„æƒ…å†µä¸‹è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäº‹å®ä¸Šï¼Œå¯ä»¥è°ƒè¯•é¢„å»ºçš„å›¾åƒ(å‡è®¾å®ƒä»¬æœ‰è°ƒè¯•ç¬¦å·)ã€‚

ä½ å¯ä»¥é€šè¿‡ä¸‹è½½ä½ çš„æ˜ åƒæ‰€åŸºäºçš„å‘è¡Œç‰ˆ(Ubuntuï¼ŒAlpineï¼ŒARM ç­‰)çš„ vsdbg åŒ…æ¥å®ç°ã€‚)ï¼Œè¿™å¯ä»¥é€šè¿‡é˜…è¯» shell è„šæœ¬æ¥ç¡®å®š(æˆ–è€…ä¸‹è½½åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ğŸ˜‰)å®‰è£…åˆ°æ‚¨çš„æœºå™¨ä¸Šï¼Œç„¶ååœ¨å¯åŠ¨æ‚¨çš„å®¹å™¨æ—¶å°†è¯¥è·¯å¾„ä½œä¸ºä¸€ä¸ªå·å®‰è£…:

```
docker run --rm -v c:/path/to/vsdbg:/vsdbg --name my-dotnet-app my-dotnet-app 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œæ‚¨å·²ç»åœ¨å¯åŠ¨è°ƒè¯•å™¨æ—¶å°†å®ƒæ’å…¥åˆ°å®¹å™¨ä¸­ï¼Œè€Œä¸æ˜¯å°†å…¶æ†ç»‘åˆ°æ˜ åƒä¸­ã€‚