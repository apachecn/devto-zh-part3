# è¦†ç›– DOM è¾“å…¥çš„é”®å…¥å­—ç¬¦

> åŸæ–‡:[https://dev . to/iamandrewluca/WIP-override-DOM-input-typed-character-4611](https://dev.to/iamandrewluca/wip-override-dom-input-typed-character-4611)

### [](#problem-trying-to-solve)è¯•å›¾è§£å†³çš„é—®é¢˜ã€‚

å°†æ¯ä¸ªé”®ç›˜(è¾“å…¥æº/å¸ƒå±€)æ˜ å°„å› EN-USã€‚ä½ ä¼šé—®ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ

åœ¨å·¥ä½œä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªäºŒç»´ç æ‰«æä»ªï¼Œå¯ä»¥è¿æ¥åˆ°ä»»ä½•æœºå™¨(é€šè¿‡ USB)ï¼Œå½“ä½ æ‰«æäºŒç»´ç æ—¶ï¼Œå®ƒä¼šæ¨¡æ‹Ÿä¸€äº›é”®ç›˜è¾“å…¥ã€‚

æ‰«æä»ªä½¿ç”¨ç¾å›½æ ‡å‡† 101 å¸ƒå±€(EN-US)ï¼Œä¾‹å¦‚ï¼Œå®ƒçŸ¥é“å­—ç¬¦`Y`å…·æœ‰æ‰«æç `0x1c`ï¼Œè€Œ`Z`å°†å…·æœ‰æ‰«æç `0x1d`ï¼Œå®ƒå°†æ¨¡æ‹Ÿé”®ç›˜ä¸Šç‰¹å®šæŒ‰é”®çš„æ‰«æç ( [USB é”®ç›˜æ‰«æç ](https://www.win.tue.nl/~aeb/linux/kbd/scancodes-14.html))ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªäºŒç»´ç ä»£è¡¨è¿™ä¸ªç½‘å€ã€‚

```
https://amayzyng.com/iamandrewluca 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°†ä¸º 5 é”®ç›˜è¾“å…¥äºŒç»´ç æ‰«æä»ª(è¾“å…¥æº/å¸ƒå±€)

```
// English (ABC)
https://amayzyng.com/iamandrewluca

// German (ABC - QWERTZ)
httpsÃ–--amazyzng.com-iamandrewluca

// Dvorak
dyyloSzzamaf;fbivjrmzcamabep.,ngja

// Russian
Ñ€ĞµĞµĞ·Ñ‹Ğ–//Ñ„ÑŒÑ„Ğ½ÑĞ½Ğ¸Ğ¿ÑÑÑ‰ÑŒ/ÑˆÑ„ÑŒÑ„Ñ‚Ğ²ĞºÑƒÑ†Ğ´Ğ³ÑÑ„

// Romanian - Standard
httpsÈ˜//amayzyng.com/iamandrewluca 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæ¯ä¸ªäººçš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ğŸ™ƒè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å°†ç¾å›½æ ‡å‡† 101 å¸ƒå±€æ‰«æç æ˜ å°„åˆ° EN-US

### [](#requirements)è¦æ±‚

è§£å†³æ–¹æ¡ˆåŸºäºä»£è¡¨æŒ‰é”®ç‰©ç†ä»£ç çš„ [KeyboardEvent.code](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code) ã€‚æ­¤å¤–ï¼Œå¹¶éæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ`KeyboardEvent.code`(çŠ¶æ€:å·¥ä½œè‰æ¡ˆ)ã€‚

[![KeyboardEvent.code browser support](../Images/714c7f288eb435cb1c730e6448ac3e90.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--uNfzmzKA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/xi7h6yeduabkcau0u5c0.png)

å¦‚æœä½ æƒ³æ”¯æŒæ›´å¤šçš„æµè§ˆå™¨ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¤šå¡«å……ç¬¦

### [](#solution-for-the-problem-lets-get-started)è§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¼€å§‹å§ï¼

è¿™æ˜¯ä½ åœ¨è¿™ç¯‡æ–‡ç« ä¸­çœ‹åˆ°çš„å”¯ä¸€ä¸€æ®µ`HTML`ğŸ™‚

å…¶ä½™å°†æµ©æµ©è¡è¡`JavaScript`

```
<input type="text" /> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é¦–å…ˆè®©æˆ‘ä»¬çœ‹çœ‹åœ¨ä¸€ä¸ªè¾“å…¥ä¸­ä½¿ç”¨æœ€å¤šçš„äº‹ä»¶æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒä»¬æ˜¯ä»¥ä»€ä¹ˆé¡ºåºè¢«è§¦å‘çš„ã€‚

```
const input = document.querySelector('input')

input.addEventListener('focus', info)
input.addEventListener('keydown', info)
input.addEventListener('keypress', info)
input.addEventListener('input', info)
input.addEventListener('keyup', info)
input.addEventListener('change', info)
input.addEventListener('blur', info)

function info(event) {
    console.log(event.type, event.target.value)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ•æ‰è¾“å…¥å­—ç¬¦çš„å”¯ä¸€æ–¹æ³•æ˜¯è§‚å¯Ÿ`keypress`äº‹ä»¶ã€‚

åœ¨è¿™ä¸ªé˜¶æ®µäººç‰©ä¸ä¼šå‡ºç°åœ¨`input.value`

```
function onFocus  (event) { info(event) }
function keyDown  (event) { info(event) }
function keyPress (event) {
  info(event)
  // this 2 calls will stop `input` and `change` events
  event.preventDefault();
  event.stopPropagation();

  // get current props
  const target = event.target
  const start = target.selectionStart;
  const end = target.selectionEnd;
  const val = target.value;

  // get some char based on event
  const char = getChar(event);

  // create new value
  const value = val.slice(0, start) + char + val.slice(end);

  // first attemp to set value
  // (doesn't work in react because value setter is overrided)
  // target.value = value

  // second attemp to set value, get native setter
  const nativeInputValueSetter = Object.getOwnPropertyDescriptor(
    window.HTMLInputElement.prototype,
    "value"
  ).set;
  nativeInputValueSetter.call(target, value);

  // change cursor position
  target.selectionStart = target.selectionEnd = start + 1;

  // dispatch `input` again
  const newEvent = new InputEvent('input', {
    bubbles: true,
    inputType: 'insertText',
    data: char
  })
  event.target.dispatchEvent(newEvent);
}
function keyUp    (event) { info(event) }
function onInput  (event) { info(event) }
function onChange (event) { info(event) }
function onBlur   (event) {
  // dispatch `change` again
  const newEvent = new Event('change', { bubbles: true })
  event.target.dispatchEvent(newEvent);
  info(event)
}

function info     (event) { console.log(event.type) }

function getChar(event) {
  // will show X if letter, will show Y if Digit, otherwise Z
  return event.code.startsWith('Key')
    ? 'X'
    : event.code.startsWith('Digit')
      ? 'Y'
      : 'Z'
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>