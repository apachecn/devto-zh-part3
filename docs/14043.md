# ç”¨ Flask-SQLAlchemy å°† Flask è¿æ¥åˆ°æ•°æ®åº“

> åŸæ–‡:[https://dev . to/hackersandslackers/connect-flask-to-a-database-with-flask-sqlalchemy-5d 15](https://dev.to/hackersandslackers/connect-flask-to-a-database-with-flask-sqlalchemy-5d15)

[![Connect Flask to a Database with Flask-SQLAlchemy](../Images/bd964c71a58577d44822a3aef41d962a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--QMa0KYij--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://storage.googleapis.com/hackersandslackers-cdn/2019/10/flask-sqlachemy.jpg)

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨è‚¯å®šå·²ç»ç†Ÿæ‚‰äº† Python çš„ [SQLAlchemy åº“](https://dev.to/hackersandslackers/pythonic-database-management-with-sqlalchemy-37m3)çš„å¥½å¤„:è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬ä¸Šé€‚ç”¨äºä»»ä½•æ•°æ®åº“ç›¸å…³å†…å®¹çš„ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚åƒå¤§å¤šæ•°ä¸»è¦çš„ Python åº“ä¸€æ ·ï¼ŒSQLAlchemy å·²ç»è¢«ç§»æ¤åˆ°ä¸€ä¸ªä¸“é—¨ä¸ Flask å…¼å®¹çš„ç‰ˆæœ¬ä¸­ï¼Œæ°å½“åœ°å‘½åä¸º **Flask-SQLAlchemy** ã€‚

ä¸æ ¸å¿ƒçš„ SQLAlchemy åŒ…ç±»ä¼¼ï¼ŒFlask-SQLAlchemy ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª ORMï¼Œé€šè¿‡è½»æ¾åˆ›å»ºå®šä¹‰çš„æ¨¡å‹æ¥ä¿®æ”¹åº”ç”¨ç¨‹åºæ•°æ®ã€‚ä¸ç®¡æ‚¨é€‰æ‹©çš„æ•°æ®åº“æ˜¯ä»€ä¹ˆï¼ŒFlask-SQLAlchemy å°†ç¡®ä¿æˆ‘ä»¬ç”¨ Python åˆ›å»ºçš„æ¨¡å‹èƒ½å¤Ÿç¿»è¯‘æˆæˆ‘ä»¬é€‰æ‹©çš„æ•°æ®åº“çš„è¯­æ³•ã€‚é‰´äº Flask-SQLAlchemy çš„æ˜“ç”¨æ€§å’Œä¸€åˆ€åˆ‡çš„æ€§è´¨ï¼Œéš¾æ€ªè¯¥åº“ä»ä¸€å¼€å§‹å°±æ˜¯ Flask äº‹å®ä¸Šçš„æ•°æ®åº“åº“(è¯´çœŸçš„ï¼Œè¿˜æœ‰å…¶ä»–é€‰æ‹©å—ï¼Ÿ)

## [](#configuring-flasksqlalchemy-for-your-application)ä¸ºæ‚¨çš„åº”ç”¨é…ç½® Flask-SQLAlchemy

åœ¨ä¸æ•°æ®åº“äº¤äº’ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é¢„å…ˆè®¾ç½®ä¸€äº›åŸºæœ¬çš„é…ç½®å˜é‡ã€‚ä½œä¸ºæ ‡å‡†ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åœ¨`config.py`ä¸­å®šä¹‰çš„ç±»æ¥å¤„ç†æˆ‘ä»¬çš„çƒ§ç“¶é…ç½®:

<figure>

```
from os import environ

class Config:
    """Set Flask configuration vars from .env file."""

    # General
    TESTING = environ["TESTING"]
    FLASK_DEBUG = environ["FLASK_DEBUG"]
    SECRET_KEY = environ.get('SECRET_KEY')

    # Database
    SQLALCHEMY_DATABASE_URI = environ.get("SQLALCHEMY_DATABASE_URI")
    SQLALCHEMY_TRACK_MODIFICATIONS = environ.get("SQLALCHEMY_TRACK_MODIFICATIONS") 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<figcaption>config.py</figcaption>

</figure>

è¿™é‡Œæœ‰ä¸¤ä¸ªç‰¹å®šäº Flask-SQLAlchemy çš„å˜é‡:

`SQLALCHEMY_DATABASE_URI`:æˆ‘ä»¬éœ€è¦è¿æ¥åˆ°æ•°æ®åº“çš„è¿æ¥å­—ç¬¦ä¸²ã€‚è¿™éµå¾ªæ ‡å‡†æƒ¯ä¾‹:`[DB_TYPE]+[DB_CONNECTOR]://[USERNAME]:[PASSWORD]@[HOST]:[PORT]/[DB_NAME]`

*   `SQLALCHEMY_ECHO`:å½“è®¾ç½®ä¸ºâ€˜Trueâ€™æ—¶ï¼ŒFlask-SQLAlchemy å°†æŠŠæ‰€æœ‰æ•°æ®åº“æ´»åŠ¨è®°å½•åˆ° Python çš„ stderr ä¸­ï¼Œä»¥ä¾¿è°ƒè¯•ã€‚
*   è€å®è¯´ï¼Œæˆ‘æ€»æ˜¯æŠŠè¿™ä¸ªè®¾ç½®ä¸ºâ€œå‡â€ï¼Œå¦åˆ™æ¯æ¬¡ä½ è¿è¡Œåº”ç”¨ç¨‹åºæ—¶éƒ½ä¼šå‡ºç°ä¸€ä¸ªè®¨åŒçš„è­¦å‘Šï¼Œæé†’ä½ è¿™ä¸ªé€‰é¡¹ä¼šå ç”¨å¾ˆå¤šç³»ç»Ÿèµ„æºã€‚

è¿™äº›æ‰æ˜¯æˆ‘ä»¬åº”è¯¥æ‹…å¿ƒçš„å¤§é—®é¢˜ã€‚å¦‚æœä½ è¿›å…¥äº†ä¸€äº›ä¸‹ä¸€çº§çš„æ•°æ®åº“ï¼Œæœ‰ä¸€äº›å…¶ä»–çš„ä¸“ä¸šæ¨¡å¼é…ç½®å˜é‡ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚

é€šè¿‡å¯¹ä¸Šè¿°å˜é‡ä½¿ç”¨ç²¾ç¡®çš„å‘½åçº¦å®šï¼Œåªéœ€å°†å®ƒä»¬æ”¾åœ¨æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå°±ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬é…ç½®æ•°æ®åº“è¿æ¥ã€‚æˆ‘ä»¬æ°¸è¿œä¸éœ€è¦åˆ›å»ºå¼•æ“ã€ä¼šè¯æˆ–è¿æ¥ã€‚

## [](#initiating-flasksqlalchemy)å¯åŠ¨çƒ§ç“¶-åŒ–å­¦æ»´å®š

å’Œå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [Flask åº”ç”¨ç¨‹åºå·¥å‚æ–¹æ³•](https://hackersandslackers.com/structuring-your-flask-app/)æ¥å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚å¦‚æœä½ å¯¹è¿™ä¸ªæœ¯è¯­ä¸ç†Ÿæ‚‰ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªæ•™ç¨‹ä»¤äººå›°æƒ‘ï¼Œè€Œä¸”å‡ ä¹æ²¡ç”¨ã€‚

ä½¿ç”¨ Flask-SQLAlchemy çš„ Flask åº”ç”¨ç¨‹åºçš„æœ€åŸºæœ¬çš„`__init__.py`æ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„:

<figure>

```
from flask import Flask
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()

def create_app():
    """Construct the core application."""
    app = Flask( __name__ , instance_relative_config=False)
    db.init_app(app)
    app.config.from_object('config.Config')

    with app.app_context():
        # Imports
        from . import routes

        # Create tables for our models
        db.create_all()

        return app 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<figcaption>init.py</figcaption>

</figure>

æ³¨æ„`db`çš„å­˜åœ¨åŠå…¶ä½ç½®:è¿™ä¸ªæ•°æ®åº“å¯¹è±¡è¢«è®¾ç½®ä¸º`create_app()`ä¹‹å¤–çš„*å…¨å±€*å˜é‡ã€‚å¦ä¸€æ–¹é¢ï¼Œ`create_app()`çš„å†…éƒ¨åŒ…å«äº†çº¿`db.init_app(app)`ã€‚å³ä½¿æˆ‘ä»¬å·²ç»å…¨å±€åœ°è®¾ç½®äº† db å¯¹è±¡ï¼Œè¿™ä¹Ÿæ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œé™¤éæˆ‘ä»¬åœ¨åˆ›å»ºåº”ç”¨ç¨‹åºååˆå§‹åŒ–å®ƒã€‚æˆ‘ä»¬é€šè¿‡åœ¨`create_app()`å†…è°ƒç”¨`init_app()`ï¼Œå¹¶å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä½œä¸ºå‚æ•°ä¼ é€’æ¥å®ç°è¿™ä¸€ç‚¹ã€‚åœ¨å®é™…çš„â€œåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡â€ä¸­ï¼Œæˆ‘ä»¬å°†è°ƒç”¨`create_all()`ï¼Œç¨åæˆ‘ä»¬å°†å¯¹æ­¤è¿›è¡Œä»‹ç»ã€‚

å¦‚æœä½ è§‰å¾—æœ€åä¸€æ®µå®Œå…¨æ˜¯èƒ¡è¨€ä¹±è¯­ï¼Œé‚£ä¹ˆä½ å¹¶ä¸å­¤å•ã€‚Flask Application Factory å¯èƒ½æ˜¯ Python è½¯ä»¶å¼€å‘ä¸­æœ€å¥‡æ€ªã€æœ€éš¾è§£é‡Šçš„æ¦‚å¿µä¹‹ä¸€â€”â€”æˆ‘æœ€å¥½çš„å»ºè®®æ˜¯ä¸è¦ç°å¿ƒä¸§æ°”ï¼Œé‡‡ç”¨ä¸Šé¢çš„å¤åˆ¶+ç²˜è´´ä»£ç ï¼Œç›²ç›®åœ°æ¥å—è¶³å¤Ÿå¤šæ¬¡çš„å¡«é¸­å¼èƒ¡è¯´å…«é“ï¼Œç›´åˆ°å®ƒæˆä¸ºç¬¬äºŒå¤©æ€§ã€‚è¿™å°±æ˜¯æˆ‘æ‰€åšçš„ï¼Œå³ä½¿æˆ‘å®Œæˆäº†è¿™ä¸ªæ•™ç¨‹ï¼Œæˆ‘*ä»ç„¶*é‡åˆ°äº†ä»¤äººè®¨åŒçš„æ€ªç™–ï¼Œè®©æˆ‘æªæ‰‹ä¸åŠã€‚

è¯·æ³¨æ„æˆ‘ä»¬åœ¨åä¸º **routes** çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è¿›è¡Œçš„å¯¼å…¥ã€‚è¿™æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰å†™çš„ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„ä¸€ä¸ª:ä¸€æ—¦æˆ‘ä»¬åˆ›å»ºäº†å®ƒä»¬ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ–‡ä»¶ç»“æ„å°†çœ‹èµ·æ¥åƒè¿™æ ·:

<figure>

```
my-app
â”œâ”€â”€ /application
â”‚ â”œâ”€â”€ __init__.py
â”‚ â”œâ”€â”€ routes.py
â”‚ â”œâ”€â”€ models.py
â”œâ”€â”€ .env
â”œâ”€â”€ config.py
â””â”€â”€ wsgi.py 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<figcaption>Our app structure</figcaption>

</figure>

## [](#creating-database-models)åˆ›å»ºæ•°æ®åº“æ¨¡å‹

åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª`models.py`æ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬å°†å¯¼å…¥æˆ‘ä»¬åœ¨`__init__.py`ä¸­åˆ›å»ºçš„`db`å¯¹è±¡ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ç±»æ¥åˆ›å»ºæ•°æ®åº“æ¨¡å‹ã€‚

ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯ä»ä¸€ä¸ª**ç”¨æˆ·**æ¨¡å‹å¼€å§‹ã€‚æˆ‘ä»¬åˆ›å»ºçš„ç¬¬ä¸€ä¸ªå˜é‡æ˜¯`__tablename__`ï¼Œå®ƒå°†å¯¹åº”äºæ–°ç”¨æˆ·å°†è¢«ä¿å­˜çš„ SQL è¡¨çš„åç§°ã€‚æˆ‘ä»¬åœ¨è¿™ä¸ªæ¨¡å‹ç±»ä¸­åˆ›å»ºçš„æ¯ä¸ªé¢å¤–å˜é‡éƒ½å°†å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€åˆ—:

<figure>

```
"""Data models."""
from . import db

class User(db.Model):
    """Data model for user accounts."""

    __tablename__ = 'flasksqlalchemy-tutorial-users'
    id = db.Column(
        db.Integer,
        primary_key=True
    )
    username = db.Column(
        db.String(64),
        index=False,
        unique=True,
        nullable=False
    )
    email = db.Column(
        db.String(80),
        index=True,
        unique=True,
        nullable=False
    )
    created = db.Column(
        db.DateTime,
        index=False,
        unique=False,
        nullable=False
    )
    bio = db.Column(
        db.Text,
        index=False,
        unique=False,
        nullable=True
    )
    admin = db.Column(
        db.Boolean,
        index=False,
        unique=False,
        nullable=False
    )

    def __repr__(self):
        return '<User {}>'.format(self.username) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<figcaption>models.py</figcaption>

</figure>

æ¯ä¸ªâ€œåˆ—â€æ¥å—ä»¥ä¸‹å±æ€§:

*   **æ•°æ®ç±»å‹:**æ¥å—ä¸‹åˆ—ä¹‹ä¸€:`String(size)`ã€`Text`ã€`DateTime`ã€`Float`ã€`Boolean`ã€`PickleType`æˆ–`LargeBinary`ã€‚
*   **primary_key** (å¯é€‰):å½“è®¾ç½®ä¸º **True** æ—¶ï¼Œè¯¥å­—æ®µå°†ä½œä¸ºç›¸åº”æ•°æ®åº“è¡¨ä¸­çš„ä¸»é”®ã€‚
*   **foreign_key** (å¯é€‰):è®¾ç½®ä¸å¦ä¸€ä¸ªè¡¨ä¸­çš„å­—æ®µçš„å¤–é”®å…³ç³»ã€‚ç›®æ ‡åˆ—å¿…é¡»æœ‰ä¸€ä¸ª**å”¯ä¸€**çº¦æŸï¼Œä»¥ä¾¿åœ¨ä¸¤ä¸ªè¡¨ä¹‹é—´å»ºç«‹å…³ç³»ã€‚
*   **unique** (å¯é€‰):å½“è®¾ç½®ä¸º **True** æ—¶ï¼Œè¯¥å­—æ®µå°†åœ¨æ•°æ®åº“ä¸­æ·»åŠ ä¸€ä¸ªå”¯ä¸€çº¦æŸã€‚
*   **nullable** (å¯é€‰):** **æ¥å—ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¯¥å€¼æŒ‡å®šè¯¥åˆ—æ˜¯å¦å¯ä»¥æ¥å—ç©ºå€¼ã€‚

éšç€æˆ‘ä»¬ç¬¬ä¸€ä¸ªæ¨¡å‹çš„åˆ›å»ºï¼Œæ‚¨å·²ç»æ¯”æƒ³è±¡ä¸­æ›´æ¥è¿‘ä¸æ•°æ®åº“çš„äº¤äº’äº†ã€‚

**Protip:** SQLAlchemy æ¨¡å‹æœ‰ä¸€äº›ä¿ç•™çš„å˜é‡åï¼Œå¯ç”¨äºè¿›ä¸€æ­¥é…ç½®ç›¸åº”çš„æ•°æ®åº“è¡¨ã€‚è¿™é‡Œæœ‰å‡ ä¸ªä¾‹å­:

*   `__tablename__`:è®¾ç½®ç»“æœè¡¨çš„åç§°ã€‚
*   `__table_args__ = {"schema": "my_name"}`:è®¾ç½®ä¿å­˜è¡¨æ ¼çš„ Postgres æ¨¡å¼ã€‚
*   `__table_args__ = {'extend_existing': True}`:æŒ‡å®šç›®æ ‡æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨åŒåçš„è¡¨ã€‚è®¾ç½®æ­¤é¡¹åï¼Œæ‚¨çš„æ¨¡å‹å°†ä¸ä¼šè¦†ç›–ç°æœ‰çš„è¡¨ï¼Œå› æ­¤ï¼Œæ‚¨çš„æ¨¡å‹ä¸­çš„å­—æ®µå¯èƒ½ä¸æ‚¨çš„è¡¨ä¸­çš„åˆ—ä¸åŒ¹é…ã€‚

## [](#creating-our-first-user)åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç”¨æˆ·

éšç€æˆ‘ä»¬çš„**ç”¨æˆ·**æ¨¡å‹çš„åˆ›å»ºï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†åœ¨æ•°æ®åº“ä¸­åŠ¨æ€åˆ›å»ºç”¨æˆ·æ‰€éœ€çš„ä¸œè¥¿ã€‚è¿™é‡Œæˆ‘ä»¬å°†æ‰“å¼€`routes.py`å¹¶åˆ›å»ºä¸€ä¸ªç®€å•çš„è·¯å¾„æ¥åˆ›å»ºä¸€ä¸ªç”¨æˆ·ã€‚è¿™ä¸ªè·¯ç”±å°†æ¥å—ä¸¤ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°:`?user=`å°†æ¥å—ä¸€ä¸ªç”¨æˆ·åï¼Œ`&email=`å°†æ¥å—ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€:

<figure>

```
from flask import request, render_template, make_response
from datetime import datetime as dt
from flask import current_app as app
from .models import db, User

@app.route('/', methods=['GET'])
def create_user():
    """Create a user."""
    username = request.args.get('user')
    email = request.args.get('email')
    if username and email:
        new_user = User(
            username=username,
            email=email,
            created=dt.now(),
            bio="In West Philadelphia born and raised, on the playground is where I spent most of my days",
            admin=False
        ) # Create an instance of the User class
        db.session.add(new_user) # Adds new User record to database
        db.session.commit() # Commits all changes
    return make_response(f"{new_user} successfully created!") 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<figcaption>routes.py</figcaption>

</figure>

çœ‹çœ‹è¿™æœ‰å¤šç®€å•ï¼åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ‰€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ª user ç±»çš„å®ä¾‹ï¼Œé€šè¿‡`db.session.add(new_user)`å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„ä¼šè¯ä¸­ï¼Œç„¶åç”¨`db.session.commit()`æäº¤æ›´æ”¹ï¼è¿™å°±æ˜¯ç”¨ SQLAlchemy è¿™æ ·çš„æ•°æ®åº“ ORM æ¥é©±åŠ¨åº”ç”¨ç¨‹åºçš„å¸å¼•åŠ›æ‰€åœ¨:æˆ‘ä»¬ç°åœ¨å¯ä»¥åƒç®¡ç†å¯¹è±¡ä¸€æ ·ç®¡ç†æ•°æ®ï¼Œè€Œä¸ç”¨è´¹å¿ƒå¤„ç† SQL è¯­å¥ã€‚åœ¨æ„å»ºåº”ç”¨ç¨‹åºçš„èƒŒæ™¯ä¸‹ï¼Œæ•°æ®æ¨¡å‹ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§å®‰å…¨ã€ç®€å•çš„æ–¹æ³•æ¥ä¿®æ”¹æ•°æ®ã€‚

å˜é‡ **new_user** åœ¨å†…å­˜ä¸­æœ¬åœ°åˆ›å»ºä¸€ä¸ª**ç”¨æˆ·**çš„å®ä¾‹ã€‚æˆ‘ä»¬ä¼ é€’å…³é”®å­—å‚æ•°æ¥è®¾ç½®æˆ‘ä»¬çš„ç±»ä¸­æ¯ä¸ªå­—æ®µçš„å€¼(*ç”¨æˆ·å*ã€*ç”µå­é‚®ä»¶*ã€*åˆ›å»º*å’Œ*ç®€å†*)ã€‚

`db.session.add(new_user)`æš‚å­˜æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„è¦æ·»åŠ åˆ°æ•°æ®åº“ä¸­çš„æ–°ç”¨æˆ·ã€‚ä¸ Python ä¸­çš„ä»»ä½•æ•°æ®åº“äº¤äº’ä¸€æ ·ï¼Œåœ¨æˆ‘ä»¬æ˜ç¡®ç»™å‡º OK ä¹‹å‰ï¼Œä¸ä¼šå®é™…æäº¤æ›´æ”¹ã€‚åœ¨ Flask-SQLAlchemy ä¸­ï¼Œè¿™æ˜¯é€šè¿‡`db.session.commit()`å®Œæˆçš„ã€‚

## [](#querying-our-new-data)æŸ¥è¯¢æˆ‘ä»¬çš„æ–°æ•°æ®

æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•ç¡®ä¿ä¸ä¼šåˆ›å»ºé‡å¤çš„è®°å½•å‘¢ï¼Ÿç”±äº*ç”¨æˆ·å*å’Œ*ç”µå­é‚®ä»¶*å­—æ®µæœ‰**å”¯ä¸€çš„**çº¦æŸï¼Œæˆ‘ä»¬çš„æ•°æ®åº“åœ¨æŠ€æœ¯ä¸Šä¸å…è®¸è¿™ç§æƒ…å†µå‘ç”Ÿã€‚å¦‚æœæˆ‘ä»¬ä¸æ·»åŠ é€‚å½“çš„éªŒè¯ï¼Œè¯•å›¾åœ¨æˆ‘ä»¬çš„è¡¨ä¸­æ’å…¥å¤šä¸ªå”¯ä¸€å€¼å°†å¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒã€‚ä¸å…¶å´©æºƒï¼Œä¸å¦‚è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªæ¼‚äº®çš„é”™è¯¯æ¶ˆæ¯ï¼

<figure>

```
from flask import request, render_template, make_response
from datetime import datetime as dt
from flask import current_app as app
from .models import db, User

@app.route('/', methods=['GET'])
def create_user():
    """Create a user."""
    username = request.args.get('user')
    email = request.args.get('email')
    if username and email:
        existing_user = User.query.filter(User.username == username or User.email == email).first()
        if existing:
            return make_response(f'{username} ({email}) already created!')
        new_user = User(
            username=username,
            email=email,
            created=dt.now(),
            bio="In West Philadelphia born and raised, on the playground is where I spent most of my days",
            admin=False
        ) # Create an instance of the User class
        db.session.add(new_user) # Adds new User record to database
        db.session.commit() # Commits all changes
    return make_response(f"{new_user} successfully created!") 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<figcaption>routes.py</figcaption>

</figure>

åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ä¹‹å‰ï¼Œ`existing_user`å˜é‡æŸ¥è¯¢æˆ‘ä»¬çš„ç”¨æˆ·è¡¨ï¼Œçœ‹çœ‹æ˜¯å¦å·²ç»å­˜åœ¨ä¸€ä¸ªè®°å½•ï¼Œå…¶ä¸­åŒ…å«æ‰€æä¾›çš„ä¿¡æ¯ã€‚ä¸ºäº†æŸ¥è¯¢å±äºä¸€ä¸ªæ•°æ®æ¨¡å‹çš„è®°å½•ï¼Œæˆ‘ä»¬ç¼–å†™è¿™æ ·ä¸€ä¸ªè¯­å¥:

```
[MODEL].query.[METHOD_1].[METHOD_1].[FIRST or ALL] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`[MODEL]`æ˜¯æˆ‘ä»¬çš„æ•°æ®æ¨¡å‹ç±»åï¼Œæˆ‘ä»¬ç”¨`.query`è·Ÿè¸ªå®ƒã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šç§æ–¹æ³•æ¥æ„é€ æŸ¥è¯¢:

*   `filter([CRITERIA])`:è¿”å›ç¬¦åˆç»™å®šæ¡ä»¶çš„æ‰€æœ‰è®°å½•ã€‚
*   `order_by([MODEL].[COLUMN])`:æŒ‰åˆ—å¯¹è¿”å›çš„è®°å½•è¿›è¡Œæ’åºã€‚
*   `get([VALUE])`:æ ¹æ®ä¸»é”®æ£€ç´¢è®°å½•ã€‚
*   `.limit([INTEGER])`:è®¾ç½®æœ€å¤§æ£€ç´¢è®°å½•æ•°ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`.filter()`æ–¹æ³•æ¥æ£€ç´¢å·²ç»æ‹¥æœ‰æˆ‘ä»¬æƒ³è¦çš„ç”¨æˆ·åæˆ–ç”µå­é‚®ä»¶çš„ç°æœ‰ç”¨æˆ·(æˆ‘ä»¬åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨`first()`è€Œä¸æ˜¯`all()`ï¼Œå› ä¸ºæˆ‘ä»¬æœŸæœ›æœ€å¤šæœ‰ 1 æ¡è®°å½•)ã€‚å¦‚æœè®°å½•å­˜åœ¨ï¼Œæˆ‘ä»¬å‘ç”¨æˆ·ä¼ é€’ä¸€ä¸ªé”™è¯¯:

```
myuser (myuser_972@example.com) already created! 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#loading-records-into-a-template)åŠ è½½è®°å½•åˆ°æ¨¡æ¿ä¸­

å¯¹äºæˆ‘ä»¬çš„æœ€åä¸€æ‹›ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„é‡‘è´¾éšç€æ•°æ®åº“è®°å½•æ’­æ”¾ã€‚æˆ‘ä¿®æ”¹äº†ä¸‹é¢çš„è·¯å¾„æ¥æ¸²æŸ“ä¸€ä¸ªåä¸º**users.html**çš„æ¨¡æ¿ã€‚è¯¥æ¨¡æ¿å°†åˆ›å»ºä¸€ä¸ªåˆ—å‡ºæ‰€æœ‰ç°æœ‰ç”¨æˆ·çš„ HTML é¡µé¢:

<figure>

```
...

@app.route('/', methods=['GET'])
def create_user():
    """Create a user."""
    ...
    users = User.query.all()
    return render_template(
        'users.html',
        users=users,
        title="Show Users"
    ) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<figcaption>routes.py</figcaption>

</figure>

è¯­å¥`User.query.all()`å°†è¿”å›æ•°æ®åº“ä¸­`User`çš„æ‰€æœ‰å®ä¾‹*ã€‚æˆ‘ä»¬ç”¨`users=users`å°†æ‰€æœ‰è¿™äº›è®°å½•ä¼ é€’åˆ°æˆ‘ä»¬çš„æ¨¡æ¿ä¸­ã€‚è¿™æ˜¯æˆ‘ä»¬çš„ Jinja æ¨¡æ¿:* 

<figure>

```
{% extends "layout.html" %}

{% block content %}
  {% for user in users %}
    <ul id="user.username">
      <li>Username: {{ user.username }}</li>
      <li>Email: {{ user.email }}</li>
      <li>Created: {{ user.created }}</li>
      <li>Bio: {{ user.bio }}</li>
      <li>Admin: {{ user.admin }}</li>
    </ul>
  {% endfor %}
{% endblock %} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

<figcaption>users.html</figcaption>

</figure>

å½“æˆ‘ä»¬å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ä¼šåœ¨ä¸»é¡µä¸Šçœ‹åˆ°ä»¥ä¸‹å†…å®¹:

<figure>[![Connect Flask to a Database with Flask-SQLAlchemy](../Images/1048cfe8416ee8f689171561ee87d5b8.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--mj9BFko_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://storage.googleapis.com/hackersandslackers-cdn/2019/09/flasksqlalchemy-test.png) 

<figcaption>æˆ‘ä»¬å·²ç»å‡ç©ºäº†ï¼</figcaption>

</figure>

çœ‹èµ·æ¥æˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºç°æœ‰ç”¨æˆ·äº†ï¼è®©æˆ‘ä»¬å†æ·»åŠ ä¸€äº›è®°å½•ï¼Œä»¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸:

<figure>[![Connect Flask to a Database with Flask-SQLAlchemy](../Images/f551efcf1ddc00635309ebfdf4187cb1.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--iwc7JdZT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://res-1.cloudinary.com/hackers-and-slackers/image/upload/f_auto%2Cq_auto/v1/images/Screen-Shot-2019-02-06-at-12.39.07-AM.png) 

<figcaption>æˆ‘å°±ä¸ä¿¡è¿™ä¸æ˜¯é”™è¯¯ä¿¡æ¯ã€‚</figcaption>

**T8ã€‘**</figure>

 **### [](#here-take-all-my-stuff)æ¥ï¼ŒæŠŠæˆ‘çš„ä¸œè¥¿éƒ½æ‹¿èµ°

ä¸€æ—¦ä½ å¼€å§‹ï¼ŒFlask-SQLAlchemy æ˜¯å¾ˆæ£’çš„ï¼Œä½†æ˜¯æ­£å¦‚æˆ‘ä»¬å·²ç»çœ‹åˆ°çš„,â€œè®¾ç½®â€å¹¶ä¸æ€»æ˜¯åœ¨å…¬å›­é‡Œæ•£æ­¥ã€‚è¿™æ˜¯é‚£äº›æ— è®ºä½ å‡­è®°å¿†åšäº†å¤šå°‘æ¬¡ä¼¼ä¹æ€»æ˜¯é”™çš„äº‹æƒ…ä¹‹ä¸€ã€‚

ä½œä¸ºä¸´åˆ«ç¤¼ç‰©ï¼Œæˆ‘æŠŠè¿™ä¸ªæ•™ç¨‹çš„æºä»£ç æ”¾åˆ°äº† Github ä¸Šï¼Œä¾›ä½ çè—å’Œæ¬£èµã€‚ä¸ï¼Œè¯´çœŸçš„ï¼Œæ‹¿ç€ã€‚æŠŠå®ƒæ‹¿èµ°ã€‚æˆ‘ä»Šå¤©ä¸å–çƒ§ç“¶äº†ã€‚æˆ‘éœ€è¦å»æ‰“ç«ç®­è”èµ›ã€‚

**PS:åœ¨ PSN ä¸ŠåŠ æˆ‘**

## ![GitHub logo](../Images/75095a8afc1e0f207cda715962e75c8d.png)/[çƒ§ç“¶-sqlalchemy-æ•™ç¨‹](https://github.com/hackersandslackers/flask-sqlalchemy-tutorial)

### ğŸâ„¹ï¸é€šè¿‡ä¸€ä¸ª SQL æ•°æ®åº“åœ¨ä½ çš„ Flask åº”ç”¨ç¨‹åºä¸­åˆ›å»ºå’Œç®¡ç†æ•°æ®ã€‚

<article class="markdown-body entry-content container-lg" itemprop="text">

# çƒ§ç“¶-åŒ–å­¦æ•™ç¨‹

[![Python](../Images/91eac0264bc3c2568bdd56361da1d1ae.png)](https://camo.githubusercontent.com/0b153563dd844ea8bbae9bf9d219c0d9930aa35e7d2ed0e07638a2caa3745902/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f507974686f6e2d76253545332e382d626c75652e7376673f6c6f676f3d707974686f6e266c6f6e6743616368653d74727565266c6f676f436f6c6f723d776869746526636f6c6f72423d356538316163267374796c653d666c61742d73717561726526636f6c6f72413d346335363661)[![Flask](../Images/c488dcbd4bdf0afa3aa18515e5c7b32c.png)](https://camo.githubusercontent.com/f084d311ceb36b7defc164ff0bdeac736439789c62fd77f1c595eea119f9c51f/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f466c61736b2d76322e312e312d626c75652e7376673f6c6f6e6743616368653d74727565266c6f676f3d666c61736b267374796c653d666c61742d737175617265266c6f676f436f6c6f723d776869746526636f6c6f72423d35653831616326636f6c6f72413d346335363661)[![Flask-SQLAlchemy](../Images/dd06be317b07dc2ff48e28fbfc160a71.png)](https://camo.githubusercontent.com/90c3bef49f922816be917d5b8f9ceb4b35f2d2e879127d19edea8c60a903aea5/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f466c61736b2d2d53514c416c6368656d792d322e352e312d7265642e7376673f6c6f6e6743616368653d74727565267374796c653d666c61742d737175617265266c6f676f3d666c61736b266c6f676f436f6c6f723d776869746526636f6c6f72413d34633536366126636f6c6f72423d356538316163)[![GitHub Last Commit](../Images/ee0945856a39b3a04347e6b66485ab1c.png)](https://camo.githubusercontent.com/0335ba6462162e24c13d82040759cb5fa55a13e5ce2841406e62e5f052bdfff0/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6173742d636f6d6d69742f676f6f676c652f736b69612e7376673f7374796c653d666c61742d73717561726526636f6c6f72413d34633536366126636f6c6f72423d613362653863)[![GitHub Issues](../Images/a9bb83288c57b59cdf273d766f4cf674.png)](https://github.com/hackersandslackers/flask-sqlalchemy-tutorial/issues)[![GitHub Stars](../Images/c135ed3fffa1e0b674c95d85354d8624.png)](https://github.com/hackersandslackers/flask-sqlalchemy-tutorial/stargazers)[![GitHub Forks](../Images/bc0d81c1f7fa4dfc3af525447051fca6.png)](https://github.com/hackersandslackers/flask-sqlalchemy-tutorial/network)

[![Flask-SQLAlchemy Tutorial](../Images/07e8719c2041912075aab2d18e3fccbb.png)T2ã€‘](https://github.com/hackersandslackers/flask-sqlalchemy-tutorial/blob/master/.github/flask-sqlachemy@2x.jpg?raw=true)

ä½¿ç”¨ Flask-SQLAlchemy å°† Flask åº”ç”¨ç¨‹åºè¿æ¥åˆ°æ•°æ®åº“ã€‚

*   **æ•™ç¨‹**:[https://hackersandslackers . com/manage-database-models-with-flask-sqlalchemy/](https://hackersandslackers.com/manage-database-models-with-flask-sqlalchemy/)

*   **æ¼”ç¤º**:[https://flasksqlanche . hackersandslackers . app](https://flasksqlalchemy.hackersandslackers.app)

# å…¥é—¨æŒ‡å—

åˆ†ä¸¤æ­¥åœ¨æœ¬åœ°è¿›è¡Œè®¾ç½®:

### ç¯å¢ƒå˜é‡

ç”¨æ‚¨çš„å€¼æ›¿æ¢ **.env.example** ä¸­çš„å€¼ï¼Œå¹¶å°†è¯¥æ–‡ä»¶é‡å‘½åä¸º**ã€‚ç¯å¢ƒ**:

*   `FLASK_APP`:æ‚¨çš„åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼›åº”è¯¥æ˜¯`wsgi.py`ã€‚
*   è¿è¡Œåº”ç”¨ç¨‹åºçš„ç¯å¢ƒï¼›ä¸æ˜¯`development`å°±æ˜¯`production`ã€‚
*   `SECRET_KEY`:éšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼Œç”¨äºåŠ å¯†åº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚
*   `SQLALCHEMY_DATABASE_URI` : SQLAlchemy è¿æ¥ URI åˆ°ä¸€ä¸ª SQL æ•°æ®åº“ã€‚

è®°ä½æ°¸è¿œä¸è¦æäº¤ä¿å­˜åœ¨ã€‚Github çš„ env æ–‡ä»¶ã€‚

### è£…ç½®

ä½¿ç”¨`make deploy`å¼€å§‹è¿è¡Œ:

```
$ git clone https://github.com/hackersandslackers/flask-sqlalchemy-tutorial.git
$ cd flask-sqlalchemy-tutorial
$ make deploy
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

**é»‘å®¢å’Œæ‡’é¬¼**æ•™ç¨‹å…è´¹ã€‚å¦‚æœä½ è§‰å¾—è¿™ä¸ªæ•™ç¨‹æœ‰å¸®åŠ©ï¼Œä¸€ä¸ª[çš„å°é¢æèµ ](https://www.buymeacoffee.com/hackersslackers)å°†ä¼šéå¸¸æ„Ÿè°¢ï¼Œè®©æˆ‘ä»¬ç»§ç»­åšç”Ÿæ„ã€‚æ‰€æœ‰æ”¶ç›Šå½’â€¦

</article>

[View on GitHub](https://github.com/hackersandslackers/flask-sqlalchemy-tutorial)**