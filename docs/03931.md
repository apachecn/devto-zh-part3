# ä½¿ç”¨ Django å’Œ React çš„ Python èŠå¤©æ•™ç¨‹

> åŸæ–‡:[https://dev . to/nick Parsons/tutorial-chat-with-python-django-and-react-1 cpk](https://dev.to/nickparsons/tutorial-chat-with-python-django-and-react-1cpk)

æœ¬æ•™ç¨‹å°†è§£é‡Šå¦‚ä½•ç”¨ Pythonã€Django å’Œ React æ„å»ºä¸€ä¸ªèŠå¤©åº”ç”¨ç¨‹åºã€‚

ä¸å…¶ä»–æ•™ç¨‹ä¸åŒï¼Œæˆ‘æ²¡æœ‰ä½¿ç”¨ Python/Django è¿›è¡Œ WebSocket è¿æ¥ã€‚è™½ç„¶ä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œè¿™æ ·åšä¼¼ä¹å¾ˆé…·ï¼Œä½†å®ƒç›¸å½“ç¼“æ…¢ä¸”æ˜‚è´µâ€”â€”å°¤å…¶æ˜¯å¦‚æœä½ æœ‰ç›¸å½“æ•°é‡çš„ç”¨æˆ·ã€‚C++ã€Goã€Elixir ç­‰è¯­è¨€åœ¨å¤„ç†èŠå¤©è¿™ä¸ªæ ¸å¿ƒæ–¹é¢è¦å¥½å¾—å¤šã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Streamï¼Œä¸€ä¸ªç”¨äº chat çš„ [APIï¼Œå®ƒä½¿ç”¨ Goã€Raft å’Œ RocksDB æ¥å¤„ç† WebSocket è¿æ¥å’Œå…¶ä»–ç¹é‡çš„å·¥ä½œã€‚](https://getstream.io/chat/?ref=dev.to)

**ç›®å½•**:

1.  [React èŠå¤©æ¼”ç¤º UI](#step-1)
2.  [Django/Python è®¾ç½®](#step-2)
3.  [ç”¨æˆ·æˆæƒ](#step-3)
4.  [Django Rest æ¡†æ¶](#step-4)
5.  [ç”Ÿæˆä»¤ç‰Œä»¥è®¿é—® Stream çš„èŠå¤©æœåŠ¡å™¨](#step-5)
6.  [åœ¨ååº”ä¸­æ•´åˆæˆæƒ](#step-6)
7.  [ä» Python æœåŠ¡å™¨å‘é€æ¶ˆæ¯](#step-7)
8.  [æœ€ç»ˆæƒ³æ³•](#final-thoughts)

> *ä»¥ä¸‹ä»£ç çš„ GitHub repo å¯ä»¥åœ¨[https://github.com/GetStream/python-chat-example](https://github.com/GetStream/python-chat-example)æ‰¾åˆ°ã€‚*

æˆ‘ä»¬æ¥ç¼–ç å§ï¼ğŸ¤“

## [](#step-1-react-chat-demo-ui)æ­¥éª¤ 1â€“React èŠå¤©æ¼”ç¤ºç•Œé¢

åœ¨æˆ‘ä»¬å¼€å§‹è€ƒè™‘ Python èŠå¤©æ–¹é¢çš„äº‹æƒ…ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„ React å‰ç«¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰äº†ä¸€äº›å¥½çœ‹çš„è§†è§‰æ•ˆæœ:

```
$ yarn global add create-react-app
$ brew install node && brew install yarn # skip if installed
$ create-react-app chat-frontend
$ cd chat-frontend
$ yarn add stream-chat-react 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°†`src/App.js`ä¸­çš„ä»£ç æ›¿æ¢ä¸º:

```
import React from "react";
import {
  Chat,
  Channel,
  ChannelHeader,
  Thread,
  Window
} from "stream-chat-react";
import { MessageList, MessageInput } from "stream-chat-react";
import { StreamChat } from "stream-chat";

import "stream-chat-react/dist/css/index.css";

const chatClient = new StreamChat("qk4nn7rpcn75"); // Demo Stream Key
const userToken =
  "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiY29vbC1za3ktOSJ9.mhikC6HPqPKoCP4aHHfuH9dFgPQ2Fth5QoRAfolJjC4"; // Demo Stream Token

chatClient.setUser(
  {
    id: "cool-sky-9",
    name: "Cool sky",
    image: "https://getstream.io/random_svg/?id=cool-sky-9&name=Cool+sky"
  },
  userToken
);

const channel = chatClient.channel("messaging", "godevs", {
  // image and name are required, however, you can add custom fields
  image:
    "https://cdn.chrisshort.net/testing-certificate-chains-in-go/GOPHER_MIC_DROP.png",
  name: "Talk about Go"
});

const App = () => (
  <Chat client={chatClient} theme={"messaging light"}>
    <Channel channel={channel}>
      <Window>
        <ChannelHeader />
        <MessageList />
        <MessageInput />
      </Window>
      <Thread />
    </Channel>
  </Chat> );

export default App; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œè¿è¡Œ`yarn start`æ¥æŸ¥çœ‹èŠå¤©çš„è¿è¡Œæƒ…å†µï¼

## [](#step-2-djangopython-setup-skip-if-you-already-have-it)ç¬¬ 2 æ­¥- Django/Python è®¾ç½®(å¦‚æœå·²ç»æœ‰ï¼Œè·³è¿‡)

ç¡®ä¿æ‚¨å·²ç»å¯åŠ¨å¹¶è¿è¡Œäº† Python 3.7ã€‚

```
$ brew install python3

$ pip install virtualenv virtualenvwrapper
$ export WORKON_HOME=~/Envs
$ source /usr/local/bin/virtualenvwrapper.sh
$ mkvirtualenv chatexample -p `which python3`
$ workon chatexample 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœè¿™ä¸èµ·ä½œç”¨ï¼Œè¯·å°è¯•ä¸‹é¢çš„ä»£ç ç‰‡æ®µ:

```
$ python3 -m venv chatexample
$ source chatexample/bin/activate 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ä½ å·²ç»åœ¨ä½ çš„è™šæ‹Ÿç¯å¢ƒä¸­äº†ï¼Œä½ åº”è¯¥åœ¨è¿è¡Œæ—¶çœ‹åˆ° python 3:

```
$ python --version 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¦å¼€å§‹ä¸€ä¸ªæ–°çš„ Django é¡¹ç›®ï¼Œä½¿ç”¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µ:

```
$ pip install django
$ django-admin startproject mychat 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯åŠ¨ä½ çš„åº”ç”¨:

```
$ cd mychat
$ python manage.py runserver 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå½“ä½ æ‰“å¼€`http://localhost:8000`ï¼Œä½ åº”è¯¥çœ‹åˆ°è¿™ä¸ª:

[![Django](../Images/a35cfa9f02697bf0ba377d88cfb672aa.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--j-tGDVVl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/74B13x3.png)

## [](#step-3-user-auth)ç¬¬ä¸‰æ­¥-ç”¨æˆ·è®¤è¯

ä¸‹ä¸€æ­¥ï¼Œè®©æˆ‘ä»¬è®¾ç½® Django çš„ç”¨æˆ·æˆæƒã€‚

```
$ python manage.py migrate
$ python manage.py createsuperuser
$ python manage.py runserver 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®¿é—®`http://localhost:8000/admin/`å¹¶ç™»å½•ã€‚ç§å•Šã€‚

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ Django ç®¡ç†å±å¹•:

[![Django Admin](../Images/315726181e07198c2826a46fd43f0e59.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--3FcXgI4s--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/4S1RUlg.png)

## [](#step-4-django-rest-framework)æ­¥éª¤ 4 - Django Rest æ¡†æ¶

æˆ‘æœ€å–œæ¬¢çš„é›†æˆ react å’Œ Django çš„åŒ…ä¹‹ä¸€æ˜¯ Django Rest Frameworkã€‚ä¸ºäº†è®©ä¸€åˆ‡æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ä¸ºä»¥ä¸‹å„é¡¹åˆ›å»ºç«¯ç‚¹:

*   ç”¨æˆ·æ³¨å†Œ
*   ç”¨æˆ·ç™»å½•

æˆ‘ä»¬å¯ä»¥è‡ªå·±å»ºé€ ã€‚ä¸è¿‡æœ‰ä¸€ä¸ªå« [Djoser](https://github.com/sunscrapers/djoser) çš„åŒ…å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å®ƒä¸ºç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€å¯†ç é‡ç½®ç­‰é…ç½®äº†å¿…è¦çš„ API ç«¯ç‚¹ã€‚

è¦å®‰è£… Djoserï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µ:

```
$ pip install djangorestframework djoser 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åï¼Œç¼–è¾‘`urls.py`å¹¶å°†æ–‡ä»¶æ›´æ”¹ä¸ºåŒ…å«:

```
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('auth/', include('djoser.urls')),
    path('auth/', include('djoser.urls.authtoken')),
] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®Œæˆåï¼Œç¼–è¾‘`settings.py`å¹¶è¿›è¡Œä»¥ä¸‹æ›´æ”¹:

```
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'rest_framework.authtoken',
    'djoser',
]

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework.authentication.TokenAuthentication',
    )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å…³äº Djoser å…¬å¼€çš„ API ç«¯ç‚¹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·çœ‹è¿™é‡Œ:
[https://djoser.readthedocs.io/en/latest/sample_usage.html](https://djoser.readthedocs.io/en/latest/sample_usage.html)

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­æµ‹è¯•æ³¨å†Œç«¯ç‚¹:

```
$ curl -X POST http://127.0.0.1:8000/auth/users/ --data 'username=djoser&password=alpine12' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#step-5-generating-tokens-to-access-streams-chat-server)æ­¥éª¤ 5 -ç”Ÿæˆä»¤ç‰Œä»¥è®¿é—® Stream çš„èŠå¤©æœåŠ¡å™¨

ç°åœ¨æˆ‘ä»¬éœ€è¦å®šåˆ¶ Djoser è§†å›¾æ¥ä¸º Stream ç”Ÿæˆä»¤ç‰Œã€‚è®©æˆ‘ä»¬å¼€å§‹å§ã€‚

è®©æˆ‘ä»¬ç»„ç»‡ä¸€ä¸‹æˆ‘ä»¬çš„æ–‡ä»¶ï¼Œåœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªèŠå¤©åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹(ç¡®ä¿ä½ åœ¨æ­£ç¡®çš„ç›®å½•ä¸­):

```
$ python manage.py startapp auth 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®‰è£…æµèŠå¤©:

```
$ pip install stream-chat 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½¿ç”¨ä»¥ä¸‹é€»è¾‘åœ¨`auth/serializers.py`ä¸­åˆ›å»ºä¸€ä¸ªå®šåˆ¶çš„åºåˆ—åŒ–ç¨‹åº:

```
from djoser.serializers import TokenSerializer
from rest_framework import serializers
from djoser.conf import settings as djoser_settings
from stream_chat import StreamChat
from django.conf import settings

class StreamTokenSerializer(TokenSerializer):
    stream_token = serializers.SerializerMethodField()

    class Meta:
        model = djoser_settings.TOKEN_MODEL
        fields = ('auth_token','stream_token')

    def get_stream_token(self, obj):
        client = StreamChat(api_key=settings.STREAM_API_KEY, api_secret=settings.STREAM_API_SECRET)
        token = client.create_token(obj.user.id)

        return token 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œé€šè¿‡æ›´æ–°æ‚¨çš„`settings.py`æ–‡ä»¶:
æ¥ä½¿ç”¨å®šåˆ¶åºåˆ—åŒ–ç¨‹åº

```
STREAM_API_KEY = YOUR_STREAM_API_KEY # https://getstream.io/dashboard/ STREAM_API_SECRET = YOUR_STREAM_API_SECRET
DJOSER = {
    'SERIALIZERS': {
        'token': 'auth.serializers.StreamTokenSerializer',
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é‡æ–°è¿è¡Œæ‚¨çš„è¿ç§»:

```
$ python manage.py migrate 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†éªŒè¯å®ƒæ˜¯å¦å·¥ä½œï¼Œç”¨ POST è¯·æ±‚ç‚¹å‡»ç™»å½•ç«¯ç‚¹:

```
$ curl -X POST http://127.0.0.1:8000/auth/token/login/ --data 'username=djoser&password=alpine12' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`auth_token`å’Œ`stream_token`éƒ½åº”è¯¥è¢«è¿”å›ã€‚

## [](#step-6-integrating-auth-in-react)æ­¥éª¤ 6 -åœ¨ React ä¸­é›†æˆ Auth

å‡ºäºæ˜¾è€Œæ˜“è§çš„åŸå› ï¼Œç¨åå‘å‰ç«¯æ·»åŠ  auth æ˜¯ä¸€ä¸ªå¿…è¦çš„æ­¥éª¤ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä»åç«¯ API(ç”± Python æ”¯æŒ)è·å–ä¸€ä¸ªç”¨æˆ·ä»¤ç‰Œï¼Œå¹¶åœ¨å‘é€æ¶ˆæ¯æ—¶åŠ¨æ€åœ°ä½¿ç”¨å®ƒã€‚

é¦–å…ˆï¼Œä¸º Django å®‰è£… CORS ä¸­é—´ä»¶åŒ…:

```
$ pip install django-cors-headers 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åï¼Œä¿®æ”¹æ‚¨çš„`settings.py`æ¥å¼•ç”¨`djors-cors-header`ä¸­é—´ä»¶:

```
INSTALLED_APPS = (
    ...
    'corsheaders',
    ...
)

MIDDLEWARE = [
    ...
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.common.CommonMiddleware',
    ...
] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œå°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ‚¨çš„`settings.py`æ–‡ä»¶ä¸­:

```
CORS_ORIGIN_ALLOW_ALL = True 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸‹ä¸€æ­¥éœ€è¦å¯¹æ‚¨çš„å‰ç«¯è¿›è¡Œä¸€äº›ä¿®æ”¹ã€‚é¦–å…ˆï¼Œæ‚¨éœ€è¦ç¡®ä¿é€šè¿‡ yarn å®‰è£…äº†æ‰€æœ‰çš„ä¾èµ–é¡¹:

```
$ yarn add axios react-dom react-router-dom 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œåœ¨æ‚¨çš„`src/`ç›®å½•ä¸­åˆ›å»ºä»¥ä¸‹æ–‡ä»¶:

*   authenticate . js
*   un delegate route . js
*   withSession.js
*   Login.js
*   èŠå¤©. js

**app . js**T2ã€‘

```
import React from "react";
import { BrowserRouter as Router, Switch } from "react-router-dom";

import Chat from "./Chat";
import Login from "./Login";

import UnauthedRoute from "./UnauthedRoute";
import AuthedRoute from "./AuthedRoute";

const App = () => (
  <Router>
    <Switch>
      <UnauthedRoute path="/auth/login" component={Login} />
      <AuthedRoute path="/" component={Chat} />
    </Switch>
  </Router> );

export default App; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**authenticate route . js**

```
import React from "react";
import { Redirect, Route } from "react-router-dom";

const AuthedRoute = ({ component: Component, loading, ...rest }) => {
  const isAuthed = Boolean(localStorage.getItem("token"));
  return (
    <Route
      {...rest}
      render={props =>
        loading ? (
          <p>Loading...</p>
        ) : isAuthed ? (
          <Component history={props.history} {...rest} />
        ) : (
          <Redirect
            to={{
              pathname: "/auth/login",
              state: { next: props.location }
            }}
          />
        )
      }
    />
  );
};

export default AuthedRoute; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**un ded route . js**

```
import React from "react";
import { Redirect, Route } from "react-router-dom";

const AuthedRoute = ({ component: Component, loading, ...rest }) => {
  const isAuthed = Boolean(localStorage.getItem("token"));
  return (
    <Route
      {...rest}
      render={props =>
        loading ? (
          <p>Loading...</p>
        ) : !isAuthed ? (
          <Component history={props.history} {...rest} />
        ) : (
          <Redirect
            to={{
              pathname: "/"
            }}
          />
        )
      }
    />
  );
};

export default AuthedRoute; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**withSession.js**

```
import React from "react";
import { withRouter } from "react-router";

export default (Component, unAuthed = false) => {
  const WithSession = ({ user = {}, streamToken, ...props }) =>
    user.id || unAuthed ? (
      <Component
        userId={user.id}
        user={user}
        session={window.streamSession}
        {...props}
      />
    ) : (
      <Component {...props} />
    );

  return withRouter(WithSession);
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**Login.js**

```
import React, { Component } from "react";
import axios from "axios";

class Login extends Component {
  constructor(props) {
    super(props);

    this.state = {
      loading: false,
      email: "",
      password: ""
    };

    this.initStream = this.initStream.bind(this);
  }

  async initStream() {
    await this.setState({
      loading: true
    });

    const base = "http://localhost:8000";

    const formData = new FormData();
    formData.set("username", this.state.email);
    formData.set("password", this.state.password);

    const registration = await axios({
      method: "POST",
      url: `${base}/auth/users/`,
      data: formData,
      config: {
        headers: { "Content-Type": "multipart/form-data" }
      }
    });

    const authorization = await axios({
      method: "POST",
      url: `${base}/auth/token/login/`,
      data: formData,
      config: {
        headers: { "Content-Type": "multipart/form-data" }
      }
    });

    localStorage.setItem("token", authorization.data.stream_token);

    await this.setState({
      loading: false
    });

    this.props.history.push("/");
  }

  handleChange = e => {
    this.setState({
      [e.target.name]: e.target.value
    });
  };

  render() {
    return (
      <div className="login-root">
        <div className="login-card">
          <h4>Login</h4>
          <input
            type="text"
            placeholder="Email"
            name="email"
            onChange={e => this.handleChange(e)}
          />
          <input
            type="password"
            placeholder="Password"
            name="password"
            onChange={e => this.handleChange(e)}
          />
          <button onClick={this.initStream}>Submit</button>
        </div>
      </div>
    );
  }
}

export default Login; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**Chat.js**

```
import React, { Component } from "react";
import {
  Chat,
  Channel,
  ChannelHeader,
  Thread,
  Window
} from "stream-chat-react";
import { MessageList, MessageInput } from "stream-chat-react";
import { StreamChat } from "stream-chat";

import "stream-chat-react/dist/css/index.css";

class App extends Component {
  constructor(props) {
    super(props);
    this.client = new StreamChat("<YOUR_STREAM_APP_ID>");

    this.client.setUser(
      {
        id: "cool-sky-9",
        name: "Cool Sky",
        image: "https://getstream.io/random_svg/?id=cool-sky-9&name=Cool+sky"
      },
      localStorage.getItem("token")
    );

    this.channel = this.client.channel("messaging", "godevs", {
      image:
        "https://cdn.chrisshort.net/testing-certificate-chains-in-go/GOPHER_MIC_DROP.png",
      name: "Talk about Go"
    });
  }

  render() {
    return (
      <Chat client={this.client} theme={"messaging light"}>
        <Channel channel={this.channel}>
          <Window>
            <ChannelHeader />
            <MessageList />
            <MessageInput />
          </Window>
          <Thread />
        </Channel>
      </Chat>
    );
  }
}

export default App; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·åŠ¡å¿…å°†`YOUR_STREAM_APP_ID`æ›¿æ¢ä¸ºæœ‰æ•ˆçš„æµåº”ç”¨ idï¼Œè¯¥ ID å¯åœ¨[ä»ªè¡¨ç›˜](https://getstream.io/dashboard/?ref=dev.to)ä¸Šæ‰¾åˆ°ã€‚

é‡å¯ä½ çš„å‰ç«¯åº”ç”¨ç¨‹åºï¼Œä½ åº”è¯¥ä¼šé‡åˆ°ä¸€ä¸ªæˆæƒå¢™ï¼è¾“å…¥æ‚¨çš„ç”µå­é‚®ä»¶å’Œå¯†ç ï¼Œå°†è¯·æ±‚ä¸€ä¸ªä»¤ç‰Œå¹¶å­˜å‚¨åœ¨æœ¬åœ°å­˜å‚¨ä¸­ã€‚

## [](#step-7-sending-a-message-from-the-python-chat-server)æ­¥éª¤ 7 -ä» Python èŠå¤©æœåŠ¡å™¨å‘é€æ¶ˆæ¯

æœ‰æ—¶å€™ï¼Œæ‚¨ä¼šå¸Œæœ›ä½¿ç”¨æ‚¨çš„åŸºäº Python çš„åç«¯æœåŠ¡å™¨æ¥ç¼–å†™èŠå¤© APIã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæ‚¨å¯ä»¥ä½¿ç”¨çš„å¿«é€Ÿç®¡ç†å‘½ä»¤:

åœ¨`settings.py` :
ä¸­éªŒè¯å·²å®‰è£…çš„åº”ç”¨ç¨‹åºå¦‚ä¸‹æ‰€ç¤º

```
INSTALLED_APPS = [
    'corsheaders',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'rest_framework.authtoken',
    'djoser',
] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œåˆ›å»ºç›®å½•`chat/management/commands`ã€‚åœ¨è¯¥ç›®å½•ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªåä¸º`broadcast.py`çš„æ–‡ä»¶ï¼Œå…¶å†…å®¹ä¸º:

```
from django.core.management.base import BaseCommand, CommandError
from django.conf import settings
from stream_chat import StreamChat

class Command(BaseCommand):
    help = 'Broadcast the message on your channel'

    def add_arguments(self, parser):
        parser.add_argument('--message')

    def handle(self, *args, **options):
        client = StreamChat(api_key=settings.STREAM_API_KEY, api_secret=settings.STREAM_API_SECRET)
        client.update_user({"id": "system", "name": "The Server"})
        channel = client.channel("messaging", "kung-fu")
        channel.create("system")
        response = channel.send_message({"text": "AMA about kung-fu"}, 'system')
        self.stdout.write(self.style.SUCCESS('Successfully posted a message with id "%s"' % response['message']['id'])) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨å¯ä»¥å°è¯•å‘èŠå¤©å®¤å‘å¸ƒè¿™æ ·çš„æ¶ˆæ¯:

```
$ python manage.py broadcast --message hello 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°è¿™æ ·çš„å“åº”:

[![Broadcast](../Images/7cf6af4c4732b42b428d6c324c645dd1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--bEK7ijqA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/cR7240Q.png)

## [](#final-thoughts)æœ€åçš„æƒ³æ³•

æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡ç”¨ Djangoã€Python å’Œ React æ„å»ºèŠå¤©åº”ç”¨ç¨‹åºçš„æ•™ç¨‹ï¼

å…³äº[æµèŠå¤©](https://getstream.io/chat/?ref=dev.to)çš„äº’åŠ¨ä¹‹æ—…ï¼Œè¯·çœ‹çœ‹æˆ‘ä»¬åœ¨æµç½‘ç«™ä¸Šçš„ [API æ•™ç¨‹](https://getstream.io/chat/get_started/?ref=dev.to)ã€‚å¦‚æœä½ æœ‰å…´è¶£æ·±å…¥ç ”ç©¶æµèŠå¤©ååº”ç»„ä»¶çš„ä»£ç ï¼Œ[å®Œæ•´çš„æ–‡æ¡£å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°](https://getstream.github.io/stream-chat-react/)ã€‚å¦‚æœæ‚¨å¯¹åœ¨ Stream ä¸Šæ„å»ºèŠå¤©æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬ä¸ºæµè¡Œçš„è¯­è¨€å’Œæ¡†æ¶æä¾›äº†å„ç§[SDK](https://github.com/GetStream/stream-sdks)ï¼Œæˆ‘ä»¬æœ€æ–°çš„æ˜¯ [iOS (Swift)](https://getstream.io/tutorials/ios-chat/) ã€‚

ç¼–ç å¿«ä¹ï¼âœŒ