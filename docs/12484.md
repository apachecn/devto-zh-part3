# ä¸Šä¼ è§†é¢‘æ—¶å¦‚ä½•åˆ›å»ºç¼©ç•¥å›¾ï¼Ÿaws lambdaï¼

> åŸæ–‡:[https://dev . to/benjaminadk/how-do-I-create-thumbnails-when-I-upload-a-video-AWS-lambda-7l 4](https://dev.to/benjaminadk/how-do-i-create-thumbnails-when-i-upload-a-video-aws-lambda-7l4)

å¥½é—®é¢˜ã€‚ğŸ¤”

## [](#introduction)ç®€ä»‹

æˆ‘ä¸€ç›´åœ¨ç©ä¸€ä¸ªè¢«æˆ‘ç§°ä¸º**è§†é¢‘çŸ­ç‰‡**çš„ **YouTube** å…‹éš†ç‰ˆã€‚æˆ‘å·²ç»è®¾ç½®äº†è§†é¢‘ä¸Šä¼ ä»æµè§ˆå™¨å‘é€åˆ° [AWS S3](https://docs.aws.amazon.com/s3/index.html#lang/en_us) æ¡¶ï¼Œæ‰€ä»¥è§†é¢‘æ–‡ä»¶æ²¡æœ‰è§¦åŠæˆ‘çš„èŠ‚ç‚¹åç«¯ï¼Œè¿™ä½¿å¾—æœåŠ¡å™¨ç«¯çš„è§†é¢‘å¤„ç†æ— æ³•å¯åŠ¨ã€‚è¿™è®©æˆ‘è¿›é€€ä¸¤éš¾ï¼Œå› ä¸ºæˆ‘æƒ³ä¸ºæ¯ä¸ªè§†é¢‘ä¸Šä¼ ç”Ÿæˆ 3 ä¸ªç¼©ç•¥å›¾ï¼Œå°±åƒçœŸæ­£çš„ YouTube ä¸€æ ·ã€‚æˆ‘å¼€å§‹è€ƒè™‘åœ¨å±å¹•å¤–åˆ›å»ºä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ï¼Œå¹¶ä½¿ç”¨ canvas æ¥ä¼ è¾“å†…å®¹ã€‚è™½ç„¶è¿™æ˜¯å¯èƒ½çš„ï¼Œä½†å¬èµ·æ¥å¹¶ä¸æœ‰è¶£ï¼Œè¿™ä¹Ÿä¸æ˜¯æˆ‘æœ€ç»ˆè¦åšçš„ã€‚

[![thumbnails](../Images/21413d7d5a46fe7ea2963163a948c1b0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--z-HN_e_y--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/wi4bngn6jj38fc8e24f5.png)

ç ”ç©¶å¼€å§‹äº†ã€‚

æˆ‘å‘ç° **YouTube** ä½¿ç”¨æ·±åº¦ç¥ç»ç½‘ç»œæ¥æŒ‘é€‰æ˜¾ç¤ºä¸»é¢˜æˆ–é¢éƒ¨æˆ–å…¶ä»–å¸å¼•æ³¨æ„åŠ›çš„äº‹ç‰©çš„ç¼©ç•¥å›¾ã€‚ä»–ä»¬è¿˜æ•æ‰è§†é¢‘çš„æ¯ä¸€ç§’é’Ÿçš„ç¼©ç•¥å›¾ï¼Œå¹¶ä½¿ç”¨ä¸€ç§ç®—æ³•å¯¹æ¯ä¸€ä¸ªè¿›è¡Œæ’åºã€‚[YouTube åˆ›ä½œè€…å›¢é˜Ÿ 2015 å¹´æ’°å†™çš„è¿™ç¯‡æœ‰è¶£çš„æ–‡ç« è¿›ä¸€æ­¥è§£é‡Šäº†](https://ai.googleblog.com/2015/10/improving-youtube-video-thumbnails-with.html)ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘è®¤ä¸ºä»…ä»…å¾—åˆ° 3 å¼ ç¼©ç•¥å›¾å¯¹æˆ‘æ¥è¯´å°±è¶³å¤Ÿäº†â€”â€”å› ä¸ºæˆ‘ä»ç„¶ä¸çŸ¥é“æˆ‘åœ¨åšä»€ä¹ˆã€‚ğŸ¤¦â€â™‚ï¸

## [](#companion-video)åŒä¼´è§†é¢‘

[https://www.youtube.com/embed/0IGRynRhsRE](https://www.youtube.com/embed/0IGRynRhsRE)

## [](#disclaimer)å…è´£å£°æ˜

è¯·è®°ä½ï¼Œæ­¤ä»£ç å¹¶ä¸æ„å‘³ç€æ˜¯ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ›´å¤šçš„æ˜¯ä¸€ä¸ªæ¢ç´¢æˆ–æ¦‚å¿µè¯æ˜ã€‚æœ‰è®¸å¤šå¯ç§»åŠ¨çš„éƒ¨ä»¶ï¼Œè™½ç„¶æˆ‘å·²ç»è®¾æ³•åœ¨æˆ‘çš„æœ¬åœ°ç¯å¢ƒä¸­ä½¿ç”¨å®ƒï¼Œä½†æˆ‘ä¸èƒ½ä¿è¯å®ƒåœ¨å…¶ä»–åœ°æ–¹ä¹Ÿèƒ½å·¥ä½œï¼æŠ±æ­‰ã€‚

## Î»å‡½æ•°

æˆ‘å‘ç°çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ AWS Lambda æ¥å¤–åŒ…é€šå¸¸å¯èƒ½å‘ç”Ÿåœ¨æœåŠ¡å™¨ä¸Šçš„è®¡ç®—ã€‚ä½œä¸ºå¥–åŠ±ï¼Œå› ä¸ºæˆ‘å·²ç»åœ¨ä½¿ç”¨ **S3** ï¼Œæˆ‘å¯ä»¥é™„åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå½“æˆ‘ä¸Šä¼ è§†é¢‘æ–‡ä»¶æ—¶è§¦å‘æˆ‘çš„**Î»**å‡½æ•°ã€‚

åˆ›å»ºä¸€ä¸ªæ–°çš„ T2 å‡½æ•°å¾ˆç®€å•ã€‚å½“æç¤ºä½ æƒ³é€‰æ‹©*ä»å¤´åˆ›å»ºä¸€ä¸ªå‡½æ•°*å¹¶æƒ³å‡ºä¸€ä¸ªåƒæ ·çš„åå­—ï¼›ä¸ºæˆ‘å·¥ä½œã€‚åŒæ ·ï¼Œé€‰æ‹© **Node.js 8.10** è¿è¡Œæ—¶ã€‚

[![create function](../Images/92c84ece128c45f5827f55399323f3b0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--NP-Xb1zO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/nhwm0o9ckkp82ci23nez.png)

### [](#iam-role-permissions)IAM è§’è‰²æƒé™

æˆ‘å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„ **IAM** è§’è‰²æ¥æ‰§è¡Œè¿™ä¸ªåŠŸèƒ½ã€‚è¿™å¯ä»¥é€šè¿‡ [IAM æ§åˆ¶å°](https://console.aws.amazon.com/iam/home)ä¸­çš„ç®€å•å·¥ä½œæµç¨‹æ¥å®Œæˆã€‚ç»™è¿™ä¸ªè§’è‰²èµ·ä½ æƒ³è¦çš„åå­—ï¼Œä½†æ˜¯è¦ç»™å®ƒ`AWSLambdaExecute`æƒé™ã€‚è¿™å°†å…è®¸`PUT`å’Œ`GET`è®¿é—® **S3** å¹¶å®Œå…¨è®¿é—® **CloudWatch æ—¥å¿—**ã€‚è¿™äº›éƒ½æ˜¯æˆ‘ä»¬æ‰§è¡Œå’Œç›‘æ§æˆ‘ä»¬çš„`createThumbnail` **Lambda** å‡½æ•°æ‰€éœ€çš„æƒé™ã€‚æˆ‘å¿…é¡»å°†è¿™ä¸ªè§’è‰²çš„`arn`æ·»åŠ åˆ°æˆ‘çš„æ¡¶ç­–ç•¥ä¸­ã€‚

[![lambda role](../Images/3d83f95f2f517a3a0b70809d4182868b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--I_GTSwNB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/di2qepm8xnkylhu3xsd7.png)T3ã€‘

```
 {
            "Sid": "Stmt**************",
            "Effect": "Allow",
            "Principal": {
                "AWS": [
                    "arn:aws:iam::**********:role/LambdaRole"
                ]
            },
            "Action": [
                "s3:GetObject",
                "s3:PutObject"
            ],
            "Resource": "arn:aws:s3:::bucket/*"
        } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#triggers)è§¦å‘å™¨

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„å‡½æ•°é…ç½®è§¦å‘å™¨ã€‚æˆ‘ä»¬å¸Œæœ›ç›‘å¬ä¸Šä¼ è§†é¢‘çš„æ¡¶ï¼Œå¹¶è§‚å¯Ÿ`PUT`æ–¹æ³•ï¼Œå› ä¸ºè¿™æ˜¯ç”¨äºå‘é€è§†é¢‘çš„æ–¹æ³•ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥è®¾ç½®ä¸€ä¸ª`prefix`å’Œ/æˆ–`suffix`æ¥ç¼©å°è§¦å‘èŒƒå›´ã€‚æˆ‘çš„å‡½æ•°å°†ç¼©ç•¥å›¾ä¿å­˜åˆ°è¿™ä¸ªæ¡¶ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`mp4`çš„`suffix`æˆ–`webm`(è§†é¢‘æ ¼å¼)ã€‚æˆ‘çš„è§†é¢‘å°†è¢«æ”¾å…¥ç”¨æˆ·æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥æˆ‘è®¾ç½®äº†å‰ç¼€`user/`,å› ä¸ºè¿™å°†æ˜¯ä»»ä½•é”®çš„å¼€å¤´ã€‚

[![create trigger](../Images/bb3ecff73e97142c52dc123154a02d91.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--b3inUVhd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ydo15manffpueez4ocrp.png)

ä¸€æ—¦åˆ›å»ºäº†æ‚¨çš„å‡½æ•°å¹¶é…ç½®äº†å…¶è§¦å‘å™¨ï¼Œè¿™äº›è®¾ç½®å°†æ˜¾ç¤ºåœ¨æ‰€è¿°è§¦å‘å™¨å¼•ç”¨çš„ **S3** æ¡¶ä¸­ã€‚äº‹å®ä¸Šï¼Œä»–ä»¬å¯ä»¥ä» **S3** æˆ–**Î»**æ§åˆ¶å°è¿›è¡Œè®¾ç½®ã€‚ç‚¹å‡»`Properties`é€‰é¡¹å¡ï¼Œç„¶åç‚¹å‡» **S3** æ§åˆ¶å°ä¸­çš„`Events`æ¡†ï¼ŒæŸ¥çœ‹ä¸é“²æ–—ç›¸å…³çš„äº‹ä»¶ã€‚

[![bucket events](../Images/ea36a32472df43c838fd7337e2f695e5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--1mAbyrtT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zh1yqmcazh9kstwpvwri.png)

### [](#getting-code-to-lambda)è·å–Î»ä»£ç 

æœ‰å‡ ç§æ–¹æ³•å¯ä»¥è®©ä»£ç è¿›å…¥æˆ‘ä»¬çš„ **Lambda** å‡½æ•°ã€‚å¦‚æœä½ çš„è½¯ä»¶åŒ…å°äº 3MBï¼ŒAWS æä¾›åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ã€‚æ‚¨ä¹Ÿå¯ä»¥å°†ä¸€ä¸ª zip æ–‡ä»¶å½¢å¼çš„åŒ…ç›´æ¥ä¸Šä¼ åˆ° **Lambda** æˆ–ä¸Šä¼ ä¸€ä¸ª zip æ–‡ä»¶åˆ° **S3** ï¼Œç„¶åå°†å…¶é“¾æ¥åˆ°æ‚¨çš„å‡½æ•°ã€‚è¿™ç§ zip æ ¼å¼å…è®¸åœ¨æ‚¨çš„åŒ…ä¸­åŒ…å«å¤šä¸ªæ–‡ä»¶ï¼ŒåŒ…æ‹¬å…¸å‹çš„`node_modules`ä¾èµ–é¡¹ä»¥åŠå¯æ‰§è¡Œæ–‡ä»¶ã€‚

äº‹å®ä¸Šï¼Œæˆ‘ä»¬å°†åˆ©ç”¨å‡ ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ¥å¸®åŠ©å¤„ç†æˆ‘ä»¬çš„è§†é¢‘ã€‚`ffmpeg`æ˜¯ä¸€ä¸ªè½¬æ¢å¤šåª’ä½“æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œ`ffprobe`æ˜¯ä¸€ä¸ªæµåˆ†æå™¨ã€‚ä½ å¯ä»¥åœ¨æœ¬åœ°å®‰è£…è¿™äº›å·¥å…·ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦åœ¨ **Lambda** ä¸Šä½¿ç”¨é™æ€æ„å»ºã€‚[ä¸‹è½½é€‰æ‹©å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°](https://johnvansickle.com/ffmpeg/)ã€‚æˆ‘é€‰æ‹©äº†`https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz`ã€‚ä¸ºäº†è§£å‹å‹ç¼©çš„å†…å®¹ï¼Œæˆ‘ä½¿ç”¨äº† [7-Zip](https://www.7-zip.org/) ã€‚ä¸€æ—¦è§£å‹åï¼Œæˆ‘ä»¬è¦åˆ†ç¦»å‡ºæ–‡ä»¶`ffmpeg`å’Œ`ffprobe`ï¼Œè¯·çœ‹å›¾ã€‚

[![files we want](../Images/d1d7c204297ebefbdb3cb0e7d9d96802.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--6zL6vAv8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ubn937dc3vkx7arbr2ux.png)

è¯·æ³¨æ„ï¼Œç”¨æˆ·ã€ç»„å’Œå…¨å±€ç”¨æˆ·éƒ½å…·æœ‰è¯»/æ‰§è¡Œæƒé™ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ Windowsï¼Œä¿ç•™è¿™äº›æƒé™æ—¶é‡åˆ°äº†é—®é¢˜ã€‚ [Lambda æƒé™](https://docs.aws.amazon.com/lambda/latest/dg/deployment-package-v2.html#lambda-zip-package-permission-policies)æœ‰ç‚¹æ£˜æ‰‹ï¼Œå…¨å±€è¯»å–å¯¹æ‰€æœ‰æ–‡ä»¶éƒ½å¾ˆé‡è¦ã€‚åœ¨ **Windows** ä¸Šï¼Œå½“æˆ‘å°è¯•ä¸‹ä¸€æ­¥æ—¶ï¼Œé—®é¢˜å‡ºç°äº†ã€‚

ä¸ºäº†æŠŠæˆ‘ä»¬çš„å¯æ‰§è¡Œæ–‡ä»¶æ”¾åˆ°**Î»**ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æˆ‘ä»¬çš„`index.js`(å®é™…çš„å‡½æ•°è„šæœ¬)æŠŠå®ƒä»¬æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸­ï¼Œç„¶åå‹ç¼©å¹¶ä¸Šä¼ ã€‚è¿™æœ‰å‡ ä¸ªç¼ºç‚¹ã€‚åœ¨ **Windows** ä¸Šå‹ç¼©*ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ Windows èµ„æºç®¡ç†å™¨*åœ¨è¯•å›¾è°ƒç”¨å¯æ‰§è¡Œæ–‡ä»¶ my function æ—¶å‰¥å¤ºäº†æƒé™å¹¶å¯¼è‡´é”™è¯¯ã€‚æ­¤å¤–ï¼Œæ¯æ¬¡æˆ‘åœ¨æˆ‘çš„è„šæœ¬ä¸­åšäº†æ”¹å˜ï¼Œæˆ‘å¿…é¡»é‡æ–°ä¸Šä¼ ä¸€ä¸ª 40MB çš„æ–‡ä»¶ã€‚è¿™æ˜¯å¯æ€•çš„ç¼“æ…¢å’Œæ¶ˆè€—æ•°æ®ä¼ è¾“ä¿¡ç”¨ã€‚ä¸é€‚åˆå¼€å‘ï¼Œæ•°æ®ä¼ è¾“æˆæœ¬é«˜ğŸ’²ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä½¿ç”¨ä¸€ä¸ª`Lambda Layer`ã€‚

### Î»å±‚

ä¸€ä¸ª[Î»å±‚](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html)å¯ä»¥ä»¥åº“ã€å®šåˆ¶è¿è¡Œæ—¶æˆ–å…¶ä»–ä¾èµ–çš„å½¢å¼ä¿å­˜é¢å¤–çš„ä»£ç ã€‚ä¸€æ—¦æˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ª`Layer`,å®ƒå°±å¯ä»¥ç”¨äºå¤šç§åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥ç¼–è¾‘å’Œä¿å­˜ä¸ºå¤šç§ç‰ˆæœ¬ã€‚éå¸¸çµæ´»ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŠŠæˆ‘ä»¬çš„`ffmpeg`å’Œ`ffprobe`æ–‡ä»¶æ”¾åˆ°ä¸€ä¸ªåä¸º`nodejs`çš„æ–‡ä»¶å¤¹ä¸­â€”â€”è¿™ä¸ªåå­—å¾ˆé‡è¦ã€‚æˆ‘æœ€ç»ˆä½¿ç”¨äº†ã€Linux çš„ Windows å­ç³»ç»Ÿå’Œ`zip`å‘½ä»¤æ¥å‹ç¼©`nodejs`æ–‡ä»¶å¤¹ã€‚è¿™æ˜¯æˆ‘å‘ç°çš„ä¿ç•™é€‚å½“æƒé™çš„æœ€ç®€å•çš„æ–¹æ³•ã€‚

ä»æˆ‘ä»¬çš„`nodejs`æ–‡ä»¶å¤¹çš„çˆ¶ç›®å½•ä¸­ï¼Œæˆ‘è¿è¡Œ:

```
zip -r ./layer.zip nodejs 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`-r`æ˜¯é€’å½’åœ°å°†`nodejs`çš„å†…å®¹å‹ç¼©åˆ°ä¸€ä¸ªåä¸º`layer.zip`çš„æ–°æ–‡ä»¶ä¸­ã€‚

ä»**æ§åˆ¶å°ç‚¹å‡»`Layers`æ ‡ç­¾ï¼Œåˆ›å»ºä¸€ä¸ªæ–°å±‚ã€‚åˆ›å»º`Layer`æ—¶ï¼Œç¡®ä¿å°† **Node.js 8.10** è®¾ç½®ä¸ºå…¼å®¹çš„è¿è¡Œæ—¶ã€‚ç°åœ¨ä½ å¯ä»¥å›åˆ°åŠŸèƒ½é…ç½®ï¼ŒæŠŠæˆ‘ä»¬æ–°çš„`Layer`æ·»åŠ åˆ°`createThumbnail`ã€‚**

[![function config](../Images/64acf9466acae0436405d6ae319eb89a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Ktjq1fuN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9obj6e1yh0f5ea69rw9x.png)

æœ€åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä»£ç ã€‚ğŸ˜²

## [](#disclaimer)å…è´£å£°æ˜

å¦‚æœæœ‰äººåœ¨è¿™é‡Œçœ‹åˆ°ä»»ä½•å¯ä»¥æ›´å¥½çš„ä¸œè¥¿ï¼Œè¯·è¯„è®ºå¹¶è®©æˆ‘çŸ¥é“ã€‚æˆ‘èŠ±äº†ä¸€æ®µæ—¶é—´ä»ç½‘ç»œçš„å„ä¸ªè§’è½æ”¶é›†æ‰€æœ‰è¿™äº›æƒ³æ³•ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨ Lambdaã€‚æˆ‘è¦è¯´çš„æ˜¯æˆ‘ä¸æ˜¯ä¸“å®¶ï¼Œä½†æ˜¯åœ¨æˆ‘åˆšå¼€å§‹çš„æ—¶å€™æ‰¾åˆ°ä¸€ç¯‡è¿™æ ·çš„æ–‡ç« ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚

## [](#code)ä»£ç 

å› ä¸ºæˆ‘ä»¬èŠ±æ—¶é—´è®¾ç½®äº†ä¸€ä¸ªå±‚ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„ä»£ç æ²¡æœ‰å…¶ä»–ä¾èµ–é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ä»£ç ç›´æ¥è¾“å…¥åˆ°è¡Œå†…ç¼–è¾‘å™¨ä¸­ã€‚æˆ‘åœ¨`VSCode`ä¸­åˆ¶ä½œäº†æˆ‘çš„æœ¬åœ°å‰¯æœ¬ï¼Œåªæ˜¯ä¸ºäº†æœ‰ä¸€ä¸ªæˆ‘å–œæ¬¢çš„ç¼–è¾‘å™¨è®¾ç½®ï¼Œç„¶åå¤åˆ¶å¹¶ç²˜è´´ã€‚

é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€äº›æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ã€‚`aws-sdk`åœ¨ç¯å¢ƒä¸­å¯ç”¨ã€‚`child_process`å’Œ`fs`æ˜¯**èŠ‚ç‚¹**æ¨¡å—ã€‚

```
const AWS = require('aws-sdk')
const { spawnSync, spawn } = require('child_process')
const { createReadStream, createWriteStream } = require('fs') 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

`spawn`å’Œ`spawnSync`å°†å…è®¸æˆ‘ä»¬åœ¨èŠ‚ç‚¹ç¯å¢ƒä¸­ä½œä¸ºå­è¿›ç¨‹è¿è¡Œæˆ‘ä»¬çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

T4 ç¯å¢ƒæä¾›äº†ä¸€ä¸ªæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨çš„ç›®å½•ã€‚æˆ‘ä»¬å°†æŠŠå›¾åƒæ•°æ®ä»`ffmpeg`ä¼ è¾“åˆ°`/tmp`ï¼Œç„¶ååœ¨ä¸Šä¼ ç¼©ç•¥å›¾æ—¶ä»é‚£é‡Œè¯»å–ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€äº›æˆ‘ä»¬ä»¥åä¼šç”¨åˆ°çš„å˜é‡ã€‚

```
const s3 = new AWS.S3()
const ffprobePath = '/opt/nodejs/ffprobe'
const ffmpegPath = '/opt/nodejs/ffmpeg'
const allowedTypes = ['mov', 'mpg', 'mpeg', 'mp4', 'wmv', 'avi', 'webm']
const width = process.env.WIDTH
const height = process.env.HEIGHT 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬åˆ›å»ºäº†æˆ‘ä»¬çš„ **S3** å®ä¾‹æ¥ä¸æˆ‘ä»¬çš„æ¡¶è¿›è¡Œäº¤äº’ã€‚å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª`Layer`,æ‰€ä»¥æˆ‘ä»¬çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ä½äº`/opt/nodejs`ç›®å½•ä¸­ã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ç»„å…è®¸çš„ç±»å‹ã€‚`width`å’Œ`height`çš„è®¾ç½®å¯ä»¥ä» **Lambda æ§åˆ¶å°**è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚æˆ‘ç”¨çš„æ˜¯ 200x112ã€‚

[![env](../Images/1111245537c0d9bcbbaf81fe44c8d523.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--17-XcyMN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/xgiebwrn4kh1o8h67wu7.png)

æˆ‘ä»¬å®é™…çš„å‡½æ•°æ˜¯ç”¨æ ‡å‡†çš„**èŠ‚ç‚¹**æ ¼å¼ç¼–å†™çš„ï¼Œå¿…é¡»è¢«ç§°ä¸º`handler`ã€‚å¯ä»¥åœ¨æ§åˆ¶å°ä¸­è®¾ç½®è‡ªå®šä¹‰åç§°ã€‚

```
module.exports.handler = async (event, context) => {
  const srcKey = decodeURIComponent(event.Records[0].s3.object.key).replace(/\+/g, '  ')
  const bucket = event.Records[0].s3.bucket.name
  const target = s3.getSignedUrl('getObject', { Bucket: bucket, Key: srcKey, Expires: 1000 })
  let fileType = srcKey.match(/\.\w+$/)

  if (!fileType) {
    throw new Error(`invalid file type found for key: ${srcKey}`)
  }

  fileType = fileType[0].slice(1)

  if (allowedTypes.indexOf(fileType) === -1) {
    throw new Error(`filetype: ${fileType} is not an allowed type`)
  }

    // to be continued
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å°†åˆ›å»ºå‡½æ•°`async`,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸€ç§çœ‹èµ·æ¥åŒæ­¥çš„æ–¹å¼æ¥ç¼–å†™æˆ‘ä»¬çš„å¼‚æ­¥ä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è§£æä»**ä¼ å…¥çš„äº‹ä»¶ä¸­çš„`srcKey`ã€‚è¿™æ˜¯æˆ‘ä»¬çš„è§†é¢‘æ–‡ä»¶åï¼Œæ²¡æœ‰æ¡¶çš„ç½‘å€ã€‚æˆ‘ä»¬è¿˜æŠ“å–äº†æ¡¶åã€‚å¦‚æœæˆ‘ä»¬è®¾ç½®äº‹ä»¶ç›‘å¬å™¨ï¼Œä½¿æˆ‘ä»¬çš„å‡½æ•°åœ¨ä¸Šä¼ æ—¶ä¸ä¼šè§¦å‘ï¼Œæˆ‘ä»¬å¯ä»¥å°†å›¾åƒä¿å­˜åˆ°ä¸è§†é¢‘ç›¸åŒçš„æ¡¶ä¸­ã€‚ç„¶åæˆ‘ä»¬éš”ç¦»æ–‡ä»¶æ‰©å±•åï¼Œå¹¶åœ¨ç»§ç»­ä¹‹å‰è¿è¡Œä¸€äº›æ£€æŸ¥ä»¥ç¡®ä¿å®ƒæ˜¯æœ‰æ•ˆçš„ã€‚** 

```
// inside handler function

  const ffprobe = spawnSync(ffprobePath, [
    '-v',
    'error',
    '-show_entries',
    'format=duration',
    '-of',
    'default=nw=1:nk=1',
    target
  ])

  const duration = Math.ceil(ffprobe.stdout.toString()) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œæˆ‘ä»¬ç”¨`spawnSync`è¿è¡Œ`ffprobe`ï¼Œä»`stdout`è·å–è§†é¢‘çš„`duration`ã€‚ä½¿ç”¨`toString`ï¼Œå› ä¸ºè¾“å‡ºè¢«ç¼“å†²ã€‚é€šè¿‡æŒç»­æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•´ä¸ªè§†é¢‘ä¸­æœ‰é’ˆå¯¹æ€§åœ°æ•æ‰ç¼©ç•¥å›¾ã€‚æˆ‘è®¤ä¸ºä»¥ 25%ã€50%å’Œ 75%çš„æ¯”ä¾‹æ‹æ‘„ç¼©ç•¥å›¾æ˜¯è·å¾— 3 çš„åˆç†æ–¹å¼ã€‚å½“ç„¶ï¼Œä½¿ç”¨ä»¥ä¸‹åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦æ‹æ‘„ä»»æ„å¤šçš„ç¼©ç•¥å›¾ã€‚`ffprobe`ä¹Ÿå¯ä»¥æŠ¥å‘Šæ¯”æŒç»­æ—¶é—´æ›´å¤šçš„æ•°æ®ï¼Œä½†è¿™æ˜¯æˆ‘ä»¬æ‰€å…³å¿ƒçš„ã€‚

```
 function createImage(seek) {
    return new Promise((resolve, reject) => {
      let tmpFile = createWriteStream(`/tmp/screenshot.jpg`)
      const ffmpeg = spawn(ffmpegPath, [
        '-ss',
        seek,     
        '-i',
        target,   
        '-vf',
        `thumbnail,scale=${width}:${height}`,
        '-qscale:v',
        '2',
        '-frames:v',
        '1',
        '-f',
        'image2',
        '-c:v',
        'mjpeg',
        'pipe:1'  
      ])

      ffmpeg.stdout.pipe(tmpFile)

      ffmpeg.on('close', function(code) {
        tmpFile.end()
        resolve()
      })

      ffmpeg.on('error', function(err) {
        console.log(err)
        reject()
      })
    })
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œå‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ã€‚è¯¥å‡½æ•°é‡‡ç”¨ä¸€ä¸ª`seek`å‚æ•°ã€‚æœ‰äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥è¾“å…¥`Math.round(duration * .25)`äº†ã€‚åœ¨æ‹æ‘„æˆ‘ä»¬çš„ç¼©ç•¥å›¾ä¹‹å‰,`-ss`æ ‡å¿—åé¢è·Ÿç€ä»¥ç§’ä¸ºå•ä½çš„æ—¶é—´ä¼šå°†è§†é¢‘æœç´¢åˆ°è¿™ä¸ªä½ç½®ã€‚æˆ‘ä»¬å¼•ç”¨`target`ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„è§†é¢‘æ–‡ä»¶ã€‚æˆ‘ä»¬æŒ‡å®šæƒ³è¦ä½¿ç”¨çš„å°ºå¯¸ã€è´¨é‡ã€å¸§å’Œæ ¼å¼ï¼Œç„¶åæœ€ç»ˆæˆ‘ä»¬å°†è¾“å‡ºé€šè¿‡ç®¡é“ä¼ è¾“åˆ°ä¸€ä¸ªå†™å…¥åˆ°`/tmp`ç›®å½•çš„`writeStream`ä¸­ã€‚æ‰€æœ‰è¿™äº›éƒ½è¢«åŒ…è£…åœ¨ä¸€ä¸ª`Promise`ä¸­ï¼Œå½“è¿™ä¸ª`child_process`å…³é—­æ—¶ï¼Œè¿™ä¸ª`Promise`å°±ä¼šè§£æã€‚

å‡†ç¡®ç†è§£æ¯ä¸€ä¸ª`ffmpeg`è¾“å…¥çš„ä½œç”¨æ˜¯ä»¤äººå›°æƒ‘çš„ï¼Œä½†æ˜¯ [ffmpeg æ–‡æ¡£](https://www.ffmpeg.org/ffmpeg.html)æ˜¯å¾ˆä¸é”™çš„ï¼Œå¹¶ä¸”ä¹Ÿæœ‰å¾ˆå¤šè®ºå›å¸–å­ã€‚åº•çº¿æ˜¯æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯é‡å¤ä½¿ç”¨çš„åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬å¯ä»¥éšæ—¶æ‹æ‘„ç¼©ç•¥å›¾ã€‚å®ƒåœ¨æˆ‘ä»¬çš„`async/await`æµç¨‹ä¸­ä¹Ÿå·¥ä½œå¾—å¾ˆå¥½ã€‚

```
 function uploadToS3(x) {
    return new Promise((resolve, reject) => {
      let tmpFile = createReadStream(`/tmp/screenshot.jpg`)
      let dstKey = srcKey.replace(/\.\w+$/, `-${x}.jpg`).replace('/videos/', '/thumbnails/')

      var params = {
        Bucket: bucket,
        Key: dstKey,
        Body: tmpFile,
        ContentType: `image/jpg`
      }

      s3.upload(params, function(err, data) {
        if (err) {
          console.log(err)
          reject()
        }
        console.log(`successful upload to ${bucket}/${dstKey}`)
        resolve()
      })
    })
  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå¯é‡ç”¨çš„å‡½æ•°ï¼Œå°†ç¼©ç•¥å›¾ä¸Šä¼ åˆ°ä¸€ä¸ª **S3** æ¡¶ã€‚å› ä¸ºæˆ‘ä½¿ç”¨äº†`prefix`å’Œ`suffix`æ»¤é•œï¼Œå¹¶ä¸”æˆ‘æ­£åœ¨ä¸Šä¼ è§†é¢‘æ–‡ä»¶åˆ°`/user/videos`ï¼Œæˆ‘å¯ä»¥ç”¨`thumbnails`æ›¿æ¢`videos`ï¼Œæˆ‘çš„åŠŸèƒ½ä¸ä¼šè¢«è§¦å‘ã€‚ä½ å¯ä»¥æ”¾å…¥ä»»ä½•ä½ æƒ³è¦çš„`dstKey`å’Œ`bucket`ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å°†å‡½æ•°åŒ…è£…åœ¨ä¸€ä¸ª`Promise`ä¸­ï¼Œä»¥å¸®åŠ©æˆ‘ä»¬çš„å¼‚æ­¥æµã€‚

æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆçš„ä»£ç å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·:

```
process.env.PATH = process.env.PATH + ':' + process.env['LAMBDA_TASK_ROOT']

const AWS = require('aws-sdk')
const { spawn, spawnSync } = require('child_process')
const { createReadStream, createWriteStream } = require('fs')

const s3 = new AWS.S3()
const ffprobePath = '/opt/nodejs/ffprobe'
const ffmpegPath = '/opt/nodejs/ffmpeg'
const allowedTypes = ['mov', 'mpg', 'mpeg', 'mp4', 'wmv', 'avi', 'webm']
const width = process.env.WIDTH
const height = process.env.HEIGHT
}

module.exports.handler = async (event, context) => {
  const srcKey = decodeURIComponent(event.Records[0].s3.object.key).replace(/\+/g, '  ')
  const bucket = event.Records[0].s3.bucket.name
  const target = s3.getSignedUrl('getObject', { Bucket: bucket, Key: srcKey, Expires: 1000 })
  let fileType = srcKey.match(/\.\w+$/)

  if (!fileType) {
    throw new Error(`invalid file type found for key: ${srcKey}`)
  }

  fileType = fileType[0].slice(1)

  if (allowedTypes.indexOf(fileType) === -1) {
    throw new Error(`filetype: ${fileType} is not an allowed type`)
  }

  function createImage(seek) {
    return new Promise((resolve, reject) => {
      let tmpFile = createWriteStream(`/tmp/screenshot.jpg`)
      const ffmpeg = spawn(ffmpegPath, [
        '-ss',
        seek,
        '-i',
        target,
        '-vf',
        `thumbnail,scale=${width}:${height}`,
        '-qscale:v',
        '2',
        '-frames:v',
        '1',
        '-f',
        'image2',
        '-c:v',
        'mjpeg',
        'pipe:1'
      ])

      ffmpeg.stdout.pipe(tmpFile)

      ffmpeg.on('close', function(code) {
        tmpFile.end()
        resolve()
      })

      ffmpeg.on('error', function(err) {
        console.log(err)
        reject()
      })
    })
  }

  function uploadToS3(x) {
    return new Promise((resolve, reject) => {
      let tmpFile = createReadStream(`/tmp/screenshot.jpg`)
      let dstKey = srcKey.replace(/\.\w+$/, `-${x}.jpg`).replace('/videos/', '/thumbnails/')

      var params = {
        Bucket: bucket,
        Key: dstKey,
        Body: tmpFile,
        ContentType: `image/jpg`
      }

      s3.upload(params, function(err, data) {
        if (err) {
          console.log(err)
          reject()
        }
        console.log(`successful upload to ${bucket}/${dstKey}`)
        resolve()
      })
    })
  }

  const ffprobe = spawnSync(ffprobePath, [
    '-v',
    'error',
    '-show_entries',
    'format=duration',
    '-of',
    'default=nw=1:nk=1',
    target
  ])

  const duration = Math.ceil(ffprobe.stdout.toString())

  await createImage(duration * 0.25)
  await uploadToS3(1)
  await createImage(duration * .5)
  await uploadToS3(2)
  await createImage(duration * .75)
  await uploadToS3(3)

  return console.log(`processed ${bucket}/${srcKey} successfully`)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#tips)æç¤º

*   **Lambda** å…è®¸ä½ ä¸ºä½ çš„å‡½æ•°åˆ†é…ä¸€å®šæ•°é‡çš„å†…å­˜ã€‚æˆ‘ç”¨çš„æ˜¯ 512MBï¼Œä¸€åˆ‡ä¼¼ä¹è¿è¡Œè‰¯å¥½ã€‚æˆ‘çš„å‡½æ•°æ­£åœ¨åšä¸€äº›è¿™é‡Œæè¿°çš„äº‹æƒ…ï¼Œæ¯æ¬¡è°ƒç”¨ä½¿ç”¨å¤§çº¦ 400MBã€‚

*   åˆ©ç”¨ **CloudWatch** æ—¥å¿—å’Œ **AWS** æä¾›çš„ç›‘æ§å›¾ã€‚æˆ‘çš„å‡½æ•°æ¯æ¬¡è°ƒç”¨å¹³å‡éœ€è¦ 12 ç§’ã€‚è¯·æ³¨æ„ï¼Œåœ¨æˆ‘å°è¯•é‡æ„æ—¶ï¼Œè¿™å¼ å›¾ä¸Šæœ‰å¾ˆå¤šé”™è¯¯(åº•éƒ¨æ‰€æœ‰çš„ç»¿ç‚¹)ã€‚

[![graph](../Images/441c51d8682f2f474c0fdaed7ad1f71a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--MAJwnlgG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/lvjvi6y5w6drfz9sa47i.png)

*   è¿™ä¸ªç‰ˆæœ¬çš„ä»£ç ä¸ä¸Šä¼ åŸå§‹è§†é¢‘çš„åº”ç”¨ç¨‹åºæ²¡æœ‰ä»»ä½•è”ç³»ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯ï¼Œå½“å¤„ç†å®Œæˆæ—¶ï¼Œä»**Î»**å‡½æ•°å‘æ‚¨çš„åç«¯å‘é€ä¸€ä¸ª`POST`è¯·æ±‚ã€‚æˆ‘å‘ç°çš„å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ç»™æˆ‘çš„è§†é¢‘ä¸Šä¼ å¢åŠ  20 ç§’çš„å»¶è¿Ÿï¼Œè¿™æ ·å°±æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥åˆ›å»ºç¼©ç•¥å›¾ã€‚å½“ä¸Šä¼ è§†é¢‘æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒå»å“ªé‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“å®ƒæœ€ç»ˆä¼šæœ‰ç½‘å€ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯åŸºäºåŸå§‹è§†é¢‘é”®æ¥æ„å»ºç¼©ç•¥å›¾é”®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹ŸçŸ¥é“è¿™äº› URL æ˜¯ä»€ä¹ˆã€‚

```
const videoUrl = 'https://s3-us-west-1.amazonaws.com/footube/user/videos/example.mp4'

const imageUrl = 'https://s3-us-west-1.amazonaws.com/footube/user/thumbnails/example-1.jpg' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„ï¼Œåœ¨æˆ‘æ˜¾ç¤ºç¼©ç•¥å›¾ä¹‹å‰ï¼Œæˆ‘å…è®¸æœ‰é¢å¤–çš„ 20 ç§’é’Ÿæ¥å¤„ç†ã€‚

[![footube](../Images/765393c14075c24e5a033dcb2c5bcb06.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--6fjzROWa--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/h7ayhzhcawqhoen77y8p.gif)

*   `ffmpeg`å¯ä»¥åšå¾—æ›´å¤šã€‚å®ƒå¯ä»¥è½¬æ¢æ ¼å¼ã€‚å½“ä½ æ‚¬åœåœ¨è§†é¢‘ç¼©ç•¥å›¾ä¸Šæ—¶ï¼Œå®ƒç”šè‡³å¯ä»¥ç”Ÿæˆé¢„è§ˆ GIFï¼Œå°±åƒä½ åœ¨ YouTube ä¸Šçœ‹åˆ°çš„é‚£æ ·ã€‚

## [](#resources)èµ„æº

æˆ‘è§‰å¾—æœ‰å¸®åŠ©çš„æ–‡ç« ã€‚

*   [åœ¨ s3 å­˜å‚¨æ¡¶ä¸­ä½¿ç”¨ AWS Lambda åˆ›å»ºè§†é¢‘ç¼©ç•¥å›¾](https://concrete5.co.jp/blog/creating-video-thumbnails-aws-lambda-your-s3-bucket)
*   [ffprobe æç¤º](https://trac.ffmpeg.org/wiki/FFprobeTips)
*   [å…·æœ‰ AWS Lambda å±‚çš„ NodeJS è¿è¡Œæ—¶ç¯å¢ƒ](https://medium.com/@anjanava.biswas/nodejs-runtime-environment-with-aws-lambda-layers-f3914613e20e)
*   [AWS Lambda æ–‡æ¡£](https://docs.aws.amazon.com/lambda/index.html#lang/en_us)

## [](#conclusion)ç»“è®º

è¿™ç¯‡æ–‡ç« çš„ç»“å°¾æ¯”æˆ‘æƒ³è±¡çš„è¦é•¿ã€‚æˆ‘æƒ³ç»™å‡ºä¸€ä¸ªå¦‚ä½•è®¾ç½®è¿™ä¸ªä¸œè¥¿çš„å…¨é¢çœ‹æ³•ã€‚å¦‚æœæˆ‘é—æ¼äº†ä»€ä¹ˆæˆ–åšé”™äº†ä»€ä¹ˆï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚