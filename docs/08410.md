# Sitecore Commerce ä¸­ä¸€ä¸ªå¾®å¦™çš„åç§°ç©ºé—´å†²çªé”™è¯¯

> åŸæ–‡:[https://dev . to/jermdavis/a-conduct-clash-of-namespace-bug-in-commerce-36la](https://dev.to/jermdavis/a-subtle-clash-of-namespace-bug-in-commerce-36la)

æœ€è¿‘ï¼Œæˆ‘æœ‰æœºä¼šå‚åŠ äº† Sitecore çš„â€œ[å®æ–½ä½“éªŒå•†åŠ¡](https://www.sitecore.com/services-and-support/training/classroom-training/back-end-developers/sitecore-commerce-for-developers)â€åŸ¹è®­è¯¾ç¨‹ï¼Œå¹¶è·å¾—äº†å•†åŠ¡è¿ä½œç»†èŠ‚çš„è®¤è¯ã€‚å½“æˆ‘åšè¿™é—¨è¯¾çš„å®éªŒç»ƒä¹ æ—¶ï¼Œæˆ‘ç¢°åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„ bugï¼Œå®ƒçœ‹èµ·æ¥å°±åƒæ˜¯å…¶ä»–äººå¯èƒ½ä¼šé‡åˆ°çš„é‚£ç§äº‹æƒ…ã€‚

å› æ­¤ï¼Œå¦‚æœæ‚¨æ­£åœ¨æ‰©å±•å•†ä¸š OData APIsï¼Œè¯·å°å¿ƒ:

è¿™äº›ç»ƒä¹ çš„å®éªŒç¬”è®°é€šå¸¸å»ºè®®æ‚¨å°†ä»£ç ç¤ºä¾‹å¤åˆ¶å¹¶ç²˜è´´åˆ° Visual Studio ä¸­ã€‚ä½†æ˜¯ä¸ºäº†å¸®åŠ©æˆ‘ç†è§£ï¼Œæˆ‘è¾“å…¥äº†å¤§éƒ¨åˆ†ä»£ç ï¼Œä»¥ä¾¿æ›´åŠ æ³¨æ„å®ƒåœ¨åšä»€ä¹ˆã€‚åœ¨å…¶ä¸­ä¸€ä¸ªç»ƒä¹ ä¸­ï¼Œæ‚¨å¿…é¡»åˆ›å»ºä¸€ä¸ª API æ§åˆ¶å™¨ï¼Œå®ƒå¯ä»¥å›ç­” OData æŸ¥è¯¢ï¼Œä»¥è·å–å…³äºæ‚¨çš„ç›®å½•ä¸­çš„äº§å“çš„ä¿¡æ¯ã€‚

å•†ä¸š API æ˜¯ç°ä»£çš„ã€‚Net æ ¸å¿ƒä»£ç ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´ä»–ä»¬çš„æ§åˆ¶å™¨è¿”å›`Task<IActionResult>`ã€‚åŸ¹è®­ä¸­çš„ä¸€ä¸ªä¾‹å­æœ‰ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹åƒè¿™æ ·:

```
[EnableQuery]
[Route("api/Example")]
public class ExampleController : CommerceController
{
    [EnableQuery]
    [HttpGet]
    [Route("(Id={id})")]
    public async Task<IActionResult> Get(string id)
    {
        ProductExample yourData = await yourCode.ProcessThisOperation(id);
        return new ObjectResult(yourData);
    }
} 
```

è¾“å…¥ä»£ç åï¼Œæˆ‘éµå¾ªäº†å®éªŒå®¤ç¬”è®°å¹³æ·¡çš„æ–­è¨€ï¼Œå³æˆ‘åº”è¯¥â€œç”¨`using`è¯­å¥è§£å†³ä»»ä½•å‘½åç©ºé—´é—®é¢˜â€ã€‚æˆ‘æ¥å—äº† Visual Studio çš„æ™ºèƒ½æ„ŸçŸ¥æ‰€æå‡ºçš„å»ºè®®ã€‚å®Œæˆåï¼Œæˆ‘ç¼–è¯‘å¹¶è¿è¡Œäº†è§£å†³æ–¹æ¡ˆã€‚å¹¶æŒ‰ç…§æŒ‡ç¤ºä¸[é‚®é€’å‘˜](https://www.getpostman.com/)ä¸€èµ·æµ‹è¯•ã€‚

è¿™å°±æ˜¯ä»¤äººå›°æƒ‘çš„åœ°æ–¹ã€‚æˆ‘çš„å®ä¾‹è¿”å›äº†ä¸€ä¸ªæœ€åˆçœ‹èµ·æ¥æœ‰æ•ˆçš„å“åº”:

```
{  "@odata.context":  "https://localhost:5000/Api/$metadata#Example/$entity",  "CompositeKey":  null,  "DateCreated":  "2019-03-13T16:05:36.7849024Z",  "DateUpdated":  "2019-03-13T16:05:36.7849024Z",  "DisplayName":  "",  "FriendlyId":  null,  "Id":  "fdb359edeb5442839b41ee938fe7ac6b",  "Version":  0,  "IsPersisted":  false,  "Name":  "Entity-ProductExample-Cart01",  "Policies":  []  } 
```

è™½ç„¶è¿™æ˜¯ä¸€ä¸ªæˆåŠŸçš„å›åº”ï¼Œä½†å´ä¸æ˜¯æ­£ç¡®çš„ã€‚æ§åˆ¶å™¨ä»£ç æ­£åœ¨è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ï¼Œè¯¥ç±»å‹è‡³å°‘åº”è¯¥å‘ json å¯¹è±¡æ·»åŠ ä¸€ä¸ªå±æ€§:

```
public class ProductExample : CommerceEntity
{
    [Contained]
    public IEnumerable Products { get; set; }
} 
```

ä½†æ˜¯â€œProductsâ€å±æ€§å¹¶æ²¡æœ‰å‡ºç°åœ¨æˆ‘çš„ json æ•°æ®ä¸­ï¼Œå°½ç®¡å½“æˆ‘é€šè¿‡è°ƒè¯•å™¨æ£€æŸ¥æ—¶,`Products`å±æ€§åŒ…å«æ•°æ®ã€‚å½“æˆ‘å’Œè¿™é—¨è¯¾çš„å…¶ä»–å­¦ç”Ÿæ¯”è¾ƒç»“æœæ—¶ï¼Œä»–ä»¬ç¡®å®æœ‰è¿™äº›æ•°æ®ã€‚

å‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼Ÿ

åœ¨èŠ±äº†å¤ªå¤šæ—¶é—´ä½¿ç”¨ diff å·¥å…·å’Œå…¶ä»–äººçš„ä»£ç å·¥ä½œå‰¯æœ¬åï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªå¾®å¦™çš„é”™è¯¯:å½“æˆ‘è§£æåç§°ç©ºé—´æ—¶ï¼Œæˆ‘é€‰é”™äº†ä¸€ä¸ªåç§°ç©ºé—´â€¦

åœ¨è§£æ`ObjectResult`ç±»çš„ä½ç½®æ—¶ï¼Œæˆ‘é€‰æ‹©äº†åç§°ç©ºé—´`System.Web.Http.OData`ã€‚è¿™çœ‹èµ·æ¥å¯è¡Œï¼Œå› ä¸ºé‚£é‡Œæœ‰ä¸€ä¸ªåŒåçš„ç±»ã€‚ä½†äº‹å®è¯æ˜ï¼Œå®ƒçš„è¡Œä¸ºä¸ç”Ÿæ´»åœ¨`Microsoft.AspNetCore.OData`ä¸‹çš„é‚£åªæœ‰ä¸€ç‚¹ç‚¹ä¸åŒã€‚å½“æˆ‘åœ¨æˆ‘çš„ä»£ç ä¸­æ”¹å˜å®ƒæ—¶ï¼Œæˆ‘å¼€å§‹çœ‹åˆ°æ­£ç¡®çš„æ•°æ®:

```
{  "@odata.context":  "https://localhost:5000/Api/$metadata#Example/$entity",  "CompositeKey":  null,  "DateCreated":  "2019-03-13T16:05:36.7849024Z",  "DateUpdated":  "2019-03-13T16:05:36.7849024Z",  "DisplayName":  "",  "FriendlyId":  null,  "Id":  "fdb359edeb5442839b41ee938fe7ac6b",  "Version":  0,  "IsPersisted":  false,  "Name":  "Entity-ProductExample-Cart01",  "Policies":  [],  "Products@odata.context":  "https://localhost:5000/Api/$metadata#Example('fdb359edeb5442839b41ee938fe7ac6b')/Example",  "Products":  [  {  "CompositeKey":  null,  "DateCreated":  "2018-01-18T13:53:30.2133302Z",  "DateUpdated":  "2018-05-27T18:10:16.6754176Z",  "DisplayName":  "Habitat Centerpiece 1.5 Cu. Ft. Countertop Convection Microwave",  "FriendlyId":  "6042749",  "Id":  "Entity-SellableItem-6042749",  "Version":  1,  "ListPrice":  null  }  ]  } 
```

å› æ­¤ï¼Œå¦‚æœæ‚¨å‘ç°è‡ªå·±ç¼–å†™çš„ä»£ç åœ¨å…¶è¿”å›ç±»å‹ä¸­ä½¿ç”¨äº†`ObjectResult`,é‚£ä¹ˆåœ¨æ¥å— Visual Studio å…³äºæ·»åŠ ä»€ä¹ˆåç§°ç©ºé—´çš„å»ºè®®æ—¶è¦éå¸¸å°å¿ƒâ€”â€”å¦‚æœæ‚¨ä¸ä½¿ç”¨`Microsoft.AspNetCore.OData`,é‚£ä¹ˆæ‚¨çš„ä»£ç å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚

ä¸è¦åƒæˆ‘ä¸€æ · [![ğŸ˜‰](../Images/b26450942c7c42752fe0b02f126abb48.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--fumfYCPq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s0.wp.com/wp-content/mu-plugins/wpcom-smileys/twemoji/2/72x72/1f609.png)