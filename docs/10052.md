# graph QL basics:part 3-graph QL server-å›¾å½¢ SQL åŸºç¡€:ç¬¬ 3 éƒ¨åˆ†-å›¾å½¢ server

> âˆt0]https://dev . to/Doyle codes/graph QL-basics-part-3---graph QL-server-531d

å¥½å§ï¼Œè‡ªä»æˆ‘çš„ GraphQL ç³»åˆ—çš„æœ€æ–°æ–‡ç« ä»¥æ¥ï¼Œæ—¶é—´æ¯”æˆ‘å¸Œæœ›çš„è¦é•¿ä¸€ç‚¹ã€‚äº‹å®è¯æ˜ï¼Œ2 å²çš„å­©å­ä¸ä¼šè®©ä½ ä¸€ä¸ªäººåœ¨ç”µè„‘å‰è¿‡äºé¢‘ç¹åœ°æ‰“å­—ã€‚

æˆ‘åœ¨ä¹‹å‰çš„å¸–å­ä¸­å¾—åˆ°äº†å¾ˆå¤šå¾ˆå¥½çš„å›åº”ï¼Œå…¶ä¸­ä¸€äº›å®é™…ä¸Šä¿ƒä½¿æˆ‘å¯»æ‰¾å…¶ä»–è®¾ç½® GraphQL æœåŠ¡å™¨çš„æ–¹æ³•ã€‚æœ€åˆï¼Œæˆ‘æ‰“ç®—ä½¿ç”¨ GraphQL Yoga å»ºç«‹ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ Apollo Client è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢å’Œå˜æ›´ã€‚å®é™…ä¸Šï¼Œæˆ‘ç°åœ¨å°†ä½¿ç”¨ Apollo Server (v2)æ¥è®¾ç½® GraphQL æœåŠ¡å™¨ï¼è¿™éå¸¸ç±»ä¼¼äºç‘œä¼½ï¼Œä½†é‰´äºæˆ‘ä½¿ç”¨çš„æ˜¯é˜¿æ³¢ç½—å®¢æˆ·ç«¯ï¼Œæˆ‘æƒ³ä»–ä»¬ä¸€èµ·å·¥ä½œä¼šæ›´å¥½ã€‚ç»è¿‡å‡ å¤©çš„ä¿®è¡¥(å½“ä¸€ä¸ª 2 å²çš„å­©å­æƒ³è¦æ›´å¤šçš„â€œç«ç®­â€æ—¶ï¼Œä¸€åˆ‡éƒ½éœ€è¦ä¸€æ®µæ—¶é—´æˆ‘ç»ˆäºæŠŠä¸€åˆ‡éƒ½å®‰æ’å¥½äº†ã€‚æˆ‘ä¼šè¯•ç€ç»å†æˆ‘çš„æŒ£æ‰/å­¦ä¹ ï¼ŒæŠŠä¸€åˆ‡éƒ½è®¾ç½®å¥½ã€‚è¿™å°†æ˜¯ä¸€ç¯‡**ç›¸å½“é•¿çš„æ–‡ç« **,ä½†æˆ‘å¸Œæœ›å®ƒèƒ½å¯¹é‚£äº›çœŸæ­£åˆšåˆšå…¥é—¨çš„äººæœ‰æ‰€å¸®åŠ©ã€‚

## GraphQL æœåŠ¡å™¨-å‘ç”Ÿäº†ä»€ä¹ˆ

åœ¨å¼€å§‹åˆ›å»ºæœåŠ¡å™¨ä¹‹å‰ï¼Œæˆ‘æƒ³è®¨è®ºä¸€ä¸‹å¯åŠ¨å’Œè¿è¡ŒæœåŠ¡å™¨æ‰€éœ€çš„ç»„ä»¶ã€‚æ‚¨åŸºæœ¬ä¸Šéœ€è¦:

1.  Prisma å®¢æˆ·ç«¯çš„ä¸€ä¸ªå®ä¾‹ã€‚
2.  ä¸€ä¸ª**â€˜typeDefsâ€™**ï¼Œæˆ–è€…å®¢æˆ·ç«¯çš„æ¨¡å¼ã€‚
3.  è§£æå™¨(é’ˆå¯¹æ‰€æœ‰æŸ¥è¯¢å’Œå˜å¼‚)
4.  å®é™…çš„ GraphQL æœåŠ¡å™¨(Apollo Server 2)

### è¿™äº›éƒ½æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ

#### æ£±é•œå®¢æˆ·ç«¯

Prisma çš„ç‰¹ç‚¹æ˜¯ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä½äºå®é™…æ•°æ®åº“ä¹‹ä¸Šçš„æœåŠ¡å™¨ã€‚è¦ä½¿ç”¨å®ƒï¼Œæ‚¨éœ€è¦è®¿é—®å®ƒçš„â€œç«¯ç‚¹â€(ç»™ä¸€ä¸ª 5 å²å­©å­çš„è§£é‡Š)ã€‚å¦‚æœæ‚¨å·²ç»é˜…è¯»äº†æˆ‘çš„ç³»åˆ—æ–‡ç« çš„ç¬¬ 2 éƒ¨åˆ†ï¼Œé‚£ä¹ˆå½“æ‚¨ç”Ÿæˆ Prisma å®¢æˆ·ç«¯å’Œ prisma.graphql æ–‡ä»¶æ—¶ï¼ŒPrisma å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†è¿™ä¸ªç«¯ç‚¹ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰ç»å†è¿‡ï¼Œä½ å¯èƒ½ä¼šåœ¨è¿™é‡Œè¿·è·¯ã€‚

## æ–‡ç« ä¸å†å¯ç”¨

You can actually access your database through that Prisma playground directly, but we need a way for our application to talk to the same endpoint. I am doing this by creating a new instance of the Prisma Client using the JS constructor. This essentially creates the Prisma DB and allows you to access it in the server that we will be creating that our actual app backend runs on. In this series the endpoint is the Prisma demo database we made, but in production this would be your actual database.

#### typeDefs (schema.graphql)

æˆ‘æƒ³è¿™æ˜¯æˆ‘æœ€åˆæ„Ÿåˆ°å›°æƒ‘çš„åœ°æ–¹ã€‚åœ¨è®¾ç½® prisma æ—¶ï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ *datamodel.prisma* ä¸­å®šä¹‰äº†æˆ‘ä»¬æƒ³è¦çš„æ•°æ®æ¨¡å‹ï¼Œè¿™æ · Prisma å°±å¯ä»¥å¼€å§‹åˆ›å»ºæˆ‘ä»¬çš„ API æ¥å¤„ç†æ•°æ®åº“ã€‚é—®é¢˜æ˜¯ï¼Œæ•°æ®æ¨¡å‹å’Œ API å°†**è€Œä¸æ˜¯**å¯è¢«æˆ‘ä»¬çš„å®¢æˆ·ç«¯è®¿é—®ã€‚æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥è®¿é—®çš„æ–°æ¨¡å¼ã€‚åœ¨è¿™ä¸ªå®¢æˆ·ç«¯æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†å°†åœ¨å®é™…åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„å„ç§æŸ¥è¯¢å’Œå˜åŒ–ã€‚

#### è§£æå™¨

æ­£å¦‚åœ¨æœ¬ç³»åˆ—çš„å‰å‡ éƒ¨åˆ†ä¸­æåˆ°çš„ï¼ŒPrisma åˆ›å»ºäº†è¿™ä¸ªä¼Ÿå¤§çš„ API æ¥è®¿é—®æ•°æ®åº“ï¼Œä½†æ˜¯å®ƒç»å¯¹æ²¡æœ‰å†…ç½®â€œé€»è¾‘â€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™æ„å‘³ç€ä»€ä¹ˆ:

ç®€ç”¨å¥¹çš„é‚®ç®±[jane@email.com](mailto:jane@email.com)å¼€äº†ä¸€ä¸ªè´¦æˆ·ã€‚ä¸€å¹´åï¼Œå¥¹å›æ¥å¹¶è¯•å›¾ç”¨ç”µå­é‚®ä»¶[jane@email.com](mailto:jane@email.com)(åŒä¸€ä¸ªç”µå­é‚®ä»¶)å†æ¬¡æ³¨å†Œã€‚app **åº”è¯¥** *çœ‹åˆ°å¥¹å·²ç»æœ‰è´¦å·äº†ï¼Œå°±è¯´:â€œå˜¿ï¼Œå»ç™»å½•å§ï¼â€ä½†æ˜¯ Prisma API æ²¡æœ‰è¿™ç§é€»è¾‘ã€‚å®ƒåªèƒ½è®©ä½¿ç”¨è€…ã€‚*

è¿™å°±æ˜¯è§£å†³è€…æ‰€å…³å¿ƒçš„ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè§£æå™¨æ¥åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œé¦–å…ˆä½¿ç”¨ Prisma API ä¸­çš„*æŸ¥è¯¢*æ¥æ£€æŸ¥è¯¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œç„¶åå¦‚æœä»–ä»¬å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œå°±ä½¿ç”¨ API ä¸­çš„*å˜å¼‚*æ¥åˆ›å»ºè¯¥ç”¨æˆ·ï¼Œæˆ–è€…åšå…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚æç¤ºä»–ä»¬ç™»å½•æˆ–é‡ç½®å¯†ç ã€‚

#### å›¾ QL æœåŠ¡å™¨

è¿™å®é™…ä¸Šæ˜¯æ‚¨çš„æ™®é€šåº”ç”¨æœåŠ¡å™¨ã€‚è¿™å°±åƒåœ¨ Express ä¸­åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ä¸€æ ·ï¼Œä¸åŒä¹‹å¤„åœ¨äºæ‚¨ä¸ºæœåŠ¡å™¨å®ä¾‹æä¾›äº†æ‰€æœ‰è¿™äº›é¢å¤–çš„ GraphQL ä¿¡æ¯ï¼Œä¾‹å¦‚ Prisma å®ä¾‹å’Œæ‰€æœ‰è§£æå™¨ï¼Œä»¥ä¾¿æ‚¨çš„æœåŠ¡å™¨çŸ¥é“å¦‚ä½•ä¸å®¢æˆ·ç«¯ä»£ç *å’Œ*Prisma æ•°æ®åº“è¿›è¡Œé€šä¿¡ã€‚

## å‡†å¤‡æ¨¡å¼å’Œè§£æå™¨

GraphQL çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å®ƒå®Œå…¨æ˜¯ç±»å‹å®‰å…¨çš„ã€‚ä¸€ä»¶ä»¤äººæ²®ä¸§çš„äº‹æƒ…æ˜¯ï¼Œå¦‚æœä½ åˆšåˆšå¼€å§‹è®¾ç½®ï¼Œä½ å¯èƒ½ä¼šå¾—åˆ°ä¸€å¨çš„é”™è¯¯ï¼Œå¦‚æœä½ åªæ˜¯è¯•å›¾å¯åŠ¨æœåŠ¡å™¨ï¼Œè€Œæ²¡æœ‰åˆ›å»ºä»»ä½•å…¶ä»–ä¸œè¥¿ï¼Œå› ä¸ºé˜¿æ³¢ç½—æœåŠ¡å™¨åšæŒä¸€åˆ‡éƒ½å¥½ï¼åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è®¾ç½®æœåŠ¡å™¨éœ€è¦çš„æ¯ä¸ªæ–‡ä»¶ï¼Œæœ€ååˆ›å»ºæœåŠ¡å™¨ã€‚

### 1ã€‚æ–‡ä»¶ç»“æ„

é¦–å…ˆï¼Œå¯¹äºæœåŠ¡å™¨å°†è¦è®¿é—®çš„è¿™äº›æ–‡ä»¶ï¼Œæˆ‘åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªâ€œsrcâ€æ–‡ä»¶å¤¹ï¼ŒåŒ…å«ä»¥ä¸‹ 3 ä¸ªæ–‡ä»¶ã€‚

```
prisma-graphql-tutorial
  /src
    /Mutation.js
    /Query.js
    /schema.graphql 
```

Enter fullscreen mode Exit fullscreen mode

### 2ã€‚schema.graphql

ä¸‹é¢æ˜¯æˆ‘çš„ schema.graphql çš„å¼€å¤´ï¼Œå…¶ä¸­æˆ‘è®¾ç½®äº†ä¸€ä¸ªæŸ¥è¯¢æ¥æŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šçš„ç”¨æˆ·ï¼Œè¿˜æœ‰ä¸€ä¸ªå˜å¼‚æ¥åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ã€‚

```
# import * from "../generated/prisma.graphql"

type Query {
  user(id: ID!): User
}

type Mutation {
  createUser(
    name: String!
  ): User!
} 
```

Enter fullscreen mode Exit fullscreen mode

é¦–å…ˆï¼Œæˆ‘æœ‰`# import * from "../generated/prisma.graphql"`,å› ä¸ºè¿™æ˜¯ä» Prisma API (prisma.graphql)å°†ç±»å‹å¯¼å…¥æ–‡ä»¶çš„æ–¹å¼ã€‚å¦‚æœæ²¡æœ‰å®ƒï¼Œä½ ä¼šå¾—åˆ°è¿™äº›é”™è¯¯ï¼Œå› ä¸ºå½“ä½ æœ‰äº†`user(id: ID!): User`ï¼Œè¿™æ„å‘³ç€ä½ æƒ³åœ¨è¿è¡Œ`user(id: ID!)`åå¾—åˆ°ä¸€ä¸ªè¿”å›ç»™ä½ çš„ç”¨æˆ·ã€‚å¯¼å…¥ç”¨æˆ·ç±»å‹æœ‰åŠ©äºé¿å…é”™è¯¯ã€‚

**é‚£ä¹ˆè¿™ä¸€åˆ‡æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ**

### `user(id: ID!): User`

è¿™åˆ›å»ºäº†ä¸€ä¸ªæŸ¥è¯¢ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿä½¿ç”¨å®¢æˆ·ç«¯è°ƒç”¨çš„â€œuser â€,å®ƒæ¥å—å”¯ä¸€çš„ç”¨æˆ· id ä½œä¸ºå‚æ•°ã€‚`ID!`è¡¨ç¤ºéœ€è¦ idã€‚

è¿™æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿå®ƒæ¥è‡ª prisma ç”Ÿæˆçš„ *prisma.graphql* ã€‚å¦‚æœä½ æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œæœç´¢â€œæŸ¥è¯¢â€ï¼Œä½ ä¼šæ‰¾åˆ°æ‰€æœ‰çš„æŸ¥è¯¢:

```
type Query {
  item(where: ItemWhereUniqueInput!): Item
  items(where: ItemWhereInput, orderBy: ItemOrderByInput, skip: Int, after: String, before: String, first: Int, last: Int): [Item]!
  itemsConnection(where: ItemWhereInput, orderBy: ItemOrderByInput, skip: Int, after: String, before: String, first: Int, last: Int): ItemConnection!
  user(where: UserWhereUniqueInput!): User
  users(where: UserWhereInput, orderBy: UserOrderByInput, skip: Int, after: String, before: String, first: Int, last: Int): [User]!
  usersConnection(where: UserWhereInput, orderBy: UserOrderByInput, skip: Int, after: String, before: String, first: Int, last: Int): UserConnection!
  node(id: ID!): Node
} 
```

Enter fullscreen mode Exit fullscreen mode

å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª`user(where: UserWhereUniqueInput!): User`ã€‚å¦‚æœä½ æ¥ç€æœç´¢`UserWhereUniqueInput!`ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªå®çŸ³:

```
input UserWhereUniqueInput {
  id: ID
} 
```

Enter fullscreen mode Exit fullscreen mode

è¿™å‘Šè¯‰æˆ‘ä»¬ï¼ŒPrisma ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåä¸º *user* çš„æŸ¥è¯¢ï¼Œå®ƒæ¥å—äº† *UserWhereUniqueInput* ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ idã€‚è¿™æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºæˆ‘ä»¬åªå¸Œæœ›è¿”å› 1 ä¸ªç”¨æˆ·ã€‚

æˆ‘ä»¬å¯ä»¥å°†å…¶ä¸æŸ¥è¯¢ *users* è¿›è¡Œå¯¹æ¯”ï¼Œåè€…æ¥å— *UserWhereInput* ã€‚å¦‚æœæˆ‘ä»¬æ‰¾å‡ºé‚£æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¼šå‘ç°:

```
input UserWhereInput {
  I deleted a lot of what was here to make this shorter...

  id_gte: ID
  id_contains: ID
  id_not_contains: ID
  name_lte: String
  name_gt: String
  name_gte: String
  name_contains: String
  name_not_contains: String
  name_starts_with: String
} 
```

Enter fullscreen mode Exit fullscreen mode

å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³è¦æŸ¥è¯¢å¤šä¸ªç”¨æˆ·ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æœ‰æ›´å¤šçš„é€‰é¡¹å¯ä»¥ä¼ é€’åˆ°æˆ‘ä»¬çš„â€œç”¨æˆ·â€æŸ¥è¯¢ä¸­ã€‚æ— è®ºä½•æ—¶ä½ æƒ³çŸ¥é“æˆ‘ä»¬åº”è¯¥æŠŠä»€ä¹ˆç±»å‹çš„è¾“å…¥æ’å…¥åˆ°æˆ‘ä»¬çš„ Prisma æŸ¥è¯¢å’Œå˜å¼‚ä¸­ï¼Œä½ å¯ä»¥åªæœç´¢å®é™…çš„è¾“å…¥åç§°ã€‚

**ä¸ºäº†å›é¡¾** - >æˆ‘åˆ›å»ºäº†ä¸€ä¸ªå®¢æˆ·ç«¯`user(id: ID!): User`æŸ¥è¯¢ï¼Œæˆ‘é€šè¿‡åœ¨æˆ‘çš„ *prisma.graphql* ä¸­æŸ¥æ‰¾å®é™…çš„æŸ¥è¯¢æ¥åˆ›å»ºå®ƒï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æŸ¥æ‰¾ Prisma API æœŸæœ›çš„è¾“å…¥(å”¯ä¸€ id)ã€‚

### `createUser(name: String!): User!`

åˆ›å»ºå®ƒéµå¾ªäº†ä¸æˆ‘ä¸Šé¢çš„æŸ¥è¯¢ç›¸ä¼¼çš„æ¨¡å¼ï¼é¦–å…ˆï¼Œæˆ‘åœ¨ *prisma.graphql* ä¸­æŸ¥æ‰¾çªå˜ï¼Œå¹¶æ‰¾åˆ°`createUser(data: UserCreateInput!): User!`ã€‚è¿™ä¸ª*åˆ›å»ºç”¨æˆ·*éœ€è¦ä¸€äº›æ•°æ®ï¼Œä¹Ÿå°±æ˜¯*ç”¨æˆ·åˆ›å»ºè¾“å…¥*ã€‚åœ¨ *prisma.graphql* ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥æ‰¾ *UserCreateInput* æ¥æŸ¥çœ‹è¯¥æ•°æ®æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†è¿™ä¸ª:

```
input UserCreateInput {
  name: String!
} 
```

Enter fullscreen mode Exit fullscreen mode

è¿™æ˜¯éå¸¸åŸºæœ¬çš„ï¼Œå½“æˆ‘ä»¬åœ¨ *datamodel.prisma* ä¸­å®šä¹‰æˆ‘ä»¬æƒ³è¦çš„ç”¨æˆ·ç±»å‹æ—¶ï¼Œæˆ‘ä»¬è¯´æˆ‘ä»¬æƒ³è¦çš„åªæ˜¯ä¸€ä¸ªåå­—å’Œä¸€ä¸ª id(ä½†æ˜¯ id ä¼šåœ¨æ•°æ®åº“ä¸­ç”Ÿæˆ)ã€‚

å› æ­¤ï¼Œå¯¹äºæ¨¡å¼ä¸­çš„çªå˜ï¼Œæˆ‘ä»¬ä½¿ç”¨`createUser()`ï¼Œå¯¹äºè¾“å…¥ï¼Œæˆ‘ä»¬ä¼ å…¥`name: String!`ã€‚åç§°æ˜¯å¿…éœ€çš„ï¼Œåœ¨åˆ›å»ºæ–°ç”¨æˆ·åï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·å¯¹è±¡è¿”å›ç»™æˆ‘ä»¬(è¿™æ˜¯`: User!`éƒ¨åˆ†)

### 3ã€‚çªå˜. js(çªå˜è§£æå™¨)

åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†å¤„ç†æ‰€æœ‰å®é™…çš„çªå˜ã€‚ç›®å‰ä¸ºæ­¢æˆ‘æœ‰è¿™ä¸ª:

```
const Mutations = {
  async createUser(parent, args, context, info) {
    const user = await context.db.mutation.createUser({
      data: { ...args } // destructure arguments into the data (name, etc.)
    }, info);
    return user;
  }
}

module.exports = Mutations; 
```

Enter fullscreen mode Exit fullscreen mode

åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªåä¸º *createUser* çš„å˜å¼‚ï¼Œåœ¨ Apollo ä¸­(è§£æå™¨ç”¨äº Apollo æœåŠ¡å™¨)ï¼Œè¯¥å‡½æ•°å°†æ¥å— 4 ä¸ªå‚æ•°ã€‚å®ƒä»¬æ˜¯çˆ¶å¯¹è±¡ã€å‚æ•°(args)ã€ä¸Šä¸‹æ–‡å’Œä¿¡æ¯ã€‚è¿™é‡Œæœ‰ä¸€å †å…³äºè¿™äº›çš„[å¾ˆæ£’çš„æ–‡æ¡£](https://www.apollographql.com/docs/apollo-server/essentials/data.html#type-signature)ï¼Œæˆ‘åªæ‰“ç®—ç®€å•è§£é‡Šä¸€ä¸‹ã€‚

*   Parent:åŒ…å« Apollo çˆ¶å¯¹è±¡ç»“æœçš„å¯¹è±¡
*   Args:åœ¨å®¢æˆ·ç«¯ä¼ é€’ç»™ Apollo å®¢æˆ·ç«¯çš„å‚æ•°ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« å°†ä¼šæœ‰æ›´å¤šå…³äºè¿™ä¸ªçš„å†…å®¹...
*   Context:åœ¨æ¯ä¸ªè¯·æ±‚çš„æ‰€æœ‰è§£æå™¨ä¸Šéƒ½å¯ç”¨çš„å¯¹è±¡ã€‚
*   Info:å…³äºæŸ¥è¯¢æ‰§è¡ŒçŠ¶æ€çš„ä¿¡æ¯ã€‚

æˆ‘ä»¬æ­£åœ¨åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œç­‰å¾… context . db . mutation . create user çš„ç»“æœã€‚é‚£æ˜¯ Prisma createUserï¼çœ‹åˆ°äº†ï¼

æˆ‘ä»¬é¦–å…ˆé€šè¿‡è®¿é—®ä¸Šä¸‹æ–‡æ¥è®¿é—®å®ƒã€‚æ¯ä¸ªè¯·æ±‚éƒ½æœ‰ä¸Šä¸‹æ–‡ã€‚å®é™…ä¸Šï¼Œå› ä¸ºè¿™éƒ½æ˜¯åŸºäº Express çš„ï¼Œå¦‚æœä½ ç†Ÿæ‚‰ Expressï¼Œå®ƒç±»ä¼¼äºè¯·æ±‚ï¼Œå“åº”ã€‚å¯¹äºä¸Šä¸‹æ–‡ï¼ŒApollo æœåŠ¡å™¨ä¸­çš„ *context.request* ä¸æ™®é€š Express æœåŠ¡å™¨ä¸­çš„ *req* ç›¸åŒã€‚é™¤äº†å…¸å‹çš„è¯·æ±‚æ•°æ®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ *db* è®¿é—®æˆ‘ä»¬çš„ Prisma æ•°æ®åº“ï¼Œç¨åæ‚¨å°†çœ‹åˆ°å®ƒåœ¨æœåŠ¡å™¨ä¸­çš„è®¾ç½®ã€‚ä¸€æ—¦ä½ åœ¨ Prisma æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥åˆ°çªå˜ï¼Œæœ€åæ˜¯æˆ‘ä»¬æƒ³è¦çš„å®é™…çªå˜ï¼Œå³ *createUser* ï¼

ä»æˆ‘ä»¬çš„ *prisma.graphql* æ–‡ä»¶ä¸­çš„ API å¯çŸ¥ï¼Œ *createUser* éœ€è¦æ•°æ®ï¼Œæˆ‘ä»¬ä¼ é€’ç»™`{...args}`ã€‚ä»»ä½•å‚æ•°éƒ½å°†è¢«ææ„æˆé€‚å½“çš„ key.value å¯¹ï¼Œè¿™æ˜¯åŸºäºæˆ‘ä»¬åˆšåˆšåˆ¶ä½œçš„ *schema.graphql* çš„ï¼Œå‚æ•°å°†æ˜¯...ä½ çŒœå¯¹äº†ï¼Œæ¥è‡ª`createUser(name: String!): User!`çš„åå­—ã€‚

æœ€åï¼Œæˆ‘ä»¬å°†*ä¿¡æ¯*ä¼ é€’ç»™*åˆ›å»ºç”¨æˆ·*ï¼Œç„¶åè¿”å›æˆ‘ä»¬åˆ›å»ºçš„ç”¨æˆ·ã€‚

### 4ã€‚Query.js(æŸ¥è¯¢è§£æå™¨)

å¥½äº†ï¼Œå¤§éƒ¨åˆ†ç¹é‡çš„è§£é‡Šéƒ½åœ¨ä¸Šé¢çš„ Mutation.js ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯æˆ‘çš„æŸ¥è¯¢è§£æå™¨:

```
const Query = {
  user(parent, args, context, info) {
    if (!context.request.userId) {
      return null;
    }
    return context.db.query.user({
      where: { id: context.request.userId }
    }, info);
  }
};

module.exports = Query; 
```

Enter fullscreen mode Exit fullscreen mode

åŒæ ·ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ç›¸åŒçš„(parentã€argsã€contextã€info)å‡½æ•°ç»“æ„ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘é¦–å…ˆæ£€æŸ¥è¯·æ±‚(context.request)ä¸­çš„ userIdã€‚å¦‚æœè¯·æ±‚å¯¹è±¡ä¸Šæœ‰ä¸€ä¸ª userIdï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º Prismaã€‚æˆ‘ä»¬çš„æ•°æ®åº“ä¸Šçš„ user()æ–¹æ³•ä¼ é€’ *context.request.userId* ä½œä¸ºæˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çš„ Idã€‚

## åˆ›å»º GraphQL æœåŠ¡å™¨

ç»ˆäºï¼åˆ›å»ºæˆ‘ä»¬çš„æœåŠ¡å™¨çš„ä¸€åˆ‡éƒ½å·²å°±ç»ªã€‚è¿™(å¯ä»¥è¯´)æ˜¯å®¹æ˜“çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬å°†é€æ­¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### 1ã€‚åœ¨ä½ çš„æ ¹æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª *index.js* ã€‚

### 2ã€‚å®‰è£…ä¾èµ–é¡¹:

```
npm install apollo-server graphql graphql-cli graphql-import prisma prisma-binding
npm install --save-dev nodemon 
```

Enter fullscreen mode Exit fullscreen mode

### 3ã€‚å°†æ‚¨éœ€è¦çš„æ‰€æœ‰å†…å®¹å¯¼å…¥ index.js

```
const { Prisma } = require('prisma-binding');
const { ApolloServer } = require('apollo-server');
const { importSchema } = require('graphql-import');

const typeDefs = importSchema('./src/schema.graphql');
const Query = require('./src/Query');
const Mutation = require('./src/Mutation'); 
```

Enter fullscreen mode Exit fullscreen mode

å‰ 3 ä¸ªéœ€è¦å¼•å…¥ Prismaï¼ŒApollo æœåŠ¡å™¨ï¼Œä»¥åŠæ¥è‡ª Prisma çš„ graphql-import åŒ…ï¼Œå®ƒå…è®¸æ‚¨ä»ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¯¼å…¥æˆ‘ä»¬åˆ›å»ºçš„æ¨¡å¼å¹¶è¢«æ­£ç¡®è¯»å–ã€‚

ç„¶åï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬çš„æ¨¡å¼(ä½¿ç”¨ importSchema)ä½œä¸º typeDefs å¯¼å…¥ï¼Œä»¥åŠæˆ‘ä»¬çš„å˜å¼‚å’ŒæŸ¥è¯¢è§£æå™¨ã€‚

### 4ã€‚ä½¿ç”¨ Prisma å®¢æˆ·ç«¯æ„é€ å‡½æ•°åˆ›å»ºæ•°æ®åº“

```
const db = new Prisma({
  typeDefs: './generated/prisma.graphql',
  endpoint: 'https://us1.prisma.sh/prisma-tutorial/prisma-graphql-tutorial/dev',
  secret: 'currentlyDrinkingPhilzCoffee'
}); 
```

Enter fullscreen mode Exit fullscreen mode

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Prisma å®¢æˆ·æœºçš„æ–°å®ä¾‹ã€‚å®ƒéœ€è¦è‡ªå·±çš„ typeDefsï¼Œå¯¹äº Prisma å®¢æˆ·ç«¯æ¥è¯´ï¼Œå®ƒä¸æ˜¯æˆ‘ä»¬ä¸Šé¢å¯¼å…¥çš„ç±»å‹ï¼Œè€Œæ˜¯ Prisma è‡ªåŠ¨ç”Ÿæˆçš„ç±»å‹ã€‚å®ƒè¿˜éœ€è¦ä¸ä»¥å‰åœ¨ *prisma.yml* ä¸­ç›¸åŒçš„ç«¯ç‚¹å’Œç§˜å¯†ã€‚åœ¨éæ•™ç¨‹é¢†åŸŸï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°†æ‰€æœ‰å†…å®¹æ”¾åœ¨ä¸€ä¸ª. env æ–‡ä»¶ä¸­å¹¶ä»é‚£é‡Œè®¿é—®ï¼Œä½†æ˜¯å®ƒå°±åœ¨é‚£é‡Œï¼Œæ‰€ä»¥æ‚¨å¯ä»¥çœ‹åˆ°å®ƒã€‚

### 5ã€‚**åˆ›å»ºæœåŠ¡å™¨**

ç»ˆäºï¼æˆ‘ä»¬ä½¿ç”¨ ApolloServer åˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ã€‚

```
const server = new ApolloServer({
  typeDefs,
  resolvers: {
    Mutation,
    Query
  },
  context: ({ req }) => ({
    ...req,
    db
  })
}) 
```

Enter fullscreen mode Exit fullscreen mode

æ–°çš„ ApolloServer é‡‡ç”¨:

*   **typedef:**æˆ‘ä»¬ç”¨`importSchema('./src/schema.graphql')`å¯¼å…¥çš„
*   **è§£æå™¨:**å¸¦æœ‰å¯¼å…¥æŸ¥è¯¢å’Œçªå˜è§£æå™¨çš„å¯¹è±¡
*   **è¯­å¢ƒ:** *è¶…çº§é‡è¦ï¼*ã€‚åœ¨è¿™é‡Œï¼Œå¯¹äºä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬æ¥å—æ¯ä¸ªè¯·æ±‚(è®°ä½ï¼Œè¿™éƒ½æ˜¯åé¢æŸä¸ªåœ°æ–¹çš„ Express...)å¹¶è¿”å›ä¸€ä¸ªåŒ…å«è¯·æ±‚å‰¯æœ¬çš„æ–°å¯¹è±¡ï¼Œä»¥åŠ`db`ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„ Prisma å®¢æˆ·æœºçš„å®ä¾‹ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•èƒ½å¤Ÿä½¿ç”¨`context.db.[query/mutation].[method]`åœ¨æˆ‘ä»¬æ‰€æœ‰çš„è§£æå™¨ä¸­è®¿é—® Prismaã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨è¿™é‡Œä¸ºæ¯ä¸ªè¯·æ±‚æ·»åŠ äº† Prisma å®¢æˆ·ç«¯ã€‚

### 6ã€‚å¯åŠ¨æœåŠ¡å™¨ï¼

```
server.listen().then(({ url }) => {
  console.log(`ğŸš€ Server ready at ${url}`)
}); 
```

Enter fullscreen mode Exit fullscreen mode

ç±»ä¼¼äº Expressï¼Œä½ å¿…é¡»å‘Šè¯‰æœåŠ¡å™¨å¼€å§‹ç›‘å¬ã€‚

ç°åœ¨æ‚¨å¯ä»¥`nodemon index.js`äº†ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼äº
çš„å†…å®¹

```
âœ  prisma-graphql-tutorial (master) âœ— nodemon index.js
[nodemon] 1.18.10
[nodemon] to restart at any time, enter `rs`
[nodemon] watching: *.*
[nodemon] starting `node index.js`
ğŸš€ Server ready at http://localhost:4000/ 
```

Enter fullscreen mode Exit fullscreen mode

ç„¶åä½ å¯ä»¥å‰å¾€ localhost:4000ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªæ“åœºï¼Œå°±åƒä½ å» Prisma endpoint ä¸€æ ·ã€‚ä¸åŒçš„æ˜¯å®ƒåœ¨ä½ çš„æœåŠ¡å™¨ä¸Šï¼Œä½ å¯ä»¥åœ¨æ“åœºå¤–è®¿é—®å®ƒï¼

### 7ã€‚æµ‹è¯•ä¸€ä¸‹

æ‚¨å¯ä»¥é€šè¿‡åœ¨ localhost playground ä¸­æ‰§è¡Œä¸€ä¸ªç®€å•çš„æŸ¥è¯¢æ¥åšä¸€ä¸ªå¿«é€Ÿæµ‹è¯•ï¼Œçœ‹çœ‹æ˜¯å¦ä¸€åˆ‡é¡ºåˆ©ã€‚

æŠŠè¿™ä¸ªç²˜è´´åˆ°æ“åœºä¸Šï¼Œç‚¹å‡»æ’­æ”¾:

```
mutation {
  createUser(name: "Test Person") {
    name
    id
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

è¿™ä¼šè¿è¡Œåä¸ºâ€œTest Personâ€çš„ createUser å˜å¼‚ï¼Œå¹¶è¯·æ±‚å›åç§°å’Œ idã€‚

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨å°†çœ‹åˆ°è¿™ä¸ªè¿”å›:

```
{
  "data": {
    "createUser": {
      "name": "Test Person",
      "id": "cjtdg3zu35pp70b51fjyj7vd1"
    }
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

## æ­å–œæ­å–œï¼

ä½ å·²ç»å®Œæˆäº†æœåŠ¡å™¨çš„åˆ¶ä½œã€‚å·²ç»æ˜¯ä¸€ç¯‡è¶…çº§é•¿çš„å¸–å­äº†ï¼Œæ‰€ä»¥æˆ‘ç°åœ¨è¦è¯´çš„å°±æ˜¯æœŸå¾…ä»¥åå…³äºå¦‚ä½•ä½¿ç”¨ Apollo Client ä»å®¢æˆ·ç«¯è¿›è¡ŒæŸ¥è¯¢å’Œçªå˜çš„å¸–å­ï¼

å¦‚æœä½ çœ‹åˆ°ä»»ä½•ä¸å¯é çš„ä¸œè¥¿ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼è¿™å®é™…ä¸Šæ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªé˜¿æ³¢ç½—æœåŠ¡å™¨ï¼Œæ‰€ä»¥å®ƒä¼¼ä¹å·¥ä½œæ­£å¸¸ï¼Œä½†è¯·è®©æˆ‘çŸ¥é“å®ƒå¯¹ä½ æ¥è¯´æ€ä¹ˆæ ·ï¼å¦‚æœæœ‰å¸®åŠ©çš„è¯ï¼Œä½ å¯ä»¥åœ¨æˆ‘ä¸‹é¢çš„ git åº“æ‰¾åˆ°è¿™äº›ã€‚

## ![GitHub logo](img/a73f630113876d78cff79f59c2125b24.png) [ç‘å®‰å§†é“å°”](https://github.com/ryanmdoyle) / [æ™®é‡Œæ–¯é©¬-graph QL-æ•™ç¨‹](https://github.com/ryanmdoyle/prisma-graphql-tutorial)

### å…³äº Prismaã€GraphQL å’Œ Apollo è®¾ç½®çš„åšå®¢ç³»åˆ—ã€‚