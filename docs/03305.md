# ğŸ˜¼KittenRouter:å¼€æºğŸ”å¼¹æ€§æœç´¢ç›‘æ§ã€è®°å½•å’ŒğŸš¦webtraffic çš„æ•…éšœåˆ‡æ¢(ä½¿ç”¨â˜ï¸ Cloudflare å·¥ä½œäººå‘˜)

> åŸæ–‡:[https://dev . to/ui licious/elastic search-monitoring-logging-failover-of-web traffic-using-open source-kitten router-with-cloud flare-workers-4 BF3](https://dev.to/uilicious/elasticsearch-monitoring-logging-failover-of-webtraffic-using-opensource-kittenrouter-with-cloudflare-workers-4bf3)

<figure>

[![KittenRouter logo](../Images/61573fd09cee48ddf33ddb04992aa0cb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--4mY8XlVL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1j3qpkan01o7c2n9ugg1.png)

<figcaption>Special thanks to Nai Jie for the logo (he also did InboxKitten logo)</figcaption>

</figure>

# [](#introducing-kittenrouter-serverless-cousins-to-inboxkitten)å‘ InboxKitten ä»‹ç» KittenRouter -æ— æœåŠ¡å™¨è¡¨å…„å¼Ÿ

å› ä¸ºæˆ‘ä»¬åœ¨ API ä¸­ä½¿ç”¨äº† Cloudflare æ— æœåŠ¡å™¨ç»„ä»¶ã€‚ä¸ºä»€ä¹ˆä¸æŠŠå®ƒæ‰©å±•åˆ° UI èµ„äº§å‘¢ï¼Ÿ

*   åœ¨ cloudflare ä¸Šè®°å½•æ¯ä¸ª web è¯·æ±‚(è¿™æ˜¯[ä¼ä¸šç‹¬æœ‰çš„åŠŸèƒ½](https://support.cloudflare.com/hc/en-us/articles/216672448-Cloudflare-Logs-formerly-ELS-))ï¼Œå¸®åŠ©æˆ‘ä»¬è·Ÿè¸ªæœåŠ¡å™¨æ•…éšœã€‚
*   æœåŠ¡å™¨å‡ºé”™æ—¶è‡ªåŠ¨è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œä»¥ç»´æŠ¤æ•´ä½“ç«™ç‚¹å¯ç”¨æ€§(é«˜å¯ç”¨æ€§ï¼).
*   å…¨éƒ¨ä½œä¸ºå¯é‡ç”¨çš„ç±»æ¨¡å—

æŒ‰ç…§[â€œåšä¸€ä»¶äº‹å¹¶æŠŠå®ƒåšå¥½â€](https://en.wikipedia.org/wiki/Unix_philosophy)çš„ç†å¿µä¿æŒé¡¹ç›®çš„å°è§„æ¨¡ï¼Œä¼ªä»£ç å¯ä»¥æ€»ç»“å¦‚ä¸‹ã€‚

```
when receiving a request {
   for( each backend configuration ) {
      if (invalid backend configuration - wrong domain, etc) {
         continue - to next backend configuration iteration
      }
      perform cachable request to the backend
      log request to ElasticSearch backend - or alternative log provider
      if( 
         request result is valid || 
         is last configuration || 
         default backend configuration
      ) {
         return result - Ends request processing
      }
      continue - to next backend configuration iteration
   }      
}

# PS: The above is conceptually the synchronous flow. In the actual
# implementation, logging should occur asynchronously without blocking 
```

è¿™å…è®¸æˆ‘ä»¬åœ¨åç«¯é…ç½®å†—ä½™ï¼Œé¦–å…ˆæ˜¯ commons.host æœåŠ¡å™¨ï¼Œç„¶åæ˜¯ firebase ä½œä¸ºâ€œå¤‡ä»½â€ã€‚

* * *

# [](#background-context-why-we-made-this)èƒŒæ™¯è¯­å¢ƒ(æˆ‘ä»¬ä¸ºä»€ä¹ˆåšè¿™ä¸ªï¼Ÿ)

[![picocreator image](../Images/9d01ba033264443700b6c4fc664da969.png)](/picocreator) [## æˆ‘ä»¬ä¸ºä»€ä¹ˆè¿ç§»å¼€æºğŸ˜¼inbox kitten(7700 ä¸‡ä¸ªæ— æœåŠ¡å™¨è¯·æ±‚)æ¥è‡ªğŸ”¥â˜ï¸Cloudflare å·¥äººå’ŒğŸ‘CommonsHost

### Eugene Cheah Mar 27 ' 196 åˆ†é’Ÿé˜…è¯»

#showdev #whywe #serverless #javascript](/uilicious/why-we-migrated-serverless-inboxkitten-from-firebase-to-cloudflare-workers-and-commonshost-gd3)

å½“æˆ‘ä»¬å°† UI å‰ç«¯ä» Firebase è¿ç§»åˆ° [Commons æ—¶ã€‚Host(ä¸€ä¸ªå¼€æºå’Œå…¬å…± CDN/é™æ€ä¸»æœºæä¾›å•†)](https://commons.host/)ï¼Œæˆ‘ä»¬é¢ä¸´çš„ä¸€ä¸ªé—®é¢˜æ˜¯éšæœºè¿œç¨‹ä½ç½®çš„éšæœº 404ã€‚æ¯”å¦‚ä¿„ç½—æ–¯â€”â€”å¯èƒ½æ˜¯å› ä¸ºé‚£é‡Œç¼ºå°‘æœåŠ¡å™¨ã€‚

<figure>

[![Commonshost Global Map](../Images/70b3793b2280a77a63a4379d8270c594.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--T5vs1czY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mpy4xba5ennrfjt3phh9.png)

<figcaption>Commons.host, server locations at point of writing</figcaption>

</figure>

å› ä¸ºæˆ‘ä»¬æ˜¯ä¸æ–­å‘å±•çš„ğŸ‡¸ğŸ‡¬å…±äº«ä¸»æœºé¡¹ç›®çš„æ”¯æŒè€…ï¼Œæˆ‘ä»¬å†³å®šå°†ä»–ä»¬ä¸€èµ·è¢–æ‰‹æ—è§‚ï¼Œè€Œä¸æ˜¯æŠ›å¼ƒä»–ä»¬çš„æ›¿ä»£å“ã€‚

æˆ‘ä»¬éœ€è¦ä¸€ç§æ›´å¥½çš„æ–¹æ³•æ¥è°ƒè¯•è¿™äº›é—®é¢˜ï¼ŒåŒæ—¶æé«˜æœåŠ¡çš„æ•´ä½“å¯é æ€§ã€‚

> ä»»ä½•è€å¤§å“¥å½“å±€æ³¨æ„ï¼Œæˆ‘ä»¬åªè·Ÿè¸ªé™æ€èµ„äº§åŠ è½½ä¸ inboxkitten.com çš„ IP åœ°å€å±è”½ã€‚API ä¸Šä¸åšä»»ä½•æ—¥å¿—è®°å½•ã€‚æ‰€ä»¥ï¼Œä¸è¦éº»çƒ¦é—®æˆ‘è¿™æ ·çš„æ•°æ®ã€‚

* * *

# [](#elasticsearch-monitoring-commons-host)Elasticsearch ç›‘æ§:Commons ä¸»æœº

æœ€æ£’çš„æ˜¯ï¼Œä½¿ç”¨ KittenRouter å¯¹æˆ‘ä»¬çš„ commons ä¸»æœºéƒ¨ç½²è¿›è¡Œçš„æ—¥å¿—è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹è·å¾—å…³äºå…¶çŠ¶æ€çš„ç¡¬æ•°æ®ã€‚

<figure>

[![HTTP code logging](../Images/bf4f6100327fc50dc46037b248d94fe7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--x1TAMUef--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ui2rilz7vuv581xg1qm8.png)

<figcaption>78 errors out of 12,069 requests ~ 0.65% failure rate</figcaption>

</figure>

ç›®å‰åœ¨è¿™æ ·çš„è®¾ç½®ä¸­ï¼Œæˆ‘ä»¬æœ‰ 99.35%çš„æµé‡æ˜¯é€šè¿‡ commons.host çš„å…è´¹å…¬å…±æœåŠ¡å™¨è·¯ç”±çš„ã€‚

å¯¹äºå…¶ä½™ 0.65%å¤±è´¥çš„è¯·æ±‚ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨é€€å›åˆ° firebase åŸºç¡€æ¶æ„çš„ç©ºé—²å±‚ã€‚

è™½ç„¶è¿˜ä¸åˆ° 9 ä¸ª 9ï¼Œä½†è€ƒè™‘åˆ°è¿™äº› commons.host æœåŠ¡å™¨å’Œ cloudflare æœåŠ¡å™¨åˆ†æ•£åœ¨ä¸–ç•Œå„åœ°ã€‚[åœ¨å¤§å¤šæ•° cdn çš„ 98%çœŸå®ç”¨æˆ·æŒ‡æ ‡èŒƒå›´å†…](https://www.cdnperf.com/#!rum)

[![Commons host dashboard](../Images/ac85e41d2a20dba3ad2aeac36e24082a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--BALDD7Aq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/4f3n8js8c6mzd2vlhwgb.png)

æ­¤å¤–ï¼Œæœ‰äº†æä¾›çš„å¤´ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿè¸ªæ¯ä¸ªæœåŠ¡å™¨çš„é”™è¯¯ç‡ã€‚å€ŸåŠ© Cloudflare ä¸Šçš„ KittenRouter è®¾ç½®ï¼Œæ‚¨å¯ä»¥ä¸ºä»»ä½•ç°æœ‰ç«™ç‚¹é…ç½®æ­¤ç±»ç›‘æ§ï¼Œè€Œæ— éœ€æ›´æ”¹åº”ç”¨ç¨‹åºä»£ç ã€‚

æ­¤åï¼Œæˆ‘ä»¬å‘ commons.host å›¢é˜Ÿæä¾›äº†å¯¹ä¸Šè¿° elasticsearch é›†ç¾¤çš„è®¿é—®ï¼Œä»¥ä¾¿åœ¨çœŸå®ç”¨æˆ·è´Ÿè½½ä¸‹æå–å…³äºå…¶åŸºç¡€è®¾æ–½çš„æœ‰ç”¨æ•°æ®ã€‚

> æ¾„æ¸…è¯´æ˜ï¼Œå‡ºäºéšç§åŸå› ï¼Œcommons.host ä¸ä¼šåœ¨å…¶ç³»ç»Ÿä¸Šä¸ºå…¶å¹³å°ä¸Šæ‰˜ç®¡çš„ç«™ç‚¹æ‰§è¡Œè¿™ç§çº§åˆ«çš„æ—¥å¿—è®°å½•ã€‚
> 
> æˆ‘ä»¬åœ¨ Uilicious çš„ç›®çš„æ˜¯ä¸ºä»–ä»¬æä¾›æœåŠ¡å™¨çš„æœ‰ç”¨çš„çœŸå®ä¸–ç•Œä½¿ç”¨æŒ‡æ ‡ï¼Œå¹¶æœ‰æ•ˆåœ°ä½¿æˆ‘ä»¬çš„ç½‘ç«™ inboxkitten.com å…äºè¿™ç§éšç§ä¿æŠ¤ï¼Œä»¥å¸®åŠ©ä»–ä»¬æ”¹å–„æœåŠ¡ã€‚

* * *

# [](#elasticsearch-monitoring-inboxkitten)Elasticsearch ç›‘æ§:InboxKitten

[![KittenRouter world map](../Images/163eec4072bb6089aa28d5e44d700716.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--mzV3gR_y--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/x54ehgmxsfkkicfke089.png)

æœ€åï¼Œæˆ‘ä»¬èƒ½å¤Ÿè½»æ¾åœ°ä½¿ç”¨ cloudflare å›½å®¶ä»£ç æ¥å¸®åŠ©æˆ‘ä»¬è·Ÿè¸ªæˆ‘ä»¬çš„å°çŒ«ä¸–ç•Œç»Ÿæ²»åœ°å›¾- liveï¼ã€‚å–µ-å“ˆå“ˆå“ˆï¼

> æ ¼é™µå…°å’Œé©¬è¾¾åŠ æ–¯åŠ â€”â€”æˆ‘å¤©ç”Ÿå°±æœ‰ä¸€åŒçŒ«çœ¼ç›¯ç€ä½ ï¼

* * *

# [](#cool-where-can-i-get-the-code)çˆ½ï¼æˆ‘èƒ½åœ¨å“ªé‡Œå¾—åˆ°ä»£ç 

æœ‰å…³éƒ¨ç½²å’Œé…ç½®çš„è¯¦ç»†ä¿¡æ¯...

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png) [å°¤åˆ©è¥¿æ–¯](https://github.com/uilicious) / [åŸºå»·ç½—ç‰¹](https://github.com/uilicious/KittenRouter)

<article class="markdown-body entry-content container-lg" itemprop="text">

# ä»€ä¹ˆæ˜¯ KittenRouter

KittenRouter æ˜¯ç”¨äº [Cloudflare Workers](https://www.cloudflare.com/products/cloudflare-workers/) çš„è·¯ç”±è„šæœ¬ï¼Œå®ƒå°è¯•è¿æ¥åˆ°æŒ‡å®šæœåŠ¡å™¨çš„åˆ—è¡¨ï¼Œå¹¶å°†è¯·æ±‚é‡å®šå‘åˆ°åœ¨è¯¥æ—¶é—´ç‚¹å½“å‰â€œæ´»åŠ¨â€çš„ä»»ä½•æœåŠ¡å™¨ã€‚å½“æ‚¨çš„æœåŠ¡å™¨å¯èƒ½åœæœºæˆ–æ— æ³•å¤„ç†è¯·æ±‚æ—¶ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ï¼ŒKittenRouter å¯ä»¥è‡ªåŠ¨å°è¯•å°†è¯·æ±‚é‡å®šå‘åˆ°ä¸‹ä¸€ä¸ªé…ç½®çš„ URL è¿›è¡Œå¤„ç†ã€‚

åŒæ—¶ï¼Œå®ƒå¯ä»¥è¢«é…ç½®ä¸ºå°†ä¿¡æ¯è®°å½•åˆ°æ‚¨çš„ ElasticSearch æœåŠ¡å™¨ä¸Šï¼Œç”¨äºåˆ†æç›®çš„ã€‚è®°å½•çš„ä¸€äº›ä¿¡æ¯æ˜¯æœåŠ¡å™¨çš„çŠ¶æ€ã€è¯·æ±‚çš„å›½å®¶ç­‰ã€‚æœ‰å…³å…¨éƒ¨ç»†èŠ‚ï¼Œè¯·å‚è§`index.js`æ–‡ä»¶ã€‚

# å¦‚ä½•ä½¿ç”¨ KittenRouter

æœ€ç»ˆï¼ŒKittenRouter å°†ä¸ Cloudflare workers ä¸€èµ·ä½¿ç”¨ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åœ¨ Cloudflare worker è„šæœ¬ä¸Šä½¿ç”¨ KittenRouterï¼Œ

1.  ä½¿ç”¨ NPM æ¨¡å—
2.  æ‰‹åŠ¨æ·»åŠ  KittenRouter

### 1)

â€¦</article>

[View on GitHub](https://github.com/uilicious/KittenRouter)

[æˆ–è€… NPM](https://www.npmjs.com/package/kittenrouter)

* * *

# [](#thats-cool-but-why-do-i-even-need-inboxkitten-disposable-email-for-again)å¤ªé…·äº†ï¼Œä½†ä¸ºä»€ä¹ˆæˆ‘è¿˜è¦å†æ¬¡ç”¨ Inboxkitten ä¸€æ¬¡æ€§é‚®ç®±å‘¢ï¼Ÿ

å½“å‰çš„ä¸€ä¸ªå…³é”®ç”¨ä¾‹ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ„å»ºè¿™ä¸ªé¡¹ç›®çš„åŸå› ï¼Œæ˜¯æ‰§è¡Œç”µå­é‚®ä»¶éªŒè¯ä½œä¸ºæˆ‘ä»¬è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬çš„ä¸€éƒ¨åˆ†ã€‚æ¯”å¦‚ä¸‹é¢çš„...

```
 // Lets goto inbox kitten
I.goTo("https://inboxkitten.com");
I.see("Open-Source Disposable Email");

// Go to a random inbox inbox 
I.fill("email", SAMPLE.id(22));
I.click("Get Mail Nyow!");

// Check that its empty
I.see("There for no messages for this kitten :(");

// Testing for regular email
// (sent using a jenkins perodic build)
I.goTo("https://inboxkitten.com");
I.see("Open-Source Disposable Email");
I.fill("email", "ik-reciever-f7s1g28");
I.click("Get Mail Nyow!");

// See an email we expect, nyow
I.see("Testing inboxkitten subject"); 
```

å¯å…±äº«çš„æµ‹è¯•ç»“æœï¼Œä¾‹å¦‚

[](https://snippet.uilicious.com/test/public/7t74nVS828weKMtzGgJppF)

<figure>[![uilicious demo](../Images/3013c149fffa5ecaad468994047f3e94.png)](https://snippet.uilicious.com/test/public/7t74nVS828weKMtzGgJppF)</figure>

æ­¤å¤–ï¼Œå®ƒç®€å•ã€é…·ã€æœ‰è¶£ã€‚

* * *

# KittenRouter çš„ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ

# [![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png) éå¸¸ç²—ç•¥çš„ KittenRouterã€3ã€‘](https://github.com/uilicious/KittenRouter/issues/3)æ‰€éœ€çš„æ”¹è¿›è·¯çº¿å›¾

[![PicoCreator avatar](../Images/7d9c85b16a139dfe22b8918d388ce270.png)](https://github.com/PicoCreator) **[PicoCreator](https://github.com/PicoCreator)** posted on [<time datetime="2019-05-10T08:20:20Z">May 10, 2019</time>](https://github.com/uilicious/KittenRouter/issues/3)

æ¥ä¸‹æ¥æ˜¯ä»€ä¹ˆï¼Ÿä¸ºäº† KittenRouter

*   æ›´å¤šå¯é…ç½®çš„åç«¯é€‰é¡¹
    *   è¯·æ±‚åŸŸï¼Œè·¯å¾„ï¼ŒåŒºåŸŸ
    *   è¯·æ±‚è¶…æ—¶
    *   é”™è¯¯/ä¼ é€’ HTTP ä»£ç æ§åˆ¶
    *   è‡ªå®šä¹‰æ ‡é¢˜æ§ä»¶
    *   ä½œä¸ºç‰¹å®š IP ä¸Šçš„æŒ‡å®šåŸŸæ‰§è¡Œè¯·æ±‚
*   æ›´å¤šæ—¥å¿—é€‰é¡¹
    *   å‚æ•°è®°å½•ç™½åå•/é»‘åå•
        *   å¤´çƒ
        *   é¥¼å¹²
*   æ›´å¤šæ—¥å¿—è®°å½•æä¾›ç¨‹åº
    *   ï¼Ÿï¼Ÿï¼Ÿ

[View on GitHub](https://github.com/uilicious/KittenRouter/issues/3)

è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ª InboxKitten ä¹‹æ—…æ¥ä¸‹æ¥ä¼šèµ°å‘ä½•æ–¹...åœ¨é‚£ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šç¡ä¸ªåˆè§‰ï¼

[![Cat sleeping](../Images/0ac0565b100727fe92157fc54d88a85d.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--RN8MuqYx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8fmx06l7bnvogfxptd1f.jpg)

* * *

# [](#happy-shipping)å¿«ä¹èˆªè¿ğŸ––ğŸ¼ğŸš€