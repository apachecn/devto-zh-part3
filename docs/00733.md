# Flow 0.99:å¯è°ƒç”¨å±æ€§ã€å‡½æ•°é™æ€ç­‰ç­‰

> åŸæ–‡:[https://dev . to/wgao 19/flow-0-99-callable-properties-function-statics-and-more-5c 82](https://dev.to/wgao19/flow-0-99-callable-properties-function-statics-and-more-5c82)

[å°é¢å›¾ç‰‡:æ—¶é—´#9 çš„æ–‡å­—](https://unsplash.com/photos/PwQHfxo3Q2Y)

æµé‡[å‰å‡ å¤©å‘å¸ƒäº† 0.99](https://github.com/facebook/flow/releases/tag/v0.99.0) ( [å¯¹æ¯”å˜åŒ–](https://github.com/facebook/flow/compare/v0.98.0...v0.99.0))ã€‚è¯¥ç‰ˆæœ¬åŒ…å«å›´ç»•å¯è°ƒç”¨å±æ€§ã€å‡½æ•°é™æ€ã€æ¥è‡ª React ç»„ä»¶é¢†åŸŸçš„æ›´å¤šå®ç”¨ç¨‹åºã€é”™è¯¯ä¿®å¤å’ŒæµæœåŠ¡å™¨æ€§èƒ½æ”¹è¿›çš„æ›´æ”¹ã€‚

æˆ‘å†ä¸€æ¬¡ä½¿ç”¨è¿™äº›é›¶ç¢çš„ä¸œè¥¿æ¥ç†è§£æ›´å¤šå…³äº Flow å’Œ JavaScript çš„çŸ¥è¯†ï¼Œè¿™ä¸€æ¬¡ä¸»è¦æ˜¯å…³äºå¯è°ƒç”¨çš„å±æ€§å’Œå‡½æ•°é™æ€ï¼Œæˆ‘å°†åœ¨è¿™ç¯‡æ–‡ç« ä¸­åˆ†äº«ã€‚

## [](#function-statics)ğŸ¾åŠŸèƒ½é™åŠ›å­¦

ä¸‹é¢æ˜¯ä¸€ä¸ªå¯¼è‡´æˆ‘ä»¬ä»£ç åº“å‡ºç°æ–°é”™è¯¯çš„å˜åŒ–:

**[ä½¿å‡½æ•°ç±»å‹é™åŠ›å­¦æ›´ä¸¥æ ¼](https://github.com/facebook/flow/commit/b868f61026b9b34cb22c3f59e1bcbb65a614c71b)**

> åœ¨è¿™ä¸€æ”¹å˜ä¹‹å‰ï¼Œæˆ‘ä»¬ä¹è§‚åœ°å°†å‡½æ•°ç±»å‹çš„é™æ€ç±»å‹è¾“å…¥ä¸º`any`ï¼Œå‡è®¾å‡½æ•°ä¸ä¼šè¢«ç”¨ä½œå¯¹è±¡ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„ä¹è§‚æ˜¯æ²¡æœ‰æ ¹æ®çš„ã€‚
> 
> è¿™ä¸ª diff å°†å‡½æ•°ç±»å‹çš„ statics å¯¹è±¡çš„ç±»å‹æ›´æ”¹ä¸ºä¸€ä¸ªç©ºçš„ã€ä¸ç²¾ç¡®çš„å¯¹è±¡ç±»å‹ï¼ŒFunction.prototype ç”¨äºå…¶ **proto** ã€‚å°±è¿è¡Œæ—¶è¡Œä¸ºè€Œè¨€ï¼Œè¿™ä¸ªé€‰æ‹©æ˜¯åˆç†çš„ï¼ŒåŒæ—¶ä¹Ÿå…è®¸å…·æœ‰é™æ€çš„å‡½æ•°é€šè¿‡å®½åº¦å­ç±»å‹æˆä¸ºæœ‰æ•ˆçš„å­ç±»å‹ã€‚

æ˜¯æ—¶å€™å›é¡¾ä¸€ä¸‹ JavaScript äº†ã€‚ä»€ä¹ˆæ˜¯*å‡½æ•°é™åŠ›å­¦*ï¼Ÿ

å¯¹äºä¸€ä¸ª JavaScript *ç±»*ï¼Œä¸€ä¸ª [*é™æ€æ–¹æ³•*](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes#Static_methods) æ˜¯è¯¥ç±»çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯è¯¥ç±»çš„å®ä¾‹ã€‚

å¯¹äºä¸€ä¸ª JavaScript çš„*å‡½æ•°*ï¼Œ*é™æ€*æŒ‡çš„æ˜¯é‚£äº›å¥‡æ€ªçš„æ—¶åˆ»ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªå˜é‡ï¼Œå¯ä»¥é€šè¿‡è¯´å‡½æ•°åç‚¹å˜é‡åæ¥è®¿é—®ï¼Œå› ä¸ºå‡½æ•°åœ¨ JavaScript ä¸­ä¹Ÿæ˜¯å¯¹è±¡ğŸ¤·ğŸ»â€â™€ï¸.è€ƒè™‘è¿™ä¸ªå¸¦æœ‰è®¡æ•°å™¨çš„é—®å€™å‡½æ•°:

```
function greeting(name) {
  if (!greeting.counter) {
    greeting.counter = 0
  }
  greeting.counter++
  return 'hello, ' + name
} 
```

å› æ­¤ï¼Œè¿™ä¸€å˜åŒ–è¡¨æ˜ï¼Œä»¥å‰çš„æµç¨‹æ²¡æœ‰å¯¹å‡½æ•°é™æ€è®¾ç½®ä»»ä½•é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬è¢«ç±»å‹åŒ–ä¸º`any`ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè¿™æ„å‘³ç€`greeting.counter`æ˜¯`any`çš„ä¸€ä¸ªå­—æ®µï¼Œå› æ­¤ä¸å—é™åˆ¶ã€‚

æ‚¨å¯ä»¥é”®å…¥å‡½æ•° staticsï¼Œä¾‹å¦‚:

```
function greeting(name) {
  (greeting.counter: number)
  if (!greeting.counter) {
    greeting.counter = 0;
  }
  greeting.counter++;
  return 'hello, ' + name;
} 
```

åœ¨[ä¸­å°è¯•æµ](https://flow.org/try/#0PTAEAEDMBsHsHcBQjIFcB2BjALgS1uqAOYBOApmXukQBToCGAtmQJSgDeiooNpFVRAHSZYGbGRIAuUOlSMARhJZdQuSDwCEfSrmrDR6cSTadu3bQP1iJoALygADAG4VAXxUXdQkdZIBqPxducmxUEkIAcgALMmg4ABpQCNA-GSYyF1cgA)å¹¶æ³¨æ„ï¼Œå¦‚æœæ‚¨å°†`counter`çš„æ³¨é‡Šæ›´æ”¹ä¸º`string`ï¼Œæµå°†æ•è·é”™è¯¯:

```
4:   (greeting.counter: string)
      ^ Cannot cast `greeting.counter` to string because number [1] is incompatible with string [2].
References:
6:     greeting.counter = 0;
                          ^ [1]
4:   (greeting.counter: string)
                        ^ [2] 
```

### [](#%F0%9F%90%BF-new-error-in-our-codebase)ğŸ¿æˆ‘ä»¬ä»£ç åº“ä¸­çš„æ–°é”™è¯¯

ç„¶è€Œï¼Œåœ¨æˆ‘ä»¬çš„ä»£ç åº“ä¸­å‘ç”Ÿçš„çœŸæ­£é”™è¯¯æœ‰æ‰€ä¸åŒã€‚

æˆ‘ä»¬ç¼–å†™ Redux åŠ¨ä½œï¼Œå°†æ•°æ®å°è£…åœ¨ä¸€ä¸ªé€šå¸¸ç§°ä¸º*æœ‰æ•ˆè½½è·*çš„å­—æ®µä¸­ã€‚æˆ‘ä»¬é€šå¸¸è¿™æ ·æ ‡æ³¨æœ‰æ•ˆè½½è·:

```
type ActionPayload = {
  data: string,
  error: string,
} 
```

æœ‰æ—¶`payload`å¯ä»¥æ˜¯ä¸€ä¸ªè¿”å›åŒ…å«æ•°æ®çš„å¯¹è±¡çš„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¾ˆé«˜å…´çœ‹åˆ°è¿™ä¸ª:

```
const fetchData = ({
  type,
  payload,
}: {
  type: 'FETCH_DATA',
  payload: () => ActionPayload,
}) => {
  // function body
} 
```

ä½†æ˜¯ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°å½¢å¼ä¸­è¾“å…¥äº†é”™è¯¯çš„æœ‰æ•ˆè½½è·ï¼Œè€Œæœ‰æ•ˆè½½è·å®é™…ä¸Šåªæ˜¯å¯¹è±¡ã€‚æ‰€ä»¥æˆ‘ä»¬çš„ä»£ç è¿è¡Œè‰¯å¥½ï¼Œæ²¡æœ‰äººæ³¨æ„åˆ°æ³¨é‡Šæ ¹æœ¬æ²¡æœ‰æ„ä¹‰:

```
const fetchData = ({
  type,
  payload,
}: {
  type: 'FETCH_DATA',
  payload: () => ActionPayload, // <- wrooooong, or not?
}) => {
  return payload.data
} 
```

åœ¨ 0.99 å¤„ï¼Œç”±äºå‡½æ•°é™æ€ç°åœ¨è¢«ç±»å‹åŒ–ä¸º`{}`ï¼ŒæµæŠ±æ€¨æˆ‘ä»¬ä¸èƒ½å¾—åˆ°`data`ï¼Œå› ä¸ºå‡½æ•°ç±»å‹çš„*é™æ€ä¸­ç¼ºå°‘`data`ã€‚*

ç±»ä¼¼çš„åœºæ™¯æ˜¯åŠ¨ä½œå’ŒåŠ¨ä½œåˆ›å»ºè€…çš„æ··åˆã€‚å®ƒä»¬ç»å¸¸è¢«ä¼ æ¥ä¼ å»ï¼Œè¿™ä½¿å¾—æ‰“å­—å˜å¾—æ›´åŠ éº»çƒ¦ã€‚æˆ‘æ„è¯†åˆ°ï¼Œå½“æˆ‘ä»¬è¯•å›¾åœ¨è¿™ä¸ªæ–¹å‘ä¸Šå˜å¾—èªæ˜æ—¶,â€œå¿ƒæµâ€çœŸçš„é˜»ç¢äº†æˆ‘ä»¬ã€‚æˆ‘å–œæ¬¢è¿™ç§çµæ´»æ€§ï¼Œä½†æŠ±æ€¨ä¼šä¸æ–­åœ°é—®æˆ‘è¿™æ˜¯ä¸æ˜¯ä¸€ç§å¥½çš„æ¨¡å¼ï¼Œå¯¹æ­¤æˆ‘è¿˜æ²¡æœ‰ç­”æ¡ˆã€‚

## [](#callable-property-syntax)ğŸ‘¾å¯è°ƒç”¨å±æ€§è¯­æ³•

**[åˆ é™¤å¼ƒç”¨çš„`$call`å±æ€§è¯­æ³•](https://github.com/facebook/flow/commit/cbd64384dccaddaa8461d7850c24419e2217d13e)**

é¦–å…ˆï¼Œä¸ºäº†ä¸è¢«æ··æ·†ï¼Œè¿™æ˜¯*è€Œä¸æ˜¯*[`$call`å®ç”¨ç¨‹åºç±»å‹](https://flow.org/en/docs/types/utilities/#toc-call)ï¼Œå®ƒå¸®åŠ©æ‚¨è·å¾—ç»™å®šå‡½æ•°çš„è¿”å›ç±»å‹ï¼Œæ—¢ä¸è¢«å¼ƒç”¨ä¹Ÿä¸è¢«ç§»é™¤ã€‚

[å¼ƒç”¨çš„`$call`å±æ€§è¯­æ³•](https://github.com/facebook/flow/commit/df8ee96bc84b476f874e300b3cd3c07b430e085b)æ˜¯è¿™ä¸ª[å¯è°ƒç”¨è¯­æ³•](https://github.com/facebook/flow/commit/b9db648afe4f2207a49985aa82b90a485a11a900)çš„å‰èº«ï¼Œæ–°è¯­æ³•çš„æ·»åŠ å’Œæ—§è¯­æ³•çš„å¼ƒç”¨éƒ½å‘ç”Ÿåœ¨ [0.75](https://github.com/facebook/flow/releases/tag/v0.75.0) ä¸­ã€‚

é‚£ä¹ˆå®ƒä»¬åˆ°åº•æ˜¯å…³äºä»€ä¹ˆçš„å‘¢ï¼Ÿ

å®ƒè”ç³»åˆ°æˆ‘ä»¬å‰é¢æåˆ°çš„äº‹å®ï¼ŒJavaScript å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰è¶£çš„å…³äºå¿ƒæµçš„è§‚ç‚¹:

> å…·æœ‰å¯è°ƒç”¨å±æ€§çš„å¯¹è±¡å¯ä»¥ç­‰æ•ˆåœ°è§†ä¸ºå…·æœ‰é™æ€å­—æ®µçš„å‡½æ•°ã€‚

ç»“æœæ˜¯:

```
// You should be able to call objects with call properties
function a(f: { (): string }, g: { (x: number): string }): string {
  return f() + g(123)
}

// ...and get an error if the return type is wrong
function b(f: { (): string }): number {
  return f()
} 
```

åŒæ ·:

```
// You should be able to use an object as a function
function a(x: { (z: number): string }): (z: number) => string {
  return x
} 
```

æœ€ä»¤æˆ‘æƒŠè®¶çš„#TIL å¯èƒ½æ˜¯è¿™ä¸ª:

```
// Multiple call properties should also be supported
function a(f: { (): string, (x: number): string }): string {
  return f() + f(123)
}

// It should be fine when a function satisfies them all
var b: { (): string, (x: number): string } = function(x?: number): string {
  return 'hi'
} 
```

è¿™æ˜¯å¦ä¸€ä¸ªæé†’æˆ‘ä»¬å…³äºå‡½æ•°çš„ä¾‹å­ï¼Œé‚£äº›ç”±åŸå‹å®ç°çš„ä¸€å…ƒé“¾å¼è°ƒç”¨å¯ä»¥å½’ç»“ä¸ºå‡½æ•°ä¸­çš„ä¸€ä¸ªå­—æ®µ:

```
// Expecting properties that do exist should be fine
var b: { apply: Function } = function() {} 
```

è¿™æ˜¯å¿ƒæµæ‹¥æœ‰çš„ä¸€ä¸ªéå¸¸æœ‰è¶£çš„ç‰¹æ€§ï¼è¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨ Flow æ¥æ³¨é‡Šè®°å¿†åŒ–çš„å‡½æ•°ï¼Œè€Œæˆ‘åœ¨å­¦ä¹ è¿™äº›ä¹‹å‰ä»æ¥æ²¡æœ‰æƒ³åˆ°è¿‡è¿™ä¸€ç‚¹ã€‚è€ƒè™‘ä¸€ä¸ª*è®°å¿†é˜¶ä¹˜* ( [å°è¯•æµ](https://flow.org/try/#0PTAEAEDMBsHsHcBQiAuBPADgU1AWSwLawCWAXlgCYBiAhgMYqwBOxN0AKpjgLygDeiUKDr0AFlgBc-QaACQAbQB2AVwIAjLEwC6Ules0yAvgBoZ8+SOjQtWgBR6NTAJS7Vj04eR1YigM4pQSHpGFjYpfCIySloGZlYOLlBeRSSAPmkhYkhQWwBCINjQ6AA6ETpxJwyhQOC4tlKxHn5PIRbQLJyCkPiG8qwlLVBc7l5lRQosSGJFSkqBatAmLBRlJhSuupKy8QGjGQ2i3p3FQeSkkdAABlAAflAARlBdUAAqGsL4+1AAWgenGSWKzW7269W2-ROiEMQA))ï¼Œä½ å¯ä»¥ç”¨æµ:
æ¥è¡¨è¾¾å®ƒ

```
type MemoizedFactorialType = {
  cache: {
    [number]: number,
  },
  [[call]](number): number,
}

const factorial: MemoizedFactorialType = n => {
  if (!factorial.cache) {
    factorial.cache = {}
  }
  if (factorial.cache[n] !== undefined) {
    return factorial.cache[n]
  }
  factorial.cache[n] = n === 0 ? 1 : n * factorial(n - 1)
  return factorial.cache[n]
} 
```

* * *

åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œå›´ç»•å¯è°ƒç”¨å±æ€§è¿˜æœ‰ä¸€äº›å˜åŒ–ï¼Œæˆ‘å°†åˆ—å‡ºå®ƒä»¬çš„å‚è€ƒ:

*   [ä¿®å¤å¸¦æœ‰`[[call]]`å±æ€§](https://github.com/facebook/flow/commit/5d7e01d06b85388882b3214e383d26b73e6de111)çš„å¯¹è±¡çš„éšå¼åŸå‹
*   [å°†å¤šä¸ªè°ƒç”¨å±æ€§å»ºæ¨¡ä¸ºå¯è°ƒç”¨å¯¹è±¡çš„äº¤é›†](https://github.com/facebook/flow/commit/b9e26fd3bf7ba10e8f2f8c4e9c90d7f92afe96e1)
*   [äº¤é›†å¤„ç†å‰å…·ä½“åŒ–å¯è°ƒç”¨å¯¹è±¡å‚æ•°](https://github.com/facebook/flow/commit/0938da8d7293d0077fbe95c3a3e0eebadb57b012)
*   [ä»å‡½æ•°é™æ€ä¸­åˆ é™¤`[[call]]`å±æ€§](https://github.com/facebook/flow/commit/3c5a41026f8da473b3869e0ef6d84afa0b978816)

è¿™é‡Œæœ‰å‡ ä¸ªé“¾æ¥æŒ‡å‘ä¸€äº›æ—§çš„æäº¤ï¼Œä½ å¯èƒ½æƒ³çœ‹çœ‹å…³äºå¯è°ƒç”¨çš„å±æ€§:

*   [åœ¨å†…éƒ¨æ§½](https://github.com/facebook/flow/commit/b9db648afe4f2207a49985aa82b90a485a11a900)ä¸­å­˜å‚¨å¯¹è±¡è°ƒç”¨å±æ€§
*   [å¢åŠ å¯¹`[[call]]`å†…éƒ¨æ’æ§½å±æ€§](https://github.com/facebook/flow/commit/954a72704a6338778c940239573045b28c716488)çš„æ”¯æŒ

## [](#other-notable-changes)ğŸ¦–å…¶ä»–æ˜¾è‘—å˜åŒ–

è¿˜æœ‰ä¸€äº›æ›´å€¼å¾—æ³¨æ„çš„å˜åŒ–ï¼Œæˆ‘ç°åœ¨å°±åœ¨è¿™é‡Œåˆ—å‡ºæ¥:

*   [å…è®¸ç®­å¤´è¿”å›ç±»å‹å†…å…ƒç»„å†…çš„å‡½æ•°ç±»å‹](https://github.com/facebook/flow/commit/65e6d1df078e778d0244d4ee49bd28c741b5af0f)
*   [`React$Config`ã€`React$ElementRef`ã€`React$ElementConfig`å’Œ`React$ElementProps`ç°åœ¨æ˜¯æ•ˆç”¨ç±»å‹](https://github.com/facebook/flow/commit/2ac4372e31a1f3a03ae963ed7a89b2118b862aad)
*   [`Fragment`çš„å­©å­ç°åœ¨å¯ä»¥æ­£ç¡®é€‰æ‹©](https://github.com/facebook/flow/commit/6dd62e0d9e0dd3e65a07310abc67a022e6335e1f)
*   [å­˜åœ¨å‹`*`å·²å¼ƒç”¨](https://github.com/facebook/flow/commit/72462e4f5849f3e5fe27b15bde54aede8b27b8b8)

å¦‚æœä½ å‘ç°å…¶ä¸­ä»»ä½•ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼Œå¹¶å¯¹å®ƒä»¬æœ‰æ‰€äº†è§£ï¼Œè¯·å†™ä¸‹æ¥ï¼Œå› ä¸ºä» 0.85 å¼€å§‹ï¼Œæˆ‘å¯¹å¿ƒæµçš„å­¦ä¹ æ„Ÿè§‰å°±åƒååœ¨è¯¾å ‚ä¸Šï¼Œæ²¡æœ‰äººé—®ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¾ç„¶æ²¡æœ‰å¤šå°‘äººæ˜ç™½å‘ç”Ÿäº†ä»€ä¹ˆğŸ¤¦ğŸ»â€â™€ï¸.ç§ä¸‹é‡Œï¼Œæˆ‘ä¹Ÿä¸å®Œå…¨ç¡®å®šæˆ‘è¯´çš„å…³äºå¿ƒæµçš„äº‹æƒ…ã€‚å¦‚æœä½ å‘ç°ä»»ä½•é”™è¯¯ï¼Œè¯·åŠ¡å¿…è®©æˆ‘çŸ¥é“ã€‚

## [](#till-next-time)ğŸ’¯ä¸‹æ¬¡è§

[æµé‡ 0.100](https://github.com/facebook/flow/releases/tag/v0.100.0) ä¹Ÿè¢«é‡Šæ”¾ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰æ³¨æ„åˆ°ï¼Œå‘è¡Œè¯´æ˜ç°åœ¨é™„å¸¦äº† Try Flow ç¤ºä¾‹ã€‚ä¹Ÿè®¸å¢åŠ çš„æ•°å­—é¢„ç¤ºç€ä¸€ä¸ªæ–°çš„æ—¶ä»£ã€‚