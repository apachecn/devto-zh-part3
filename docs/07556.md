# å­¦ä¹ æŠ˜å ä½ çš„ JS æ•°ç»„

> åŸæ–‡:[https://dev.to/mebble/learn-to-fold-your-js-arrays-2o8p](https://dev.to/mebble/learn-to-fold-your-js-arrays-2o8p)

æ‚¨å¯èƒ½é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µï¼Œæ‚¨éœ€è¦è·å–ä¸€ç»„å€¼å¹¶â€œæ”¶é›†â€å®ƒä»¬ã€‚æˆ‘çš„æ„æ€æ˜¯åœ¨æ•°ç»„ä¸Šæ‰§è¡Œä¸€äº›æ“ä½œï¼Œè¿™æ ·æˆ‘ä»¬æœ€ç»ˆå¯ä»¥åªè·å¾—ä¸€ä¸ªå€¼ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªä¾‹å­ã€‚

ä½ ä»¥å‰è‚¯å®šå¯¹ä¸€ç»„æ•°å­—æ±‚å’Œ:

```
function sum(numbers) {
    let acc = 0;
    for (const num of numbers) {
        acc = add(acc, num);
    }
    return acc;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ–è€…å¾—åˆ°ä¸€ç»„æ•°å­—çš„ä¹˜ç§¯:

```
function prod(numbers) {
    let acc = 1;
    for (const num of numbers) {
        acc = mult(acc, num);
    }
    return acc;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ–è€…åœ¨ä¸€ç»„æ•°å­—ä¸­æ‰¾å‡ºæœ€å¤§çš„æ•°å­—:

```
function maximum(numbers) {
    let acc = -Infinity;
    for (const num of numbers) {
        acc = max(acc, num);
    }
    return acc;
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨æ¯ä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éƒ½å–äº†ä¸€ç»„ä¸œè¥¿ï¼Œå¹¶æ‰§è¡Œäº†ä¸€äº›æ“ä½œï¼Œå°†è¿™äº›ä¸œè¥¿æ”¶é›†æˆä¸€ä¸ªå•ä¸€çš„ä¸œè¥¿ã€‚

# [](#what-is-a-fold)ä»€ä¹ˆæ˜¯æŠ˜å ï¼Ÿ

ä¸Šè¿°ä¾‹å­æœ‰å‡ ä¸ªå…±åŒç‚¹ã€‚å®ƒä»¬éƒ½åŒ…å«ä¸€äº›éå¸¸ç›¸ä¼¼çš„éƒ¨åˆ†:

*   å­˜æ”¾æœ€ç»ˆç»“æœçš„åœ°æ–¹ï¼Œé€šå¸¸ç§°ä¸ºç´¯ç§¯æˆ–`acc`
*   ç´¯ç§¯çš„åˆå§‹å€¼(0ã€1 å’Œ`-Infinity`)
*   ä¸€ä¸ªäºŒå…ƒè¿ç®—ï¼Œç»“åˆäº†ç´¯åŠ å’Œæˆ‘ä»¬å½“å‰æ­£åœ¨å¤„ç†çš„æ•°ç»„é¡¹(`add`ã€`mult`å’Œ`max`)

æ”¶é›†ç‰©å“çš„è¿‡ç¨‹æ˜¾ç„¶éµå¾ªä¸€ç§æ¨¡å¼ã€‚æˆ‘ä»¬ç›®å‰æ­£åœ¨é‡å¤å¤§é‡çš„ä»£ç ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬èƒ½æŠŠå®ƒæŠ½è±¡æˆä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ä¼šæœ‰æ›´å¹²å‡€ã€æ›´æœ‰è¡¨ç°åŠ›çš„ä»£ç ã€‚è¿™ç§åŠŸèƒ½æœ‰ä¸€ä¸ªåå­—ï¼ŒFold ( [Wikipedia](https://en.wikipedia.org/wiki/Fold_(higher-order_function)) )ã€‚è¿™ä¸ªå‡½æ•°æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„åŸºç¡€ä¹‹ä¸€ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯ç”¨ JS è‡ªå·±å®ç° foldï¼Œä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿ

## [](#a-few-observations)å‡ ç‚¹è§‚å¯Ÿ

å…³äºæŠ˜å ï¼Œæœ‰ä¸‰æ ·ä¸œè¥¿æ˜¯æ²¡æœ‰ä»·å€¼çš„ã€‚

äºŒè¿›åˆ¶è¿ç®—`add`ã€`mult`å’Œ`max`ç§°ä¸º`reducers`ã€‚reducer æ¥å—ä¸¤ä¸ªå€¼â€”â€”å½“å‰ç´¯ç§¯å€¼å’Œå½“å‰æ•°ç»„å…ƒç´ â€”â€”å¹¶è¿”å›æ–°çš„ç´¯ç§¯å€¼ã€‚

åˆå§‹å€¼éœ€è¦æ˜¯ç›¸å¯¹äºå‡é€Ÿå™¨çš„`identity`ã€‚è¿™æ„å‘³ç€å½“åˆå§‹å€¼å’Œå¦ä¸€ä¸ªå€¼`x`ä¸€èµ·ä¼ é€’ç»™å‡é€Ÿå™¨æ—¶ï¼Œè¾“å‡ºæ€»æ˜¯`x`ã€‚ä¾‹å­:
`add(0, x) = x`
`mult(1, x) = x`
`max(-Infinity, x) = x`ã€‚
è¿™é‡Œï¼Œ`0`ã€`1`å’Œ`-Infinity`åˆ†åˆ«æ˜¯ç›¸å¯¹äºå‡é€Ÿå™¨`add`ã€`mult`å’Œ`max`çš„æ ‡è¯†ã€‚æˆ‘ä»¬éœ€è¦å®ƒæ˜¯ä¸€ä¸ª`identity`ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›åˆå§‹ç´¯ç§¯æ˜¯â€œç©ºçš„â€ã€‚`0`ä¸ºç©º w.r.t .æ±‚å’Œï¼Œ`1`ä¸ºç©º w.r.t .ä¹˜ç§¯ã€‚

æ‰€æœ‰æ•°ç»„å…ƒç´ å¿…é¡»æ˜¯ç›¸åŒçš„æ•°æ®ç±»å‹(æ¯”å¦‚è¯´ç±»å‹`A`)ï¼Œä½†æ˜¯ç´¯ç§¯çš„æ•°æ®ç±»å‹(æ¯”å¦‚è¯´`B`)ä¸å¿…ä¸æ•°ç»„å…ƒç´ çš„æ•°æ®ç±»å‹ç›¸åŒã€‚ä¾‹å¦‚ï¼Œè¿™æ®µä»£ç å°†ä¸€ä¸ªæ•°å­—æ•°ç»„æŠ˜å æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

`// nothing` `const concatNum = (x, y) => x + y.toString(); // concatenates a string x and number y const numbers = [1, 2, 3, 4, 5]; // elements are of type number let acc = ''; // accumulation is of type string for (const num of numbers) { acc = concatNum(acc, num); } console.log(acc);`

æ³¨æ„å‡é€Ÿå™¨çš„æ¥å£å¿…é¡»æ˜¯`reducer(acc: B, x: A): B`ï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯

```
concatNum(acc: string, x: number): string 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

# [](#creating-a-fold)åˆ›å»ºä¸€ä¸ªæŠ˜å 

è¯´äº†å¾ˆå¤šã€‚è®©æˆ‘ä»¬æœ€ç»ˆå®ŒæˆæŠ˜å ã€‚fold æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°(å¯¹äº HOF introï¼Œæˆ‘å¼ºçƒˆæ¨è[é›„è¾©çš„ Javascript](http://eloquentjavascript.net/05_higher_order.html#h_xxCc98lOBK) )ï¼Œå®ƒæ¥å—ä¸€ä¸ªç¼©å‡å™¨(ä¸€ä¸ªå‡½æ•°)ã€ä¸€ä¸ªç´¯ç§¯åˆå§‹å€¼å’Œä¸€ä¸ªæ•°ç»„(æ›´æ­£å¼çš„è¯´æ³•æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè¿™æ˜¯[JS æ•°ç»„æ˜¯ä»€ä¹ˆ](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array#Description))ã€‚

æˆ‘ä»¬å…ˆæŠŠ add/mult/max å‡é€Ÿå™¨ä¸€èˆ¬åŒ–ï¼Œç§°ä¹‹ä¸º`reducer`(æƒŠå–œï¼).æˆ‘ä»¬ç§°åˆå§‹å€¼ä¸º`init`ã€‚ç„¶åæˆ‘ä»¬æ¦‚æ‹¬äº†ä¸€ç³»åˆ—çš„äº‹æƒ…ã€‚å®ƒå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿çš„æ•°ç»„ï¼Œä¸ä»…ä»…æ˜¯æ•°å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°å®ƒä¸º`xs`ã€‚æˆ‘ä»¬ç°åœ¨å·²ç»å®šä¹‰äº†æŠ˜å ï¼

```
const fold = (reducer, init, xs) => {
    let acc = init;
    for (const x of xs) {
        acc = reducer(acc, x);
    }
    return acc;
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ æ³¨æ„åˆ°è¿™äº›è®ºç‚¹çš„é¡ºåºäº†å—ï¼Ÿæˆ‘ä»¬é¦–å…ˆä¼ å…¥`reducer`ï¼Œæ¥ç€ä¼ å…¥`init`ï¼Œç„¶åä¼ å…¥`xs`ï¼Œè¿™æ˜¯æœ‰åŸå› çš„ã€‚è¿™ä¸[è®¨å¥½](https://medium.com/javascript-scene/curry-and-function-composition-2c208d774983)æœ‰å…³ï¼Œæˆ‘ä»¬æ”¹å¤©å†è°ˆã€‚ä¸Šé¢çš„ä¾‹å­ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·ï¼Œç²—ç®­å¤´æ ·å¼:

```
const sum = xs => fold(add, 0, xs);
const prod = xs => fold(mult, 1, xs);
const maximum = xs => fold(max, -Infinity, xs); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½å¤šäº†ã€‚

å¦‚æœæˆ‘ä»¬æ„¿æ„çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å†…è”ç¼–å†™ reducer:

```
const sum = xs => fold((acc, x) => acc + x, 0, xs);
const prod = xs => fold((acc, x) => acc * x, 1, xs);
const maximum = xs => fold((acc, x) => (acc >= x) ? acc : x, -Infinity, xs); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œæœ‰ä¸€ä¸ªäº¤äº’å¼ç¼–è¾‘å™¨ä¾›æ‚¨ä½¿ç”¨:

`// nothing` `const fold = (reducer, init, xs) => { let acc = init; for (const x of xs) { acc = reducer(acc, x); } return acc; }; const sum = xs => fold((acc, x) => acc + x, 0, xs); const prod = xs => fold((acc, x) => acc * x, 1, xs); const maximum = xs => fold((acc, x) => (acc >= x) ? acc : x, -Infinity, xs); const numbers = [3, 7, 1, 2, 5]; console.log('sum:', sum(numbers)); console.log('product:', prod(numbers)); console.log('maximum:', maximum(numbers));`

å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿå—¯ï¼Œæˆ‘ä»¬æœ‰ç‚¹ä½œå¼Šã€‚æˆ‘ä»¬ä½¿ç”¨äº† for å¾ªç¯(æ›´ç¡®åˆ‡åœ°è¯´æ˜¯ for...è¿™åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸–ç•Œä¸­æ˜¯ä¸€å¤§ç¦å¿Œã€‚ä½¿ç”¨ for å¾ªç¯è¿›è¡Œæ•°æ®è½¬æ¢æ„å‘³ç€æˆ‘ä»¬å¿…é¡»æ”¹å˜ä¸€äº›å¯¹è±¡ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡åœ¨å¾ªç¯ä¸­é‡æ–°åˆ†é…æ¥æ”¹å˜`acc`ã€‚fold çš„çœŸæ­£å‡½æ•°å®ç°å°†ä½¿ç”¨é€’å½’å¹¶é¿å…å˜å¼‚ã€‚æˆ‘ä»¬å°†åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­æ¢è®¨è¿™ä¸ªé—®é¢˜ã€‚

### [](#a-few-notes-for-the-interested)å‡ ä¸ªæœ‰å…´è¶£çš„æ³¨æ„äº‹é¡¹

*   JS å·²ç»æœ‰äº†ä¸€ä¸ª foldï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨æ•°ç»„ä¸Šå¯ç”¨æ–¹æ³•ã€‚å«åš[å‡](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce)ã€‚æ‰€ä»¥æˆ‘æƒ³ä½ å¯ä»¥è¯´æˆ‘ä»¬è‡ªå·±é‡æ–°å®ç°æŠ˜å æ˜¯æ¯«æ— æ„ä¹‰çš„ğŸ¤·â€â™‚ï¸(è™½ç„¶æˆ‘å¸Œæœ›å®ƒèƒ½å¸®åŠ©ä¸€äº› FP æ–°æ‰‹)ã€‚
*   å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† for...ä¸æ™®é€šçš„ for å¾ªç¯ä¸åŒï¼Œæˆ‘ä»¬åšçš„ fold ä¸ä»…ä»…ä½œç”¨äºæ•°ç»„â€”â€”å®ƒä½œç”¨äºä»»ä½•[å¯è¿­ä»£å¯¹è±¡](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols)ã€‚
*   ä¸€èˆ¬æ¥è¯´ï¼Œfold åº”è¯¥å¯ä»¥å¤„ç†ä»»ä½•å¯æšä¸¾çš„æ•°æ®æºï¼Œæ¯”å¦‚åˆ—è¡¨å’Œæ ‘ã€‚
*   â€œæ”¶é›†â€çš„æ¦‚å¿µä¸ä¸€å®šæ˜¯ç»„åˆæ•°ç»„å…ƒç´ ï¼Œæ¯”å¦‚åŠ æ³•æˆ–ä¹˜æ³•ã€‚å®ƒå¯èƒ½æ˜¯å…³äºâ€œæŸ¥æ‰¾å’Œæ›¿æ¢â€ï¼Œåƒæœ€å¤§/æœ€å°ç¼©å‡å™¨ï¼Œæˆ–è€…å…³äºâ€œé¡ºåºåº”ç”¨â€ï¼Œåƒç®¡é“å‡½æ•°çš„å‡½æ•°åº”ç”¨ç¼©å‡å™¨(å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥æ˜¯)ã€‚åº”ç”¨ç¨‹åºæ˜¯æ— æ­¢å¢ƒçš„ï¼

ä¸€ä¸ªç”¨ä¸€å †ä¸œè¥¿æ¥è¿”å›ä¸€ä¸ªä¸œè¥¿çš„å‡½æ•°å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹çç¢ï¼Œä½†æ˜¯æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­é€šè¿‡å®ç°è®¸å¤š folds æ¥çœ‹çœ‹å®ƒå®é™…ä¸Šæœ‰å¤šå¼ºå¤§ã€‚æˆ‘ä»¬å°†æ‰å¹³åŒ–æ•°ç»„ï¼Œç®¡é“å‡½æ•°å’Œ[å¸Œæœ›]åšæ›´å¤šçš„æŠ˜å ã€‚