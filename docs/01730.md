# æˆ‘æ˜¯å¦‚ä½•åˆ›é€ å‡ºä¸–ç•Œä¸Šæœ€ç³Ÿç³•çš„å–œå‰§å‰§æœ¬ã€ŠREPLã€‹

> åŸæ–‡:[https://dev . to/swlkr/the-world-s-worst-clojurescript-repl-client-4 APD](https://dev.to/swlkr/the-world-s-worst-clojurescript-repl-client-4apd)

[åœ¨è¿™é‡Œé˜…è¯»ä¹‹å‰çš„å¸–å­](https://dev.to/swlkr/how-i-made-the-world-s-worst-clojurescript-repl-llg)

**TLï¼›åšå£«**
æˆ‘å°è¯•è¿è¡Œä¸¤ä¸ª clojure web æœåŠ¡å™¨å¹¶è°ƒç”¨ä¸€ä¸ª JSON ç«¯ç‚¹ï¼ŒJVM åœ¨æˆ‘çš„ [$3.50/mo 512 MB RAM VPS æœåŠ¡å™¨](https://www.vultr.com/?ref=7614094)ä¸Šå´©æºƒäº†ï¼Œæ‰€ä»¥æˆ‘åˆ‡æ¢åˆ° clojurescript å¹¶ä¸º atom ç¼–å†™äº†è‡ªå·±çš„ prepl å®¢æˆ·ç«¯

### [](#atom-package-development)Atom åŒ…å¼€å‘

å¦‚æœæ‚¨ä»æœªè¿›è¡Œè¿‡ä»»ä½• atom åŒ…å¼€å‘ï¼Œé‚£ä¹ˆæ‚¨å°†ä¼šç»å†ä¸€æ¬¡ç–¯ç‹‚çš„æ–‡æ¡£é˜…è¯»ä¹‹æ—…ï¼ä»–ä»¬è®©å¼€å§‹å˜å¾—éå¸¸å®¹æ˜“ã€‚å½“ç„¶ï¼Œä¸€å¼€å§‹æˆ‘ç”šè‡³ä¸çŸ¥é“ä»å“ªé‡Œå¼€å§‹ã€‚

é¡ºä¾¿è¯´ä¸€å¥ï¼Œä½ ä»è¿™é‡Œå¼€å§‹ã€‚

æœ‰è¶£çš„æ˜¯ï¼Œpost å·²ç» 3 å¹´äº†ï¼Œæ‰€ä»¥æˆ‘æƒ³ï¼Œä»é‚£æ—¶åˆ°ç°åœ¨å·²ç»å‘å¸ƒäº†å¤šå°‘ä¸ª atom ç‰ˆæœ¬ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œä½†å®ƒç¡®å®æœ‰æ•ˆã€‚

æˆ‘æœ€åˆå¾ˆå›°æƒ‘ï¼Œå› ä¸ºæˆ‘ä¸€ç›´åœ¨æœç´¢â€œatom åŒ…å¼€å‘â€ï¼Œä½†åšæ–‡çš„æ ‡é¢˜æ˜¯â€œâ€¦ ATOM æ’ä»¶â€ã€‚

ç»å…¸çš„åŠç”Ÿä¸ç†Ÿçš„ intro ç¼–ç æ•™ç¨‹(å…¶ä¸­æˆ‘å†™è¿‡å¾ˆå¤š)ã€‚

å¥½äº†ï¼Œç°åœ¨æˆ‘å¤§æ¦‚æ˜ç™½äº†å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæ–‡ä»¶æ”¾åœ¨å“ªé‡Œï¼Œæ˜¯æ—¶å€™å»æ–‡æ¡£äº†ï¼Œå­¦ä¹ å¦‚ä½•ä»ä¸€ä¸ªç¼–è¾‘å™¨ä¸­è·å–æ–‡æœ¬ï¼Œå¹¶å°†å…¶æ”¾å…¥å¦ä¸€ä¸ªç¼–è¾‘å™¨ä¸­ï¼Œä¸ºæ­¤æˆ‘æŸ¥é˜…äº†æ— æ‰€ä¸çŸ¥ã€æ— æ‰€ä¸çŸ¥ã€æ— æ‰€ä¸ä¸ºçš„ atom æ–‡æ¡£ã€‚

æˆ‘æœ€åˆä½¿ç”¨äº†[getwordbursor](https://atom.io/docs/api/v1.18.0/TextEditor#instance-getWordUnderCursor)å‡½æ•°ï¼Œå®ƒå¾ˆæ£’ï¼Œä½†æ˜¯æˆ‘éœ€è¦åœ¨ clojure è¡¨å•ä¸­è·å¾—â€œæœ€å¤–å±‚çš„è¡¨å•â€,å°±åƒè¿™æ ·ğŸ‘‡

```
(defn  say-hello  [s]  ; <â€”â€” outer most form is `defn`  (println  "hello"  s)) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

...æˆ‘æ‰€åšçš„å¹¶ä¸å¥æ•ˆã€‚

æ‰€ä»¥æˆ‘åšäº†æ¯ä¸€ä¸ªä¼Ÿå¤§çš„è‰ºæœ¯å®¶éƒ½ä¼šåšçš„äº‹æƒ…ï¼Œæˆ‘ä» atom ä¸­æ°å‡ºçš„ clojure repl é‚£é‡Œå·äº† T1:T2 proto-repl T3ã€‚

å¾ˆæ˜æ˜¾ï¼Œè¿™æ®µä»£ç æ¯”æˆ‘æœ€åˆå†™çš„è¦å¥½å¾—å¤šï¼Œæ‰€ä»¥æˆ‘å†³å®šæŠŠå®ƒæ”¾åœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œç„¶åæˆ‘å°±å‡ºå‘å»æ¯”èµ›äº†ï¼

```
console.log('cljs-repl:send');

let editor;
if (editor = atom.workspace.getActiveTextEditor()) {
  let range = EditorUtils.getCursorInClojureTopBlockRange(editor);
  let s = editor.getTextInBufferRange(range);
  console.log(s);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å°±æ˜¯ç°åœ¨ä½¿ç”¨ proto-repl ä»£ç çš„å…¨éƒ¨ä»£ç ï¼Œå®ƒåœ¨ clojurescript ä¸­è·å¾—æœ€å¤–å±‚çš„å½¢å¼ã€‚åœ¨è¿™ä¹‹åï¼Œæˆ‘ä¸€è·³ä¸€è·³åœ°è¿œç¦»äº†ä¸€ä¸ªå®Œå…¨è¿è¡Œçš„ clojurescript prepl å®¢æˆ·ç«¯ï¼Œå› ä¸º [prepl éƒ¨åˆ†ä¸ºæ‚¨å®Œæˆäº†æ‰€æœ‰ç¹é‡çš„å·¥ä½œ](https://blog.jakubholy.net/how-to-use-clojure-1.10-prepl/)ã€‚

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ç°åœ¨è¦åšçš„å°±æ˜¯

1.  è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„ clojurescript prepl å¥—æ¥å­—
2.  æŠŠä»£ç å‘è¿‡æ¥
3.  è§£æè¿”å›çš„ EDN
4.  ..å¹¶åœ¨æ–°çª—æ ¼ä¸­æ˜¾ç¤ºå®ƒï¼

ç­‰ç­‰ï¼Œè§£æ EDNï¼Œæˆ‘åœ¨ç”¨ javascript å†™è¿™ä¸ªæ’ä»¶/åŒ…/ä»€ä¹ˆçš„ï¼Œæ€ä¹ˆç”¨ javascript è§£æ EDNï¼Ÿ

ä½ çŒœæ€ä¹ˆç€[åœ¨èŠå¤©ä¸­æ”¾ä¸€äº› fs](https://knowyourmeme.com/memes/press-f-to-pay-respects)å› ä¸ºè¿™ä¸ª js è¦æ‹œæ‹œäº†ã€‚

Clojurescript å¯ä»¥è§£æ EDNï¼Œæ²¡é—®é¢˜ã€‚

### [](#switching-from-javascript-to-clojurescript)ä» javascript åˆ‡æ¢åˆ° clojurescript

å¬èµ·æ¥å¾ˆææ€–ï¼Œé‡å†™ä¸€åˆ‡ï¼Œ(å…¨éƒ¨ 50 è¡Œä»€ä¹ˆçš„ğŸ˜…)å’Œä¸€ä¸ªæˆ‘å®Œå…¨ä¸äº†è§£çš„æ–°äº‹ç‰©é‡æ–°å¼€å§‹ã€‚æˆ‘çœ‹è¿‡å¾ˆå¤šåšå®¢å¸–å­ï¼Œä¸Šé¢æœ‰ä¸€è¡Œåˆä¸€è¡Œçš„ edn å’Œå¤æ‚çš„å®‰è£…ç¨‹åºï¼Œç”¨ figwheel ç¼–è¯‘ clojurescriptï¼Ÿå¤ªå“äººäº†ã€‚å¹¸è¿çš„æ˜¯ï¼Œclojurescript äººå‘˜è®©äº‹æƒ…å˜å¾—éå¸¸ç®€å•ï¼Œä½†æ˜¯å¾ˆéš¾åˆ¤æ–­æ‚¨æ˜¯å¦åˆšåˆšå¼€å§‹ã€‚ä¸‹é¢æ˜¯è®© clojurescript åœ¨ node.js ä¸­è¿è¡Œçš„ç§˜è¯€ã€‚

**ç¬¬ä¸€æ­¥ã€‚åˆ¶ä½œä¸€ä¸ªåä¸º build.clj**
çš„æ–‡ä»¶

```
; build.clj  (ns  build  (:require  [cljs.build.api  :as  b]))  (b/build  "src"  {:output-to  "whatever/whatever.js"  :output-dir  "target"  :optimizations  :simple  :target  :nodejs  :output-wrapper  true  :pretty-print  false  :hashbang  false  :main  'your-app.core}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**ç¬¬äºŒæ­¥ã€‚è·‘å§**

```
clj build.clj 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**ç¬¬ä¸‰æ­¥ã€‚åˆ©æ¶¦**

å°±æ˜¯è¿™æ ·ï¼Œå¦‚æœä½ çœŸçš„æƒ³å˜å¾—èŠ±å“¨ï¼Œå¹¶ä¸”ä¸æƒ³åœ¨æ¯æ¬¡æ›´æ”¹æ—¶éƒ½é‡æ–°è¿è¡Œï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç›¸åŒçš„æ‰‹è¡¨æ–‡ä»¶:

```
; watch.clj  (ns  watch  (:require  [cljs.build.api]))  (cljs.build.api/watch  "src"  {:main  'your-app.core  :output-dir  "target"  :target  :nodejs  :output-wrapper  true  :pretty-print  false  :hashbang  false  :optimizations  :simple  :output-to  "whatever/whatever.js"}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

â€¦å¹¶æ”¹ä¸ºè¿è¡Œ`clj watch.clj`ã€‚ç°åœ¨ï¼Œå½“æ‚¨æ›´æ”¹`src`ç›®å½•ä¸­çš„ä»»ä½• clojurescript æ–‡ä»¶æ—¶ï¼Œjs å°†è¢«è¾“å‡ºåˆ°`:output-to`ç›®å½•ä¸­ã€‚

é‚£å¾ˆå®¹æ˜“ã€‚

è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ç»ˆäºå¯ä»¥å®Œæˆæˆ‘çš„ prepl å®¢æˆ·äº†:

**1ã€‚è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„ clojurescript prepl å¥—æ¥å­—**

```
(def  element  (.createElement  js/document  "div"))  (->  element  .-classList  (.add  "cljs-repl"))  (def  modalPanel  (->  js/atom  .-workspace  (.addModalPanel  #js  {:item  element  :visible  false})))  (def  input  (.createElement  js/document  "input"))  (.setAttribute  input  "style"  "padding: 7px")  (set!  (.-type  input)  "input")  (->  input  .-classList  (.add  "input-text"))  (->  input  .-classList  (.add  "native-key-bindings"))  (set!  (.-value  input)  "localhost:5555")  (aset  input  "onkeydown"  (fn  [event]  (condp  =  (.-key  event)  "Escape"  (.hide  modalPanel)  "Enter"  (connect  input)  "")))  (.appendChild  element  input)  (defn  connection  []  (.show  modalPanel)  (.focus  input))  (defn  connect  [input]  (let  [value  (.-value  input)  [url  port]  (.split  value  ":")]  (->  client  (.connect  port  url  (fn  []))))) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**2ã€‚é€šè¿‡**
å‘é€ä»£ç 

```
(def  client  (net/Socket.))  (defn  send  []  (let  [editor  (->  js/atom  .-workspace  .getActiveTextEditor)  range  (.getCursorInClojureTopBlockRange  EditorUtils  editor)  s  (str  (.getTextInBufferRange  editor  range)  "\n")]  (helpers/log  s)  (->  client  (.write  s)))) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**3ã€‚è§£æ EDN**

```
(->  client  (.on  "data"  (fn  [s]  (helpers/log  (pr-str  s))  (let  [data  (cljs.reader/read-string  (str  s))]  (->  js/atom  .-workspace  (.observeTextEditors  #(update-repl  %  data))))))) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**4ã€‚åœ¨æ–°çª—æ ¼ä¸­æ˜¾ç¤ºå®ƒï¼**

```
(defn  update-repl  [editor  m]  (when  (=  "CLJS REPL"  (.getTitle  editor))  (when  (contains?  m  :form)  (do  (.insertText  editor  (str  (:form  m)))  (.insertNewline  editor)))  (.insertText  editor  (str  (:val  m)))  (.insertNewline  editor))) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#everything-is-awesome)ä¸€åˆ‡éƒ½æ£’æäº†

è¯´è¿™æ˜¯ä¸–ç•Œä¸Šæœ€ç³Ÿç³•çš„ç¬‘è¯ REPL æ˜¯éå¸¸è´Ÿé¢çš„ï¼Œæ‰€ä»¥æˆ‘æƒ³åœ¨è¿™ç¯‡æ–‡ç« çš„ç»“å°¾è¯´ä¸€äº›ç§¯æçš„ä¸œè¥¿ï¼Œç°åœ¨æˆ‘åšåˆ°äº†ã€‚ä¸€åˆ‡éƒ½æ£’æäº†ã€‚

å¦‚æœä½ æƒ³åšä¸€ä¸ªæ¯”æˆ‘æ›´å¥½çš„å›å¤ï¼Œä½ å¯ä»¥ç«™åœ¨æ™®é€šå°ºå¯¸çš„æˆ‘çš„è‚©è†€ä¸Šï¼ŒæŠ¢å…ˆä¸€æ­¥:[https://github.com/swlkr/cljs-repl](https://github.com/swlkr/cljs-repl)