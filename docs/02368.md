# Ruby On Rails ä¸­ä½¿ç”¨ Cleave.js å’Œ Money gem è¿›è¡Œè´§å¸è¾“å…¥å±è”½

> åŸæ–‡:[https://dev . to/bilalbudhani/currency-input-masking-with-cleave-js-and-money-gem-in-ruby-on-rails-490 l](https://dev.to/bilalbudhani/currency-input-masking-with-cleave-js-and-money-gem-in-ruby-on-rails-490l)

ä¾èµ–ç”¨æˆ·çš„è¾“å…¥æ˜¯æ„å»ºå¥å£®åº”ç”¨ç¨‹åºçš„å…³é”®éƒ¨åˆ†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘è¯•å›¾å¯¹è¡¨å•æˆ–å…¶ä»–å½¢å¼çš„è¾“å…¥æ•°æ®è¿›è¡Œå¼ºéªŒè¯ã€‚éœ€è¦éå¸¸ç²¾ç¡®åœ°æ•æ‰çš„ä¸€ä¸ªé‡è¦è¾“å…¥æ˜¯æ•°é‡ã€‚ä½ çš„é“è·¯ç”Ÿæ€ç³»ç»Ÿæœ‰ä¸€ä¸ªæƒŠäººçš„å®çŸ³ç§°ä¸ºé‡‘é’±ä¸æ•°é‡ã€‚ç„¶è€Œï¼Œæˆ‘å¸Œæœ›åœ¨å‰ç«¯ä¸ºæˆ‘çš„ç”¨æˆ·å¤„ç†ä¸æ•°é‡ç›¸å…³çš„è¾“å…¥æ—¶æœ‰åŒæ ·ä¼˜é›…çš„ä½“éªŒã€‚

åœ¨å°è¯•äº†å‡ ä¸ª Javascript åº“ä¹‹åï¼Œæˆ‘æœ€ç»ˆé€‰æ‹©äº† Cleave.jsï¼Œæˆ‘å°†å…¶é…ç½®ä¸ºä¸ Money gem ååŒå·¥ä½œã€‚è¿™æ˜¯æœ€ç»ˆç»“æœ

[![](../Images/7e53ce9c7b1888f2dd5f1a3f4f6a7fb3.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--wWWaPA-e--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/6gdgr56ck13b9w97izn3.gif)

### [](#heres-how-to-achieve-this-experience)ä¸‹é¢ä»‹ç»å¦‚ä½•è·å¾—è¿™ç§ä½“éªŒ

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°†ä¾èµ–é¡¹æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­

```
gem 'money-rails' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

```
yarn add cleave.js

rails g money_rails:initializer 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åï¼Œä¸€æ—¦æˆ‘ä»¬æ ¹æ®éœ€æ±‚é…ç½®äº†`config/initializers/money.rb`ï¼Œæˆ‘ä»¬å°†å¼€å§‹è®¾ç½® Javascript éƒ¨åˆ†ã€‚

åœ¨æˆ‘ä»¬çš„`app/views/layouts/application.html.slim`ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨`head`æ ‡ç­¾ä¸­å®šä¹‰ä¸€ä¸ªå…³äº Cleave.js é…ç½®çš„å…¨å±€å¯¹è±¡ã€‚å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„

```
/ Global config for input masking in Cleave library
javascript:
    window.__AMOUNT_INPUT_MASK__ = {
    prefix: "#{raw Money.default_currency.symbol} ",
    numeral: true,
    numeralThousandsGroupStyle: 'lakh',
    rawValueTrimPrefix: true
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*æ ¹æ®æ‚¨çš„è¦æ±‚è°ƒæ•´`numeralThousandsGroupStyle`é…ç½®*

åœ¨æˆ‘ä»¬çš„`app/assets/javascripts/application.js`ä¸­ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€å°æ®µ JS ä»£ç ç‰‡æ®µï¼Œå®ƒå°†æ ¹æ®æˆ‘ä»¬å®šä¹‰çš„ Money é…ç½®å°†è¾“å…¥å±è”½é™„åŠ åˆ°ä»»ä½•å…·æœ‰ç±»`currency-input-mask`
çš„è¾“å…¥

```
document.addEventListener("DOMContentLoaded", function(event) {
    // Input Mask
    document.querySelectorAll("input.currency-input-mask").forEach(function(el) {
        new Cleave(el, window.__AMOUNT_INPUT_MASK__);
    });
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œä»»ä½•å…·æœ‰ä¸Šè¿°ç±»çš„è¾“å…¥å­—æ®µå°†å…è®¸æˆ‘ä»¬çš„ç”¨æˆ·ä»¥æ›´å¯æ§çš„æ–¹å¼è¾“å…¥å€¼â€”â€”é€šè¿‡æ›´ç²¾ç¡®çš„æ•°æ®å‡å°‘äººä¸ºé”™è¯¯çš„æœºä¼šã€‚

åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œè¿˜æœ‰æœ€åä¸€æ­¥éœ€è¦æ³¨æ„ã€‚å› ä¸ºæˆ‘ä»¬çš„è¾“å…¥å€¼ç°åœ¨ä¿å­˜äº†å…¶ä»–æ•°æ®ï¼Œæ¯”å¦‚è´§å¸å’Œé€—å·ï¼Œå½“ç”¨æˆ·æäº¤è¡¨å•æ—¶ï¼Œæˆ‘ä»¬å°†åœ¨æ§åˆ¶å™¨çš„å‚æ•°ä¸­æ”¶åˆ°è¿™äº›æ•°æ®ã€‚

ä¸ºäº†å¤„ç†è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å°†å€¼ä¼ é€’ç»™æ¨¡å‹ä¹‹å‰å¯¹å…¶è¿›è¡Œæ¸…ç†ã€‚è®©æˆ‘ä»¬åœ¨`app/helpers`ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`input_helper.rb`çš„åŠ©æ‰‹æ–‡ä»¶ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªæ–¹æ³•ä»å€¼
ä¸­å»æ‰æƒ³è¦çš„å­—ç¬¦

```
module InputHelper 
    def strip_inputmask(amount)
      amount.is_a?(String) ? amount.gsub(/#{Money.default_currency.symbol}|,/, '').strip.to_i : amount
    end
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œåœ¨æˆ‘ä»¬çš„æ§åˆ¶å™¨ä¸­ï¼Œæˆ‘ä»¬å°†åŒ…å«è¿™ä¸ªåŠ©æ‰‹å¹¶ä½¿ç”¨æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„æ–¹æ³•

```
class ApplicationController 
 include InputHelper

 ...
 model.amount = strip_amount(params[:model][:amount])
 ...
end 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ç›¸ä¿¡å¯¹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„è¿™ä¸€ç‚¹å°å°çš„å…³å¿ƒå¯¹æ•´ä¸ªé¡¹ç›®äº§ç”Ÿäº†å·¨å¤§çš„å½±å“ï¼Œå¹¶ç»™æ‰€æœ‰çš„åˆ©ç›Šç›¸å…³è€…å¸¦æ¥äº†å’Œå¹³ã€‚

> ğŸ‘‹å¦‚æœè¿™åœ¨ä»»ä½•æ–¹é¢æœ‰ä»·å€¼ï¼Œè¯·è®©æˆ‘çŸ¥é“ä½ çš„æƒ³æ³•æˆ–åé¦ˆ
> 
> æœ€åˆå‘å¸ƒäº[https://bilalbudhani . com/currency-input-masking-with-cleave-js-and-money-gem-in-ruby-on-rails/](https://bilalbudhani.com/currency-input-masking-with-cleave-js-and-money-gem-in-ruby-on-rails/)