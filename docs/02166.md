# Stonex â€”å¯é¢„æµ‹çš„ç®€å•çŠ¶æ€å®¹å™¨

> åŸæ–‡:[https://dev . to/js2me/stonex-predictable-simple-state-container-2k pi](https://dev.to/js2me/stonex-predictable-simple-state-container-2kpi)

å¤§å®¶å¥½ï¼ğŸ™‚

æˆ‘æƒ³æ¨è[æˆ‘çš„åº“](https://github.com/acacode/stonex)ï¼Œå®ƒå…è®¸ä½ æ¯”å…¶ä»–ç±»ä¼¼çš„åº“æ›´å¥½æ›´ç®€å•åœ°ç®¡ç†å’Œå­˜å‚¨æ•°æ®ã€‚

ä½¿ç”¨ React like è¯­æ³•çš„å¯é¢„æµ‹çŠ¶æ€å®¹å™¨

è§£å†³æ–¹æ¡ˆæˆ‘å†³å®šåˆ›å»º stonex çš„åŸå› æ˜¯ä¸å¦ä¸€ä¸ªç±»ä¼¼äºåº“çš„ stonex ä¸€èµ·å·¥ä½œçš„ç»å†ï¼Œæˆ‘ä¸å–œæ¬¢é‚£é‡Œçš„å¤§å¤šæ•°æ–¹æ³•ï¼Œæˆ‘å¸Œæœ›åˆ›å»ºè‡ªå·±çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘åº”è¯¥ä¸ºåˆ›å»ºç±»ä¼¼äº stonex æ¨¡å—çš„ç»“æ„å†™å¤ªå¤šçš„ä»£ç ï¼Œè¿˜éœ€è¦é™„åŠ å¤ªå¤šçš„ä¾èµ–ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘å†³å®šåˆ›å»º stonexï¼Œè®©ä½ çš„å‰ç«¯å¼€å‘æ›´å®¹æ˜“ï¼

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png) [ js2me ](https://github.com/js2me) / [ stonex](https://github.com/js2me/stonex)

### ğŸ’¡JavaScript/TypeScript åº”ç”¨ç¨‹åºçš„ç®€å•çŠ¶æ€å®¹å™¨ğŸ’¡

<article class="markdown-body entry-content container-lg" itemprop="text">

[![stonex](../Images/84e7029b29f021c62128f5d371c28403.png)T2ã€‘](https://www.npmjs.com/package/stonex)

[![](../Images/acc0d8fef4bc3a2316ab6b69af11f4d5.png)](https://raw.githubusercontent.com/js2me/stonex/master/./LICENSE)[![](../Images/4a38e7b6988cc402bd42a66f42173fd2.png)](https://www.npmjs.com/package/stonex)[![](../Images/1140591ce5ff38093ff5687a6b110e32.png)](https://travis-ci.org/acacode/stonex)[![](../Images/2362e9a9ec8ff98e7c1c58e21e7c05c7.png)](http://npm-stat.com/charts.html?package=stonex)[![](../Images/6490e4d034f05b46f046a2c8009eabe2.png)](https://bundlephobia.com/result?p=stonex)[![](../Images/5b129874b5bf3d05d70d5cb171e3a6c8.png)](https://bundlephobia.com/result?p=stonex)

<g-emoji class="g-emoji" alias="cyclone" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f300.png">ğŸŒ€</g-emoji>JavaScript/TypeScript åº”ç”¨ç¨‹åºçš„çŠ¶æ€å®¹å™¨<g-emoji class="g-emoji" alias="cyclone" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f300.png">ğŸŒ€ï¸</g-emoji>

#### ç›®å½•

é‚£æ˜¯ä»€ä¹ˆï¼Ÿ
[å¦‚ä½•ä½¿ç”¨](https://raw.githubusercontent.com/js2me/stonex/master/#-how-to-use)
[æ–‡æ¡£](https://raw.githubusercontent.com/js2me/stonex/master/#-documentation) :
- [Stonex å•†åº—](https://raw.githubusercontent.com/js2me/stonex/master/#stonexstoresource-link)-[Stonex æ¨¡å—](https://raw.githubusercontent.com/js2me/stonex/master/#stonexmodulesource-link)
-[state worker](https://raw.githubusercontent.com/js2me/stonex/master/#stateworkersource-link)
-[createStoreBinder](https://raw.githubusercontent.com/js2me/stonex/master/#createstorebindersource-link)
[è®¸å¯è¯](https://raw.githubusercontent.com/js2me/stonex/master/#-license)

## â“ é‚£æ˜¯ä»€ä¹ˆï¼Ÿ

è¿™æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†/å­˜å‚¨æ•°æ®çš„ç®€å•æ˜“ç”¨çš„åº“ã€‚
å®ƒå…è®¸æ‚¨æ­£ç¡®åœ°å­˜å‚¨å’Œç®¡ç†æ•°æ®ï¼Œè¿˜å¯ä»¥å°†æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ç»„åˆåˆ°å•ç‹¬çš„`Stonex`æ¨¡å—ä¸­ã€‚

å¾ˆå®¹æ˜“é…ç½®ï¼Œå¦‚æœéœ€è¦ï¼Œå¤§å¤šæ•°ä¸œè¥¿éƒ½å¯ä»¥è¢«è¦†ç›–ã€‚

å’Œå…¶ä»–ç±»ä¼¼çš„åº“ä¸­ä¸€æ ·ï¼Œæ¯ä¸ª`Stonex`æ¨¡å—éƒ½æœ‰è‡ªå·±çš„**çŠ¶æ€**å’Œ**åŠ¨ä½œ**ã€‚ä½†æ˜¯ï¼Œä¸å…¶ä»–åº“ä¸åŒï¼Œå¤§å¤šæ•°`Stonex`ç‰¹æ€§éƒ½æ˜¯â€œå¼€ç®±å³ç”¨â€çš„ï¼Œä¾‹å¦‚ï¼Œåˆ›å»ºå¼‚æ­¥åŠ¨ä½œã€‚

æ¨¡å—çš„è¯­æ³•å‡ ä¹ä¸`ReactJS`ç»„ä»¶çš„è¯­æ³•ç›¸åŒã€‚

å¦å¤–ï¼Œç›®å‰`Stonex`æ­£åœ¨æ”¯æŒä¸ [ReactJS (react-stonex)](https://github.com/acacode/react-stonex) çš„é›†æˆ

## <g-emoji class="g-emoji" alias="bulb" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4a1.png">ğŸ’¡</g-emoji>å¦‚ä½•ä½¿ç”¨

**1ã€‚**éœ€è¦å®‰è£…å®ƒ:

```
  npm i -S stonex
  # or
```

â€¦</article>

[View on GitHub](https://github.com/js2me/stonex)

å¦å¤–ï¼ŒStonex å·²ç»å¾—åˆ°äº† ReactJS çš„æ”¯æŒï¼

# [](#why-stonex-)ä¸ºä»€ä¹ˆæ˜¯ Stonexï¼Ÿ

åœ¨ç»„ä»¶(reactã€angularjsã€vue ç­‰)ä¹‹é—´å…±äº«æ•°æ®çš„åº”ç”¨ç¨‹åºä¸­ï¼ŒçŸ¥é“ä¸€ä¸ªçŠ¶æ€åº”è¯¥ä½äºä½•å¤„å¯èƒ½ä¼šä»¤äººå›°æƒ‘ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œç»„ä»¶ä¸­çš„æ•°æ®åº”è¯¥åªå­˜åœ¨äºä¸€ä¸ªç»„ä»¶ä¸­ã€‚å› æ­¤åœ¨å…„å¼Ÿç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®å˜å¾—æ›´åŠ å›°éš¾ã€‚

[![](../Images/96411e6e025ea2afd144768286679bd3.png)T2ã€‘](https://i.giphy.com/media/KKtAZiNVEeU8/giphy.gif)

è®©æˆ‘ä»¬æ¥çœ‹çœ‹ ReactJS ç»„ä»¶çš„ä¾‹å­:

```
class Login extends React.Component {

  changeForm = ({ target }) => {
   this.setState({ [target.name]: target.value })
  }

  render() {
   const { firstName, lastName } = this.state

   return (
     <div>
       <input value={firstName} name="firstName" onChange={this.changeForm} />
       <input value={lastName} name="lastName" onChange={this.changeForm} />
     </div>
   )
  }

} 
```

å¦‚æœéœ€è¦åœ¨åº”ç”¨ç¨‹åºçš„å®Œå…¨ä¸åŒçš„éƒ¨åˆ†æ˜¾ç¤ºè¿™ä¸ªç»„ä»¶çš„çŠ¶æ€æ•°æ®ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡ APIï¼Œä½†å®ƒä¸ä¼šæ˜¯ä¸€ä¸ªé€šç”¨ä¸”ä¸å¤ªçµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚

ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¿…è¦åº”ç”¨ç¨‹åºæ•°æ®çš„ stonex reactjs ç»„ä»¶ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿä»¥è¿™ç§æ–¹å¼å·¥ä½œçš„ Stonexï¼Œæ‰€ä»¥ä»¥è¿™ç§æ–¹å¼å‘é€åº”ç”¨ç¨‹åºæ•°æ®å°†ä¸ä¼šæœ‰ä»»ä½•å›°éš¾ï¼

ä½¿ç”¨ stonex è§£å†³æ–¹æ¡ˆä¼šæ˜¯ä»€ä¹ˆæ ·å­:

```
// login component
import { connect } from 'react-stonex'

const Login = ({ firstName, lastName, changeAuthData }) => (
 <div>
   <input value={firstName} onChange={e => this.changeAuthData('firstName', e.target.value)} />
   <input value={lastName} onChange={e => this.changeAuthData('lastName', e.target.value)} />
 </div>
)

export default connect((state, modules) => ({
  firstName: state.auth.firstName,
  lastName: state.auth.lastName,
  changeAuthData: modules.auth.changeAuthData,
}))(Login)

// somewhere in sidebar component
import { connect } from 'react-stonex'

const Sidebar = ({ firstName, lastName }) => (
 <div>
   <span>Hello, {firstName} {lastName}</span>
 </div>
)

export default connect((state, modules) => ({
  firstName: state.auth.firstName,
  lastName: state.auth.lastName,
}))(Sidebar) 
```

å¦‚æ‚¨æ‰€è§ï¼Œåœ¨ç»„ä»¶ä¹‹é—´äº¤æ¢åº”ç”¨ç¨‹åºæ•°æ®å¹¶ä¸å›°éš¾ã€‚è€Œä¸”æˆ‘ä»¬æ¥çœ‹çœ‹ Stonex çš„ Auth æ¨¡å—:

```
export default {
  state: { firstName: '', lastName: '' }

  changeAuthData(name, value) {
    this.setState({
      ...this.state,
      [name]: value
    })
  }
} 
```

çœ‹èµ·æ¥å¾ˆå®¹æ˜“ï¼Œä¸æ˜¯å—ï¼ŸğŸ˜

# [](#deep-dive-into-stonex)æ·±æ½œåˆ°æ–¯é€šå…‹æ–¯

[![](../Images/7c0e02c610846512390b51dae68fc260.png)T2ã€‘](https://i.giphy.com/media/l2Je6HrCWMzM635bW/giphy.gif)

ä¹‹å‰ï¼Œä½ éœ€è¦å®‰è£… stonex

```
npm i -S stonex
# or using yarn
yarn add stonex 
```

Stonex ç›®å‰æœ‰å‡ºå£:`StonexStore`ã€`StonexModule`ã€`createStoreBinder`ã€`StateWorker`ã€‚*åä¸¤ç§å‡ºå£æ›´éœ€è¦ä¸­é—´äº§å“ã€‚*

## [](#stonexstore)[æ–¯é€šå…‹æ–¯æ‰˜](https://github.com/acacode/stonex#stonexstoresource-link)

è¿™å°±æ˜¯æŠŠä½ æ‰€æœ‰æ¨¡å—è¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶ä½¿ç¾å¦™çš„å­˜å‚¨å®¹å™¨ï¼ğŸ˜‰

> å¦‚æœæˆ‘æƒ³åˆ›å»ºä¸€ä¸ª StonexStore å®ä¾‹ï¼Œæˆ‘éœ€è¦ä»€ä¹ˆï¼Ÿ

å‡ ä¹æ²¡æœ‰ï¼Œåªæ˜¯ä½ çš„æ¨¡å—çš„å”¯ä¸€å¯¹è±¡ï¼å‚è§ç¤ºä¾‹:

```
// store.js

import { StonexStore } from 'stonex'
import modules from './modules'

const store = new StonexStore(modules) 
```

åº”è¯¥æ˜¯ä¸€ä¸ªå¸¦æœ‰é”®çš„å¯¹è±¡ï¼Œå…¶ä¸­é”®æ˜¯ä½ çš„æ¨¡å—çš„åå­—ï¼Œå€¼æ˜¯ StonexModule ç±»çš„å¼•ç”¨(ä¸ä»…ä»…æ˜¯ç±»ï¼Œå®ƒå¯èƒ½åªæ˜¯å¯¹è±¡ï¼Œä½†å…³äºè¿™ä¸€ç‚¹ä¼šå†™å¾—æ›´è¯¦ç»†)ã€‚å‚è§ç¤ºä¾‹:

```
// ./modules/index.js
import UsersModule from './UsersModule'
import AuthModule from './AuthModule'
import ModalsModule from './ModalsModule'

const modules = {
  users: UsersModule,
  auth: AuthModule,
  modals: ModalsModule
}

export default modules 
```

å¦‚æœä½ æƒ³æ·»åŠ ä¸€äº›ä¸­é—´ä»¶æˆ–è€…è¦†ç›– stonex å¤„ç†çŠ¶æ€çš„åœ°æ–¹ï¼Œä½ å¯ä»¥ä½¿ç”¨é¢å¤–çš„å‚æ•°`StonexStore`ã€‚æ›´å¤šå…³äº Stonex middlewares çš„ä¿¡æ¯è¯·ç‚¹å‡»[è¿™é‡Œ](https://github.com/acacode/stonex#stateworkersource-link)ã€‚

ä¸‹é¢æ˜¯å¦‚ä½•æ·»åŠ ä¸€äº›ä¿®æ”¹å™¨å’Œè‡ªå®šä¹‰çŠ¶æ€æœºçš„ä¾‹å­

```
// store.js

import { StonexStore } from 'stonex'
import modules from './modules'

import Logger from './modifiers/Logger'
import AppStateWorker from './common/AppStateWorker'

const storeConfiguration = {
  modifiers: [ // middlewares
    Logger
  ],
  stateWorker: AppStateWorker
}

const store = new StonexStore(modules, storeConfiguration) 
```

## [](#stonexmodule)[æ–¯é€šå…‹æ–¯æ¨¡å—](https://github.com/acacode/stonex#stonexmodulesource-link)

Stonex æ¨¡å—å®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»/å¯¹è±¡ï¼ŒåŒ…å«æ‰€æœ‰ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„ä¿¡æ¯/åŠ¨ä½œã€‚æ›´å¤šå…³äºå®ƒçš„ä¿¡æ¯è¯·ç‚¹å‡»ã€‚

å¤–è§‚:

```
import { StonexModule } from 'stonex'

class UsersModule extends StonexModule {
  state = []
  addUser = user => this.setState([...this.state, user])
  removeAllUsers = () => this.resetState()
}

export default UsersModule 
```

æ­£å¦‚æˆ‘å‰é¢è¯´è¿‡çš„ï¼Œstonex æ¨¡å—å¯ä»¥ä½œä¸ºç±»çš„å¼•ç”¨ï¼Œä½†å¹¶ä¸æ€»æ˜¯è¿™æ ·ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªçº¯ stonex æ¨¡å—(*è¿™æ˜¯ç›¸åŒçš„ï¼Œä½†çœ‹èµ·æ¥æ›´å®¹æ˜“* ):

```
// ./modules/index.js

// don't worry about context. It links when module attaching to the store!
// Also all methods (like 'this.setState' ) from StonexModule class automatic will been inherited
const pureModule = {
  state: {},
  addItem(item){
   this.setState({...this.state, [item.name]: item })
  }
}

const modules = {
  pureModule
}

export default modules 
```

> æ³¨æ„:çº¯æ¨¡å—ä¸æ”¯æŒç®­å¤´å‡½æ•°ä½œä¸ºå±æ€§ã€‚

# [](#conclusion)ç»“è®º

æ­£å¦‚æˆ‘æ‰€è¯´çš„è¿™ä¸ªé¡¹ç›®å¹¶æ²¡æœ‰ç»“æŸï¼Œè€Œæ˜¯å·²ç»åŒ…å«åœ¨ NPMã€‚æˆ‘æ­£åœ¨æˆ‘æœ€å–œæ¬¢é¡¹ç›®ä¸­ä½¿ç”¨å®ƒï¼Œå¹¶å°†å¾ˆå¿«åœ¨ stonex ä¸Šè¿ç§»ä¸€äº›ä¼ä¸š web é¡¹ç›®ã€‚

ç›®å‰ï¼Œæˆ‘æ­£åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„è¦†ç›–ä»£ç ï¼Œå¹¶åœ¨ä»»ä½•å¯èƒ½çš„åœ°æ–¹ç¼–å†™æ–‡æ¡£ã€‚

**æ„Ÿè°¢é˜…è¯»ï¼æˆ‘çœŸçš„å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ ã€‚**

å¾ˆé«˜å…´çœ‹åˆ°å…³äºè¿™ä¸ªé¡¹ç›®çš„ä»»ä½•è´¡çŒ®æˆ–é—®é¢˜ï¼ğŸ™‚

ç¼–ç å¿«ä¹ï¼ğŸŒŸâœ¨ğŸ‰

### [](#extra-inks)é¢å¤–æ²¹å¢¨

Github ä¸Šæœ‰ react å’Œ stonex çš„æ ·ä¾‹é¡¹ç›®[åœ¨è¿™é‡Œ](https://github.com/js2me/react-stonex-webpack-scss-boilerplate)T2:[https://www.npmjs.com/package/stonex](https://www.npmjs.com/package/stonex)T5ã€‘Github:[https://github.com/acacode/stonex](https://github.com/acacode/stonex)

[![](../Images/72214424c0ce50bb1313546b32128b07.png)T2ã€‘](https://i.giphy.com/media/Ydvn0G7Agtk9G/giphy-downsized.gif)