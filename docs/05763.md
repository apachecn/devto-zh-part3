# ç”¨ JavaScript å’Œ Oclif æ„å»ºä¸€æµçš„ CLI

> åŸæ–‡:[https://dev . to/fede kau/building-awesome-clis-with-JavaScript-and-oclif-291 o](https://dev.to/fedekau/building-awesome-clis-with-javascript-and-oclif-291o)

*æœ€åˆå‘è¡¨äº[æ–¯ç‰¹é‡Œå¼—çš„åšå®¢](https://www.streaver.com/blog/posts/building-CLIs-with-javascript-and-oclif.html)ã€‚*

## [](#lets-first-define-a-cli)æˆ‘ä»¬å…ˆæ¥å®šä¹‰ä¸€ä¸ª CLI

å½“ç„¶ï¼Œåœ¨è°·æ­Œä¸Šå¿«é€Ÿæœç´¢ä¼šå¾—åˆ°ä¸€ç¯‡å¸¦æœ‰ CLI å®šä¹‰çš„[ç»´åŸºç™¾ç§‘æ–‡ç« ](https://en.wikipedia.org/wiki/Command-line_interface):

> å‘½ä»¤è¡Œç•Œé¢æˆ–å‘½ä»¤è¯­è¨€è§£é‡Šå™¨(CLI)ï¼Œä¹Ÿç§°ä¸ºå‘½ä»¤è¡Œç”¨æˆ·ç•Œé¢ã€æ§åˆ¶å°ç”¨æˆ·ç•Œé¢å’Œå­—ç¬¦ç”¨æˆ·ç•Œé¢(CUI)ï¼Œæ˜¯ä¸€ç§ä¸è®¡ç®—æœºç¨‹åºäº¤äº’çš„æ–¹å¼ï¼Œå…¶ä¸­ç”¨æˆ·(æˆ–å®¢æˆ·ç«¯)ä»¥è¿ç»­æ–‡æœ¬è¡Œ(å‘½ä»¤è¡Œ)çš„å½¢å¼å‘ç¨‹åºå‘å‡ºå‘½ä»¤ã€‚å¤„ç†æ¥å£çš„ç¨‹åºç§°ä¸ºå‘½ä»¤è¯­è¨€è§£é‡Šç¨‹åºæˆ– shell(è®¡ç®—)ã€‚

å› æ­¤ï¼Œç®€è€Œè¨€ä¹‹ï¼ŒCLI æ˜¯ä¸€ç§ç¨‹åºï¼Œå®ƒå¯ä»¥ç†è§£ç”¨æˆ·ä»¥æ–‡æœ¬å½¢å¼å‘å‡ºçš„è¯·æ±‚ï¼Œç„¶ååšå‡ºå“åº”å¹¶æ‰§è¡Œä»£ç ã€‚

è¿™ç§ç¨‹åºå¯¹äºè®¸å¤šä¸åŒçš„ç”¨ä¾‹éå¸¸æœ‰ç”¨ï¼Œä»æ˜¾ç¤ºå½“å‰æœˆä»½çš„ç®€å• CLI(å¦‚`cal` Bash å·¥å…·)åˆ°ç®¡ç† Kubernetes é›†ç¾¤çš„æå…¶å¤æ‚çš„ CLI(å¦‚`kubectl`)ã€‚

å³ä½¿ä½ ä¸æ˜¯æ¯å¤©éƒ½ç›´æ¥ä½¿ç”¨ CLI(è¿™æ˜¯éå¸¸ä¸å¯èƒ½çš„)ï¼Œä½ ä¹Ÿå¾ˆå¯èƒ½æ­£å—åˆ°å®ƒä»¬çš„é—´æ¥å½±å“ï¼Œä¾‹å¦‚ï¼Œ`git`æ˜¯ CLIï¼Œ`gcc`GNU ç¼–è¯‘å™¨ï¼Œ`create-react-app`ç”¨äºç”Ÿæˆ React åº”ç”¨çš„è„šæ‰‹æ¶ CLIï¼Œç­‰ç­‰ã€‚

## [](#how-to-build-your-own-clis)å¦‚ä½•æ‰“é€ è‡ªå·±çš„ CLI

å°±åƒç§‘æŠ€ç•Œçš„è®¸å¤šäº‹æƒ…ä¸€æ ·ï¼Œç­”æ¡ˆæ˜¯:â€œè§†æƒ…å†µè€Œå®šâ€ã€‚æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥æ„å»ºå®ƒä»¬ï¼Œå¹¶ä¸”æ‰€æœ‰è¿™äº›æ–¹æ³•åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­éƒ½å¯èƒ½æ˜¯æœ‰æ•ˆçš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å°†æ¢ç´¢å¦‚ä½•ç”¨ JavaScript å’Œ [Oclif: a Node æ„å»ºä¸€ä¸ªã€‚JS Open CLI Framework(ç”± Heroku å¼€å‘)](https://github.com/oclif/oclif)ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªç”¨äºæ„å»º CLI çš„ CLIğŸ¤”ã€‚

**å±é™©**

ä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘å°†å‡è®¾ä½ å¯¹ JavaScript å’Œ NPM ç”Ÿæ€ç³»ç»Ÿå¾ˆç†Ÿæ‚‰ï¼Œå¦‚æœä½ ä¸ç†Ÿæ‚‰ï¼Œä½ å¯èƒ½ä¼šæœ‰ä¸€ä¸ªå¤§æ¦‚çš„æ¦‚å¿µï¼Œä½†æ˜¯æˆ‘å»ºè®®ä½ åœ¨å¼€å§‹ä¹‹å‰é˜…è¯»ä¸€äº›ç›¸å…³çš„å†…å®¹ğŸ˜ƒã€‚

### Oclif å…¥é—¨

åœ¨æˆ‘çœ‹æ¥ï¼Œæ„å»ºä¸€äº›ä¸œè¥¿é€šå¸¸æ˜¯ä¸€ç§å¾ˆå¥½çš„å­¦ä¹ æ–¹å¼ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å’Œ [@flarraa](https://twitter.com/flarraa) åšäº†ä¸€äº›å¤´è„‘é£æš´ï¼Œå†³å®šæ„å»ºä¸€ä¸ªâ€œCopa Libertadoresâ€CLI([è§ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Copa_Libertadores))ã€‚

è¿™ä¸ªæƒ³æ³•æ˜¯æä¾›ä¸€ç»„å‘½ä»¤ï¼Œå¯ä»¥æ£€ç´¢å’Œæ˜¾ç¤ºå…³äºâ€œCopa Libertadoresâ€é”¦æ ‡èµ›å·²ç»è¿›è¡Œçš„æ¯”èµ›å’Œå³å°†è¿›è¡Œçš„æ¯”èµ›çš„ä¿¡æ¯ã€‚

è®©æˆ‘ä»¬å¼€å§‹åƒå§ï¼

Oclif CLI æœ‰ä¸¤ç§å¯èƒ½çš„æ–¹å¼ç”Ÿæˆ CLI é¡¹ç›®ï¼Œä¸€ç§æ˜¯`npx oclif single mynewcli`ï¼Œå¦ä¸€ç§æ˜¯`npx oclif multi mynewcli`ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ç”Ÿæˆä¸€ä¸ªå¤šå‘½ä»¤ CLIã€‚

æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„å‘½ä»¤çœ‹èµ·æ¥åƒ`libertadores games:all`ã€`libertadores games:past`ã€`libertadores games:upcoming`ï¼Œè¿™ä¸ Oclif çš„å¤šå‘½ä»¤ CLI ç”Ÿæˆæ˜¯ä¸€è‡´çš„ã€‚

#### [](#initializing-the-project)åˆå§‹åŒ–é¡¹ç›®

é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡åšä»¥ä¸‹äº‹æƒ…æ¥åˆå§‹åŒ–é¡¹ç›®:

```
npx oclif multi libertadores-cli 
```

è¿™å°†è¯¢é—®ä¸€äº›é—®é¢˜ï¼Œä¹‹åï¼Œå®ƒå°†å®‰è£…ä½ éœ€è¦å¼€å§‹ç¼–ç çš„ä¸€åˆ‡ï¼

```
$ npx oclif multi libertadores
npx: installed 442 in 32.454s

     _-----_     â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
    |       |    â”‚      Time to build a     â”‚
    |--(o)--|    â”‚  multi-command CLI with  â”‚
   `---------Â´   â”‚  oclif! Version: 1.13.1  â”‚
    ( _Â´U`_ )    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
    /___A___\   /
     |  ~  |
   __'.___.'__
 Â´   `  |Â° Â´ Y `

? npm package name libertadores-cli
? command bin name the CLI will export libertadores
? description A simple CLI to get information about "Copa Libertadores" right in your terminal
? author Federico Kauffman
? version 0.0.0
? license MIT
? Who is the GitHub owner of repository (https://github.com/OWNER/repo) streaver
? What is the GitHub name of repository (https://github.com/owner/REPO) libertadores-cli
? Select a package manager yarn
? TypeScript No
? Use eslint (linter for JavaScript) Yes
? Use mocha (testing framework) Yes
? Add CI service config circleci (continuous integration/delivery service) 
```

æˆ‘å·²ç»é€‰æ‹©äº†ä¸€äº›æˆ‘å–œæ¬¢çš„é»˜è®¤è®¾ç½®ï¼Œç°åœ¨ä½ å·²ç»æœ‰äº†ä¸€å †æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œå®ƒä»¬å°†æ˜¯æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®çš„ä¸»è¦ç»“æ„ã€‚æ¥ä¸‹æ¥ç”¨`cd libertadores-cli`è¿›å…¥ç›®å½•ã€‚

æˆ‘å°†ç®€å•è§£é‡Šä¸€ä¸‹ Oclif ä¸ºæˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆ:

```
.
â”œâ”€â”€ README.md
â”œâ”€â”€ bin
â”‚   â”œâ”€â”€ run
â”‚   â””â”€â”€ run.cmd
â”œâ”€â”€ package.json
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ commands
â”‚   â”‚   â””â”€â”€ hello.js
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ test
â”‚   â”œâ”€â”€ commands
â”‚   â”‚   â””â”€â”€ hello.test.js
â”‚   â””â”€â”€ mocha.opts
â””â”€â”€ yarn.lock

5 directories, 9 files 
```

æŸ¥çœ‹æ–‡ä»¶æ ‘ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°`bin`ç›®å½•ï¼Œå…¶ä¸­åŒ…å«åœ¨æ¯ä¸ªå¹³å°(Unix/Windows)ä¸Šè¿è¡Œå‘½ä»¤çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

æ‚¨ä¼šçœ‹åˆ°å¸¦æœ‰ä¸€ä¸ª`index.js`æ–‡ä»¶çš„`src`æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶ç®€å•åœ°å¯¼å‡ºä¸€ä¸ªå†…éƒ¨ Oclif åŒ…ï¼Œè¯¥åŒ…å°†åŠ è½½å¯ç”¨çš„å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤åœ¨æ”¾ç½®äº`src/commands`æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ä¸­å®šä¹‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒOclif ç”Ÿæˆä¸€ä¸ª`hello`å‘½ä»¤ï¼Œè®©æˆ‘ä»¬è¿è¡Œå®ƒï¼Œçœ‹çœ‹æˆ‘ä»¬æœ‰ä»€ä¹ˆ:

```
$ ./bin/run

A simple CLI to get information about "Copa Libertadores" right in your terminal

VERSION
  libertadores-cli/0.0.0 darwin-x64 node-v11.13.0

USAGE
  $ libertadores [COMMAND]

COMMANDS
  hello  Describe the command here
  help   display help for libertadores 
```

å¦‚æœæ‚¨è¿è¡Œ`hello`å­å‘½ä»¤ï¼Œæ‚¨ä¼šå¾—åˆ°:

```
$ ./bin/run hello

hello world from ./src/commands/hello.js 
```

æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œæ‚¨æœ‰ä¸€ä¸ª`tests`æ–‡ä»¶å¤¹ï¼Œæ‚¨å°†åœ¨å…¶ä¸­æ”¾ç½®æ‰€æœ‰çš„æµ‹è¯•ï¼Œäº‹å®ä¸Šï¼ŒOclif å·²ç»åˆ›å»ºäº†ä¸€äº›æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨`npm run test`æˆ–`yarn test`æ¥è¿è¡Œå®ƒä»¬ã€‚

#### [](#creating-the-first-command)åˆ›å»ºç¬¬ä¸€ä¸ªå‘½ä»¤

é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤`hello`å‘½ä»¤ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ‰“ç®—ä½¿ç”¨å®ƒï¼Œç®€å•åœ°åˆ é™¤`src/command/hello.js`å’Œ`tests/commands/hello.test.js`ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Oclif CLI ç”Ÿæˆå™¨å‘½ä»¤ï¼Œè®©æˆ‘ä»¬ç”¨
åˆ›å»º`games:all`å‘½ä»¤

```
npx oclif command games:all 
```

è¿™å°†åˆ›å»ºå‘½ä»¤æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶(åŒ…æ‹¬æµ‹è¯•),å¹¶ä¸”è‡ªåŠ¨æ›´æ–°`README.md`æ–‡ä»¶ä»¥åŒ…å«æ–°å‘½ä»¤ã€‚

æˆ‘ä»¬å°†ä»[http://www.conmebol.com/es/copa-libertadores-2019/fixture](http://www.conmebol.com/es/copa-libertadores-2019/fixture)è·å¾—â€œCopa Libertadoresâ€çš„è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨[æœ¨å¶å¸ˆ](https://github.com/GoogleChrome/puppeteer)è¿›å…¥ç½‘ç«™å¹¶è·å–æ•°æ®ã€‚

```
$ yarn add puppeteer --save 
```

```
const puppeteer = require("puppeteer");
...
class AllCommand extends Command {
  async run() {
    ...
    const browser = await puppeteer.launch();
    const page = await browser.newPage();
    await page.goto(
      "http://www.conmebol.com/es/copa-libertadores-2019/fixture",
      { waitUntil: "load", timeout: 0 }
    );

    // Insert some really crazy code to parse the HTML
    // you can find this at https://github.com/streaver/libertadores-cli

    this.log(results);
  }
} 
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥æ‰§è¡Œ`libertadores games:all`ï¼Œæˆ‘ä»¬å°†åœ¨ç»ˆç«¯ä¸Šå¾—åˆ°ç»“æœ:

[![asciicast](../Images/4909301fd6fb80c1635be9b89fe4f7af.png)T2ã€‘](https://asciinema.org/a/mW5uSGbLT4ItkungqKzTkFeBd)

ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œæˆ‘è¿˜æ·»åŠ äº†ä¸€ä¸ªâ€œåŠ è½½â€ç‰¹æ€§æ¥ç»™ç”¨æˆ·ä¸€äº›è§†è§‰åé¦ˆã€‚ä¸ºäº†å¢åŠ è¿™ä¸€ç‚¹ï¼Œæ‚¨åªéœ€å®‰è£…åŒ…`cli-ux`ï¼Œç„¶åå°†ä»£ç çš„â€œæ…¢â€éƒ¨åˆ†åŒ…è£…åœ¨ä¸€äº›å¼€å§‹/åœæ­¢è°ƒç”¨ä¸­:

è¿™æ ·å®‰è£…:

```
yarn add cli-ux --save 
```

æ·»åŠ ç±»ä¼¼äº
çš„å¾®è°ƒå™¨

```
const { cli } = require('cli-ux');
...

cli.action.start('Fetching data');
//Do something that takes time
cli.action.stop();
... 
```

ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº† CLIï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå®ƒç¼–å†™æµ‹è¯•äº†ï¼Oclif ä¸ºæµ‹è¯•è¿™ç§ CLI æä¾›äº†ä¸€äº›ä¸é”™çš„é»˜è®¤å€¼ã€‚åœ¨è¿™ä¸ªç‰¹æ®Šçš„ä¾‹å­ä¸­ï¼Œæ‚¨åªæƒ³æµ‹è¯•ç»ˆç«¯çš„è¾“å‡ºæ˜¯å¦æ˜¯æ‚¨æ‰€æœŸæœ›çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™æ­£æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„å‘½ä»¤æµ‹è¯•æ‰€åšçš„ï¼Œæ‚¨åªéœ€è¦ä¿®æ”¹ä»£ç ï¼

æˆ‘å°†æŠŠè¿™ä¸ªä»»åŠ¡ç•™ç»™ä½ (è¯»è€…ï¼Œå°±åƒæ•°å­¦ä¹¦ä¸€æ ·)ğŸ™„...æˆ–è€…ï¼Œæ‚¨å¯ä»¥åœ¨â€œCopa Libertadoresâ€CLI çš„[å®˜æ–¹çŸ¥è¯†åº“](https://www.github.com/streaver/libertadores-cli)ä¸­æŸ¥çœ‹å®ƒä»¬ã€‚

å®‰è£…å‘½ä»¤è¡Œç•Œé¢ï¼Œä¿æŒæœ€æ–°çŠ¶æ€ï¼Œä¸è¦å†é”™è¿‡æ¯”èµ›äº†ï¼Œâ¤ï¸âš½ï¼