# ä½¿ç”¨ React å’Œ AWS å®ç°æ— æœåŠ¡å™¨æ‰©å±•ç¬¬ 2 éƒ¨åˆ†:åˆ›å»ºå’Œä½¿ç”¨æ— æœåŠ¡å™¨æœåŠ¡

> åŸæ–‡:[https://dev . to/pmbanugo/going-server less-with-react-and-AWS-amplify-part-2-creating-and-use-server less-services-340 e](https://dev.to/pmbanugo/going-serverless-with-react-and-aws-amplify-part-2-creating-and-using-serverless-services-340e)

æ— æœåŠ¡å™¨æ˜¯ä¸€ç§äº‘è®¡ç®—æ‰§è¡Œæ¨¡å‹ï¼Œå…¶ä¸­äº‘æä¾›å•†è´Ÿè´£é€šè¿‡åœ¨éœ€è¦æ—¶åŠ¨æ€åˆ†é…èµ„æºæ¥è¿è¡Œä»£ç ï¼Œä»è€Œæ‰§è¡Œä¸€æ®µä»£ç ã€‚åœ¨ä¹‹å‰çš„[å¸–å­](https://www.pmbanugo.me/blog/2019-01-07-going-serverless-with-react-and-aws-amplify-development-environment-set-up/)ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†ä»€ä¹ˆæ˜¯æ— æœåŠ¡å™¨ï¼Œæˆ‘ä»¬è®¾ç½®æˆ‘ä»¬çš„è®¡ç®—æœºèƒ½å¤Ÿä½¿ç”¨ AWS Amplify æ„å»ºæ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ª React é¡¹ç›®ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ äº† Amplify åº“ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Amplify CLI æ¥æä¾›ä¸€ä¸ªå®‰å…¨çš„åç«¯ API å’Œä¸€ä¸ª NoSQL æ•°æ®åº“ã€‚ç„¶åæˆ‘ä»¬å°†ä» React é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ª APIã€‚

# [](#creating-the-serverless-backend-services)åˆ›å»ºæ— æœåŠ¡å™¨åç«¯æœåŠ¡

æˆ‘ä»¬å°†è¦æ„å»ºçš„åº”ç”¨ç¨‹åºå°†å…è®¸ç”¨æˆ·æ‰§è¡ŒåŸºæœ¬çš„ CRUD æ“ä½œã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰ NoSQL æ•°æ®åº“çš„ REST APIã€‚æŒ‰ç…§ä¸‹é¢çš„è¯´æ˜åˆ›å»ºæ— æœåŠ¡å™¨åç«¯ã€‚

1.  æ‰“å¼€å‘½ä»¤è¡Œå¹¶è½¬åˆ°é¡¹ç›®çš„æ ¹ç›®å½•ã€‚
2.  è¿è¡Œå‘½ä»¤`amplify add api`ã€‚
3.  æ‚¨ä¼šæ”¶åˆ°é€‰æ‹©æœåŠ¡ç±»å‹çš„æç¤ºã€‚é€‰æ‹©`REST`å¹¶æŒ‰ä¸‹å›è½¦é”®ã€‚
4.  å®ƒä¼šæç¤ºæ‚¨è¾“å…¥å½“å‰ç±»åˆ«(api ç±»åˆ«)çš„åç§°ã€‚è¾“å…¥`todosApi`å¹¶æŒ‰å›è½¦é”®ã€‚
5.  ä½ è¢«è¦æ±‚èµ°ä¸€æ¡è·¯ã€‚æŒ‰ Enter é”®æ¥å—é»˜è®¤çš„`items`è·¯å¾„ã€‚
6.  ä¸‹ä¸€ä¸ªæç¤ºè¯¢é—® Lambda æºã€‚æ— æœåŠ¡å™¨ REST API çš„å·¥ä½œæ–¹å¼æ˜¯åœ¨ API Gateway ä¸Šåˆ›å»ºä¸€ä¸ªè·¯å¾„ï¼Œå¹¶å°†è¯¥è·¯å¾„æ˜ å°„åˆ°ä¸€ä¸ª lambda å‡½æ•°ã€‚lambda å‡½æ•°åŒ…å«å½“è¯·æ±‚è¢«æ˜ å°„åˆ°çš„è·¯å¾„æ—¶è¦æ‰§è¡Œçš„ä»£ç ã€‚æˆ‘ä»¬å°†åˆ›é€ ä¸€ä¸ªæ–°çš„Î»ã€‚é€‰æ‹©é€‰é¡¹`Create a new Lambda function`å¹¶æŒ‰ä¸‹å›è½¦é”®ã€‚
7.  è¾“å…¥`todosLambda`ä½œä¸ºç±»åˆ«(åŠŸèƒ½ç±»åˆ«)çš„èµ„æºåç§°ï¼Œç„¶åæŒ‰å›è½¦é”®ã€‚
8.  æ‚¨å°†è¢«è¦æ±‚è¾“å…¥ lambda å‡½æ•°çš„åç§°ã€‚è¾“å…¥`todos`å¹¶æŒ‰å›è½¦é”®ã€‚
9.  æ‚¨å°†è¢«è¦æ±‚é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿æ¥ä¸ºè¿™ä¸ªå‡½æ•°ç”Ÿæˆä»£ç ã€‚é€‰æ‹©é€‰é¡¹`CRUD function for Amazon DynamoDB table (Integration with Amazon API Gateway and Amazon DynamoDB)`å¹¶æŒ‰ä¸‹å›è½¦é”®ã€‚è¿™åˆ›å»ºäº†ä¸€ä¸ªä½¿ç”¨ API Gateway with Express çš„æ¶æ„ï¼Œè¯¥æ¶æ„è¿è¡Œåœ¨ä¸€ä¸ª AWS Lambda å‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°è¯»å†™ Amazon DynamoDBã€‚
10.  ä¸‹ä¸€ä¸ªæç¤ºè¦æ±‚æ‚¨é€‰æ‹©ä¸€ä¸ª DynanoDB æ•°æ®æºã€‚æˆ‘ä»¬æ²¡æœ‰ç°æˆçš„ DynamoDB è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†é€‰æ‹©`Create a new DynamoDB table`é€‰é¡¹ã€‚æŒ‰å›è½¦é”®ç»§ç»­ã€‚ç°åœ¨æ‚¨åº”è¯¥çœ‹åˆ° DynamoDB æ•°æ®åº“å‘å¯¼ã€‚å®ƒå°†è¯¢é—®ä¸€ç³»åˆ—é—®é¢˜æ¥ç¡®å®šå¦‚ä½•åˆ›å»ºæ•°æ®åº“ã€‚
11.  æ‚¨å°†è¢«è¦æ±‚è¾“å…¥è¯¥èµ„æºçš„åç§°ã€‚è¾“å…¥`todosTable`å¹¶æŒ‰å›è½¦é”®ã€‚
12.  ä¸‹ä¸€ä¸ªæç¤ºæ˜¯è¾“å…¥è¡¨åã€‚è¾“å…¥`todos`å¹¶æŒ‰å›è½¦é”®ã€‚
13.  æ‚¨å°†è¢«è¦æ±‚å‘ DynamoDB è¡¨ä¸­æ·»åŠ åˆ—ã€‚æŒ‰ç…§æç¤ºåˆ›å»ºç±»å‹ä¸º`String`çš„åˆ—`id`ã€‚
14.  å½“è¯¢é—®è¡¨çš„åˆ†åŒºé”®(ä¸»é”®)æ—¶ï¼Œé€‰æ‹©`id`åˆ—ã€‚
15.  å°†è¯¢é—®æ‚¨æ˜¯å¦è¦å‘è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæ’åºå…³é”®å­—ã€‚é€‰æ‹©å‡ã€‚
16.  ä¸‹ä¸€ä¸ªæç¤ºè¯¢é—®æ‚¨æ˜¯å¦æƒ³è¦å°†å…¨å±€äºŒçº§ç´¢å¼•æ·»åŠ åˆ°è¡¨ä¸­ã€‚è¾“å…¥`n`å¹¶æŒ‰å›è½¦é”®ã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ¶ˆæ¯`Successfully added DynamoDb table locally`
17.  ä¸‹ä¸€ä¸ªæç¤ºè¯¢é—®**ä½ æƒ³ç°åœ¨ç¼–è¾‘æœ¬åœ° lambda å‡½æ•°å—ï¼Ÿ**ã€‚è¾“å…¥`n`å¹¶æŒ‰å›è½¦é”®ã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ¶ˆæ¯`Successfully added the Lambda function locally`ã€‚
18.  ç³»ç»Ÿä¼šè¯¢é—®æ‚¨æ˜¯å¦å¸Œæœ›é™åˆ¶å¯¹ API çš„è®¿é—®ã€‚è¾“å…¥`y`å¹¶æŒ‰å›è½¦é”®ã€‚
19.  å¯¹äºä¸‹ä¸€ä¸ªæç¤ºï¼Œé€‰æ‹©`Authenticated and Guest users`å¹¶æŒ‰å›è½¦é”®ã€‚è¯¥é€‰é¡¹å…è®¸æˆæƒç”¨æˆ·å’Œè®¿å®¢ç”¨æˆ·è®¿é—® REST APIã€‚
20.  æ¥ä¸‹æ¥ï¼Œä½ ä¼šè¢«é—®åˆ°`What kind of access do you want for Authenticated users`ã€‚é€‰æ‹©`read/write`å¹¶æŒ‰å›è½¦é”®ã€‚
21.  ç°åœ¨ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæç¤ºï¼Œè®©æˆ‘ä»¬ä¸ºæœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·(å³ gues ç”¨æˆ·)é€‰æ‹©è®¿é—®ç±»å‹ã€‚é€‰æ‹©`read`å¹¶æŒ‰ä¸‹å›è½¦é”®ã€‚æ‚¨åº”è¯¥ä¼šæ”¶åˆ°æ¶ˆæ¯`Successfully added auth resource locally`ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬é€‰æ‹©äº†é™åˆ¶å¯¹ API çš„è®¿é—®ï¼Œå¹¶ä¸” CLI å°† Auth ç±»åˆ«æ·»åŠ åˆ°äº†é¡¹ç›®ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æ²¡æœ‰ä»»ä½• Auth ç±»åˆ«ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æ·»åŠ äº†åˆ›å»º API æ‰€éœ€çš„èµ„æº(API Gatewayã€DynamoDBã€Lambda å‡½æ•°å’Œç”¨äºèº«ä»½éªŒè¯çš„ Cognito)ã€‚
22.  æˆ‘ä»¬è¢«è¯¢é—®æ˜¯å¦è¦å‘ API æ·»åŠ å¦ä¸€ä¸ªè·¯å¾„ã€‚è¾“å…¥`n`å¹¶æŒ‰å›è½¦é”®ã€‚è¿™ä¸ªè¿‡ç¨‹å°±å®Œæˆäº†ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ¶ˆæ¯`Successfully added resource todosApi locally`ã€‚

[![amplify-add-api.gif](../Images/6e69763e039beb67059906066bcf2f51.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--J00-ehwi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/yz7nolpk4conin0se4cc.gif)

`amplify add api`å‘½ä»¤å¸¦æˆ‘ä»¬å®Œæˆäº†åˆ›å»º REST API çš„è¿‡ç¨‹ã€‚è¿™ä¸ª API å°†æ ¹æ®æˆ‘ä»¬é€‰æ‹©çš„é€‰é¡¹åˆ›å»ºã€‚åˆ›å»ºè¿™ä¸ª API éœ€è¦ 4 ä¸ª AWS æœåŠ¡ã€‚ä»–ä»¬æ˜¯:

1.  äºšé©¬é€Š DynamoDBã€‚è¿™å°†ä½œä¸ºæˆ‘ä»¬çš„ NoSQL æ•°æ®åº“ã€‚å½“æˆ‘ä»¬æ·»åŠ `todosTable`èµ„æºæ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`todos`çš„ DynomoDB è¡¨ã€‚æˆ‘ä»¬ç»™å®ƒ 3 åˆ—ï¼Œç”¨`id`ä½œä¸ºä¸»é”®ã€‚
2.  AWS Lambda å‡½æ•°ã€‚è¿™è®©æˆ‘ä»¬æ— éœ€ä¾›åº”æˆ–ç®¡ç†æœåŠ¡å™¨å³å¯è¿è¡Œä»£ç ã€‚è¿™æ˜¯æˆ‘ä»¬åœ¨ DynamoDB è¡¨ä¸Šæ‰§è¡Œ CRUD æ“ä½œçš„ä»£ç æ‰€åœ¨çš„ä½ç½®ã€‚
3.  äºšé©¬é€Š Cognitoã€‚è¿™è´Ÿè´£è®¤è¯å’Œç”¨æˆ·ç®¡ç†ã€‚è¿™è®©æˆ‘ä»¬å¯ä»¥å‘æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ·»åŠ ç”¨æˆ·æ³¨å†Œã€ç™»å½•å’Œè®¿é—®æ§åˆ¶ã€‚æˆ‘ä»¬é€‰æ‹©äº†é™åˆ¶è®¿é—®æˆ‘ä»¬çš„ API çš„é€‰é¡¹ï¼Œè¿™ä¸ªæœåŠ¡å°†å¸®åŠ©æˆ‘ä»¬è®¤è¯ç”¨æˆ·ã€‚
4.  äºšé©¬é€Š API ç½‘å…³ã€‚è¿™å°±æ˜¯æˆ‘ä»¬åˆ›å»º REST API ç«¯ç‚¹çš„åŸå› ã€‚æˆ‘ä»¬ä¸ºæ­¤æ·»åŠ äº†ä¸€ä¸ªåä¸º`todosApi`çš„èµ„æºï¼Œè·¯å¾„ä¸º`items`ã€‚æˆ‘ä»¬è¿˜é€‰æ‹©äº†é™åˆ¶è®¿é—® API çš„é€‰é¡¹ã€‚

ç„¶è€Œï¼Œè¿™ç§æœåŠ¡çš„æœåŠ¡è§„èŒƒè¿˜æ²¡æœ‰å‡ºç°åœ¨äº‘ä¸­ã€‚æˆ‘ä»¬éœ€è¦ç”¨ä¿¡æ¯æ›´æ–°äº‘ä¸­çš„é¡¹ç›®ï¼Œä»¥æä¾›æ‰€éœ€çš„æœåŠ¡ã€‚è¿è¡Œå‘½ä»¤`amplify status`ï¼Œæˆ‘ä»¬åº”è¯¥å¾—åˆ°ä¸€ä¸ªå…³äº amplify é¡¹ç›®çš„ä¿¡æ¯è¡¨ã€‚

| ç§ç±» | èµ„æºåç§° | æ“ä½œ | æä¾›å•†æ’ä»¶ |
| --- | --- | --- | --- |
| å‚¨å­˜ï¼›å‚¨å¤‡ | todosTable | åˆ›é€  | AWS äº‘ä¿¡æ¯ |
| åŠŸèƒ½ | æ‰˜å¤šæ–¯æ‹‰å§†è¾¾ | åˆ›é€  | AWS äº‘ä¿¡æ¯ |
| ä½œå®¶ï¼ˆauthor çš„ç®€å†™ï¼‰ | cognitodc1bbadf | åˆ›é€  | AWS äº‘ä¿¡æ¯ |
| ç¾å›½çŸ³æ²¹å­¦ä¼š(American Petroleum Institute) | å·¥å…· api | åˆ›é€  | AWS äº‘ä¿¡æ¯ |

å®ƒåˆ—å‡ºäº†æˆ‘ä»¬æ·»åŠ çš„ç±»åˆ«ä»¥åŠèµ„æºåç§°å’Œéœ€è¦ä¸ºè¯¥èµ„æºè¿è¡Œçš„æ“ä½œã€‚`Create`æ“ä½œçš„æ„æ€æ˜¯è¿™äº›èµ„æºéœ€è¦åœ¨äº‘ä¸­åˆ›å»ºã€‚`init`å‘½ä»¤ç»è¿‡ä¸€ä¸ªè¿‡ç¨‹æ¥äº§ç”Ÿ**ã€‚amplifyrc** æ–‡ä»¶(å®ƒè¢«å†™åˆ°é¡¹ç›®çš„æ ¹ç›®å½•)å¹¶åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ’å…¥ä¸€ä¸ª **amplify** æ–‡ä»¶å¤¹ç»“æ„ï¼Œé‡Œé¢å†™æœ‰åˆå§‹çš„é¡¹ç›®é…ç½®ä¿¡æ¯ã€‚æ‰“å¼€**æ”¾å¤§**æ–‡ä»¶å¤¹ï¼Œä½ ä¼šå‘ç°åä¸º**åç«¯**å’Œ**#å½“å‰-äº‘-åç«¯**çš„æ–‡ä»¶å¤¹ã€‚ **backend** æ–‡ä»¶å¤¹åŒ…å«è¦æ¨é€åˆ°äº‘çš„åç«¯èµ„æºè§„èŒƒçš„æœ€æ–°æœ¬åœ°å¼€å‘ï¼Œè€Œ **#current-cloud-backend** åŒ…å«ä¸Šæ¬¡è¿è¡Œ`push`å‘½ä»¤æ—¶äº‘ä¸­çš„åç«¯èµ„æºè§„èŒƒã€‚æ¯ä¸ªèµ„æºéƒ½å°†å†…å®¹å­˜å‚¨åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­è‡ªå·±çš„å­æ–‡ä»¶å¤¹ä¸­ã€‚

æ‰“å¼€æ–‡ä»¶**back end/function/todos lambda/src/app . js**ã€‚æ‚¨ä¼šæ³¨æ„åˆ°è¿™ä¸ªæ–‡ä»¶åŒ…å«åœ¨èµ„æºè®¾ç½®è¿‡ç¨‹ä¸­ç”Ÿæˆçš„ä»£ç ã€‚å®ƒä½¿ç”¨ [Express.js](https://expressjs.com/) è®¾ç½®è·¯çº¿ï¼Œä½¿ç”¨ [aws-serverless-express](https://github.com/awslabs/aws-serverless-express) åŒ…åœ¨ AWS Lambda å’Œ Amazon API Gateway ä¹‹ä¸Šä½¿ç”¨ Express.js æ¡†æ¶è½»æ¾æ„å»º RESTful APIsã€‚å½“æˆ‘ä»¬å°†é¡¹ç›®é…ç½®æ¨é€åˆ°äº‘ç«¯æ—¶ï¼Œå®ƒå°†ä½¿ç”¨ Amazon API Gateway é…ç½®ä¸€ä¸ªç®€å•çš„ä»£ç† APIï¼Œå¹¶å°†å…¶ä¸ Lambda å‡½æ•°é›†æˆã€‚è¯¥åŒ…åŒ…å«ä¸­é—´ä»¶ï¼Œå¯ä»¥è½»æ¾åœ°ä» API Gateway è·å¾— Lambda æ¥æ”¶çš„äº‹ä»¶å¯¹è±¡ã€‚å®ƒåº”ç”¨åœ¨ç¬¬ 32 è¡Œ`app.use(awsServerlessExpressMiddleware.eventContext());`ä¸Šï¼Œå¹¶åœ¨ä»£ç ç±»ä¼¼äº`req.apiGateway.event.*`çš„è·¯çº¿ä¸Šä½¿ç”¨ã€‚é¢„å®šä¹‰çš„è·¯å¾„å…è®¸æˆ‘ä»¬åœ¨ DynamoDB è¡¨ä¸Šæ‰§è¡Œ CRUD æ“ä½œã€‚æˆ‘ä»¬å°†å¯¹è¿™ä¸ªæ–‡ä»¶åšä¸€äº›ä¿®æ”¹ã€‚é¦–å…ˆæ˜¯å°†`tableName`å˜é‡çš„å€¼ä»`todosTable`æ”¹ä¸º`todos`ã€‚åœ¨åˆ›å»º DynamoDB èµ„æºæ—¶ï¼Œæˆ‘ä»¬å°†`todosTable`æŒ‡å®šä¸ºèµ„æºåï¼Œå°†`todos`æŒ‡å®šä¸ºè¡¨åï¼Œå› æ­¤åœ¨åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œå®ƒé”™è¯¯åœ°å°†èµ„æºåç”¨ä½œè¡¨åã€‚è¿™å¯èƒ½ä¼šåœ¨ CLI çš„æœªæ¥ç‰ˆæœ¬ä¸­å¾—åˆ°ä¿®å¤ï¼Œå› æ­¤å¦‚æœæ‚¨æ²¡æœ‰å‘ç°å®ƒè¢«é”™è¯¯åœ°ä½¿ç”¨ï¼Œæ‚¨å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚æˆ‘ä»¬è¿˜éœ€è¦æ›´æ–°å®šä¹‰ã€‚

å°†ç¬¬ä¸€ä¸ªè·¯ç”±å®šä¹‰æ›´æ”¹ä¸ºä½¿ç”¨ä¸‹é¢çš„ä»£ç ã€‚

```
app.get(path, function(req, res) {
  const queryParams = {
    TableName: tableName,
    ProjectionExpression: "id, title"
  };

  dynamodb.scan(queryParams, (err, data) => {
    if (err) {
      res.json({ error: "Could not load items: " + err });
    } else {
      res.json(data.Items);
    }
  });
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å®šä¹‰äº†ä¸€æ¡è·¯å¾„ï¼Œç”¨ä»£ç å“åº” **/items** è·¯å¾„ï¼Œè¿”å› DynamoDB è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚`ProjectionExpression`å€¼ç”¨äºæŒ‡å®šå®ƒåº”è¯¥åªè·å–åˆ—`id`å’Œ`title`ã€‚

å°†ç¬¬ 77 è¡Œçš„è·¯çº¿å®šä¹‰æ”¹ä¸º`app.get(path + hashKeyPath + sortKeyPath, function(req, res) {`ã€‚è¿™å…è®¸æˆ‘ä»¬æŒ‰ç…§è·¯å¾„ **/items/:id** é€šè¿‡é¡¹ç›®çš„`id`æ¥æ£€ç´¢é¡¹ç›®ã€‚ä¹Ÿå°†ç¬¬ 173 è¡Œæ”¹ä¸º`app.delete(path + hashKeyPath + sortKeyPath, function(req, res) {`ã€‚è¿™å“åº”äº HTTP DELETE æ–¹æ³•ï¼ŒæŒ‰ç…§è·¯å¾„ **/items/:id** åˆ é™¤ä¸€ä¸ªé¡¹ç›®ã€‚

AWS èµ„æºå·²ç»åœ¨æœ¬åœ°æ·»åŠ å’Œæ›´æ–°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨äº‘ä¸­æä¾›å®ƒä»¬ã€‚æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¿è¡Œ`amplify push`ã€‚å¦‚æœæ‚¨æƒ³ç»§ç»­æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œæ‚¨å°†å¾—åˆ°ä¸€ä¸ªæç¤ºã€‚è¾“å…¥`y`å¹¶æŒ‰å›è½¦é”®ã€‚å®ƒä¼šå°†æœ€æ–°ç‰ˆæœ¬çš„èµ„æºåµŒå¥—å †æ ˆæ¨¡æ¿ä¸Šä¼ åˆ° S3 éƒ¨ç½²æ¡¶ï¼Œç„¶åè°ƒç”¨ AWS CloudFormation API åœ¨äº‘ä¸­åˆ›å»º/æ›´æ–°èµ„æºã€‚

# [](#building-the-frontend)å»ºç­‘å‰ç«¯

å½“`amplify push`å‘½ä»¤å®Œæˆæ—¶ï¼Œä½ ä¼šåœ¨ **src** æ–‡ä»¶å¤¹ä¸­çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ **aws-exports.js** ã€‚è¯¥æ–‡ä»¶åŒ…å«äº‘ä¸­åˆ›å»ºçš„èµ„æºçš„ä¿¡æ¯ã€‚æ¯æ¬¡é€šè¿‡è¿è¡Œ`push`å‘½ä»¤åˆ›å»ºæˆ–æ›´æ–°èµ„æºæ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶éƒ½ä¼šè¢«æ›´æ–°ã€‚å®ƒæ˜¯ä¸º JavaScript é¡¹ç›®åˆ›å»ºçš„ï¼Œå°†åœ¨ Amplify JavaScript åº“ä¸­ä½¿ç”¨ã€‚æˆ‘ä»¬å°†åœ¨ React é¡¹ç›®ä¸­ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬è¿˜å°†ä½¿ç”¨ Bootstrap æ¥è®¾è®¡é¡µé¢æ ·å¼ã€‚æ‰“å¼€ **public/index.html** ï¼Œåœ¨å¤´ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
<link
  rel="stylesheet"
  href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
  integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
  crossorigin="anonymous"
/>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
  integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
  crossorigin="anonymous"
></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
  integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
  crossorigin="anonymous"
></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
  integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
  crossorigin="anonymous"
></script> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ·»åŠ ä¸€ä¸ªæ–°æ–‡ä»¶ **src/List.js** ï¼Œå†…å®¹å¦‚ä¸‹:

```
import React from "react";

export default props => (
  <div>
    <legend>List</legend>
    <div className="card" style={{ width: "25rem" }}>
      {renderListItem(props.list, props.loadDetailsPage)}
    </div>
  </div> );

function renderListItem(list, loadDetailsPage) {
  const listItems = list.map(item => (
    <li
      key={item.id}
      className="list-group-item"
      onClick={() => loadDetailsPage(item.id)}
    >
      {item.title}
    </li>
  ));

  return <ul className="list-group list-group-flush">{listItems}</ul>; } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯¥ç»„ä»¶å°†ä» API ä¸­å‘ˆç°ä¸€ä¸ªé¡¹ç›®åˆ—è¡¨ã€‚æ·»åŠ ä¸€ä¸ªæ–°æ–‡ä»¶ **src/Details.js** ï¼Œå†…å®¹å¦‚ä¸‹:

```
import React from "react";

export default props => (
  <div>
    <h2>Details</h2>
    <div className="btn-group" role="group">
      <button
        type="button"
        className="btn btn-secondary"
        onClick={props.loadListPage}
      >
        Back to List
      </button>
      <button
        type="button"
        className="btn btn-danger"
        onClick={() => props.delete(props.item.id)}
      >
        Delete
      </button>
    </div>
    <legend>{props.item.title}</legend>
    <div className="card">
      <div className="card-body">{props.item.content}</div>
    </div>
  </div> ); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯¥ç»„ä»¶å°†æ˜¾ç¤ºä¸€ä¸ªé¡¹ç›®çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶å¸¦æœ‰åˆ é™¤è¯¥é¡¹ç›®çš„æŒ‰é’®æˆ–è¿”å›åˆ°åˆ—è¡¨è§†å›¾ã€‚æ‰“å¼€ **src/App.js** ï¼Œç”¨ä»¥ä¸‹ä»£ç æ›´æ–°:

```
import React, { Component } from "react";
import List from "./List";
import Details from "./Details";

import Amplify, { API } from "aws-amplify";
import aws_exports from "./aws-exports";
import { withAuthenticator } from "aws-amplify-react";
Amplify.configure(aws_exports);

class App extends Component {
  constructor(props) {
    super(props);
    this.state = {
      content: "",
      title: "",
      list: [],
      item: {},
      showDetails: false
    };
  }

  async componentDidMount() {
    await this.fetchList();
  }
  handleChange = event => {
    const id = event.target.id;
    this.setState({ [id]: event.target.value });
  };

  handleSubmit = async event => {
    event.preventDefault();
    await API.post("todosApi", "/items", {
      body: {
        id: Date.now().toString(),
        title: this.state.title,
        content: this.state.content
      }
    });

    this.setState({ content: "", title: "" });
    this.fetchList();
  };
  async fetchList() {
    const response = await API.get("todosApi", "/items");
    this.setState({ list: [...response] });
  }

  loadDetailsPage = async id => {
    const response = await API.get("todosApi", "/items/" + id);
    this.setState({ item: { ...response }, showDetails: true });
  };

  loadListPage = () => {
    this.setState({ showDetails: false });
  };

  delete = async id => {
    //TODO: Implement functionality
  };

  render() {
    return (
      <div className="container">
        <form onSubmit={this.handleSubmit}>
          <legend>Add</legend>
          <div className="form-group">
            <label htmlFor="title">Title</label>
            <input
              type="text"
              className="form-control"
              id="title"
              placeholder="Title"
              value={this.state.title}
              onChange={this.handleChange}
            />
          </div>
          <div className="form-group">
            <label htmlFor="content">Content</label>
            <textarea
              className="form-control"
              id="content"
              placeholder="Content"
              value={this.state.content}
              onChange={this.handleChange}
            />
          </div>
          <button type="submit" className="btn btn-primary">
            Submit
          </button>
        </form>
        <hr />
        {this.state.showDetails ? (
          <Details
            item={this.state.item}
            loadListPage={this.loadListPage}
            delete={this.delete}
          />
        ) : (
          <List list={this.state.list} loadDetailsPage={this.loadDetailsPage} />
        )}
      </div>
    );
  }
}

export default withAuthenticator(App, true); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯¼å…¥äº† Amplify åº“ï¼Œå¹¶é€šè¿‡è°ƒç”¨`Amplify.configure(aws_exports);`å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚å½“ç»„ä»¶è¢«æŒ‚è½½æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨`fetchList()`ä» API ä¸­æ£€ç´¢é¡¹ç›®ã€‚è¿™ä¸ªå‡½æ•°ä½¿ç”¨ Amplify åº“ä¸­çš„ API å®¢æˆ·ç«¯æ¥è°ƒç”¨ REST APIã€‚åœ¨å¹•åï¼Œå®ƒåˆ©ç”¨ [Axios](https://github.com/axios/axios) æ¥æ‰§è¡Œ HTTP è¯·æ±‚ã€‚å®ƒå°†å‘è¯·æ±‚æ·»åŠ å¿…è¦çš„å¤´ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥æˆåŠŸåœ°è°ƒç”¨ REST APIã€‚å¦‚æœæ‚¨ä¸º API å®šä¹‰äº†è‡ªå®šä¹‰å¤´ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥æ·»åŠ å¤´ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬åªåœ¨ä» API å®¢æˆ·ç«¯è°ƒç”¨å‡½æ•°æ—¶æŒ‡å®š apiName å’Œ pathã€‚`loadDetailsPage()`å‡½æ•°é€šè¿‡ API ä»æ•°æ®åº“ä¸­è·å–ä¸€ä¸ªç‰¹å®šçš„æ¡ç›®ï¼Œç„¶åç”¨å“åº”å’Œ`showDetails`è®¾ç½®`item`çŠ¶æ€ä¸ºçœŸã€‚æ­¤`showDetails`åœ¨æ¸²æŸ“åŠŸèƒ½ä¸­ç”¨äºåœ¨æ˜¾ç¤ºé¡¹ç›®åˆ—è¡¨æˆ–æ‰€é€‰é¡¹ç›®çš„è¯¦ç»†ä¿¡æ¯é¡µé¢ä¹‹é—´åˆ‡æ¢ã€‚æäº¤è¡¨å•æ—¶ä¼šè°ƒç”¨å‡½æ•°`handleSubmit()`ã€‚å®ƒå°†è¡¨å•æ•°æ®å‘é€ç»™ APIï¼Œåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªæ–‡æ¡£ï¼ŒåŒ…å«åˆ—`id`ã€`title`å’Œ`content`ï¼Œç„¶åè°ƒç”¨`fetchList()`æ¥æ›´æ–°åˆ—è¡¨ã€‚æˆ‘å°†`delete()`å‡½æ•°ç•™ç©ºï¼Œè¿™æ ·æ‚¨å¯ä»¥è‡ªå·±å®ç°å®ƒã€‚æœ‰ä»€ä¹ˆæ¯”äº²è‡ªå°è¯•æ›´å¥½çš„å­¦ä¹ æ–¹æ³•å‘¢ğŸ˜‰ã€‚è¯¥åŠŸèƒ½å°†ä»`Details`ç»„ä»¶ä¸­çš„åˆ é™¤æŒ‰é’®è°ƒç”¨ã€‚å…¶ä¸­çš„ä»£ç åº”è¯¥è°ƒç”¨ API é€šè¿‡`id`åˆ é™¤ä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶æ˜¾ç¤ºåŒ…å«æ­£ç¡®é¡¹ç›®çš„åˆ—è¡¨ç»„ä»¶ã€‚æˆ‘ä»¬ç”¨ Amplify React åº“ä¸­çš„`withAuthenticator`é«˜é˜¶ç»„ä»¶åŒ…è£…äº† App ç»„ä»¶ã€‚è¿™ä¸ºåº”ç”¨ç¨‹åºæä¾›äº†å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æ³¨å†Œå’Œæ³¨é”€æµç¨‹ã€‚åªæœ‰ç™»å½•çš„ç”¨æˆ·æ‰èƒ½è®¿é—®è¯¥åº”ç”¨ç¨‹åºï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯è¿™ç§é«˜é˜¶ç»„ä»¶ã€‚`withAuthenticator`ç»„ä»¶è‡ªåŠ¨æ£€æµ‹è®¤è¯çŠ¶æ€å¹¶æ›´æ–° UIã€‚å¦‚æœç”¨æˆ·ç™»å½•ï¼Œæ˜¾ç¤ºåº•å±‚**åº”ç”¨**ç»„ä»¶ï¼Œå¦åˆ™æ˜¾ç¤ºç™»å½•/æ³¨å†Œæ§ä»¶ã€‚è®¾ç½®ä¸º`true`çš„ç¬¬äºŒä¸ªå‚æ•°å‘Šè¯‰å®ƒåœ¨é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºä¸€ä¸ªæ³¨é”€æŒ‰é’®ã€‚ä½¿ç”¨`withAuthenticator`ç»„ä»¶æ˜¯å°†è®¤è¯æµç¨‹æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­çš„æœ€ç®€å•æ–¹å¼ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªè‡ªå®šä¹‰ UIï¼Œå¹¶ä½¿ç”¨ Amplify åº“ä¸­çš„ä¸€ç»„ API æ¥å®ç°ç™»å½•å’Œæ³¨å†Œæµç¨‹ã€‚æ›´å¤šè¯¦æƒ…å‚è§[æ–‡æ¡£](https://aws-amplify.github.io/docs/js/authentication#working-with-the-api)ã€‚

æˆ‘ä»¬æ‹¥æœ‰ä½¿ç”¨è¯¥åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ä»£ç ã€‚æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œ`npm start`å¯åŠ¨åº”ç”¨ç¨‹åºã€‚æ‚¨éœ€è¦æ³¨å†Œå¹¶ç™»å½•æ‰èƒ½ä½¿ç”¨è¯¥åº”ç”¨ç¨‹åºã€‚

[![npm-start.gif](../Images/b7d44ce71d88ab0f40f518b50fd5ad93.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Qk7yFyKv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.filestackcontent.com/GaeXEh25TO6U9cxsKc8Y)

# [](#wrapping-up)åŒ…è£…å®Œæ¯•

æˆ‘ä»¬ä½¿ç”¨ Amplify CLI åˆ›å»ºäº†åç«¯æœåŠ¡ã€‚å‘½ä»¤`amplify add api`å¸¦æˆ‘ä»¬ä¸º DynamoDBã€Lambdaã€API Gateway å’Œç”¨äºè®¤è¯çš„ Cognito æ·»åŠ èµ„æºã€‚æˆ‘ä»¬æ›´æ–°äº†**back end/function/todos lambda/src/app . js**ä¸­çš„ä»£ç ï¼Œä»¥ç¬¦åˆæˆ‘ä»¬çš„ API è¦æ±‚ã€‚æˆ‘ä»¬æ·»åŠ äº† UI ç»„ä»¶æ¥å¯¹åº”ç”¨ç¨‹åºæ‰§è¡Œ CRUD æ“ä½œï¼Œå¹¶ä½¿ç”¨äº† Amplify React åº“ä¸­çš„ä¸€ä¸ªæ›´é«˜é˜¶çš„ç»„ä»¶ï¼Œåªå…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®åº”ç”¨ç¨‹åºã€‚æ‚¨åº”è¯¥æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬åªä½¿ç”¨äº†å‡ è¡Œä»£ç æ¥æ·»åŠ èº«ä»½éªŒè¯æµå’Œè°ƒç”¨ APIã€‚åŒæ ·ï¼Œåˆ›å»ºæ— æœåŠ¡å™¨åç«¯æœåŠ¡å¹¶å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·æ˜¯é€šè¿‡ä¸€ä¸ªå‘½ä»¤å¹¶å“åº”éšåçš„æç¤ºæ¥å®Œæˆçš„ã€‚ä»è€Œå±•ç¤ºäº† AWS Amplify å¦‚ä½•ä½¿å¼€å‘å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

> æœ€åˆå‘å¸ƒåœ¨æˆ‘çš„[åšå®¢](https://www.pmbanugo.me/blog/2019-01-14-going-serverless-with-react-and-aws-amplify-part-2-creating-and-using-serverless-services/)ä¸Šã€‚