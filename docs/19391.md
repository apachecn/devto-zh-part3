# ä¸ºä»€ä¹ˆå“ˆå¸Œè¡¨æ˜¯éšæœºçš„

> åŽŸæ–‡:[https://dev.to/aghost7/why-hash-maps-are-randomized-kln](https://dev.to/aghost7/why-hash-maps-are-randomized-kln)

æˆ‘æœ€è¿‘åœ¨æˆ‘çš„ä¸€ä¸ªä¸šä½™é¡¹ç›®ä¸­å®žçŽ°äº†ä¸€ä¸ªæ•£åˆ—è¡¨(hash table ),åªæ˜¯ä¸ºäº†å¥½çŽ©ï¼Œå¹¶äº†è§£äº†ä¸€ä¸ªæˆ‘æ²¡æœ‰æ„è¯†åˆ°çš„å…³äºŽå®‰å…¨æ€§çš„æœ‰è¶£çš„èŠ±çµ®ã€‚æˆ‘æƒ³æˆ‘åº”è¯¥åˆ†äº«ä¸€ä¸‹ï¼

## [](#how-hash-maps-work)å“ˆå¸Œæ˜ å°„å¦‚ä½•å·¥ä½œ

å…¶æ ¸å¿ƒæ˜¯ï¼Œå“ˆå¸Œæ˜ å°„èƒŒåŽçš„æ€æƒ³æ˜¯ä½¿ç”¨[å“ˆå¸Œå‡½æ•°](https://en.wikipedia.org/wiki/Hash_function)å°†ç»™å®šçš„é”®(ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²)è½¬æ¢æˆç´¢å¼•å€¼ã€‚ç„¶åŽï¼Œç´¢å¼•å°†ç¡®å®šæ•°æ®åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚æ’å…¥ã€åˆ é™¤å’Œè¯»å–æœ‰ä¸€ä¸ª[å¸¸æ•°æ—¶é—´](https://en.wikipedia.org/wiki/Time_complexity#Constant_time)å¤æ‚æ€§(æœ€å¥½çš„æƒ…å†µðŸ˜‰).è¿™æ„å‘³ç€æ— è®ºä½ çš„ hash å›¾ä¸­æœ‰å¤šå°‘å…ƒç´ ï¼Œä½ çš„æŸ¥æ‰¾æ—¶é—´éƒ½ä¸ä¼šæ”¹å˜ã€‚

ä½†æ˜¯ï¼Œç”±äºŽæˆ‘ä»¬æ˜¯å°†ä¿¡æ¯åŽ‹ç¼©åˆ°ä¸€ä¸ªæ•´æ•°ä¸­ï¼Œå› æ­¤å¯èƒ½ä¼šå‘ç”Ÿå†²çªã€‚è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¦ä¸€ä¸ªæ•°ç»„(ä¸€ä¸ªæ¡¶),åœ¨æˆ‘ä»¬çš„ hash map çš„æ•°ç»„ä¸­ï¼Œæ¥ä¿å­˜æ‰€æœ‰çš„å†²çªã€‚

æˆ‘å°†è·³è¿‡ä¸€äº›ç»†èŠ‚ï¼Œä½†æ˜¯ä¸ºäº†å¾—åˆ°ä¸€ä¸ªæ¦‚å¿µï¼Œè¿™æ˜¯ä¸€ä¸ªå“ˆå¸Œæ˜ å°„å®žçŽ°çš„å¤§æ¦‚æ ·å­:

```
class HashMap
    constructor() {
        this.buckets = new Array(1000) // arbitrary
    }
    set(key, value) {
        const index = hash(key)
        const bucket = this.buckets[index]
        if(!bucket) {
            this.buckets[index] = [{
                key: key,
                value: value
            }]
        } else {
            const item = bucket.find(item => item.key === key)
            if(item) {
                item.value = value
            } else {
                bucket.push({
                    key: key,
                    value: value
                })
            }
        }
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#denial-of-service)æ‹’ç»æœåŠ¡

æ‹’ç»æœåŠ¡æ³›æŒ‡æœåŠ¡è¢«æš‚æ—¶æˆ–æ°¸ä¹…å…³é—­çš„æ”»å‡»ã€‚

é€šå¸¸ï¼Œå®žçŽ°è¿™ä¸€ç‚¹çš„æ–¹æ³•æ˜¯åœ¨æœåŠ¡å™¨ç«¯é‡å¤è§¦å‘ä¸€ä¸ªéžå¸¸æ˜‚è´µçš„æ“ä½œã€‚

## [](#the-attack)æ”»å‡»

å¦‚ä¸Šæ‰€è¿°ï¼Œå½“å‘ç”Ÿç¢°æ’žæ—¶ï¼Œæ›´å¤šçš„ç‰©å“å°†è¢«æ”¾å…¥åŒä¸€ä¸ªæ¡¶ä¸­ã€‚å¦‚æžœè¿™ç§æƒ…å†µå‘ç”Ÿçš„æ¬¡æ•°è¶³å¤Ÿå¤šï¼Œé‚£ä¹ˆæ•£åˆ—å›¾çš„æ€§èƒ½å°†å¼€å§‹çœ‹èµ·æ¥æ›´åƒæ˜¯ä¸€ä¸ªé”®å’Œå€¼çš„é¡ºåºæ•°ç»„ã€‚æ¢å¥è¯è¯´ï¼Œå¤æ‚æ€§å°†å˜æˆçº¿æ€§çš„ã€‚

æ ¹æ®å“ˆå¸Œæ˜ å°„çš„æ€§èƒ½æœ‰å¤šé‡è¦ï¼Œæ‚¨çš„æœåŠ¡å™¨èµ„æºå¯èƒ½å¾ˆå®¹æ˜“è¢«å ç”¨ã€‚

## [](#the-solution)è§£

å¯¹äºŽæ”»å‡»è€…æ¥è¯´ï¼Œè¦åœ¨æˆ‘ä»¬çš„æ•£åˆ—å›¾ä¸­å¼•èµ·å†²çªï¼Œä»–éœ€è¦æå‰çŸ¥é“ä»€ä¹ˆä¼šå¼•èµ·å†²çªã€‚æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆä½¿æ”»å‡»è€…å‡ ä¹Žä¸å¯èƒ½çŒœå‡ºæ­£ç¡®çš„ç»„åˆé”®ï¼Œä»Žè€Œå¯¼è‡´è¶³å¤Ÿå¤šçš„å†²çªï¼Œå½±å“æœåŠ¡å™¨çš„æ€§èƒ½ã€‚

ä¸€äº›æ•£åˆ—å‡½æ•°å…è®¸ä¸ºæ•£åˆ—æŒ‡å®šç§å­ã€‚åˆ›å»ºæ•£åˆ—å›¾æ—¶ï¼Œæˆ‘ä»¬ç”Ÿæˆéšæœºç§å­ã€‚è¿™æ„å‘³ç€æ¯ä¸ªå“ˆå¸Œæ˜ å°„å®žä¾‹å°†æŠŠç›¸åŒçš„é”®è½¬æ¢æˆä¸åŒçš„ç´¢å¼•ã€‚å¦‚æžœå®ƒæ˜¯ä¸€ä¸ªå¯†ç å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬çŸ¥é“æ”»å‡»è€…å°†æ— æ³•çŒœå‡ºå®ƒã€‚

è§£å†³æ–¹æ¡ˆçš„å¤§è‡´æ€è·¯å¦‚ä¸‹:

```
class HashMap
    constructor() {
        this.seed = random()
        this.buckets = new Array(1000) // arbitrary
    }
    set(key, value) {
        const index = hash(this.seed, key)
        const bucket = this.buckets[index]
        if(!bucket) {
            this.buckets[index] = [{
                key: key,
                value: value
            }]
        } else {
            const item = bucket.find(item => item.key === key)
            if(item) {
                item.value = value
            } else {
                bucket.push({
                    key: key,
                    value: value
                })
            }
        }
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>