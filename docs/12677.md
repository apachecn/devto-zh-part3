# ä½¿ç”¨ Next.js 8 å’Œ Zeit Now æ„å»ºå’Œéƒ¨ç½²æ— æœåŠ¡å™¨ React åº”ç”¨ç¨‹åº

> åŸæ–‡:[https://dev . to/hasurahq/build-and-deploy-server less-react-apps-with-nextjs-8-and-zeit-now-22op](https://dev.to/hasurahq/build-and-deploy-serverless-react-apps-with-nextjs-8-and-zeit-now-22op)

**TLï¼›DR** :é…ç½® Next.js 8 æ— æœåŠ¡å™¨æ¨¡å¼ï¼Œä¸ºæ¯ä¸ªé¡µé¢ç”Ÿæˆ lambdasã€‚ä½¿ç”¨ Hasura GraphQL API ä½œä¸ºæ•°æ®å±‚ã€‚ç«‹å³éƒ¨ç½²åˆ° Zeitã€‚å³æ—¶è®¾ç½®ã€‚æ•™ç¨‹/æ ·æ¿æ–‡ä»¶ğŸ‘‰[next js-8-æ— æœåŠ¡å™¨](https://github.com/hasura/graphql-engine/tree/master/community/sample-apps/nextjs-8-serverless)

[![Next.js Serverless Now Hasura GraphQL](../Images/573228341d64c5c9836783b794386e31.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--YAG8ybQn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.hasura.io/content/images/2019/02/nextjs-serverless-now-hasura-graphql.png)

[Next.js 8](https://nextjs.org/blog/next-8#serverless-nextjs) ä¸Šå‘¨ç™»é™†ï¼Œæ”¯æŒæ— æœåŠ¡å™¨éƒ¨ç½²ã€‚åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼ŒNext.js å°†åº”ç”¨ç¨‹åºæ‹†åˆ†æˆæ— æœåŠ¡å™¨çš„ lambdasï¼Œæœ‰åŠ©äºæé«˜å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚â€œæŒ‰ä½¿ç”¨ä»˜è´¹â€æ¨¡å¼æ˜¯æ— æœåŠ¡å™¨åŒ–çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€ã€‚è¿˜æœ‰å…¶ä»–æ˜æ˜¾çš„å¥½å¤„ï¼Œå¦‚åˆ†å¸ƒå¼æ•…éšœç‚¹å’Œæ‰©å±•ã€‚å¯¹æ— æœåŠ¡å™¨çš„ç°æˆæ”¯æŒä»¤äººå…´å¥‹ï¼

ä¸ºäº†å¿«é€Ÿæµ‹è¯•ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªé›†æˆäº† Hasura GraphQL å¼•æ“çš„ Next.js 8 åº”ç”¨ç¨‹åºã€‚è¿™ä¸ªåº”ç”¨ç¨‹åºæœ‰å‡ ä¸ªé¡µé¢ï¼›ç´¢å¼•å’Œå…³äºã€‚ç´¢å¼•é¡µé¢å‘ˆç°ä» Hasura GraphQL è·å–çš„ä½œè€…åˆ—è¡¨ã€‚â€œå…³äºâ€é¡µé¢å‘ˆç°ä¸€äº›é™æ€æ–‡æœ¬ã€‚è¿™æ˜¯ç»™ä½ çš„å…¥é—¨æŒ‡å—ã€‚

## [](#deploy-hasura)éƒ¨ç½² Hasura

æŒ‰ç…§ [readme](https://github.com/hasura/graphql-engine/blob/master/community/sample-apps/nextjs-8-serverless/README.md) ä¸­çš„è¯´æ˜éƒ¨ç½² Hasura å¹¶åˆ›å»ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„è¡¨æ ¼ä½œè€…ã€‚æ³¨æ„ GraphQL ç«¯ç‚¹çš„ Heroku URLã€‚æ‚¨å°†åœ¨åº”ç”¨ç¨‹åºä¸­å¯¹æ­¤è¿›è¡Œé…ç½®ã€‚

## [](#clone-and-run-app)å…‹éš†å¹¶è¿è¡Œ app

[æ¼”ç¤ºåº”ç”¨](https://github.com/hasura/graphql-engine/tree/master/community/sample-apps/nextjs-8-serverless)å¸¦ä½ æ„å»ºä¸€ä¸ªç®€å•çš„åº”ç”¨ï¼Œåˆ—å‡ºæ‰€æœ‰ä½œè€…ã€‚æ‚¨å¯ä»¥å…‹éš†å¹¶è¿è¡Œè¯¥åº”ç”¨ç¨‹åºè¿›è¡Œæ¼”ç¤ºã€‚

```
$ git clone git@github.com:hasura/graphql-engine.git
$ cd graphql-engine/community/sample-apps/nextjs-8-serverless
$ npm install 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®‰è£…ä¹‹åï¼Œæ‚¨å¿…é¡»é…ç½®ä¸Šé¢å¾—åˆ°çš„ GraphQL ç«¯ç‚¹ã€‚

æ‰“å¼€ **lib/init-apollo.js** å¹¶åœ¨ **uri**
ä¸­é…ç½® Hasura GraphQL ç«¯ç‚¹ç°åœ¨ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œåº”ç”¨:

```
$ npm run dev 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶è®¿é—® [http://localhost:3000](http://localhost:3000) æŸ¥çœ‹ appã€‚

**å¯ç”¨æ— æœåŠ¡å™¨æ¨¡å¼**
ä¸ºäº†å¯ç”¨æ— æœåŠ¡å™¨æ¨¡å¼ï¼Œæˆ‘ä»¬åœ¨ next.config.js ä¸­æ·»åŠ äº†æ— æœåŠ¡å™¨æ„å»ºç›®æ ‡

```
module.exports = {
  target: "serverless",
}; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å°±æ˜¯è¿™æ ·ï¼ç°åœ¨é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ„å»ºæ— æœåŠ¡å™¨åº”ç”¨ç¨‹åº:

```
$ npm run build 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç”± Next.js ç”Ÿæˆçš„æ„å»ºå…·æœ‰**éå¸¸ä½çš„å†…å­˜å ç”¨**ï¼Œæ— æœåŠ¡å™¨å‡½æ•°çš„åŸºæœ¬å‹ç¼©å¤§å°ä¸º **50KB** ã€‚è¾“å‡ºçš„å‡½æ•°ä¸éœ€è¦ä»»ä½•å…¶ä»–ä¾èµ–é¡¹ï¼Œå› ä¸ºæ‰€æœ‰éœ€è¦çš„ä¸œè¥¿éƒ½å·²ç»æ†ç»‘åœ¨ä¸€èµ·äº†ã€‚å½“ç„¶ï¼Œæ ¹æ®é¡µé¢çš„å†…éƒ¨ä¾èµ–å…³ç³»ï¼Œæœ€ç»ˆå¤§å°ä¼šè¶…è¿‡ 50KBã€‚

åœ¨**ä¸­ã€‚åœ¨ä¸‹ä¸€ä¸ª**æ–‡ä»¶å¤¹ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªåœ¨æ„å»ºä¹‹åç”Ÿæˆçš„**æ— æœåŠ¡å™¨**æ–‡ä»¶å¤¹ã€‚é‡Œé¢æœ‰ä¸€ä¸ª **pages** æ–‡ä»¶å¤¹ï¼Œæ¯é¡µè¾“å‡º lambdaã€‚

```
pages/index.js => .next/serverless/pages/index.js
pages/about.js => .next/serverless/pages/about.js 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™äº›é¡µé¢ç°åœ¨å¯ä»¥ç‹¬ç«‹éƒ¨ç½²åˆ°å…¶ä»–äº‘æä¾›å•†ã€‚

## [](#deploy-to-now-platform)éƒ¨ç½²åˆ° Now å¹³å°

Now å¹³å°é€šè¿‡ [now](https://zeit.co/now) ( [ä¸‹è½½](https://zeit.co/download))æä¾›äº†ä¸€ç§æ— ç¼çš„æ–¹å¼å°†å…¶éƒ¨ç½²åˆ°äº‘:è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½²

```
$ npm install -g now
$ now 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨æ„**:now-CLI çš„æ—§ç‰ˆæœ¬ä¸æ”¯æŒæ— æœåŠ¡å™¨æ¨¡å¼ã€‚

ä¸€æ—¦éƒ¨ç½²æˆåŠŸï¼Œæ‚¨å°†èƒ½å¤Ÿå¯¼èˆªåˆ°é¡µé¢ **/** å’Œ**/å…³äº**ï¼Œæ¯ä¸ªé¡µé¢å†…éƒ¨éƒ½æ˜¯ä¸€ä¸ª lambda å‡½æ•°ï¼Œç°åœ¨ç®¡ç†ã€‚
Now å¹³å°è´Ÿè´£è·¨å‡ ä¸ªåœ°åŒºçš„è·¯çº¿å®‰æ’ã€‚lambdas å…¨éƒ¨éƒ¨ç½²åœ¨ AWS ä¸Šã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºå¯ç”¨è·¯çº¿å’ŒåŒºåŸŸ[çš„ä¿¡æ¯ã€‚](https://zeit.co/docs/v2/platform/regions-and-providers/)

æ„å»ºè¿‡ç¨‹çš„è¾“å‡ºå¯ä»¥æ˜¯é™æ€æ–‡ä»¶æˆ–æ— æœåŠ¡å™¨ lambdasã€‚é™æ€æ–‡ä»¶å°†ç›´æ¥ç”± Zeit çš„[è¾¹ç¼˜ç¼“å­˜](https://zeit.co/docs/v2/domains-and-aliases/cdn/)æä¾›ï¼Œè€Œ lambdas åŒ…å«åŠ¨æ€å’ŒæŒ‰éœ€æ‰§è¡Œçš„ä»£ç ã€‚

æ­£å¦‚æ‚¨åœ¨ä¸‹å›¾ä¸­çœ‹åˆ°çš„ï¼Œå…³äºå’Œç´¢å¼•é¡µé¢æ˜¯ lambdasã€‚é™æ€èµ„äº§ç”± Zeit ç¼“å­˜ã€‚

[![Now Deployment](../Images/06c3242e7d2146993c68dacd0f79ac63.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--i93CousR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.hasura.io/content/images/2019/02/nextjs-now-serverless.png)

## [](#migrating-from-older-versions)ä»æ—§ç‰ˆæœ¬è¿ç§»

js 8 ä¿æŒäº†å‘åå…¼å®¹æ€§ï¼Œå› æ­¤å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯è¿è¡Œ:

```
$ npm i next@latest react@latest react-dom@latest 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¹¶åœ¨ next.config.js ä¸­è®¾ç½®é…ç½®ä»¥è·å¾—æ— æœåŠ¡å™¨æ„å»ºç›®æ ‡ï¼Œæ‚¨åº”è¯¥å¯ä»¥å¼€å§‹äº†ã€‚

## [](#final-thoughts)æœ€åçš„æƒ³æ³•

è¿™æ˜¯ä¸€ä¸ªå°† web åº”ç”¨éƒ¨ç½²ä¸ºæ— æœåŠ¡å™¨ lambdas çš„æœ‰è¶£è½¬å˜ã€‚ç”±äºè¯¥åº”ç”¨ç¨‹åºçš„æ¯ä¸ªé¡µé¢éƒ½æ˜¯ä¸€ä¸ª lambdaï¼Œæ‚¨åªéœ€ä¸ºè°ƒç”¨æ¬¡æ•°ä»˜è´¹ï¼Œå¹¶ä¸”å¯ä»¥æœ‰é€‰æ‹©åœ°æ‰©å±•é«˜æµé‡é¡µé¢ã€‚é™æ€èµ„äº§ä¹Ÿå¯ä»¥è¢«ç¼“å­˜ï¼Œä»ç¬¬ä¸€å¤©èµ·å°±æä¾›äº†ä¸€ä¸ªè´Ÿæ‹…å¾—èµ·çš„ã€å¯ä¼¸ç¼©çš„é€‰é¡¹ã€‚
åœ¨ [github](https://github.com/hasura/graphql-engine/tree/master/community/sample-apps/nextjs-8-serverless) ä¸ŠæŸ¥çœ‹ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚