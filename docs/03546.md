# æ—¶é—´è·Ÿè¸ª:OpenBSD ä¸Šçš„ Kimai2 0.9

> åŸæ–‡:[https://dev . to/nab bisen/time-tracking-kimai 2-on-openbsd-2mk 9](https://dev.to/nabbisen/time-tracking-kimai2-on-openbsd-2mk9)

## [](#introducation)ç®€ä»‹

[Kimai](https://www.kimai.org/) æ˜¯å¼€æºçš„æ—¶é—´è¿½è¸ª appã€‚
æœ‰ä¸¤å¤§ç‰ˆæœ¬: [Kimai1](https://github.com/kimai/kimai) ï¼Œæ˜¯ [GPLv3](https://www.gnu.org/licenses/gpl-3.0.en.html) è¡Œè´§ï¼Œ [Kimai2](https://github.com/kevinpapst/kimai2) ï¼Œæ˜¯ [MIT](https://opensource.org/licenses/MIT) è¡Œè´§ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•å®‰è£…æœ€æ–°çš„ Kimai2ã€‚å®ƒåŸºäº [Symfony](https://symfony.com/) ã€ [PHP](https://php.net) å¥å£®æ¡†æ¶ã€‚
æ­¤å¤–ï¼ŒKimai2 éå¸¸é€‚åˆ[ä¿æŒ Symfony çš„æ›´æ–°](https://github.com/kevinpapst/kimai2/pull/710):)

#### [](#environment)ç¯å¢ƒ

*   OS: [OpenBSD](https://www.openbsd.org/) 6.5
*   æ•°æ®åº“: [MariaDB](https://mariadb.org/) 10.0
*   Web æœåŠ¡å™¨: [httpd](https://man.openbsd.org/httpd.8)
*   åº”ç”¨æœåŠ¡å™¨: [PHP](https://php.net/) 7.2
    *   CGI: [PHP-FPM](https://php-fpm.org/)
    *   åŒ…ç®¡ç†å‘˜:[ä½œæ›²è€…](https://getcomposer.org/)
*   æ—¶é—´è¿½è¸ªåº”ç”¨ç¨‹åº:Kimai2 0.9

## [](#tutorial)æ•™ç¨‹

å®˜æ–¹å®‰è£…æ‰‹å†Œè¿™é‡Œæ˜¯[è¿™é‡Œæ˜¯](https://www.kimai.org/documentation/installation.html)ã€‚

#### [](#requirements)è¦æ±‚

é¦–å…ˆï¼Œä½ å¿…é¡»å…·å¤‡:

*   [httpd ä½œä¸ºç½‘ç»œæœåŠ¡å™¨](https://dev.to/nabbisen/setting-up-openbsds-httpd-web-server-4p9f)
*   [php-fpm](https://dev.to/nabbisen/php-fpm-on-openbsd-2iof)
*   PHP [ä½œæ›²](https://dev.to/nabbisen/almost-php-72-composer-with-openbsd-64-100o)
*   [MariaDB ä½œä¸ºæ•°æ®åº“æœåŠ¡å™¨](https://dev.to/nabbisen/installing-mariadb-server-on-openbsd-5lm)

å¦å¤–ï¼Œ[æ¨è HTTPS](https://dev.to/nabbisen/lets-encrypt-certbot-for-openbsds-httpd-3ofd)ã€‚

è¿™ä¸ªéƒ¨åˆ†çš„æ‰€æœ‰é“¾æ¥éƒ½æŒ‡å‘æ•™ç¨‹ã€‚

#### [](#db-server)æ•°æ®åº“æœåŠ¡å™¨

åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·:

```
CREATE DATABASE <database> CHARACTER SET = 'utf8mb4';
GRANT ALL PRIVILEGES ON <database>.* TO <dbuser> IDENTIFIED BY '<dbpass>'; 
```

#### [](#app-server)åº”ç”¨æœåŠ¡å™¨

è·å–åŒ…:

```
$  git clone -b 0.9 --depth 1 https://github.com/kevinpapst/kimai2.git
$  cd kimai2/ 
```

ç„¶åä¿®æ”¹æƒé™:

```
#  chown -R :www .
#  chmod -R g+r .
#  chmod -R g+rw var/ 
```

è¿˜è¦é…ç½®ç³»ç»Ÿ:

```
$  cp -p .env.dist .env
$  nvim .env 
```

è¿™é‡Œæ˜¯`.env` :
ä¸­è‡³å°‘è¦æ”¹å˜çš„åœ°æ–¹

```
- APP_SECRET=change_this_to_something_unique + APP_SECRET=<some_salt_key_long_enough> ...
- DATABASE_URL=sqlite:///%kernel.project_dir%/var/data/kimai.sqlite
+ DATABASE_URL=mysql://<dbuser>:<dbpass>@<dbhost>:<dbport>/<database> 
```

è®©æˆ‘ä»¬é€šè¿‡ Composer å®‰è£…ã€‚
ä½¿ç”¨`php-7.2 /usr/local/libexec/composer.phar`æ˜¯ OpenBSD å®‰è£…çš„è¯€çªã€‚

```
$  php-7.2 /usr/local/libexec/composer.phar install --no-dev --optimize-autoloader 
```

ç»“æœæ˜¯:

```
Loading composer repositories with package information
Installing dependencies from lock file
Package operations: 138 installs, 0 updates, 0 removals
  - Installing ocramius/package-versions (1.4.0): Downloading (100%)         
  - Installing kimai/kimai2-composer (0.1): Downloading (100%)         
  - Installing symfony/flex (v1.2.3): Downloading (100%)         

Prefetching 101 packages ğŸ¶ ğŸ’¨
  - Downloading (100%)

  - Installing beberlei/doctrineextensions (v1.2.0): Loading from cache ...
 - Installing white-october/pagerfanta-bundle (v1.2.4): Loading from cache
Generating optimized autoload files
ocramius/package-versions:  Generating version class...
ocramius/package-versions: ...done generating version class
Executing script cache:clear [OK]
Executing script assets:install [OK] 
```

ç„¶ååœ¨ä¸‹é¢åˆ›å»ºçš„æ•°æ®åº“ä¸­åˆ›å»ºæ¨¡å¼:

```
$  php-7.2 bin/console doctrine:schema:create 
```

ç»“æœæ˜¯:

```
 !                                                                                                                      
 ! [CAUTION] This operation should not be executed in a production environment!                                         
 !                                                                                                                      

 Creating database schema...

 [OK] Database schema created successfully! 
```

åœ¨è¿™é‡Œä½ ä¼šçœ‹åˆ°ä¸Šé¢çš„è­¦å‘Šã€‚
[å…¬æ–‡ä¸Šè¯´](https://www.kimai.org/documentation/installation.html#recommended-setup):

> æ‚¨å¯ä»¥æ”¾å¿ƒåœ°å¿½ç•¥è¯¥æ¶ˆæ¯:è¯¥æ“ä½œä¸åº”åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œï¼

å¥½äº†ï¼Œæˆ‘ä»¬ç»§ç»­å§:

```
$  php-7.2 bin/console cache:warmup --env=prod 
```

ç»“æœæ˜¯:

```
 // Warming up the cache for the prod environment with debug false                                                      

 [OK] Cache for the "prod" environment (debug=false) was successfully warmed. 
```

ç³»ç»Ÿç°åœ¨å‡ ä¹å‡†å¤‡å¥½äº†ã€‚
åˆ›å»ºä¸€ä¸ªç”¨æˆ·ä½œä¸ºç³»ç»Ÿç®¡ç†å‘˜:

```
$  php-7.2 bin/console kimai:create-user <username> <email-address> ROLE_SUPER_ADMIN 
```

ç»“æœæ˜¯:

```
Please enter the password: 

 [OK] Success! Created user: <username> 
```

æœ€åä¸€æ­¥æ˜¯å‡†å¤‡ web æœåŠ¡å™¨ã€‚
å°†ä¸‹é¢çš„å®šä¹‰æ·»åŠ åˆ° [`/etc/httpd.conf`](https://man.openbsd.org/httpd.conf.5) :

```
server "<fqdn>" {
        listen on $ext_addr port 80
        block return 301 "https://$SERVER_NAME$REQUEST_URI"
}
server "<fqdn>" {
        listen on $ext_addr tls port 443
        tls {
                certificate     "/etc/letsencrypt/live/<fqdn>/fullchain.pem"
                key             "/etc/letsencrypt/live/<fqdn>/privkey.pem"
        }
        # create unique log files (optional):
        log {
                access  "<fqdn>-access.log"
                error   "<fqdn>-error.log"
        }

        # the document root is the directory named `public`:
        root "/<...>/kimai2/public"
        directory index index.php

        location "/*.php" { 
                fastcgi socket "/run/php-fpm.sock"
        } 
        location "/*.php[/?]*" {
                fastcgi socket "/run/php-fpm.sock"
        }
        # if directories are accessed to, call `index.php` with url parameter:
        location match "^/(.*)/[^\.]+/?$" {
                fastcgi socket "/run/php-fpm.sock"
                request rewrite "/index.php/%1"
        }
} 
```

é‡å¯:

```
#  rcctl restart httpd 
```

## [](#conclusion)ç»“è®º

ç°åœ¨æ‰€æœ‰çš„æœåŠ¡å™¨ï¼Œæ•°æ®åº“/åº”ç”¨ç¨‹åº/webï¼Œéƒ½å‡†å¤‡å¥½äº†å¹¶åœ¨ç›‘å¬ã€‚
è®©æˆ‘ä»¬é€šè¿‡ä»»ä½•ç½‘ç»œæµè§ˆå™¨è®¿é—®< fqdn >:

[![login form](../Images/c4c947a006d80837378b27a659362634.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--BZmnM30C--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/orsmvc14j52izbc40ag3.png)

[![succeeded](../Images/f4208551ff7ae995afc020dafc8894f3.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ULcfUXKm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/0lg0pq8klf2o3by4u65t.png)

ç§ğŸ˜†æˆ‘å–œæ¬¢è¿™ä¸ªç®€å•çš„ç”¨æˆ·ç•Œé¢ğŸ¥³

æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚
å¿«ä¹è®¡ç®—ã€‚