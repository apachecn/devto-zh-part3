# å…·æœ‰ LocalStack çš„æœ¬åœ° AWS ç¯å¢ƒ

> åŸæ–‡:[https://dev . to/victor Costa/local-AWS-environment-with-local stack-32bm](https://dev.to/victorcosta/local-aws-environment-with-localstack-32bm)

# [](#useful-links)æœ‰ç”¨çš„é“¾æ¥

*   [æœ¬åœ°å †æ ˆ git åº“](https://github.com/localstack/localstack)
*   [Aws å¯ç”¨æœåŠ¡](https://docs.aws.amazon.com/cli/latest/reference/#available-services)
*   [Aws æ–‡æ¡£](https://docs.aws.amazon.com/cli/latest/userguide/aws-cli.pdf)

# [æœ¬åœ°å †æ ˆ](#localstack)

ä»–ä»¬çš„ git å›è´­åè®®ä¸­ä½¿ç”¨çš„å®šä¹‰éå¸¸æ¸…æ¥šï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åœ¨è¿™é‡Œä½¿ç”¨å®ƒ:

> LocalStack ä¸ºå¼€å‘äº‘åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„æµ‹è¯•/æ¨¡æ‹Ÿæ¡†æ¶

# [](#setup)è®¾ç½®

æœ¬æ•™ç¨‹ä½¿ç”¨ docker-image æ¥è®¾ç½® Localstackï¼Œå› æ­¤æ‚¨åº”è¯¥å·²ç»å®‰è£…äº† docker å’Œ Docker-compose æ‰èƒ½ç»§ç»­å­¦ä¹ ã€‚

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„`docker-compose.localstack.yml`(å¯ä»¥åœ¨[è¿™é‡Œæ‰¾åˆ°](https://github.com/localstack/localstack#running-in-docker) ):

```
version: '2.1'
services:
...
  localstack:
    image: localstack/localstack
    ports:
      - "4567-4584:4567-4584"
      - "${PORT_WEB_UI-8080}:${PORT_WEB_UI-8080}"
    environment:
      - SERVICES=${SERVICES- }
      - DEBUG=${DEBUG- }
      - DATA_DIR=${DATA_DIR- }
      - PORT_WEB_UI=${PORT_WEB_UI- }
      - LAMBDA_EXECUTOR=${LAMBDA_EXECUTOR- }
      - KINESIS_ERROR_PROBABILITY=${KINESIS_ERROR_PROBABILITY- }
      - DOCKER_HOST=unix:///var/run/docker.sock
    volumes:
      - "${TMPDIR:-/tmp/localstack}:/tmp/localstack" 
```

ç”¨`s3`å’Œ`dynamodb`æ—‹è½¬æœ¬åœ°å †æ ˆ docker å®¹å™¨

å¯¹äº MacOS ç”¨æˆ·(ä»¥é˜²æ‚¨çš„$TMPDIR åŒ…å« Docker æ— æ³•æŒ‚è½½çš„ç¬¦å·é“¾æ¥):

```
TMPDIR=/private$TMPDIR PORT_WEB_UI=9000 SERVICES=s3,dynamodb docker-compose -f docker-compose.localstack.yml up 
```

å…¶ä»–ç”¨æˆ·:

```
PORT_WEB_UI=9000 SERVICES=s3,dynamodb docker-compose -f docker-compose.localstack.yml up 
```

â„¹ï¸å¿«é€Ÿå¼•ç”¨:
**-f** -æŒ‡å®šå¤‡ç”¨åˆæˆæ–‡ä»¶(é»˜è®¤:docker-compose . yml)
**-d**-ä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œ(åå°)

> âš ï¸è¦ä½¿ç”¨çš„æœåŠ¡åç§°å¿…é¡»éµå¾ªå®˜æ–¹ aws æœåŠ¡å‘½åæƒ¯ä¾‹ï¼Œè¯¥æƒ¯ä¾‹å¯åœ¨ [aws å¯ç”¨æœåŠ¡](https://docs.aws.amazon.com/cli/latest/reference/#available-services)ä¸­æ‰¾åˆ°

æœ‰ç”¨çš„`docker`å‘½ä»¤:

*   `docker ps`:åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨
*   `docker logs <container-name>`:è¾“å‡ºæ—¥å¿—å®¹å™¨

* * *

## [](#api-calls-to-localstack)Api è°ƒç”¨ LocalStack

è®¿é—® http://localhost:9000 ä»¥ç¡®ä¿æ‚¨çš„æœ¬åœ° AWS æ­£åœ¨å·¥ä½œã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªç©ºçš„ä»ªè¡¨æ¿ã€‚

è®©æˆ‘ä»¬å¯¹æœ¬åœ° aws è¿›è¡Œä¸€äº› api è°ƒç”¨ï¼Œæ£€æŸ¥æˆ‘ä»¬æ˜¯å¦å¯ä»¥å¼€å§‹ä¸å®ƒäº¤äº’ã€‚

> ğŸ”è¿™é‡Œæœ‰ä¸€ä»½å…³äº aws-cli çš„å®Œæ•´ç”¨æˆ·æŒ‡å—(è½¬åˆ° S3 éƒ¨åˆ†)

```
# Create a bucket
aws-vault exec scd-stg -- aws s3 mb s3://my-custom-bucket --endpoint-url http://localhost:4572 
```

é¢„æœŸè¾“å‡ºæˆ–ç±»ä¼¼:`make_bucket: my-custom-bucket`

```
# List buckets
aws-vault exec scd-stg -- aws s3 ls --endpoint-url http://localhost:4572 
```

é¢„æœŸè¾“å‡ºæˆ–ç±»ä¼¼è¾“å‡º:`2006-02-03 14:45:09 my-custom-bucket`

* * *

å¦‚æœä½ åœ¨ä¸‹é¢çš„è¯„è®ºä¸­æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·è®©æˆ‘çŸ¥é“ï¼Œæˆ–è€…å¦‚æœä¸€åˆ‡éƒ½å¦‚ä½ æ‰€æ„¿ï¼Œè¯·ç•™ä¸‹ä½ çš„åé¦ˆã€‚