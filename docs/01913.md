# ç”¨é’©å­ååº”ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ

> åŸæ–‡:[https://dev . to/elanandkumar/react-component-life cycle-with-hook-6lo](https://dev.to/elanandkumar/react-component-lifecycle-with-hook-6lo)

åœ¨å‰ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è§£é‡Šäº†å¦‚ä½•å°†ç±»ç»„ä»¶è½¬æ¢æˆåŠŸèƒ½ç»„ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨é’©å­ã€‚
ä»¥ä¸‹æ˜¯æ–‡ç« é“¾æ¥:

[![elanandkumar image](../Images/7e9dada9c16e0237b2b8a7563fef0e44.png)](/elanandkumar) [## React é’©å­:å°†ç±»ç»„ä»¶è¿ç§»åˆ°å‡½æ•°ä¸­å¹¶ä½¿ç”¨é’©å­

### Anand Kumar 5 æœˆ 12 æ—¥ 1915 åˆ†é’Ÿé˜…è¯»

#react #reacthooks #javascript](/elanandkumar/react-hooks-migrate-class-component-to-hooks-3879)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å¸®åŠ©ä½ ç†è§£å¦‚ä½•è·å¾—ä¸ä½¿ç”¨ react é’©å­çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç›¸åŒçš„è¾“å‡ºã€‚

æˆ‘å°†ä»‹ç»ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸæ–¹æ³•:

*   `componentWillMount`
*   `componentDidMount`
*   `componentDidUpdate`
*   `shouldComponentUpdate`
*   `componentWillUnmount`

åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ä¸‹é¢çš„é’©å­:

*   `useState`
*   `useEffect` ### useState `useState`è¿”å›ä¸€ä¸ªæœ‰çŠ¶æ€å€¼å’Œä¸€ä¸ªæ›´æ–°å®ƒçš„å‡½æ•°ã€‚####è¯­æ³•:![useState syntax](../Images/d611d9f428b533fc23c6a1092bb493e5.png) ### useEffect å¯¹äºåŠŸèƒ½ç»„ä»¶ï¼Œæˆ‘ä»¬ä¸å…è®¸**åœ¨ç»„ä»¶ä¸»ä½“å†…éƒ¨äº§ç”Ÿå‰¯ä½œç”¨ï¼Œæ¯”å¦‚çªå˜ã€è®¡æ—¶å™¨ã€çªå˜æˆ–ä»»ä½•å…¶ä»–å‰¯ä½œç”¨ã€‚**

 **æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬æœ‰`useEffect`ï¼Œå®ƒåœ¨æ¸²æŸ“å‘ç”Ÿåè¿è¡Œ**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ•ˆæœä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œï¼Œä½†æ˜¯æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥æ§åˆ¶å®ƒï¼Œæˆ‘ä»¬å°†åœ¨æ–‡ç« çš„åé¢è®¨è®ºã€‚**

#### [](#syntax)è¯­æ³•:

[![useEffect syntax](../Images/162745dbfc697827e2cfd446a68490eb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--kO8YMRFt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.elanandkumar.com/static/a0e61e77cdc8d734938c1f31ba58d450/9ab67/useEffect-syntax.jpg)

æœ‰å…³é’©å­æˆ– react æä¾›çš„ä»»ä½•å…¶ä»–é’©å­çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚

æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬ä»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå¼€å§‹ï¼Œè¯•ç€ç†è§£é’©å­å¯¹ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ›¿ä»£ã€‚

> **Pro æç¤º:**ä¸è¦åœ¨ä»»ä½•ä»£ç å—ä¸­ä½¿ç”¨é’©å­ã€‚å®ƒå¿…é¡»ä½äºåŠŸèƒ½ç»„ä»¶çš„é¡¶çº§å±‚æ¬¡ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªå°åº”ç”¨ç¨‹åºçš„è¿è¡Œç¤ºä¾‹ã€‚è¿™ç§ç”¨æ³•ååº”äº†åŸºäºç±»çš„ç»„ä»¶å’Œç”Ÿå‘½å‘¨æœŸã€‚åœ¨æ–‡ç« çš„æœ€åï¼Œæ‚¨å¯ä»¥æ£€æŸ¥ä½¿ç”¨åŠŸèƒ½ç»„ä»¶åˆ›å»ºçš„ç›¸åŒåº”ç”¨ç¨‹åºï¼Œå¹¶å…·æœ‰ç›¸ä¼¼çš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œã€‚
[https://codepen.io/anand-kr/embed/yWzqZd?height=600&default-tab=js,result&embed-version=2](https://codepen.io/anand-kr/embed/yWzqZd?height=600&default-tab=js,result&embed-version=2)
æˆ‘ä»¬å¼€å§‹å§ã€‚

### [](#componentwillmount)componentWillMount

å½“æˆ‘ä»¬å°†ä»»ä½•ç±»ç»„ä»¶è½¬æ¢ä¸ºåŠŸèƒ½ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨`useState`å®šä¹‰æˆ‘ä»¬çš„çŠ¶æ€(å¦‚æœæœ‰çš„è¯)ä¹‹åæˆ–è€…åœ¨ä»£ç åˆ°è¾¾ render (jsx)éƒ¨åˆ†ä»¥å®ç°`componentWillMount`è¡Œä¸ºä¹‹å‰ç¼–å†™ä»£ç ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œä»£ç æ‰§è¡Œæ˜¯è‡ªä¸Šè€Œä¸‹è¿›è¡Œçš„ã€‚

### [](#componentdidmount)ç»„ä»¶è£…è½½

æ­£å¦‚ä¹‹å‰å…³äº`useEffect`çš„è§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ç¬¬äºŒä¸ª optionalParameter æ¥å®ç°`componentDidMount`è¡Œä¸ºã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ä»£ç ç‰‡æ®µã€‚

```
React.useEffect(()=>{
  console.log('Robot: componentDidMount');
  // ...code goes here...
  fetchData();
}, []); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†ç©ºç™½æ•°ç»„`[]`ä½œä¸ºç¬¬äº”è¡Œçš„ç¬¬äºŒä¸ªå‚æ•°ã€‚ä¸ºä»€ä¹ˆï¼ŸğŸ¤”

å› ä¸ºå½“æä¾›ç¬¬äºŒä¸ªå‚æ•°æ—¶ï¼Œåªæœ‰å½“å®ƒæ£€æµ‹åˆ°æ‰€æä¾›çš„ä»»ä½•æ¡ç›®ä¸­çš„å˜åŒ–æ—¶ï¼Œå®ƒæ‰å¸®åŠ©è°ƒç”¨æ•ˆæœã€‚è¿™ä¸ªæ•°ç»„ä¾èµ–äºæˆ‘ä»¬åœ¨`useEffect`ä¸­ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’çš„å‡½æ•°ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ç©ºç™½çš„ï¼Œè¿™æ„å‘³ç€å®ƒæ°¸è¿œä¸ä¼šæ£€æµ‹åˆ°ä»»ä½•å˜åŒ–ï¼Œå› æ­¤å®ƒå°†åªè°ƒç”¨ä¸€æ¬¡ã€‚è¿™ä¸å°±æ˜¯`componentDidMount`åšçš„å—ï¼Ÿåªè°ƒç”¨ä¸€æ¬¡ï¼Œå¯¹å—ï¼Ÿ

> è¯·æ³¨æ„ï¼Œå¦‚æœç¬¬äºŒä¸ªå‚æ•°æ²¡æœ‰åœ¨`useEffect`ä¸­ä¼ é€’ï¼Œå®ƒå°†æ€»æ˜¯åœ¨æ¸²æŸ“åæ‰§è¡Œã€‚

### [](#componentdidupdate)componentDidUpdate

æ¯”æ–¹è¯´ï¼Œå¦‚æœç»„ä»¶çš„ä»»ä½•å±æ€§å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡è°ƒç”¨ api è°ƒç”¨ï¼Œä¸€æ—¦ç»„ä»¶æ›´æ–°ï¼Œæˆ‘ä»¬å°±åœ¨è¿™é‡Œè¿™æ ·åšã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`useEffect`æ¥å®ç°ã€‚ä¸è¿‡ï¼Œè¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦å‘ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ä¸€ä¸ªæ¡ç›®ã€‚

```
React.useEffect(() => {
  console.log('Robot: componentWillUpdate');
  // code goes here
  fetchData();
}, [props.selectedRobotId]); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬åœ¨æ•°ç»„ä¸­ä¼ é€’äº†ä¸€ä¸ªé“å…·`selectedRobotId`ã€‚å› æ­¤ï¼Œæ¯å½“è¿™ä¸ªé“å…·è¦æ”¹å˜æ—¶ï¼Œæ•ˆæœå°±ä¼šè¿è¡Œï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°æ›´æ–°çš„ç»„ä»¶ã€‚

### shouldcomponentdupdate

è¿™ä¸ªæœ‰ç‚¹å¤æ‚ï¼Œä½†æ˜¯è®©æˆ‘æ¥å¸®ä½ ç†è§£ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œè¿™ç§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¸®åŠ©æˆ‘ä»¬è‡ªå·±æ§åˆ¶ç»„ä»¶çš„æ¸²æŸ“ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­:

```
shouldComponentUpdate(nextProps, nextState) {
  console.log("Robot: shouldComponentUpdate");
  return (
    nextProps.selectedRobotId !== this.props.selectedRobotId ||
    nextState.loadedRobot.id !== this.state.loadedRobot.id ||
    nextState.isLoading !== this.state.isLoading
  );
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½†æ˜¯ï¼Œå¯¹äºåŠŸèƒ½ç»„ä»¶ï¼Œæˆ‘ä»¬ä¸èƒ½ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ååº”ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•è¾¾åˆ°åŒæ ·çš„ç»“æœå‘¢ï¼Ÿ

å—¯ï¼Œå¯¹äº reactï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå«åš`React.memo`çš„ä¸œè¥¿ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åŒ…è£…ç»„ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
export default React.memo(Robot); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™çœ‹èµ·æ¥åƒæ˜¯`shouldComponentUpdate`çš„æ›¿ä»£å“å—ï¼Ÿä¸.....

å¥½å§ï¼Œäº‹æƒ…æ˜¯è¿™æ ·çš„ã€‚`React.memo`æ¥å—ç¬¬äºŒä¸ªå‚æ•°(ä¸€ä¸ªå‡½æ•°),å®ƒæä¾›äº†å¯¹`nextProps`å’Œ`prevProps`çš„è®¿é—®ã€‚è¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°å’Œ`shouldComponentUpdate`ä¸€æ ·çš„ä¸œè¥¿ã€‚

```
export default React.memo(Robot, (prevProps, nextProps) => {
  console.log('Robot: shouldComponentUpdate');
  return nextProps.selectedRobotId === prevProps.selectedRobotId;
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

> è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ã€‚è¿™ä¸`shouldComponentUpdate`ç›¸åã€‚å¦‚æœä¸æƒ³é‡æ–°æ¸²æŸ“ï¼Œåˆ™è¿”å› **true** ã€‚å¦‚æœä½ æƒ³è®©å®ƒæ¸²æŸ“ï¼Œä½ å¯ä»¥è¿”å› **false** ã€‚

React å¾ˆå¥½åœ°å¤„ç†äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªå‡½æ•°åªåœ¨ä½ ä¸æƒ³é‡æ–°æ¸²æŸ“ä»»ä½•é“å…·å˜åŒ–æ—¶æ‰éœ€è¦ã€‚å¦åˆ™ï¼Œè®© React ä¸ºæ‚¨å¤„ç†å®ƒã€‚:)

### [](#componentwillunmount)componentWillUnmount

è¯·è®°ä½ï¼Œåœ¨å¯¹`useEffect`çš„è§£é‡Šä¸­ï¼Œæˆ‘æåˆ°è¿‡åœ¨`useEffect`å†…éƒ¨æœ‰ä¸€ä¸ªå¯é€‰çš„è¿”å›å‡½æ•°ã€‚è¿™ä¸ªè¿”å›å‡½æ•°ç”¨äºæ¸…ç†çš„ç›®çš„ã€‚

```
React.useEffect(() => {
  console.log('Robot: componentDidUpdate');
  //...code goes here
  fetchData();
  return () => {
    console.log('cleaning up...');
  }
}, [props.selectedRobotId]) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢çš„ä»£ç ç‰‡æ®µç±»ä¼¼äº`componentDidUpdate`ä»£ç å—ï¼Œé™¤äº†å®ƒç°åœ¨æœ‰ä¸€ä¸ªè¿”å›å‡½æ•°ã€‚å› æ­¤ï¼Œæ¯å½“`props.selectedRobotId`æ”¹å˜æ—¶ï¼Œè¿™ä¸ªæ•ˆæœè¿è¡Œï¼Œè¿”å›å‡½æ•°åœ¨æ•ˆæœå®Œæˆæ—¶è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‚£é‡Œè¿›è¡Œæ¸…ç†ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ˜¯å‘ç”Ÿåœ¨ T2 èº«ä¸Šçš„äº‹æƒ…ã€‚å¯¹å—ï¼Ÿ
å¥½äº†ï¼Œä¸ºäº†å®ç°`componentWillUnmount`ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­å†æ·»åŠ ä¸€ä¸ª`useEffect`ï¼Œå¹¶å°†ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºç©ºç™½æ•°ç»„ä¼ é€’(`[]`)ã€‚ä¸`componentDidMount`ç±»ä¼¼ï¼Œä½†`useEffect`è¿™æ¬¡å†…éƒ¨å°†æœ‰ä¸€ä¸ªè¿”å›åŠŸèƒ½ï¼Œå®ƒå°†ä½œä¸º`componentWillUnmount`å·¥ä½œã€‚

```
React.useEffect(() => {
  //...code goes here
  fetchData();
  return () => {
    console.log('cleaning up...');
  }
}, [props.selectedRobotId]);

React.useEffect(() => {
  //...code goes here
  fetchData();
  return () => {
    console.log('Robot: componentWillUnmount');
  }
}, []); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ç»™äº†æˆ‘ä»¬åœ¨ä¸¤ä¸ªå±‚é¢ä¸Šè¿›è¡Œæ¸…ç†çš„æ–¹æ³•ã€‚ä¸€æ¬¡æ˜¯åœ¨ç»„ä»¶æ›´æ–°æ—¶ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨ç»„ä»¶å‡†å¤‡å¸è½½æ—¶ã€‚

## [](#summary)æ€»ç»“

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†`useState`å’Œ`useEffect`ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨`useEffect`å’Œ`memo`æ¥å®ç°åŸºäºç±»çš„ç»„ä»¶çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚

èµ·åˆï¼Œè¿™å¯èƒ½çœ‹èµ·æ¥ä»¤äººå›°æƒ‘ï¼Œä½†ä¸è¦æ‹…å¿ƒã€‚è¿™æ˜¯åŒä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ codepen(å¦‚ä¸Šæ‰€ç¤º),ä½†æ˜¯ä½¿ç”¨äº† React é’©å­ã€‚

[https://codepen.io/anand-kr/embed/KLXGJQ?height=600&default-tab=js,result&embed-version=2](https://codepen.io/anand-kr/embed/KLXGJQ?height=600&default-tab=js,result&embed-version=2)

è¯·æ£€æŸ¥ä»£ç å’Œå®è·µã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜/é¡¾è™‘ï¼Œè¯·éšæ—¶åˆ†äº«æˆ–è”ç³»æˆ‘ã€‚

å¿«ä¹å­¦ä¹ ï¼**