# ç”¨ Python æ„å»ºæµé‡ç²¾ç»†åˆ®åˆ€

> åŸæ–‡:[https://dev . to/rodolfoferro/building-a-traffic-fine-scraper-with-python-2j 76](https://dev.to/rodolfoferro/building-a-traffic-fine-scraper-with-python-2j76)

<small>*è¦ä»¥æ›´å¥½çš„æ ¼å¼çœ‹è¿™ç¯‡æ–‡ç« ï¼Œè¯·æŸ¥çœ‹[æˆ‘çš„åšå®¢](https://rodolfoferro.xyz/traffic-fine-scraper/)ã€‚*</small>

## åŠ¨æœº

å‰å‡ å¤©ï¼Œæˆ‘æƒ³èµ·äº† 2017 å¹´ 6 æœˆæˆ‘å»å¢¨è¥¿å“¥åŸçš„æ—¶å€™(ä¸ºäº†å‚åŠ ç¬¬ä¸€å±Š[å¢¨è¥¿å“¥ä¹‹å¤œ](https://rodolfoferro.xyz/pythondaymx/)çš„æ´»åŠ¨)ï¼Œæˆ‘åœ¨é‚£é‡Œçš„æ—¶å€™ï¼Œæˆ‘çš„ä¸€ä¸ª[æœ‹å‹](https://twitter.com/JMireles_)åœ¨ä»–å®¶æ‹›å¾…äº†æˆ‘ã€‚äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œåœ¨æˆ‘é€—ç•™æœŸé—´ï¼Œæˆ‘ä»¬è®¨è®ºäº†å»ºç«‹ä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šå»ºç«‹ä¸€ä¸ªç½‘ç«™ï¼Œè®©å¢¨è¥¿å“¥åŸçš„è½¦ä¸»èƒ½å¤Ÿæ ¸å®ä»–ä»¬çš„äº¤é€šç½šæ¬¾ã€‚

ç½‘å€å¦‚ä¸‹:[http://www . multasdetransito . com . MX/infracciones/df-distrito-federal](http://www.multasdetransito.com.mx/infracciones/df-distrito-federal)

æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œå¦‚æœæ‚¨æ‰“å¼€äº†è¯¥ç«™ç‚¹ï¼Œå®ƒåŒ…å«ä¸€ä¸ªè¾“å…¥æ¥è®°ä¸‹æ±½è½¦ç‰Œç…§ï¼Œä»ä¸­æ‚¨å¯ä»¥æœç´¢ä¸è¯¥ç‰Œç…§ç›¸å…³çš„äº¤é€š(å¦‚æœæœ‰çš„è¯)ã€‚

æˆ‘çš„æœ‹å‹å‘Šè¯‰æˆ‘ï¼Œåªæœ‰ä¸€å°éƒ¨åˆ†å¢¨è¥¿å“¥åŸå±…æ°‘çŸ¥é“è¿™ä¸ªç½‘ç«™ï¼Œæ‰€ä»¥åˆ›å»ºä¸€äº›ä»–ä»¬å¯ä»¥æ›´å®¹æ˜“åœ°æŸ¥é˜…è¿™äº›ä¿¡æ¯çš„ä¸œè¥¿å¯èƒ½æ˜¯æœ‰ç”¨çš„ã€‚

åœ¨è¿™ä¹‹åï¼Œæˆ‘æƒ³:*â€œä¼™è®¡ï¼Œä»Šå¤©æˆ‘ä¸¾åŠäº†ä¸€ä¸ªå…³äºå¦‚ä½•åœ¨ 30 åˆ†é’Ÿå†…ä¸º PythonDay å»ºç«‹ä¸€ä¸ª TwitterBot çš„ç ”è®¨ä¼šï¼Œå¦‚æœæˆ‘ä»¬å»ºç«‹ä¸€ä¸ª TwitterBotï¼Œåœ¨ç«™ç‚¹ä¸­è¾“å…¥æ¨¡æ¿ï¼Œç„¶åè‡ªåŠ¨ä»ä¸­æŠ“å–ä¿¡æ¯ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿâ€*ã€‚ä»–ç­”åº”äº†ã€‚æœ‰äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å»ºç«‹äº† [MultaBot](https://twitter.com/MultaBot/with_replies) ä¸€ä¸ªæ¨ç‰¹æœºå™¨äººï¼Œç”¨æ¥è¯»å–æ±½è½¦ç‰Œç…§å’Œåˆ®äº¤é€šç½šæ¬¾ã€‚

æˆ‘ä»¬å¼€å§‹è¿™ä¸ªé¡¹ç›®æ˜¯ä½œä¸ºä¸€ä¸ªç§äººé¡¹ç›®ï¼Œä½†æ˜¯å‰å‡ å¤©æˆ‘è¢«æˆ‘å¤§å­¦çš„æ³•å¾‹ã€æ”¿æ²»å’Œæ”¿åºœéƒ¨é—¨çš„é‚€è¯·å»åšä¸€ä¸ªå…³äºè‡ªåŠ¨åŒ–å¦‚ä½•å¯¹æœªæ¥çš„å·¥ä½œæœ‰ç”¨çš„æŠ€æœ¯æ¼”è®²ï¼Œä¸ä»…å¯¹æŠ€æœ¯è¡Œä¸šçš„äººæœ‰ç”¨ï¼Œå¯¹æ”¿æ²»å®¶å’Œå¾‹å¸ˆä¹Ÿæœ‰ç”¨ã€‚å½“æˆ‘æƒ³èµ·è¿™ä»¶äº‹æ—¶ï¼Œæˆ‘è®¤ä¸ºè¿™å°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œæ‰€ä»¥æˆ‘æƒ³åœ¨å®ƒçš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›ï¼Œå¹¶ä»¥è¿™ä¸ªä¾‹å­è„šæœ¬ç»“æŸï¼Œç°åœ¨æˆ‘æƒ³ä¸ä½ åˆ†äº«ã€‚

## å®éªŒ

æˆ‘å°†è§£é‡Šæ•´ä¸ªä»£ç ï¼Œæ‰€ä»¥ä½ ä¼šæ˜ç™½æ¯ä¸€æ­¥éƒ½å‘ç”Ÿäº†ä»€ä¹ˆã€‚é¦–å…ˆï¼Œæˆ‘å°†å¯¼å…¥ [Selenium](https://selenium-python.readthedocs.io/) å’Œ Python [æ•°æ®æ¼‚äº®æ‰“å°æœº](https://docs.python.org/3/library/pprint.html) :

```
 1 from selenium import webdriver
 2 from pprint import pprint 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Selenium å°†å…è®¸æˆ‘ä»¬è‡ªåŠ¨æ§åˆ¶ç½‘ç»œæµè§ˆå™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ä½¿ç”¨å®ƒè‡ªåŠ¨æ‰“å¼€ç½‘ç«™ï¼Œè¾“å…¥æ±½è½¦ç‰Œç…§ï¼Œåœ¨åŠ è½½äº¤é€šç½šæ¬¾åï¼Œæå–å¹¶è§£æå®ƒä»¬ä»¥ç”¨äº`pprint`è¾“å‡ºã€‚

åœ¨è¿™ä¹‹åï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°æ¥å¯åŠ¨æµè§ˆå™¨ï¼Œå¹¶ä»è½¦ç‰Œä¸ŠæŠ“å–ä¿¡æ¯ã€‚å¦‚æœ`verbose`è®¾ç½®ä¸º`True`ï¼Œè¯¥åŠŸèƒ½å°†æ‰“å°æ¯ç¬”äº¤é€šç½šæ¬¾çš„æ˜ç»†:

```
 5 # Browser opener function:
 6 def launch_browser(placa, verbose=False):
 7     # Browser launch with chromedriver:
 8     browser = webdriver.Chrome()
 9
10     # Set url and open it on Chrome: 11     url = 'http://www.multasdetransito.com.mx/infracciones/df-distrito-federal'
12     browser.get(url)
13
14     # Search plate: 15     multas = busca_placa_df(browser, placa, verbose)
16
17     # Close browser: 18     browser.quit()
19     return multas 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘è®¾ç½®äº†è¦æŠ“å–çš„ urlï¼Œç„¶åæˆ‘è°ƒç”¨äº†åä¸º`busca_placa_df`çš„å‡½æ•°(è¿™æ„å‘³ç€ *search_plate_df* ï¼Œ *df* åœ¨è¥¿ç­ç‰™è¯­ä¸­ä»£è¡¨è”é‚¦åŒº)ï¼Œç„¶åæˆ‘å…³é—­å¹¶é€€å‡ºäº†ä¸ºè¿™ä¸ªæœç´¢æ‰“å¼€çš„æµè§ˆå™¨ã€‚

ç„¶åï¼Œæˆ‘æ„å»ºäº†è¾“å…¥æ•°æ®ç„¶åæŠ“å–äº¤é€šç½šæ¬¾çš„ä¸»å‡½æ•°:

```
22 # Plate finder function: 23 def busca_placa_df(browser, placa, verbose=False):
24     # Find ID and input test data: 25     browser.find_element_by_id('plate').clear()
26     browser.find_element_by_id('plate').send_keys(placa)
27
28     # Look for button and click it: 29     browser.find_element_by_xpath('//*[@id="request"]/div[2]/div/a').click()
30
31     # Search result and return it: 32     resultado = browser.find_element_by_id("secciones")
33     if resultado.text == "INFRACCIONES":
34         resultado = "Â¡No tienes adeudos!"
35     else:
36         resultado = resultado.text
37
38         # Search infraction tables: 39         if verbose:
40             infractions = browser.find_elements_by_id("tablaDatos")
41             if len(infractions):
42                 for index, infraction in enumerate(infractions):
43                     raw_data = infraction.text.split('\n')
44                     folio, fecha = raw_data[1].split(' ')[0:2]
45                     situation = ' '.join(raw_data[1].split(' ')[2:])
46                     motive = ' '.join(raw_data[2].split(' ')[1:])
47                     items = raw_data[3] + ' , '
48                     its = [item.split(' ')[-1] for item in items.split(', ')]
49                     art, fac, par, inc = its[:4]
50                     sanc = raw_data[4]
51
52                     data_dict = {
53                         'Folio': folio,
54                         'Fecha de InfracciÃ³n': fecha,
55                         'SituaciÃ³n': situation,
56                         'Motivo': motive,
57                         'Fundamento': {
58                             'ArtÃ­culo': art,
59                             'FacciÃ³n': fac,
60                             'PÃ¡rrafo': par,
61                             'Inciso': inc,
62                         },
63                         'SanciÃ³n': sanc
64                     }
65                     print("InfracciÃ³n {}:".format(index + 1))
66                     pprint(data_dict)
67                     print()
68 
69     return resultado 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æ‚¨æ‰€è§ï¼Œåœ¨ç¬¬`24-26`è¡Œä¸­ï¼Œæˆ‘ç”¨æ¥è‡ª HTML æºä»£ç çš„`id=plate`æ¸…é™¤äº†è¾“å…¥å­—æ®µä¸­çš„æ•°æ®ï¼Œç„¶åè¾“å…¥æˆ‘æƒ³è¦æŸ¥æ‰¾çš„æ±½è½¦ç‰Œç…§ï¼Œä¹‹åæˆ‘é€šè¿‡å…¶ XPath æŸ¥æ‰¾æŒ‰é’®å¹¶å•å‡»å®ƒ(ç¬¬`28-29`è¡Œ)ã€‚

æˆ‘ç°åœ¨æƒ³çŸ¥é“æœç´¢çš„ç»“æœï¼Œä¸ºæ­¤æˆ‘åœ¨å“åº”çš„ HTML ä¸­æŸ¥æ‰¾å¸¦æœ‰`id=secciones`çš„å…ƒç´ (ç¬¬`31-32`è¡Œ)ï¼Œå¹¶é¦–å…ˆé€šè¿‡æŸ¥çœ‹ç»“æœæ–‡æœ¬æ˜¯å¦åªæœ‰`"INFRACCIONES"`æ¥éªŒè¯å®ƒæ˜¯å¦æœ‰ä»»ä½•å€ºåŠ¡ï¼Œå¦‚æœæœ‰ï¼Œæˆ‘è¿”å›ä¸€æ¡æ¶ˆæ¯è¯´ t æ²¡æœ‰å€ºåŠ¡(ç¬¬`33-34`è¡Œ)ã€‚åœ¨å¦ä¸€ç§æƒ…å†µä¸‹ï¼Œåœ¨`35-36`è¡Œä¸­ï¼Œæˆ‘ä¿å­˜äº†åŒ…å«æ–‡æœ¬çš„ç»“æœ(æŒ‡å®šäº†è½¦ç‰Œçš„äº¤é€šç½šæ¬¾æ•°é‡)ã€‚

å¦‚æœ`verbose`æ ‡å¿—æ‰“å¼€ï¼Œé‚£ä¹ˆåˆ®åˆ€å°†è·å¾—æ¯ä¸ªäº¤é€šç½šæ¬¾çš„æ‰€æœ‰ä¿¡æ¯(è¡Œ`38-40`)ã€‚ä¸ºæ­¤ï¼Œå®ƒå°†åœ¨ HTML ä¸­æŸ¥æ‰¾å¸¦æœ‰`id=tablaDatos`çš„å…ƒç´ ï¼Œè¯¥å…ƒç´ åŒ…å«æ¯ä¸ªäº¤é€šç½šæ¬¾çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¦‚æœå®ƒä¸ä¸ºç©º(è¡Œ`41`ï¼Œå®ƒå°†è¿­ä»£æ¯ä¸ªäº¤é€šç½šæ¬¾ï¼Œç„¶åæå–å®ƒä»¬çš„æ‰€æœ‰ä¿¡æ¯(è¡Œ`42-50`)ã€‚æˆ‘ç°åœ¨ä½¿ç”¨`pprint`(ç¬¬`52-67`è¡Œ)å’Œè¿”å›ç»“æœ(ç¬¬`69`è¡Œ)æ„å»ºä¸€ä¸ªåŒ…å«å“åº”çš„ dictï¼Œä»¥ä¸€ç§å¾ˆå¥½çš„æ–¹å¼æœåŠ¡å®ƒã€‚

ä¸ºäº†æµ‹è¯•è¿™ä¸ªè„šæœ¬ï¼Œæˆ‘ç”¨ä¸€ä¸ªæ¼”ç¤ºè½¦ç‰Œè°ƒç”¨äº†å‡½æ•°`launch_browser`(æ°å¥½æœ‰ä¸¤ä¸ªäº¤é€šç½šæ¬¾)å¹¶æ‰“å°å‡ºç»“æœ(è¡Œ`72-74` ):

```
72 if __name__ == '__main__':
73     multas = launch_browser('MKJ3940', True)
74     print(multas) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœæ‚¨åœ¨è„šæœ¬ä¸­è¿è¡Œå®ƒï¼Œæ‚¨ä¼šå¾—åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡º(æ³¨æ„ï¼Œå®ƒæ‰“å°äº†æˆ‘æåˆ°çš„ 2 ç¬”äº¤é€šç½šæ¬¾ğŸ˜):
[![Running the scraper](../Images/de2e1dc970042dbd9e84a13eafac95ed.png)T3ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--39Gj8uI8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://rodolfoferro.xyz/assets/posts/plate_scraper.png)

## ç»“è®º

ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™åªæ˜¯ä¸€ä¸ªæ™šä¸Šä¸€èµ·å·¥ä½œçš„æœ‰è¶£é¡¹ç›®*â€”â€”å°±åƒä¸€ä¸ªè¿·ä½ é»‘å®¢é©¬æ‹‰æ¾â€”â€”*æœ€ç»ˆæˆä¸ºä¸€ä¸ªæœ‰ç”¨çš„é¡¹ç›®ï¼Œå¯èƒ½å¯¹å¢¨è¥¿å“¥åŸçš„å…¬æ°‘æœ‰æ‰€å¸®åŠ©ã€‚

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼ŒPython æœ‰ä¸€äº›å·¥å…·å¯ä»¥ä»¥éå¸¸é…·çš„æ–¹å¼å¸®åŠ©è‡ªåŠ¨åŒ–ä¸€äº›äº‹æƒ…ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œå¦‚æœæ‚¨æŒ‰ç…§æä¾›çš„é‚£æ ·è¿è¡Œè„šæœ¬ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªæµè§ˆå™¨çª—å£è‡ªåŠ¨æ‰“å¼€ï¼Œç„¶åæ–‡æœ¬è¢«å•ç‹¬å†™å…¥è¾“å…¥å­—æ®µï¼Œç»“æœè¢«å•ç‹¬æ˜¾ç¤ºå‡ºæ¥ã€‚**è¿™ä¸æ˜¯çœŸçš„å¾ˆç‰›é€¼å—ï¼Ÿ**

è¯·åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ä½ ç”¨ Selenium å’Œ Python æ„å»ºäº†ä»€ä¹ˆï¼ğŸ’»ğŸğŸ¤™ğŸ¼