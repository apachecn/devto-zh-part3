# Mux è§†é¢‘æ’ä»¶å…¥é—¨

> åŸæ–‡ï¼š<https://dev.to/sanity-io/get-started-with-the-mux-video-plugin-for-sanity-4k2a>

åœ¨æ„å»º Sanity æ—¶ï¼Œæˆ‘ä»¬éå¸¸é‡è§†æ„å»ºä¸€ä¸ªè¶…çº§çµæ´»çš„å›¾åƒç®¡é“ï¼Œå¯ä»¥ä¸ºæ‚¨è½¬æ¢å’Œé‡æ–°è£å‰ªæ‚¨çš„å›¾åƒã€‚æˆ‘ä»¬æ— æ„åœ¨è§†é¢‘é¢†åŸŸåšåŒæ ·çš„äº‹æƒ…ã€‚

å½“ Mux å‘æˆ‘ä»¬å¯»æ±‚ä¸ä»–ä»¬çš„è§†é¢‘æµå’Œåˆ†æå¹³å°é›†æˆæ—¶ï¼Œæˆ‘ä»¬æ¯«ä¸æ€€ç–‘è¿™å°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚

## Mux æ˜¯è°ï¼Ÿ

Mux äº 2015 å¹´ç”±ä¹”æ©Â·è¾¾å°”ã€å²è’‚å¤«Â·èµ«å¼—å—ã€é©¬ç‰¹Â·éº¦å…‹å¢å°”å’Œäºšå½“Â·å¸ƒæœ—åˆ›ç«‹ã€‚ä¹”æ©å’Œå²è’‚å¤«æ˜¯è¢« Brightcove æ”¶è´­çš„ Zencoder çš„è”åˆåˆ›å§‹äººã€‚ä¸æ¥è‡ª YouTubeã€Twitchã€Brightcove å’Œè„¸ä¹¦çš„å·¥ç¨‹å¸ˆå›¢é˜Ÿä¸€èµ·ï¼Œä»–ä»¬ç°åœ¨é¢†å¯¼ç€ç½‘ç»œä¸Šæœ€å¥½çš„åŸºäºäº‘çš„è§†é¢‘æœåŠ¡ä¹‹ä¸€ã€‚

Mux æ˜¯ä¸€ä¸ª API ä¼˜å…ˆçš„è§†é¢‘å¹³å°ï¼Œç”¨äºæµåª’ä½“å’Œåˆ†æã€‚è®©å®ƒä»¬ä¸ä¼—ä¸åŒçš„æ˜¯å®ƒä»¬çš„è‡ªæˆ‘ä¼˜åŒ–ç¼–ç å’Œä¼ è¾“æŠ€æœ¯ã€‚è¯¥æœåŠ¡ä¸ºæ‚¨çš„ç”¨æˆ·æä¾›é€‚åº”è®¾å¤‡å’Œç½‘ç»œæ¡ä»¶çš„é«˜è´¨é‡æµã€‚ä½ è¿˜å¯ä»¥è·å¾—è§†é¢‘è¡¨ç°çš„é€æ˜åº¦ã€‚å¤šè·¯å¤ç”¨å™¨é€šè¿‡å¤šè·¯å¤ç”¨å™¨æ•°æ®è½»æ¾å®ç°è¿™ä¸€ç‚¹ï¼Œä¸ºæ‚¨å®æ—¶æä¾›è¯¦ç»†çš„è§†é¢‘æ€§èƒ½æŒ‡æ ‡ã€‚

Mux çš„æ€§èƒ½å’ŒåŠŸèƒ½éå¸¸å‡ºè‰²ã€‚ä½¿ç”¨ Mux å­˜å‚¨æ‚¨çš„å…¨åˆ†è¾¨ç‡ä¸»æ–‡ä»¶ï¼Œå¹¶è¯·æ±‚æ‚¨éœ€è¦çš„ä»»ä½•æ ¼å¼â€”â€”HLS ç”¨äºæµå¼ä¼ è¾“ï¼ŒMP4 ç”¨äºä¸‹è½½ã€‚éœ€è¦çš„è¯ç”šè‡³ GIFã€‚ä»ä½ çš„å‰ç«¯ã€åº”ç”¨ç¨‹åºå’Œæ•°å­—æœåŠ¡ä¸­ï¼Œä½ å¯ä»¥å‡†ç¡®åœ°è¯·æ±‚ä½ éœ€è¦çš„æ ¼å¼ã€‚

## mux-video æ’ä»¶å…¥é—¨

Mux æ’ä»¶ä¸ºä½ æä¾›äº†ä¸€ç§ç®€å•çš„ä¸Šä¼ å’Œé¢„è§ˆè§†é¢‘çš„æ–¹å¼ã€‚

### å®‰è£…

åœ¨æ‚¨çš„ Sanity é¡¹ç›®æ–‡ä»¶å¤¹ä¸­è¿è¡Œæ­¤å‘½ä»¤:

### åœ¨æ¨¡å¼ä¸­ä½¿ç”¨

è¦ä½¿ç”¨ Mux è§†é¢‘è¾“å…¥ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªå­—æ®µï¼Œå¹¶ä½¿ç”¨`mux.video`è¡¨ç¤º`type`ã€‚

```
 export default {
      name: 'catVideos',
      type: 'mux.video'
    } 
```

### æ·»åŠ  API é”®

[æ³¨å†Œ Mux](https://dashboard.mux.com/signup?type=video) (å¦‚æœä½ å‘Šè¯‰ä»–ä»¬"`sanity"`ï¼Œä»–ä»¬ä¼šç»™ä½ ä»·å€¼ 50 ç¾å…ƒçš„âœ¨).ç§¯åˆ†å¦‚æœä½ è¿˜æ²¡æœ‰ä¸€ä¸ªå…³äºç†æ™ºçš„é¡¹ç›®- [æˆ‘ä»¬ä¹Ÿæœ‰ä¸€ä¸ªç‰¹åˆ«çš„æè®®](https://www.sanity.io/mux)ã€‚

[![Mux token configuration illustration](img/dabfceb9b24615fa153c2b6757bcddb1.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--vOwWWVYA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.sanity.img/3do82whm/production/c0152715592e6ac54fe9b6724fb44d34d15fa3b6-2594x2150.png%3Fw%3D1000) ä»¤ç‰Œéœ€è¦å®Œå…¨æƒé™æ‰èƒ½ä¸Šä¼ æ–‡ä»¶

ç™»å½• Mux åï¼Œåœ¨è®¾ç½®èœå•ä¸­æ‰¾åˆ°[â€œè®¿é—®ä»¤ç‰Œâ€é¡µé¢ã€‚é€šè¿‡å¯¹å¤šè·¯å¤ç”¨å™¨è§†é¢‘çš„**å®Œå…¨è®¿é—®* *å’Œå¯¹å¤šè·¯å¤ç”¨å™¨æ•°æ®çš„** **å’Œ**è¯»å–* *æ¥ç”Ÿæˆæ–°ä»¤ç‰Œï¼Œå¹¶ä¸ºä¸‹ä¸€æ­¥åšå¥½å‡†å¤‡ã€‚](https://dashboard.mux.com/settings/access-tokens)

å›åˆ° Sanity Studioï¼Œæ‰¾åˆ°æ˜¾ç¤ºè§†é¢‘å­—æ®µçš„æ–‡æ¡£ï¼Œç„¶åå•å‡»æ’ä»¶å›¾æ ‡ğŸ”Œåœ¨ä¸Šç²˜è´´æ‚¨çš„è®¿é—®ä»¤ç‰Œå’Œå¯†é’¥ã€‚

[![Mux API Credentials](img/9983f627d724bffb257e400a926e9bf2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--rRKzhWNq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.sanity.img/3do82whm/production/5dfa94404683d70455320b3572009de0eaf2db0e-2284x1534.png%3Fw%3D2000%26h%3D2000%26fit%3Dmax) è¾“å…¥ä½ çš„ Mux API å‡­è¯

### ä¸Šä¼ è§†é¢‘

ä¸Šä¼ è§†é¢‘å¾ˆç®€å•:ä½¿ç”¨é€‰æ‹©æŒ‰é’®æ‰“å¼€ç³»ç»Ÿä¸Šçš„æ–‡ä»¶èµ„æºç®¡ç†å™¨ï¼Œå°†æ–‡ä»¶ç›´æ¥æ‹–åˆ°è¾“å…¥åŒºåŸŸï¼Œæˆ–è€…å°† URL(å°±åƒæˆ‘åœ¨è§†é¢‘ä¸­æ‰€åšçš„é‚£æ ·)ç²˜è´´åˆ°å­—æ®µä¸­çš„è§†é¢‘ã€‚ä¸Šä¼ å®Œæˆåï¼Œæ‚¨å¯ä»¥é€‰æ‹©æƒ³è¦é¢„è§ˆçš„ç¼©ç•¥å›¾ã€‚æŸ¥çœ‹ codesandbox ä¸­çš„è§†é¢‘ï¼Œäº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

[https://codesandbox.io/embed/rl7q3x473p](https://codesandbox.io/embed/rl7q3x473p)

### ç”¨ GROQ æŸ¥è¯¢

åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº† Mux è§†é¢‘ä½œä¸ºå¯Œæ–‡æœ¬ä¸­çš„è‡ªå®šä¹‰å—ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ GROQ åœ¨å‰ç«¯ç”Ÿæˆæµçš„ URLã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨ä¸²è”æ¥è·å¾—ç°æˆçš„æµ URLã€‚

```
 [*_type == "post"]{
      ...,
      text[]{
        ...,
          _type == "muxVideo" => {
            ...,
            asset->{
                ...,
                "url": "https://stream.mux.com/" + playbackId
                }
            }
        }  
    } 
```

å¦‚æœæˆ‘ä»¬ä»è¿™ä¸ªæŸ¥è¯¢çš„å“åº”ä¸­æŒ‘é€‰å‡ºèµ„äº§æ•°æ®ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ç±»ä¼¼è¿™æ ·çš„ç»“æœ:

```
 {  "_key":  "121c8c30a649",  "_type":  "muxVideo",  "asset":  {  "_createdAt":  "2018-11-30T18:27:21Z",  "_id":  "066e45f9-e2e6-4537-8b40-05f8c0f334d9",  "_rev":  "0xLJdqcI4pgly0b1J2cj0o",  "_type":  "mux.videoAsset",  "_updatedAt":  "2018-11-30T18:27:27Z",  "assetId":  "KdUXsmAKryppWd1wPiAtNVhMIqc7cPmL",  "data":  {  "aspect_ratio":  "16:9",  "created_at":  "1543602441",  "duration":  28.233333,  "id":  "KdUXsmAKryppWd1wPiAtNVhMIqc7cPmL",  "master_access":  "none",  "max_stored_frame_rate":  30,  "max_stored_resolution":  "HD",  "mp4_support":  "none",  "passthrough":  "066e45f9-e2e6-4537-8b40-05f8c0f334d9",  "playback_ids":  [  {  "id":  "NZQMBbYtVa6pDebOjB8wXRNQvao3RWrv",  "policy":  "public"  }  ],  "status":  "ready",  "tracks":  [  {  "duration":  28.142585,  "id":  "Tcte02pHV5iGVYDUqGX5hiT5XqgB8pMym",  "max_channel_layout":  "stereo",  "max_channels":  2,  "type":  "audio"  },  {  "duration":  28.166,  "id":  "ocguJveQvPh95zPcnuitsLLXvLYaTAMwPfgDoqFLD01Q",  "max_frame_rate":  30,  "max_height":  1080,  "max_width":  1920,  "type":  "video"  }  ]  },  "filename":  "upload video with mux.mp4",  "playbackId":  "NZQMBbYtVa6pDebOjB8wXRNQvao3RWrv",  "status":  "ready",  "url":  "https://stream.mux.com/NZQMBbYtVa6pDebOjB8wXRNQvao3RWrv"  }  } 
```

ä¸æˆ‘ä»¬çš„å›¾åƒç®¡é“ä¸€æ ·ï¼Œæˆ‘ä»¬ç¡®ä¿å…ƒæ•°æ®éšæ—¶å¯ç”¨ã€‚è¿™æ„å‘³ç€æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡æ‰€æœ‰è¿™äº›é”®è½»æ¾åœ°æŸ¥è¯¢è§†é¢‘èµ„äº§ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢`[*_type == "mux.videoAsset" && data.aspect_ratio == "16:9"]`æ˜¯å¦ä¼šè¿”å›æ‰€æœ‰å…·æœ‰ä¿¡ç®±å®½é«˜æ¯”çš„ä¸Šä¼ è§†é¢‘ã€‚

### è§†é¢‘åœ¨å‰ç«¯æ’­æ”¾

æ‹¼å›¾çš„æœ€åä¸€å—æ˜¯æŠŠä½ çš„è§†é¢‘ç»™ä½ çš„ç»ˆç«¯ç”¨æˆ·ã€‚ä½ å¯ä»¥å°† Mux ä¸Šçš„è§†é¢‘ä¸å„ç§ä¸œè¥¿æ•´åˆåœ¨ä¸€èµ·ï¼Œæ— è®ºæ˜¯ç½‘ç»œã€åº”ç”¨ç¨‹åºã€ç”µè§†å¹³å°ï¼Œè¿˜æ˜¯é€šè¿‡å‘ç”¨æˆ·æä¾› mp4 ä¸‹è½½æ¥å®ç°ç¦»çº¿ã€‚æˆ‘ä»¬ä¸º React åˆ¶ä½œäº†ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ï¼Œå®ƒå¾ˆå®¹æ˜“é›†æˆåˆ°æ‚¨çš„é¡¹ç›®ä¸­ã€‚åœ¨ GitHub æˆ–ä¸‹é¢çš„ CodeSandbox ä¸­æŸ¥çœ‹ã€‚

[https://codesandbox.io/embed/rl7q3x473p](https://codesandbox.io/embed/rl7q3x473p)

### ç¬¬ä¸€ç±»è§†é¢‘æ”¯æŒ

æˆ‘ä»¬éå¸¸é«˜å…´ Mux å‘æˆ‘ä»¬ä¼¸å‡ºæ´æ‰‹ï¼Œåœ¨è§†é¢‘æ”¯æŒæ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ç«™åœ¨ä»–ä»¬çš„è‚©è†€ä¸Šã€‚æˆ‘ä»¬æ­£è®¡åˆ’è¿›ä¸€æ­¥æ”¹è¿›é›†æˆï¼Œæˆ‘ä»¬å¾ˆæƒ³çœ‹çœ‹ä½ ä¼šç”¨å®ƒåšä»€ä¹ˆã€‚å¦‚æœæƒ³æ›´æ·±å…¥åœ°äº†è§£å¦‚ä½•åœ¨ç½‘ç»œå‰ç«¯é›†æˆ Muxï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬åœ¨ ZEIT çš„æœ‹å‹ä»¬çš„åšå®¢æ–‡ç« ï¼Œ[ä»–ä»¬åˆšåˆšä½¿ç”¨ Mux](https://zeit.co/blog/new-zeit-tv) å‘å¸ƒäº†ä»–ä»¬çš„æ–°å¹³å° ZEIT TVã€‚

æœ€åï¼Œä¸€ä¸ªçŒ«çš„è§†é¢‘ã€‚å› ä¸ºæ¯ä¸ªäººçš„è§†é¢‘æ¡£æ¡ˆé‡Œéƒ½åº”è¯¥è‡³å°‘æœ‰ä¸€ä¸ªçŒ«çš„è§†é¢‘ã€‚

[https://codesandbox.io/embed/m39x831qp](https://codesandbox.io/embed/m39x831qp)

[æ¥æº](https://www.sanity.work/blog/first-class-responsive-video-support-with-the-new-mux-plugin)