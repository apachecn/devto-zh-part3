# å¦‚ä½•åœ¨ç…§é¡¾å©´å„¿çš„åŒæ—¶ç”¨ 13 Kb å†™ä¸€ä¸ªæ¸¸æˆ

> åŸæ–‡:[https://dev . to/vint haras/how-to-write-a game-in-under-13kb-while-care-a-baby-4160](https://dev.to/vintharas/how-to-write-a-game-in-under-13-kb-while-taking-care-of-a-baby-4160)

*æœ¬æ–‡æœ€åˆå‘å¸ƒäº[barbarianmeetscoding.com](https://www.barbarianmeetscoding.com/blog/2018/09/19/how-to-write-a-game-under-13k-while-taking-care-of-a-baby)ã€‚ğŸ˜Š*

å“‡ï¼æœ‰æ®µæ—¶é—´äº†ï¼è¿‡å»çš„ä¸€å¹´æ—¢ç²¾å½©åˆè‰°éš¾ã€‚ä½œä¸ºä¸€ä¸ªå¹³ç­‰çš„ä¼™ä¼´æ‹¥æœ‰å¹¶ç…§é¡¾ä¸€ä¸ªå©´å„¿æ˜¯ä»¤äººå…´å¥‹çš„ï¼Œæ¸©æš–äººå¿ƒçš„...éå¸¸ç´¯äººï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ åœ¨è¿‡å»çš„ä¸€å¹´é‡Œå¾ˆå°‘å¬åˆ°æˆ‘çš„æ¶ˆæ¯ã€‚è®©è¿™ç¯‡æ–‡ç« å’Œ [js13kgames](http://www.js13kgames.com) æ¯”èµ›æˆä¸ºæˆ‘çš„å¤å‡ºã€‚

åœ¨ä¸‹é¢çš„æ®µè½ä¸­ï¼Œä½ å°†äº†è§£å¼€å‘ä¸€æ¬¾ 13Kb ä»¥ä¸‹çš„æ¸¸æˆæ˜¯ä»€ä¹ˆæ„Ÿè§‰ï¼Œæˆ‘æ˜¯å¦‚ä½•åº”å¯¹æŒ‘æˆ˜çš„ï¼Œä»è§„åˆ’åˆ°å¼€å‘æ¸¸æˆæœºåˆ¶ã€ç²’å­ç³»ç»Ÿã€ç”Ÿæˆç®—æ³•ã€éŸ³ä¹ã€æ˜Ÿç³»ã€ç¥ç§˜å¤–æ˜Ÿäººçš„èˆ°é˜Ÿï¼Œä»¥åŠæˆ‘æ˜¯å¦‚ä½•åˆ°è¾¾ç±»ä¼¼æ¸¸æˆçš„ä¸œè¥¿: **[åœ°çƒï¼Œå³](http://js13kgames.com/entries/earth-that-was)** ã€‚*(è¿›å…¥è§†é¢‘)*

[https://www.youtube.com/embed/yzkXUoI43ok](https://www.youtube.com/embed/yzkXUoI43ok)

## 13kb ä»¥ä¸‹å†™ä¸ªæ¸¸æˆæ€ä¹ˆæ ·ï¼Ÿ

æˆ‘ä¸çŸ¥é“æˆ‘åˆ°åº•æ˜¯æ€ä¹ˆå‘ç°[js13k æ¸¸æˆ](http://wwww.js13kgames.com)çš„ã€‚ä¸çŸ¥ä½•æ•…ï¼Œå®ƒå‡ºç°åœ¨æˆ‘çš„æ¨ç‰¹ä¸Šï¼Œæˆ‘æƒ³*â€œå—¯...ä¿çš®â€¦â€¦â€*å½“æˆ‘å‘ä¸‹æ»šåŠ¨åˆ°ä¸‹ä¸€æ¡ JavaScript æ–°é—»æ—¶ã€‚ç›´åˆ°å‡ å¤©åï¼Œè¿™ä¸ªæƒ³æ³•åœ¨æˆ‘è„‘æµ·æ·±å¤„çš„æŸä¸ªåœ°æ–¹å½¢æˆå¹¶å‘é…µï¼Œæˆ‘å†³å®šï¼Œ*â€œç®¡å®ƒå‘¢ï¼Ÿè¿™å°†æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„æ–¹å¼æ¥é‡æ–°ç‚¹ç‡ƒæˆ‘å¯¹ç¼–ç å’Œåœ¨å·¥ä½œä¹‹å¤–åšä¸€äº›å¾ˆé…·çš„äº‹æƒ…çš„çƒ­æƒ…ã€‚*

åŸæ¥æ˜¯è¿™æ ·å¼€å§‹çš„ã€‚è¯´æœè¿™ä½çŠ¹è±«ä¸å†³çš„çˆ¶äº²çš„æœ€åä¸€æ­¥æ˜¯è·Ÿéš[ä¸€ä¸ªå…³äºç”¨](https://medium.com/web-maker/making-asteroids-with-kontra-js-and-web-maker-95559d39b45f) [kontra.js](https://straker.github.io/kontra/) å»ºé€ å°è¡Œæ˜Ÿçš„å¾ˆæ£’çš„æ•™ç¨‹ï¼Œå¹¶æ„è¯†åˆ°è¿™æœ‰å¤šæœ‰è¶£ã€‚

## [](#setting-goals-and-choosing-a-theme)è®¾å®šç›®æ ‡å’Œé€‰æ‹©ä¸»é¢˜

æ‰€ä»¥æˆ‘æ‰“ç®—å‚åŠ  gamejamï¼Œä½†æ˜¯æˆ‘çš„æ¸¸æˆæ˜¯å…³äºä»€ä¹ˆçš„å‘¢ï¼Ÿæˆ‘æƒ³ä»è¿™æ¬¡ gamejam ä½“éªŒä¸­å¾—åˆ°ä»€ä¹ˆï¼Ÿå¯¹æˆ‘æ¥è¯´ï¼Œæœ€é‡è¦çš„äº‹æƒ…æ˜¯**äº†è§£æ¸¸æˆå¼€å‘**ã€**ç©å¾—å¼€å¿ƒ**å’Œ**å®Œæˆæ¸¸æˆ**ã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘å†³å®šå°½å¯èƒ½ç®€åŒ–äº‹æƒ…ï¼Œç»§ç»­ä½¿ç”¨æ•™ç¨‹ä¸­çš„å¤ªç©ºå°„æ‰‹ä¸»é¢˜ã€‚æˆ‘ç»å¸¸å‘ç°ï¼Œä¸ºäº†å­¦ä¹ æ–°çš„ä¸œè¥¿ï¼Œä½ å¯ä»¥éµå¾ªçš„æœ€ä½³æ–¹æ³•æ˜¯æŠŠäº‹æƒ…åˆ†è§£ï¼Œå‡å°‘ä½ åœ¨ä»»ä½•ç»™å®šæ—¶é—´å¤„ç†çš„å¤æ‚æ€§ã€‚

ä¸ºäº†èŠ‚çœå®è´µçš„ 13Kbï¼Œæˆ‘ä¼šä½¿ç”¨æ”¯æŒåœ°å›¾ã€å›¾åƒã€éŸ³ä¹ç­‰ç¨‹åºç”Ÿæˆçš„ç»éªŒæ³•åˆ™...è¶…è¿‡æ‰‹å·¥å·¥ä½œï¼Œç”±äºæˆ‘ç‰¹æ®Šçš„æ—¶é—´é™åˆ¶ï¼Œæˆ‘çš„ç›®æ ‡æ˜¯ä»åŸºæœ¬åŸåˆ™å¼€å§‹ä»¥æœ€ç®€å•çš„å½¢å¼è®©ä¸€åˆ‡å·¥ä½œ(æ²¡æœ‰å¤ªå¤šæ—¶é—´æŠ•å…¥ç ”ç©¶)ã€‚

## [](#opportunistic-coding-or-how-to-code-when-theres-no-time-to-code)æœºä¼šä¸»ä¹‰ç¼–ç ï¼Œæˆ–è€…æ²¡æœ‰æ—¶é—´ç¼–ç çš„æ—¶å€™æ€ä¹ˆç¼–ç 

ä¸‹ä¸€ä¸ªéšœç¢æ˜¯æ‰¾æ—¶é—´å¼€å‘æ¸¸æˆã€‚ä½œä¸ºä¸€ä¸ªæœ‰ä¸€ä¸ªéå¸¸å°çš„å©´å„¿çš„çˆ¶äº²ï¼Œæˆ‘çš„æ—¶é—´å’Œæ³¨æ„åŠ›éƒ½å±äºä»–ï¼Œåªæœ‰åœ¨ä»–ç¡è§‰çš„æ—¶å€™ï¼Œæˆ‘æ‰æœ‰æ—¶é—´å’Œå®é™å»åšé™¤äº†ç…§é¡¾å©´å„¿ä»¥å¤–çš„ä»»ä½•äº‹æƒ…ã€‚è¿™é‡Œæœ‰å‡ ä¸ªåŒæ ·é€‚ç”¨äºçˆ¸çˆ¸å’Œéçˆ¸çˆ¸ç”Ÿç‰©çš„å»ºè®®:

1.  **å¹²æ‰å¤šä»»åŠ¡**ã€‚ä¸“æ³¨äºæ‰‹å¤´çš„ä¸€é¡¹ä»»åŠ¡ã€‚æ‰‹å¤´çš„ä¸€ä¸ªé¡¹ç›®ã€‚ä¸€æ¬¡åšä¸€ä»¶äº‹ã€‚æŒç»­çš„è¿­ä»£åŠªåŠ›åº”ç”¨åˆ°ä¸€ä¸ªå•ä¸€çš„é—®é¢˜ä¸Šä¼šç»“å‡ºæƒŠäººçš„æœå®ã€‚
2.  è¡ŒåŠ¨äº§ç”ŸåŠ¨åŠ›ã€‚å¦‚æœä½ ç´¯äº†ï¼Œæ„Ÿè§‰ä¸åˆ°ï¼Œæ‰“å¼€ä½ çš„ç”µè„‘ï¼Œå¼€å§‹ç¼–ç ã€‚ä½ ä¼šæƒŠè®¶åœ°å‘ç°ï¼Œä»…ä»…å‡ åˆ†é’Ÿçš„ç¼–ç åï¼Œä½ å°±ä¼šè¿›å…¥çŠ¶æ€ï¼Œæ„Ÿåˆ°ç²¾åŠ›å……æ²›ã€‚

## [](#setting-up-a-gamedev-environment)è®¾ç½®æ¸¸æˆå¼€å‘ç¯å¢ƒ

å¯¹äºå¼€å‘ç¯å¢ƒï¼Œæˆ‘ä¼šä½¿ç”¨è¿™ä¸ªæ—¶ä»£çš„ web å¼€å‘äººå‘˜ç†Ÿæ‚‰çš„ä¸œè¥¿ï¼Œ  ï¼Œ  å’Œ ã€‚è¿è¡Œè¿™æ ·çš„ä¸œè¥¿:

```
$ npm start 
```

ä¼šè®¾ç½®æˆ‘çš„æ¸¸æˆå¼€å‘ç¯å¢ƒä¸ç°åœºé‡è£…ã€‚è¿˜æœ‰:

```
$ npm run build 
```

å°†æˆ‘çš„ä½œå“â€œäºŒè¿›åˆ¶â€æäº¤ç»™ç«äº‰å¯¹æ‰‹ã€‚è¿™æ˜¯ä¸€ä¸ªè¶…çº§æ–¹ä¾¿çš„è®¾ç½®ï¼Œè€Œä¸”  å¸®åŠ©æˆ‘æ›´å¿«åœ°æ‰¾åˆ°å¹¶ä¿®å¤äº†æŸäº›é”™è¯¯ã€‚

åœ¨ä¼˜åŒ– JS ä»¥å°†å…¶ä¿æŒåœ¨ 13 Kb ä»¥ä¸‹æ–¹é¢ï¼Œæˆ‘ç”¨  å’Œä¿®è¡¥äº†ä¸€æ®µæ—¶é—´ï¼Œä½†æˆ‘æœ€ç»ˆä½¿ç”¨äº† uglifyJSï¼Œå› ä¸ºå®ƒä¸ Webpack æœ‰æ›´å¥½çš„é›†æˆã€‚(TBHï¼Œåœ¨æˆ‘ä»…æœ‰çš„ä¸€ç‚¹æ—¶é—´é‡Œï¼Œæˆ‘æ— æ³•å®Œæˆæ”¶å°¾å·¥ä½œï¼Œä¸‘é™‹çš„ JS å·²ç»è¶³å¤Ÿå¥½äº†)ã€‚

## [](#writing-a-game)ç¼–å†™æ¸¸æˆ

å†™æ¸¸æˆæ˜¯ä¸€ä»¶éå¸¸æœ‰è¶£çš„äº‹æƒ…ã€‚æˆ‘æœ€å–œæ¬¢ç¼–ç¨‹çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒæ˜¯ä¸€é—¨åˆ›é€ çš„è‰ºæœ¯:æ²¡æœ‰ä»»ä½•ä¸œè¥¿ï¼›ä½ å†™ä¸€äº›ä»£ç ç„¶å**å˜£ï¼æ— ä¸­ç”Ÿæœ‰ã€‚æ¸¸æˆå¼€å‘åœ¨è¿™æ–¹é¢ç‰¹åˆ«å¼ºï¼Œå› ä¸ºä½ æœ‰èƒ½åŠ›åˆ›é€ ä¸–ç•Œã€‚å¦‚æœä½ é—®æˆ‘ï¼Œæˆ‘ä¼šè§‰å¾—è¿™å¾ˆé…·ã€‚é¢†åŸŸæ¨¡å‹æ— ç–‘å‡»è´¥äº†æˆ‘ä»¥å‰åˆä½œè¿‡çš„ä»»ä½•åº”ç”¨ç¨‹åºï¼Œ`SpaceShip`ã€`Planet`ã€`Bullet`ã€`Elder`åœ¨ä¸€å¤©ä¸­çš„ä»»ä½•æ—¶å€™éƒ½èµ¢è¿‡`PurchaseOrder`ã€‚**

### [](#wouldnt-it-be-cool-if-game-design)å¦‚æœä¸æ˜¯å¾ˆé…·å—ï¼Ÿæ¸¸æˆè®¾è®¡

å› ä¸ºæˆ‘ç©è¿™ä¸ªæ¸¸æˆçš„ä¸»è¦ç›®æ ‡æ˜¯å­¦ä¹ å¦‚ä½•å¼€å‘æ¸¸æˆï¼Œæ‰€ä»¥æˆ‘é‡‡å–äº†ä¸€ç§éå¸¸å¼€æ”¾å’Œæ¢ç´¢æ€§çš„æ–¹æ³•:æˆ‘ç§°ä¹‹ä¸º**ä¸ä¼šå¾ˆé…·çš„æ¸¸æˆè®¾è®¡**ã€‚æˆ‘çŸ¥é“æˆ‘æƒ³åšä¸€ä¸ªå¤ªç©ºå°„å‡»æ¸¸æˆï¼Œå› ä¸ºæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ¯”å…¶ä»–ç±»å‹çš„æ¸¸æˆæ›´ç®€å•çš„ä»»åŠ¡ï¼Œä½†æˆ‘æ²¡æœ‰èŠ±å¤ªå¤šæ—¶é—´æ¥è®¡åˆ’è¿™ä¸ªæ¸¸æˆã€‚æˆ‘åªæ˜¯é—®è‡ªå·±:**å†™ä¸åŒçš„å­¤ç«‹çš„åŠ›å­¦ï¼Œå¦‚æœ...**

*   è¿™äº›å°è¡Œæ˜Ÿæœ‰å¾ˆå¥½çš„çº¹ç†ï¼Ÿ
*   å®ƒä»¬æœ‰ä¸åŒçš„å½¢çŠ¶å’Œå¤§å°ï¼Ÿ
*   å½“é£èˆ¹è¢«æ‘§æ¯æ—¶ï¼Œä»–ä»¬ä¼šæŠ•æ”¾èµ„æºæ¥å……ç”µ/ä¿®ç†é£èˆ¹ï¼Ÿ
*   é£èˆ¹æ¨è¿›å™¨å‘å°„å‡ºç²’å­ï¼Ÿ
*   æœ‰å‡ ä¸ªæ´¾åˆ«æœ‰ä¸åŒçš„èˆ¹åªå’Œç›®æ ‡ï¼Ÿ
*   æœ‰ç¥ç§˜ä¸”æåº¦å±é™©çš„å¤–æ˜Ÿäººåœ¨å››å¤„æ¸¸è¡ï¼Ÿ
*   å½“æ²¡æœ‰èƒ½é‡æ—¶ï¼Œæ¸¸æˆä¸­ä¸åŒçš„é£èˆ¹ç³»ç»Ÿä¼šåœæ­¢å·¥ä½œï¼Ÿ
*   ä½ å¯ä»¥å®£ç§°æœ‰è¡Œæ˜Ÿï¼Ÿ
*   ä½ å¯ä»¥æ‹¥æœ‰è¿™äº›æ˜Ÿçƒçš„ç»æµå¹¶å»ºé€ é˜²å¾¡è®¾æ–½ã€èˆ¹åªç­‰ï¼Ÿ
*   ä½ å¯ä»¥ç”¨ä¸åŒçš„æ­¦å™¨ç³»ç»Ÿå’Œæ–¹å¼å‘ä½ çš„æ•Œäººå‘å°„ç«ç„°å’Œæ¯ç­ï¼Ÿ
*   å¦‚æ­¤è¿™èˆ¬ï¼Œå¦‚æ­¤è¿™èˆ¬...

è™½ç„¶è¿™æ˜¯ä¸€ä¸ªå¼€å‘æ¸¸æˆçš„æœ‰è¶£æ–¹å¼ï¼Œä½†è¿™æ„å‘³ç€åœ¨æ¯”èµ›çš„æœ€åä¸€å¤©ï¼Œæˆ‘æœ‰äº†ä¸€å †åŸºæœ¬ä¸Šå­¤ç«‹çš„æœºåˆ¶ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ¸¸æˆã€‚æœ‰èˆ¹ï¼Œå°è¡Œæ˜Ÿï¼Œè¡Œæ˜Ÿï¼Œå¤ªé˜³ï¼Œæ‰‡åŒºï¼Œæ˜Ÿç³»ï¼Œå¤–æ˜Ÿäººï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆèƒ½æŠŠå®ƒä»¬è¿æ¥åœ¨ä¸€èµ·æˆä¸ºä¸€ä¸ªç±»ä¼¼æ¸¸æˆçš„ä¸œè¥¿ã€‚

æ‰€ä»¥åœ¨æœ€åä¸€å¤©ï¼Œæˆ‘å’Œæˆ‘çš„å„¿å­ Teo(åœ¨ä»–ç¡è§‰çš„æ—¶å€™)è¿›è¡Œäº†ä¸€æ¬¡å¤´è„‘é£æš´ï¼Œæƒ³å‡ºäº†ä¸€ä¸ªå¯ä»¥åœ¨ä¸€å¤©å†…å°†æ‰€æœ‰è¿™äº›å…ƒç´ è”ç³»åœ¨ä¸€èµ·çš„æƒ³æ³•:

ä¸€è‰˜é£èˆ¹ç›˜æ—‹åœ¨ç¯ç»•å‚æ­»çš„åœ°çƒçš„è½¨é“ä¸Šï¼Œè¿™æ˜¯äººç±»æœ€åçš„å¸Œæœ›ï¼Œå®ƒåŒ…å«äº†è·¨è¶Šæ˜Ÿçƒçš„æ–°äººç±»æ–‡æ˜çš„ç§å­ã€‚å”¯ä¸€ç¼ºå°‘çš„æ˜¯ä¸€ä¸ªèƒ½å¤Ÿå®¹çº³å‰©ä½™äººç±»çš„æ–°åœ°çƒã€‚é‚£æ˜¯åœ°çƒã€‚ä½†å®ƒå¯ä»¥å†æ¬¡å‡ºç°ã€‚

æ‰€ä»¥ã€‚å¾ˆæ·±ã€‚

### [](#using-kontra)Using Kontra

Kontra.js æ˜¯ä¸€ä¸ªæç®€çš„ 2D æ¸¸æˆåº“ï¼Œéå¸¸é€‚åˆ js13k æŒ‘æˆ˜ã€‚å®ƒæä¾›äº†å¼€å‘ 2D æ¸¸æˆæ‰€éœ€çš„æ‰€æœ‰åŸºç¡€çŸ¥è¯†:ä¸€ä¸ªæ›´æ–°æ¸¸æˆçŠ¶æ€å¹¶åœ¨ç”»å¸ƒä¸Šæ¸²æŸ“çš„æ¸¸æˆå¾ªç¯ï¼Œä¸€ç§åœ¨æ¸¸æˆä¸­è¡¨ç¤ºäº‹ç‰©(ç²¾çµ)çš„æ–¹æ³•ï¼Œå¦‚èˆ¹åªã€å°è¡Œæ˜Ÿæˆ–å­å¼¹ï¼Œä¸€ç§åŠ è½½èµ„æºå’Œå¤„ç†è¾“å…¥çš„æ–¹æ³•ï¼Œtilemapsï¼Œå¸¦æœ‰åŠ¨ç”»çš„ç²¾çµè¡¨ï¼Œç­‰ç­‰ã€‚å¥½çš„æ–¹é¢æ˜¯å®ƒæ˜¯æ¨¡å—åŒ–çš„ï¼Œä½ å¯ä»¥é€‰æ‹©ä½ æƒ³ä½¿ç”¨çš„éƒ¨åˆ†ï¼Œä¸ºä½ çš„æ¸¸æˆèŠ‚çœé‚£äº›å®è´µçš„ Kbã€‚ä¸å¤ªå¥½çš„ä¸€ç‚¹æ˜¯(å–å†³äºæ‚¨çš„åå¥½å’Œæ‚¨çš„å¼€å‘ç¯å¢ƒ)ï¼Œå®ƒä¸æ”¯æŒ ESMï¼Œè€Œ ESM å¯¹äºæ ‘æŠ–åŠ¨æ¥è¯´æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚

Kontra çš„ API éå¸¸å–œæ¬¢å·¥å‚å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ç”¨å·¥å‚å‡½æ•°ä»£æ›¿ç±»æ¥å»ºæ¨¡æˆ‘æ‰€æœ‰çš„åŸŸå¯¹è±¡ï¼Œå› ä¸ºå®ƒæ„Ÿè§‰æ›´è‡ªç„¶ã€æ›´å¯¹ç§°ã€æ›´åˆé€‚ã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªå­å¼¹-å¯¼å¼¹-å°„å¼¹çš„ä¸œè¥¿:

```
export interface Bullet extends Sprite {
  damage: number
  owner: Sprite
  color: RGB
}

const numberOfParticles = 2

export default function createBullet(
  position: Position,
  velocity: Velocity,
  angle: number,
  cameraPosition: Position,
  scene: Scene,
  owner: Sprite,
  damage: number = 10,
  color: RGB = { r: 255, g: 255, b: 255 }
): Bullet {
  const cos = Math.cos(degreesToRadians(angle))
  const sin = Math.sin(degreesToRadians(angle))

  return kontra.sprite({
    type: SpriteType.Bullet,
    // start the bullet at the front of the ship
    x: position.x + cos * 12,
    y: position.y + sin * 12,
    // move the bullet slightly faster than the ship
    dx: velocity.dx + cos * 5,
    dy: velocity.dy + sin * 5,
    // damage can vary based on who shoots the missile
    damage,
    // avoid friendly fire
    owner,
    ttl: 50,
    width: 2,
    height: 2,
    color,
    update() {
      this.advance()
      this.addParticles()
    },
    addParticles() {
      let particles = callTimes(numberOfParticles, () =>
        Particle(
          { x: this.x, y: this.y },
          { dx: this.dx, dy: this.dy },
          cameraPosition,
          angle,
          { color }
        )
      )
      particles.forEach(p => scene.addSprite(p))
    },
    render() {
      let position = getCanvasPosition(this, cameraPosition)
      Draw.fillRect(
        this.context,
        position.x,
        position.y,
        this.width,
        this.height,
        Color.rgb(this.color)
      )

      if (Config.debug && Config.showPath) {
        this.context.save()
        this.context.translate(position.x, position.y)
        Draw.drawLine(this.context, 0, 0, this.dx, this.dy, 'red')
        this.context.restore()
      }

      if (Config.debug && Config.renderCollisionArea) {
        this.context.save()
        this.context.translate(position.x, position.y)
        Draw.drawCircle(this.context, 0, 0, this.width / 2, 'red')
        this.context.restore()
      }
    },
  })
} 
```

é™¤äº†è¿™äº›æ¸¸æˆå¯¹è±¡ä¹‹å¤–ï¼Œå®ƒä»¬åªæ˜¯æ‰©å±•äº†`kontra.sprite({...})`çš„å·¥å‚ï¼Œä»£è¡¨äº†æ¸¸æˆä¸­ä»»ä½•å¯è§çš„å’Œèƒ½å¤Ÿäº¤äº’çš„å¯¹è±¡ï¼Œæˆ‘è¿˜åˆ›å»ºäº†å‡ ä¸ªæŠ½è±¡:`Scene`å’Œ`Game`æœ¬èº«ã€‚è¿™äº›åœºæ™¯éå¸¸æœ‰åŠ©äºè¡¨ç°æ¸¸æˆçš„ä¸åŒéƒ¨åˆ†ï¼Œå¹¶ä»¥æœ‰æ„ä¹‰çš„æ–¹å¼å¯¹æ¸¸æˆå¯¹è±¡è¿›è¡Œåˆ†ç»„(å¦‚å¼€æ”¾åœºæ™¯ã€å¤ªç©ºåœºæ™¯ã€æ¸¸æˆåœºæ™¯ç­‰)...)è™½ç„¶æ¸¸æˆæä¾›äº†ä¸€ç§é›†ä¸­çŠ¶æ€ç®¡ç†ã€æ§åˆ¶æ¸¸æˆéŸ³ä¹ã€é¢„åŠ è½½èµ„äº§çš„æ–¹å¼ï¼Œå¹¶æä¾›äº†ä¸€ç§åœ¨åœºæ™¯ä¹‹é—´è½¬æ¢çš„æ–¹å¼ã€‚

### [](#generative-programming)åˆ›æˆå¼ç¼–ç¨‹

æˆ‘èŠ±äº†å¤§éƒ¨åˆ†æ—¶é—´åšä¸¤ä»¶äº‹:

1.  ç”¨æˆ‘çš„å¤´å»æ’å‡»åŸºæœ¬çš„ç‰›é¡¿ç‰©ç†å­¦å’Œå‡ ä½•å­¦ï¼Œ
2.  è®¾è®¡ç®€å•çš„ç®—æ³•æ¥ç”Ÿæˆçº¹ç†ã€ç²’å­ã€åå­—å’Œæ˜Ÿç³»ã€‚

è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹ **#2** å“ªä¸ªå¯èƒ½ä¼šè®©ä½ æ›´æ„Ÿå…´è¶£ã€‚æ€»çš„æ¥è¯´ï¼Œåœ¨å¼€å‘è¿™äº›ç®—æ³•æ—¶ï¼Œæˆ‘éµå¾ªäº†å‡ æ¡è§„åˆ™:

1.  å°½å¯èƒ½å¿«åœ°è®©ä¸€äº›ä¸œè¥¿å·¥ä½œèµ·æ¥ï¼Œç„¶åè¿­ä»£
2.  æ€è€ƒé¦–è¦åŸåˆ™ã€‚ä½ å°†å¦‚ä½•ä»å¤´å¼€å§‹åšè¿™ä»¶äº‹ï¼Ÿ

#### [](#pixelated-textures)åƒç´ åŒ–çº¹ç†

å¯¹äºè¡Œæ˜Ÿçš„çº¹ç†ï¼Œæˆ‘æƒ³è¾¾åˆ°åƒç´ è‰ºæœ¯çš„æ„Ÿè§‰ï¼Œçœ‹èµ·æ¥ä¸åƒç‹—å±(æ‰€ä»¥éå¸¸ä½çš„æœŸæœ›:D)ã€‚æˆ‘ä»ä¸‰ç§ç±»å‹çš„è¡Œæ˜Ÿå¼€å§‹:çº¢è‰²ã€ç»¿è‰²å’Œè“è‰²ï¼Œä»¥åŠä»è¿™äº›å•ç‹¬çš„é¢œè‰²ç”Ÿæˆå®Œæ•´è°ƒè‰²æ¿çš„æƒ³æ³•ã€‚

æˆ‘ç«‹åˆ»æƒ³åˆ°äº†`HSL`é¢œè‰²æ¨¡å‹ï¼Œå®ƒæ˜¯ç”Ÿæˆè¿™äº›è°ƒè‰²æ¿çš„ç»ä½³å€™é€‰ã€‚`HSL`ä»£è¡¨`Hue`ã€`Saturation`å’Œ`Lightness`ï¼Œåè€…æ˜¯*çš„è‹±æ–‡æ„æ€ï¼Œå¦‚æœæˆ‘ä¸Šä¸‹æ”¹å˜äº®åº¦ï¼Œæˆ‘ä¼šå¾—åˆ°ä¸€ä¸ªè°ƒè‰²æ¿*ã€‚æˆ‘å°±æ˜¯è¿™ä¹ˆåšçš„ã€‚æˆ‘çš„ç¬¬ä¸€ä¸ªç®—æ³•ä½¿ç”¨äº†å•ä¸€çš„é¢œè‰²ï¼Œå¹¶å»ºç«‹äº†ä¸€ä¸ªè°ƒè‰²æ¿ï¼Œæœ‰ 2 ä¸ªè¾ƒæš—çš„é˜´å½±å’Œ 2 ä¸ªè¾ƒäº®çš„é˜´å½±ã€‚è¿™äº›é¢œè‰²åæ¥ä»¥ä¸åŒçš„æ¯”ä¾‹åº”ç”¨äºäº§ç”Ÿä¸€ä¸ªå›¾æ¡ˆï¼Œç„¶åç”¨äºå¡«å……ä¸€ä¸ªæ˜Ÿçƒçš„è¡¨é¢ã€‚åæ¥ï¼Œæˆ‘åœ¨å›¾æ¡ˆçš„ä¸åŒéƒ¨åˆ†å°è¯•äº†ä¸åŒçš„æ¯”ä¾‹ï¼Œé€æ˜åº¦å’Œè°ƒè‰²æ¿ä¸­æœ‰æ›´å¤šçš„é¢œè‰²ã€‚

æœ€ç»ˆçš„ç®—æ³•ä½¿ç”¨äº†åŸºè‰²å’Œå¼ºè°ƒè‰²ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·:

```
// A way to represent HSL colors
export interface HSL {
  h: number
  s: number
  l: number
}

// An offscreen canvas to create textures
// in the background
export class OffscreenCanvas {
  // more codes here...
  // but here's the interesting part

  private savedPatterns: Map<string, CanvasPattern> = new Map<
    string,
    CanvasPattern
  >()

  getPatternBasedOnColors(
    primary: HSL,
    secondary: HSL,
    width: number = 16,
    height: number = 16,
    pixelSize: number = 2
  ) {
    // memoize
    // TODO: extract to higher-order function
    if (
      this.savedPatterns.has(twocolorkey(primary, secondary, width, height))
    ) {
      return this.savedPatterns.get(
        twocolorkey(primary, secondary, width, height)
      )
    }

    this.canvas.width = width
    this.canvas.height = height

    // 1\. define color theme
    let p = primary
    let s = secondary

    // Functions that return colors with different
    // alpha values. I ended up only using completely solid colors
    let baseColor = (a: number) => Color.hsla(p.h, p.s, p.l, a)
    let lightShade = (a: number) => Color.hsla(p.h, p.s, p.l + 10, a)
    let darkShade = (a: number) => Color.hsla(p.h, p.s, p.l - 10, a)
    let accent = (a: number) => Color.hsla(s.h, s.s, s.l, a)

    // This defines the color distribution
    // e.g. 40% base color, 20% lighter shade, 20% darker shade
    // and 20% accent color
    let buckets = [
      baseColor,
      baseColor,
      baseColor,
      baseColor,
      lightShade,
      lightShade,
      darkShade,
      darkShade,
      accent,
      accent,
    ]

    // 3\. distribute randomly pixel by pixel see how it looks
    for (let x = 0; x < this.canvas.width; x += pixelSize) {
      for (let y = 0; y < this.canvas.height; y += pixelSize) {
        let pickedColor = pickColor(buckets)
        this.context.fillStyle = pickedColor
        this.context.fillRect(x, y, pixelSize, pixelSize)
      }
    }

    let pattern = this.context.createPattern(this.canvas, 'repeat')
    this.savedPatterns.set(
      twocolorkey(primary, secondary, width, height),
      pattern
    )
    return pattern
  }
}

function pickColor(buckets: any) {
  let index = Math.round(getValueInRange(0, 9))
  let alpha = 1
  return buckets[index](alpha)
}

function twocolorkey(
  primary: HSL,
  secondary: HSL,
  width: number,
  height: number
) {
  let key1 = key(primary.h, primary.s, primary.l, width, height)
  let key2 = key(secondary.h, secondary.s, secondary.l, width, height)
  return `${key1}//${key2}`
} 
```

å› ä¸ºæ¯æ¬¡ä½ éœ€è¦çš„æ—¶å€™éƒ½åˆ›å»ºä¸€ä¸ªå›¾æ¡ˆæœ‰ç‚¹è´µï¼Œæ‰€ä»¥æˆ‘*è®°ä½äº†*ä½¿ç”¨ç›¸åŒçš„é¢œè‰²å’Œå°ºå¯¸åˆ›å»ºçš„æ¯ä¸ªå›¾æ¡ˆã€‚é€šä¿—åœ°è¯´ï¼Œ *memoizing* æ„å‘³ç€ä¿å­˜å¸¦æœ‰ä¸€äº›å‚æ•°çš„å‡½æ•°è°ƒç”¨çš„ç»“æœï¼Œè¿™æ ·æˆ‘å°±ä¸éœ€è¦å†æ¬¡å¤„ç†ç›¸åŒçš„ç»“æœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦åˆ›å»ºäº†çº¹ç†å°±ä¿å­˜å®ƒä»¬ï¼Œå¹¶åå¤ä½¿ç”¨å®ƒä»¬ã€‚

è¿™é‡Œæœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´ï¼Œæˆ‘ä¼šå–œæ¬¢åšæ›´å¤šçš„å®éªŒï¼Œèƒ½å¤Ÿç”Ÿæˆå¤§å—çš„é™†åœ°ï¼Œäº‘çš„å½¢æˆï¼Œç­‰ç­‰ã€‚ç„¶è€Œç»“æœç›¸å½“å¥½ï¼Œæˆ‘å–œæ¬¢æˆ‘çš„è¡Œæ˜Ÿçš„æ ·å­ã€‚:D

#### [](#beautiful-stars)ç¾ä¸½çš„æ˜Ÿæ˜Ÿ

å½“ä½ çš„æ¸¸æˆå‘ç”Ÿåœ¨å¤ªç©ºä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯é»‘è‰²çš„ï¼Œç©å®¶å¾ˆéš¾çœ‹åˆ°ç§»åŠ¨é£èˆ¹çš„æ•ˆæœã€‚æ‰€ä»¥æˆ‘æƒ³åˆ›å»ºä¸€ä¸ªæ˜Ÿç©ºèƒŒæ™¯ï¼Œå¹¶å®ç°æŸç§è§†å·®æ•ˆæœï¼Œè¿™å°†ä¸ºç©å®¶æä¾›å…³äºç©ºé—´è¿åŠ¨çš„å·¨å¤§çº¿ç´¢ã€‚

ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ªç®—æ³•ï¼Œè¯¥ç®—æ³•å°†è€ƒè™‘ä»¥ä¸‹å› ç´ :

*   é£èˆ¹å‘¨å›´çš„èƒŒæ™¯å°†æ°¸è¿œè¢«æ˜Ÿæ˜Ÿè¦†ç›–ã€‚
*   éšç€é£èˆ¹çš„ç§»åŠ¨ï¼Œæˆ‘ä»¬å°†æ˜Ÿæ˜Ÿä»é£èˆ¹åé¢çš„*ç§»åŠ¨åˆ°é£èˆ¹å‰é¢çš„*ï¼Œåˆ›é€ å‡ºæ‰€æœ‰ä¸œè¥¿éƒ½è¢«æ˜Ÿæ˜Ÿè¦†ç›–çš„å¹»è§‰ã€‚**
**   æ’æ˜Ÿä¸é£èˆ¹çš„è·ç¦»ä¸åŒã€‚æœ‰äº›ä¼šå¾ˆè¿œå¾ˆè¿œï¼Œæœ‰äº›ä¼šè¿‘ä¸€äº›*   è¿œçš„æ˜Ÿæ˜Ÿä¼šæ¯”è¿‘çš„æ˜Ÿæ˜Ÿçœ‹èµ·æ¥æ›´æš—æ›´å°*   å½“èˆ¹ç§»åŠ¨æ—¶ï¼Œè¿œçš„æ’æ˜Ÿæ¯”è¿‘çš„æ’æ˜Ÿç§»åŠ¨å¾—æ…¢*

 *`Star`æœ¬èº«å°±æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ¸¸æˆå¯¹è±¡:

```
export interface StarBuilder extends SpriteBuilder {}
export interface Star extends Sprite {
  distance: number
  color: string
}

export function Star({ x, y, cameraPosition }: StarBuilder): Star {
  let distance: number = parseFloat(getValueInRange(0, 1).toFixed(2))
  let alpha: number = 1 - 3 * distance / 4
  let color: string = Color.get(alpha)
  let size: number = 2.5 + (1 - distance)

  return kontra.sprite({
    // create some variation in positioning
    x: getNumberWithVariance(x, x / 2),
    y: getNumberWithVariance(y, y / 2),
    type: SpriteType.Star,
    dx: 0,
    dy: 0,
    ttl: Infinity,
    distance,
    color,
    size,
    render() {
      // the more distant stars appear dimmer
      // limit alpha between 1 and 0.75
      // more distant stars are less affected by the camera position
      // that is, they move slower in reaction to the camera changing
      // this should work as a parallax effect of sorts.
      let position = getCanvasPosition(this, cameraPosition, this.distance)
      this.context.fillStyle = this.color
      this.context.fillRect(position.x, position.y, this.size, this.size)
    },
  })
}

export function getNumberWithVariance(n: number, variance: number): number {
  return n + Math.random() * variance
} 
```

è‚‰åœ¨å‡½æ•°ä¸­è®¡ç®—æ¸¸æˆå¯¹è±¡åœ¨ç”»å¸ƒä¸­çš„ä½ç½®`getCanvasPosition`ï¼Œå¹¶è€ƒè™‘æ‘„åƒæœºä½ç½®å’Œæ‘„åƒæœºå˜åŒ–æ—¶è·ç¦»çš„å½±å“:

```
// Get position of an object within the canvas by taking into account
// the position of the camera
export function getCanvasPosition(
  objectPosition: Position,
  cameraPosition: Position,
  distance: number = 0
): Position {
  // distance affects how distant objects react to the camera changing
  // distant objects move slower that close ones (something like parallax)
  // that is, moving the ship will have less effect on distant objects
  // than near ones

  // distance is a value between 0 (close) and 1 (far)
  // at most the deviation factor will be 0.8
  let deviationFactor = 1 - distance * 0.2

  // include canvasSize / 2 because the camera is always pointing
  // at the middle of the canvas
  let canvasPosition: Position = {
    x:
      objectPosition.x -
      (cameraPosition.x * deviationFactor - Config.canvasWidth / 2),
    y:
      objectPosition.y -
      (cameraPosition.y * deviationFactor - Config.canvasHeight / 2),
  }

  return canvasPosition
} 
```

#### [](#names)äººå

æˆ‘æœ€åˆçš„æƒ³æ³•æ˜¯æ¢ç´¢ä¸€ä¸ªæ— é™çš„æ˜Ÿç³»ï¼Œæ‰‹åŠ¨å‘½åæ¯ä¸ªæ˜Ÿç³»ã€æ’æ˜Ÿå’Œè¡Œæ˜Ÿæ˜¯è¡Œä¸é€šçš„ã€‚æˆ‘åªèƒ½æƒ³è±¡ 5 åˆ° 7 ä¸ªåå­—ã€‚æœ€å¤šäº†ã€‚å› æ­¤ï¼Œæˆ‘æ ¹æ®ä»¥ä¸‹åŸåˆ™ç¼–å†™äº†ä¸€ä¸ªåç§°ç”Ÿæˆå™¨:

*   ç”Ÿæˆ 1 åˆ° 3 ä¸ªå­—æ¯çš„éŸ³èŠ‚ã€‚
*   1 ä¸ªå­—æ¯éŸ³èŠ‚å°†æ˜¯äººå£°
*   2 å’Œ 3 ä¸ªå­—æ¯çš„éŸ³èŠ‚å°†ä»¥è¾…éŸ³å¼€å¤´
*   æŠŠ 2 åˆ° 4 ä¸ªéŸ³èŠ‚æ”¾åœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªå•è¯

æˆ‘çš„å¸Œæœ›æ˜¯ï¼Œè¿æ¥éŸ³èŠ‚è€Œä¸æ˜¯éšæœºå­—ç¬¦å°†å¯¼è‡´æ›´å¯è¯†åˆ«å’Œå¯ä¿¡çš„åå­—ï¼Œæˆ‘è®¤ä¸ºæˆ‘åšåˆ°äº†è¿™ä¸€ç‚¹ã€‚ç®—æ³•çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
export function generateName() {
  let numberOfSyllabes = getIntegerInRange(2, 4)
  let name = ''
  for (let i = 0; i < numberOfSyllabes; i++) {
    name += `${generateSyllable()}`
  }
  return name
}

let vocals = ['a', 'e', 'i', 'o', 'u', 'âˆšÂ§', 'âˆšâˆ‚', 'âˆšâ€¢']
let minCharCode = 97 // a
let maxCharCode = 122 // z

function generateSyllable() {
  let syllableSize = getIntegerInRange(1, 3)
  if (syllableSize === 1) return getVocal()
  else if (syllableSize === 2) return `${getConsonant()}${getVocal()}`
  else return `${getConsonant()}${getVocal()}${getConsonant()}`
}

function getVocal() {
  return getRandomValueOf(vocals)
}
function getConsonant() {
  let consonant = ''
  while (!consonant) {
    let code = getIntegerInRange(minCharCode, maxCharCode)
    let letter = String.fromCharCode(code)
    if (!vocals.includes(letter)) consonant = letter
  }
  return consonant
} 
```

#### [](#particles)ç²’å­

æˆ‘çˆ±ç²’å­ï¼æˆ‘è®¤ä¸ºä»–ä»¬å¢åŠ äº†ä¸€ä¸ªè®©æ¸¸æˆçœ‹èµ·æ¥å’Œæ„Ÿè§‰æ›´å¥½çš„å…ƒç´ ã€‚å½“æˆ‘ç€æ‰‹ç¼–å†™ç²’å­å¼•æ“æ—¶(å°½ç®¡å¯¹äºå‡ ä¸ªå‡½æ•°æ¥è¯´ï¼Œ*å¼•æ“*è¿™ä¸ªè¯å¤ªè¿‡é›„å¿ƒå‹ƒå‹ƒäº†)ï¼Œæˆ‘é—®è‡ªå·±**ä»€ä¹ˆæ˜¯ç²’å­ï¼Ÿè¿™å¼•å‘äº†ä¸€åœºéå¸¸æœ‰è¶£çš„å¯¹è¯ï¼Œå…³äºç”Ÿå‘½ã€å®‡å®™å’Œä¸€åˆ‡çš„ç»ˆæé—®é¢˜çš„ç­”æ¡ˆã€‚ä¸è¿‡ï¼Œæˆ‘ä¸ä¼šæ‹¿ç»†èŠ‚æ¥çƒ¦ä½ ...æœ€åå½’ç»“ä¸º:ç²’å­æ˜¯ä»ä¸€ä¸ªæºå¤´ä»¥ä¸åŒçš„æ–¹å‘ã€é€Ÿåº¦å’ŒåŠ é€Ÿåº¦å†’å‡ºæ¥çš„å°ç²¾çµï¼Œå®ƒä»¬éšç€æ—¶é—´çš„æ¨ç§»é€æ¸æ¶ˆå¤±ã€‚æ‰€ä»¥æˆ‘çš„ç²’å­å¼•æ“éœ€è¦:**

*   åˆ›å»ºä»åŸç‚¹å‘èŠ½çš„ç²’å­
*   åœ¨ç»™å®šæ–¹å‘å’Œé€Ÿåº¦çš„æƒ…å†µä¸‹(æˆ‘æ²¡æœ‰è€ƒè™‘åŠ é€Ÿåº¦ï¼Œæˆ‘æ•¢æ‰“èµŒè¿™æ˜¯ä¸€ä»¶å¾ˆæ£’çš„äº‹æƒ…)
*   ç²’å­ä¼šæœ‰ä¸åŒçš„ç”Ÿå­˜æ—¶é—´
*   éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç²’å­ä¼šè¤ªè‰²ã€å˜å°å¹¶æ¶ˆå¤±
*   ç²’å­ä¼šæœ‰ä¸åŒçš„é¢œè‰²ï¼Œä½ å¯ä»¥é…ç½®

å·®ä¸å¤šå°±æ˜¯è¿™æ ·ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºå­å¼¹çš„ç²’å­çš„ä¾‹å­ï¼Œæœ€ç»ˆçœ‹èµ·æ¥åƒå½—æ˜Ÿçš„å°¾å·´:

```
export interface Particle extends Sprite {}
export interface ParticleOptions {
  ttl?: number
  color?: RGB
  magnitude?: number
}

// particle that takes into account camera position
export function Particle(
  position: Position,
  velocity: Velocity,
  cameraPosition: Position,
  // angle for the particles
  particleAxis: number,
  { ttl = 30, color = { r: 255, g: 255, b: 255 } }: ParticleOptions = {}
): Particle {
  let ParticleAxisVariance = getValueInRange(-5, 5)

  let cos = Math.cos(degreesToRadians(particleAxis + ParticleAxisVariance))
  let sin = Math.sin(degreesToRadians(particleAxis + ParticleAxisVariance))

  return kontra.sprite({
    type: SpriteType.Particle,

    // particles originate from a single point
    x: position.x,
    y: position.y,

    // variance so that different particles will have
    // slightly different trajectories
    dx: velocity.dx - cos * 4,
    dy: velocity.dy - sin * 4,

    // each particle with have a slightly
    // different lifespan
    ttl: getValueInRange(20, ttl),
    dt: 0,

    width: 2,
    update() {
      this.dt += 1 / 60
      this.advance()
    },
    render() {
      let position = getCanvasPosition(this, cameraPosition)
      // as time passes the alpha increases until particles disappear
      let frames = this.dt * 60
      let alpha = 1 - frames / ttl
      let size = (1 + 0.5 * frames / ttl) * this.width
      this.context.fillStyle = Color.rgba(color.r, color.g, color.b, alpha)
      this.context.fillRect(position.x, position.y, size, size)
    },
  })
} 
```

#### [](#galaxies)æ˜Ÿç³»

æ­£å¦‚æˆ‘å‰å‡ èŠ‚æ‰€è¯´ï¼Œæˆ‘æœ€åˆçš„æƒ³æ³•æ˜¯ä¸ºç©å®¶åˆ›é€ ä¸€ä¸ªçœ‹ä¼¼æ— é™çš„æ˜Ÿç³»å»æ¢ç´¢ã€‚æˆ‘æƒ³ï¼Œå¦‚æœæˆ‘è®©æ¸¸æˆå˜å¾—è¶³å¤Ÿå›°éš¾å’Œå…·æœ‰æŒ‘æˆ˜æ€§ï¼Œç©å®¶ä¼šåœ¨åŒå€¦æ¢ç´¢å¤ªç©ºä¹‹å‰æ­»å»ã€‚æˆ‘å¾ˆä¹æ„åœ¨ç©å®¶æ¢ç´¢çš„æ—¶å€™æ¢ç´¢ç”Ÿæˆæ˜Ÿç³»çš„æƒ³æ³•ï¼Œä½†æœ€ç»ˆï¼Œéšç€æœ€åæœŸé™çš„ä¸´è¿‘ï¼Œæˆ‘é€‰æ‹©äº† v0 ç‰ˆæœ¬ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘åˆšåˆšåˆ›å»ºäº†ä¸€ä¸ª 10x10 çš„æ‰‡åŒºæ˜Ÿç³»ã€‚æ‰€ä»¥:

*   é“¶æ²³ç³»æœ‰ 10Ã—10 ä¸ªæ‰‡åŒº
*   ä¸€ä¸ªæ‰‡åŒºåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªæ’æ˜Ÿç³»ç»Ÿï¼Œæœ‰ä¸€ä¸ªä¸­å¿ƒæ’æ˜Ÿå’Œ 1 åˆ° 5 é¢—è¡Œæ˜Ÿå›´ç»•å®ƒæ—‹è½¬(é™¤äº†æˆ‘ä»¬çš„æ’æ˜Ÿç³»ç»Ÿï¼Œå®ƒæ‹¥æœ‰ä½ æ‰€æœŸæœ›çš„æ‰€æœ‰è¡Œæ˜Ÿã€‚æŠ±æ­‰å†¥ç‹æ˜Ÿï¼Œæ²¡æœ‰çŸ®è¡Œæ˜Ÿ)ã€‚
*   è¿™äº›æ‰‡åŒºå°†å æ®ä¸€ä¸ª 10000x10000 åƒç´ çš„è¡¨é¢ï¼Œä½¿å¯æ¢ç´¢çš„æ˜Ÿç³»æˆä¸ºä¸€ä¸ª 100Kx100K çš„ç©ºé—´ã€‚
*   ç©å®¶å°†åœ¨å¤ªé˜³ç³»ä¸­ç»•åœ°çƒè½¨é“è¿è¡Œå¼€å§‹æ¸¸æˆï¼Œå¤ªé˜³ç³»æ–¹ä¾¿åœ°ä½äºé“¶æ²³ç³»çš„ä¸­é—´ã€‚

è¿™æ˜¯ä¸€äº›å¼ºå¤§éƒ¨é—¨çš„ç¤ºä¾‹ä»£ç :

```
export interface Sector extends Position {
  name: string
  planets: Planet[]
  sun: Sun
  bodies: Sprite[]

  asteroids?: Asteroid[]
}

export function Sector(
  scene: Scene,
  position: Position,
  cameraPosition: Position,
  name = generateName()
): Sector {
  // HAXOR
  let isSunSystem = name === 'sun'
  let isOrion = name === 'orion'

  let sun = createSectorSun(position, cameraPosition, name)
  let planets = createPlanets(sun, scene, cameraPosition, {
    isSunSystem,
    isOrion,
  })
  return {
    // this position represents the
    // top-left corner of the sector
    x: position.x,
    y: position.y,
    name,

    sun,
    planets,

    bodies: [sun, ...planets],
  }
}

function createSectorSun(
  sectorPosition: Position,
  cameraPosition: Position,
  name: string
) {
  let centerOfTheSector = {
    x: sectorPosition.x + SectorSize / 2,
    y: sectorPosition.y + SectorSize / 2,
  }
  let sunSize = getValueInRange(125, 175)
  let sun = createSun({ ...centerOfTheSector }, sunSize, cameraPosition, name)
  return sun
}

function createPlanets(
  sun: Sun,
  scene: Scene,
  cameraPosition: Position,
  { isSunSystem = false, isOrion = false }
) {
  if (isSunSystem) return createSunSystemPlanets(sun, scene, cameraPosition)
  if (isOrion) return createOrionSystemPlanets(sun, scene, cameraPosition)

  let numberOfPlanets = getIntegerInRange(1, 5)
  let planets = []
  let planetPosition: Position = { x: sun.x, y: sun.y }
  for (let i = 0; i < numberOfPlanets; i++) {
    let additiveOrbit = getValueInRange(500, 1000)
    planetPosition.x = planetPosition.x + additiveOrbit
    let radius = getValueInRange(50, 100)
    let planet = createPlanet(
      sun,
      /* orbit */ planetPosition.x - sun.x,
      radius,
      cameraPosition,
      scene
    )
    planets.push(planet)
  }
  return planets
}

interface PlanetData {
  orbit: number
  radius: number
  name: string
  type: PlanetType
  angle?: number
  claimedBy?: Faction
}
function createSunSystemPlanets(
  sun: Sun,
  scene: Scene,
  cameraPosition: Position
) {
  let planets: PlanetData[] = [
    { orbit: 300, radius: 30, name: 'mercury', type: PlanetType.Barren },
    { orbit: 500, radius: 70, name: 'venus', type: PlanetType.Desert },
    {
      orbit: 700,
      radius: 50,
      name: '*earth*',
      type: PlanetType.Paradise,
      angle: 40,
      claimedBy: Faction.Blue,
    },
    { orbit: 900, radius: 40, name: 'mars', type: PlanetType.Red },
    { orbit: 1500, radius: 150, name: 'jupiter', type: PlanetType.GasGiant },
    { orbit: 2100, radius: 130, name: 'saturn', type: PlanetType.GasGiant },
    { orbit: 2700, radius: 110, name: 'uranus', type: PlanetType.Blue },
    { orbit: 3500, radius: 110, name: 'neptune', type: PlanetType.Blue },
  ]
  return planets.map(p =>
    createPlanet(sun, p.orbit, p.radius, cameraPosition, scene, {
      name: p.name,
      type: p.type,
      startingAngle: p.angle,
      claimedBy: p.claimedBy,
    })
  )
}

function createOrionSystemPlanets(
  sun: Sun,
  scene: Scene,
  cameraPosition: Position
) {
  return [
    createPlanet(sun, 700, 100, cameraPosition, scene, {
      name: 'orion',
      type: PlanetType.Paradise,
    }),
  ]
} 
```

### [](#the-ancient-elder-race)è¿œå¤çš„é•¿è€…ç§æ—

æˆ‘æƒ³åœ¨æ¸¸æˆä¸­åŠ å…¥ä¸€ç‚¹é¦™æ–™ï¼Œæ¯”å¦‚è¾£æ¤’æˆ–èƒ¡æ¤’ï¼Œè®©æ¸¸æˆæ›´æœ‰æŒ‘æˆ˜æ€§å’Œè¶£å‘³æ€§ã€‚ç”±äºæˆ‘æ²¡æœ‰å¤ªå¤šçš„æ—¶é—´æ¥æ€è€ƒå’Œå‘å±•è¿™ä¸ªæ¸¸æˆçš„æ·±å±‚çŸ¥è¯†ï¼Œæˆ‘é€‰æ‹©äº†ä¸€ä¸ªç§‘å¹»å’Œå¹»æƒ³çš„æ¯”å–»ï¼Œ**é•¿è€…ç§æ—**ã€‚

æˆ‘å¸Œæœ›ç©å®¶è‡³å°‘è¦å’Œä¸‰ç§ä¸åŒç±»å‹çš„æ•Œäººæˆ˜æ–—:

*   ä¸€ç§è¶…å¿«é€Ÿã€çŸ­ç¨‹ã€å¼±ä½†å…·æœ‰æ”»å‡»æ€§çš„é£è¡Œå™¨:**æ— äººæœº**
*   ä¸€ä¸ªä¸­å‹å•ä½ï¼Œéå¸¸åšå›ºï¼Œå¯ä»¥åœ¨è¡Œæ˜Ÿå’Œæ’æ˜Ÿå‘¨å›´å·¡é€»:å“¨å…µ
*   ä¸€è‰˜å·¨å¤§ã€åšå›ºå’Œå¼ºå¤§çš„æˆ˜èˆ°å°†å¾ˆå°‘è¢«çœ‹åˆ°ï¼Œå®ƒå°†èƒ½å¤Ÿéšæ„è¿è¾“å’Œå–·å°„æ— äººæœº:æ¯èˆ°ã€‚

è¿™ä¸ªæƒ³æ³•æ˜¯è®©è¿™äº›ä¸åŒçš„æ’æ˜Ÿç³»ç»Ÿä»¥ä¸åŒçš„æ–¹å¼å±…ä½ï¼Œå¹¶æœ‰ä¸€ä¸ªä»–ä»¬å±…ä½çš„ä¸­å¤®ç³»ç»Ÿï¼Œæ‹¥æœ‰æ‰€æœ‰èˆ°é˜Ÿçš„æ¯äº²ã€‚åœ¨æ¸¸æˆå¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä¸å¤ªç¡®å®šè¿™ä¸ªå¹´é•¿ç§æ—çš„è§’è‰²æˆ–æœ€ç»ˆç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œä½†åæ¥æˆ‘ç¡®å®šä»–ä»¬æ˜¯æœ€åä¸€ä¸ªé€‚åˆäººç±»ç”Ÿæ´»çš„æ˜Ÿçƒçš„å®ˆæŠ¤è€…ï¼Œå› æ­¤ä¹Ÿæ˜¯æ¸¸æˆçš„æœ€ç»ˆè€æ¿ã€‚

å½“æˆ‘å®ç°è¿™äº›æ—§èˆ¹æ—¶ï¼Œæˆ‘æƒ³å¼€å‘ä¸€ä¸ªç³»ç»Ÿï¼Œåœ¨é‚£é‡Œæˆ‘å¯ä»¥å®šä¹‰...è®©æˆ‘ä»¬æ‰“ç”µè¯ç»™ä»–ä»¬...äººå·¥æ™ºèƒ½è¡Œä¸º(åŒæ ·æ˜¯ **AI** å¯¹äºéå¸¸åŸºæœ¬çš„ç®—æ³•æ¥è¯´æ˜¯ä¸€ä¸ªè¿‡äºæ¨¡ç³Šçš„è¯)ç„¶åéšæ„å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®©*è·Ÿéšè¿™ä¸ªç›®æ ‡*ï¼Œæˆ–è€…*å‘å®ƒå°„å‡»*ï¼Œæˆ–è€…*åœ¨è¿™ä¸ªåŒºåŸŸå·¡é€»*ï¼Œæˆ–è€…*åœ¨ä½ æ²¡æœ‰å…¶ä»–äº‹æƒ…åšçš„æ—¶å€™è·Ÿéšè¿™ä¸ªè·¯çº¿*ã€‚

è¯¥ç³»ç»Ÿç”±ä¸€ç³»åˆ— [Mixins](https://www.barbarianmeetscoding.com/blog/2015/12/28/black-tower-summoning-object-composition-with-mixins/) ç»„æˆï¼Œæš´éœ²äº†ä»¥ä¸‹æ¥å£:

```
export interface Behavior {
  type: BehaviorType
  properties: BehaviorProperties
  update(dt?: number): void
  render?(): void
}

export interface BehaviorProperties {
  // any property
  [key: string]: any
} 
```

è¿™ä¸ªæ¥å£ç”±ä¸€å †ä»»æ„çš„å±æ€§`BehaviorProperties`ç»„æˆï¼Œè¡Œä¸ºæœ¬èº«éœ€è¦è¿™äº›å±æ€§æ¥è¿è¡Œï¼Œè¿˜æœ‰ä¸€ä¸ª`update`å’Œ`render`æ–¹æ³•æ¥æŒ‚é’©åˆ°è‡ªç„¶çš„`Sprite`ç”Ÿå‘½å‘¨æœŸä¸­ã€‚

è¡Œä¸ºçš„ä¸€ä¸ªä¾‹å­æ˜¯è¿™ä¸ª`Shoot`ï¼Œå®ƒé€šè¿‡è®©æ¸¸æˆå¯¹è±¡åœ¨ç›®æ ‡é è¿‘æ—¶å‘ç›®æ ‡å°„å‡»æ¥å®ç°è¿™ä¸ªæ¥å£(`< 300` ):

```
export function Shoot(scene: Scene, target: Position): Behavior {
  return {
    type: BehaviorType.Shoot,
    properties: {
      dts: 0,
      damage: 1,
      color: { r: 255, g: 255, b: 255 },
    },
    update(dt?: number) {
      this.dts += 1 / 60
      let distanceToShip = Vector.getDistanceMagnitude(this, target)
      if (this.dts > 0.5 && distanceToShip < 300) {
        this.dts = 0
        let angle = radiansToDegrees(Math.atan2(this.dy, this.dx))
        let bullet = createBullet(
          this,
          this,
          angle,
          target,
          scene,
          /*owner*/ this,
          this.damage,
          this.color
        )
        scene.addSprite(bullet)
      }
    },
  }
} 
```

æˆ‘ç”¨ä¸€ä¸ªæ™®é€šçš„`Sprite`æ¥ç¼–å†™è¿™ä¸ªå‡½æ•°çš„æ–¹æ³•æ˜¯ä½¿ç”¨è¿™ä¸ª`composeBehavior`å‡½æ•°:

```
export function composeBehavior(sprite: Sprite, behavior: Behavior) {
  // only add properties if they're not already there
  Object.keys(behavior.properties).forEach(k => {
    if (sprite[k] === undefined) {
      sprite[k] = behavior.properties[k]
    }
  })

  sprite.update = before(sprite.update, behavior.update).bind(sprite)
  if (behavior.render) {
    sprite.render = after(sprite.render, behavior.render).bind(sprite)
  }
} 
```

å…¶ä¸­`before`å’Œ`after`ä¸ºæ•ˆç”¨å‡½æ•°:

```
/* Call a function before another function */
export function before(func: any, beforeFunc: any) {
  return function(...args: any[]) {
    beforeFunc.apply(this, args)
    func.apply(this, args)
  }
}

/* Call a function after another function */
export function after(func: any, ...afterFuncs: any[]) {
  return function(...args: any[]) {
    func.apply(this, args)
    afterFuncs.forEach((f: any) => f.apply(this, args))
  }
} 
```

å› æ­¤ï¼Œåˆ©ç”¨è¿™ä¸ªè¡Œä¸ºç»„åˆï¼Œæˆ‘å¯ä»¥å®šä¹‰ä¸€ä¸ªè¡Œä¸ºé›†åˆï¼Œå¹¶*å°†*å®ƒä»¬é™„åŠ åˆ°ä¸åŒçš„æ—§èˆ¹ä¸Šï¼Œå°±åƒè¿™æ ·:

```
// some code...
if (this.elderType === ElderType.Sentry) {
  // patrol around target following an orbit of 200
  // (it'll be a planet setup later on)
  composeBehavior(elder, PatrolAroundTarget(PatrolType.Orbit, /* orbit */ 200))

  // if the player's ship comes near (<300) follow it steady
  composeBehavior(elder, FollowSteadyBehavior(this.ship, 300))

  // if the player's ship is near (<300) shoot at it
  composeBehavior(elder, Shoot(scene, this.ship))
}
// more code... 
```

è¿™å¾ˆå¥½ï¼Œå› ä¸ºå®ƒèŠ‚çœäº† Kb çš„ï¼Œå®ƒå…è®¸æˆ‘éšæ„é…ç½®å’Œé™„åŠ è¡Œä¸ºï¼Œå¯¹é•¿è€…ï¼Œåœ¨æœªæ¥ï¼Œä¹Ÿè®¸å…¶ä»–äººå·¥æ™ºèƒ½æ§åˆ¶çš„æ´¾ç³»ã€‚

### [](#pixel-art)åƒç´ è‰ºæœ¯

æˆ‘çƒ­çˆ±åƒç´ è‰ºæœ¯ï¼Œä½†æˆ‘åªæ˜¯ä¸€ä¸ªå®Œå…¨çš„ä¸šä½™åƒç´ è‰ºæœ¯å®¶ã€‚å¯¹äºè¿™ä¸ªæ¸¸æˆï¼Œæˆ‘æƒ³è‡³å°‘æœ‰ä¸€ä¸ªæ‰‹å·¥åˆ¶ä½œçš„çœ‹èµ·æ¥å¾ˆé…·çš„é£èˆ¹ã€‚ä¸ºäº†å¾—åˆ°ä¸€ä¸ªæ¼‚äº®çš„ç²¾çµæ•ˆæœï¼Œæˆ‘é€‰æ‹©äº† 32x32 åƒç´ çš„ç²¾çµå’Œæœ‰é™çš„è°ƒè‰²æ¿ã€‚æˆ‘ä½¿ç”¨äº† [Piskel](https://www.piskelapp.com) ï¼Œè¿™æ˜¯ä¸€ä¸ª**éå¸¸**å¥½çš„åŸºäºç½‘ç»œçš„åº”ç”¨ç¨‹åºï¼Œç”¨äºåˆ›å»ºåƒç´ è‰ºæœ¯ã€‚ä¸‹é¢ä½ å¯ä»¥çœ‹åˆ°æˆ‘åˆ¶ä½œçš„ä¸åŒèˆ¹åªå’Œ Piskel ç¼–è¾‘å™¨æœ¬èº«çš„ä¸€äº›ä¾‹å­:

[![Different versions of pixel art for the red ship](../Images/d16557dbe35829617e7d770fb30f617c.png "Different Versions of the Red Ship")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--D3c1UYmb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.barbarianmeetscoding.com/images/js13k-games-pixelart-redship-versions.jpg)

[![Red ship in Piskel Editor](../Images/b80c218ca52696c61aeb259abfea0bce.png "Red ship in Piskel Editor")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--30ygFuTz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.barbarianmeetscoding.com/images/js13k-games-pixelart-redship-piskel-editor.jpg)

[![Green ship in Piskel Editor](../Images/582e7b0838113104ca318a8485c9323d.png "Green ship in Piskel Editor")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s---CCHz753--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.barbarianmeetscoding.com/images/js13k-games-pixelart-greenship-piskel-editor.jpg)

[![Blue ship in Piskel Editor](../Images/150a61f831f493c754794a0ef8bc692d.png "Blue ship in Piskel Editor")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--az4NOhYw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.barbarianmeetscoding.com/images/js13k-games-pixelart-blueship-piskel-editor.jpg)

### [](#music)éŸ³ä¹

éŸ³ä¹æ˜¯æ¸¸æˆä¸­éå¸¸é‡è¦çš„æˆåˆ†ã€‚å®ƒå¸®åŠ©ä½ ä½¿ä½ çš„æ¸¸æˆæ›´åŠ èº«ä¸´å…¶å¢ƒï¼Œå‘ç©å®¶æä¾›åé¦ˆï¼Œè®¾ç½®åˆé€‚çš„æ°”æ°›å¹¶å¼•å‘æƒ…ç»ª(å…´å¥‹ã€ææƒ§ã€ç´§å¼ ã€å¹³é™ç­‰)...).æœ‰äº† 13Kb çš„é™åˆ¶ï¼Œæˆ‘ç«‹åˆ»æƒ³åˆ°äº†ç”Ÿæ®–éŸ³ä¹(æˆ‘åœ¨æˆ‘çš„ twitter feed ä¸­å¬åˆ°äº†å¾ˆå¤š)å’Œä½¿ç”¨[ç½‘ç»œéŸ³é¢‘ API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API) ã€‚æˆ‘é‡åˆ°äº†ä¸¤ä¸ªéšœç¢:

*   æˆ‘å¯¹éŸ³ä¹ä¸€ç‚¹æ¦‚å¿µéƒ½æ²¡æœ‰ï¼Œæ— è®ºæ˜¯å“ªç§å½¢å¼
*   æˆ‘å¯¹ç½‘ç»œéŸ³é¢‘ API çš„å·¥ä½œæ–¹å¼ä¸€æ— æ‰€çŸ¥

åœ¨æ¸¸æˆçš„å…¶ä»–éƒ¨åˆ†ï¼Œæˆ‘æ»¡è¶³äºè„±ç¦»åŸºæœ¬åŸåˆ™æ€è€ƒå’Œè§£å†³é—®é¢˜ã€‚ç„¶è€Œï¼Œå½“è°ˆåˆ°éŸ³ä¹æ—¶ï¼Œæˆ‘çœŸçš„éœ€è¦ç ”ç©¶ã€é˜…è¯»å’Œå‘ä»–äººå­¦ä¹ ã€‚è¿™æ˜¯æˆ‘åœ¨ç»™æ¸¸æˆæ·»åŠ éŸ³ä¹æ—¶å‘ç°çš„æ— ä»·ä¹‹å®:

*   æ¥è‡ª [@teropa](https://twitter.com/teropa) çš„è¿™äº›å…³äºç½‘ç»œéŸ³é¢‘çš„ç³»åˆ—ç®€ç›´å¤ªæ£’äº†ã€‚ä»–ä»¬å¯¹ç†è§£ç½‘ç»œéŸ³é¢‘ API çš„å·¥ä½œæ–¹å¼ä»¥åŠå¦‚ä½•åˆ©ç”¨å®ƒæ¥åˆ¶ä½œéŸ³ä¹æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚
*   åŒæ ·ä»¤äººæ•¬ç•çš„è¿˜æœ‰ä»–å¯¹ç”Ÿæ®–éŸ³ä¹çš„å®éªŒ(è¿˜æœ‰ T2 çš„æ›´å¤šå®éªŒ)ã€‚è™½ç„¶åœ¨å¼€å‘è¿™ä¸ªæ¸¸æˆçš„æ—¶å€™ï¼Œå®ƒä»¬å¯¹æˆ‘æ¥è¯´å¤ªå…ˆè¿›äº†ï¼Œä½†æ˜¯åœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆé‡Œï¼Œå®ƒä»¬å¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºï¼Œä¹Ÿè®¸æˆ‘èƒ½å¤Ÿåœ¨æœªæ¥çš„æ¸¸æˆå µå¡ä¸­å¸æ”¶è¿™äº›çŸ¥è¯†ã€‚
*   ç”± [@mcfunkypants](https://twitter.com/McFunkypants) ä¸º [procjam](http://www.procjam.com) åšçš„å…³äº[ç¨‹åºéŸ³ä¹ç”Ÿæˆ](http://www.procjam.com/tutorials/en/music/)çš„æ•™ç¨‹ä¹Ÿéå¸¸å¥½ï¼Œç»™äº†æˆ‘å¾ˆå¤šæƒ³æ³•ã€‚
*   æœ€åï¼Œé˜…è¯»äº†[@ kevincentnis](https://twitter.com/kevincennis)[å®ç° TinyMusic](https://medium.com/@kevincennis/how-i-built-tinymusic-js-part-1-5a298d5d79ef) çš„æ—…ç¨‹ï¼Œå¹¶æŸ¥çœ‹äº†[çš„æºä»£ç ](https://github.com/kevincennis/TinyMusic)ï¼Œè¿™æ˜¯ä¸€æ¬¡å¾ˆå¥½çš„å­¦ä¹ ç»å†ï¼Œæ•™ä¼šäº†æˆ‘å¦‚ä½•ä½¿ç”¨ç½‘ç»œéŸ³é¢‘ API åˆ›å»ºéŸ³ç¬¦åºåˆ—ã€‚

æœ€åï¼Œæˆ‘å†™äº†ä¸€ä¸ªå°éŸ³ä¹å¼•æ“ï¼Œä» TinyMusic å’Œ T2 çš„æ–‡ç« ä¸­æ±²å–äº†å¾ˆå¤šçµæ„Ÿã€‚ä¸å¹¸çš„æ˜¯ï¼Œå°±åœ¨æˆ‘æŠŠå®ƒæäº¤ç»™æ¯”èµ›ä¹‹å‰ï¼Œæˆ‘ä¸å¾—ä¸åœ¨æœ€åçš„ 13k-çŒå·«æ—¶é—´é‡ŒæŠŠå®ƒä»æ¸¸æˆä¸­åˆ é™¤ã€‚æˆ‘å”¯ä¸€ä¿ç•™çš„æ˜¯ä¸€ä¸ª[å‡»æ‰“æ•ˆæœ](http://teropa.info/blog/2016/09/20/additive-synthesis.html#beating)æˆ‘è§‰å¾—å’Œæ¸¸æˆçš„æ„Ÿè§‰å¾ˆåŒ¹é…ã€‚å¦‚æœä½ å¯¹æœ¯è¯­*èŠ‚æ‹*ä¸ç†Ÿæ‚‰ï¼Œå°±åƒæˆ‘ä¸€å‘¨å‰ä¸€æ ·ï¼Œå®ƒåŒ…æ‹¬æ··åˆé¢‘ç‡éå¸¸æ¥è¿‘çš„æ³¢ï¼Œè¿™äº›æ³¢åœ¨åŒç›¸æ—¶ç›¸äº’åŠ å¼ºï¼Œåœ¨å¼‚ç›¸æ—¶ç›¸äº’æŠµæ¶ˆï¼Œäº§ç”Ÿä¸æ–­å˜åŒ–çš„å‡†éŸ³ç¬¦ã€‚

```
function Oscillator(ac: AudioContext, freq = 0) {
  let osc = ac.createOscillator()
  osc.frequency.value = freq
  return osc
}

function Gain(ac: AudioContext, gainValue: number) {
  let gain = ac.createGain()
  gain.gain.value = gainValue
  return gain
}

interface Connectable {
  connect(n: AudioNode): void
}
function Beating(
  ac: AudioContext,
  freq1: number,
  freq2: number,
  gainValue: number
) {
  let osc1 = Oscillator(ac, freq1)
  let osc2 = Oscillator(ac, freq2)
  let gain = Gain(ac, gainValue)
  osc1.connect(gain)
  osc2.connect(gain)
  return {
    connect(n: AudioNode) {
      gain.connect(n)
    },
    start(when = 0) {
      osc1.start(when)
      osc2.start(when)
    },
    stop(when = 0) {
      osc1.stop(when)
      osc2.stop(when)
    },
  }
}

function Connect({ to }: { to: AudioNode }, ...nodes: Connectable[]) {
  nodes.forEach(n => n.connect(to))
}

interface MusicTrack {
  start(): void
  stop(): void
}

function GameOpeningMusic(ac: AudioContext): MusicTrack {
  let b1 = Beating(ac, 330, 330.2, 0.5)
  let b2 = Beating(ac, 440, 440.33, 0.5)
  let b3 = Beating(ac, 587, 587.25, 0.5)
  let masterGain = Gain(ac, 0.1)

  Connect({ to: masterGain }, b1, b2, b3)
  masterGain.connect(ac.destination)

  return {
    start() {
      b1.start()
      b2.start()
      b3.start()
    },
    stop() {
      b1.stop()
      b2.stop()
      b3.stop()
    },
  }
}

export interface GameMusic {
  play(track: Track): void
  stop(): void
  currentTrack: MusicTrack
}

export function GameMusic(): GameMusic {
  let ac = new AudioContext()

  return {
    currentTrack: undefined,
    play(track: Track) {
      if (this.currentTrack) {
        this.currentTrack.stop()
      }
      let musicTrack = Tracks[track]
      this.currentTrack = musicTrack(ac)
      this.currentTrack.start()
    },
    stop() {
      this.currentTrack.stop()
    },
  }
} 
```

## [](#conclusion)ç»“è®º

è¿™å¤ªæœ‰è¶£äº†ï¼ï¼ï¼å¦‚æœåœ¨æˆ‘å½»åº•æ¨èä¹‹å‰ä½ è¿˜æ²¡æœ‰åŠ å…¥ä¸€ä¸ªæ¸¸æˆ jamã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯æ‰€æœ‰æ¸¸æˆå¡é¡¿éƒ½åƒ [js13k](http://wwww.js13kgames.com) ä¸€æ ·ã€‚ä½†äº‹å®ä¸Šï¼Œè¿™ä¸€æ¬¡è¶…è¿‡äº†æ•´æ•´ä¸€ä¸ªæœˆçš„æ—¶é—´ï¼Œæˆ‘å¯ä»¥åœ¨è¿™é‡Œå’Œé‚£é‡Œæ‰¾åˆ°æ—¶é—´ï¼Œè€Œä¸ä¼šæ„Ÿåˆ°è¶…çº§åŒ†å¿™ã€‚æ­¤å¤–ï¼Œä½¿ç”¨ JavaScript å’Œå¼€æ”¾ web æŠ€æœ¯ä½¿å…¥é—¨å˜å¾—æ›´åŠ å®¹æ˜“ã€‚ä½ åªéœ€è¦ä¸€ä¸ªç¼–è¾‘å™¨å’Œä¸€ä¸ªæµè§ˆå™¨å°±å¯ä»¥äº†(æˆ–è€…ä½ ç”šè‡³å¯ä»¥ä½¿ç”¨åŸºäºæµè§ˆå™¨çš„ç¼–è¾‘å™¨:D)ã€‚

æˆ‘ä¹Ÿå­¦åˆ°äº†å¾ˆå¤šå…³äºæ¸¸æˆå¼€å‘å’Œç½‘ç»œéŸ³é¢‘ API çš„çŸ¥è¯†ã€‚æˆ‘æœ‰ä¸€å¤§å †ä¸åŒçš„å°çº¿ç´¢ï¼Œæˆ‘å¾ˆæƒ³å…³æ³¨å¹¶ä½“éªŒæ¸¸æˆå¼€å‘ã€ç”Ÿæˆå¼ç¼–ç¨‹ã€éŸ³ä¹å’Œåƒç´ è‰ºæœ¯çš„è®¸å¤šå…¶ä»–æ–¹é¢ã€‚

æ€»çš„æ¥è¯´ï¼Œæˆ‘è§‰å¾—æˆ‘å®Œæˆäº†è¿™æ¬¡æ¯”èµ›çš„ç›®æ ‡ã€‚å¦‚æœæˆ‘èƒ½æ”¹å˜ä¸€ä»¶äº‹ï¼Œæˆ‘å¸Œæœ›èŠ±å¤šä¸€ç‚¹æ—¶é—´å»è®¡åˆ’ï¼Œå¹¶æœ‰ä¸€ä¸ªæ›´æ˜ç¡®çš„ç›®æ ‡ï¼Œé‚£å°±æ˜¯æˆ‘æƒ³å»å“ªé‡Œã€‚è¿™å°†æœ‰åŠ©äºæˆ‘é›†ä¸­ç²¾åŠ›ï¼Œå¹¶æœ€ç»ˆæäº¤ä¸€ä¸ªæ›´å®Œç¾çš„æ¸¸æˆã€‚

æ¥ä¸‹æ¥çš„å‡ å‘¨[æˆ‘ä¼šç»§ç»­æ›´æ–°æ¸¸æˆ](https://www.barbarianmeetscoding.com/js13k-spaceshooter/)å¹¶å°†å®ƒæ‰“ç£¨åˆ°æˆ‘æ»¡æ„çš„æ°´å¹³ã€‚æˆ‘è®¤ä¸ºè¿™å°†æ˜¯æµ‹è¯•æ–°æ¸¸æˆæœºåˆ¶å’Œå®Œå–„é‚£äº›ç”Ÿæˆç®—æ³•çš„å®Œç¾åœºæ‰€ã€‚

è¿˜æœ‰ä½ ï¼ä¿é‡ï¼Œè€ƒè™‘åŠ å…¥ä¸€ä¸ªæ¸¸æˆæœé…±ï¼:D

P.S .ä½ å¯ä»¥åœ¨è¿™é‡Œç©åŸç‰ˆæ¸¸æˆï¼è¯•è¯•çœ‹ï¼Œè®©æˆ‘çŸ¥é“ä½ çš„æƒ³æ³•ï¼:D*