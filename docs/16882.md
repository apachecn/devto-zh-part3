# å†æ¬¡å°è¯•å­¦ä¹ å›´æ£‹â€”â€”è®©æˆ‘ä»¬æ¨¡å—åŒ–å§ï¼

> åŸæ–‡:[https://dev.to/shindakun/attempting-to-learn-go-è®©æˆ‘ä»¬å†æ¬¡æ¨¡å—åŒ–-10cd](https://dev.to/shindakun/attempting-to-learn-go---lets-get-modular---again-10cd)

# [](#lets-get-modular-again)è®©æˆ‘ä»¬å†æ¥çœ‹çœ‹æ¨¡å—åŒ–

åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å‘å¸ƒäº†ç¬¬ä¸€ä¸ªæ¨¡å—ç‰ˆæœ¬çš„[é‚®ä»¶æªæ‰‹](https://github.com/shindakun/mailgunner)å¥—è£…ã€‚è¿™ä¸€æ¬¡ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å‘å¸ƒæ–°ç‰ˆæœ¬éœ€è¦åšäº›ä»€ä¹ˆâ€”â€”æˆ‘ä»¬å°†å¯¹ä»£ç åšä¸€äº›å°çš„è°ƒæ•´ï¼Œæ›´æ–°è‡ªè¿°æ–‡ä»¶ï¼Œç„¶åå‰ªåˆ‡ä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚

* * *

## [](#ditch-httpdefaultclient-sort-of)æ²Ÿ httpã€‚æŸç§ç¨‹åº¦ä¸Šæ˜¯é»˜è®¤å®¢æˆ·ç«¯

ä½¿ç”¨`http.DefaultClient`çš„ä¸€ä¸ªé—®é¢˜æ˜¯å®ƒæ²¡æœ‰è®¾ç½®ä¸€äº›åˆç†çš„é»˜è®¤å€¼ï¼Œå°±åƒå®ƒæ‰€è¯´çš„ï¼Œå®ƒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå‡†ç³»ç»Ÿå®¢æˆ·ç«¯ã€‚å¦‚æœæœ‰äººéœ€è¦ä»£ç†è¯·æ±‚æ€ä¹ˆåŠï¼Ÿè¿˜æ˜¯è®¾ç½®è¶…æ—¶ï¼Ÿç”¨æˆ‘ä»¬ä¹‹å‰çš„æ¨¡å—æ˜¯åšä¸åˆ°çš„ã€‚æ—¢ç„¶æ˜¯è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æƒ³è®©æˆ‘ä»¬çš„æ¨¡å—ä¸ä¾èµ–äºå®ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†å¯¹å®ƒè¿›è¡Œä¸€ç‚¹æ‰©å±•ï¼Œä½¿å®ƒå¯ä»¥ä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬çœŸçš„è‡ªå·±æ”¹å˜äº†`New()`å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œæˆ‘åœ¨è¿™é‡Œåªå±•ç¤ºå®ƒï¼Œå‚è€ƒ[å›è´­](https://github.com/shindakun/mailgunner)æˆ–[ä»¥å‰çš„æ–‡ç« ](https://dev.to/shindakun/attempting-to-learn-go---lets-get-modular-390i)æ¥çœ‹å®Œæ•´çš„ä»£ç ã€‚

æˆ‘ä»¬æœ€åˆçš„å‡½æ•°éå¸¸ç®€å•ï¼Œåªæ˜¯è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå­—ç¬¦ä¸²å’Œ`http.DefaultClient`çš„ structã€‚

```
type  MgClient  struct  {  MgAPIURL  string  MgAPIKey  string  Client  *http.Client  }  func  New(apiurl,  apikey  string)  MgClient  {  return  MgClient{  apiurl,  apikey,  http.DefaultClient,  }  } 
```

æ­£å¦‚æˆ‘æ‰€è¯´çš„ï¼Œæˆ‘ä»¬ä¸ä¼šæ”¹å˜ç»“æ„æœ¬èº«â€”â€”æˆ‘ä»¬åªæ˜¯ç®€å•åœ°æ›´æ–°`New()`æ¥æ¥å—å¦ä¸€ä¸ªå‚æ•°ã€‚å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œæˆ‘ä»¬ç°åœ¨è¿”å›äº†ä¸€ä¸ªæŒ‡å‘`MgClient`çš„æŒ‡é’ˆï¼Œå®ƒå¯èƒ½åº”è¯¥åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ã€‚ä½†æ˜¯ï¼Œå˜¿ï¼Œæˆ‘ä»¬è¿˜åœ¨å­¦ä¹ ã€‚æˆ‘ä»¬çš„æ–°å‚æ•°è¢«èªæ˜åœ°å‘½åä¸º`client`ï¼Œå®ƒå°†æ¥å—`*http.Client`â€”â€”æˆ‘ä»¬ç¨åå°†è®¨è®ºå¦‚ä½•å®é™…ä½¿ç”¨å®ƒã€‚

```
func  New(apiurl,  apikey  string,  client  *http.Client)  *MgClient  {  if  client  ==  nil  {  client  =  http.DefaultClient  }  return  &MgClient{  apiurl,  apikey,  client,  }  } 
```

å¦‚æœä½¿ç”¨è¯¥æ¨¡å—çš„äººæ‹’ç»åˆ›å»ºè‡ªå®šä¹‰å®¢æˆ·ç«¯å¹¶é€šè¿‡äº†`nil`ï¼Œæˆ‘ä»¬å°†è¿”å›ä½¿ç”¨`http.DefaultClient`ã€‚

```
 mgc  :=  mailgunner.New(apiurl,  mgKey,  nil) 
```

### [](#custom-client)è‡ªå®šä¹‰å®¢æˆ·ç«¯

å¥½çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•åˆ©ç”¨å®šåˆ¶å®¢æˆ·ç«¯å‘¢ï¼Ÿå…¶å®æŒºç®€å•çš„ï¼åœ¨è°ƒç”¨`New()`ä¹‹å‰ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸º`cc`çš„æ–°å˜é‡ï¼Œå¹¶ç»™å®ƒ`&http.Client{}`ä¸€ä¸ª 10 ç§’çš„è¶…æ—¶ã€‚

```
 cc  :=  &http.Client{  Timeout:  time.Second  *  10,  } 
```

æœ‰äº†è¿™ä¸ªæ¼‚äº®çš„å®šåˆ¶å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒä½œä¸ºæ–°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™`New()`ã€‚

```
 mgc  :=  mailgunner.New(apiurl,  mgKey,  cc) 
```

å…¶ä»–ä¸€åˆ‡éƒ½åƒä»¥å‰ä¸€æ ·å·¥ä½œã€‚ğŸ‰

### [](#lets-go-v2)èµ°å§ v2

æˆ‘ä»¬è¿˜æ²¡æœ‰å‡†å¤‡å¥½å‘å¸ƒæˆ‘ä»¬çš„æ–°æ¨¡å—ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»æ›´æ–°è‡ªè¿°æ–‡ä»¶ï¼Œä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘ä¸ä¼šåœ¨è¿™é‡Œè½¬è´´ã€‚ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°æˆ‘ä»¬çš„`go.mod`æ–‡ä»¶æ¥è¡¨æ˜æˆ‘ä»¬å¤„äºæ–°çš„ç‰ˆæœ¬ã€‚æˆ‘å·²ç»å†³å®šè¿™æ˜¯ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æ”¹å˜äº†`New()`å‡½æ•°çš„ç­¾åã€‚æ–°çš„`go.mod`åªæ˜¯åœ¨åé¢åŠ ä¸Šäº†â€œv2â€ã€‚

```
module github.com/shindakun/mailgunner/v2 
```

æˆ‘ä»¬å°†è¿è¡Œ Git å‘½ä»¤ï¼Œå°†æ‰€æœ‰å†…å®¹æ¨é€åˆ° Githubã€‚æˆ‘ä»¬å°†ä»åˆ›å»ºä¸€ä¸ª v2 åˆ†æ”¯å¼€å§‹(æ‚¨å¯èƒ½ä¼šåœ¨å¼€å§‹è¿›è¡Œä»£ç æ›´æ”¹ä¹‹å‰åˆ›å»ºè¿™ä¸ªåˆ†æ”¯ï¼Œä¸è¿‡æˆ‘ä¸æ˜¯ç¢°å·§åˆ›å»ºçš„)ï¼Œæ·»åŠ æˆ‘ä»¬çš„æ›´æ”¹ï¼Œç„¶åå°†è¿™äº›æ›´æ”¹æäº¤åˆ°é‚£ä¸ªåˆ†æ”¯ã€‚

```
git checkout -b v2
git add .
git commit -m "Updated New() to take http.Client so we don't have to rely on http.DefaultClient" 
```

åˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡é¡ºåˆ©ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„åˆ†æ”¯æ¨åˆ°é¥æ§å™¨ä¸Šï¼Œç„¶åæ ‡è®°å¹¶æ¨é€æ ‡è®°ã€‚

```
git push --set-upstream origin v2
git tag v2.0.0
git push --tags origin v2 
```

ç°åœ¨ï¼Œä»»ä½•äººéƒ½å¯ä»¥ç®€å•åœ°å¯¼å…¥å¸¦æœ‰`/v2`çš„æ¨¡å—ï¼Œç„¶åè¿è¡Œ`go build`å°±å¯ä»¥å¼€å§‹å·¥ä½œäº†ï¼

```
âœ  GO111MODULE=on go build -v
github.com/shindakun/mailgunner/v2
github.com/shindakun/mailgunner/v2/example 
```

## ![GitHub logo](../Images/375dfcc32199b4dedf2b526645c27ff7.png) [è¾›è¾¾å¤](https://github.com/shindakun) / [é‚®æªæ‰‹](https://github.com/shindakun/mailgunner)

### Go ä¸­ä¸€ä¸ªè¶…çº§ç®€å•çš„åªå‘é€é‚®ä»¶çš„å®¢æˆ·ç«¯å®ç°ã€‚

<article class="markdown-body entry-content p-5" itemprop="text">

# å°¾éƒ¨ç‚®æ‰‹

Go ä¸­ä¸€ä¸ªè¶…çº§ç®€å•çš„åªå‘é€çš„ [Mailgun](https://www.mailgun.com/) å®¢æˆ·ç«¯çš„å®ç°ã€‚

## è£…ç½®

ç”¨ä½œæ¨¡å—ï¼Œå¯¼å…¥`github.com/shindakun/mailgunner/v2`ï¼Œç„¶åè¿è¡Œ

```
go mod init module
go build
```

å¦‚æœä½ æ˜¯æ¨¡å—æ–°æ‰‹ï¼Œè¯·æŸ¥çœ‹æˆ‘åœ¨ [Dev.to ä¸Šçš„å¸–å­ï¼Œäº†è§£æ›´å¤šç»†èŠ‚](https://dev.to/shindakun/attempting-to-learn-go---lets-get-modular-390i)ã€‚

```
go get github.com/shindakun/mailgunner
```

## ä½¿ç”¨

æœ‰å…³ä½¿ç”¨ç¤ºä¾‹ï¼Œè¯·å‚è§ [example/main.go](https://raw.githubusercontent.com/shindakun/mailgunner/master/./example/main.go) ã€‚

## æ›´æ”¹æ—¥å¿—

*   æ›´æ–°äº†`New()`èµ° httpã€‚å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¿…ä¾èµ–`http.DefaultClient`

</article>

[View on GitHub](https://github.com/shindakun/mailgunner)

* * *

## [](#next-time)ä¸‹æ¬¡

æˆ‘ä»åœ¨è€ƒè™‘æ•´ç†ä¸€ç³»åˆ—çš„å¸–å­ï¼Œå‘Šè¯‰å¤§å®¶æˆ‘æƒ³å¦‚ä½•åœ¨æˆ‘è‡ªå·±çš„é¢†åŸŸä¸Šå»ºç«‹ä¸€ä¸ªâ€œå¼€å‘åšå®¢â€ã€‚æˆ‘åªéœ€è¦å†³å®šæˆ‘æƒ³å¦‚ä½•è§£å†³å®ƒã€‚

åœ¨é‚£ä¹‹å‰...

* * *

ä½ å¯ä»¥åœ¨ GitHub ä¸Šçš„ repo ä¸­æ‰¾åˆ°è¿™ä¸ªå’Œå¤§å¤šæ•°å…¶ä»–è¯•å›¾å­¦ä¹ å›´æ£‹çš„å¸–å­çš„ä»£ç ã€‚

## ![GitHub logo](../Images/375dfcc32199b4dedf2b526645c27ff7.png) [ã€æ–°è¾¾æ˜†ã€‘](https://github.com/shindakun) / [ atlg](https://github.com/shindakun/atlg)

### æˆ‘åœ¨ dev.to ä¸Šå‘å¸ƒçš„â€œå°è¯•å­¦ä¹ å›´æ£‹â€å¸–å­çš„æ¥æºæŠ¥å‘Š

<article class="markdown-body entry-content p-5" itemprop="text">

# å°è¯•å­¦ä¹ å›´æ£‹

åœ¨è¿™é‡Œä½ å¯ä»¥æ‰¾åˆ°æˆ‘ä¸ºå°è¯•å­¦ä¹ å›´æ£‹è€Œå†™çš„ä»£ç ï¼Œè¿™äº›ä»£ç æ˜¯æˆ‘åœ¨ [Dev.to](https://dev.to/shindakun) ä¸Šå†™çš„ã€‚

## å¸–å­ç´¢å¼•

| é‚®æ”¿ | å¯†ç  |
| --- | --- |
| [åˆ¶ä½œä¸‹è½½å™¨ç¬¬ 01 éƒ¨åˆ†](https://dev.to/shindakun/attempting-to-learn-go---building-a-downloader-part-01-44gl) | - |
| [åˆ¶ä½œä¸‹è½½å™¨ç¬¬ 02 éƒ¨åˆ†](https://dev.to/shindakun/attempting-to-learn-go---building-a-downloader-part-02-2k7i) | - |
| [åˆ¶ä½œä¸‹è½½å™¨ç¬¬ 03 éƒ¨åˆ†](https://dev.to/shindakun/attempting-to-learn-go---building-a-downloader-part-03-2214) | - |
| [åˆ¶ä½œä¸‹è½½å™¨ç¬¬ 4 éƒ¨åˆ†](https://dev.to/shindakun/attempting-to-learn-go---building-a-downloader-part-04-3ln9) | - |
| [å»ºé€ ä¸‹è½½å™¨ç¬¬ 05 éƒ¨åˆ†](https://dev.to/shindakun/attempting-to-learn-go---building-a-downloader-part-05-44o) | - |
| [ä½¿ç”¨ REST API](https://dev.to/shindakun/attempting-to-learn-go---consuming-a-rest-api-5c7g) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-api-01/main.go) |
| [ç»§ç»­ä¼‘æ¯å†’é™©](https://dev.to/shindakun/attempting-to-learn-go---continuing-rest-adventures-2l4l) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-api-02/main.go) |
| [ç°åœ¨å‘é€ä¼‘æ¯è¯·æ±‚](https://dev.to/shindakun/attempting-to-learn-go---now-sending-rest-requests-akp) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-api-03/main.go) |
| [REST API å’Œæ¨¡æ¿ä¸Šçš„ä½](https://dev.to/shindakun/attempting-to-learn-go---rest-api-and-a-bit-on-templates-4kca) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-api-04/main.go) |
| [å†æ¬¡é€šè¿‡ API å‘é€ç”µå­é‚®ä»¶](https://dev.to/shindakun/attempting-to-learn-go---sending-email-via-api-again-2e4e) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-api-05/main.go) |
| [è®©æˆ‘ä»¬æ¨¡å—åŒ–å§ï¼](https://dev.to/shindakun/attempting-to-learn-go---lets-get-modular-390i) | [src](https://github.com/shindakun/mailgunner) |
| [è®©æˆ‘ä»¬å†ä¸€æ¬¡æ¨¡å—åŒ–ï¼](https://dev.to/shindakun/attempting-to-learn-go---lets-get-modular---again-10cd) | [src](https://github.com/shindakun/mailgunner) |
| [æ„å»ºå¼€å‘æ—¥å¿—ç¬¬ 1 éƒ¨åˆ†](https://dev.to/shindakun/attempting-to-learn-go---building-dev-log-part-01-1c3m) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-devsite-01/main.go) |
| [æ„å»ºå¼€å‘æ—¥å¿—ç¬¬ 2 éƒ¨åˆ†](https://dev.to/shindakun/attempting-to-learn-go---building-dev-log-part-02-179c) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-devsite-02/main.go) |
| [æ„å»ºå¼€å‘æ—¥å¿—ç¬¬ 3 éƒ¨åˆ†](https://dev.to/shindakun/attempting-to-learn-go---building-dev-log-part-03-7lk) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-devsite-03/main.go) |
| [æ„å»ºå¼€å‘æ—¥å¿—ç¬¬ 4 éƒ¨åˆ†](https://dev.to/shindakun/attempting-to-learn-go---building-dev-log-part-04-2bok) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-devsite-04/main.go) |
| [æ„å»ºå¼€å‘æ—¥å¿—ç¬¬ 5 éƒ¨åˆ†](https://dev.to/shindakun/attempting-to-learn-go---building-dev-log-part-05-4mo1) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-devsite-05/main.go) |
| [æŒ‰æ‰©å±•å 01 åˆ—å‡ºæ–‡ä»¶](https://dev.to/shindakun/attempting-to-learn-go---listing-files-by-extension-1n10) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-sort-01/main.go) |
| [æŒ‰æ‰©å±•å 02 åˆ—å‡ºæ–‡ä»¶](https://dev.to/shindakun/attempting-to-learn-go---sorting-and-moving-files-by-extension-227j) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-sort-01/main.go) |
| [å¼€å‘è‡³ API 01](https://dev.to/shindakun/interacting-with-the-devto-article-api-4g34) | [src](https://raw.githubusercontent.com/shindakun/atlg/master//go-devtoapi-01/main.go) |
| [å¼€å‘è‡³ API 02](https://dev.to/shindakun/interacting-with-the-devto-article-api---again-sort-of-2o8g) | å‚è§ä¸Šé¢çš„ä»£ç  |

</article>

[View on GitHub](https://github.com/shindakun/atlg)

* * *

| å–œæ¬¢è¿™ç¯‡æ–‡ç« å—ï¼Ÿ |
| --- |
| ç»™æˆ‘ä¹°æ¯å’–å•¡æ€ä¹ˆæ ·ï¼Ÿ |

* * *