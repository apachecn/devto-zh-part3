# å¾ªç¯è¿ç»­éƒ¨ç½²-ç¬¬ 1 éƒ¨åˆ†

> åŸæ–‡:# t0]https://dev . to/jeansmaug/dploizione-continu-with-circus-part-1-208n

æˆ‘å»ºè®®æ‚¨ä»¥ [Condorcet](https://github.com/jean-smaug/condorcet) ä¸ºä¾‹ï¼Œè¿›è¡ŒæŒç»­éƒ¨ç½²ã€‚
ç›®çš„æ˜¯é€šè¿‡å…·ä½“æ¡ˆä¾‹ä»‹ç»å¾ªç¯ä¸­å›ºæœ‰çš„ä¸åŒæ¦‚å¿µã€‚
åœ¨ç¬¬ä¸€éƒ¨åˆ†å°†å»ºç«‹åŠŸèƒ½è§£å†³æ–¹æ¡ˆï¼Œåœ¨ç¬¬äºŒéƒ¨åˆ†è¿›è¡Œä¼˜åŒ–ã€‚

## [](#lapplication)L 'åº”ç”¨

è¯¥åº”ç”¨ç¨‹åºé‡‡ç”¨[view . js](https://vuejs.org/)è¿›è¡Œï¼Œä½¿ç”¨ [Firebase](https://firebase.google.com/) è¿›è¡Œç”¨æˆ·ç®¡ç†å’Œæ•°æ®å­˜å‚¨ã€‚æˆ‘ä»¬è¿˜å°†ä½¿ç”¨ Firebase æ‰˜ç®¡åº”ç”¨ç¨‹åºã€‚

. json åŒ…è„šæœ¬:

```
"scripts":  {  "serve":  "vue-cli-service serve",  "build":  "vue-cli-service build",  "lint":  "vue-cli-service lint",  "test:unit":  "vue-cli-service test:unit"  } 
```

*   `serve`å¯åŠ¨å¼€å‘æœåŠ¡å™¨
*   `build`æ„å»ºç”Ÿäº§çš„é™æ€åº”ç”¨ç¨‹åº
*   `lint`æ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆ eslint å®šä¹‰çš„è§„åˆ™
*   `test:unit`å¯åŠ¨å•å…ƒæµ‹è¯•

åœ¨è¿™äº›è„šæœ¬ä¸­ï¼Œæˆ‘å¸Œæœ›æ¯å½“æˆ‘è¯•å›¾å°†ä»£ç é›†æˆåˆ°`master`ä¸­æ—¶ï¼Œå°±å¯åŠ¨`lint`ã€`test:unit`ã€‚å› ä¸º`master`å¿…é¡»å§‹ç»ˆä¿æŒç¨³å®šğŸ¥ã€‚

ä¸ºäº†é¿å…æ‰‹å·¥åˆ¶ä½œï¼Œæˆ‘ä¼šç”¨å¾ªç¯ã€‚æ¯æ¬¡å‘ Github æäº¤æ—¶ï¼Œæ­¤å·¥å…·éƒ½ä¼šå¯åŠ¨è„šæœ¬ã€‚

## [](#ajouter-circleci-%C3%A0-son-projet)åœ¨å…¶é¡¹ç›®ä¸­åŠ å…¥åœ†å½¢

è¦å‘ä»“åº“æ·»åŠ å¾ªç¯ï¼Œå¿…é¡»å‰å¾€ Github çš„å¸‚åœº:

[![circle-ci-github1](../Images/736bcb7818fd8cc2e125588fed32a8fb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--nJ9adedm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vuibgph281o3zyk5kg4c.png)

å¯¹äºå¼€æ”¾æºä»£ç é¡¹ç›®ï¼Œé™¤éæ‚¨è¦æå–æ”¯ç¥¨ï¼Œå¦åˆ™å¿…é¡»é€‰æ‹©â€œå…è´¹â€é€‰é¡¹:

[![circle-ci-github2](../Images/4b9de45470339c0dffcdc4d0a66776f0.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--FCQtbkew--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/idopy09l6hqs8i3e1n0q.png)

åœ¨éªŒè¯äº† circus å®‰è£…ä¹‹åï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªå…³é”® Github é¡¹ç›®:

[![circle-ci-github3](../Images/0192a86fc299338f80fe7ea8987fd604.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--eCupbO_1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kf29upwnecfsfgr8p6wn.png)

æˆ‘ä»¬è¿›å…¥é¡¹ç›®é¡µé¢:

[![circle-ci-github4](../Images/23e949f34e164a5eaa9f0589bb6a6a13.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--RVZ2e1fF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vp91njjd817wexwx166q.png)

åœ¨æ­¤é¡µé¢ä¸Šï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¦åœ¨å…¶ä¸­æ‰§è¡Œæµ‹è¯•çš„ç¯å¢ƒ:

[![circle-ci-github5](../Images/5fc4322d54d4af0dce845df41c730d95.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--h_b5vVfX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ov3z7i2ku0bwja0eyqnl.png)

ç¬¬ä¸€æ­¥éªŒè¯ï¼Œæˆ‘ä»¬ç»§ç»­é…ç½®ã€‚

## [](#d%C3%A9finition-des-jobs)ä½œä¸šçš„å®šä¹‰

å¾ªç¯ä½œä¸šæ˜¯ä¸€ç³»åˆ—æŒ‡ä»¤ã€‚
å¯¹äºå¼€æºé¡¹ç›®ï¼Œæˆ‘ä»¬æœ€å¤šå¯ä»¥åŒæ—¶è¿è¡Œ 4 ä¸ªä½œä¸šã€‚
å®é™…ä¸Šï¼Œä¸‰ä¸ªè„šæœ¬ä¸­çš„æ¯ä¸€ä¸ªè„šæœ¬éƒ½æœ‰ä¸€ä¸ªä¸“ç”¨çš„ä½œä¸šï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åŒæ—¶å¯åŠ¨ 3 ä¸ªä½œä¸šï¼Œæ¯ä¸ªè„šæœ¬ä¸€ä¸ªã€‚è¿™æ ·ï¼Œæ¯ä¸ªè„šæœ¬éƒ½å°†åœ¨ä¸å½±å“å…¶ä»–è„šæœ¬çš„å­¤ç«‹ç¯å¢ƒä¸­å¯åŠ¨ã€‚

ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä½œä¸šå®šä¹‰çš„å¤–è§‚:

```
build:
  docker:
    - image: circleci/node:11.10.1
  steps:
    - checkout
    - run: yarn install
    - run: yarn build 
```

*   `build`:ä½œä¸šçš„åç§°
*   `docker`:æˆ‘ä»¬å·¥ä½œå°†åœ¨å…¶ä¸­è¿è¡Œçš„ç¯å¢ƒï¼Œè¿™é‡Œåœé 
    *   `image`:dock è¦ä½¿ç”¨çš„å›¾åƒï¼Œè¿™é‡Œæ˜¯ Node.js
*   `steps`æˆ‘ä»¬çš„æŒ‡ç¤ºæ¸…å•
    *   `checkout`ç”¨äºå®šä½åˆ° circleci åˆ›å»ºçš„é¡¹ç›®æ–‡ä»¶å¤¹
    *   `run: yarn install`å®‰è£…ä¾èµ–é¡¹
    *   `run: yarn build`æ„å»ºç”¨äºç”Ÿäº§çš„é™æ€åº”ç”¨ç¨‹åº

æ³¨æ„:shell å‘½ä»¤å‰å¿…é¡»æœ‰ä¸€ä¸ªâ€œ`run:`â€

å¯¹æ¯ä¸ªè„šæœ¬é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œå¾—åˆ°ä»¥ä¸‹ä¸‰ä¸ªä½œä¸šçš„é…ç½®:

```
version: 2.1
jobs:
  build:
    docker:
      - image: circleci/node:11.10.1
    steps:
      - checkout
      - run: yarn install
      - run: yarn build

  lint:
    docker:
      - image: circleci/node:11.10.1
    steps:
      - checkout
      - run: yarn install
      - run: yarn lint

  test:
    docker:
      - image: circleci/node:11.10.1
    steps:
      - checkout
      - run: yarn install
      - run: yarn test:unit

workflows:
  version: 2
  integration:
    jobs:
      - build
      - lint
      - test 
```

*   `version`é…ç½®æ–‡ä»¶ç‰ˆæœ¬ï¼Œå½“å‰ä¸º 2.1
*   `jobs`æˆ‘ä»¬ä¸åŒå·¥ä½œçš„æ¸…å•
*   `workflows`ä¸åŒä½œä¸šçš„æ‰§è¡Œæƒ…æ™¯
    *   `version`å·¥ä½œæµç¨‹ç‰ˆæœ¬ï¼Œç›®å‰ä¸º 2
    *   `integration`:å·¥ä½œæµçš„åç§°
    *   `jobs`è¦æ‰§è¡Œçš„å·¥ä½œæ¸…å•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çš„ä¸‰ä¸ªä½œä¸šå°†å¹¶è¡Œè¿è¡Œ

ç°åœ¨ï¼Œå½“æˆ‘ä»¬åœ¨ Github ä¸Šè¾“å…¥ä»£ç æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æµ‹è¯•çš„çŠ¶æ€ï¼š

[![circle-ci-integration](../Images/319430e3aa4569ea26291a5df8a33501.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--X9Iqg1lV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zkn88tdbxnhjm5pewjtz.png)

ä» Github ä¸Šçš„ Pull Request ä¸­ä¹Ÿå¯ä»¥ç›´æ¥çœ‹åˆ°è¿™ä¸€ç‚¹:

[![cricle-ci-pr](../Images/185e9bbb6e9338b154140caf80db0aab.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--hi4WmCPP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5182d3gq4avt7dx1ck9e.png)

## éƒ¨ç½²

ç°åœ¨é›†æˆå·¥ä½œæ­£å¸¸ï¼Œå½“åˆ†æ”¯â€œ`master`â€ä¸Šå‡ºç°æ–°æäº¤æ—¶ï¼Œè‡ªåŠ¨éƒ¨ç½²æˆ‘ä»¬çš„ä»£ç å°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚æ— è®ºæ˜¯é€šè¿‡æ‹‰å¼è¯·æ±‚è¿˜æ˜¯æ¨å¼(åŠ›ğŸ™„ï¼‰

æˆ‘åœ¨ Firebase åšäº†ä¸€ä¸ªå°å…¬å¯“ä½†è°çŸ¥é“å‘¢ä¹Ÿè®¸æœ‰äº›äººä¼šæ„Ÿå…´è¶£ğŸ¤·â€â™‚ï¸.

è¦é€šè¿‡ CI å°†é™æ€æ–‡ä»¶éƒ¨ç½²åˆ° Firebase æ‰˜ç®¡æœåŠ¡ï¼Œéœ€è¦:

*   ä½¿ç”¨`yarn global add firebase-tools`åœ¨æœ¬åœ°å®‰è£… firbase å·¥å…·ã€‚
*   å‘å°„ä¸€ä¸ª`firebase login:ci`å¾—åˆ°ä¸€ä¸ªä»¤ç‰Œ

æ­¤ä»¤ç‰Œå°†ç”¨äºæˆæƒ CI éƒ¨ç½²åˆ° Firebaseã€‚

è¦æ·»åŠ æ ‡è®°ï¼Œè¯·è½¬è‡³è®¾ç½®:

[![circle-ci-env-variables-2](../Images/666780953e755d39e1a08e2690464d14.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--YwiF0-j9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/76v95hce6smpwnb2219s.png)

å¹¶æ·»åŠ ä»¤ç‰Œä½œä¸ºç¯å¢ƒå˜é‡ï¼Œåœ¨æ­¤å¤„å°†å…¶å‘½åä¸º`FIREBASE_TOKEN`:

[![circle-ci-env-variables](../Images/e39ddf60634a181e5d79ad4499a2ae33.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--oX6JkwCk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/tu1krp4pn7bnrlae2yqr.png)

ç„¶åå¯ä»¥åœ¨æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ä¸­é‡å¤ä½¿ç”¨ç¯å¢ƒå˜é‡:

```
version: 2
jobs:
  ## les autres jobs...

  deploy:
    docker:
      - image: circleci/node:11.10.1
    steps:
      - checkout
      - run: yarn install
      - run: yarn build
      - run: yarn firebase deploy --token "$FIREBASE_TOKEN" --only hosting

workflows:
  version: 2
  integration:
    jobs:
      - build
      - lint
      - test
    - deploy:
          requires:
            - build
            - lint
            - test
          filters:
            branches:
              only: master 
```

åœ¨æ–°å·¥ä½œ:`deploy`ä¸­ï¼Œä½¿ç”¨äº†åˆšæ‰åˆ›å»ºçš„å˜é‡`$FIREBASE_TOKEN`ã€‚
æ¥ä¸‹æ¥åªè¦å°†è¿™é¡¹å·¥ä½œåŠ å…¥æˆ‘ä»¬çš„å·¥ä½œæµç¨‹ï¼Œä¸ºå…¶æ·»åŠ é€‰é¡¹å³å¯:

*   `requires`:è¿è¡Œæ­¤ä½œä¸šå‰å¿…é¡»å®Œæˆçš„ä½œä¸š
*   `filters`ç”¨äºæŒ‡å®šå“ªäº›åˆ†æ”¯ã€æ ‡è®°-æˆ‘...ã€‚æ­¤å·¥ä½œå¿…é¡»æ‰§è¡Œã€‚å°±æˆ‘ä»¬è€Œè¨€ï¼Œåªé™äº`master`åˆ†æ”¯

[![circle-ci-v1](../Images/7f2c08422ebaf611879249ec714dcc8c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Fedkd6BI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/51jtjfpnwys57lyv3f7e.png)

## æ‘˜è¦

ä½œä¸šæ˜¯ä¸€ç³»åˆ—æŒ‡ä»¤ã€‚
å·¥ä½œæµå®šä¹‰äº†å„ç§ä½œä¸šçš„è¿è¡Œæ–¹å¼ã€‚æˆ‘ä»¬çš„ä½œä¸šåªèƒ½åœ¨æŸäº›åˆ†æ”¯ä¸ŠæŒ‰é¡ºåºå¹¶è¡Œè¿è¡Œ-æˆ‘...ã€‚
æ‚¨å¯ä»¥é€è¿‡ UI åŠ å…¥åŒ…å«æœºå¯†èµ„è®¯çš„ç¯å¢ƒå˜æ•°ï¼Œå¹¶åœ¨ç»„æ€ä¸­ä½¿ç”¨è¿™äº›å˜æ•°ä¹‹å‰åŠ ä¸Š`$`ã€‚

## [](#prochaine-%C3%A9tape)ä¸‹ä¸€æ­¥

æˆ‘ä»¬çš„é…ç½®æ˜¯å¯è¡Œçš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ã€‚
åœ¨[ä¸‹é¢çš„æ–‡ç« ](https://maximeblanc.fr/deploiement-continu-avec-circleci-partie-2)ä¸­ï¼Œæˆ‘ä»¬å°†æ”¹è¿›é…ç½®ä»¥èŠ‚çœç”Ÿç—…æ—¶é—´ã€‚ğŸ˜

## [](#liens-utiles)æœ‰ç”¨çš„é“¾æ¥

*   [ç»„æ€æ¡£æ¡ˆå‚è€ƒæ–‡ä»¶](https://circleci.com/docs/2.0/configuration-reference)
*   [é…ç½®å‹è½´](https://github.com/jean-smaug/condorcet/blob/4046a6723fc2c4b6470c79b309683d9f7af9844a/.circleci/config.yml)