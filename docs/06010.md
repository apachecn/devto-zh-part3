# åšå‡ºååº”ã€‚ç‰‡æ®µï¼Œç‹¬ç”Ÿå­å¥³

> åŸæ–‡:[https://dev . to/nicolasamabile/react-fragment-the-only-child-612](https://dev.to/nicolasamabile/react-fragment-the-only-child-612)

è¿™æ˜¯ä¸€ç¯‡å…³äºæˆ‘åœ¨ ReactJS ä¸­æ„å»ºå‘å¯¼ç»„ä»¶æ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜çš„çŸ­æ–‡ã€‚

*   ä½¿ç”¨`React.cloneElement`æ—¶ä¸èƒ½å¼•ç”¨â€œfalsyâ€å­çº§ã€‚
*   `React.Fragment`è¿”å›å•ä¸ªå­ä»£ã€‚

å¼€å§‹æ—¶ï¼Œæˆ‘çš„å‘å¯¼å®ä¾‹çœ‹èµ·æ¥åƒè¿™æ ·:

```
<Wizard>
  <Step1 />
  <Step2 />
  <Step3 />
  <Step4 />
  <Step5 />
</Wizard> 
```

åœ¨å¹•åï¼Œç»„ä»¶å°†åªå‘ˆç°å½“å‰æ­¥éª¤ã€‚

```
render () {
  const { children } = this.props
  const { activeStep } = this.state
  const extraProps = {...} // Some extra info I need on each step.
  return (
    â€¦
    {React.cloneElement(children[activeStep], extraProps)}
    â€¦
  )
} 
```

åŸºäºä¸€äº›ä¸šåŠ¡è§„åˆ™ï¼Œæˆ‘æƒ³éšè—/æ˜¾ç¤ºä¸€äº›æ­¥éª¤ï¼Œæ‰€ä»¥æˆ‘çš„å‘å¯¼å®ä¾‹çœ‹èµ·æ¥åƒè¿™æ ·:

```
renderStep2 () {
  if (conditionForStep2) {
    return <Step2 />
  }
}
render () {
  return ( 
    <Wizard>
      <Step1 />
      {this.renderStep2()}
      <Step3 />
      {conditionForStep4 && <Step4 />}
      <Step5 />
    </Wizard>
  )
} 
```

è¿™äº›è¡¨è¾¾å¼å¯¹äº`Step2`è¯„ä¼°ä¸ºæœªå®šä¹‰ï¼Œå¯¹äº`Step4`è¯„ä¼°ä¸ºå‡ï¼Œå¹¶ä¸”å½“æ‰§è¡Œ`React.cloneElement(children[activeStep], extraProps)`æ—¶ï¼Œè¿™äº›å€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥ç”¨ä½œæœ‰æ•ˆçš„å­ä»£ï¼Œå…¶ä¸­`activeStep`æ˜¯`Step2`æˆ–`Step4`çš„ç´¢å¼•ï¼ŒReact å°†ä¼šæŠ±æ€¨ğŸ˜©æˆ‘çš„æŒ‡æ•°ä¹Ÿä¼šæ˜¯é”™çš„ã€‚
[![React error. Element type is invalid](../Images/19461245ab01b2a4401b0dd2fe59744e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--VgD-pdR1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/rolxf46uxm08o11snwpp.png)

æˆ‘æ²¡æœ‰ç›´æ¥ä½¿ç”¨å­©å­ï¼Œè€Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªåªè¿”å›â€œçœŸå®â€æ­¥éª¤çš„å‡½æ•°:

```
const getChildren = children => children.filter(child => !!child)
And change my Wizard render function to something like this:
render () {
 const { children } = this.props
 const { activeStep } = this.state
 const filteredChildren = getChildren(children)
 return (
   â€¦
   {React.cloneElement(filteredChildren[activeStep], extraProps)}
   â€¦
 )
} 
```

ç¬¬ä¸€ä¸ªé—®é¢˜è§£å†³äº†ğŸ‰

ä¸ºäº†ç®€åŒ–æˆ‘çš„é€»è¾‘ï¼Œæˆ‘æƒ³å°†ä¸€äº›æ­¥éª¤åˆ†ç»„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘éœ€è¦ä½¿ç”¨ç›¸åŒçš„æ¡ä»¶æ¥æ¸²æŸ“`Step3`ã€`Step4`å’Œ`Step5`ï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒä»¬ç»„åˆæˆä¸€ä¸ª`React.Fragment`ã€‚

```
renderMoreSteps () {
  if (condition) {
    return (
      <Fragment>
        <Step3 />
        <Step4 />
        <Step5 />
      </Fragment>
    )
  }
} 
```

æˆ‘çš„å‘å¯¼å®ä¾‹:

```
<Wizard>
  <Step1 />
  <Step2 />
  {this.renderMoreSteps()}
</Wizard> 
```

é—®é¢˜æ˜¯:å°½ç®¡ Fragment æ²¡æœ‰è¢«è¡¨ç¤ºä¸º DOM å…ƒç´ ï¼Œä½†å®ƒè¿”å›çš„æ˜¯å•ä¸ªå­ç»„ä»¶ï¼Œè€Œä¸æ˜¯å•ä¸ªå­ç»„ä»¶ã€‚
è§£å†³æ–¹æ³•:è®©å­©å­å˜å¹³ã€‚

```
import { isFragment } from 'react-is'
const flattenChildren = children => {
  const result = []
  children.map(child => {
    if (isFragment(child)) {
      result.push(â€¦flattenChildren(child.props.children))
    } else {
      result.push(child)
    }
  })
  return result
} 
```

æ›´æ–°äº† getChildren å‡½æ•°:

```
const getChildren = children => flattenChildren(children).filter(child => !!child && !isEmpty(child)) 
```

ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä½¿ç”¨äº† [react-is](https://www.npmjs.com/package/react-is) ï¼Œä½†æ˜¯å®ç°éå¸¸ç®€å•:

```
function isFragment (object) {
  return typeOf(object) === REACT_FRAGMENT_TYPE
}
const REACT_FRAGMENT_TYPE = hasSymbol
  ? Symbol.for('react.fragment')
  : 0xeacb;
const hasSymbol = typeof Symbol === 'function' && Symbol.for; 
```

å¸Œæœ›è¿™æœ‰å¸®åŠ©ï¼æ¬¢è¿æ‰€æœ‰çš„è¯„è®ºã€‚