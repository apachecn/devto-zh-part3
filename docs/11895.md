# åœ¨ Angular ä¸­ä½¿ç”¨ API:åœ¨ç»„ä»¶ä¸­æ˜¾ç¤ºæ•°æ®

> åŸæ–‡:[https://dev . to/florimondmanca/consumpting-API-in-angular-displaying-data-in-components-3b 97](https://dev.to/florimondmanca/consuming-apis-in-angular-displaying-data-in-components-3b97)

æ¬¢è¿å›æ¥ï¼æœ¬æ–‡æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« çš„åç»­:

[![florimondmanca](../Images/122f3b1f9c33dcdad1433bb20f0dab94.png)](/florimondmanca) [## ä½¿ç”¨ Angular ä¸­çš„ APIs æ¨¡å‹é€‚é…å™¨æ¨¡å¼

### å¼—æ´›é‡Œè’™å¾·Â·æ›¼å¡ 9 æœˆ 5 æ—¥ 188 åˆ†é’Ÿé˜…è¯»

#webdev #angular #typescript #devtips](/florimondmanca/consuming-apis-in-angular--the-model-adapter-pattern-3fk5)

å¦‚æœä½ è¿˜æ²¡æœ‰è¯»è¿‡ï¼Œå»çœ‹çœ‹å§ï¼è¿™ç¯‡æ–‡ç« ä¼šç»å¸¸æåˆ°å®ƒã€‚

æœ€è¿‘æˆ‘æ”¶åˆ°äº†æ¥è‡ª[@ç±³å…°ç§‘ç“¦å¥‡](https://dev.to/milankovach)çš„ä¸€ä¸ªé—®é¢˜ï¼Œå…³äºå¦‚ä½•åœ¨ä¸€ä¸ªç»„ä»¶ä¸­ä½¿ç”¨`CourseService`æ¥æ˜¾ç¤ºè¯¾ç¨‹åˆ—è¡¨ã€‚

[![milankovach profile image](../Images/cc041bc60a70b0276bccf64751e31178.png) ](/milankovach) [ Milan Kovac ](/milankovach) â€¢ [<time datetime="2019-02-22T00:53:50Z"> Feb 22 '19 </time>](https://dev.to/milankovach/comment/910k) 

ä½ å¥½ï¼ŒFlorimondï¼Œ
è¿™å¾ˆå¥½ï¼Œä½†æ˜¯ä½ èƒ½æ·»åŠ ç®€çŸ­çš„æè¿°(å¯èƒ½åœ¨è¯„è®ºéƒ¨åˆ†)å¦‚ä½•åœ¨ n00bs çš„å…¶ä»–ç»„ä»¶ä¸­ä½¿ç”¨ä½ çš„æœåŠ¡å—ï¼Ÿè°¢è°¢ï¼:)

è¿™æ­£æ˜¯æˆ‘ä»¬å°†åœ¨è¿™ç¯‡åˆå­¦è€…å‹å¥½çš„æ–‡ç« ä¸­è®¨è®ºçš„å†…å®¹ã€‚

è¿™ç¯‡æ–‡ç« åº”è¯¥å¯¹é‚£äº›æƒ³çŸ¥é“å¦‚ä½•æ£€ç´¢å’Œæ˜¾ç¤ºä»å¤–éƒ¨ API è·å–çš„æ•°æ®çš„äººæœ‰æ‰€å¸®åŠ©ã€‚ğŸ˜Š

## [](#quick-refresher)å¿«é€Ÿå¤ä¹ 

åœ¨æœ€åˆçš„å¸–å­ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Œæˆ‘ç”¨å®ƒæ¥æ ‡å‡†åŒ–æˆ‘çš„ Angular åº”ç”¨ç¨‹åºå¦‚ä½•ä¸ REST APIs é€šä¿¡:æ¨¡å‹é€‚é…å™¨æ¨¡å¼ã€‚

ç»™å®š`GET /courses` API ç«¯ç‚¹ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ª`Course`æ¨¡å‹ã€`CourseAdapter`å’Œ`CourseService`æ¥å¸®åŠ©æˆ‘ä»¬ä» API ä¸­è·å–è¯¾ç¨‹åˆ—è¡¨ã€‚

ç°åœ¨é¡¹ç›®ç»“æ„çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
src/app
â”œâ”€â”€ app.component.css
â”œâ”€â”€ app.component.html
â”œâ”€â”€ app.component.ts
â”œâ”€â”€ app.module.ts
â””â”€â”€ core
    â”œâ”€â”€ course.model.ts
    â””â”€â”€ course.service.ts 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œçš„ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªä½¿ç”¨`CourseService`è·å–è¯¾ç¨‹åˆ—è¡¨çš„`CourseListComponent`ï¼Œå¹¶ä»¥ç®€å•æ— åºåˆ—è¡¨çš„å½¢å¼æ˜¾ç¤ºå®ƒä»¬ã€‚

## [](#lets-build)æˆ‘ä»¬æ¥é€ å§ï¼

### [](#generating-the-raw-courselistcomponent-endraw-)ç”Ÿæˆ`CourseListComponent`

å¥½äº†ï¼Œæˆ‘ä»¬å¼€å§‹å§ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨[è§’åº¦å‘½ä»¤](https://cli.angular.io) :
ç”Ÿæˆç»„ä»¶

```
ng generate component CourseList 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç»„ä»¶çš„ TypeScript (TS)ã€HTML å’Œ CSS æ–‡ä»¶å°†åœ¨`src/app/course-list/`ä¸‹ç”Ÿæˆã€‚ä¸‹é¢æ˜¯ç›®å‰ä¸ºæ­¢ TS æ–‡ä»¶çš„æ ·å­:

```
// course-list/course-list.component.ts
import { Component, OnInit } from '@angular/core';

@Component({
  selector: 'app-course-list',
  templateUrl: './course-list.component.html',
  styleUrls: ['./course-list.component.css']
})
export class CourseListComponent implements OnInit {

  constructor() { }

  ngOnInit() {
  }

} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#setting-up-attributes-and-templates)è®¾ç½®å±æ€§å’Œæ¨¡æ¿

é¦–å…ˆï¼Œè®©æˆ‘ä»¬åœ¨ç»„ä»¶ä¸Šæ·»åŠ ä¸€ä¸ªç©ºçš„è¯¾ç¨‹åˆ—è¡¨:

```
 // course-list/course-list.component.ts
  import { Component, OnInit } from '@angular/core';

  @Component({
    selector: 'app-course-list',
    templateUrl: './course-list.component.html',
    styleUrls: ['./course-list.component.css']
  })
  export class CourseListComponent implements OnInit {

+   courses: Courses[];

-   constructor() { }
+   constructor() {
+     this.courses = [];
+   } 
    ngOnInit() {
    }

} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬è®¾ç½®æ¨¡æ¿ã€‚è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œæˆ‘ä»¬åªæ˜¯ä½¿ç”¨ä¸€ä¸ª [`*ngFor`](https://angular.io/guide/displaying-data#showing-an-array-property-with-ngfor) æ¥æ˜¾ç¤ºæ¯ä¸ªè¯¾ç¨‹çš„åˆ—è¡¨é¡¹ï¼Œå¹¶ä½¿ç”¨ [`DatePipe`](https://angular.io/api/common/DatePipe) æ¥æ ¼å¼åŒ–æ—¥æœŸã€‚

```
<!-- course-list/course-list.component.html -->
<ul>
  <li *ngFor="let course of courses">
    <p>
      {{ course.name }} â€¢ {{ course.code }} â€¢ Created
      {{ course.created | date }}
    </p>
  </li>
</ul> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ›´æ–°`AppComponent`çš„æ¨¡æ¿ä»¥æ˜¾ç¤ºè¯¾ç¨‹åˆ—è¡¨:

```
<!-- app.component.html -->
<h1>Courses</h1>

<app-course-list></app-course-list> 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½å§ï¼è®©æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ï¼Œåº”è¯¥ä¼šçœ‹åˆ°â€œè¯¾ç¨‹â€æ ‡é¢˜å’Œâ€¦â€¦ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚ä¸ºä»€ä¹ˆï¼Ÿå—¯ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰æ‹¿åˆ°ä»»ä½•è¯¾ç¨‹ï¼

### [](#implementing-the-api-endpoint)å®ç° API ç«¯ç‚¹

åœ¨æˆ‘ä»¬æ’å…¥`CourseService`ä¹‹å‰ï¼Œè¯·è®°ä½ç°åœ¨å®ƒæŒ‡çš„æ˜¯`https://api.myapp.com/courses`â€”â€”å¹¶ä¸” API ä¸å­˜åœ¨ï¼

ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šæµ‹è¯•`CourseService`ä¼šå¾ˆå¥½ï¼Œä¸æ˜¯å—ï¼Ÿ

å› æ­¤ï¼Œè®©æˆ‘ä»¬ä¸ºæ­¤æ„å»ºä¸€ä¸ªå¿«é€Ÿåç«¯ APIã€‚æˆ‘å°†ä½¿ç”¨ Python å’Œ [Bocadillo](https://github.com/bocadilloproject/bocadillo) (æ— è€»çš„æ’ä¸€å¥:æˆ‘æ˜¯ Bocadillo çš„ç»´æŠ¤è€…ï¼)æ¥æä¾›æˆ‘ä»¬éœ€è¦ä»æµè§ˆå™¨è®¿é—®çš„`GET /courses`ç«¯ç‚¹ã€‚

ä½ ä¸éœ€è¦äº†è§£ Pythonï¼Œä¹Ÿä¸éœ€è¦ç†è§£ä¸‹é¢çš„ä»£ç ï¼Œä½†æ˜¯æˆ‘åœ¨è¿™é‡Œå±•ç¤ºç»™æ„Ÿå…´è¶£çš„äºº:

```
# app.py
# Install: `pip install bocadillo` from bocadillo import App

app = App(
    enable_cors=True,
    cors_config={"allow_origins": ["*"], "allow_methods": ["*"]},
)

COURSES = [
    {
        "id": 1,
        "code": "adv-maths",
        "name": "Advanced Mathematics",
        "created": "2018-08-14T12:09:45",
    },
    {
        "id": 2,
        "code": "cs1",
        "name": "Computer Science I",
        "created": "2018-06-12T18:34:16",
    },
]

@app.route("/courses")
async def courses_list(req, res):
    res.media = COURSES

if __name__ == "__main__":
    app.run() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æ‚¨æ‰€è§ï¼Œ`GET /courses`ç«¯ç‚¹å°†è¿”å›ä¸€ä¸ªç¡¬ç¼–ç çš„è¯¾ç¨‹åˆ—è¡¨ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`$ python app.py`åœ¨ç»ˆç«¯ä¸­å¯åŠ¨ APIï¼Œå¹¶è®©å®ƒè¿è¡Œã€‚

### [](#integrating-the-api-with-the-raw-courseservice-endraw-)é›†æˆ API ä¸`CourseService`

ä½œä¸ºæœ€åä¸€ä¸ªé›†æˆæ­¥éª¤ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° URLï¼Œ`CourseService`ç”¨æ¥è·å–è¯¾ç¨‹:

```
// core/course.service.ts
// ...

@Injectable({
  providedIn: 'root'
})
export class CourseService {

  private apiUrl = 'http://localhost:8000/courses';

  constructor(
    private http: HttpClient,
    private adapter: CourseAdapter,
  ) { }

  list(): Observable<Course[]> {
    return this.http.get(this.apiUrl).pipe(
      // Adapt each item in the raw data array
      map((data: any[]) => data.map(item => this.adapter.adapt(item))),
    );
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#fetching-courses-with-the-raw-courseservice-endraw-)ç”¨`CourseService`æŠ“å–è¯¾ç¨‹

æˆ‘ä»¬ç°åœ¨å‡†å¤‡å°†`CourseService`æ’å…¥åˆ°`CourseListComponent`ä¸­ï¼

ä¸‹é¢æ˜¯æˆ‘ä»¬å°†é‡‡å–çš„æ­¥éª¤:

1.  **å¯¼å…¥**æœåŠ¡ã€‚
2.  **ä½¿ç”¨ Angular çš„[ä¾èµ–æ³¨å…¥](https://www.angular.io/guide/dependency-injection)åœ¨ç»„ä»¶ä¸­æ³¨å…¥**ã€‚
3.  åœ¨ç»„ä»¶çš„`ngOnInit()`æ–¹æ³•ä¸­ï¼Œè·å–å¯è§‚å¯Ÿåˆ°è¯¾ç¨‹åˆ—è¡¨çš„ [RxJS](https://angular.io/guide/rx-library) ï¼Œå¹¶é€šè¿‡**è®¢é˜…**ã€‚
4.  **å°†è·å–çš„è¯¾ç¨‹åˆ—è¡¨å­˜å‚¨åœ¨ç»„ä»¶ä¸Šï¼Œä»¥ä¾¿åœ¨æ¨¡æ¿ä¸­å‘ˆç°ã€‚**

æƒ³çŸ¥é“å¦‚ä½•ç¿»è¯‘æˆä»£ç ï¼Ÿè¯·çœ‹ä¸‹é¢â€”â€”æˆ‘ä¸ºä¸Šé¢çš„æ¯ä¸ªæ­¥éª¤æ·»åŠ äº†åœ°æ ‡:

```
import { Component, OnInit } from "@angular/core";
import { Course } from "../core/course.model";
// (1) Import
import { CourseService } from "../core/course.service";

@Component({
  selector: "app-course-list",
  templateUrl: "./course-list.component.html",
  styleUrls: ["./course-list.component.css"]
})
export class CourseListComponent implements OnInit {
  courses: Course[];

  // (2) Inject
  constructor(private courseService: CourseService) {
    this.courses = [];
  }

  ngOnInit() {
    // (3) Subscribe
    this.courseService.list().subscribe((courses: Course[]) => {
      // (4) Store
      this.courses = courses;
    });
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#celebrate)åº†ç¥

è¿™å°±å¯¹äº†ã€‚å¦‚æœæˆ‘ä»¬åœ¨`http://localhost:8000`æ‰“å¼€æµè§ˆå™¨ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ç”¨ sexy Times New Roman æ˜¾ç¤ºçš„è¯¾ç¨‹åˆ—è¡¨ã€‚

[![](../Images/b0f704c85a1664757cc8dfa207345778.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--8_UqZGH5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://florimondmanca-personal-website.s3.amazonaws.com/media/markdownx/1e5a9e87-ce68-4825-b972-790fa84d55f5.png) 
é€ å‹ç¡®å®ä¸åœ¨è¿™ç¯‡åšæ–‡çš„è®¨è®ºèŒƒå›´ä¹‹å†…ã€‚

## [](#wrapping-up)åŒ…è£…å®Œæ¯•

å¥½å§ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬åœ¨è¿™é‡Œå–å¾—äº†ä»€ä¹ˆ:

1.  æˆ‘ä»¬ä½¿ç”¨[è§’åº¦å‘½ä»¤](https://cli.angular.io)ç”Ÿæˆäº†`CourseListComponent`ã€‚
2.  æˆ‘ä»¬è®¾ç½®äº†ç»„ä»¶çš„`courses`å±æ€§å’Œå®ƒçš„ã€æ¨¡æ¿ã€‘ã€‚
3.  æˆ‘ä»¬ä½¿ç”¨ Python å’Œ [Bocadillo](https://bocadilloproject.github.io) æ„å»º API ç«¯ç‚¹æ¥æµ‹è¯•æˆ‘ä»¬çš„ç»„ä»¶ã€‚
4.  å½“ç„¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`CourseService`å’Œ [RxJS](https://angular.io/guide/rx-library) æ¥è·å–åˆ—è¡¨ã€‚

äº‹å®ä¸Šï¼Œå½“æˆ‘ä½¿ç”¨ Angular æ„å»º web åº”ç”¨ç¨‹åºæ—¶ï¼Œè¿™å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„å·¥ä½œæµâ€”â€”æˆ‘ä»å‰”é™¤ç»„ä»¶å¼€å§‹ï¼Œç„¶åå®ç°æˆ‘éœ€è¦çš„åç«¯ç«¯ç‚¹ï¼Œå¹¶å°†å®ƒä»¬ä¸æœåŠ¡é›†æˆï¼Œæœ€ç»ˆæ˜¾ç¤ºæ•°æ®ã€‚

å¦‚æœä½ å¯¹ä»£ç æ„Ÿå…´è¶£ï¼Œæˆ‘æŠŠå®ƒä¸Šä¼ åˆ°äº† GitHub repo: [ng-courses](https://github.com/florimondmanca/ng-courses) ã€‚

## [](#stay-in-touch)ä¿æŒè”ç³»ï¼

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥åœ¨ Twitter ä¸Šæ‰¾åˆ°æˆ‘ï¼Œè·å–æ›´æ–°ã€å…¬å‘Šå’Œæ–°é—»ã€‚ğŸ¤