# ç½‘ç»œä¸­çš„åœ°é“æ†æ‰æœº

> åŸæ–‡:[https://dev.to/sasurau4/metro-bundler-in-web-1385](https://dev.to/sasurau4/metro-bundler-in-web-1385)

## [T1ã€‘ç®€ä»‹](#intro)

ä½ çŸ¥é“éº¦å¾·é¾™Â·é‚¦å¾·å‹’å—ï¼Ÿå¦‚æœä½ ä½¿ç”¨ React Nativeï¼Œä½ ä¼šå¾ˆç†Ÿæ‚‰å®ƒã€‚
Metro Bundler æ˜¯ React Native çš„ JavaScript bundlerã€‚
å‡ ä¸ªæœˆå‰ï¼Œæˆ‘å‘ç°äº†ä¸€æ¡å…³äº Metro Bundler çš„ä»¤äººæƒŠè®¶çš„äº‹æƒ…çš„æ¨æ–‡ã€‚

> ![](../Images/f0effb829a865dd209de81797293a7ba.png)![](../Images/2eb71326af8add7772f61b476b1655d6.png)æ–‡æ£®ç‰¹Â·é‡Œé»˜å°”@ vincentrimer![](../Images/4d9c44713c216584b3d48ff3455cbb68.png)æˆ‘å‘ç°äº† [@cpojer](https://twitter.com/cpojer)
> 
> çœ‹èµ·æ¥ç½‘ç»œä¸Šçš„ Instagram æ­£åœ¨è¢« [@MetroBundler](https://twitter.com/MetroBundler) æ†ç»‘ï¼2019 å¹´ 1 æœˆ 25 æ—¥ä¸Šåˆ 02:44[![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1088628642970783744)[![Twitter retweet action](../Images/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1088628642970783744)9[![Twitter like action](../Images/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1088628642970783744)33

> ![](../Images/0bc586c49e14365411b4b44add12c617.png)å…‹é‡Œæ–¯æ‰˜å¤«Â·ä¸­æ³½å‹ç§€@ CPO jer![](../Images/4d9c44713c216584b3d48ff3455cbb68.png)[@ vincentrimer](https://twitter.com/vincentriemer)[@ metro bundler](https://twitter.com/MetroBundler)å·¨å¤§å¦‚æœçœŸçš„è¯ã€‚08:12am-2019 å¹´ 1 æœˆ 25 æ—¥[![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1088711186424758272)[![Twitter retweet action](../Images/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1088711186424758272)0[![Twitter like action](../Images/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1088711186424758272)13

> ![](../Images/db21c9ada501983816cc75be7562c75c.png)æ ¼ä¼¦Â·åº·çº³@ Mr _ sharpoblunto![](../Images/4d9c44713c216584b3d48ff3455cbb68.png)[@ CPO jer](https://twitter.com/cpojer)[@ vincentrimer](https://twitter.com/vincentriemer)[@ metro bundler](https://twitter.com/MetroBundler)The secrets out:)ä¸‹åˆ 15:46-2019 å¹´ 1 æœˆ 25 æ—¥[![Twitter reply action](../Images/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1088825340829421569)[![Twitter retweet action](../Images/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1088825340829421569)0

å“ˆå“ˆå“ˆï¼Œæˆ‘ç®€ç›´ä¸æ•¢ç›¸ä¿¡ï¼
å› ä¸º[æ–‡æ¡£](https://facebook.github.io/metro/)é¡¶éƒ¨å†™ç€â€œReact Native çš„ JavaScript Bundler *â€ã€‚
ä½†æ˜¯ä¸­æ³½å‹ç§€å¥³å£«å’Œåº·çº³å…ˆç”Ÿæ˜¯è„¸ä¹¦å›¢é˜Ÿçš„æˆå‘˜ï¼Œè€Œåº·çº³å…ˆç”Ÿæ˜¯ Instagram ç½‘ç«™åŸºé‡‘ä¼šçš„æŠ€æœ¯ä¸»ç®¡ã€‚å› æ­¤ï¼Œæˆ‘æ£€æŸ¥äº† Instagram æ˜¯å¦ä½¿ç”¨ metro bundler è¿›è¡Œ webã€‚*

## [](#checking)æ£€æŸ¥

Metro Bundler æœ‰[å…³äºä½¿ç”¨ CLI](https://facebook.github.io/metro/docs/en/cli) çš„æ–‡æ¡£ï¼Œæ‰€ä»¥æˆ‘æ†ç»‘äº†ä¸€äº› JavaScript æ–‡ä»¶ï¼Œå¹¶ä¸ web çš„æ†ç»‘æ–‡ä»¶è¿›è¡Œæ¯”è¾ƒã€‚
æˆ‘å‘ç°äº†ç±»ä¼¼`__BUNDLE_START_TIME__=this.nativePerformanceNow?nativePerformanceNow():Date.now()`çš„å…±åŒç‚¹ã€‚åœ¨ Chrome çš„å¼€å‘è€…å·¥å…·æ§åˆ¶å°è¾“å…¥`window._sharedData`ï¼Œä½ ä¼šå‘ç°`bundle_variant: "metro"`ä¼¼ä¹æ˜¯æ†ç»‘é…ç½®ã€‚

æˆ‘ç¡®è®¤äº† Instagram å°† Metro Bundler ç”¨äº Webã€‚æˆ‘å¾ˆå¥½å¥‡æ˜¯æ€ä¹ˆåšåˆ°çš„ã€‚è®©æˆ‘ä»¬æ¥è¯•è¯•å§ï¼

## [](#using-metro-bundler-in-web)åœ¨ Web ä¸­ä½¿ç”¨ Metro Bundlerï¼

å›è´­:[https://github.com/sasurau4/sample-metro-bundler-in-web](https://github.com/sasurau4/sample-metro-bundler-in-web)

æˆ‘è§£é‡Šå¦‚ä½•åœ¨ Web ä¸­ä½¿ç”¨ Metro Bundlerã€‚

æ ¹æ®æ–‡æ¡£çš„[ï¼ŒMetro Bundler æä¾›å…¶ä½œä¸º CLIã€æœåŠ¡å™¨æœ¬èº«å’Œ express ä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚](https://facebook.github.io/metro/docs/en/getting-started.html)

æ‰€ä»¥ï¼Œæˆ‘é€‰æ‹©äº† express ä¸­é—´ä»¶ï¼ŒæœåŠ¡å™¨ç´§éšå…¶åã€‚

```
const Metro = require('metro');
const express = require('express');
const app = express();

Metro.loadConfig().then(async config => {
  const metroBundlerServer = await Metro.runMetro(config);
  app.use(metroBundlerServer.processRequest.bind(metroBundlerServer));

  app.use('/', express.static('public'));

  const { server: serverConfig } = config;
  const { port } = serverConfig;
  app.listen(port);
}); 
```

è¯¥æœåŠ¡å™¨æä¾›`public`ç›®å½•ä¸­çš„é™æ€æ–‡ä»¶å’Œ Metro æ†ç»‘çš„æ†ç»‘æ–‡ä»¶ã€‚

é™æ€æ–‡ä»¶å¦‚ä¸‹ã€‚

```
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Metro Bundler in Web!</title>
  </head>
  <body>
    <div id="root"></div>
    <script src="index.bundle?platform=web&dev=true&minify=false"></script>
  </body>
</html> 
```

æˆ‘ä»¬å¯ä»¥ä»è·¯å¾„`index.bundle`ä¸­è·å¾—å¸¦æœ‰å„ç§å‚æ•°çš„åŒ…æ–‡ä»¶ã€‚

å¦‚æœä½ æƒ³åªæ†ç»‘æ–‡ä»¶ï¼Œè¿™ä¸€åˆ‡éƒ½å®Œæˆäº†ã€‚

åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ç”¨ babel ä¹‹ç±»çš„ä¸œè¥¿æ¥ä¼ è¾“ JS æ–‡ä»¶ã€‚

é…åˆ Metro ä½¿ç”¨ Babel éå¸¸å®¹æ˜“ã€‚

å¦‚æœä½ æƒ³ä½¿ç”¨ Reactï¼ŒæŠŠ`babel.config.js`åƒä¸‹é¢è¿™æ ·ã€‚

```
module.exports = {
  presets: ['@babel/preset-env', '@babel/preset-react'],
  plugins: ['@babel/plugin-proposal-export-default-from'],
}; 
```

è¿è¡ŒæœåŠ¡å™¨å¹¶è®¿é—®æœ¬åœ°ä¸»æœºï¼Œåº”ç”¨ç¨‹åºåœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼éƒ½å®Œæˆäº†ã€‚ğŸ‰

æˆ‘è§£é‡Šå¦‚ä½•åƒä½¿ç”¨ webpack-dev-server ä¸€æ ·ä½¿ç”¨ Metro Bundlerã€‚å¦‚æœæ‚¨æƒ³å°†å·¥ä»¶éƒ¨ç½²åˆ°æ‰˜ç®¡æœåŠ¡ï¼Œæ‚¨å¯ä»¥ä» cli å®Œæˆï¼

## [](#conclusion)ç»“è®º

è™½ç„¶ Metro Bundler ä¸»è¦é’ˆå¯¹ React Nativeï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶ç”¨äº webã€‚æˆ‘è¿˜å­¦ä¹ äº† webpack å’Œ webpack-dev-server æä¾›çš„åŠŸèƒ½ã€‚
å¦‚ä»Šåœ¨ç”Ÿäº§ä¸­å¾ˆå°‘ä½¿ç”¨ Metro Bundler for webã€‚
æˆ‘æƒ³è±¡å¦‚æœæœ‰ä¸€å¤© Metro Bundler è¢«ç»å¸¸ç”¨äº web æˆä¸ºç°å®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ React Native å’Œ React Native Web ç¼–å†™é€šç”¨çš„åº”ç”¨ç¨‹åºã€‚
ä»¤äººå…´å¥‹çš„æœªæ¥ï¼

æ„Ÿè°¢ Metro å›¢é˜Ÿæä¾›çš„æ–‡æ¡£å’Œç»´æŠ¤ã€‚
æ„Ÿè°¢é˜…è¯»ï¼