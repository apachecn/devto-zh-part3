# ä¸€æ¬¡æ‹¿è¿™ä¹ˆå¤šä¸œè¥¿

> åŸæ–‡:[https://dev . to/aravindballa/fetch-so-much-things-once-5b 34](https://dev.to/aravindballa/fetch-so-many-things-at-once-5b34)

[![0](../Images/7b0685a95ee8063dbe74e74fdca8cb44.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--N6a1xERK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://source.unsplash.com/random/800x600/%3Fnature%2Cfood)

Node ä¸­æœ‰ä¸€ä¸ª`fetch` APIï¼Œå®ƒå…è®¸æˆ‘ä»¬å‘å‡ºä¸€ä¸ª HTTP è¯·æ±‚å¹¶ä»æœåŠ¡å™¨è·å–ä¸€äº›ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è¿›è¡Œ REST è°ƒç”¨ï¼Œè·å–ç½‘é¡µçš„ HTML å†…å®¹(å¦‚æœæˆ‘ä»¬ä½¿ç”¨ node æ¥æŠ“å–çš„è¯)ä»¥åŠæ›´å¤šçš„äº‹æƒ…ã€‚

> æœ¬æ–‡å¯¹ä»»ä½•è¿”å›æ‰¿è¯ºçš„å‡½æ•°éƒ½æœ‰æ•ˆã€‚

è¿™ç§è°ƒç”¨çš„ä¸€ä¸ªä¾‹å­æ˜¯è¿™æ ·çš„

```
fetch('/url')
  .then(res => res.json())
  .then(data => console.log(data)); 
```

# [](#the-async-way)å¼‚æ­¥æ–¹å¼

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ async å’Œ await åšåŒæ ·çš„äº‹æƒ…ã€‚

```
const result = await fetch('/url');
const data = await result.json();

console.log(data);

// Or, a one-liner
// const data = await (await fetch('/url')).json(); ğŸ˜‰ 
```

# æˆ‘æœ‰å¾ˆå¤šä¸œè¥¿è¦æ‹¿ï¼

å¥½å§ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç»å…¸çš„ for å¾ªç¯æ¥å®ç°ã€‚åŒæ­¥æ€§è´¨å°†è¢«ä¿ç•™ã€‚æˆ‘æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ­¥åœ°ä¸€ä¸ªæ¥ä¸€ä¸ªå–ã€‚

```
const urls = [...];
for(const url of urls) {
    const result = await fetch(url);
    const data = await result.json();

    console.log(data);
} 
```

ä½†æ˜¯å¦‚æœé¡ºåºä¸é‡è¦å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æŠŠå®ƒä»¬éƒ½æ‹¿æ¥ã€‚æ˜¯çš„ï¼Œä¸€æ¬¡å®Œæˆï¼Œä½¿ç”¨ Promise APIã€‚æ¯•ç«Ÿï¼Œ`fetch`è¿”å›ä¸€ä¸ªæ‰¿è¯ºï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬`await`è¦è§£å†³å®ƒã€‚

Promise API æœ‰è¿™ä¸ªæ–¹æ³•`Promise.all()`ï¼Œå¯ä»¥ç­‰å¾…å®ƒæ¥å—çš„æ‰€æœ‰æ‰¿è¯ºä½œä¸ºè¦è§£å†³çš„å‚æ•°ã€‚

```
const urls = [...];
const promises = urls.map(url => fetch(url));

await Promise.all(promises);

for (const promise of promises) {
    const data = await promise.json();
    console.log(data);
} 
```

è¿™ä¼šèŠ‚çœæˆ‘ä»¬å¾ˆå¤šæ—¶é—´ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦è§£æå¤§çº¦ 100 ä¸ªç½‘é¡µï¼Œæ¯ä¸ªç½‘é¡µéœ€è¦ 2 ç§’é’Ÿæ¥è·å–å’Œæœé›†æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ã€‚å¦‚æœæˆ‘ä»¬ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è·å–å®ƒï¼Œå¤§çº¦éœ€è¦ 200 ç§’ï¼Œä¹Ÿå°±æ˜¯ 3 åˆ†å¤šé’Ÿã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸€æ¬¡å…¨éƒ¨å–å›æ¥ï¼Œä¸åˆ°ä¸€åˆ†é’Ÿå°±å¯ä»¥äº†ã€‚

# [](#like-really-so-many)å–œæ¬¢çš„ï¼ŒçœŸçš„å¾ˆå¤šï¼

ä»€ä¹ˆæ˜¯æˆ‘ä»¬æœ‰è¶…è¿‡ 10000 ä¸ªç½‘å€è·å–ã€‚å¦‚æœæˆ‘ä»¬åšå’Œä¸Šé¢ä¸€æ ·çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½ä¸ä¼šæˆåŠŸã€‚æˆ‘ä»¬å°†ä¸å¾—ä¸é¢å¯¹ä¸€äº›å¥‡æ€ªçš„å¥—æ¥å­—æŒ‚èµ·é”™è¯¯ã€‚æˆ‘ä»¬èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ

æœ‰ä¸€ä¸ªåä¸º`Bluebird`çš„èŠ‚ç‚¹åŒ…ï¼Œå®ƒæœ‰è‡ªå·±çš„ Promise APIï¼ŒåŠŸèƒ½ç›¸åŒã€‚å®ƒæœ‰ä¸€ä¸ªåä¸º`map`çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¸¦æœ‰ä¸€ä¸ªé¢å¤–çš„é€‰é¡¹å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®å¹¶å‘æ€§ã€‚

`Promise.map(urls => fetch(url), { concurrency: 100 });`

æ­£å¦‚æˆ‘ä»¬ä»è¯¥è¡Œå¯ä»¥æ¨æ–­çš„é‚£æ ·ï¼Œè¿™å°†åŒæ—¶ä¸€æ¬¡è·å– 100 ä¸ªè¯·æ±‚ã€‚è¿™å°†èŠ‚çœå¤§é‡çš„ CPU è´Ÿè½½ã€‚

```
const Promise = require('bluebird').Promise;
const urls = [...];
const promises = await Promise.map(
    urls => fetch(url),
    { concurrency: 100 }
);

for (const promise of promises) {
    const data = await promise.json();
    console.log(data);
} 
```

è°¢è°¢ä½ åšæŒåˆ°æœ€åã€‚

ç»§ç»­é»‘ï¼âœŒ