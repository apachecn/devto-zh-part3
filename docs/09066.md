# æˆ‘åšäº†ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„ MaaS ä¸šåŠ¡ï¼Œä½ ä¹Ÿå¯ä»¥ï¼

> åŸæ–‡:[https://dev . to/michaelsolati/I-made-an-automated-Maas-business-and-so-can-you-1e](https://dev.to/michaelsolati/i-made-an-automated-maas-business-and-so-can-you-1e)

åœ¨è¿‡å»çš„ä¸¤å¹´é‡Œï¼Œæˆ‘ä¸€ç›´åœ¨å’Œæˆ‘çš„æœ‹å‹å’Œå‰åŒäº‹å¼€ç©ç¬‘ï¼Œè¯´è¦å›´ç»•ä¸€ä¸ªç®€å•çš„æƒ³æ³•æ¥åˆ›ä¸š:MaaSï¼åœ¨è¿‡å»çš„ 6 ä¸ªæœˆé‡Œï¼Œæˆ‘ä¸€ç›´å‘Šè¯‰ä¸ä¼šè€…ï¼Œæˆ‘çœŸçš„éå¸¸éå¸¸è®¤çœŸåœ°åœ¨åšä¸€ä¸ª MaaS äº§å“ï¼Œå¸Œæœ›å®ƒèƒ½è¿«ä½¿æˆ‘åšæŒåˆ°åº•ã€‚æ¥äº†å¾ˆä¹…ï¼Œç»ˆäºå®Œæˆäº†ï¼Œè€Œä¸”æœ‰æ•ˆï¼

å“¦ MaaS ä»£è¡¨ä»€ä¹ˆï¼Ÿè¿™æ„å‘³ç€æ¨¡å› æ˜¯ä¸€ç§æœåŠ¡ï¼ä½ çœŸçš„çŸ¥é“ä½ ç”Ÿæ´»åœ¨ 21 ä¸–çºªï¼Œå¾—åˆ°ä¸€ä¸ªè¿·å› å°±åƒä¹°æ‚è´§ä¸€æ ·å®¹æ˜“ã€‚

æˆ‘çš„é¡¹ç›®å«åš Memeogramï¼Œä½ ç°åœ¨å°±å¯ä»¥ä½¿ç”¨å®ƒã€‚ä½ æ‰€éœ€è¦åšçš„å°±æ˜¯æŒ‘é€‰ä¸€ä¸ªæœ‹å‹ï¼Œå†³å®šä½ æƒ³ç»™ä»–ä»¬å‘é€å¤šå°‘ä¸ªè¿·å› ï¼Œå¹¶é€‰æ‹©ä½ å¸Œæœ›è¿™äº›è¿·å› æœ‰å¤šâ€œæ½®æ¹¿â€ã€‚å¤§çº¦ 2 å‘¨åï¼Œä»–ä»¬å°†é€šè¿‡é‚®ä»¶æ”¶åˆ°è¿·å› ã€‚

æ˜¯çš„ï¼Œæˆ‘è¯´é€šè¿‡**é‚®ä»¶**ã€‚å®é™…ä¸Šæ˜¯æ˜ä¿¡ç‰‡:ä½ ä¸ä¼šæƒ³åˆ°è¿·å› ä¼šä»¥è¿™ç§æ–¹å¼æ¥åˆ°ä½ é¢å‰ã€‚

ä¸‹é¢æ˜¯[è¿·å› å›¾](https://memeogram.com)çš„å·¥ä½œåŸç†:å‘ä»¶äººå¡«å†™ä¸€ä»½[ç±»å‹çš„è¡¨æ ¼](https://www.typeform.com)ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬æ”¶é›†é€šè¿‡é‚®ä»¶å‘é€è¿·å› æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚å½“å‘é€è€…ç‚¹å‡»æäº¤æ—¶ï¼Œ [Typeform webhook](https://www.typeform.com/help/webhooks/) å°†æäº¤å‘é€ç»™ [Firebase Cloud å‡½æ•°](https://firebase.google.com/products/functions)ã€‚äº‘åŠŸèƒ½è§£æè®¢å•ï¼Œä¸ºä½œä¸šæ‰¾åˆ°æœ€ä½³çš„è¿·å› ï¼Œå¹¶å‘ [Lob](https://lob.com/) å‘é€æ‰“å°å’Œé‚®å¯„è®¢å•çš„è¯·æ±‚ï¼ŒåŒæ—¶é€šè¿‡ç”¨ [Mailgun](https://www.mailgun.com/) å‘é€çš„ç”µå­é‚®ä»¶ä¿æŒå‘é€è€…çš„æœ€æ–°çŠ¶æ€ã€‚

æˆ‘çŸ¥é“ï¼Œå¤ªèŠ±å“¨äº†ï¼

* * *

## [](#create-your-own-maas-project-in-4-steps)åˆ† 4 æ­¥åˆ›å»ºæ‚¨è‡ªå·±çš„ MaaS é¡¹ç›®

### [](#step-1-create-a-typeform-form)ç¬¬ä¸€æ­¥ã€‚åˆ›å»º Typeform è¡¨å•

å¦‚æœä½ æƒ³æ„å»ºä¸€ä¸ªç±»ä¼¼äº [Memeogram](https://memeogram.com) çš„åº”ç”¨ç¨‹åºï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª[ç±»å‹çš„è¡¨å•](https://www.typeform.com)ï¼Œå¦‚ä¸‹æ‰€ç¤º:

[![Filling a Typeform](../Images/e7bea608d566b0056da544fefe7e42fb.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--AEo5F5yH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/lmu9olwevkxxcihp60v7.gif)

è¦å‘é€ä¸€å¼ å¸¦æœ‰ [Lob](https://lob.com/) çš„æ˜ä¿¡ç‰‡ï¼Œä½ éœ€è¦æ”¶é›†ä¸€äº›ä¿¡æ¯ï¼›ä¸»è¦æ˜¯å‘ä»¶äººå’Œæ”¶ä»¶äººçš„å§“åï¼Œä»¥åŠä»–ä»¬çš„é‚®å¯„åœ°å€ï¼Œç»†åˆ†ä¸ºä»¥ä¸‹å­—æ®µ:

*   è¡—é“åœ°å€
*   åŸå¸‚
*   çŠ¶æ€
*   é‚®æ”¿åŒºç 

é™„åŠ ä¿¡æ¯ï¼Œå¦‚å‘ä»¶äººçš„ç”µå­é‚®ä»¶åœ°å€æˆ–è¦åœ¨æ˜ä¿¡ç‰‡ä¸ŠåŒ…å«çš„ä¿¡æ¯å°†æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†è¿™å¹¶ä¸è¦æ±‚ä½¿ç”¨ Lobã€‚

* * *

### [](#step-2-use-firebase-to-handle-a-webhook)ç¬¬äºŒæ­¥ã€‚ä½¿ç”¨ Firebase å¤„ç† Webhook

åˆ›å»ºè¡¨å•åï¼Œä¸‹ä¸€æ­¥æ˜¯å¤„ç†æäº¤ã€‚è¿™ä¸ª [Firebase Cloud å‡½æ•°](https://firebase.google.com/products/functions)å…è®¸æ‚¨å¤„ç†æäº¤ï¼Œå¹¶å°†ä½œä¸º Typeform åœ¨è¡¨å•æäº¤æ—¶å‘é€ POST è¯·æ±‚çš„ç«¯ç‚¹ã€‚

```
import * as express from 'express';
import * as admin from 'firebase-admin';

// Our endpoint for handling the Typeform Webhook.
export const webhook = async (request: express.Request, response: express.Response) => {
  const submission = request.body;

  // This is our initial postcard, we will fill it out as we continue...
  const postcard = {
    sender: {},
    recipient: {}
  };

  // Here we parse out details from the form submission. By using an answers `ref` we map the response to in our postcard object.
  submission.form_response.answers.forEach((answer: any) => {
    const ref = answer['field']['ref'];
    switch (ref) {
      case 'sender-name':
        order['sender']['name'] = answer.text;
      case 'sender-email':
        order['sender']['email'] = answer.email;
      case 'recipient-name':
        order['recipient']['name'] = answer.text;
        break;
      default:
        break;
    }
  });

  // We will now save the postcard into a collection for our reference
  return admin.firestore().collection('orders').add(postcard)
    // We also will create a status document to keep a sender up to date on their order
    .then((ref) => admin.firestore().collection('status').doc(ref.id).set({
      lastUpdated: new Date(),
      message: 'Order to be sent to Lob',
      email: order.sender.email,
    }))
    .then(() => response.status(200).send({ success: true }));
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œå‘ç”Ÿäº†ä¸¤ä»¶é‡è¦çš„äº‹æƒ…:æ‚¨å°†æ˜ä¿¡ç‰‡å­˜å‚¨åœ¨æ‰€æœ‰`orders`çš„é›†åˆä¸­(è¿™å°†è§¦å‘å¯¹ Lob çš„æäº¤)ï¼Œå¹¶ä¸”æ‚¨å°†æ˜ä¿¡ç‰‡è®¢å•çš„çŠ¶æ€å­˜å‚¨åœ¨`status`é›†åˆä¸­(è¿™å°†ç”¨äºè§¦å‘ç»™å‘é€è€…çš„ [Mailgun](https://www.mailgun.com/) çŠ¶æ€ç”µå­é‚®ä»¶)ã€‚

* * *

### [](#step-3-send-the-postcard-with-lob)ç¬¬ä¸‰æ­¥ã€‚ç”¨ Lob å‘é€æ˜ä¿¡ç‰‡

Firebase å…è®¸æ‚¨åœ¨ Firestore é›†åˆè¢«å†™å…¥æ—¶[è§¦å‘åŠŸèƒ½ã€‚å½“ä¸€å¼ æ–°çš„æ˜ä¿¡ç‰‡è¢«ä¿å­˜åˆ° Firestore æ”¶è—æ—¶ï¼Œä½ å¯ä»¥è§¦å‘](https://firebase.google.com/docs/functions/firestore-events) [Lob](https://lob.com/) æ¥æ‰“å°ä¸€å¼ æ˜ä¿¡ç‰‡ã€‚

```
import * as admin from 'firebase-admin';
import * as functions from 'firebase-functions';
import { readFileSync } from 'fs';
import { join } from 'path';

const Lob = require('lob')('<YOUR-LOB-API-KEY-HERE>');

// The front and the back of postcards being sent can be stored/created as HTML files, with variables swapped in by Lob
const POSTCARD_FRONT: string = readFileSync(join(__dirname, 'templates', 'front.html'), 'utf8');
const POSTCARD_BACK: string = readFileSync(join(__dirname, 'templates', 'back.html'), 'utf8');

// This function will be triggered whenever a new document is created in the `order` collection. So when the above `webhook` function resolves, this function is automatically triggered.
export const ordersOnCreate = functions.firestore.document('orders/{id}').onCreate((snapshot, context) => {
  const id = context.params.id;
  const postcard = snapshot.data();

  // Let's send the order to Lob for printing!
  return Lob.postcards.create({
    description: `Typeform ğŸ’Œ Lob - ${id}`,
    to: {
      name: postcard.recipient.name,
      address_line1: postcard.recipient.address,
      address_line2: '',
      address_city: postcard.recipient.city,
      address_state: postcard.recipient.state,
      address_zip: postcard.recipient.zip
    },
    from: {
      name: postcard.sender.name,
      address_line1: postcard.sender.address,
      address_line2: '',
      address_city: postcard.sender.city,
      address_state: postcard.sender.state,
      address_zip: postcard.sender.zip
    },
    front: POSTCARD_FRONT,
    back: POSTCARD_BACK,
    merge_variables: {
      // This is a variable that will be swapped into out postcard HTML templates
      message: postcard.message
    }
  }, (error: any, success: any) => {
    if (error) {
      // If we are unable to send the order to Lob we will update our status with an error
      admin.firestore().collection('status').doc(id).update({
        error: true,
        message: 'Your order could not be sent to Lob',
        lastUpdated: new Date()
      });
    } else {
      // If successful we will update the order status accordingly
      admin.firestore().collection('status').doc(id).update({
        error: false,
        message: 'Your order has been successfully sent to Lob',
        completed: true,
        lastUpdated: new Date(),
        sent: success
      });
    }
  });
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

### [](#step-4-notify-the-sender-with-mailgun)ç¬¬å››æ­¥ã€‚ç”¨é‚®ä»¶æªé€šçŸ¥å‘ä»¶äºº

æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œå‰ä¸¤èŠ‚ä¸­çš„ä»£ç å†™å…¥äº†`status`é›†åˆã€‚è¿™æ˜¯å› ä¸ºæ‚¨å¸Œæœ›è®©å‘ä»¶äººäº†è§£ä»–ä»¬è®¢å•çš„æœ€æ–°çŠ¶æ€ã€‚å°±åƒåˆ›å»ºè®¢å•æ—¶è§¦å‘çš„äº‘å‡½æ•°ä¸€æ ·ï¼Œå½“åˆ›å»ºæˆ–æ›´æ–°çŠ¶æ€æ—¶ï¼Œæ‚¨å°†è§¦å‘è¯¥å‡½æ•°æ¥å‘é€ [Mailgun](https://www.mailgun.com/) çŠ¶æ€ç”µå­é‚®ä»¶ã€‚

```
import * as functions from 'firebase-functions';
import * as Mailgun from 'mailgun-js';

const mailgun = Mailgun({
  apiKey: '<YOUR-MAILGUN-API-KEY-HERE>',
  domain: '<YOUR-MAILGUN-DOMAIN-HERE>'
});

// This function will be triggered whenever a status is created
export const statusOnCreate = functions.firestore.document('status/{statusId}').onCreate((snapshot, context) => {
  // First we parse out the ID of the status document (it should match the order's ID)
  const id = context.params.statusId;
  // Then we parse out the status document
  const status = snapshot.data();
  // We then send the status and id to our `sendEmail` function that will handle sending the email
  return sendEmail(status, id);
});

// This function will be triggered whenever a status is changed (updated)
export const statusOnUpdate = functions.firestore.document('status/{statusId}').onUpdate((change, context) => {
  // Here we just ensure it's an update and not a delete
  if (!change.after) { return Promise.resolve(); }
  const id = context.params.statusId;
  const status = change.after.data();
  return sendEmail(status, id);
});

// All we do here is send the email via Mailgun
function sendEmail(status: any, id: string): Promise<any> {
  return mailgun.messages().send({
    from: 'support@typeform.com',
    to: status.email,
    subject: `Typeform ğŸ’Œ Lob - Order ${id} Update`,
    text: `${status.message} \n View order at https://typeform-lob.firebaseapp.com/order?id=${id}`
  });
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

## [](#the-end-product)æœ€ç»ˆäº§å“

åœ¨ Firebase ä¸Šéƒ¨ç½²é¡¹ç›®åï¼Œæ‚¨å¯ä»¥å¡«å†™è¡¨å•å¹¶è§‚å¯Ÿæµç¨‹çš„è¿è¡Œï¼Œç›´åˆ°æ‚¨æ”¶åˆ°ä¸€å°ç¡®è®¤ç”µå­é‚®ä»¶ï¼Œæ‚¨å¯ä»¥ç”¨å®ƒæ¥è·Ÿè¸ªè®¢å•ã€‚

[![A confirmed order](../Images/7bf236e5fdcb425a0662c89673b8c6e1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--7Uxh8ZzC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/tfjhnz2lbjlco9tph6pq.png)

ä½ è‡ªå·±è¯•è¯•ï¼æœ¬æŒ‡å—å°†å¼•å¯¼æ‚¨å®Œæˆè®¾ç½®å’Œéƒ¨ç½²æˆ‘ä¸Šé¢æè¿°çš„åº”ç”¨ç¨‹åºçš„æ•´ä¸ªè¿‡ç¨‹:

```
git clone https://github.com/MichaelSolati/typeform-lob.git
cd typeform-lob
npm i
npm run start 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ–è€…ä½ å¯ä»¥åœ¨è¿™é‡Œå°è¯•ä¸€ä¸‹æ¼”ç¤ºåº”ç”¨[çš„éƒ¨ç½²ç‰ˆæœ¬ã€‚](https://lob.typeformdev.com)

è™½ç„¶è¿·å› å¯èƒ½å¾ˆæœ‰è¶£ï¼Œä½†å¯èƒ½å­˜åœ¨çš„å…¶ä»–å®é™…ç”¨ä¾‹æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³è¦è‡ªåŠ¨å‘è´­ä¹°æ‚¨äº§å“çš„å®¢æˆ·å‘é€æ„Ÿè°¢å¡ã€‚æˆ–è€…æ˜¯ä¸€ä¸ªé€šè¿‡é‚®ä»¶è”ç³»å½“åœ°å›½ä¼šè®®å‘˜çš„å¹³å°ã€‚

* * *

è¦äº†è§£æˆ‘æ­£åœ¨åšçš„ä¸€åˆ‡ï¼Œè¯·åœ¨ [Twitter](https://twitter.com/MichaelSolati) ä¸Šå…³æ³¨æˆ‘ã€‚å¦‚æœä½ åœ¨æƒ³ï¼Œ*â€œç»™æˆ‘çœ‹çœ‹ä»£ç ï¼â€ä½ å¯ä»¥åœ¨ [GitHub](https://github.com/MichaelSolati) ä¸Šæ‰¾åˆ°æˆ‘ã€‚*