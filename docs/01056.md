# å¦‚ä½•:è®©æˆ‘ä»¬ä¸º Azure Web App æœåŠ¡åŠ å¯†è¯ä¹¦

> åŸæ–‡:[https://dev . to/Jakob _ vdh/how-to-let-s-encrypt-certificates-for-azure-we B- app-service-524 a](https://dev.to/jakob_vdh/how-to-let-s-encrypt-certificates-for-azure-web-app-service-524a)

# [](#how-to-secure-your-azure-website-with-ssl-for-free-in-minutes)å¦‚ä½•åœ¨å‡ åˆ†é’Ÿå†…ç”¨ SSL å…è´¹ä¿æŠ¤ä½ çš„ Azure ç½‘ç«™ğŸ”’

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä¸€æ­¥ä¸€æ­¥åœ°æŒ‡å¯¼ä½ ä¸º Azure ä¸Šçš„ [Web App æœåŠ¡æ‰˜ç®¡çš„ä»»ä½• Web åº”ç”¨æ·»åŠ å…è´¹çš„](https://azure.microsoft.com/en-us/services/app-service/web/) [Let's Encrypt Certificates](https://letsencrypt.org/) ã€‚
Let ' s Encrypt SSL è¯ä¹¦çš„é—®é¢˜æ˜¯å®ƒä»¬åªèƒ½æŒç»­ 90 å¤©ã€‚ä½†æ˜¯ï¼Œå˜¿ï¼Œæ²¡æœ‰è‡ªåŠ¨åŒ–è§£å†³ä¸äº†çš„é—®é¢˜ã€‚

æœ¬æ•™ç¨‹å°†åŸºäº Simon J.K. Pedersen çš„ Azure Web åº”ç”¨ç¨‹åºç«™ç‚¹æ‰©å±•â€œAzure Let's Encryptâ€ã€‚
(å°å£°æ˜:ç«™ç‚¹æ‰©å±•æ˜¯**ä¸æ˜¯å¾®è½¯æ”¯æŒçš„**ï¼Œæˆ‘ç”¨å®ƒåšäº†å¾ˆå¤šå°é¡¹ç›®ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æ•ˆæœå¾ˆå¥½)ã€‚

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png)[sjkp](https://github.com/sjkp)/[let sencrypt-site extension](https://github.com/sjkp/letsencrypt-siteextension)

### Azure Web App Site Extension ä¾¿äºå®‰è£…å’Œé…ç½®ï¼Œè®©æˆ‘ä»¬ä¸ºè‡ªå®šä¹‰åŸŸååŠ å¯†å·²é¢å‘çš„ SSL è¯ä¹¦ã€‚

<article class="markdown-body entry-content container-lg" itemprop="text">

# è®©æˆ‘ä»¬åŠ å¯†ç«™ç‚¹æ‰©å±•

[![Build status](../Images/e0460ddab2a5e2f7a45c95f7a9dc0175.png)T2ã€‘](https://dev.azure.com/letsencrypt/letsencrypt/_build/latest?definitionId=2)

è¿™ä¸ª Azure Web App ç«™ç‚¹æ‰©å±•æ”¯æŒè½»æ¾å®‰è£…å’Œé…ç½®[è®©æˆ‘ä»¬ä¸ºæ‚¨çš„è‡ªå®šä¹‰åŸŸååŠ å¯†](https://letsencrypt.org/)é¢å‘çš„ SSL è¯ä¹¦ã€‚

ç«™ç‚¹æ‰©å±•è¦æ±‚æ‚¨å·²ç»ä¸ºè‡ªå®šä¹‰åŸŸé…ç½®äº† DNS æ¡ç›®ï¼Œä»¥æŒ‡å‘ Azure Web Appã€‚

2019 å¹´ 11 æœˆ-å¾®è½¯æœ€ç»ˆæ‰¿è®¤ï¼Œä¹Ÿè®¸æ˜¯æ—¶å€™ä¸ºå…è´¹ SSL è¯ä¹¦æ·»åŠ ä¸€çº§æ”¯æŒäº†ï¼Œè¯·å‚è§å…³äº[åº”ç”¨æœåŠ¡ç®¡ç†è¯ä¹¦](https://azure.microsoft.com/en-us/updates/secure-your-custom-domains-at-no-cost-with-app-service-managed-certificates-preview/)çš„å…¬å‘Šï¼Œè¯·æ³¨æ„ï¼Œå®ƒå¤„äºé¢„è§ˆé˜¶æ®µï¼Œç›®å‰**ä¸æ”¯æŒ**apex/naked åŸŸã€‚

## å¦‚ä½•å®‰è£…

[https://github . com/sjkp/lets encrypt-site extension/wiki/How-to-install](https://github.com/sjkp/letsencrypt-siteextension/wiki/How-to-install)

## å·²çŸ¥é—®é¢˜

*   è¿™ä¸ªç«™ç‚¹æ‰©å±•æ˜¯ç”±å¾®è½¯æ”¯æŒçš„**è€Œä¸æ˜¯**ï¼Œå®ƒæ˜¯æˆ‘è‡ªå·±åŸºäº https://github.com/fszlin/certes[çš„å·¥ä½œâ€”â€”è¿™æ„å‘³ç€ä¸è¦æœŸæœ› 24x7 çš„æ”¯æŒï¼Œæˆ‘åœ¨æˆ‘è‡ªå·±çš„å‡ ä¸ªè¾ƒå°çš„ç«™ç‚¹ä¸Šä½¿ç”¨å®ƒï¼Œä½†æ˜¯å¦‚æœä½ è¿è¡Œçš„ç«™ç‚¹å¾ˆé‡è¦ï¼Œä½ åº”è¯¥è€ƒè™‘èŠ±å‡ ç¾å…ƒä¹°ä¸€ä¸ªè¯ä¹¦â€¦](https://github.com/fszlin/certes)

</article>

[View on GitHub](https://github.com/sjkp/letsencrypt-siteextension)

## [](#requirements)âœ…è¦æ±‚:

1.  Azure å¸æˆ·([å¦‚æœä½ æ˜¯å­¦ç”Ÿï¼Œè¯·ç‚¹å‡»æ­¤å¤„äº†è§£å¦‚ä½•è·å¾—å…è´¹çš„ Azure èµ„æºã€‚](//bit.ly/tutorial-azure-for-students))
2.  ä½¿ç”¨åº”ç”¨ç¨‹åºæœåŠ¡ Web Apps æ‰˜ç®¡çš„ Web åº”ç”¨ç¨‹åº(å¯ä»¥æ˜¯ç®€å•çš„ HTML å’Œ CSS æˆ–ç±»ä¼¼ React çš„ä¸œè¥¿)
3.  æ‚¨è‡ªå·±çš„è‡ªå®šä¹‰ DNS æ¡ç›®é…ç½®ä¸ºæŒ‡å‘æ‚¨çš„ Web åº”ç”¨ç¨‹åºã€‚

âš :ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ çš„åº”ç”¨æœåŠ¡è®¡åˆ’å’Œåº”ç”¨æœåŠ¡åœ¨åŒä¸€ä¸ªèµ„æºç»„ã€‚

## [](#azure-storage-account)Azure å­˜å‚¨è´¦æˆ·

é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª Azure å­˜å‚¨å¸æˆ·ï¼Œä»¥ä¾¿æ‰©å±•èƒ½å¤Ÿé€šè¿‡ä½¿ç”¨ Azure WebJobs æ¯ 3 ä¸ªæœˆæ›´æ–°ä¸€æ¬¡åŠ å¯†è¯ä¹¦ã€‚

[![Screenshot of an Azure Storage Account](../Images/ef73c1112ac25c6b1e870e3dc8299d4f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--f7YxTOxA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/Jakob-vdH/BlogPosts/master/devTo/letsencrypt/media/01-storage-account.PNG)

å­˜å‚¨è´¦æˆ·å¿…é¡»ä¸º`Storage`æˆ–`StorageV2`ï¼Œ`BlobStorage`æ— æ•ˆ

[![Screenshot of the configuration of the application settings](../Images/aa8bbfa6942388b0ff1ee02c64503bb7.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--J8_5tUip--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/Jakob-vdH/BlogPosts/master/devTo/letsencrypt/media/02-AzureWebJobs.jpg)

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸¤ä¸ªåº”ç”¨ç¨‹åºè®¾ç½®ï¼Œåˆ†åˆ«åä¸º`AzureWebJobsDashboard`å’Œ`AzureWebJobsStorage`ï¼Œä»¥åŠæˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„å­˜å‚¨å¸æˆ·çš„è¿æ¥å­—ç¬¦ä¸²ã€‚è¿æ¥å­—ç¬¦ä¸²åº”è¯¥æ˜¯è¿™æ ·çš„:`DefaultEndpointsProtocol=https;AccountName=[myaccount];AccountKey=[mykey];`ã€‚

## [](#azure-service-principle)è”šè“æœåŠ¡åŸåˆ™

ä¸ºäº†è®©æ‰©å±•åœ¨æ— äººå€¼å®ˆå’Œæ²¡æœ‰æˆ‘ä»¬äººå·¥å¹²é¢„çš„æƒ…å†µä¸‹å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª Azure æœåŠ¡åŸåˆ™ï¼Œå®ƒåŸºæœ¬ä¸Šæ˜¯ä½œä¸ºä¸€ä¸ªâ€œä»£è¡¨â€å§”æ‰˜ Azure AD å…¥å£å·¥ä½œçš„ã€‚

1.  è¿›å…¥æ‚¨æƒ³è¦ç”¨æ¥åˆ›å»ºæ–°åº”ç”¨ç¨‹åºçš„ Azure Active Directory (AAD)ç›®å½•ã€‚
2.  åœ¨ç›®å½•é¢æ¿ä¸­é€‰æ‹©`App Registrations`ã€‚
3.  åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºï¼Œå¦‚å›¾æ‰€ç¤ºè¿›è¡Œè®¾ç½®ã€‚

    [![Screenshot of the creation of a Service Principle](../Images/941ed8362e6ffe789e5ccc6f5e6e8a69.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--O2Q44kyd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/Jakob-vdH/BlogPosts/master/devTo/letsencrypt/media/03-ServicePrinciple.jpg)

4.  ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºæ–°çš„å®¢æˆ·ç«¯å¯†ç ã€‚è¯·ç¡®ä¿æ‚¨ä¿å­˜äº†ç”Ÿæˆçš„å¯†ç ï¼Œå› ä¸ºæ‚¨å°†**è€Œä¸æ˜¯**èƒ½å¤Ÿå†æ¬¡ä»¥æ˜æ–‡å½¢å¼è®¿é—®å®ƒï¼

    [![Screenshot of the creation of the Service Principle client secret](../Images/9c5097d09ac8907e0c5162152d91a77c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--5zy1m8wV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/Jakob-vdH/BlogPosts/master/devTo/letsencrypt/media/03-ServicePrinciple2.jpg)

5.  è¿”å›åˆ° Overview é€‰é¡¹å¡ï¼Œå¹¶ä¿å­˜åº”ç”¨ç¨‹åº(å®¢æˆ·ç«¯)IDã€‚è¦ç»§ç»­ï¼Œæ‚¨ç°åœ¨åº”è¯¥æœ‰äº†**å®¢æˆ·ç«¯ç§˜å¯†**å’Œ**åº”ç”¨ç¨‹åº ID** ã€‚

6.  ç°åœ¨ï¼ŒæœåŠ¡åŸåˆ™éœ€è¦ä¸ºæ‚¨çš„åº”ç”¨æœåŠ¡å’Œåº”ç”¨æœåŠ¡è®¡åˆ’çš„èµ„æºç»„æä¾›**è®¿é—®æƒé™ã€‚
    è¿™å¯ä»¥é€šè¿‡è®¿é—®èµ„æºç»„çš„`Access control (IAM)`èœå•ï¼Œç„¶åç‚¹å‡»â€œæ·»åŠ â€æŒ‰é’®æ¥å®Œæˆã€‚**

    [![Screenshot of adding access rights for the Service Principle in the access control (IAM) menu](../Images/bca6c4d1196371fa9e8d5019faf4991f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--i0qKSpsn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/Jakob-vdH/BlogPosts/master/devTo/letsencrypt/media/04-AccessRights.jpg)

7.  åœ¨æ¥ä¸‹æ¥çš„èœå•ä¸­ï¼Œé€‰æ‹©`Contributor`è§’è‰²å¹¶å°†å…¶æ·»åŠ åˆ°åˆ›å»ºçš„æœåŠ¡åŸåˆ™ä¸­ã€‚

    [![Screenshot of adding the 'Contributor' role to the Service Principle in the access control (IAM) menu](../Images/98bbc4e58d21dc1fa2fec2154d5a936a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Cl0OMqFQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/Jakob-vdH/BlogPosts/master/devTo/letsencrypt/media/04-AccessRights2.jpg)

âš å¦‚æœæ‚¨åœ¨èµ„æºç»„ä¸­æœ‰è¿›ä¸€æ­¥çš„æœåŠ¡ï¼Œæ‚¨è¿˜å¯ä»¥ä»…å°†`Contributor`è§’è‰²æ·»åŠ åˆ°åº”ç”¨æœåŠ¡å’ŒæœåŠ¡è®¡åˆ’ä¸­ã€‚

## [](#installing-the-lets-encrypt-site-extension)å®‰è£… let åŠ å¯†ç«™ç‚¹æ‰©å±•

ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®äº†æ‰©å±•å·¥ä½œçš„æ‰€æœ‰å¿…è¦æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£…å’Œé…ç½®å®ƒäº†ã€‚

è½¬åˆ°æ‚¨çš„åº”ç”¨æœåŠ¡ï¼Œåœ¨åº”ç”¨æœåŠ¡èœå•ä¸­æœç´¢æ‰©å±•ç«™ç‚¹ã€‚åœ¨ç«™ç‚¹ä¸Šé€šè¿‡ SJKP æ·»åŠ æ‰©å±•å`Azure Let's Encrypt`ã€‚

[![Screenshot of the App Service extensions menu](../Images/35f0ab8c3b1a314a7964f21cf1795373.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--SRcDjj4b--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/Jakob-vdH/BlogPosts/master/devTo/letsencrypt/media/05-extension1.jpg)

## [](#configuring-the-lets-encrypt-site-extension)é…ç½®è®©åŠ å¯†ç«™ç‚¹æ‰©å±•

è¦é…ç½®æ‰©å±•ï¼Œæˆ‘ä»¬éœ€è¦å‰å¾€åº”ç”¨æœåŠ¡çš„`Advanced Tools`é¡µé¢ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨èœå•çš„æœç´¢æ ä¸­æœç´¢`Advanced Tools`æ¥æ‰¾åˆ°å®ƒï¼Œå®ƒä¼šå¸¦ä½ å»ä¸€ä¸ªåƒ`https://<yourDomain>.scm.azurewebsites.net`è¿™æ ·çš„ç½‘ç«™ã€‚
è¦è¿›å…¥æ‰©å±•è®¾ç½®ï¼Œä½ åªéœ€ç‚¹å‡»é¡¶éƒ¨èœå•ä¸­çš„`Site extensions`æŒ‰é’®ï¼Œç„¶åç‚¹å‡»æ‰©å±•çš„â€œå¯åŠ¨â€æŒ‰é’®ã€‚å®ƒå°†å¸¦æ‚¨åˆ°æ‰©å±•çš„é…ç½®é¡µé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

[![Screenshot of the extension configuration settings](../Images/203f35db83e7a7376f095c972bd6ca1a.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Y7T6JuX1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/Jakob-vdH/BlogPosts/master/devTo/letsencrypt/media/06-extensionConfig.jpg)

*   **ç§Ÿæˆ·**:æ˜¯æœåŠ¡ä¸»ä½“åœ¨å…¶ä¸­åˆ›å»ºçš„ Azure AD ç›®å½•(ç§Ÿæˆ·)â€”â€”`<yourTenantDomain>.onmicrosoft.com`ã€‚
*   **SubscriptionId** :æ˜¯æ‚¨ç”¨äºèµ„æºç»„çš„è®¢é˜…çš„ Id(è¯¥ Id ä¹Ÿæ˜¾ç¤ºåœ¨æ‚¨çš„èµ„æºç»„çš„â€œæ¦‚è¿°â€é¡µé¢ä¸Š)ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥ä»([https://portal . Azure . com/# blade/Microsoft _ Azure _ Billing/subscription blade)ã€https://portal . Azure . com/# blade/Microsoft _ Azure _ Billing/subscription bladeã€‘](https://portal.azure.com/#blade/Microsoft_Azure_Billing/SubscriptionsBlade)%5Bhttps://portal.azure.com/#blade/Microsoft_Azure_Billing/SubscriptionsBlade%5D)è·å¾—æ‚¨èƒ½å¤Ÿè®¿é—®çš„ idã€‚
*   **ClienId å’Œ ClientSecret** :æ˜¯ä½ å¸Œæœ›ä»æˆ‘ä»¬åˆ›å»ºçš„**æœåŠ¡åŸåˆ™**ä¸­å¾—åˆ°çš„ Id å’Œç§˜å¯†ã€‚
*   **ResourceGroupName** :æ˜¯æ‚¨çš„åº”ç”¨æœåŠ¡çš„èµ„æºç»„çš„åç§°ã€‚
*   **ServicePlanResourceGroupName**:å¦‚æœæœåŠ¡è®¡åˆ’å’Œ App æœåŠ¡åœ¨åŒä¸€ä¸ªèµ„æºç»„ï¼Œè¯¥åç§°ä¸`ResourceGroupName`ç›¸åŒã€‚å¦åˆ™ï¼Œæ‚¨å¿…é¡»è¾“å…¥æœåŠ¡è®¡åˆ’æ‰€åœ¨çš„èµ„æºç»„çš„åç§°(å¦‚æœæ˜¯è¿™æ ·ï¼Œè¯·è®°ä½ä¹Ÿè¦æˆäºˆæœåŠ¡ä¸»ä½“å¯¹è¯¥èµ„æºç»„çš„è®¿é—®æƒé™)ã€‚
*   **æ›´æ–°åº”ç”¨ç¨‹åºè®¾ç½®**:ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶åº”è®¾ä¸º trueï¼Œå°†æ‰€æœ‰è®¾ç½®ä¿å­˜ä¸º web åº”ç”¨ç¨‹åºè®¾ç½®ã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œä»¥ä¾¿åœ¨ WebJob ç»­è®¢è¯ä¹¦æ—¶è®¾ç½®å¯ç”¨ã€‚

å®Œæˆåï¼Œæ‚¨å°†çœ‹åˆ°è‡ªå®šä¹‰åŸŸã€SSL ç»‘å®šå’Œè¯ä¹¦çš„æ¦‚è¿°ã€‚å› ä¸ºæ‚¨ä»ç„¶éœ€è¦ç”Ÿæˆå®ƒä»¬ï¼Œæ‰€ä»¥æ‚¨åº”è¯¥ç»§ç»­åˆ°ä¸‹ä¸€é¡µã€‚åœ¨é‚£é‡Œï¼Œæ‚¨å¯ä»¥é€‰æ‹©æ‚¨æƒ³è¦ä¸ºå…¶ç”³è¯· SSL è¯ä¹¦çš„åŸŸ(æ‚¨å¯ä»¥é€šè¿‡æŒ‰ä½ Ctrl é”®æ¥é€‰æ‹©å¤šä¸ªåŸŸ)ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæ‚¨éœ€è¦æä¾›ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€ï¼Œè¯¥åœ°å€å°†æ”¶åˆ°â€œè®©æˆ‘ä»¬åŠ å¯†â€çš„è­¦å‘Šï¼Œä¾‹å¦‚åœ¨è¯ä¹¦æœªæ›´æ–°çš„æƒ…å†µä¸‹ã€‚

è¿™å°±æ˜¯ä½ éœ€è¦åšçš„ä¸€åˆ‡ï¼Œç©å¾—å¼€å¿ƒï¼ğŸ±â€ğŸ’»

## [](#%E2%9A%A0-troubleshooting-%E2%9A%A0)âš æ’é™¤âš æ•…éšœ

å› ä¸º Let's Encrypt éœ€è¦åˆ°è¾¾ä½ çš„é¡µé¢ï¼Œæ‰èƒ½æˆæƒä½ çš„åŸŸåï¼Œæ‰€ä»¥è¦ç¡®ä¿è¿™ä¸ª URL æ˜¯å…¬ä¼—å¯ä»¥è®¿é—®çš„:`http://<yourDomain>.com/.well-known/acme-challenge/`ã€‚åœ¨å¤§å¤šæ•°é”™è¯¯æƒ…å†µä¸‹ï¼Œæ— æ³•è®¿é—®æ­¤ URLï¼Œä¾‹å¦‚ï¼Œå› ä¸º web.config ä¸­çš„è§„åˆ™é›†æˆ–å› ä¸ºåº”ç”¨ç¨‹åºæœåŠ¡è®¾ç½®ä¸­å¼ºåˆ¶ä½¿ç”¨ httpsã€‚

[![Screenshot of an error example, where Lets Encrypt was not able to reach the needed URL](../Images/244fcd80104b77c3e49e3e171ae12ff5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--VLbaoCe2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/Jakob-vdH/BlogPosts/master/devTo/letsencrypt/media/07-ErrorExample.jpg)