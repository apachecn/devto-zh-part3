# NSFW:Js ä¸­æŒ‰ä½è¿ç®—ç¬¦çš„ç”¨ä¾‹

> åŸæ–‡:[https://dev . to/puritatic/nsfw-use-cases-for-bitwise-operators-in-js-2om 5](https://dev.to/puritanic/nsfw-use-cases-for-bitwise-operators-in-js-2om5)

[Javascript ä¸­çš„æŒ‰ä½è¿ç®—ç¬¦](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators)ä¸»è¦ç”¨äºæ•°å€¼è½¬æ¢/è®¡ç®—ï¼Œå› ä¸ºæœ‰æ—¶å®ƒä»¬æ¯”å®ƒä»¬çš„å¯¹ç­‰è¿ç®—ç¬¦`Math`æˆ–`parseInt`è¦å¿«å¾—å¤šã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹çœ‹ä¸€äº›åŸºå‡†[ã€‚](https://jsperf.com/math-floor-vs-math-round-vs-parseint/18)

é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œæ­£å¦‚ Mathias Bynens æŒ‡å‡ºçš„é‚£æ ·[ï¼Œä½è¿ç®—åªå¯¹å¯ä»¥è¡¨ç¤ºä¸º 32 ä½åºåˆ—çš„æ•°å­—æœ‰æ•ˆã€‚ä»»ä½•é«˜äº 2147483647 æˆ–ä½äº-2147483648 çš„æ•°å­—éƒ½ä¸ä¼šå¦‚ä½ æ‰€æ„¿ã€‚è¿™é€šå¸¸æ˜¯å¯ä»¥æ¥å—çš„ã€‚](https://j11y.io/javascript/double-bitwise-not/#comment-29617)

ä½†æ˜¯ï¼ŒJavaScript æ•°å­—å§‹ç»ˆæ˜¯ 64 ä½äºŒè¿›åˆ¶æµ®ç‚¹å€¼ï¼Œéµå¾ªå›½é™… IEEE 754 æ ‡å‡†ã€‚å› æ­¤ï¼ŒæŒ‰ä½è¿ç®—ç¬¦çš„ç»“æœè™½ç„¶æ˜¯ç”¨ 32 ä½æ•´æ•°æ•°å­¦è®¡ç®—çš„ï¼Œä½†å´ä»¥æµ®ç‚¹å½¢å¼å­˜å‚¨ã€‚è¿™ä¹‹æ‰€ä»¥å¯è¡Œï¼Œæ˜¯å› ä¸º 32 ä½æ•´æ•°çš„èŒƒå›´éå¸¸é€‚åˆ 64 ä½æµ®ç‚¹æ•°ã€‚

ä½†æ˜¯ä½ å¿…é¡»ä¸ºé€Ÿåº¦çš„æé«˜ä»˜å‡ºçš„ä»£ä»·æ˜¯ä»£ç çš„å¯è¯»æ€§ã€‚è‡ªä»æˆ‘å‡ å¹´å‰å¼€å§‹ç¼–ç ä»¥æ¥ï¼Œæˆ‘å¯èƒ½ä½¿ç”¨è¿‡ä¸€ä¸¤æ¬¡æŒ‰ä½æ“ä½œç¬¦ï¼Œå› ä¸ºæˆ‘çš„å¤§éƒ¨åˆ†å·¥ä½œä¸è®¡ç®—æ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘å¯¹ç°å®ä¸–ç•Œä»£ç ä¸­çš„æŒ‰ä½æ“ä½œç¬¦çš„ä½¿ç”¨å¾ˆæ„Ÿå…´è¶£ï¼Œå¹¶ä¸”æˆ‘ä»äº’è”ç½‘ä¸Šæ”¶é›†äº†ä¸€äº›ç‰‡æ®µï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ğŸ˜„ã€‚

* * *

ä»¥ä¸‹æ˜¯æˆ‘æ”¶é›†çš„ä¸€äº›æ‘˜å½•:

##### [](#-raw-0-endraw-is-an-easy-and-fast-way-to-convert-anything-to-integer)`| 0`æ˜¯ä¸€ç§ç®€å•å¿«æ·çš„å°†ä»»ä½•ä¸œè¥¿è½¬æ¢æˆæ•´æ•°çš„æ–¹æ³•:

```
( 3|0 ) === 3;                 // it does not change integers
( 3.3|0 ) === 3;               // it casts off the fractional part in fractionalal numbers
( 3.8|0 ) === 3;               // it does not round, but exactly casts off the fractional part
( -3.3|0 ) === -3;             // including negative fractional numbers
( -3.8|0 ) === -3;             // which have Math.floor(-3.3) == Math.floor(-3.8) == -4
( "3"|0 ) === 3;               // strings with numbers are typecast to integers
( "3.8"|0 ) === 3;             // during this the fractional part is cast off too
( "-3.8"|0 ) === -3;           // including negative fractional numbers
( NaN|0 ) === 0;               // NaN is typecast to 0
( Infinity|0 ) === 0;          // the typecast to 0 occurs with the Infinity
( -Infinity|0 ) === 0;         // and with -Infinity
( null|0 ) === 0;              // and with null,
( (void 0)|0 ) === 0;          // and with undefined
( []|0 ) === 0;                // and with an empty array
( [3]|0 ) === 3;               // but an array with one number is typecast to number
( [-3.8]|0 ) === -3;           // including the cast off of the fractional part
( [" -3.8 "]|0 ) === -3;       // including the typecast of strings to numbers
( [-3.8, 22]|0 ) === 0         // but an Array with several numbers is typecast to 0
( {}|0 ) === 0;                // an empty object is typecast to 0
( {'2':'3'}|0 ) === 0;         // or a not empty object
( (function(){})|0 ) === 0;    // an empty function is typecast to 0 too
( (function(){ return 3;})|0 ) === 0; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

##### [](#replacements-for-raw-mathfloor-endraw-)æ›¿æ¢`Math.floor()`:

```
(~~n)                           
n|n
n&n

// Generate random RGB value:
var r = ~~(Math.random() * 255);

~~null;      // 0
~~undefined; // 0
~~0;         // 0
~~{};        // 0
~~[];        // 0
~~(1/0);     // 0
~~false;     // 0
~~true;      // 1
~~1.2543;    // 1
~~4.9;       // 4
~~(-2.999);  // -2

// An example
const n = Math.PI;   // 3.141592653589793

Math.floor(n);       // 3
parseInt(n, 10);     // 3
~~n; // 3 
n|n; // 3            // n|n and n&n always yield the same results as ~~n
n&n; // 3 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œåœ¨æœ€åä¸‰ç§é€‰æ‹©ä¸­ï¼Œ`n|n` [ä¼¼ä¹æ˜¯æœ€å¿«çš„](https://jsperf.com/rounding-numbers-down)ã€‚

å¦‚æœä½ çŸ¥é“ä½ åœ¨å¤„ç†ç§¯æçš„äº‹æƒ…ï¼Œé‚£ä¹ˆ`~~`çš„åœ°æ¿åŠŸèƒ½ä½¿å®ƒæˆä¸º`Math.floor`çš„æ›´å¥½é€‰æ‹©â€”â€”å®ƒæ›´å¿«ï¼Œå ç”¨çš„å­—ç¬¦æ›´å°‘ã€‚ä¸è¿‡ï¼Œå®ƒçš„å¯è¯»æ€§ä¸å¤ªå¥½ã€‚

##### [](#parsing-hexadecimal-value-to-get-rgb-color-values)è§£æåå…­è¿›åˆ¶å€¼å¾—åˆ° RGB é¢œè‰²å€¼:

```
var hex = 'ffaadd';
var rgb = parseInt(hex, 16); // rgb value is 16755421 in decimal = 111111111010101011011101 in binary = total 24 bits

var red   = (rgb >> 16) & 0xFF; // returns 255
var green = (rgb >> 8) & 0xFF;  // returns 170
var blue  = rgb & 0xFF;         // returns 221 

// How is it working:

// There are two bitwise operations as named SHIFTING and AND operations.
// SHIFTING is an operation where the bits are shifted toward a given direction by adding 0 (zero) bit for vacated bit fields.
// AND is an operation that is the same as multiplying in Math. For instance, if the 9th bit of the given first bit-set is 0
// and 9th bit of the given second bit-set is 1, the new value will be 0 because of 0 x 1 = 0 in math.

// 0xFF (000000000000000011111111 in binary) - used for to evaluate only last 8 bits of a given another bit-set by performing bitwise AND (&) operation. 
// The count of bits is 24 and the first 16 bits of 0xFF value consist of zero (0) value. Rest of bit-set consists of one (1) value.
console.log("0xFF \t\t\t\t: ", 0xFF) 

// 111111111010101011011101 -> bits of rgb variable
// 000000000000000011111111 -> 255 after (rgb >> 16) shifting operation
// 000000000000000011111111 -> 255 complement (changes the first 16 bits and does nothing for the last 8 bits)
// 000000000000000011111111 -> result bits after performing bitwise & operation
console.log("Red - (rgb >> 16) & 0xFF \t: ", (rgb >> 16) & 0xFF) // used for to evaluate the first 8 bits

// 111111111010101011011101 -> bits of rgb variable
// 000000001111111110101010 -> 65450 -> 'ffaa'
// 000000000000000011111111 -> 255 complement (changes the first 16 bits and does nothing for the last 8 bits)
// 000000000000000010101010 -> result bits after performing bitwise & operation
// calculation -> 000000001111111110101010 & 000000000000000011111111 = 000000000000000010101010 = 170 in decimal = 'aa' in hex-decimal
console.log("Green - (rgb >> 8) & 0xFF \t: ", (rgb >> 8) & 0xFF) // used for to evaluate the middle 8 bits 

// 111111111010101011011101 -> 'ffaadd'
// 000000000000000011111111 -> 255 complement (changes the first 16 bits and does nothing for the last 8 bits)
// 000000000000000011011101 -> result bits after performing bitwise & operation 
// calculation -> 111111111010101011011101 & 000000000000000011111111 = 221 in decimal = 'dd' in hex-decimal
console.log("Blue - rgb & 0xFF \t\t: ", rgb & 0xFF) // // used for to evaluate the last 8 bits.

console.log("It means that `FFAADD` hex-decimal value specifies the same color with rgb(255, 170, 221)") 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

##### [](#-raw-endraw-bitwise-xor-as-a-raw-io-endraw-toggler)`^`æŒ‰ä½å¼‚æˆ–ä½œä¸º`I/O` toggler

```
// https://stackoverflow.com/a/22061240/7453363
function toggle(evt) {
  evt.target.IO ^= 1;                                    // Bitwise XOR as 1/0 toggler
  evt.target.textContent = evt.target.IO ? "ON" : "OFF"; // Unleash your ideas
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

##### [](#check-if-number-is-odd)æ£€æŸ¥å·ç æ˜¯å¦ä¸ºå¥‡æ•°:

```
function isOdd(number) {
    return !!(number & 1);
}

isOdd(1); // true, 1 is odd 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

#### [](#check-whether-indexof-returned-1-or-not)æ£€æŸ¥ indexOf æ˜¯å¦è¿”å›-1:

```
var foo = 'abc';
!~foo.indexOf('bar'); // true 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

##### [](#flip-a-boolean-value)ç¿»è½¬ä¸€ä¸ªå¸ƒå°”å€¼:

```
var foo = 1;
var bar = 0;

foo ^= 1 // 0
bar ^= 1 // 1 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

* * *

JavaScript ä¸­çš„ä½æ“ä½œç¬¦å¼•å…¥äº†å¥‡æ€ªçš„æƒ…å†µï¼Œå…¶ä¸­`(12 & 9) === 8`å’Œ`(12 & 3) === 0`ï¼Œå¦‚æœä½ ä¸€å¼€å§‹ä¸æ˜ç™½ä¸‹é¢å‘ç”Ÿäº†ä»€ä¹ˆ(æˆ‘è®¤è¯†çš„å¤§å¤šæ•°äººéƒ½ä¸æ˜ç™½ï¼ŒåŒ…æ‹¬æˆ‘)ï¼Œè¿™çœ‹èµ·æ¥å®Œå…¨ä¸åˆé€‚ã€‚

åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ€§èƒ½å·®å¼‚æ˜¯å®Œå…¨å¯ä»¥å¿½ç•¥çš„ï¼Œå°½ç®¡å®ƒä»¬çœ‹èµ·æ¥å¾ˆæœ‰å¸å¼•åŠ›ã€‚å¦‚æœä½ çœŸçš„éœ€è¦æŒ¤å‡ºé‚£äº›å®è´µçš„å¾®ç§’æ—¶é—´ï¼Œä½ åº”è¯¥ç‰ºç‰²å¯è¯»æ€§æ¥æé«˜æ€§èƒ½ï¼Œå¦‚æœä½ è¿™æ ·åšäº†ï¼Œè¯·ç•™ä¸‹è¯„è®ºè§£é‡Šå‘ç”Ÿäº†ä»€ä¹ˆï¼Œè°çŸ¥é“å‘¢ï¼Œä¹Ÿè®¸æœ‰ä¸€å¤©ä½ ä¼šéœ€è¦å®ƒğŸ˜„ã€‚ä½¿ç”¨è¿™äº›ä½æŠ€å·§çš„å¦ä¸€ä¸ªåŸå› æ˜¯è®©ä½ çš„ä»£ç çœ‹èµ·æ¥æ¯”å®é™…æ›´å¤æ‚ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªæ„šè ¢çš„åŸå› ã€‚è¿˜æœ‰ä¸€äº›è¾¹ç¼˜æƒ…å†µéœ€è¦æ³¨æ„ï¼Œæ‰€ä»¥ä½ ä¸èƒ½ä»…ä»…ç”¨`~~`æ›¿æ¢ä½ å½“å‰æ‰€æœ‰çš„`Math.floor()`å‘¼å«ã€‚äº‹æƒ…å¾ˆå¯èƒ½ä¼šå¤±è´¥ã€‚

## [](#references)å‚è€ƒæ–‡çŒ®

*   åœ¨ JavaScript ä¸­ï¼Œæˆ‘åº”è¯¥åœ¨å“ªé‡Œä½¿ç”¨æŒ‰ä½è¿ç®—ç¬¦ï¼Ÿ