# å¦‚ä½•å¼ºåˆ¶åŒ…è£…å®‰è£…ä½¿ç”¨çº±çº¿è€Œä¸æ˜¯ npm

> åŸæ–‡:[https://dev . to/ascorbic/force-installs-to-use-yarn-not-NPM-1 lhf](https://dev.to/ascorbic/force-installs-to-use-yarn-not-npm-1lhf)

æŠ›å¼€å…³äºå“ªä¸ªèŠ‚ç‚¹åŒ…ç®¡ç†å™¨æ›´å¥½çš„äº‰è®ºä¸è°ˆï¼Œæœ‰ä¸€ç‚¹åº”è¯¥æ¸…æ¥šçš„æ˜¯ï¼Œåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­åˆ‡æ¢å®ƒä»¬ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºå†²çªçš„é”æ–‡ä»¶ä¼šä½¿é¡¹ç›®å¤„äºä¸å¯é¢„æµ‹çš„çŠ¶æ€ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªæœ‰æ¥è‡ª npm çš„`package-lock.json`çš„é¡¹ç›®ä¸­è¿è¡Œ yarnï¼Œé‚£ä¹ˆå®ƒä¼šè­¦å‘Šä½ ï¼Œä½†æ˜¯ npm ä¸ä¼šåè¿‡æ¥ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªæœ‰`yarn.lock`çš„é¡¹ç›®ä¸­è¿è¡Œ`npm install`ï¼Œå®ƒä¼šå¾ˆé«˜å…´åœ°å®‰è£…è¿™äº›åŒ…å¹¶åˆ›å»ºä¸€ä¸ª package-lock.json ä¾› yarn ä¸‹æ¬¡æŠ±æ€¨ã€‚è¿™æ˜¯æˆ‘çš„è§£å†³æ–¹æ¡ˆã€‚

å¦‚æœä½ ç»™ä½ çš„`package.json`æ·»åŠ ä¸€ä¸ª`"preinstall"`è„šæœ¬ï¼Œå®ƒä¼šåœ¨ npm æˆ– yarn å®‰è£…ä¹‹å‰è¿è¡Œã€‚å¦‚æœé€€å‡ºå¹¶æ˜¾ç¤ºé”™è¯¯ä»£ç ï¼Œåˆ™å®‰è£…ä¸­æ­¢ã€‚è¿™æ„å‘³ç€è¿™æ˜¯æ£€æŸ¥çš„æœ€ä½³åœ°ç‚¹ã€‚åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´ï¼Œç¯å¢ƒå˜é‡`$npm_execpath`è¢«è®¾ç½®ä¸º npm æˆ– yarn å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ£€æŸ¥å®‰è£…ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆã€‚æ‚¨å¯ä»¥ä½¿ç”¨ node æ¥æ£€æŸ¥è¿™ä¸€ç‚¹ï¼Œä½†è¿™çœ‹èµ·æ¥æœ‰äº›å¤šä½™ï¼Œæ‰€ä»¥æˆ‘å°†åœ¨è„šæœ¬ä¸­ç›´æ¥ä½¿ç”¨ shell å‘½ä»¤ã€‚æˆ‘å›æ˜¾å˜é‡çš„å†…å®¹ï¼Œé€šè¿‡ç®¡é“å°†å®ƒä¼ é€’ç»™`grep`ï¼Œå¦‚æœå®ƒä¸ yarn ä¸åŒ¹é…ï¼Œé‚£ä¹ˆå®ƒå°†å‡ºé”™é€€å‡ºã€‚(æˆ‘åœ¨ shell è„šæœ¬ä¸­çš„â¤ï¸è¡¨æƒ…):

```
echo "$npm_execpath" | grep -q "yarn\.js$" || (echo 'âš ï¸ Use yarn not npm! âš ï¸' && exit 1) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™å·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†æ˜¯å®ƒçœ‹èµ·æ¥å¾ˆæ··ä¹±ï¼Œå› ä¸ºå®ƒåœ¨è¿è¡Œæ—¶æ˜¾ç¤ºå®Œæ•´çš„å‘½ä»¤ï¼Œæ‰€ä»¥å³ä½¿ä¸€åˆ‡æ­£å¸¸ï¼Œçœ‹èµ·æ¥ä¹Ÿæœ‰ä¸€ä¸ªé”™è¯¯ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯è®©å®ƒæˆä¸ºä¸€ä¸ªå•ç‹¬çš„è„šæœ¬ï¼Œç”¨`--quiet`æ ‡å¿—è¿è¡Œã€‚æˆ‘ä»¬å¯ä»¥å†æ¬¡ä½¿ç”¨`$npm_execpath`æ¥ç¡®ä¿æˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„è„šæœ¬è¿è¡Œå®ƒ:

```
"scripts":  {  "preinstall":  "$npm_execpath --silent run checkyarn",  "checkyarn":  "echo \"$npm_execpath\" | grep -q \"yarn\\.js$\" || (echo 'âš ï¸  Use yarn not npm! âš ï¸ ' && echo && exit 1)"  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¦‚æœä½ è¿è¡Œ`npm install`ï¼Œä½ ä¼šå¾—åˆ°é”™è¯¯:

```
example git:(master) âœ— npm i

> example@0.0.1 preinstall /Users/matt/Documents/repos/example
> $npm_execpath --silent run checkyarn

âš ï¸  Use yarn not npm! âš ï¸

npm ERR! code ELIFECYCLE
errno 1 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

...ä½†æ˜¯å¦‚æœä½ è¿è¡Œ`yarn` :

```
âœ  example git:(master) âœ— yarn
yarn install v1.12.3
$ $npm_execpath --silent run checkyarn
[1/4] ğŸ”  Resolving packages...
success Already up-to-date.
âœ¨  Done in 1.35s. 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®‰è£…æ„‰å¿«ï¼