# æŠ“å–æ•°æ®ä»¥ç”Ÿæˆé™ä»·æ–‡ä»¶ï¼Œå¹¶ç”¨å†…å®¹å¡«å……é™æ€ç”Ÿæˆçš„ç«™ç‚¹

> åŸæ–‡:[https://dev . to/Parker agee/scraping-data-to-generate-markdown-files-and-populate-a-statically-generated-site-with-content-161 p](https://dev.to/parkeragee/scraping-data-to-generate-markdown-files-and-populate-a-statically-generated-site-with-content-161p)

### [](#-originally-posted-at-httpsblogparkerageecompostscrapingdatatogeneratemarkdownfilesandpopulateastaticallygeneratedsitewithcontent)**æœ€åˆå‘å¸ƒäº[https://blog . Parker agee . com/post/scraping-data-to-generate-markdown-files-and-populate-a-static-generated-site-with-content/](https://blog.parkeragee.com/post/scraping-data-to-generate-markdown-files-and-populate-a-statically-generated-site-with-content/)

[![Demo](../Images/83f4b9730c6b0a51780b53b5a9494b79.png "Demo")T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--zD3SXTYd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://ucarecdn.com/4a2ca4c5-6909-483c-8927-e49b5eb02d64/)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºæˆ‘æ˜¯å¦‚ä½•é€šè¿‡åˆ›å»ºä¸€ä¸ªè„šæœ¬é«˜æ•ˆåœ°å‘æˆ‘çš„ä¸€ä¸ªå®¢æˆ·ç½‘ç«™æ·»åŠ  300 å¤šä¸ªç½‘é¡µå†…å®¹çš„ï¼Œè¿™ä¸ªè„šæœ¬å°†æŠ“å–ç½‘é¡µå¹¶ä»è¿™äº›æ•°æ®ä¸­ç”Ÿæˆé™ä»·æ–‡ä»¶ã€‚

è¯¥å®¢æˆ·æ˜¯ä¸€å®¶å‡å‘ç»é”€å•†ï¼Œä»–ä»¬éœ€è¦ä»–ä»¬ç½‘ç«™ä¸Šæ‰€æœ‰å¯ç”¨å‡å‘çš„å›¾ç‰‡å’Œåç§°ã€‚å› æ­¤ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªè„šæœ¬ï¼Œä»åˆ¶é€ å•†çš„ç½‘ç«™ä¸Šè·å–æ‰€æœ‰ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨åˆ›å»ºæ¯ä¸ªé¡µé¢ï¼Œå¤åˆ¶å¹¶ç²˜è´´å›¾åƒå’Œåç§°ã€‚

æˆ‘ä»¬å¼€å§‹å§..

### [](#first-things-first)å…ˆåšç¬¬ä¸€ä»¶äº‹

æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæˆ‘ä»¬çš„è„šæœ¬å°†è¢«æ·»åŠ åˆ°å…¶ä¸­ã€‚ç»§ç»­è¿è¡Œ`mkdir content-scraper && cd $_`ã€‚è¿™å°†åˆ›å»ºæˆ‘ä»¬çš„ç›®å½•å¹¶å°†æˆ‘ä»¬ç§»å…¥å…¶ä¸­ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æƒ³è¿è¡Œ`npm init -y`æ¥è®¾ç½®æˆ‘ä»¬é¡¹ç›®çš„ package.json æ–‡ä»¶ã€‚

ä¸€æ—¦æˆ‘ä»¬åˆ›å»ºäº† package.json æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€äº›èŠ‚ç‚¹åŒ…æ¥å¸®åŠ©æˆ‘ä»¬å®ç°ç›®æ ‡ã€‚è¿è¡Œ`npm install --save path json2md axios cheerio fs-extra chalk`å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºå°†è¦å·¥ä½œçš„æ–‡ä»¶- `touch index.js`

### è®©æˆ‘ä»¬åœ¨ index.js ä¸­æ„å»ºæˆ‘ä»¬çš„ scipt

##### [](#add-node-packages)æ·»åŠ èŠ‚ç‚¹åŒ…

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¼•å…¥æ‰€æœ‰çš„èŠ‚ç‚¹åŒ…ã€‚

```
const path = require('path');
const json2md = require("json2md")
const axios = require('axios');
const cheerio = require('cheerio');
const fs = require('fs-extra');
const chalk = require('chalk'); 
```

ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†åœ¨æˆ‘ä»¬å¯åŠ¨è„šæœ¬æ—¶è¿è¡Œã€‚è®©æˆ‘ä»¬ä¸‹æ‹‰å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
async function go() {
    console.log('Running...');
}

go(); 
```

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œ`node index.js`ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç»ˆç«¯ä¸­å¾—åˆ°`Running...`ã€‚

##### [](#get-the-hmtl-of-the-web-page)è·å–ç½‘é¡µçš„ HMTL

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`cheerio.js`æ¥è·å–æˆ‘ä»¬æƒ³è¦æŠ“å–çš„ç½‘é¡µçš„ HTMLã€‚è®©æˆ‘ä»¬ä¸ºä»£ç åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚

å°†æ–°å‡½æ•°æ·»åŠ åˆ°æ‚¨çš„æ–‡ä»¶ä¸­ã€‚

```
async function getHtml(url) {
    const { data: html } = await axios.get(url);
    return html;
} 
```

è¿™å°†ä½¿ç”¨`axios`å‘å‡ºè¯·æ±‚ï¼Œå¹¶è·å–æˆ‘ä»¬ä¼ é€’ç»™å®ƒçš„ URL çš„ HTML å†…å®¹ã€‚æˆ‘ä»¬å°†æŠŠè¿™ä¸ª HTML è¿”å›ç»™ä¸‹é¢çš„`go()`å‡½æ•°ã€‚

åœ¨æˆ‘ä»¬å·²ç»æ·»åŠ çš„`go()`å‡½æ•°ä¸­ï¼Œè®©æˆ‘ä»¬åˆå§‹åŒ–`getHtml()`å‡½æ•°å¹¶æŠŠæˆ‘ä»¬çš„ URL ä¼ é€’ç»™å®ƒã€‚å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ‚¨çš„`go()`å‡½æ•°ä¸­:

```
async function go() {
    const url = process.argv[2];

    if (url === undefined) {
        console.log(chalk.white.bgRed.bold('Please provide a URL to scrape.'));
        console.log('Try something like:');
        console.log(chalk.green('node index.js https://www.hairuwear.com/raquel-welch/products-rw/signature-wig-collection-2/'));
        return;
    }

    const html = await getHtml(url);
    console.log(html);
} 
```

æˆ‘ä»¬æ­£åœ¨æ£€æŸ¥æ˜¯å¦é€šè¿‡ç»ˆç«¯ä¼ é€’äº†ä¸€ä¸ª URLã€‚å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬ä¼šåœ¨ç»ˆç«¯æ˜¾ç¤ºä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œè§£é‡Šå¦‚ä½•è¿è¡Œè„šæœ¬ã€‚å¦‚æœæˆ‘ä»¬ä¼ é€’äº†ä¸€ä¸ªæœ‰æ•ˆçš„ URLï¼Œé‚£ä¹ˆåœ¨è¿è¡Œè„šæœ¬ä¹‹åï¼Œæ‚¨åº”è¯¥ä¼šåœ¨æ‚¨çš„ç»ˆç«¯ä¸Šçœ‹åˆ°è¯¥é¡µé¢çš„ HTMLã€‚

##### [](#scrape-data-from-html)ä» HTML ä¸­æŠ“å–æ•°æ®

ç°åœ¨æˆ‘ä»¬å·²ç»ä»ç½‘é¡µä¸Šè·å¾—äº† HTMLï¼Œæˆ‘ä»¬éœ€è¦æ”¶é›†é™ä»·æ–‡ä»¶æ‰€éœ€çš„æ•°æ®ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°æ¥è·å– HTML å¹¶æŸ¥æ‰¾æˆ‘ä»¬çš„æ•°æ®ã€‚

```
async function getwigs(html) {

    // Load the HTML as a cheerio instance
    const $ = cheerio.load(html);

    // Find the products list elements
    const wigSpan = $('.products li');

    // We want to make a new directory for our markdown files to live
    const directory = path.join('.', 'wig-pages');
    await fs.mkdirs(directory);

    // Loop through wigs and get data
    for (let i = 0; i < wigSpan.length; i++) {

        // Giving ourselves a little feedback about the process
        console.log(`Getting ${i} of ${wigSpan.length - 1}`);

        // Get the DOM elements we need
        const wigLinkSpan = $(wigSpan[i]).find('a')[0];
        const wigNameSpan = $(wigLinkSpan).find('h3')[0];

        // Get wig link and name data
        const wigLink = $(wigLinkSpan).attr('href');
        const wigName = $(wigNameSpan).text();

        console.log(wigLink, wigName);
    }
} 
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨æˆ‘ä»¬çš„ HTML åœ¨`go()`å‡½æ•°ä¸­åˆå§‹åŒ–é‚£ä¸ªå‡½æ•°ã€‚æ‚¨çš„`go()`å‡½æ•°ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:

```
async function go() {
    const url = process.argv[2];

    if (url === undefined) {
        console.log(chalk.white.bgRed.bold('Please provide a URL to scrape.'));
        console.log('Try something like:');
        console.log(chalk.green('node index.js https://www.hairuwear.com/raquel-welch/products-rw/signature-wig-collection-2/'));
        return;
    }

    const html = await getHtml(url);
    const data = await getWigs(html);
    console.log(data);
} 
```

ç°åœ¨ï¼Œæ‚¨åº”è¯¥å¯ä»¥åœ¨é¡µé¢ä¸Šçœ‹åˆ°æ¯ä¸ªå‡å‘çš„é“¾æ¥å’Œåç§°ã€‚

##### [](#get-the-highres-image-from-the-wig-page)ä»å‡å‘é¡µé¢è·å–é«˜åˆ†è¾¨ç‡å›¾åƒ

å¦‚æœä½ æ³¨æ„åˆ°[æˆ‘ä»¬æ­£åœ¨çœ‹çš„è¿™ä¸ªé¡µé¢](https://www.hairuwear.com/raquel-welch/products-rw/signature-wig-collection-2/)ï¼Œè¿™äº›å›¾ç‰‡çš„åˆ†è¾¨ç‡éå¸¸ä½ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ç‚¹å‡»æ¯ä¸€ä¸ªå‡å‘ï¼Œå®ƒä¼šå¸¦ä½ åˆ°ä¸€ä¸ªå…³äºé‚£ä¸ªç‰¹å®šå‡å‘çš„è¯¦ç»†é¡µé¢ï¼Œä¸Šé¢æœ‰æ›´é«˜åˆ†è¾¨ç‡çš„ç…§ç‰‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦åšçš„æ˜¯ï¼Œå¯¹äºè¯¥é¡µé¢ä¸Šçš„æ¯ä¸ªå‡å‘ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è·å–è¯¦ç»†é¡µé¢çš„ HTMLï¼Œå¹¶ä»è¯¥é¡µé¢ä¸­æå–é«˜åˆ†è¾¨ç‡ç…§ç‰‡æ·»åŠ åˆ°æˆ‘ä»¬çš„æ•°æ®ä¸­ã€‚

æˆ‘ä»¬å°†é€šè¿‡è¿›å…¥æˆ‘ä»¬çš„`for`å¾ªç¯æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è·å¾— wig é“¾æ¥å’Œåç§°ï¼Œå¹¶åœ¨é‚£é‡Œæ·»åŠ ä»£ç ã€‚åº”è¯¥æ˜¯è¿™æ ·çš„:

```
async function getWigs(html) {

    // Load the HTML as a cheerio instance
    const $ = cheerio.load(html);

    // Find the products list elements
    const wigSpan = $('.products li');

    // We want to make a new directory for our markdown files to live
    const directory = path.join('.', 'wig-pages');
    await fs.mkdirs(directory);

    // Loop through wigs and get data
    for (let i = 0; i < wigSpan.length; i++) {

        // Giving ourselves a little feedback about the process
        console.log(`Getting ${i} of ${wigSpan.length - 1}`);

        // Get the DOM elements we need
        const wigLinkSpan = $(wigSpan[i]).find('a')[0];
        const wigNameSpan = $(wigLinkSpan).find('h3')[0];

        // Get wig link and name data
        const wigLink = $(wigLinkSpan).attr('href');
        const wigName = $(wigNameSpan).text();

        const wigDetailsHtml = await getHtml(wigLink);
        const wigHtml = cheerio.load(wigDetailsHtml);
        const imgSrc = wigHtml('div.images > a > img').attr('src');

        console.log(wigLink, wigName, imgSrc);
    }
} 
```

ä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬åœ¨è¿™é‡Œæ·»åŠ äº† 3 è¡Œä»£ç æ¥è·å¾—é«˜åˆ†è¾¨ç‡å›¾åƒã€‚

```
const wigDetailsHtml = await getHtml(wigLink);
const wigHtml = cheerio.load(wigDetailsHtml);
const imgSrc = wigHtml('div.images > a > img').attr('src'); 
```

æˆ‘ä»¬å°†é‡ç”¨æˆ‘ä»¬çš„`getHtml()`å‡½æ•°ï¼Œå¹¶å°† wig ç»†èŠ‚é¡µé¢é“¾æ¥ä¼ é€’ç»™å®ƒã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æ‰¾åˆ°é«˜åˆ†è¾¨ç‡å›¾åƒçš„ DOM å…ƒç´ ï¼Œå¹¶è·å–`src`å±æ€§çš„å€¼ã€‚ç°åœ¨æˆ‘ä»¬æœ‰äº†é«˜åˆ†è¾¨ç‡çš„å›¾åƒæºæ•°æ®ã€‚å¦‚æœä½ è¿è¡Œ`node index.js`ï¼Œä½ ä¼šæ³¨æ„åˆ°è„šæœ¬è¿è¡Œå¾—ç¨å¾®æ…¢äº†ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å‘å‡ºäº†é¢å¤–çš„è¯·æ±‚ï¼Œä½†æ˜¯æˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰æ•°æ®ã€‚

##### [](#json-to-markdown)JSON è¦é™ä»·äº†

ç°åœ¨ï¼Œæˆ‘ä»¬å°†é€šè¿‡`json2md`å°†æ‰€æœ‰è¿™äº›ç»“åˆåœ¨ä¸€èµ·ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå®ƒå°†è·å–æˆ‘ä»¬æ”¶é›†çš„æ•°æ®ï¼Œå¹¶ä¸ºæ¯ä¸ªå‡å‘åˆ›å»ºä¸€äº›é™ä»·ã€‚

```
async function generateMarkdown(data) {
    const heading = `---\ntitle: ${data.name}\nthumbnail: '${data.imgSrc}'\n---\n\n`;

    const md = await json2md([
        {
            h1: data.name
        },
        {
            link: {
                title: data.name,
                source: data.link,
            }
        },
        {
            img: {
                title: data.name,
                source: data.imgSrc,
            }
        }
    ]);

    return `${heading}${md}`;
} 
```

æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªéœ€è¦é¡µé¢çš„å‡å‘è¿è¡Œè¿™ä¸ªå‡½æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒæ·»åŠ åˆ°`getWigs()`å‡½æ•°çš„`for`å¾ªç¯ä¸­ã€‚ä½ çš„`getWigs()`å‡½æ•°ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:

```
async function getWigs(html) {

    // Load the HTML as a cheerio instance
    const $ = cheerio.load(html);

    // Find the products list elements
    const wigSpan = $('.products li');

    // We want to make a new directory for our markdown files to live
    const directory = path.join('.', 'wig-pages');
    await fs.mkdirs(directory);

    // Loop through wigs and get data
    for (let i = 0; i < wigSpan.length; i++) {

        // Giving ourselves a little feedback about the process
        console.log(`Getting ${i} of ${wigSpan.length - 1}`);

        // Get the DOM elements we need
        const wigLinkSpan = $(wigSpan[i]).find('a')[0];
        const wigNameSpan = $(wigLinkSpan).find('h3')[0];

        // Get wig link and name data
        const wigLink = $(wigLinkSpan).attr('href');
        const wigName = $(wigNameSpan).text();

        // Get high-res photo from detail page
        const wigDetailsHtml = await getHtml(wigLink);
        const wigHtml = cheerio.load(wigDetailsHtml);
        const imgSrc = wigHtml('div.images > a > img').attr('src');

        // create markdown here
        const markdown = await generateMarkdown({
            name: wigName,
            link: wigLink,
            imgSrc,
        });

        console.log(markdown);
    }
} 
```

ç°åœ¨ï¼Œå½“æ‚¨è¿è¡Œ`node index.js`æ—¶ï¼Œæ‚¨åº”è¯¥ä¼šå¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„é™ä»·:

```
---
title: If You Dare
thumbnail: 'https://www.hairuwear.com/wp-content/uploads/RW-ifyoudare.jpg'
---

# If You Dare

[If You Dare](https://www.hairuwear.com/product/if-you-dare/)

![If You Dare](https://www.hairuwear.com/wp-content/uploads/RW-ifyoudare.jpg) 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä»¥é™ä»·ä¸ºå†…å®¹çš„æ–‡ä»¶ã€‚åœ¨å‰ä¸€æ¬¡æ·»åŠ ä¹‹åæ·»åŠ è¿™ä¸¤è¡Œä»£ç :

```
const file = path.join('.', 'wig-pages', `${wigName.split('  ').join('-')}.md`);
await fs.writeFile(file, markdown); 
```

æ‰€ä»¥æˆ‘ä»¬çš„`getWigs()`å‡½æ•°ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:

```
async function getWigs(html) {

    // Load the HTML as a cheerio instance
    const $ = cheerio.load(html);

    // Find the products list elements
    const wigSpan = $('.products li');

    // We want to make a new directory for our markdown files to live
    const directory = path.join('.', 'wig-pages');
    await fs.mkdirs(directory);

    // Loop through wigs and get data
    for (let i = 0; i < wigSpan.length; i++) {

        // Giving ourselves a little feedback about the process
        console.log(`Getting ${i} of ${wigSpan.length - 1}`);

        // Get the DOM elements we need
        const wigLinkSpan = $(wigSpan[i]).find('a')[0];
        const wigNameSpan = $(wigLinkSpan).find('h3')[0];

        // Get wig link and name data
        const wigLink = $(wigLinkSpan).attr('href');
        const wigName = $(wigNameSpan).text();

        // Get high-res photo from detail page
        const wigDetailsHtml = await getHtml(wigLink);
        const wigHtml = cheerio.load(wigDetailsHtml);
        const imgSrc = wigHtml('div.images > a > img').attr('src');

        // create markdown here
        const markdown = await generateMarkdown({
            name: wigName,
            link: wigLink,
            imgSrc,
        });

        // Create new markdown file and add markdown content
        const file = path.join('.', 'wig-pages', `${wigName.split('  ').join('-')}.md`);
        await fs.writeFile(file, markdown);
    }
} 
```

ç°åœ¨ï¼Œæˆ‘ä»¬åº”è¯¥æœ‰ä¸€ä¸ªåä¸º`wig-pages`çš„ç›®å½•ï¼Œé‡Œé¢è£…æ»¡äº†åŒ…å«æˆ‘ä»¬æŠ“å–çš„å†…å®¹çš„ markdown æ–‡ä»¶ã€‚æ‚¨å¯ä»¥å°†è¯¥æ–‡ä»¶å¤¹å¤åˆ¶åˆ°ç½‘ç«™çš„å†…å®¹ç›®å½•(å–å†³äºæ‚¨çš„é™æ€ç«™ç‚¹ç”Ÿæˆå™¨)ä¸­ï¼Œç„¶åéƒ¨ç½²æ‚¨çš„æ›´æ”¹ğŸ‰ã€‚

è¿™åªæ˜¯å¦‚ä½•æŠ“å–æ•°æ®å¹¶ç”¨å†…å®¹å¡«å……é™æ€ç”Ÿæˆçš„ç«™ç‚¹çš„ä¸€ä¸ªä¾‹å­ã€‚è¯·éšæ„é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œå¹¶å°†å…¶åº”ç”¨äºæ‚¨è‡ªå·±çš„éœ€æ±‚ã€‚

### [](#resources)èµ„æº

*   [è¯¥è„šæœ¬çš„ Github repoã€‘](https://github.com/parkeragee/content-scraper)
*   [jsonmd](https://github.com/IonicaBizau/json2md)
*   [è½´](https://github.com/axios/axios)
*   [å†è§](https://github.com/cheeriojs/cheerio)
*   [fs-extra](http://adilapapaya.com/docs/fs-extra/)
*   [ç²‰ç¬”](https://github.com/chalk/chalk)