# ä¸ºä¸¥æ ¼é”™è¯¯æµ‹è¯•æ‰©å±• Gotests

> åŸæ–‡:[https://dev . to/jdheyburn/extending-gotests-for-strict-error-tests-4j 96](https://dev.to/jdheyburn/extending-gotests-for-strict-error-tests-4j96)

*è¿™æ˜¯æˆ‘åœ¨ dev.to ä¸Šçš„ç¬¬ä¸€ç¯‡å¸–å­ï¼Œå‘è‡ªæˆ‘çš„æ–°ä¸ªäººåšå®¢ï¼Œå¯ä»¥åœ¨[è¿™é‡Œ](https://jdheyburn.co.uk)æ‰¾åˆ°ã€‚å¸Œæœ›ä¸€æ—¦æˆ‘è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å°±å¯ä»¥è®© dev .ä» RSS
æºå‘å¸ƒäº†ï¼*

å¾ˆé«˜å…´æ”¶åˆ°æ‚¨çš„ä»»ä½•åé¦ˆï¼ğŸ˜ƒ

* * *

# Java ä¸­ä¸¥æ ¼çš„é”™è¯¯æµ‹è¯•

æˆ‘å–œæ¬¢é€šè¿‡ç¼–å†™æµ‹è¯•å’Œå®è·µæµ‹è¯•é©±åŠ¨å¼€å‘(TDD)æ¥ç¡®è®¤æˆ‘çš„ä»£ç çš„ç¨³å®šæ€§ã€‚å¯¹äº Javaï¼ŒJUnit æ˜¯æˆ‘é¦–é€‰çš„æµ‹è¯•æ¡†æ¶ã€‚å½“ç¼–å†™æµ‹è¯•æ¥ç¡®è®¤ä¸€ä¸ªå¼‚å¸¸è¢«æŠ›å‡ºæ—¶ï¼Œæˆ‘ä¸ºæ³¨é‡Š`@Test`ä½¿ç”¨äº†å¯é€‰å‚æ•°`expected`ï¼Œä½†æ˜¯æˆ‘å¾ˆå¿«å‘ç°è¿™ä¸ªè§£å†³æ–¹æ¡ˆä¸é€‚ç”¨äºæˆ‘ä¸ºä¸åŒçš„é”™è¯¯æ¶ˆæ¯å¤šæ¬¡å¼•å‘åŒä¸€ä¸ªå¼‚å¸¸ç±»çš„æ–¹æ³•ï¼Œä¹Ÿä¸é€‚ç”¨äºå¯¹è¿™äº›æ¶ˆæ¯çš„æµ‹è¯•ã€‚

è¿™åœ¨ç¼–å†™éªŒè¯æ–¹æ³•æ—¶å¾ˆå¸¸è§ï¼Œæ¯”å¦‚ä¸‹é¢çš„æ–¹æ³•ï¼Œå®ƒä¼šæ¥å—ä¸€ä¸ªç‹—çš„åå­—ï¼Œå¦‚æœå®ƒæ˜¯æœ‰æ•ˆçš„ï¼Œå°±è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚

```
public static boolean validateDogName(String dogName) throws DogValidationException {

    if (containsSymbols(dogName)) {
        throw new DogValidationException("Dogs cannot have symbols in their name!");
    }

    if (dogName.length > 100) {
        throw new DogValidationException("Who has a name for a dog that long?!");
    }

    return true;
} 
```

å¯¹äºè¿™ç§æ–¹æ³•ï¼Œä»…ä»…åœ¨æˆ‘ä»¬çš„æµ‹è¯•æ–¹æ³•ä¸Šä½¿ç”¨`@Test(expected = DogValidationException.class)`æ˜¯ä¸å¤Ÿçš„ï¼›æˆ‘ä»¬å¦‚ä½•ç¡®å®šå¼‚å¸¸æ˜¯å› ä¸º dogName.length è¿è§„è€Œå¼•å‘çš„ï¼Œè€Œä¸æ˜¯å› ä¸ºåŒ…å«ç¬¦å·ï¼Ÿ

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨ [Baeldung](https://www.baeldung.com/junit-assert-exception) ä¸Šé‡åˆ°äº† JUnit çš„`ExpectedException`ç±»ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤ŸæŒ‡å®šé¢„æœŸçš„é”™è¯¯æ¶ˆæ¯ã€‚è¿™é‡Œåº”ç”¨äºè¯¥æ–¹æ³•çš„æµ‹è¯•ç”¨ä¾‹:

```
@Rule
public ExpectedException exceptionRule = ExpectedException.none();

@Test
public void shouldHandleDogNameWithSymbols() {
    exceptionRule.expect(DogValidationException.class);
    exceptionRule.expectMessage("Dogs cannot have symbols in their name!");
    validateDogName("GoodestBoy#1");
} 
```

# [](#applying-to-golang)é€‚ç”¨äºæˆˆæœ—

å›åˆ° Golangï¼Œæœ‰ä¸€ä¸ªåä¸º`testing`çš„å†…ç½®åº“ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿæ–­è¨€æµ‹è¯•æ¡ä»¶ã€‚å½“ä¸ [Gotests](https://github.com/cweill/gotests) ç»“åˆä½¿ç”¨æ—¶â€”â€”ä¸€ä¸ªä»ä½ çš„ä»£ç ç¼–å†™æµ‹è¯•ä¸­ç”Ÿæˆ Go æµ‹è¯•çš„å·¥å…·ï¼Œå†ç®€å•ä¸è¿‡äº†ï¼æˆ‘å–œæ¬¢å®ƒä¸æˆ‘é€‰æ‹©çš„æ–‡æœ¬ç¼–è¾‘å™¨ VSCode çš„ Go æ‰©å±•æ†ç»‘åœ¨ä¸€èµ·çš„æ–¹å¼...).

å°†ä¸Šé¢çš„ Java `validateDogName`æ–¹æ³•è½¬æ¢æˆ Golang ä¼šäº§ç”Ÿç±»ä¼¼äº:
çš„ç»“æœ

```
func validateDogName(name string) (bool, error) {
    if containsSymbols(name) {
        return false, errors.New("dog cannot have symbols in their name")
    }

    if len(name) > 100 {
        return false, errors.New("who has a name for a dog that long")
    }

    return true, nil
} 
```

å¦‚æœæ‚¨æœ‰ä¸€ä¸ªè¿”å›`error`æ¥å£çš„ Go æ–¹æ³•ï¼Œé‚£ä¹ˆ gotests å°†ç”Ÿæˆä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„æµ‹è¯•:

```
func Test_validateDogName(t *testing.T) {
    type args struct {
        name string
    }
    tests := []struct {
        name    string
        args    args
        want    bool
        wantErr bool
    }{
        name: "Test error was thrown for dog name with symbols",
        args: args{
            name: "GoodestBoy#1",
        },
        want: false,
        wantErr: true,
    }
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            got, err := validateDogName(tt.args.name)
            if (err != nil) != tt.wantErr {
                t.Errorf("validateDogName() error = %v, wantErr %v", err, tt.wantErr)
                return
            }
            if got != tt.want {
                t.Errorf("validateDogName() = %v, want %v", got, tt.want)
            }
        })
    }
} 
```

ä»ä¸Šé¢æˆ‘ä»¬é™åˆ¶äº†æˆ‘ä»¬å¯ä»¥æ–­è¨€çš„é”™è¯¯ï¼Œè¿™é‡Œä»»ä½•è¿”å›çš„é”™è¯¯éƒ½å°†é€šè¿‡æµ‹è¯•ã€‚è¿™ç›¸å½“äºåœ¨ JUnit ä¸­ä½¿ç”¨`@Test(expected=Exception.class)`ï¼ä½†æ˜¯è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•...

## [](#modifying-the-generated-test)ä¿®æ”¹ç”Ÿæˆçš„æµ‹è¯•

æˆ‘ä»¬åªéœ€è¦å¯¹ç”Ÿæˆçš„æµ‹è¯•è¿›è¡Œä¸€äº›ç®€å•çš„ä¿®æ”¹ï¼Œå°±å¯ä»¥æ–­è¨€æµ‹è¯•é”™è¯¯æ¶ˆæ¯...

```
func Test_validateDogName(t *testing.T) {
    type args struct {
        name string
    }
    tests := []struct {
        name    string
        args    args
        want    bool
        wantErr error
    }{
        name: "Test error was thrown for dog name with symbols",
        args: args{
            name: "GoodestBoy#1",
        },
        want: false,
        wantErr: errors.New("dog cannot have symbols in their name"),
    }
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            got, err := validateDogName(tt.args.name)
            if tt.wantErr != nil && !reflect.DeepEqual(err, tt.wantErr) {
                t.Errorf("validateDogName() error = %v, wantErr %v", err, tt.wantErr)
                return
            }
            if got != tt.want {
                t.Errorf("validateDogName() = %v, want %v", got, tt.want)
            }
        })
    }
} 
```

ä»ä¸Šé¢æ¥çœ‹ï¼Œæœ‰ä¸‰ä¸ªå˜åŒ–ï¼Œè®©æˆ‘ä»¬åˆ†åˆ«çœ‹ä¸€ä¸‹:

1.  `wantErr error`
    *   æˆ‘ä»¬ä»`bool`å¼€å§‹æ”¹å˜å®ƒï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸å‡½æ•°è¿”å›çš„é”™è¯¯è¿›è¡Œæ¯”è¾ƒ
2.  `wantErr: errors.New("dog cannot have symbols in their name"),`
    *   è¿™å°±æ˜¯æˆ‘ä»¬æ‰€æœŸå¾…çš„é”™è¯¯ç»“æ„
3.  `if tt.wantErr != nil && !reflect.DeepEqual(err, tt.wantErr) {`
    *   æ£€æŸ¥ä»¥ç¡®ä¿æµ‹è¯•æ˜¯é¢„æœŸçš„é”™è¯¯ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†å…¶ä¸è¿”å›çš„é”™è¯¯è¿›è¡Œæ¯”è¾ƒ

ç¬¬ 3 ç‚¹æä¾›äº†é¢å¤–çš„æ”¯æŒï¼Œå¦‚æœæœ‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ²¡æœ‰é¢„æ–™åˆ°é”™è¯¯çš„è¯ã€‚è¯·æ³¨æ„`wantErr`æ˜¯å¦‚ä½•ä»ä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹ä¸­å®Œå…¨çœç•¥çš„ã€‚

```
{
    name: "Should return true for valid dog name",
    args: args{
        name: "Benedict Cumberland the Sausage Dog",
    },
    want: true,
} 
```

## [](#customising-gotests-generated-test)å®šåˆ¶ Gotests ç”Ÿæˆçš„æµ‹è¯•

Gotests ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸ºç”Ÿæˆæµ‹è¯•æä¾›è‡ªå·±çš„æ¨¡æ¿ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå®¹æ˜“åœ°é›†æˆåˆ°æ‚¨é€‰æ‹©çš„æ–‡æœ¬ç¼–è¾‘å™¨ä¸­ã€‚æˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åœ¨ VSCode ä¸­å®ç°è¿™ä¸€ç‚¹ã€‚

1.  æ£€æŸ¥ gotests å¹¶å°†æ¨¡æ¿ç›®å½•å¤åˆ¶åˆ°æ‚¨é€‰æ‹©çš„ä½ç½®

    *   `git clone https://github.com/cweill/gotests.git`
    *   `cp -R gotests/internal/render/templates ~/scratch/gotests`
2.  ç”¨[è¯¥è¦ç‚¹çš„å†…å®¹](https://gist.github.com/jdheyburn/978e7b84dc9c197bcdd41afece2edab5)è¦†ç›– function.tmpl çš„å†…å®¹

3.  å°†ä»¥ä¸‹è®¾ç½®æ·»åŠ åˆ° VSCode çš„ settings.json ä¸­

    *   `"go.generateTestsFlags": ["--template_dir=~/scratch/templates"]`

ä¸€æ—¦ä½ è¿™æ ·åšäº†ï¼Œæœªæ¥çš„æµ‹è¯•å°†ä¼šäº§ç”Ÿæ›´ä¸¥æ ¼çš„é”™è¯¯æµ‹è¯•ï¼ğŸ‰

# [](#closing)å…³é—­

æˆ‘çŸ¥é“ä¸Šé¢çš„å»ºè®®ä¼šä½¿ä½ çš„ä»£ç æ›´åŠ è„†å¼±ï¼Œå› ä¸ºä»£ç ä¼šå—åˆ°ä¸‹æ¸¸åº“çš„é”™è¯¯ä¿¡æ¯çš„å½±å“ã€‚ç„¶è€Œå¯¹æˆ‘è‡ªå·±æ¥è¯´ï¼Œæˆ‘æ›´å–œæ¬¢ç¼–å†™ä¸¥æ ¼çš„æµ‹è¯•ï¼Œå°½é‡å‡å°‘å…¶ä»–é”™è¯¯æ±¡æŸ“æµ‹è¯•çš„æœºä¼šã€‚

æˆ‘ä¹ŸçŸ¥é“å¥½å­©å­#1 å¯èƒ½æ˜¯ä¸€åªç‹—çš„æœ‰æ•ˆåå­—ï¼ğŸ¶