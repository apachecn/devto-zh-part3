# ç”¨æ™®é€š JavaScript ä»‹ç» RxJS æ¦‚å¿µ

> åŽŸæ–‡:[https://dev . to/creeland/intro-to-rxjs-concepts-with-vanilla-JavaScript-4aji](https://dev.to/creeland/intro-to-rxjs-concepts-with-vanilla-javascript-4aji)

æœ€è¿‘çš„ä¸€æ¬¡ç½‘ä¸Šç ”è®¨ä¼šå¯å‘äº†æˆ‘ï¼Œegghead.io å’Œ T2 ä¸€èµ·ä¸»æŒäº†è¿™æ¬¡ç ”è®¨ä¼šï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘å­¦åˆ°çš„ä¸œè¥¿ã€‚åœ¨ç½‘ä¸Šç ”è®¨ä¼šä¹‹å‰ï¼Œæˆ‘ä¸ç†Ÿæ‚‰ RxJSï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æŽ¥è§¦è§‚å¯Ÿè€…æ¨¡å¼ã€‚åœ¨å®ƒè¢«åˆ†è§£ä¹‹å‰ï¼Œè§‚å¯Ÿè€…ä¼¼ä¹Žæœ‰é­”åŠ›ã€‚

JavaScript æœ‰å¤šä¸ªä½¿ç”¨å›žè°ƒå‡½æ•°çš„ APIï¼Œè¿™äº› API åšå‡ ä¹Žç›¸åŒçš„äº‹æƒ…ï¼Œåªæ˜¯ç•¥æœ‰ä¸åŒã€‚

**æºªæµ**

```
stream.on('data', data => {
   console.log(data)
})
stream.on('end', () => {
   console.log("Finished")
})
stream.on('error', err => {
   console.error(err)
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ‰¿è¯º**

```
somePromise()
  .then(data => console.log(data))
  .catch(err => console.error(err)) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**äº‹ä»¶ç›‘å¬å™¨**

```
document.addEventListener('click', event => {
  console.log(event.clientX)
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ çœ‹åˆ°çš„å¤§è‡´æ¨¡å¼æ˜¯ï¼Œæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å¯¹è±¡å†…éƒ¨ï¼Œä½ æœ‰ä¸€äº›æ–¹æ³•æŽ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œæ¢å¥è¯è¯´ï¼Œä¸€ä¸ªå›žè°ƒã€‚å®ƒä»¬éƒ½åœ¨è§£å†³åŒä¸€ä¸ªé—®é¢˜ï¼Œä½†æ–¹å¼ä¸åŒï¼Œè¿™å¯¼è‡´æ‚¨å¿…é¡»æ‰¿æ‹…è®°ä½æ¯ä¸ª API çš„ç‰¹å®šè¯­æ³•çš„ç²¾ç¥žè´Ÿæ‹…ã€‚è¿™å°±æ˜¯ RxJS çš„ç”¨æ­¦ä¹‹åœ°ã€‚RxJS å°†æ‰€æœ‰è¿™äº›ç»Ÿä¸€åœ¨ä¸€ä¸ªå…¬å…±æŠ½è±¡ä¸‹ã€‚

é‚£ä¹ˆä»€ä¹ˆæ˜¯å¯è§‚æµ‹çš„å‘¢ï¼Ÿè¿™æ˜¯ä¸€ç§æŠ½è±¡ï¼Œå°±åƒæ•°ç»„ã€å‡½æ•°æˆ–å¯¹è±¡éƒ½æ˜¯æŠ½è±¡ä¸€æ ·ã€‚æ‰¿è¯ºå¯ä»¥è§£å†³ä¹Ÿå¯ä»¥æ‹’ç»ï¼Œç»™ä½ ä¸€ä¸ªä»·å€¼ã€‚ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡èƒ½å¤Ÿéšç€æ—¶é—´çš„æŽ¨ç§»è€Œé‡Šæ”¾å‡ºä»·å€¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®æµæˆ–ç›‘å¬ DOM äº‹ä»¶ã€‚

**ðŸ’€å¯è§‚å¯Ÿçš„éª¨æž¶**

```
const observable = {
  subscribe: observer => {

  },
  pipe: operator => {

  },
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯è§‚å¯Ÿå¯¹è±¡åªæ˜¯åŒ…å«ä¸€ä¸ª`subscribe`å’Œ`pipe`æ–¹æ³•çš„å¯¹è±¡ã€‚ç­‰ç­‰ï¼Œè¿™æ˜¯æ€Žä¹ˆå›žäº‹ï¼Ÿä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…ï¼Œæˆ–è€…ç®—ç¬¦ï¼Ÿè§‚å¯Ÿè€…åªæ˜¯åŒ…å«äº†`next`ã€`error`å’Œ`complete`çš„å›žè°ƒæ–¹æ³•çš„å¯¹è±¡ã€‚`subscribe`æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªè§‚å¯Ÿå™¨å¹¶å°†å€¼ä¼ é€’ç»™å®ƒã€‚æ‰€ä»¥å¯è§‚å¯Ÿæ˜¯å……å½“ç”Ÿäº§è€…ï¼Œè§‚å¯Ÿè€…æ˜¯å®ƒçš„æ¶ˆè´¹è€…ã€‚

**ðŸ‘€**è§‚å¯Ÿè€…

```
const observer = {
  next: x => {
    console.log(x)
  },
  error: err => {
    console.log(err)
  },
  complete: () => {
    console.log("done")
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™ä¸ª`subscribe`æ–¹æ³•ä¸­ï¼Œæ‚¨å°†æŸç§å½¢å¼çš„æ•°æ®ä¼ é€’ç»™è§‚å¯Ÿè€…çš„æ–¹æ³•ã€‚

**è®¢é˜…æ–¹æ³•**

```
const observable = {
  subscribe: observer => {
    document.addEventListener("click", event => {
      observer.next(event.clientX)
    })
  },
  pipe: operator => {

  },
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œæˆ‘ä»¬åªæ˜¯ç›‘å¬æ–‡æ¡£ä¸­ä»»ä½•åœ°æ–¹çš„ç‚¹å‡»ã€‚å¦‚æžœæˆ‘ä»¬è¿è¡Œè¿™ä¸ªç¨‹åºå¹¶è°ƒç”¨`observable.subscribe(observer)`ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä½ ç‚¹å‡»çš„ x åæ ‡æ˜¾ç¤ºåœ¨æŽ§åˆ¶å°ä¸Šã€‚é‚£ä¹ˆè¿™ä¸ª`pipe`æ–¹æ³•å‘¢ï¼Ÿ`pipe`æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªæ“ä½œç¬¦å¹¶è¿”å›žä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ç”¨å¯è§‚å¯Ÿå¯¹è±¡è°ƒç”¨ç»“æžœå‡½æ•°ã€‚

**ç®¡æ³•**

```
const observable = {
  subscribe: observer => {
    document.addEventListener("click", event => {
      observer.next(event.clientX)
    })
  },
  pipe: operator => {
    return operator(this)
  },
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é…·ï¼Œä½†ä»€ä¹ˆæ˜¯è¿è¥å•†ï¼Ÿè¿ç®—ç¬¦ç”¨äºŽè½¬æ¢æ•°æ®ã€‚æ•°ç»„æœ‰æ“ä½œç¬¦ï¼Œåƒ`map`ã€‚`map`è®©æ‚¨åŽé€€ä¸€æ­¥ï¼Œå¯¹æ•°ç»„ä¸­çš„æ‰€æœ‰å†…å®¹è¿è¡Œä¸€äº›å‡½æ•°ã€‚ä½ å¯ä»¥æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åŽæ˜¯å¦ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªæ•°ç»„çš„æ˜ å°„ç‰ˆæœ¬ã€‚

è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„å¯è§‚æµ‹å€¼å†™ä¸€ä¸ª`map`å‡½æ•°ã€‚

**ðŸ—ºï¸åœ°å›¾æ“ä½œå‘˜**

```
const map = f => {
  return observable => {
    subscribe: observer => {
      observable.subscribe({
        next: x => {
          observer.next(f(x))
        },
        error: err => {
          console.error(err)
        },
        complete: () => {
          console.log("finished")
        }
      })
    },
    pipe: operator => {
      return operator(this)
    },
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œå‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ï¼Œè®©æˆ‘ä»¬æ¥åˆ†æžä¸€ä¸‹ã€‚

```
const map = f => {
  return observable => { 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªå‡½æ•°å¹¶è¿”å›žä¸€ä¸ªæœŸæœ›å¯è§‚æµ‹å€¼çš„å‡½æ•°ã€‚è¿˜è®°å¾—æˆ‘ä»¬çš„`pipe`æ–¹æ³•å—ï¼Ÿ

```
pipe: operator => {
  return operator(this)
}, 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†åœ¨å¯è§‚å¯Ÿå¯¹è±¡ä¸Šè¿è¡Œæ“ä½œç¬¦ï¼Œéœ€è¦å°†å®ƒä¼ é€’ç»™`pipe`ã€‚`pipe`å°†æŠŠå®ƒæ‰€è°ƒç”¨çš„å¯è§‚å¯Ÿå€¼ä¼ é€’ç»™æˆ‘ä»¬çš„è¿ç®—ç¬¦è¿”å›žçš„å‡½æ•°ã€‚

```
subscribe: observer => {
  observable.subscribe({ 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºè¿”å›žçš„å¯è§‚å¯Ÿå€¼å®šä¹‰`subscribe`æ–¹æ³•ã€‚å®ƒæœŸå¾…ä¸€ä¸ªè§‚å¯Ÿå™¨ï¼Œå½“`.subscribe`åœ¨è¿”å›žçš„å¯è§‚å¯Ÿå€¼ä¸Šè¢«è°ƒç”¨æ—¶ï¼Œæ— è®ºæ˜¯é€šè¿‡å¦ä¸€ä¸ªæ“ä½œç¬¦è¿˜æ˜¯æ˜¾å¼åœ°ï¼Œå®ƒéƒ½ä¼šæ”¶åˆ°è¿™ä¸ªè§‚å¯Ÿå™¨ã€‚ç„¶åŽï¼Œç”¨ä¸€ä¸ªè§‚å¯Ÿè€…å¯¹è±¡è°ƒç”¨`observable.subscribe`ã€‚

```
{
  next: x => {
    observer.next(f(x))
  },
  error: err => {
    console.error(err)
  },
  complete: () => {
    console.log("finished")
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è§‚å¯Ÿè€…çš„`next`æ–¹æ³•ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ï¼Œå¯¹æœªæ¥è§‚å¯Ÿè€…çš„`next`çš„è°ƒç”¨æ˜¯ç”¨æˆ‘ä»¬æœ€åˆä¼ é€’ç»™`map`çš„å‡½æ•°å’Œä¼ é€’ç»™`next`çš„`x`å€¼è¿›è¡Œçš„ã€‚è®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„å¯è§‚å¯Ÿå¯¹è±¡ä¸Šè¿è¡Œæ–°çš„`map`æ“ä½œç¬¦ï¼

```
observable
  .pipe(map(e => e.clientX))
  .pipe(map(x => x - 1000))
  .subscribe(observer) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

éœ€è¦ final `subscribe`ï¼Œå¦åˆ™è¿™äº›æ“ä½œç¬¦ä¸­çš„æ“ä½œéƒ½ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºå®ƒä»¬éƒ½è¢«åŒ…è£…åœ¨è§‚å¯Ÿè€…çš„`subscribe`æ–¹æ³•ä¸­ã€‚åœ¨é‚£äº›`subscribe`æ–¹æ³•ä¸­ï¼Œæ˜¯å¯¹é“¾ä¸­å‰ä¸€ä¸ªè§‚å¯Ÿè€…`subscribe`çš„è°ƒç”¨ï¼Œä½†æ˜¯é“¾å¿…é¡»ä»ŽæŸä¸ªåœ°æ–¹å¼€å§‹ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹è¿è¡Œæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

1.  ç¬¬ä¸€ä¸ªç®¡é“åœ¨ observable ä¸Šè¢«è°ƒç”¨ï¼Œ`map`åœ¨`this`ä¸Šè¢«æ‰§è¡Œ
2.  ç”¨`e => e.clientX`è°ƒç”¨`map`å¹¶è¿”å›žä¸€ä¸ªå‡½æ•°
3.  ä½¿ç”¨åŽŸå§‹çš„`observable`è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¹¶è¿”å›žä¸€ä¸ªå¯è§‚å¯Ÿå€¼
    1.  æˆ‘ä»¬ç§°ä¹‹ä¸ºå¯è§‚æµ‹çš„
4.  `pipe`è¢«å«ä¸Š`observable2`å’Œå’–å–±`map`ä¸Ž`this`
5.  ç”¨`x => x - 1000`è°ƒç”¨`map`å¹¶è¿”å›žä¸€ä¸ªå‡½æ•°
6.  ç”¨`observable2`è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¹¶è¿”å›žä¸€ä¸ªå¯è§‚å¯Ÿå€¼
    1.  æˆ‘ä»¬ç§°ä¹‹ä¸ºå¯è§‚æµ‹çš„
7.  `.subscribe`è¢«è°ƒç”¨`observable3`å¹¶ä¼ å…¥ä¸€ä¸ªè§‚å¯Ÿè€…
8.  `.subscribe`åœ¨`observable2`ä¸Šè¢«è°ƒç”¨ï¼Œæ“ä½œå‘˜çš„è§‚å¯Ÿè€…è¢«ä¼ å…¥
9.  `.subscribe`åœ¨åŽŸå§‹å¯è§‚å¯Ÿå€¼ä¸Šè°ƒç”¨å¸¦æœ‰æ“ä½œå‘˜çš„è§‚å¯Ÿè€…ä¼ å…¥
10.  ç‚¹å‡»äº‹ä»¶ä»¥`100`çš„`clientX`å‘ç”Ÿ
11.  `observer2.next(100)`æŽ¥åˆ°ç”µè¯
12.  `observer3.next(100)`æŽ¥åˆ°ç”µè¯
13.  `observer.next(-900)`è¢«è°ƒç”¨å¹¶å°†`-900`è®°å½•åˆ°æŽ§åˆ¶å°ã€‚
14.  æžå®šäº†ã€‚

ä½ å¯ä»¥çœ‹åˆ°è¿™é‡Œå‘ç”Ÿçš„è¿žé”ååº”ã€‚å½“æ‚¨è°ƒç”¨`subscribe`æ¥è¯·æ±‚ä¿¡æ¯æ—¶ï¼Œæ¯ä¸ªé“¾æŽ¥éƒ½å‘é“¾ä¸­çš„å‰ä¸€ä¸ªé“¾æŽ¥è¯·æ±‚ä¿¡æ¯ï¼Œç›´åˆ°å®ƒåˆ°è¾¾æ•°æ®ï¼Œå¹¶ä¸”æ¥è‡ªå…¶è§‚å¯Ÿè€…çš„`next`æ–¹æ³•è¢«è°ƒç”¨ã€‚ç„¶åŽï¼Œè¿™äº›æ•°æ®æ²¿ç€è¿™æ¡é“¾å‘ä¸Šä¼ é€’ï¼Œä¸€è·¯è½¬æ¢ï¼Œç›´åˆ°åˆ°è¾¾æœ€ç»ˆçš„è§‚å¯Ÿè€…ã€‚

è¿™æ˜¯å®Œæ•´çš„ä»£ç ã€‚

```
const observable = {
  subscribe: observer => {
    document.addEventListener("click", event => {
      observer.next(event.clientX)
    })
  },
  pipe: operator => {
    return operator(this)
  }
}

const observer = {
  next: x => {
    console.log(x)
  },
  error: err => {
    console.log(err)
  },
  complete: () => {
    console.log("done")
  }
}

const map = f => {
  return observable => {
    subscribe: observer => {
      observable.subscribe({
        next: x => {
          observer.next(f(x))
        },
        error: err => {
          console.error(err)
        },
        complete: () => {
          console.log("finished")
        }
      })
    },
    pipe: operator => {
      return operator(this)
    },
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>