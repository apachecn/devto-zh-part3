# ç±»å‹å®‰å…¨çš„ Vuex çŠ¶æ€åœ¨ç»„ä»¶ä¸­çš„ä½¿ç”¨(æ²¡æœ‰åŒæ ·å¤šçš„è£…é¥°å™¨)

> åŸæ–‡:[https://dev . to/sirtimbly/type-safe-vuex-state-usage-in-components-without-decorator-2b 24](https://dev.to/sirtimbly/type-safe-vuex-state-usage-in-components-without-decorators-2b24)

å¦‚æœä½ æœ€è¿‘å¼€å§‹äº†ä¸€ä¸ª Vue é¡¹ç›®å¹¶ä½¿ç”¨äº† Typescriptï¼Œä½ å¯èƒ½ä¼šç†Ÿæ‚‰ [vue-class-component](https://github.com/vuejs/vue-class-component) æˆ–è€…æ›´å¹¿æ³›çš„æ›¿ä»£ç‰© [vue-property-decorator](https://github.com/kaorun343/vue-property-decorator) ã€‚è¿™äº›åº“æä¾›äº†ç›®å‰åœ¨ typescript ä¸­å—æ”¯æŒçš„[Decorator](https://github.com/tc39/proposal-decorators)ï¼Œå…è®¸ Typescript å¼€å‘äººå‘˜ä½¿ç”¨ ES6 ç±»è¯­æ³•å’Œå£°æ˜æ€§â€œDecoratorâ€è¯­æ³•ç¼–å†™ vue ç»„ä»¶ï¼Œå£°æ˜æ€§â€œDecoratorâ€è¯­æ³•æå–å±æ€§æˆ–æ–¹æ³•å¹¶å°†å…¶åŒ…è£…åœ¨ç‰¹å®šçš„åŠŸèƒ½ä¸­ï¼Œå¦‚åœ¨è¿è¡Œæ—¶æ™®é€šç±»æˆå‘˜ä½¿è£…é¥°å±æ€§æˆä¸ºæœ€ç»ˆç»„ä»¶ props å¯¹è±¡çš„æˆå‘˜ä¹‹å‰çš„`@Prop`ã€‚

```
 import { Component, Prop, Vue } from "vue-property-decorator";

@Component
export default class PhotoCard extends Vue {
  @Prop()
  public url!: string;

  public imageSrc: string = this.url || "";
  public isEditing: boolean = false;

  public editPhoto() {
    this.isEditing = true;
  }

  public cancel() {
    this.isEditing = false;
  }
} 
```

æˆ‘ä¸èƒ½è‚¯å®šåœ°è¯´ç¼–å†™ Vue ç»„ä»¶çš„è£…é¥°è€…æ–¹å¼å®Œå…¨ä¼˜äºä½¿ç”¨`Vue.component()`å®šä¹‰ç»„ä»¶çš„ç»å…¸æ–¹å¼ï¼Œä½†æ˜¯å½“ä½ ä»ç»„ä»¶çš„æˆå‘˜å†…éƒ¨å¼•ç”¨ç»„ä»¶çš„å…¶ä»–éƒ¨åˆ†æ—¶ï¼Œå®ƒç¡®å®ä½¿è¯­æ³•æ›´åŠ çµæ´»å’Œç±»å‹å®‰å…¨ã€‚

ç°åœ¨ï¼Œä¸€æ—¦ä½ å†³å®šæŠ•å…¥åˆ°ç¼–å†™ Vue åº”ç”¨ç¨‹åºçš„â€œæ‰“å­—ç¨¿æ–¹å¼â€ä¸­ï¼Œä½ å¯èƒ½ä¼šå‘ç°è‡ªå·±åœ¨æƒ³å¦‚ä½•è®©**ä¸€åˆ‡éƒ½**æ‰“å­—å®‰å…¨ã€‚å½“ä½ å¤„ç† Vuex æ—¶ï¼Œè¿™ä¸ªé—®é¢˜å¾ˆå¿«å°±ä¼šå‡ºç°ã€‚å› ä¸ºï¼ŒVuex æ˜¯ä¸€ä¸ªç›¸å½“â€œé—´æ¥â€çš„ç¼–ç¨‹èŒƒå¼ã€‚æ‚¨å¿…é¡»é€šè¿‡æŸ¥çœ‹ Vuex å­˜å‚¨æœ¬èº«çš„æºä»£ç æ¥æ¨æ–­çŠ¶æ€å€¼çš„å­˜åœ¨ã€‚æ‚¨å¿…é¡»åœ¨ç»„ä»¶ä»£ç ä¸­ä½¿ç”¨â€œç¥å¥‡å­—ç¬¦ä¸²â€æ˜ å°„åˆ°çªå˜å’ŒåŠ¨ä½œã€‚ğŸ¤®

ä½ å¯èƒ½å·²ç»çœ‹è¿‡é¡¹ç›® [vuex-class](https://github.com/ktsn/vuex-class/) ï¼Œå®ƒä½¿å¾—ä½¿ç”¨ decorators å°†ç»„ä»¶çš„æˆå‘˜æ˜ å°„åˆ°ä½ çš„å•†åº—æˆä¸ºå¯èƒ½ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰åœ¨å•†åº—å’Œå®ƒåœ¨ç»„ä»¶ä¸­çš„ä½¿ç”¨ä¹‹é—´æä¾›ä¸€ä¸ªçœŸæ­£ç±»å‹å®‰å…¨çš„è€¦åˆã€‚è¿˜æ˜¯â€œé—´æ¥â€ã€‚æ‚¨å¿…é¡»é€šè¿‡æŸ¥çœ‹ vuex å•†åº—çš„æºä»£ç ï¼Œåœ¨ç»„ä»¶å†…éƒ¨è‡ªå·±å®šä¹‰å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹ã€‚

```
 const authModule = namespace("auth");

  // ...

    @authModule.State
    public authenticated: boolean;

    @authModule.State
    public user: IUser;

    @authModule.Action
    public handleReset: (email: string) => Promise<any>;

    public handleResetPassword() {
      this.handleReset(this.user.email).then(() => {
        this.showResetInstruction = true;
      });
    } 
```

æˆ‘æœ€è¿‘å‘ç°äº†ä¸€ä¸ªè§£å†³è¿™ä¸ªé—®é¢˜çš„æ›´å¥½çš„åº“ï¼Œå¹¶é‡æ„äº†ä¸€ä¸ªé¡¹ç›®æ¥ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥ï¼Œæˆ‘å°†ä¸ä½ åˆ†äº«å¦‚ä½•ä½¿ç”¨ [vuex-module-decorators](https://github.com/championswimmer/vuex-module-decorators) æ¥ä»£æ›¿ã€‚

å¦‚æœæ‚¨æ­£åœ¨ç¼–å†™æ¨¡å—å°† vuex å­˜å‚¨åˆ†æˆå¤šä¸ªä»£ç æ–‡ä»¶ï¼Œè¿™ç§æ–¹æ³•æœ€æœ‰æ•ˆã€‚

å½“ä½ ç¼–å†™å’Œå®šä¹‰ä½ çš„å•†åº—æ¨¡å—æ—¶ï¼Œä½ å°†ä½¿ç”¨ä¸€ä¸ªç±»è£…é¥°å™¨ï¼Œå°±åƒä½ ç¼–å†™ä¸€ä¸ª vue ç±»ç»„ä»¶ä¸€æ ·ã€‚

```
import { Module, VuexModule, Mutation, Action } from "vuex-module-decorators";
import Store from "../index";

@Module({
    dynamic: true,
    store: Store,
    name: "userAdmin",
    namespaced: true,
})
export default class UserAdminModule extends VuexModule {

    public userResults: GetUserDto[] = [];

    public rawResultSet: GetUserDto[] = [];

// ... 

    public get historyForUser(): GetAuditDto[] {
//        ...
    }

    @Mutation
    public loadResults({ data }: AxiosResponse<GetUserDto[]>) {
        if (data && data.length) {
            this.rawResultSet = data;
        }
    }

    @Action({ commit: "loadResults"})
    public async searchUsers(organization: string) {
        return await ApiClient.getUsers({ organization: organization || "1", sort: "name"});
    }
} 
```

è¯¥æ¨¡å—å°†åœ¨è¿è¡Œæ—¶åŠ¨æ€æ’å…¥åˆ°çˆ¶å­˜å‚¨ä¸­ã€‚ç±»ä¸­çš„ä»»ä½•â€œgetterâ€éƒ½å°†å˜æˆ vuex æ¨¡å—ä¸Šâ€œgetterâ€çš„æˆå‘˜ã€‚è£…æ½¢å¸ˆæŒ‰ç…§ç½å­ä¸Šè¯´çš„å»åšã€‚åœ¨ä¸€ä¸ªå˜å¼‚å‡½æ•°ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å‹å¥½çš„å¼ºç±»å‹è¯­æ³•`this.`æ¥ä¿®æ”¹å­˜å‚¨çš„å±æ€§ã€‚åœ¨ promise ä»å®ƒæ­£åœ¨è£…é¥°çš„å¼‚æ­¥å‡½æ•°ä¸­è§£æå‡ºæ¥ä¹‹åï¼Œ`@Action`è£…é¥°å™¨å°†è‡ªåŠ¨è°ƒç”¨æŒ‡å®šçš„å˜å¼‚ï¼Œå‡å°‘äº†ç¼–å†™åŠ¨ä½œçš„æ ·æ¿ä»£ç ï¼Œè¿™äº›åŠ¨ä½œåœ¨å®Œæˆåè°ƒç”¨å˜å¼‚ã€‚

### [](#so-how-do-you-access-this-module-in-a-typesafe-way-on-your-components)å¦‚æ­¤...å¦‚ä½•åœ¨ç»„ä»¶ä¸Šä»¥ç±»å‹å®‰å…¨çš„æ–¹å¼è®¿é—®è¿™ä¸ªæ¨¡å—ï¼Ÿ

åƒè¿™æ ·ã€‚æ‚¨å¯ä»¥åœ¨ç»„ä»¶ä¸­ä½¿ç”¨`getModule()`å‡½æ•°æ¥è·å–æ¨¡å—çš„ç±»å‹åŒ–å®ä¾‹ã€‚

```
import { getModule } from "vuex-module-decorators";
import UserAdmin from "@/store/modules/UserAdmin";

const userAdminState = getModule(UserAdmin);

@Component({
  components: {
    // ...
  },
})
export default class AdminUsersSearch extends Vue {
  public loading: boolean = false;

  public get filteredUsers(): GetUserDto[] {
    return userAdminState.filteredResults;
  }

  public mounted() {
    this.loading = true;
    userAdminState.searchUsers("1").then(x => this.loading = false);
  }

} 
```

æ³¨æ„:å¦‚æœä½ æ²¡æœ‰åˆ›å»ºä¸€ä¸ªâ€œåŠ¨æ€â€æ¨¡å—ï¼Œä½ éœ€è¦å°†å­˜å‚¨ä¼ é€’åˆ° getModule å‡½æ•°- [è§æ–‡æ¡£](https://championswimmer.in/vuex-module-decorators/pages/advanced/dynamic.html)ã€‚

åœ¨æ‚¨çš„ typescript ä»£ç ä¸­ï¼Œåªè¦æ‚¨é”®å…¥`userAdminState.`ï¼Œæ‚¨å°±ä¼šç«‹å³è·å¾— intellisense(åœ¨ VS ä»£ç  obv ä¸­ã€‚)å‘æ‚¨å±•ç¤ºäº† state æ¨¡å—ä¸­å¯ç”¨çš„çŠ¶æ€ã€gettersã€çªå˜å’ŒåŠ¨ä½œã€‚å¦‚æœæ‚¨éœ€è¦æ›´æ”¹ vuex æ¨¡å—çš„æŸäº›å±æ€§ï¼Œæ‚¨å°†åœ¨ä»»ä½•ç»„ä»¶ä¸­ä½¿ç”¨è¯¥æ¨¡å—å±æ€§çš„ä»»ä½•åœ°æ–¹å¾—åˆ°ç¼–è¯‘å™¨é”™è¯¯ï¼Œè¿™ä½¿å¾—å½“æ‚¨é‡æ„çŠ¶æ€ä»£ç æ—¶æ›´éš¾ç ´åæ‚¨çš„åº”ç”¨ç¨‹åºã€‚