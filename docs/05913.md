# è‡ªåŠ¨åŒ– chrome æ‰©å±•çš„ UI æµ‹è¯•

> åŸæ–‡:[https://dev . to/gokatz/automate-the-ui-testing-of-your-chrome-extension-52e 1](https://dev.to/gokatz/automate-the-ui-testing-of-your-chrome-extension-52e1)

æ„å»º chrome æ‰©å±•ç»å¯¹æ˜¯ä¸€ä¸ªæœ‰è¶£çš„è¿‡ç¨‹ï¼Chrome æ‰©å±•ä¸º web å¼€å‘è€…å’Œç”¨æˆ·æ‰“å¼€äº†ä¸€æ‰‡å…¨æ–°çš„å¤§é—¨ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æ–¹é¢ï¼Œæµ‹è¯•è¿™äº›å‡ºè‰²çš„æ‰©å±•å¹¶ä¸åƒæµ‹è¯•ä»»ä½•ä¼ ç»Ÿçš„ web åº”ç”¨ç¨‹åºé‚£æ ·ç®€å•ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥æ·»åŠ æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿æˆ‘ä»¬çš„æ‰©å±•æœ€å¥½ã€‚

## [](#why-automate-on-the-first-place)ä¸ºä»€ä¹ˆé¦–å…ˆè¦è‡ªåŠ¨åŒ–

æ‰‹å·¥æµ‹è¯•è¿‡ç¨‹æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­ä»¤äººåŒçƒ¦çš„äº‹æƒ…ä¹‹ä¸€ğŸ˜†éšç€ Chrome æ‰©å±•çš„**æ–°å®‰è£…**ã€**æ‰©å±•æ›´æ–°**ã€**æƒé™æ›´æ–°**ã€**æ‰©å±•é™çº§/åˆ é™¤**ç­‰å„ä¸ªæ–¹é¢ï¼Œè¿™ä¸ªè¿‡ç¨‹å˜å¾—æ›´åŠ æ£˜æ‰‹å’Œæ— èŠã€‚åœ¨æ¯ä¸ªç‰ˆæœ¬ä¸­ï¼Œå¾ˆå®¹æ˜“å¿½ç•¥ä¸€äº›æ–¹é¢çš„æµ‹è¯•ã€‚å› æ­¤ï¼Œè‡ªåŠ¨åŒ–è¿™äº›æ¯ç‡¥çš„ä¸œè¥¿å¯ä»¥ç¡®ä¿æˆ‘ä»¬çš„æ‰©å±•åœ¨æ¯ä¸€ä¸ªç‰ˆæœ¬ä¸­æ­£å¸¸å·¥ä½œã€‚

## [](#how-testing-can-be-done)å¦‚ä½•è¿›è¡Œæµ‹è¯•

æˆ‘ä»¬å°†ä½¿ç”¨**æœ¨å¶å¸ˆ**æµ‹è¯• chrome æ‰©å±•ï¼Œå¹¶ä½¿ç”¨**æ‘©å¡**æµ‹è¯•ç¨‹åºæ„å»ºæˆ‘ä»¬çš„æµ‹è¯•ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ **CircleCI** åœ¨æ‚¨çš„ CI/CD æµç¨‹ä¸­è‡ªåŠ¨åŒ–è¿™ä¸ªæµ‹è¯•è¿‡ç¨‹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•æ‚¨å–œæ¬¢çš„æµ‹è¯•è¿è¡Œç¨‹åºå’Œ CI/CD å·¥å…·ã€‚

è®©æˆ‘ä»¬å…ˆå®‰è£…æˆ‘ä»¬çš„ä¾èµ–é¡¹ï¼Œ

```
yarn add puppeteer mocha -D 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ–è€…

```
npm i puppeteer mocha --dev 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯ä»¥åœ¨æœ¨å¶å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œé€šè¿‡æ¨¡ä»¿æ‰‹å·¥æµ‹è¯•è¿‡ç¨‹ä¸­çš„æ­¥éª¤æ¥æµ‹è¯•æˆ‘ä»¬çš„ chrome æ‰©å±•ã€‚

*   æ‰“å¼€ Chrome æµè§ˆå™¨
*   åŠ è½½æ‰©å±•çš„æœªæ‰“åŒ…ç‰ˆæœ¬(é€šè¿‡`chrome://extensions`é¡µé¢å¼€å‘æ¨¡å¼)
*   æ‰“å¼€æˆ‘ä»¬çš„æ‰©å±•å¼¹å‡º/ç´¢å¼•é¡µé¢
*   æµ‹è¯•ç›®æ ‡ç‰¹æ€§

è®©æˆ‘ä»¬ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è‡ªåŠ¨åŒ–è¿™äº›æ­¥éª¤ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œè¯·éšæ—¶éšåœ°è¿è¡Œ(`node test.js`)æ¥æµ‹è¯•æˆ‘ä»¬åœ¨æ¯ä¸€æ­¥æ„å»ºçš„è„šæœ¬ã€‚

## [](#step-1-open-chrome-programmatically)æ­¥éª¤ 1:ä»¥ç¼–ç¨‹æ–¹å¼æ‰“å¼€ Chrome

ä½œä¸ºç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ç¼–ç¨‹æ–¹å¼æ§åˆ¶ Chromeã€‚è¿™æ­£æ˜¯*æœ¨å¶å¸ˆ*å¸®åŠ©æˆ‘ä»¬çš„åœ°æ–¹ã€‚æ ¹æ®æ–‡æ¡£ï¼ŒPuppeteer æ˜¯ä¸€ä¸ª**èŠ‚ç‚¹åº“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé«˜çº§ API æ¥æ§åˆ¶æ— å¤´(å’Œå®Œå…¨éæ— å¤´)Chrome** ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä»¥**å®Œæ•´å½¢å¼**å¯åŠ¨ Chromeï¼Œå› ä¸ºæ‰©å±•åªèƒ½ä»¥å®Œæ•´å½¢å¼åŠ è½½ã€‚

```
// test.js

const puppeteer = require('puppeteer');

let browser = await puppeteer.launch({
  headless: false, // extension are allowed only in head-full mode
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿è¡Œè„šæœ¬(`node test.js`)æ—¶ï¼Œchromium æ„å»ºå°†ä¼šä»¥ä¸€ä¸ªç©ºç™½é¡µé¢å¯åŠ¨ã€‚æ€æ­»èŠ‚ç‚¹è¿›ç¨‹ä»¥å…³é—­ Chromium æµè§ˆå™¨ã€‚

## [](#step-2-load-extensions)ç¬¬äºŒæ­¥:åŠ è½½æ‰©å±•

æ¥ä¸‹æ¥ï¼Œéœ€è¦å°†æˆ‘ä»¬çš„æ‰©å±•åŠ è½½åˆ° chrome ä¸­ã€‚å¯ä»¥ä½¿ç”¨æœ¨å¶å¸ˆç»™å‡ºçš„`--load-extension`æ ‡å¿—å°†æ‰©å±•åŠ è½½åˆ°æµè§ˆå™¨å®ä¾‹ä¸­ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦ç¦ç”¨æ‰€æœ‰å…¶ä»–æ‰©å±•ï¼Œä»¥é˜²æ­¢ä»»ä½•ä¸å¿…è¦çš„å™ªéŸ³ä½¿ç”¨`--disable-extensions-except`æ ‡å¿—ã€‚

```
// test.js

const extensionPath = <path-to-your-extension>; // For instance, 'dist'

const browser = await puppeteer.launch({
    headless: false, // extension are allowed only in the head-full mode
    args: [
        `--disable-extensions-except=${extensionPath}`,
        `--load-extension=${extensionPath}`
    ]
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿è¡Œè¿™ä¸ªè„šæœ¬æ—¶ï¼ŒChrome å®ä¾‹å°†å’Œä½ çš„æ‰©å±•ä¸€èµ·å¯åŠ¨ã€‚æ‚¨å¯ä»¥åœ¨å·¥å…·æ èœå•ä¸Šæ‰¾åˆ°æ‚¨çš„æ‰©å±•å¾½æ ‡ã€‚

## [](#step-3-go-to-the-extension-popup-page)ç¬¬ä¸‰æ­¥:è½¬åˆ°æ‰©å±•å¼¹å‡ºé¡µé¢

å½“æˆ‘ä»¬ç‚¹å‡»å·¥å…·æ èœå•ä¸­çš„æ‰©å±•å›¾æ ‡æ—¶ï¼Œå°†æ‰“å¼€æ‰©å±•å¼¹å‡º/ç´¢å¼•é¡µé¢ã€‚åŒæ ·çš„é¡µé¢å¯ä»¥ä½¿ç”¨`chrome-extension` URL ç›´æ¥æ‰“å¼€ï¼Œä»¥ç®€åŒ–æµ‹è¯•è¿‡ç¨‹ã€‚ä¸€ä¸ªæ­£å¸¸çš„æ‰©å±•é¡µé¢ URL ä¼šåƒ`chrome-extension://qwertyasdfgzxcvbniuqwiugiqwdv/index.html`ã€‚è¿™ä¸ª URL å¯ä»¥è¢«åˆ†è§£æˆï¼Œ

*   æ‰©å±•åè®®(`chrome-extension`)
*   æ‰©å±• ID ( `qwertyasdfgzxcvbniuqwiugiqwdv`)
*   å¼¹å‡º/ç´¢å¼•é¡µé¢è·¯å¾„(`index.html`)

ä¸ºäº†è®¿é—®é¡µé¢ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„æ‰©å±•æ„å»ºè¿™ç§ URLã€‚è¿™é‡ŒæœªçŸ¥çš„éƒ¨åˆ†æ˜¯**æ‰©å±• IDã€‚**å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ Chrome ç”Ÿæˆçš„æ‰©å±•çš„ä»»æ„ IDã€‚

### [](#know-your-extension-id-the-proper-way)äº†è§£ä½ çš„åˆ†æœº ID çš„æ­£ç¡®æ–¹æ³•

Chrome ä¼šåœ¨åŠ è½½æ—¶ç»™æ¯ä¸ªæ‰©å±•åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ‰©å±• IDã€‚æ¯æ¬¡æˆ‘ä»¬åœ¨æ–°çš„ Chrome å®ä¾‹ä¸Šå¯åŠ¨æ‰©å±•æ—¶ï¼Œè¿™å°†æ˜¯éšæœºçš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§[ä¸­æåˆ°çš„æ­¥éª¤è®¾ç½®ä¸€ä¸ªç‰¹å®šäºæˆ‘ä»¬çš„æ‰©å±•çš„ç¨³å®šçš„æ‰©å±• IDï¼Œæ‰€ä»¥è¯·å›ç­”](https://stackoverflow.com/questions/23873623/obtaining-chrome-extension-id-for-development/23877974#23877974)ã€‚è¿™å°†æ˜¯ä¸€ä¸ªæœ‰ç‚¹é•¿çš„è¿‡ç¨‹ï¼Œä½†å‚»ç“œè¯æ˜ã€‚æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°ä¾é ç¨³å®šçš„ ID æ¥æµ‹è¯•æˆ‘ä»¬çš„æ‰©å±•ï¼Œå› ä¸ºå½“ä½¿ç”¨ Puppeteer åœ¨å„ç§ Chrome å®ä¾‹ä¸­å¯åŠ¨æ—¶ï¼ŒID ä¸ä¼šæ”¹å˜ã€‚

### [](#know-your-extension-id-the-background-script-way)çŸ¥é“ä½ çš„æ‰©å±• ID:åå°è„šæœ¬æ–¹å¼

ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬çš„æ‰©å±•æœ‰åå°è„šæœ¬ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹å°±æœ‰ç‚¹ç®€å•äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–ç¨‹æ¥æ£€æµ‹æ‰©å±• IDã€‚

å½“ä½¿ç”¨åå°è„šæœ¬æ—¶ï¼Œä¸€æ—¦åŠ è½½äº†æ‰©å±•ï¼ŒChrome å°±ä¼šä¸ºåå°è„šæœ¬åˆ›å»ºä¸€ä¸ªç›®æ ‡(*æ­¥éª¤ 2* )ã€‚Chrome ç®¡ç†çš„æ‰€æœ‰é¡µé¢ç›®æ ‡éƒ½å¯ä»¥é€šè¿‡å¯åŠ¨çš„æµè§ˆå™¨å®ä¾‹çš„`targets`æ–¹æ³•è®¿é—®ã€‚ä½¿ç”¨è¿™äº›ç›®æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`title`å±æ€§(è¿™å°†æ˜¯æˆ‘ä»¬åœ¨`manifest.json`ä¸­ç»™å‡ºçš„æ‰©å±•æ ‡é¢˜)çš„å¸®åŠ©ä¸‹æ‹‰å‡ºæˆ‘ä»¬ç‰¹å®šçš„æ‰©å±•ç›®æ ‡ã€‚è¿™ä¸ªç›®æ ‡å°†åŒ…å« Chrome åœ¨å½“å‰å¯åŠ¨æ—¶åˆ†é…çš„éšæœºæ‰©å±• IDã€‚

```
// test.js

// This wait time is for background script to boot.
// This is completely an arbitrary one.
const dummyPage = await browser.newPage();
await dummyPage.waitFor(2000); // arbitrary wait time.

const extensionName = <name-of-your-extension> // For instance, 'GreetMe'

const targets = await browser.targets();
const extensionTarget = targets.find(({ _targetInfo }) => {
    return _targetInfo.title === extensionName && _targetInfo.type === 'background_page';
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸€æ—¦æ‚¨è·å–äº†æ‚¨çš„æ‰©å±•ç›®æ ‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»ç›®æ ‡ URL ä¸­æå– IDã€‚èƒŒæ™¯ç›®æ ‡ url ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼Œ`chrome-extension://qwertyasdfgzxcvbniuqwiugiqwdv/background.html`ã€‚å› æ­¤ï¼Œæå–å°†æ˜¯è¿™æ ·çš„:

```
const extensionUrl = extensionTarget._targetInfo.url || '';
const [,, extensionID] = extensionUrl.split('/'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æˆåŠŸåœ°è·å¾—äº†æˆ‘ä»¬çš„æ‰©å±• ID(é€šè¿‡ä»»ä½•ä¸€ç§æ–¹å¼)ğŸ’ª

### [](#en-route-to-the-extension-page)é€”ä¸­æ‰©å±•é¡µé¢ğŸšŒ

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è½¬åˆ°æˆ‘ä»¬çš„æ‰©å±•é¡µé¢ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æµè§ˆå™¨é¡µé¢å¹¶åŠ è½½é€‚å½“çš„æ‰©å±•å¼¹å‡º URLã€‚

```
 // test.js

// This is the page mentioned in `default_popup` key of `manifest.json`
const extensionPopupHtml = 'index.html'

const extensionPage = await browser.newPage();
await extensionPage.goto(`chrome-extension://${extensionID}/${extensionPopupHtml}`); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè¿è¡Œæµ‹è¯•è„šæœ¬å°†å¯åŠ¨ä¸€ä¸ªæ–°çš„ Chrome å®ä¾‹ï¼Œå¹¶æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢ï¼Œå…¶ä¸­åŒ…å«æ‚¨çš„æ‰©å±• popup HTML é¡µé¢å†…å®¹ï¼Œå°±åƒä¸€ä¸ªæ™®é€šçš„ web é¡µé¢ä¸€æ ·ã€‚

## [](#step-4-test-the-targeted-features)ç¬¬å››æ­¥:æµ‹è¯•ç›®æ ‡ç‰¹æ€§

æˆ‘ä»¬å·²ç»æˆåŠŸå¯åŠ¨äº†æˆ‘ä»¬çš„æ‰©å±•é¡µé¢ã€‚è¯¥æ˜¯ğŸ–çš„æ—¶å€™äº†

ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå€’ä¸€ä¸‹æˆ‘ä»¬çš„ web app æµ‹è¯•çŸ¥è¯†ã€‚ä¸æ¯ä¸ª web åº”ç”¨ç¨‹åºä¸€æ ·ï¼Œç«¯åˆ°ç«¯æµ‹è¯•å¯ä»¥ä½¿ç”¨ DOM æŸ¥è¯¢å’Œæ–­è¨€æ¥å®Œæˆã€‚åŒæ ·çš„é“ç†ä¹Ÿé€‚ç”¨äºæ­¤ã€‚æˆ‘ä»¬æ‰©å±•é¡µé¢çš„ DOM å¯ä»¥ä½¿ç”¨æœ¨å¶å¸ˆæä¾›çš„ [`$` ( `querySelector` )](https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pageselector) å’Œ[`$$`(`querySelectorAll`)](https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pageselector)API è¿›è¡ŒæŸ¥è¯¢ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ‚¨å–œæ¬¢çš„æ–­è¨€åº“ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†èŠ‚ç‚¹çš„æœ¬åœ° [`assert`](https://nodejs.org/api/assert.html) åŒ…ã€‚

```
// test.js

const assert = require('assert');

const inputElement = await extensionPage.$('[data-test-input]');
assert.ok(inputElement, 'Input is not rendered'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¯ä»¥ä½¿ç”¨ç”±æœ¨å¶å¸ˆæä¾›çš„å„ç§äº‹ä»¶ API åœ¨æ‰©å±•é¡µé¢ä¸Šè§¦å‘äº‹ä»¶ã€‚

```
await extensionPage.type('[data-test-input]', 'Gokul Kathirvel');
await extensionPage.click('[data-test-greet-button]');
const greetMessage  = await extensionPage.$eval('#greetMsg', element => element.textContent)
assert.equal(greetMessage, 'Hello, Gokul Kathirvel!', 'Greeting message is not shown'); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ³¨:**æœ¨å¶å¸ˆå¾—åˆ°äº†å¾ˆå¤šæœ‰ç”¨çš„[API](https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md)æ¥æ§åˆ¶å’Œæå– Chrome ä¸­æœ‰ç”¨çš„ä¿¡æ¯ã€‚

### [](#use-test-runners)ä½¿ç”¨æµ‹è¯•è·‘æ­¥è€…

ä¸ºäº†ä»¥æœ‰æ„ä¹‰çš„æ–¹å¼ä¿®è¡¥æµ‹è¯•å¹¶è·å¾—è‰¯å¥½çš„è§†è§‰åé¦ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµ‹è¯•è¿è¡Œç¨‹åºã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘å°†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ [`mocha`](https://mochajs.org/) æ¥æ„å»ºæˆ‘ä»¬çš„æµ‹è¯•ã€‚

```
// test.js

describe('Home Page', async function() {
  it('Greet Message', async function() {
    const inputElement = await extensionPage.$('[data-test-input]');
    assert.ok(inputElement, 'Input is not rendered');

    await extensionPage.type('[data-test-input]', 'Gokul Kathirvel');
    await extensionPage.click('[data-test-greet-button]');

    const greetMessage  = await extensionPage.$eval('#greetMsg', element => element.textContent)
    assert.equal(greetMessage, 'Hello, Gokul Kathirvel!', 'Greeting message is not shown');
  })
}); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#joining-all-the-pieces)å°†æ‰€æœ‰çš„ç¢ç‰‡æ‹¼æ¥èµ·æ¥

è®©æˆ‘ä»¬å°†æ‰€æœ‰éƒ¨åˆ†ç»“åˆèµ·æ¥ï¼Œä¸ºæ‚¨çš„æ‰©å±•åˆ›å»ºä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„æµ‹è¯•å¥—ä»¶ã€‚

```
// test.js

const puppeteer = require('puppeteer');
const assert = require('assert');

const extensionPath = 'src';
let extensionPage = null;
let browser = null;

describe('Extension UI Testing', function() {
  this.timeout(20000); // default is 2 seconds and that may not be enough to boot browsers and pages.
  before(async function() {
    await boot();
  });

  describe('Home Page', async function() {
    it('Greet Message', async function() {
      const inputElement = await extensionPage.$('[data-test-input]');
      assert.ok(inputElement, 'Input is not rendered');

      await extensionPage.type('[data-test-input]', 'Gokul Kathirvel');
      await extensionPage.click('[data-test-greet-button]');

      const greetMessage  = await extensionPage.$eval('#greetMsg', element => element.textContent)
      assert.equal(greetMessage, 'Hello, Gokul Kathirvel!', 'Greeting message is not shown');
    })
  });

  after(async function() {
    await browser.close();
  });
});

async function boot() {
  browser = await puppeteer.launch({
    headless: false, // extension are allowed only in head-full mode
    args: [
      `--disable-extensions-except=${extensionPath}`,
      `--load-extension=${extensionPath}`
    ]
  });

  const dummyPage = await browser.newPage();
  await dummyPage.waitFor(2000); // arbitrary wait time.

  const targets = await browser.targets();
  const extensionTarget = targets.find(({ _targetInfo }) => {
    return _targetInfo.title === 'GreetMe';
  });

  const extensionUrl = extensionTarget._targetInfo.url || '';
  const [,, extensionID] = extensionUrl.split('/');
  const extensionPopupHtml = 'index.html'

  extensionPage = await browser.newPage();
  await extensionPage.goto(`chrome-extension://${extensionID}/${extensionPopupHtml}`);
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨`mocha`å‘½ä»¤æ¥è¿è¡Œè¿™ä¸ªè„šæœ¬ã€‚

```
mocha test.js 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è®©æˆ‘ä»¬åœ¨`package.json`ä¸­åˆ›å»ºä¸€ä¸ª npm è„šæœ¬æ¥æ˜ å°„`mocha`å‘½ä»¤ã€

```
"scripts": {
  "test": "mocha test.js"
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒå°†è°ƒç”¨æµ‹è¯•å¹¶åœ¨ç»ˆç«¯ä¸­è¾“å‡ºæµ‹è¯•ç”¨ä¾‹çŠ¶æ€ã€‚

```
$ yarn test
$ mocha test.js

  Extension UI Testing
    Home Page
      âœ“ Greet Message (142ms)

  1 passing (5s) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­å–œï¼Œä½ èµ°åˆ°äº†æœ€åğŸ¤

æˆ‘ä»¬å·²ç»åˆ›å»ºäº†æµ‹è¯•æ‰©å±•é¡µé¢çš„ç¬¬ä¸€ä¸ªæµ‹è¯•å¥—ä»¶ã€‚æ˜¯æ—¶å€™ç”¨ CI æº¢å‡ºæ¥å¼¥è¡¥äº†ã€‚æˆ‘åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ä½¿ç”¨äº† **CircleCI** ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•æ­¤ç±»æœåŠ¡ï¼Œå¦‚ **TravisCI** ã€ **AppVeyor** ç­‰ã€‚,

### [](#wiring-up-with-ci)ç”¨ CI æ¥çº¿

ä¸º **CircleCI** ï¼Œ`.circleci/config.yml`åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¹¶åŠ è½½ä¸€äº›æ ·æ¿æ­¥éª¤ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸º`circleci/node:8.12.0-browsers`çš„å›¾åƒï¼Œå› ä¸ºè¿™ä¸ªå›¾åƒå·²ç»é¢„è£…äº† chromeï¼Œæˆ‘ä»¬ä¸éœ€è¦å®‰è£…ä»»ä½•è¿›ä¸€æ­¥çš„ä¾èµ–é¡¹ã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ä»»ä½•å…¶ä»–æœåŠ¡ï¼Œè¯·ä½¿ç”¨é¢„å»ºçš„æµè§ˆå™¨æ‰¾åˆ°åˆé€‚çš„å›¾åƒã€‚

```
version: 2
jobs:
  build:
    docker:
      - image: circleci/node:8.12.0-browsers

    working_directory: ~/repo

    steps:
      - checkout
      - restore_cache:
          keys:
          - v1-dependencies-{{ checksum "package.json" }}

          # fall back to using the latest cache if no exact match is found
          - v1-dependencies-

      # Install your dependencies
      - run: yarn install

      - save_cache:
          paths:
            - node_modules
          key: v1-dependencies-{{ checksum "package.json" }}

      # build the extension if required
      # Run our test suite 
      - run: yarn test 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å‘œå‘¼...å†æ¬¡ç¥è´ºã€‚æˆ‘ä»¬åˆšåˆšæˆåŠŸåœ°è‡ªåŠ¨åŒ–äº†æµ‹è¯•è¿‡ç¨‹ğŸ”¥ğŸ”¥å°è¯•è‡ªåŠ¨åŒ–æ‚¨ç°æœ‰çš„å’Œæœªæ¥çš„æ‰©å±•çš„æµ‹è¯•è¿‡ç¨‹ï¼Œå¹¶å¯¹æ‚¨æœªæ¥çš„ç‰ˆæœ¬ä¿æŒå†·é™ã€‚ç¤ºä¾‹æ‰©å±•ä»¥åŠå®ƒä»¬çš„(å·¥ä½œ)æµ‹è¯•å·²ç»æ‰˜ç®¡åœ¨ [GitHub](https://github.com/gokatz/greet-me-extension) ä¸­ã€‚å¦‚æœéœ€è¦å¸®åŠ©ï¼Œå¯ä»¥å‚è€ƒæºä»£ç ã€‚

å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œæˆ‘åœ¨è¿™ç¯‡[åšå®¢æ–‡ç« ](https://dev.to/gokatz/automate-your-chrome-extension-deployment-in-minutes-48gb/)ä¸­å†™äº†å…³äºåœ¨ CI/CD æµç¨‹ä¸­è‡ªåŠ¨åŒ– chrome æ‰©å±•éƒ¨ç½²çš„å†…å®¹ã€‚æ£€æŸ¥æ‚¨æ˜¯å¦æ­£åœ¨æ‰‹åŠ¨éƒ¨ç½²æ‚¨çš„æ‰©å±•ã€‚è¿™å¯èƒ½ä¹Ÿæ˜¯å®ç°è‡ªåŠ¨åŒ–çš„æ—¶å€™äº†ğŸ˜‰

[![gokatz](../Images/3a657c05e5c585bdb46e9cb6a6d3ec8b.png)](/gokatz) [## å‡ åˆ†é’Ÿå†…è‡ªåŠ¨å®Œæˆ chrome æ‰©å±•éƒ¨ç½²ï¼

### gokul Kathirvel 3 æœˆ 27 æ—¥ 18 æ—¶ 5 åˆ†è¯»å–

#chrome #extensions #webdev #javascript](/gokatz/automate-your-chrome-extension-deployment-in-minutes-48gb)

ä»Šå¤©åˆ°æ­¤ä¸ºæ­¢ã€‚è®©æˆ‘ä»¬ä¸‹æ¬¡å¸¦ç€å…¶ä»–ä»¤äººå…´å¥‹çš„ä¸œè¥¿è§é¢å§ã€‚å†è§äº†ã€‚å¦‚æœä½ æœ‰ä»»ä½•åé¦ˆæˆ–å»ºè®®ï¼Œè¯·åœ¨è¯„è®ºä¸­å‘è¡¨ã€‚æˆ‘å¾ˆä¹æ„ä¸ºæ­¤åŠªåŠ›ã€‚