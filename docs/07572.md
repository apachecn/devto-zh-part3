# ä½¿ç”¨ TypeScript è¿›è¡Œå½»åº•çš„ç±»å‹æ£€æŸ¥ï¼

> åŸæ–‡:[https://dev . to/babak/exhaustive-type-checking-with type script-4l3f](https://dev.to/babak/exhaustive-type-checking-with-typescript-4l3f)

# [](#introduction)ç®€ä»‹

å¦‚æœä½ èƒ½åœ¨å†™ä¸‹ä¸€ä¸ª bug çš„æ—¶å€™å°±å‘ç°å®ƒï¼Œé‚£ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿè¿™å°±æ˜¯é™æ€ç±»å‹åˆ†æçš„å…¨éƒ¨å†…å®¹ã€‚åœ¨*ç¼–è¯‘æ—¶*æ•æ‰ä½ è¾“å…¥çš„ bugã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ TypeScript æ˜¯å¦‚æ­¤é‡è¦çš„ç”Ÿäº§åŠ›åŠ©æ¨å™¨ï¼›å°¤å…¶æ˜¯åœ¨æœ€ä¸¥æ ¼çš„ç¯å¢ƒä¸‹ã€‚

TypeScript è¢«è®¾è®¡æˆ JavaScript çš„è¶…é›†ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæŸäº›ç‰¹æ€§å¿…é¡»é€šè¿‡æ¨¡å¼å’ŒåŸåˆ™æ¥è§£é”ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§å°±æ˜¯ç©·ä¸¾æ£€æŸ¥ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œå½»åº•çš„ç±»å‹æ£€æŸ¥å°±æ˜¯å½“ä½ çš„é™æ€ç¼–è¯‘å™¨æ£€æŸ¥ä½ æ²¡æœ‰ç•™ä¸‹æœªæ£€æŸ¥çš„å¯èƒ½æ€§ã€‚æ€è€ƒä¸€ä¸‹[ç©ºæ£€æŸ¥](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-0.html)æ˜¯å¦‚ä½•å·¥ä½œçš„ä¼šæœ‰æ‰€å¸®åŠ©ã€‚

```
function test(x: string | null) {
    if (x === null) {
        return;
    }
    x; // type of x is string in remainder of function
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸Šé¢çš„å‡½æ•°`test`æ¥å—ä¸€ä¸ªå‚æ•°`x`ï¼Œè¯¥å‚æ•°å¯ä»¥æ˜¯`string`æˆ–`null`ã€‚æ³¨æ„ï¼Œåœ¨å¸¦æœ‰ return è¯­å¥çš„`if`å—ä¸‹é¢ï¼ŒTypeScript çŸ¥é“`x`ç°åœ¨åªèƒ½æ˜¯`string`ã€‚

å¦‚æœæˆ‘ä»¬ç°åœ¨ä¸º`x`æ˜¯`string`ç±»å‹çš„æƒ…å†µæ·»åŠ å¦ä¸€ä¸ª`if`å—:

```
function test(x: string | null) {
  if (x === null) {
    return
  }
  if (typeof x === 'string') {
    return;
  }
  x; // type of x is never the remainder of the function
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é‚£ä¹ˆè¯¥å—ä¸‹é¢çš„`x`æ˜¯ç±»å‹`never`ã€‚`x`çš„æ‰€æœ‰å¯èƒ½æ€§éƒ½å·²ç»ç”¨å°½ã€‚æˆ‘ä»¬ç°åœ¨å‡†å¤‡è®¨è®ºç©·ä¸¾æ£€æŸ¥ã€‚

# [](#exhaustive-type-checking)ç©·ä¸¾å¼æ£€æŸ¥

TypeScript æ”¯æŒæ–‡æœ¬å€¼ä½œä¸ºç±»å‹ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°`makeDessert`ï¼Œå®ƒè·å–ä¸€ä¸ªç±»å‹ä¸º`Fruit`çš„æ°´æœï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²å€¼æ¥è¡¨ç¤ºåˆ¶ä½œçš„ç”œç‚¹çš„åç§°ã€‚

```
type Fruit = 'banana' | 'orange'
function makeDessert( fruit: Fruit ) {
  // make dessert from type Fruit
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬å¦‚ä½•è®©ç¼–è¯‘å™¨ç¡®ä¿æˆ‘ä»¬å·²ç»è¦†ç›–äº†`makeDessert`å‡½æ•°ä¸­`fruit`çš„æ‰€æœ‰å¯èƒ½å€¼ï¼Ÿ

æˆ‘ä»¬ä»æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„å€¼å¼€å§‹:

```
type Fruit = 'banana' | 'orange'
function makeDessert( fruit: Fruit ) {
  switch( fruit ) {
    case 'banana': return 'Banana Shake'
    case 'orange': return 'Orange Juice'
  }
  x // x has type never here
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› ä¸ºæˆ‘ä»¬å·²ç»æ£€æŸ¥äº†`banana`å’Œ`orange`ï¼Œ`x`åœ¨è¿™ä¸ª switch è¯­å¥çš„åº•éƒ¨æœ‰ä¸€ä¸ªç±»å‹`never`ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¸Œæœ›*å¯¹æ­¤è¿›è¡Œä¿é™©ã€‚*

ä»è¿™é‡Œå¼€å§‹ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚é¦–å…ˆæ˜¯æŒ‡å®šå‡½æ•°çš„è¿”å›ç±»å‹

```
function makeDessert( fruit: Fruit ): string {
  switch( fruit ) {
    case 'banana': return 'Banana Shake'
    case 'orange': return 'Orange Juice'
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å› ä¸ºæˆ‘ä»¬æŒ‡å®šäº†è¿”å›ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å¤„ç†ç‰¹å®šçš„æƒ…å†µï¼Œç¼–è¯‘å™¨ä¼šè®©æˆ‘ä»¬çŸ¥é“ã€‚ç„¶è€Œï¼Œç›®å‰ï¼Œå¦‚æœæƒ³åœ¨ switch è¯­å¥ä¸‹é¢`throw`ï¼Œè¿™ä¸ªå¥½å¤„å°±æ²¡æœ‰äº†ã€‚TypeScript å°†å‡è®¾`never`æ˜¯å¯æ¥å—çš„è¿”å›æƒ…å†µã€‚å¤„ç†æ”¶å…¥ç±»å‹ä¸º`any`ä¸”ä¸æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸ç¬¦çš„æƒ…å†µå¯èƒ½å¾ˆé‡è¦ã€‚

ç¬¬äºŒç§æ–¹æ³•â€”â€”ä½¿ç”¨åªæ¥å—ç±»å‹ä¸º`never`çš„å‚æ•°çš„å‡½æ•°ï¼Œè¿™å°±æ˜¯ switch è¯­å¥åº•éƒ¨çš„`x`ã€‚è¿™æ ·ï¼Œå¦‚æœç±»å‹`Fruit`æ”¹å˜äº†ï¼Œ`x`å°†ä¸å†æ˜¯ç±»å‹`never`ã€‚è¿™å°†è§¦å‘ä¸€ä¸ªç¼–è¯‘å™¨é”™è¯¯ï¼Œå°±åƒè¿™æ ·ï¼Œæˆ‘ä»¬æœ‰ç¼–è¯‘å™¨æ”¯æŒçš„ç©·ä¸¾æ£€æŸ¥ã€‚

æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ª:

```
type Fruit = 'banana' | 'orange'

function exhaustiveCheck( param: never ) { }

function makeDessert( fruit: Fruit ) {
  switch( fruit ) {
    case 'banana': return 'Banana Shake'
    case 'orange': return 'Orange Juice'
  }
  exhaustiveCheck( fruit ) // âœ… no error
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œå¦‚æœ`Fruit`åŒ…å«ä¸€ä¸ªå€¼`mango`ï¼Œæˆ‘ä»¬å°†æ”¶åˆ°ä¸€ä¸ªç¼–è¯‘å™¨é”™è¯¯ï¼Œé€šçŸ¥æˆ‘ä»¬ switch è¯­å¥åº•éƒ¨çš„`fruit`å¯ä»¥æ˜¯`mango`ã€‚

```
type Fruit = 'banana' | 'orange' | 'mango'

function exhaustiveCheck( param: never ) { }

function makeDessert( fruit: Fruit ) {
  switch( fruit ) {
    case 'banana': return 'Banana Shake'
    case 'orange': return 'Orange Juice'
  }
  exhaustiveCheck( fruit ) // ğŸš« ERROR! `mango` is not assignable to type `never`
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä¸ºäº†ä¿®å¤è¿™ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬å¿…é¡»å°†`mango`ä½œä¸ºä¸€ä¸ªå¯èƒ½çš„å€¼
æ¥å¤„ç†

```
type Fruit = 'banana' | 'orange' | 'mango'

function exhaustiveCheck( param: never ) { }

function makeDessert( fruit: Fruit ) {
  switch( fruit ) {
    case 'banana': return 'Banana Shake'
    case 'orange': return 'Orange Juice'
    case 'mango' : return 'Mango Smoothie'
  }
  exhaustiveCheck( fruit ) // âœ… no error, all values handled.
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ€åï¼Œä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œæˆ‘ä»¬åº”è¯¥é˜²æ­¢æ°´æœçš„å€¼ä¸º`any`çš„å¯èƒ½æ€§ï¼Œè¿™å°†å…³é—­ç±»å‹æ£€æŸ¥å¹¶å…è®¸ä»»ä½•å€¼ä¼ å…¥ makeDessertã€‚æˆ‘ä»¬é€šè¿‡åœ¨`exhaustiveCheck`å‡½æ•°ä¸­æŠ›å‡ºä¸€ä¸ªé”™è¯¯æ¥åšåˆ°è¿™ä¸€ç‚¹:

```
function exhaustiveCheck( param: never ): never { 
  throw new Error( 'should not reach here' )
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æœ¬æœŸ StackOverflow æ¦‚è¿°äº†æ­¤è§£å†³æ–¹æ¡ˆ:

[https://stack overflow . com/questions/39419170/how-do-I-check-a-switch-block-is-exhaustive-in-typescript](https://stackoverflow.com/questions/39419170/how-do-i-check-that-a-switch-block-is-exhaustive-in-typescript)

æˆ‘ä»¬èƒ½ä»¥ä¸€ç§ä¸é‚£ä¹ˆå†—é•¿çš„æ–¹å¼åœ¨ TypeScript ä¸­å®ç°ç©·ä¸¾æ£€æŸ¥å—ï¼Ÿæ›´å®ç”¨çš„æ–¹å¼ï¼Ÿ

æ˜¯å•Šæ˜¯å•Šï¼ğŸ˜…

# [](#helper-library)åŠ©æ‰‹åº“

æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåŠ©æ‰‹åº“

[https://github.com/babakness/exhaustive-type-checking](https://github.com/babakness/exhaustive-type-checking)

ä»¥åŠå®Œæ•´çš„è§†é¢‘æ•™ç¨‹ğŸ¬

[![](../Images/9efc6cfcc1dee1a954afca7be38c76d9.png)T2ã€‘](#)

ä¸ºäº†çªå‡ºä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹åˆ›å»º`makeDessert`:

```
const makeFruit = matchConfig<Fruit>()
const makeDessert = match({
  banana: () => 'Banana Shake'
  orange: () => 'Orange Juice'
  mango: () => 'Mango Smoothie'
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™ç§æ¨¡å¼æä¾›äº†ä¸€ç§æ›´å…·ç»„åˆæ€§çš„æ–¹å¼æ¥è¿›è¡Œå½»åº•çš„æ£€æŸ¥ï¼Œå¹¶å…·æœ‰ switch æ¨¡å¼æ‰€å…·æœ‰çš„è‡ªåŠ¨å®Œæˆçš„ä¼˜ç‚¹ã€‚

# [](#conclusion)ç»“è®º

ç©·ä¸¾æ£€æŸ¥ç¡®å®æœ‰åŠ©äºå‡å°‘è¿è¡Œæ—¶é”™è¯¯ã€‚äº‹å®ä¸Šï¼Œå³ä½¿æ˜¯æµ‹è¯•é©±åŠ¨çš„å¼€å‘ï¼Œå¦‚æœæˆ‘ä»¬ä»æ¥æ²¡æœ‰ç¼–å†™ä»£ç æ¥å¤„ç†æƒ…å†µï¼Œæˆ‘ä»¬çš„ä»£ç è¦†ç›–ç‡ç»Ÿè®¡ä¹Ÿä¸ä¼šåæ˜ å‡ºæˆ‘ä»¬æ²¡æœ‰æµ‹è¯•å®ƒã€‚

äº«å—å¹¶éšæ—¶è®¿é—®æˆ‘çš„æ¨ç‰¹å’Œæˆ‘çš„æ–° T2 YouTube é¢‘é“