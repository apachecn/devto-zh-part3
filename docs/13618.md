# é€šè¿‡ WebAssembly å­¦ä¹  Golang-Goã€WASMã€æ‰“å­—å’Œååº”

> åŸæ–‡:[https://dev . to/aaronpowell/learning-golang-through-web assembly-go-wasm-typescript-and-react-klm](https://dev.to/aaronpowell/learning-golang-through-webassembly---go-wasm-typescript-and-react-klm)

## [](#building-an-application)æ„å»ºåº”ç”¨ç¨‹åº

è¿™å®é™…ä¸Šæ˜¯æˆ‘åœ¨åšå®¢ä¸Šå†™çš„ä¸€ç³»åˆ—æ–‡ç« ä¸­çš„æœ€åä¸€ç¯‡ï¼Œå®ƒå½»åº•é¢ è¦†äº† Go çš„ WebAssembly æ–¹æ³•ã€‚å¦‚æœä½ æƒ³çœ‹æ•´ä¸ªç³»åˆ—[ï¼Œä»è¿™ç¯‡æ–‡ç« ](https://www.aaron-powell.com/posts/2019-02-04-golang-wasm-1-introduction/)å¼€å§‹ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†è®¸å¤šæœ€ç»ˆå°†æˆä¸ºåº”ç”¨ç¨‹åºçš„å°éƒ¨åˆ†ï¼Œæ˜¯æ—¶å€™è§£å†³è¿™ä¸ªé—®é¢˜äº†ï¼Œæ˜¯æ—¶å€™æ„å»ºä¸€ä¸ª web åº”ç”¨ç¨‹åºäº†ã€‚

æˆ‘å·²ç»å†³å®šï¼Œå¯¹äºè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†æ‹¼å‡‘ä¸€äº›æ‚¨å¯èƒ½ç»å¸¸ä½¿ç”¨çš„å…¶ä»–å·¥å…·ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ React ä½œä¸º UI åº“ï¼Œä½¿ç”¨ TypeScript ä½œä¸ºç¼–è¯‘åˆ° JavaScript çš„è¯­è¨€ã€‚ä½†æ²¡æœ‰ç†ç”±ä½ ä¸èƒ½ç”¨ Vueã€Angular æˆ–ä»»ä½•å…¶ä»– UI åº“æ›¿æ¢ Reactï¼Œå¹¶æ”¾å¼ƒâ€œæ™®é€šçš„æ—§ JavaScriptâ€çš„ TypeScriptã€‚ä½ ä¼šåœ¨æˆ‘çš„ GitHub ä¸Šæ‰¾åˆ°æ¼”ç¤ºåº”ç”¨[ã€‚](https://github.com/aaronpowell/go-wasm-experiments)

## [](#setting-up-our-application)è®¾ç½®æˆ‘ä»¬çš„åº”ç”¨

ä¸ºäº†å¼€å§‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [`create-react-app`å’Œ TypeScript](https://facebook.github.io/create-react-app/docs/adding-typescript) ï¼Œæˆ‘ä¸ä¼šé‡å¤åšé‚£ä¸ªè®¾ç½®ï¼ŒReact æ–‡æ¡£ä¸ºæˆ‘åšäº†å¾ˆå¥½çš„å·¥ä½œã€‚ä½ ä¸å¿…ä½¿ç”¨`create-react-app`ï¼Œè¿™åªæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„å¼•å¯¼æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœä½ æœ‰ä¿¡å¿ƒä¸ç”¨å®ƒï¼Œé‚£å°±è·³è¿‡è¿™ä¸€æ­¥ã€‚

ä¸€æ—¦ä½ åˆ›å»ºäº†ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†éœ€è¦[å¼¹å‡º`create-react-app`](https://facebook.github.io/create-react-app/docs/available-scripts#npm-run-eject) ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿä¿®æ”¹`webpack.config.js`æ–‡ä»¶ï¼Œè¿™åªèƒ½åœ¨ä½ å¼¹å‡º`create-react-app`æ—¶æ‰èƒ½å®Œæˆã€‚

## [](#getting-all-wasmy)å¾—åˆ°æ‰€æœ‰ WASM-y

æˆ‘ä»¬å°†ä»ä½¿ç”¨`npm`æˆ–`yarn` :
æ·»åŠ åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­åˆ›å»ºçš„[åŠ è½½å™¨å¼€å§‹](https://www.npmjs.com/package/golang-wasm-async-loader)

```
npm install --save-dev golang-wasm-async-loader
# or
yarn add golang-wasm-async-loader 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç„¶åç¼–è¾‘`configs/webpack.config.js`æ–‡ä»¶æ¥æ·»åŠ æˆ‘ä»¬çš„åŠ è½½ç¨‹åº(æŒ‰ç…§æ–‡ä»¶ä¸­çš„è¯´æ˜æ¥æ”¾ç½®å®ƒ):

```
{
    test: /\.go$/,
    loader: 'golang-wasm-async-loader'
}, 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#adding-our-wasm)æ·»åŠ æˆ‘ä»¬çš„ WASM

æˆ‘è¦åšä¸€ä¸ªå°åº”ç”¨ç¨‹åºï¼Œæ˜¾ç¤ºè‡³å°‘ 2 ä¸ªæ•°å­—è¾“å…¥å­—æ®µï¼Œå¹¶å°†æ‰€æœ‰çš„å€¼ç›¸åŠ å¾—åˆ°ä¸€ä¸ªå’Œï¼Œä»£ç å¦‚ä¸‹:

```
package main

import (
    "strconv"
    "syscall/js"

    "github.com/aaronpowell/webpack-golang-wasm-async-loader/gobridge"
)

func add(i ...js.Value) js.Value {
    ret := 0

    for _, item := range i {
        val, _ := strconv.Atoi(item.String())
        ret += val
    }

    return js.ValueOf(ret)
}

func main() {
    c := make(chan struct{}, 0)
    println("Web Assembly is ready")
    gobridge.RegisterCallback("add", add)
    <-c
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

éå¸¸ç®€å•ï¼Œæˆ‘ä»¬ä½¿ç”¨`range`æ¥æ£€æŸ¥`js.Value`çš„åˆ†å¸ƒï¼Œå°†æ¯ä¸€ä¸ªä»ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªæ•°å­—ï¼Œå¯¹å®ƒä»¬æ±‚å’Œï¼Œç„¶åè¿”å›è£…ç®±çš„`js.Value`ã€‚

æ¥ä¸‹æ¥ï¼Œåœ¨æˆ‘ä»¬çš„è¾“å…¥å­—æ®µä¸­ï¼Œæˆ‘ä¸ºè¿™ä¸ª
åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶`NumberInput.tsx`

```
import * as React from 'react';

export interface NumberInputProps {
    value: number
    onChange: (value: number) => void
}

const NumberInput : React.SFC<NumberInputProps> = ({ value, onChange }) => (
    <input type="number" value={value} onChange={(e) => onChange(parseInt(e.target.value, 10))} /> );

export default NumberInput; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å®ƒæ˜¯ä¸€ä¸ªæ— çŠ¶æ€ç»„ä»¶ï¼Œæ¥æ”¶ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ªæ˜¯è¾“å…¥å­—æ®µçš„å€¼ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨è¾“å…¥å­—æ®µå‘ç”Ÿå˜åŒ–æ—¶æ‰§è¡Œçš„å›è°ƒã€‚

æœ€åï¼Œæˆ‘ä»¬å°†åˆ¶ä½œ`<App />` :

```
import * as React from 'react';
import wasm from './main.go';
import NumberInput from './NumberInput';

const { add } = wasm;

interface State {
    value: number[]
    result: string
}

class App extends React.Component<{}, State> {
    constructor(props: {}) {
        super(props);

        this.state = {
            value: [0, 0],
            result: '0'
        };
    }

    async updateValue(index: number, value: number) {
        //todo
    }

    render() {
        return (
            <div>
                <p>Enter a number in the box below, on change it will add all the numbers together. Click the button to add more input boxes.</p>
                {this.state.value.map((value, index) =>
                    <NumberInput key={index} value={value} onChange={i => this.updateValue(index, i)} />
                )}
                <button type="button" onClick={() => this.setState({ value: [...this.state.value, 0]})}>More inputs!</button>
                <p>Value now is {this.state.result}</p>
            </div>
        );
    }
  }

export default App; 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å¥½çš„ï¼Œéå¸¸åŸºæœ¬ï¼Œå®ƒæ˜¯å¸¦çŠ¶æ€çš„ç»„ä»¶(æŠ±æ­‰ï¼Œè¿™é‡Œæ²¡æœ‰ redux æˆ– hooksğŸ˜)å…¶ä¸­ state åŒ…å«è¾“å…¥å€¼å’Œå½“å‰æ€»å’Œçš„æ•°ç»„ã€‚`render`å°†å¯¹è¾“å…¥å€¼è¿›è¡Œå¾ªç¯ï¼Œç”¨è¯¥å€¼åˆ›å»ºæˆ‘ä»¬çš„`<NumberInput />`ç»„ä»¶ï¼Œå¹¶ç»™å®ƒä¸€ä¸ªå‡½æ•°ï¼Œå½“å®Œæˆæ—¶è¯¥å‡½æ•°å°†è°ƒç”¨`updateValue`ã€‚è¯´æ˜å®ƒå·²åˆå§‹åŒ–ä¸º 2 ä¸ªè¾“å…¥ï¼Œä½†æ‚¨å¯ä»¥é€šè¿‡å±å¹•ä¸Šæ˜¾ç¤ºçš„æŒ‰é’®æ·»åŠ æ›´å¤šè¾“å…¥ã€‚

åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œä½ ä¼šçœ‹åˆ°æˆ‘ä»¬æ­£åœ¨ä»ä¸Šé¢å¯¼å…¥`main.go`æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨[ææ„èµ‹å€¼](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment)æ¥å¾—åˆ°`add`å‡½æ•°ï¼Œæˆ–è€…æ›´å‡†ç¡®åœ°è¯´ï¼Œä»åŠ è½½ç¨‹åºä¸ºæˆ‘ä»¬åˆ›å»ºçš„`Proxy`ä¸­å¼•ç”¨å®ƒã€‚

ç°åœ¨æ˜¯æ—¶å€™å®Œæˆæˆ‘ä»¬çš„`updateValue`æ–¹æ³•äº†ã€‚ä½†æ˜¯äº‹å®è¯æ˜ï¼Œä½¿ç”¨`add`å‡½æ•°å¯èƒ½æœ‰ç‚¹æ£˜æ‰‹ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå®šä¹‰ä¸º WASM çš„`any`è´¢äº§ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åœ¨å®ƒçš„è¡¨ç°æ–¹å¼ä¸Šæ›´æœ‰æ™ºæ…§å‘¢ï¼Ÿ

```
 async updateValue(index: number, value: number) {
        let newValues = this.state.value.slice();
        newValues[index] = value
        let result = await add<number, string>(...newValues);
        this.setState({ value: newValues, result });
    } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#using-types-with-our-proxy)ä½¿ç”¨ç±»å‹ä¸æˆ‘ä»¬çš„ä»£ç†

æˆ‘ä»¬å¦‚ä½•ç¡®ä¿ TypeScript çŸ¥é“æˆ‘ä»¬è¦ä¼ é€’ç»™ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°çš„å‚æ•°æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Ÿæœ€ç»ˆæˆ‘ä»¬æƒ³è¦æ‘†è„±`any`ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æˆ‘ä»¬æƒ³è¦ä½¿ç”¨ TypeScript æ³›å‹ï¼

æˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ç§æ–¹æ³•ä¸­çš„ä¸€ç§æ¥å®ç°ï¼Œç¬¬ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªå®šä¹‰æ–‡ä»¶ï¼Œä¸ºæˆ‘ä»¬çš„ WASM å¯¼å…¥åˆ›å»ºä¸€ä¸ªæ˜¾å¼æ¥å£:

```
declare module "*.go" {
    interface GoWrapper {
        add: (...params: number[]) => Promise<string>
    }

    var _: GoWrapper
    export default _
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåä¸º`definitions.d.ts`çš„æ–‡ä»¶ï¼Œå®ƒä½äº`App.tsx`æ–‡ä»¶æ—è¾¹ï¼Œé€šè¿‡ä¸º`*.go`å£°æ˜æ¨¡å—ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªå£°æ˜æ–‡ä»¶é€‚ç”¨äºä»»ä½•å¯¼å…¥çš„ Go æ–‡ä»¶ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ é™¤ä¸€èˆ¬çš„å‚æ•°ï¼Œè¿™å¾ˆå¥½ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³å¼€å§‹æ·»åŠ æ›´å¤šçš„ Go å‡½æ•°ï¼Œå°±æœ‰é—®é¢˜äº†ï¼Œæˆ‘ä»¬å¿…é¡»ä¸æ–­åœ°ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶æ¥åŒ…å«å®ƒä»¬ã€‚

æ‰€ä»¥ç–¯ç‹‚ä½¿ç”¨ generic æ€ä¹ˆæ ·ï¼

```
declare module "*.go" {
    interface GoWrapper {
        [K: string]: <T = any, R = any>(...params: T[]) => Promise<R>
    }

    var _: GoWrapper
    export default _
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç°åœ¨ï¼Œè¯·å¬æˆ‘è§£é‡Š:

*   æˆ‘ä»¬è¯´æˆ‘ä»¬æœ‰(`GoWrapper`)ç±»å‹çš„é”®ï¼Œå®ƒä»¬æ˜¯å¸¦æœ‰`[K: string]`çš„å­—ç¬¦ä¸²
*   æ¯ä¸ªé”®éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼Œå®ƒæ¥å—ä¸¤ä¸ªé€šç”¨å‚æ•°ï¼Œä¸€ä¸ªè¾“å…¥å’Œä¸€ä¸ªè¾“å‡ºï¼Œè¿™å°±æ˜¯`<T = any, R = any>`
*   è¿™äº›è¿›å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä¸­`T`æ˜¯ä¸€ä¸ª`params`æ•°ç»„ï¼Œç”¨`(...params: T[])`è¡¨ç¤º
*   è¿”å›ç±»å‹æ˜¯ä½¿ç”¨æŒ‡å®šè¿”å›ç±»å‹`Promise<R>`çš„`Promise`

æ‰€ä»¥å½“æˆ‘ä»¬åš`add<number, string>`æ—¶ï¼Œå®ƒè¯´æˆ‘ä»¬ä¼ å…¥äº†ä¸ç¡®å®šæ•°é‡çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°éƒ½æ˜¯æ•°å­—ï¼Œå®ƒå°†å¼‚æ­¥è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

è¿™ç§å¼ºåˆ¶ç±»å‹ä»æˆ‘ä»¬çš„çŠ¶æ€æµä¸‹æ¥ï¼Œåˆæµå›æ¥ï¼Œè¿™ä¸€åˆ‡éƒ½æ˜¯é€šè¿‡ TypeScript ç±»å‹çš„é­”åŠ›å®ç°çš„ï¼

å¦‚æœä½ åœ¨å‡½æ•°çš„å‚æ•°ä¸­ä½¿ç”¨æ··åˆç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åš:

```
let result = await something<string | number, string>("hello", 1, "world"); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½¿ç”¨`|`å‘Šè¯‰ TypeScript å‡½æ•°çš„å‚æ•°æ˜¯å­—ç¬¦ä¸²*æˆ–*æ•°å­—ç±»å‹ï¼Œè€Œä¸æ˜¯å‡½æ•°ã€å¸ƒå°”å€¼ç­‰..ç›¸å½“ç–¯ç‹‚å§ï¼

## [](#deploying-our-application)éƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨

æˆ‘ä»¬å®Œäº†ï¼åœ¨æœ¬åœ°æœ‰æ•ˆï¼ç°åœ¨æ˜¯æ—¶å€™æŠŠå®ƒéƒ¨ç½²åˆ°æŸä¸ªåœ°æ–¹äº†ã€‚

æˆ‘å°†ä½¿ç”¨ [Azure DevOps Pipelines](https://azure.microsoft.com/en-au/services/devops/?WT.mc_id=devto-blog-aapowell) æ¥æ„å»ºï¼Œç„¶åå°†å…¶éƒ¨ç½²ä¸ºä¸€ä¸ª [Azure Blob é™æ€ç½‘ç«™](https://docs.microsoft.com/en-au/azure/storage/blobs/storage-blob-static-website?WT.mc_id=devto-blog-aapowell)ã€‚

### [](#building)å»ºç­‘

è¦æ„å»ºï¼Œæ‚¨éœ€è¦è¿è¡Œä»¥ä¸‹æ­¥éª¤:

*   å®‰è£…æˆ‘ä»¬çš„ Go ä¾èµ–é¡¹
*   å®‰è£…æˆ‘ä»¬çš„ npm åŒ…
*   è¿è¡Œ webpack
*   å¤åˆ¶æ‰€éœ€çš„æ–‡ä»¶ä½œä¸ºæ„å»ºå·¥ä»¶

æˆ‘åœ¨ [GitHub repo](https://github.com/aaronpowell/go-wasm-experiments/blob/master/azure-pipelines.yml) ä¸­åˆ›å»ºäº†ä¸€ä¸ª [Azure DevOps YAML ç‰ˆæœ¬](https://docs.microsoft.com/en-us/azure/devops/pipelines/get-started-yaml?view=azdevops&WT.mc_id=devto-blog-aapowell)ã€‚å®ƒæ˜¯åœ¨æ ‡å‡† Node.js ç®¡é“ä¸Šå»ºæ¨¡çš„ï¼Œä½†æ˜¯æˆ‘æ·»åŠ äº†å…·ä½“çš„æ‰§è¡Œæ­¥éª¤ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ éœ€è¦ç”¨`go get`å®‰è£…åˆé€‚çš„ Go åŒ…ã€‚è¦ä½¿ç”¨æˆ‘ä¸ºåŠ è½½ç¨‹åºåˆ›å»ºçš„`gobridge`ï¼Œä½ è¿˜éœ€è¦è®¾ç½®`GOOS`å’Œ`GOARCH`:

```
- script: |
    GOOS=js GOARCH=wasm go get "github.com/aaronpowell/webpack-golang-wasm-async-loader/gobridge"
  displayName: 'install  gobridge' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ‚¨è¿˜éœ€è¦ç¡®ä¿`GOPATH`å’Œ`GOROOT`æ˜¯åŠ è½½ç¨‹åºå¯ç”¨çš„ç¯å¢ƒå˜é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›æ²¡æœ‰åœ¨ä»£ç†ä¸­è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œæˆ‘åªæ˜¯å†…åµŒè®¾ç½®äº†:

```
- script: |
    npm install
    GOPATH=$(go env GOPATH) GOROOT=$(go env GOROOT) npm run build
  displayName: 'npm  install,  run  webpack' 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä¸ºæ‰€æœ‰ä»»åŠ¡åˆ›å»ºå®ƒä»¬:

```
variables:
  GOBIN:  '$(GOPATH)/bin' # Go binaries path
  GOROOT: '/usr/local/go1.11' # Go installation path
  GOPATH: '$(system.defaultWorkingDirectory)/gopath' # Go workspace path 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ„å»ºï¼(å¿½ç•¥ä¹‹å‰æ‰€æœ‰å¤±è´¥çš„ğŸ˜†)

### [](#release)å‘å¸ƒ

åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæˆ‘ä»¬è¿˜ä¸æ”¯æŒ Azure DevOps ç®¡é“çš„ YAML æ–‡ä»¶ç‰ˆæœ¬ã€‚æˆ‘ä½¿ç”¨ [Azure æ–‡ä»¶å¤åˆ¶ä»»åŠ¡](https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/deploy/azure-file-copy?view=azdevops&WT.mc_id=devto-blog-aapowell)å°†æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°æˆ‘æ­£åœ¨è¿è¡Œçš„å­˜å‚¨å¸æˆ·ä¸­ï¼Œç„¶åä½¿ç”¨ [Azure CLI ä»»åŠ¡](https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/deploy/azure-cli?view=azdevops&WT.mc_id=devto-blog-aapowell)åœ¨ WASM æ–‡ä»¶ä¸Šè®¾ç½® WASM å†…å®¹ç±»å‹ï¼Œå¦åˆ™æ— æ³•æ­£ç¡®æä¾›:

```
az storage blob update --container-name "$web" --name "hello.wasm" --content-type "application/wasm" --account-name gowasm 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

*è®°å¾—æŠŠ`hello.wasm`æ”¹æˆä½ çš„æ–‡ä»¶åï¼*çœ¨çœ¨çœ¼:

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç‰ˆæœ¬ï¼

## [](#conclusion)ç»“è®º

æˆ‘ä»¬å®Œäº†ï¼Œä¼™è®¡ä»¬ï¼ä»ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ WebAssembly æˆ–å¦‚ä½•ç¼–å†™ Go å¼€å§‹ï¼Œæˆ‘ä»¬å·²ç»è¿›è¡Œäº†å¤§é‡çš„æ¢ç´¢ï¼Œäº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä½œä¸ºä¸€å web å¼€å‘äººå‘˜ï¼Œæ˜¯ä»€ä¹ˆä½¿ Go çš„ WebAssembly æ–¹æ³•å˜å¾—æœ‰ç‚¹æ£˜æ‰‹ï¼Œä»¥åŠæœ€ç»ˆæˆ‘ä»¬å¦‚ä½•å°† Go å¼•å…¥åˆ°æˆ‘ä»¬ç°åœ¨ç†Ÿæ‚‰çš„æ„å»º web åº”ç”¨ç¨‹åºçš„å·¥å…·é“¾ä¸­ã€‚

å¦‚æœä½ ç”¨å›´æ£‹å’Œ WASM æ„å»ºäº†ä»€ä¹ˆä»¤äººå…´å¥‹çš„ä¸œè¥¿ï¼Œè¯·è®©æˆ‘çŸ¥é“ï¼