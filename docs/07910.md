# å¦‚ä½•é¿å… Javascript Bugs

> åŸæ–‡:[https://dev . to/neutrino 2211/how-to-avoid-JavaScript-bugs-31pm](https://dev.to/neutrino2211/how-to-avoid-javascript-bugs-31pm)

æˆä¸ºä¸€å javascript ç¨‹åºå‘˜å¾ˆæ£’ï¼Œä½†æ˜¯æˆ‘ä»¬æ°¸è¿œæ— æ³•é¿å…å¯æ€•çš„å †æ ˆè·Ÿè¸ªï¼ğŸ˜¡ï¼Œè¿™äº›é”™è¯¯ä¸­çš„å¤§å¤šæ•°åªæ˜¯ä¸€ä¸ªè°·æ­Œæœç´¢å°±å¯ä»¥è§£å†³ï¼Œä½†æœ‰æ—¶è°·æ­Œæ— æ³•å¸®åŠ©ä½ ï¼Œä½ ä¼šè¢«è¿™ä¸ªä»¤äººå¤´ç—›çš„é”™è¯¯æ‰€å›°æ‰°ï¼Œä½†ä¸è¦æ‹…å¿ƒï¼Œå› ä¸ºæˆ‘æœ‰ä¸€äº›æŠ€å·§å¯ä»¥å¸®åŠ©ä½ é¿å…å¤§å¤šæ•°é”™è¯¯ã€‚

### [](#1-know-your-sources-and-sinks)1ã€‚äº†è§£ä½ çš„*æ¥æº*å’Œ*æ¥æº*

[![Sink](../Images/ccef6a1f62990b4c33878088b4a9575f.png)](https://i.giphy.com/media/3o7TKOuX9nFjq3bR5u/giphy.gif) 
é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯*æº*å’Œ*æ±‡*ï¼Œä¸€ä¸ª**æº**æ˜¯ç”Ÿæˆä¸€æ¡ä¿¡æ¯çš„è¿›ç¨‹ï¼Œä¸€ä¸ª**æ±‡**æ˜¯è¿™æ¡ä¿¡æ¯çš„æ¶ˆè´¹è€…ã€‚
ä¸¾ä¾‹:

`function doSomething(randomPercentage){ const percentString = randomPercentage + "%"; console.log(percentString); } const randomPercentage = Math.random()*100; // Math.random is the Source here. doSomething(randomPercentage); // And the doSomething function is the sink.`

è¿™çœ‹èµ·æ¥å¾ˆçç¢ï¼Œä»è¡¨é¢ä¸Šçœ‹ï¼Œä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œä½†çœ‹èµ·æ¥å¯èƒ½æ˜¯éª—äººçš„ï¼Œè¯¥å‡½æ•°ä¼¼ä¹åªåœ¨æ•°å­—çš„æœ«å°¾æ·»åŠ äº†ä¸€ä¸ªâ€œ%â€ï¼Œå¹¶æ˜¾ç¤ºç»“æœå­—ç¬¦ä¸²ï¼Œä½†å½“æ‰§è¡Œä»£ç æ—¶ï¼Œæ‚¨å°†å¾—åˆ°ç±»ä¼¼äºæ­¤`17.64650669753125%`çš„å†…å®¹ã€‚è¿™çœ‹èµ·æ¥ä¸å¤ªå¥½ã€‚

è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œè¯´æ˜å¦‚æœä½ ä¸ä»”ç»†æ£€æŸ¥ä½ çš„æ°´æºæˆ–æ±‡ï¼Œä¼šå‡ºä»€ä¹ˆé—®é¢˜ã€‚

ç™¾åˆ†æ¯”ä¸æ˜¯æ•´æ•°çš„åŸå› æ¥è‡ªäº`Math.random`å‡½æ•°ï¼Œå› ä¸ºå®ƒåªç”Ÿæˆæµ®ç‚¹æ•°ï¼Œè€Œæˆ‘ä»¬æ²¡æœ‰ **Math.floor** ã€‚æ‰€ä»¥è®©æˆ‘ä»¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜

`function doSomething(randomPercentage){ const percentString = randomPercentage + "%"; console.log(percentString); }` `const randomPercentage = Math.floor(Math.random()*100); doSomething(randomPercentage); // And our sink now receivs correct data.`

è¦ç‚¹æ˜¯æ‰¾åˆ°åœ¨æˆ‘ä»¬çš„å‡½æ•°ä¹‹å‰/è¢«æˆ‘ä»¬çš„å‡½æ•°ä½¿ç”¨çš„æ•°æ®ï¼Œå¹¶æ²¿ç€æµå‘ä¸Šå·¥ä½œï¼Œç›´åˆ°æˆ‘ä»¬æ‰¾åˆ°äº§ç”Ÿé”™è¯¯/æ„å¤–æ•°æ®çš„ç‚¹ã€‚

### [](#2-avoid-raw-undefined-endraw-)2ã€‚é¿å…`undefined`

[![Avoid](../Images/926f31bf49a37ce92ce3b3d73ce6e218.png)T2ã€‘](https://i.giphy.com/media/QA88yMhazfDI4/giphy.gif)

æœ‰æ—¶æˆ‘ä»¬ä¼šå·æ‡’ï¼Œç•™ä¸‹ä¸€äº›æœªå®šä¹‰çš„å˜é‡ï¼Œå¹¶æœŸæœ›å½“æˆ‘ä»¬ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œå®ƒä»¬ä¼šè¢«åˆå§‹åŒ–ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„ä»£ç æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯å½“éœ€è¦ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œæœ€å¥½æœ‰ä¸€ä¸ªé»˜è®¤å€¼ã€‚

ä¾‹å­

**é”™è¯¯çš„ç”¨æ³•ã€‚**

```
 let laterUsed;

doAsyncTask().then(()=>{
    useVariable(laterUsed); // âŒ It could still be undefined
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ­£ç¡®ç”¨æ³•ã€‚**

```
let laterUsed;

doAsyncTask().then(()=>{
    useVariable(laterUsed || externalAlternativeValue); 
    // âœ… Another value is used when the original value is undefined
}) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**æ›´æ­£ç¡®çš„ç”¨æ³•**

```
doAsyncTask()
  .then(result => {
    useVariable(laterUsed)
  })
  .catch(e => {
    // handle whatever happens when doAsyncTask() goes wrong
  }) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿˜æœ‰ï¼Œé¿å…

*   ä½¿ç”¨å…¨å±€å˜é‡åœ¨å¼‚æ­¥è¿›ç¨‹é—´é€šä¿¡ã€‚
*   ä½¿ç”¨`undefined`æŒ‡ç¤ºé”™è¯¯çŠ¶æ€ã€‚æˆ–è€…æ²¡æœ‰ä»·å€¼ã€‚

### [](#3-know-your-pasta)3ã€‚äº†è§£ä½ çš„**é¢é£Ÿï¼**

[![Pasta](../Images/ccccbdd60bad64fa52e5efea51005681.png)T2ã€‘](https://i.giphy.com/media/ToMjGpRhf96j23aTc5i/giphy.gif)

æœ‰è®¸å¤šä¸åŒçš„æ–¹å¼æ¥ç¼–å†™ä»£ç ï¼Œè¿™äº›é£æ ¼æœ‰åŸºäº pasta çš„åˆ†ç±»ï¼Œä½ éœ€è¦ç†è§£ä»¥ä¾¿çŸ¥é“ä½¿ç”¨å“ªç§é£æ ¼ã€‚

#### [](#spaghetti-code)æ„å¤§åˆ©é¢ä»£ç 

é¿å…è¿™ä¸€ç‚¹ï¼ŒçœŸæ­£çš„æ„å¤§åˆ©é¢æ˜¯å¦ç¾å‘³å¹¶ä¸é‡è¦ğŸ˜‹æ„å¤§åˆ©é¢æ¡å¼ä»£ç çš„ç‰¹ç‚¹æ˜¯ä»£ç æ‚ä¹±æ— ç« ï¼Œæ²¡æœ‰ä»»ä½•çœŸæ­£çš„ç»“æ„/æ¨¡å¼....å°±åƒæ„å¤§åˆ©é¢æ¡ä¸€æ ·ï¼Œè¿™ç§ä»£ç é£æ ¼å¾ˆå®¹æ˜“å‡ºç°å¾ˆå¤š bugï¼Œç”±äºå‰é¢æåˆ°çš„æ··ä¹±çš„ä»£ç åº“ï¼Œè¿™äº› bug å¾ˆéš¾è§£å†³ã€‚

#### [](#ravioli-code)é¥ºå­ç 

è¿™ç§ç¼–ç é£æ ¼å¤„äºä¸€ä¸ªéå¸¸å¥½çš„ä¸­é—´åœ°å¸¦ï¼Œç¨‹åºè¢«åˆ†è§£æˆä¸€äº›ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥å¾ˆå¥½åœ°ååŒå·¥ä½œï¼Œä½†ä¹Ÿå¯ä»¥ç‹¬ç«‹è¿è¡Œã€‚ä½ æ˜¯å¦å†™é¦„é¥¨ä»£ç æ˜¯åŸºäºä½ çš„ç¨‹åºæ˜¯å¦‚ä½•æ„é€ çš„ã€‚

#### [](#lasagna-code)åƒå±‚é¢ä»£ç 

javascript å¼€å‘çš„åœ£æ¯ï¼Œç»“æ„è‰¯å¥½çš„ç»„ä»¶è¢«åˆ†æˆå±‚ï¼Œé€šè¿‡å®šä¹‰è‰¯å¥½çš„æ¥å£æ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ã€‚å°½å¯èƒ½åœ°ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºå®ƒé™ä½äº†é”™è¯¯çš„é£é™©ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œå®ƒä»¬å°†è¢«é™åˆ¶åœ¨ç‰¹å®šçš„å±‚ã€‚

å¦ä¸€ä»¶è¦æ³¨æ„çš„äº‹æƒ…æ˜¯**å¿…è¦æ—¶è¯·ä½¿ç”¨ç±»å‹æ£€æŸ¥ã€‚**

### [](#4-dont-do-too-much-at-once)4ã€‚ä¸è¦ä¸€æ¬¡åšå¤ªå¤š

[![too much](../Images/b21dd36faade1815f76150ab2bedf3aa.png)T2ã€‘](https://i.giphy.com/media/3ohjV6xeE0OrC6QXq8/giphy.gif)

æœ‰æ—¶æˆ‘ä»¬å€¾å‘äºå†™å¾ˆå¤šä»£ç è€Œä¸æµ‹è¯•æ¯ä¸€æ­¥ï¼Œè¿™æ˜¯éå¸¸å±é™©çš„ï¼Œå› ä¸ºå½“ä¸€ä¸ªé”™è¯¯å‘ç”Ÿæ—¶ï¼Œä½ ä¸çŸ¥é“æ˜¯å“ªä¸ªæ–°ä»£ç å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ï¼Œè¿™å°†ä½¿ä½ è°ƒè¯•ä½ ä¸éœ€è¦çš„ä»£ç éƒ¨åˆ†ï¼Œè¿™æµªè´¹æ—¶é—´å¹¶ä¸”å¯èƒ½æ˜¯æœ‰å‹åŠ›çš„ã€‚

å› æ­¤ï¼Œæ¯æ¬¡ä½ æ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½æˆ–å†³å®šä»¥ä¸åŒçš„æ–¹å¼å‘é€ä½ çš„åº”ç”¨ç¨‹åºæ•°æ®æ—¶ï¼Œæ€»æ˜¯è¦è¿è¡Œä»£ç ä»¥ç¡®ä¿è¿™éƒ¨åˆ†æ˜¯æ­£ç¡®çš„ã€‚

### [](#45-use-linters)4.5ã€‚ä½¿ç”¨æ£‰ç»’

è¯·ä½¿ç”¨æ£‰ç»’ï¼ä»–ä»¬çœŸçš„å¾ˆæ“…é•¿å¸®åŠ©ä½ å®æ–½ä¸€ä¸ªå¥½çš„ç¼–ç é£æ ¼ï¼Œå¹¶ä¸ºä½ æ•æ‰é”™è¯¯ã€‚

## [](#conclusion)ç»“è®º

è¿™äº›æ˜¯æˆ‘ç»™ä½ çš„ä¸€äº›å»ºè®®ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å°½å¯èƒ½åœ°é¿å…é”™è¯¯ï¼Œå…¶ä¸­ä¸€äº›ä¹Ÿé€‚ç”¨äº javascript ä¹‹å¤–çš„å…¶ä»–è¯­è¨€ã€‚

*æœ‰è¶£çš„äº‹å®:æˆ‘æƒ³åˆ°äº†ç¬¬å››ç‚¹ï¼Œå› ä¸ºæˆ‘å†™äº†å¤ªå¤šæœªç»æµ‹è¯•çš„ä»£ç ï¼ŒèŠ±äº† 7 ä¸ªå°æ—¶è¯•å›¾è°ƒè¯•å®ƒ*

æ„Ÿè°¢è¿™äº›ä¼˜ç§€çš„äººç»™äº†æˆ‘å¾ˆå¥½çš„å»ºè®®ã€‚

[![jesuszilla_tm image](../Images/0eab4d389f098a95b3df01774ff96738.png)](/jesuszilla_tm)

## [Jesuszilla è€¶ç¨£å‰æ‹‰](/jesuszilla_tm)

[I got my start in programming with the MUGEN fighting game engine. I am the lead developer of a successor to the engine called Blugen.](/jesuszilla_tm)[![gypsydave5 image](../Images/ae3081c50d4c953e1125e67f5f086a97.png)](/gypsydave5)

## [å¤§å«Â·å¨å…‹æ–¯](/gypsydave5)T2ã€‘

[British. Strong opinions held weekly. No, that's not a typo. Teaches when and where and what I can.](/gypsydave5)

## [](#thanks-for-reading)æ„Ÿè°¢é˜…è¯»ï¼ï¼

*è€ƒè™‘åœ¨ [Twitter](https://twitter.com/neutrino2211) ä¸Šå…³æ³¨æˆ‘ï¼Œä½ å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„å¸–å­[è¿™é‡Œ](https://dev.to/neutrino2211/avoiding-weird-javascript-behaviour-true--true--2-but-true--1-pn9)*