# é€šè¿‡æ„å»ºç¬”è®°åº”ç”¨ç¨‹åºäº†è§£å­˜å‚¨ API

> åŸæ–‡:[https://dev . to/Healey codes/learn-the-storage-API-by-building-a-note-taking-app-6 H5](https://dev.to/healeycodes/learn-the-storage-api-by-building-a-note-taking-app-6h5)

è®©æˆ‘ä»¬é€šè¿‡ç”¨ä¸€äº›ç®€å•çš„ HTMLã€CSS å’Œ JavaScript æ„å»ºä¸€ä¸ªå°å°çš„ç¬”è®°åº”ç”¨æ¥äº†è§£`window.localStorage`ã€‚æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªå°çš„ UIï¼Œå¹¶å°†ç”¨æˆ·çš„æ³¨é‡Šè‡ªåŠ¨ä¿å­˜åˆ°ä»–ä»¬çš„æµè§ˆå™¨ä¸­ã€‚æˆ‘çš„åŒäº‹æŠŠä»–æ‰€æœ‰çš„ç‰‡æ®µéƒ½ä¿å­˜åœ¨è¿™æ ·çš„ä¸œè¥¿ä¸Šã€‚æˆ‘æ— æ³•ç›¸ä¿¡ä»–ä» 50-60 è¡Œä»£ç ä¸­è·å¾—çš„æ”¶ç›Šï¼

å¤§å¤šæ•°å®¢æˆ·ç«¯å­˜å‚¨äº¤äº’è¿‡å»éƒ½æ¶‰åŠåˆ°æ“ä½œ cookiesï¼Œä½†å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†ç°ä»£ APIã€‚ä½¿ç”¨ cookiesï¼Œç”¨æˆ·å‘é€æ¯ä¸ªè¯·æ±‚ä¸­å­˜å‚¨çš„æ‰€æœ‰å†…å®¹ï¼Œè¿™æ„å‘³ç€å¯¹åŒæ–¹æ¥è¯´æ€§èƒ½éƒ½æ›´å·®ã€‚

è¾“å…¥:`localStorage`ã€‚åœ¨`window`å¯¹è±¡ä¸Šå¯ç”¨çš„é”®/å€¼ APIã€‚ä¸åœ¨é¡µé¢ä¼šè¯æœŸé—´æŒç»­çš„`sessionStorage`ä¸åŒï¼Œ`localStorage`æ²¡æœ‰åˆ°æœŸæ—¶é—´ã€‚

æ‰€æœ‰çš„é”®å’Œå€¼éƒ½è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚è®©æˆ‘ä»¬æ·»åŠ ã€æ›´æ–°å’Œåˆ é™¤ä¸€ä¸ªé”®ï¼Œç„¶åå°è¯•ä»ä¸€ä¸ªç©ºé”®ä¸­è¯»å–ã€‚è¿™æ˜¯æ§åˆ¶å°è¾“å…¥ï¼Œæ‰€ä»¥è¿”å›å€¼è·Ÿåœ¨å‘½ä»¤åé¢ã€‚

```
// Add key - or overwrite existing key
window.localStorage.setItem('foo', 'bar')
> undefined

// Read a value from a key
window.localStorage.getItem('foo')
> "bar"

// Delete key - deleting empty yields same return value
window.localStorage.removeItem('foo')
> undefined

// Read from a deleted or unknown key
window.localStorage.getItem('foo')
> null 
```

ä¸ localStorage äº¤äº’çš„å…¶ä»–æ–¹å¼åŒ…æ‹¬æ¸…é™¤æ‰€æœ‰é”®å’Œéå†ç°æœ‰é”®ã€‚

```
// Get the read-only length
window.localStorage.length
> 6

// Get the nth key
window.localStorage.key(0)
> "algoliasearch-client-js"

// Delete all keys
window.localStorage.clear()
> undefined

// Iterate through all keys
for (let i = 0; i < window.localStorage.length; i++) {
    console.log(window.localStorage.key(i));
} 
```

æ‚¨å¯ä»¥åœ¨è¿™é‡Œçš„å¼€å‘äººå‘˜æ§åˆ¶å°ä¸­å°è¯•å…¶ä¸­çš„ä¸€äº›æ–¹æ³•ã€‚åœ¨æˆ‘å†™çš„æ—¶å€™ï¼ŒDEV ä¸ºæˆ‘å­˜å‚¨äº†ä¸‹é¢çš„ localStorage é”®ã€‚ä½†æ˜¯è¯·ç¡®ä¿**ä¸è¦åˆ é™¤**ä»»ä½•è¿™äº›å†…å®¹ï¼`algoliasearch-client-js`ã€`config_body_class`ã€`current_user`ã€`https://dev.to/new`ã€`pusherTransportTLS`ã€‚

#### App

è¿™æ˜¯æˆ‘ä»¬è¦åšçš„ã€‚ä¸€ä¸ªå°è€Œå®ç”¨çš„ç¬”è®° appã€‚é™¤äº†é—´è·ï¼Œå®ƒå¾ˆå°‘ä½¿ç”¨æ ·å¼([å‘é€ä¸€ä¸ªæ‹‰è¯·æ±‚](https://github.com/healeycodes/tiny-note-taker))ã€‚é‡è¦çš„æ˜¯åº”ç”¨ç¨‹åºå¦‚ä½•ä¸å®¢æˆ·ç«¯çš„æµè§ˆå™¨å­˜å‚¨è¿›è¡Œé€šä¿¡ã€‚

[![](../Images/dd24213d8369821bdc887eb22b41c950.png)T2ã€‘](https://healeycodes.github.io/tiny-note-taker/)

å¸Œæœ›ä½ å·²ç»æƒ³åˆ°äº†æˆ‘ä»¬éœ€è¦çš„`localStorage`æ–¹æ³•ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç°æˆçš„ HTML æ¨¡æ¿æ¥å‘½åæˆ‘ä»¬å°†è¦ä½¿ç”¨çš„å‡½æ•°ã€‚

```
<h5>Tiny Note Taker</h5>
<div>
    <button onclick="newNote()">New</button>
        <select id="notes" onchange="changeNote()"></select>
        <button onclick="deleteNote()">Delete</button>
</div>
<textarea id="editor" rows="10" onkeyup="saveNote()"
    onkeydown="checkEmpty()" autofocus></textarea>
<script src="./index.js"></script> 
```

èŠ±ç‚¹æ—¶é—´æƒ³æƒ³è¿™äº›å‡½æ•°ä¸æˆ‘ä»¬åˆšæ‰çœ‹åˆ°çš„å­˜å‚¨æ–¹æ³•æœ‰ä»€ä¹ˆå…³ç³»ï¼Œä»¥åŠå®ƒä»¬å°†å¦‚ä½•æ“ä½œ DOMã€‚

* * *

`newNote()`æç¤ºç”¨æˆ·è¾“å…¥éŸ³ç¬¦åç§°å¹¶åˆ›å»ºå®ƒã€‚

å½“æ‰€é€‰å…ƒç´ æ”¹å˜æ—¶ï¼Œåˆ‡æ¢åˆ°æ–°éŸ³ç¬¦ã€‚

`deleteNote()`åˆ é™¤å½“å‰é€‰ä¸­çš„ä¾¿ç¬ºã€‚

`saveNote()`å°†å½“å‰é€‰ä¸­çš„ä¾¿ç¬ºä¿å­˜ä¸ºç”¨æˆ·é”®å…¥çš„å†…å®¹ã€‚

è¿™ä¸ªä¸å¤ªæ˜æ˜¾ã€‚

å¦‚æœç”¨æˆ·åœ¨åˆ›å»ºæ–°ä¾¿ç¬ºä¹‹å‰åˆ°è¾¾é¡µé¢å¹¶å¼€å§‹è¾“å…¥ï¼Œåç§°å°†æ˜¯ç©ºå­—ç¬¦ä¸²`""`ã€‚ç›¸åï¼Œå½“ä»–ä»¬é”®å…¥*æ—¶ï¼Œä½†åœ¨ä¿å­˜ç¬”è®°ä¹‹å‰*å‘½åå½“å‰ç¬”è®°`untitled`ã€‚æˆ‘ä»¬é€šè¿‡å°†é€»è¾‘åˆ†æˆä¸¤ä¸ªäº‹ä»¶æ¥ç®€åŒ–æˆ‘ä»¬çš„é€»è¾‘ã€‚`onkeydown`æ£€æŸ¥æ˜¯å¦æœ‰ç©ºä¾¿ç¬ºï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œä¿®å¤ã€‚è¿™æ„å‘³ç€`onkeyup`å¯ä»¥ç®€å•åœ°ä¿å­˜ç¬”è®°ï¼Œè€Œä¸éœ€è¦ä»»ä½•é¢å¤–çš„æ£€æŸ¥ã€‚ç”±æ­¤ï¼Œ`checkEmpty()`ã€‚

**æé†’**:å…³é”®äº‹ä»¶[å‡ ä¹éƒ½æ˜¯](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent#Usage_notes)æŒ‰è¿™ä¸ªé¡ºåº`onkeydown -> onkeypress -> onkeyup`å«çš„ï¼Œä»–ä»¬éƒ½æœ‰è‡ªå·±çš„ä½ç½®ï¼

è®©æˆ‘ä»¬ä»åŸºæœ¬æ¡ˆä¾‹å¼€å§‹ã€‚å½“ç”¨æˆ·é”®å…¥æ—¶ä¿å­˜ä¸€ä¸ªç¬”è®°ã€‚å› ä¸ºæˆ‘ä»¬å·²ç»å°†è„šæœ¬ include æ”¾åœ¨äº† HTML çš„åº•éƒ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è·å–å¯¹æˆ‘ä»¬éœ€è¦çš„ä¸¤ä¸ªå…ƒç´ çš„å¼•ç”¨ï¼Œè€Œæ— éœ€ç­‰å¾…ä»»ä½•æ–‡æ¡£åŠ è½½äº‹ä»¶ã€‚

```
const notes = document.querySelector('#notes');
const editor = document.querySelector('#editor'); 
```

å¤ªå¥½äº†ã€‚è¿™äº›å¼•ç”¨å°†åœ¨è¿™ä¸ªè„šæœ¬çš„ç”Ÿå‘½å‘¨æœŸå†…æŒç»­ï¼Œå› ä¸ºæˆ‘ä»¬æ°¸è¿œä¸ä¼šåˆ é™¤è¿™äº›å…ƒç´ ã€‚æ¥ä¸‹æ¥ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰å…ˆç‚¹å‡» New æŒ‰é’®å°±è¾“å…¥äº†å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦å°†åä¸ºç©ºçš„ä¾¿ç¬ºå‘½åä¸º untitledã€‚

```
/**
 * Check for empty note title.
 */
function checkEmpty() {
    if (notes.length === 0) {
        const untitled = document.createElement('option');
        untitled.innerText = 'untitled';
        notes.appendChild(untitled);
    }
} 
```

è¿™é‡Œæˆ‘ä»¬ç”¨ JavaScript åˆ›å»ºäº†ä¸€ä¸ªé€‰é¡¹å…ƒç´ ï¼Œå¹¶ä½¿å®ƒåœ¨ select ä¸‹æ‹‰åˆ—è¡¨ä¸­å¯ç”¨ã€‚æˆ‘ä»¬è¿˜ä¸éœ€è¦åšä»»ä½•ä¿å­˜ï¼Œè¿™å°†åœ¨å‡ æ¯«ç§’åå½“ç”¨æˆ·å°†æ‰‹æŒ‡ä»å½“å‰é”®ä¸Šç§»å¼€æ—¶å‘ç”Ÿã€‚

å‡ æ¯«ç§’åã€‚

```
/**
 * Save editor text to storage under the current note.
 */
function saveNote() {
    window.localStorage.setItem(notes.value, editor.value);
} 
```

è¿˜æœ‰`localStorage.setItem`ï¼æˆ‘ä»¬çŸ¥é“é‚£æœ‰ä»€ä¹ˆç”¨ã€‚å®ƒå°†ä¿å­˜æ³¨é‡Šæ–‡æœ¬ä½œä¸ºå€¼ï¼Œæ³¨é‡Šæ ‡é¢˜(`"untitled"`)ä½œä¸ºé”®ã€‚ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªé—®é¢˜è¦è§£å†³ã€‚å¦‚æœç”¨æˆ·ç¦»å¼€ååˆå›æ¥ï¼Œé€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨å°†ä¸ºç©ºã€‚æ›´ç³Ÿç³•çš„æ˜¯:ä»–ä»¬ä¼šé‡å†™ä»–ä»¬çš„`"untitled"`ç¬”è®°ã€‚

å½“æˆ‘ä»¬çš„è„šæœ¬è¿è¡Œæ—¶ï¼Œå°±åœ¨æˆ‘ä»¬è·å–å¯¹è¿™äº›å…ƒç´ çš„å¼•ç”¨ä¹‹åï¼Œè®©æˆ‘ä»¬ç”¨æ‰€æœ‰ç”¨æˆ·ä¿å­˜çš„æ³¨é‡Šå¡«å…… select ä¸‹æ‹‰åˆ—è¡¨ã€‚

```
const notes = document.querySelector('#notes');
const editor = document.querySelector('#editor');

// Load user's saved notes
for (let i = 0; i < window.localStorage.length; i++) {
    const newNote = document.createElement('option');
    newNote.innerText = window.localStorage.key(i);
    notes.appendChild(newNote);
}
changeNote(); 
```

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†`localStorage`çš„åªè¯»å±æ€§`length`ä»¥åŠå®ƒçš„æ–¹æ³•`key()`ã€‚æ‰€æœ‰ä¿å­˜çš„æ³¨é‡Šéƒ½è¢«åŠ è½½åˆ°é€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨ä¸­ã€‚æˆ‘ä»¬è®© HTML ä½œä¸ºæˆ‘ä»¬çš„çŠ¶æ€è¿è¡Œã€‚è¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦è·Ÿè¸ª JavaScript ä¸­çš„ä»»ä½•æ³¨é‡Šã€‚æˆ‘ä»¬ä¾é ç®€å•çš„å‡½æ•°å°† DOM é“¾æ¥åˆ°å­˜å‚¨ APIã€‚

åœ¨æœ€åä¸€ä¸ªä»£ç ç‰‡æ®µçš„åº•éƒ¨ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†`changeNote()`ï¼Œå®ƒå°†å½“å‰é€‰ä¸­çš„æ³¨é‡ŠåŠ è½½åˆ° textarea å…ƒç´ ä¸­ï¼Œä¹Ÿå°±æ˜¯ç¼–è¾‘å™¨ã€‚è¿™ä¸ªå‡½æ•°ä¹Ÿä¼šåœ¨åˆ›å»ºä¸€ä¸ªæ–°æ³¨é‡Šåè¢«è°ƒç”¨ï¼Œè¿™å°†æ¸…ç©ºç¼–è¾‘å™¨ã€‚æ–°ä¾¿ç¬ºç”¨ç©ºå­—ç¬¦ä¸²åˆå§‹åŒ–ã€‚

```
/**
 * Change editor text to the currently selected note.
 */
function changeNote() {
    editor.value = window.localStorage.getItem(notes.value);
} 
```

å­˜å‚¨ API ä¸ºæˆ‘ä»¬æŠ½è±¡äº†ç¹é‡çš„å·¥ä½œã€‚

ç”¨æˆ·éœ€è¦ä¸€ç§å‘½åå’Œåˆ›å»ºç¬”è®°çš„æ–¹æ³•ã€‚`newNote()`ç¡®å®å¦‚æ­¤ã€‚å®ƒä½¿ç”¨ [Element#insertBefore](https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore) å°†æ–°æ³¨é‡Šæ”¾åœ¨é€‰æ‹©æ¡†çš„é¡¶éƒ¨ã€‚åœ¨çˆ¶å…ƒç´ ä¸Šè°ƒç”¨æ­¤æ–¹æ³•ã€‚`var insertedNode = parentNode.insertBefore(newNode, referenceNode);`ã€‚è¿™ä¸ªæ–¹æ³•çš„å·§å¦™ä¹‹å¤„åœ¨äºå®ƒæ¥å—ä¸€ä¸ªç©ºå€¼ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚æ„æ€æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ç©ºçš„çˆ¶å…ƒç´ ä¸Šè°ƒç”¨`insertBefore`ï¼

```
/**
 * Ask the user to name their new note then create it.
 * Add this note to the select div then focus to it.
 */
function newNote() {
    const note = prompt('Name of note?');
    window.localStorage.setItem(note, '');

    const noteElem = document.createElement('option');
    noteElem.innerText = note;
    notes.insertBefore(noteElem, notes.firstChild);

    // Focus this note
    notes.value = note;
    changeNote();
} 
```

æˆ‘ä»¬çš„ç¬”è®°åº”ç”¨ç¨‹åºå³å°†å®Œæˆã€‚æ‰€éœ€çš„æœ€åä¸€ä¸ªåŠŸèƒ½æ˜¯åˆ é™¤æ³¨é‡Šã€‚å½“ç”¨æˆ·å®Œæˆä¸€ä¸ªæ³¨é‡Šæ—¶ï¼Œä»–ä»¬å¯ä»¥é€‰æ‹©å®ƒï¼Œç„¶åç‚¹å‡»åˆ é™¤æŒ‰é’®ã€‚è¿™ä¸ªå‡½æ•°æœ€æ£˜æ‰‹çš„éƒ¨åˆ†æ˜¯åœ¨é€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨ä¸­æ‰¾åˆ°è¦åˆ é™¤çš„æ³¨é‡Šã€‚ä½¿ç”¨ DOM ä½œä¸ºæˆ‘ä»¬çš„çŠ¶æ€çš„ç¼ºç‚¹ä¹‹ä¸€ã€‚æˆ‘ä»¬å¿…é¡»éå†æ¯ä¸ªé€‰é¡¹ï¼Œæ£€æŸ¥`value`ã€‚

```
/**
 * Delete currently selected note
 */
function deleteNote() {
    const note = notes.value;
    window.localStorage.removeItem(note);
    editor.value = '';
    for (let i = 0; i < notes.length; i++) {
        const option = notes[i];
        if (option.value === note) {
            notes.removeChild(option);
        }
    }
} 
```

æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªå…¨åŠŸèƒ½çš„ç¬”è®°åº”ç”¨ç¨‹åºï¼Œå¯ä»¥é€šè¿‡ CDN æ— é™æ‰©å±•ã€‚æˆ‘ä»¬ä½¿ç”¨äº†å¼ºå¤§çš„[å­˜å‚¨ API](https://developer.mozilla.org/en-US/docs/Web/API/Storage) ï¼Œå¹¶å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ DOM ä½œä¸ºåº”ç”¨ç¨‹åºçŠ¶æ€ã€‚èµ°å§æˆ‘ä»¬ã€‚ğŸ™Œ

ç‚¹å‡»æŸ¥çœ‹æœ€ç»ˆåº”ç”¨ä»£ç [ï¼Œç‚¹å‡»](https://github.com/healeycodes/tiny-note-taker)æŸ¥çœ‹ç°åœºç‰ˆ[ã€‚](https://healeycodes.github.io/tiny-note-taker/)

* * *

åŠ å…¥æˆ‘çš„å…³äºç¼–ç¨‹å’Œä¸ªäººæˆé•¿çš„[æ—¶äº‹é€šè®¯](https://buttondown.email/healeycodes)çš„ 150 å¤šäººæ³¨å†Œï¼

æˆ‘å‘å…³äºç§‘æŠ€çš„å¾®åšã€‚