# è·å¾—æ‚¨æƒ³è¦çš„:ä½¿ç”¨ PHP é›†åˆè½»æ¾è¿‡æ»¤å’Œæ“ä½œæ•°æ®ã€‚ğŸ˜

> åŸæ–‡:[https://dev . to/mattsparks/get-what-you-want-using-PHP-collections-to-easy-filter-and-operating-data-59bb](https://dev.to/mattsparks/get-what-you-want-using-php-collections-to-easily-filter-and-manipulate-data-59bb)

ä½ å’Œ API åˆä½œè¿‡ï¼Œå¯¹å§ï¼Ÿä½ æå‡ºä¸€ä¸ªè¯·æ±‚ï¼Œä½ å¾—åˆ°ä¸€äº›æ•°æ®ï¼Œä½ ç”¨å®ƒåšä¸€äº›äº‹æƒ…ã€‚å¾ˆæ ‡å‡†çš„ä¸œè¥¿ã€‚æœ¬æ•™ç¨‹å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨ PHP é›†åˆçš„åŠ›é‡è½»æ¾è·å¾—æ‚¨æƒ³è¦çš„æ•°æ®ã€‚

ä»€ä¹ˆæ˜¯ PHP é›†åˆï¼Ÿç®€è€Œè¨€ä¹‹:é›†åˆæ˜¯ä¸€ä¸ªå…è®¸æˆ‘ä»¬è½»æ¾å¤„ç†æ•°ç»„çš„ç±»ã€‚

å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`tightenco/collect`åŒ…ã€‚è¿™ä¸ªåŒ…å…è®¸æˆ‘ä»¬åœ¨æ²¡æœ‰æ•´ä¸ªæ¡†æ¶çš„æƒ…å†µä¸‹ä½¿ç”¨ [Laravel Collections](https://laravel.com/docs/5.8/collections) ã€‚

## ![GitHub logo](../Images/a73f630113876d78cff79f59c2125b24.png) [ç´§çº¿å™¨](https://github.com/tightenco) / [æ”¶è—](https://github.com/tightenco/collect)

### ä» Laravel çš„ç…§æ˜æ”¯æ¶ä¸­åˆ†ç¦»å‡ºæ¥çš„ä¸€ä¸ªç³»åˆ—

<article class="markdown-body entry-content container-lg" itemprop="text">

[![Travis Status for tightenco/collect](../Images/986509300e0098d6ab5c75dd722f9a33.png)T2ã€‘](https://travis-ci.org/tightenco/collect)

[![](../Images/405deba779cb6dc39c8782d3c7643006.png)T2ã€‘](https://raw.githubusercontent.com/tightenco/collect/master/collect-logo.png)

# æ”¶è—-ç…§äº®æ”¶è—

è½»æ¾åœ°å°† [Laravel çš„æ”¶è—](https://laravel.com/docs/collections)å¯¼å…¥åˆ°é Laravel åŒ…ä¸­ï¼Œè€Œä¸éœ€è¦æ•´ä¸ª`Illuminate\Support`åŒ…ã€‚([ä¸ºä»€ä¹ˆä¸æŠŠ`Illuminate\Support`æ”¾åœ¨æ¡†æ¶æ— å…³çš„åŒ…](https://mattallan.org/posts/dont-use-illuminate-support/)ä¸­)

ç”± Taylor Otwell ç¼–å†™ï¼Œä½œä¸º Laravel çš„ [Illuminate/Support](https://github.com/illuminate/support) åŒ…çš„ä¸€éƒ¨åˆ†ï¼ŒCollect åªæ˜¯æ”¯æŒæ‰€éœ€çš„ä»£ç ï¼Œä»¥ä¾¿è‡ªå·±ä½¿ç”¨é›†åˆã€‚

é©¬ç‰¹Â·æ–½é™¶è´¹å°”ä¸ºã€Šæ‹§ç´§å…¬å¸ã€‹æ‰€åšçš„æ·±æƒ…åˆ†å‰²ï¼Œã€ŠT2ã€‹çš„ã€Šé˜¿ç‘ŸÂ·å…‹é‡Œæ–¯ã€‹æœ€åä¸€è„šè¸¢åœ¨äº†å®ƒçš„å±è‚¡ä¸Šã€‚

## è£…ç½®

ä¸[ä½œæ›²](https://getcomposer.org):

```
composer require tightenco/collect
```

## å‘å±•

å¦‚æœä½ æ˜¯ä¸€åå¼€å‘ Collect çš„å¼€å‘äººå‘˜ï¼Œä½ çš„ä»»åŠ¡æ˜¯å‡çº§å®ƒä»¥é•œåƒ Laravel çš„æ–°ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä»æ ¹ç›®å½•è¿è¡Œ`./upgrade.sh`ã€‚æ‚¨å¯ä»¥ä¼ é€’ä¸€ä¸ªå‚æ•°æ¥æŒ‡å‘ä¸€ä¸ªç‰¹å®šçš„ Laravel ç‰ˆæœ¬(ä¾‹å¦‚`./upgrade.sh 5.7.10`)ï¼Œæˆ–è€…ï¼Œå¦‚æœæ‚¨æ²¡æœ‰ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œè„šæœ¬å°†ä¼šæ‰¾åˆ°æœ€æ–°çš„å¸¦æ ‡ç­¾çš„ç‰ˆæœ¬å¹¶è¿è¡Œã€‚

å‡çº§è€…å°†æ‹‰â€¦

</article>

[View on GitHub](https://github.com/tightenco/collect)

æœ¬æ•™ç¨‹çš„æ•°æ®ç”± OMDb API æä¾›ã€‚

æ‚¨å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æ•°æ®ï¼Œè€Œä¸æ˜¯åµŒå…¥æ•°æ®ã€‚

## [](#a-simple-example)ä¸€ä¸ªç®€å•çš„ä¾‹å­

åœ¨æˆ‘ä»¬å¼€å§‹è§£ææˆ‘ä»¬çš„[ç”µå½±æ•°æ®](https://gist.github.com/mattsparks/4a0a3520b3ab211854d2caff7ee52f9b)ä¹‹å‰ï¼Œè®©æˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†è·å–æ•°ç»„ä¸­çš„ç¬¬ä¸€é¡¹å’Œæœ€åä¸€é¡¹ã€‚

```
use Tightenco\Collect\Support\Collection;

$simpsons = ['Homer', 'Marge', 'Bart', 'Lisa', 'Maggie'];
$c = new Collection($simpsons);

echo $c->first(); // Homer
echo $c->last();  // Maggie 
```

å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿæˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„`Collection`å®ä¾‹ã€‚ä»é‚£é‡Œæˆ‘ä»¬ä½¿ç”¨`first()`å’Œ`last()`æ–¹æ³•æ¥è·å–â€œè·é©¬â€å’Œâ€œç›å‰â€

## [](#getting-started)å…¥é—¨

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆä½¿ç”¨ Composer æ¥è·å–æˆ‘ä»¬çš„é›†åˆåŒ…ã€‚

```
composer require tightenco/collect 
```

ç°åœ¨ï¼Œå¯¹äºæ¯ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦åŒ…æ‹¬æˆ‘ä»¬çš„ä¾èµ–é¡¹å¹¶åšä¸€äº›è®¾ç½®ã€‚

```
<?php

require 'vendor/autoload.php';

use Tightenco\Collect\Support\Collection;

$json = file_get_contents(__DIR__ . '/data.json');
$movies = json_decode($json, true);
$c = new Collection($movies); 
```

## [](#collection-methods)æ”¶é›†æ–¹æ³•

è¿™ä¸ªåŒ…ä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡å¤„ç†æ•°æ®çš„å¥½æ–¹æ³•ã€‚å› ä¸ºæœ‰å¤§çº¦ 110 ç§æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šä¸€ä¸€ä»‹ç»ã€‚ç›¸åï¼Œæˆ‘å°†çªå‡ºå‡ ä¸ªå¹¶è§£é‡Šå®ƒä»¬çš„åŠŸèƒ½ã€‚

## [](#-raw-map-endraw-)`.map()`

`map()`å‡½æ•°éå†æ•°æ®ï¼Œå¹¶å°†æ¯ä¸€é¡¹ä¼ é€’ç»™ç»™å®šçš„å›è°ƒå‡½æ•°ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥è¿”å›è¯¥é¡¹ç›®ä»¥åˆ›å»ºæ–°çš„æ”¶è—ã€‚ä¸‹é¢æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„é›†åˆï¼ŒåªåŒ…å«æ¯éƒ¨ç”µå½±çš„æ ‡é¢˜ã€‚

```
$titles = $c->map(function ($movie) {
    return $movie['Title'];
}); 
```

ç»“æœ:

```
['The Matrix', 'Blade Runner', 'The Fifth Element', 'Escape From New York'] 
```

æ‚¨ä¸å±€é™äºåªè¿”å›ä¸€ä¸ªå€¼ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé›†åˆï¼ŒåŒ…æ‹¬æ¯éƒ¨ç”µå½±ä»¥åŠä¸Šæ˜ æ—¥æœŸã€‚

```
$release = $c->map(function ($movie) {
    return [$movie['Title'] => [
        'releaseDate' => $movie['Released']
    ]];
}); 
```

ç»“æœ:

```
[
    'The Matrix' => ['releaseDate' => '31 Mar 1999'],
    'Blade Runner' => ['releaseDate' => '25 Jun 1982'],
    'The Fifth Element' => ['releaseDate' => '09 May 1997'],
    'Escape From New York' => ['releaseDate' => '10 Jul 1981']            
] 
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ ¼å¼åŒ–æ—¥æœŸã€‚

```
$release = $c->map(function ($movie) {
    return [$movie['Title'] => [
        'releaseDate' => date('F d, Y', strtotime($movie['Released']))
    ]];
}); 
```

ç»“æœ:

```
[
    'The Matrix' => ['releaseDate' => 'March 31, 1999'],
    'Blade Runner' => ['releaseDate' => 'June 25, 1982'],
    'The Fifth Element' => ['releaseDate' => 'May 09, 1997'],
    'Escape From New York' => ['releaseDate' => 'July 10, 1981']            
] 
```

*é™„æ³¨:å¦‚æœè¿™æ˜¯ä¸€ä¸ªçœŸå®çš„é¡¹ç›®ï¼Œæˆ‘å¯èƒ½ä¼šä½¿ç”¨ PHP çš„ [DateTime](https://www.php.net/manual/en/class.datetime.php) æˆ– [Carbon](https://carbon.nesbot.com/docs/) æ¥æ ¼å¼åŒ–æ—¥æœŸã€‚*

## [](#-raw-filter-endraw-)`.filter()`

`filter()`æ–¹æ³•è¿‡æ»¤æ•°æ®ã€‚ä»»ä½•é€šè¿‡ç»™å®šæµ‹è¯•çš„é¡¹ç›®éƒ½å°†è¢«è¿”å›ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¿”å›ä»»ä½•â€œMetascoreâ€è‡³å°‘ä¸º 70 çš„ç”µå½±ã€‚

```
$metascore = $c->filter(function ($movie) {
    return $movie['Metascore'] >= 70;
}); 
```

ç»“æœ:

```
[
    [
        'Title' => 'The Matrix'
        ...
    ], 
    [
        'Title' => 'Blade Runner'
        ...
    ],     
    [
        'Title' => 'Escape From New York'
        ...
    ]   
] 
```

## [](#-raw-sum-endraw-)`.sum()`

å½“æ‚¨æƒ³è¦åˆè®¡å€¼æ—¶,`.sum()`æ–¹æ³•å¾ˆæ–¹ä¾¿ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†`map()`æ–¹æ³•æ¥è¿”å›æ¯éƒ¨ç”µå½±çš„è¿è¡Œæ—¶é—´ï¼Œç„¶åå°†å®ƒä»¬åŠ èµ·æ¥ï¼Œçœ‹çœ‹çœ‹å®Œå››éƒ¨ç”µå½±éœ€è¦å¤šé•¿æ—¶é—´ã€‚

```
$runtime = $c->map(function ($movie) {
    /**
     * Breakdown:
     *
     * 1\. Remove " min" from the string.
     * 2\. Cast the string to an integer so we can add them
     */
    return (int) str_replace(' min', '', $movie['Runtime']);
})->sum(); 
```

ç»“æœ:

```
478 
```

## [](#-raw-count-endraw-)`.count()`

åƒ`.sum()`ï¼Œ`.count()`æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ–¹æ³•ï¼Œå½“ä½ æƒ³çŸ¥é“ä½ çš„æ”¶è—ä¸­æœ‰å¤šå°‘ç‰©å“æ—¶ï¼Œå®ƒçœŸçš„å¯ä»¥æ´¾ä¸Šç”¨åœºã€‚

```
$c->count(); // 4 
```

## [](#further-reading)è¿›ä¸€æ­¥é˜…è¯»

è¿™ä¸ªç‰¹å®šçš„åŒ…æœ‰å¤§çº¦ 106 ç§å…¶ä»–æ–¹æ³•å¯ç”¨ã€‚æˆ‘é¼“åŠ±æ‚¨[é˜…è¯»æ–‡æ¡£](https://laravel.com/docs/5.8/collections)ã€‚

Laravel çš„æ”¶è—åŒ…å¹¶ä¸æ˜¯é•‡ä¸Šå”¯ä¸€çš„æ¸¸æˆã€‚æ•™ä¹‰æœ‰ä¸€ä¸ªä¼Ÿå¤§çš„æ•™ä¹‰[è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ•™ä¹‰](https://packagist.org/?query=collection)ï¼å»æ‰¾ä¸€ä¸ªä½ å–œæ¬¢çš„å§ï¼

å¦å¤–ï¼Œäºšå½“Â·ç“¦æ£®æœ‰ä¸€æœ¬å¾ˆæ£’çš„ä¹¦å«åšã€Šé‡æ„é›†åˆã€‹,æˆ‘å¼ºçƒˆæ¨èã€‚

å®Œå…¨å…¬å¼€ï¼Œæˆ‘æ²¡æœ‰å› ä¸ºé“¾æ¥åˆ°è¿™æœ¬ä¹¦è€Œå¾—åˆ°ä»»ä½•å½¢å¼çš„è¡¥å¿ã€‚æˆ‘åªæ˜¯è§‰å¾—å¾ˆæ£’ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œäºšå½“ï¼Œå¦‚æœä½ æ­£åœ¨è¯»è¿™ç¯‡æ–‡ç« ï¼Œå¹¶ä¸”å¸Œæœ›æˆ‘æˆä¸ºä»˜è´¹ä»£è¨€äººï¼Œè¯·è”ç³»æˆ‘ä»¬ğŸ˜†]