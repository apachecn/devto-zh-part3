# ä½¿ç”¨ Fetch API è¿›è¡Œ AJAX è°ƒç”¨

> åŸæ–‡:[https://dev . to/Nikola/making-Ajax-calls-using-the-fetch-API-7 B1](https://dev.to/nikola/making-ajax-calls-using-the-fetch-api-7b1)

[![](../Images/0007df5328315606c1ad902c8c5c2448.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--sF9zsLJH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/tl761nf5fklx6dp7wbdp.jpg)

*æœ€åˆå‘å¸ƒäº[æˆ‘çš„åšå®¢](http://www.nikola-breznjak.com/blog/javascript/making-ajax-calls-using-fetch-api/)ã€‚*

## TLï¼›é€Ÿåº¦ä¸‰è§’å½¢å®šä½æ³•(dead reckoning)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†åšæˆ‘ä»¬åœ¨ç¬¬äºŒç¯‡æ–‡ç« ä¸­æ‰€åšçš„ä¸€åˆ‡ï¼Œä½†æ˜¯ç”¨ T2 è·å– APIã€‚

## [](#whats-this-fetch-api)è¿™ä¸ª Fetch API æ˜¯ä»€ä¹ˆï¼Ÿ

ä¸‡èƒ½çš„åŒ»ç”Ÿè¯´

> è·å– API æä¾›äº†è·å–èµ„æºçš„æ¥å£(åŒ…æ‹¬é€šè¿‡ç½‘ç»œ)ã€‚ä»»ä½•ä½¿ç”¨è¿‡`XMLHttpRequest`çš„äººéƒ½ä¼šè§‰å¾—å®ƒå¾ˆç†Ÿæ‚‰(å…³äºå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¯·å‚è§ç³»åˆ—çš„[ç¬¬ä¸€ç¯‡æ–‡ç« )ï¼Œä½†æ˜¯æ–°çš„ API æä¾›äº†ä¸€ä¸ªæ›´å¼ºå¤§ã€æ›´çµæ´»çš„ç‰¹æ€§é›†ã€‚](https://dev.to/hitman666/making-ajax-calls-in-pure-javascript-the-old-way-ed5)

æˆ‘å‡†å¤‡äº†[è¿™ä¸ªæ¼”ç¤ºé¡µé¢](http://nikola-breznjak.com/_testings/ajax/test3.html)ä»¥ä¾¿ä½ å¯ä»¥æµ‹è¯•ã€‚

æ‚¨åº”è¯¥è¿˜è®°å¾—ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œä¸ºäº†ç”¨ jQuery è¿›è¡Œ AJAX è°ƒç”¨ï¼Œæ‚¨å¿…é¡»åšè¿™æ ·çš„äº‹æƒ…:

`$('#result').load('http://nikola-breznjak.com/_testings/ajax/test1.php?ime=Nikola');`

ç»§ç»­è¿è¡Œæµè§ˆå™¨å¼€å‘å·¥å…·æ§åˆ¶å°ä¸­çš„[æ¼”ç¤ºé¡µé¢](http://nikola-breznjak.com/_testings/ajax/test3.html)ä¸Šçš„ä»£ç (å¦‚æœé‡åˆ°å›°éš¾ï¼Œè¯·å‚è€ƒ[ä¸Šä¸€ç¯‡æ–‡ç« ](https://dev.to/hitman666/making-ajax-calls-in-pure-javascript-the-old-way-ed5))ã€‚

ç°åœ¨ï¼Œ[è·å– API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API) çš„å®Œå…¨ç›¸åŒçš„ä¸œè¥¿çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
fetch('http://nikola-breznjak.com/_testings/ajax/test1.php?ime=Nikola')
  .then(function(response) {
    return response.text();
  })
  .then(function(text) {
    $('#result').html(text);
  }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç»§ç»­åœ¨æ§åˆ¶å°ä¸­å°è¯•ã€‚æ›´æ”¹`ime`å‚æ•°ï¼Œæ‚¨ä¼šçœ‹åˆ°é¡µé¢ä¸Šçš„æ–‡æœ¬å°†æ›´æ”¹ä¸º`Hello [name]`ï¼Œå…¶ä¸­ã€nameã€‘å°†æ˜¯æ‚¨è¾“å…¥çš„å‚æ•°ã€‚æ³¨æ„ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»ç„¶ä½¿ç”¨ jQuery æ¥è®¾ç½® id ä¸º`result`çš„ div çš„å†…å®¹ã€‚

åŒ»ç”Ÿåœ¨è¿™æ–¹é¢æœ‰æ›´å¤šçš„ä¿¡æ¯ï¼Œä½†æ˜¯æ­£å¦‚ä»–ä»¬æ‰€è¯´çš„,`fetch()`å’Œ`$.ajax()`ä¹‹é—´çš„åŒºåˆ«ä¸»è¦åœ¨ä¸¤ä¸ªæ–¹é¢:

*   ä»`fetch()`è¿”å›çš„æ‰¿è¯ºä¸ä¼šå›  HTTP é”™è¯¯çŠ¶æ€è€Œè¢«æ‹’ç»ï¼Œå³ä½¿å“åº”æ˜¯ HTTP 404 æˆ– 500ã€‚ç›¸åï¼Œå®ƒå°†æ­£å¸¸è§£æ(ok çŠ¶æ€è®¾ç½®ä¸º false)ï¼Œå¹¶ä¸”ä»…åœ¨ç½‘ç»œæ•…éšœæˆ–ä»»ä½•é˜»æ­¢è¯·æ±‚å®Œæˆçš„æƒ…å†µä¸‹æ‹’ç»ã€‚
*   é»˜è®¤æƒ…å†µä¸‹ï¼Œ`fetch()`ä¸ä¼šä»æœåŠ¡å™¨å‘é€æˆ–æ¥æ”¶ä»»ä½• cookieï¼Œå¦‚æœç«™ç‚¹ä¾èµ–äºç»´æŠ¤ç”¨æˆ·ä¼šè¯ï¼Œå°±ä¼šäº§ç”Ÿæœªç»éªŒè¯çš„è¯·æ±‚(è¦å‘é€ cookieï¼Œå¿…é¡»è®¾ç½®å‡­è¯`init`é€‰é¡¹)ã€‚

> âš ï¸ç¨åä½ å¯èƒ½ä¼šæƒ³å¤šè¯»ä¸€ç‚¹å…³äº JavaScript ä¸­[æ‰¿è¯ºçš„å†…å®¹ã€‚](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)

## [](#rewriting-the-mini-project)é‡å†™è¿·ä½ é¡¹ç›®

æˆ‘é¼“åŠ±ä½ äº²è‡ªå°è¯•ä¸€ä¸‹ï¼Œç„¶åæ£€æŸ¥ä½ å¯¹æˆ‘çš„è§£å†³æ–¹æ¡ˆã€‚

è¿·ä½ é¡¹ç›®(ä½ å¯ä»¥åœ¨è¿™é‡Œæµ‹è¯•)å°†è¢«æ”¹å†™å¦‚ä¸‹:

```
var link = 'http://nikola-breznjak.com/_testings/ajax/test2.php';
fetch(link)
    .then(function(response){
        return response.json()
    })
    .then(function(result){
        var oglasiHTML = '';
        $.each(result, function(index, oglas){
            var klasaCijene = '';
            if (oglas.cijena < 100){
                klasaCijene = 'is-success';
            }
            else if (oglas.cijena >= 100 && oglas.cijena < 300){
                klasaCijene = 'is-info';
            }
            else if (oglas.cijena >= 300){
                klasaCijene = 'is-danger';
            }

            oglasiHTML += `
                <div class="columns">
                    <div class="column is-one-quarter">
                        <span class="tag ${klasaCijene}">${oglas.cijena}</span>
                    </div>
                    <div class="column">${oglas.tekst}</div>
                </div>
            `;
        });

        $('#oglasi').html(oglasiHTML);
    }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¿™é‡Œæˆ‘æƒ³æŒ‡å‡ºå‡ ä»¶äº‹:

*   æˆ‘ä½¿ç”¨äº†`response.json()`ï¼Œå› ä¸ºæˆ‘çŸ¥é“è¿™ä¸ª API ä¼šè¿”å›ä¸€ä¸ª JSON å“åº”(æ‚¨å¯ä»¥é€šè¿‡åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é‚£ä¸ªé“¾æ¥æ¥æ£€æŸ¥)ã€‚
*   æˆ‘ä½¿ç”¨ jQuery [each](https://api.jquery.com/each/) å‡½æ•°æ¥è¿­ä»£`result`ã€‚
*   æˆ‘ä½¿ç”¨äº†[æ¨¡æ¿æ–‡å­—](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals)æ¥æ„é€ æœ€ç»ˆçš„`oglasiHTML`ï¼Œè¿™æ¯”æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä½¿ç”¨è¿æ¥çš„æ–¹å¼è¦ç®€æ´å¾—å¤šã€‚

## [](#i-want-more-examples)æˆ‘æƒ³è¦æ›´å¤šä¾‹å­

[![](../Images/c6e3bd1ee71f81fd219fa1728d407cbd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--WVlPBIyO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/jYSxnG9.jpg)

å‡è®¾æ‚¨æœ‰[è¿™ä¸ªæ¼”ç¤ºé¡µé¢](http://nikola-breznjak.com/_testings/ajax/test5-email.html)ï¼Œå¹¶ä¸”æ‚¨éœ€è¦ä½¿ç”¨ AJAX æ¥åˆ¶ä½œæ—¶äº‹é€šè®¯æ³¨å†Œè¡¨å•ï¼Œè€Œä¸æ˜¯åœ¨å•å‡»`Subscribe`æŒ‰é’®æ—¶è½¬åˆ°ä¸€ä¸ªæ–°é¡µé¢ã€‚ç°åœ¨ API(ä½äº http://nikola-breznjak.com/_testings/ajax/email.php çš„[)å®é™…ä¸Šå¹¶ä¸å¤„ç†ä½ å‘é€ç»™å®ƒçš„æ•°æ®ï¼Œè€Œæ˜¯è¯•ç€æ ¹æ®è¯·æ±‚å‘é€æ•°æ®ã€‚](http://nikola-breznjak.com/_testings/ajax/email.php)

ä½ ä¼šæ€ä¹ˆåšï¼Ÿä½ ä¼šä»å“ªé‡Œå¼€å§‹ï¼Ÿ

å¥½å§ï¼Œè¿™é‡Œæœ‰ä¸€äº›ä½ å¯ä»¥è°·æ­Œä¸€ä¸‹çš„æœç´¢è¯:

*   `è·å– api æäº¤æ•°æ®'

åŒæ ·ï¼Œè¿™æ˜¯æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æˆ‘é¼“åŠ±ä½ å…ˆè‡ªå·±å°è¯•ä¸€ä¸‹ã€‚

 ``$('form').submit(function(ev){
ev.preventDefault();
var url = $(this).attr('action');
var formData = $(this).serialize();
fetch(url, {method: 'post', body: formData})
.then(function(response){
$('#newsletter').html('Thank you for subscribing, please check your email.');
});
});`` 

 ``è¿™é‡Œæˆ‘æƒ³æŒ‡å‡ºå‡ ä»¶äº‹:

*   æˆ‘å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½• id çš„æƒ…å†µä¸‹ä½¿ç”¨`form`é€‰æ‹©å™¨ï¼Œå› ä¸ºå®ƒæ˜¯é¡µé¢ä¸Šå”¯ä¸€çš„è¡¨å•ã€‚å¦‚æœé¡µé¢ä¸Šæœ‰æ›´å¤šçš„è¡¨å•ï¼Œæˆ‘å¿…é¡»ä½¿ç”¨ id æ¥åŒºåˆ†å®ƒä»¬(è¿™æ€»æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªè¡¨å•)
*   æˆ‘ä½¿ç”¨ jQuery çš„ [submit](https://api.jquery.com/submit/) å‡½æ•°æ¥è®¾ç½®ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œè¿™ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºå°†åœ¨è¡¨å•æäº¤æ—¶æ‰§è¡Œ(å•å‡»`Subscribe`æŒ‰é’®ï¼Œæˆ–è€…åœ¨å…¶ä¸­ä¸€ä¸ªå­—æ®µä¸­æŒ‰ ENTER é”®)
*   æˆ‘ä½¿ç”¨äº†`ev.preventDefault()`æ¥é˜»æ­¢è¡¨å•â€œåšå®ƒè¯¥åšçš„äº‹æƒ…â€å’ŒåŠ è½½â€œemail.phpâ€é¡µé¢ï¼Œè¿™æ˜¯å®ƒçš„é»˜è®¤è¡Œä¸º
*   æˆ‘ä½¿ç”¨`$(this).attr('action')`ä» HTML çš„è¡¨å•å®šä¹‰ä¸­æå– API URL(å¯ä»¥åœ¨å…ƒç´ æ£€æŸ¥å™¨ä¸­éšæ„æ£€æŸ¥)
*   æˆ‘ä½¿ç”¨`$(this).serialize()`å°†ä¸€ç»„è¡¨å•å…ƒç´ ç¼–ç æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åä¼ é€’ç»™`fetch`è®¾ç½®å¯¹è±¡çš„`body`å±æ€§ã€‚è¿™ä¸ªå‡½æ•°ä½¿ç”¨ POST æ–¹æ³•(ä½¿ç”¨ settings å¯¹è±¡ä¸Šçš„`method`è®¾ç½®)å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè¿™æ˜¯å‘é€ä¸€äº›éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå¤„ç†çš„æ•æ„Ÿæ•°æ®çš„é¦–é€‰æ–¹å¼(æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­äº†è§£åˆ°çš„)
*   æˆ‘åœ¨ id ä¸º`newsletter`çš„`div`ä¸Šä½¿ç”¨äº† [html](https://api.jquery.com/html/) å‡½æ•°æ¥è®¾ç½®å®ƒçš„æ–°å†…å®¹

## è¯·å†ç»™æˆ‘ä¸€ä¸ªå¥½å—ï¼Ÿ

å½“ç„¶ï¼Œä½†æ˜¯ç­”åº”æˆ‘ä½ ä¼šå…ˆè‡ªå·±åšï¼

> æˆ‘æ„¿æ„ğŸ¤

å¥½å§ï¼Œé‚£æˆ‘ä»¬å¼€å§‹å§ğŸ’ª

è¿™é‡Œæœ‰ä¸€ä¸ªæ–°çš„[æ¼”ç¤ºé¡µé¢](http://nikola-breznjak.com/_testings/ajax/test6-slike.html)ï¼Œæ‚¨å°†åœ¨æœ¬ä¾‹ä¸­ä½¿ç”¨ã€‚

> âš ï¸:æˆ‘åœ¨ç”¨å¸ƒå°”ç›è®©ç½‘ç«™çœ‹èµ·æ¥æ›´æ¼‚äº®ã€‚æ­£å¦‚ä»–ä»¬çš„ç½‘ç«™æ‰€è¯´:
> â€œå¸ƒå°”ç›æ˜¯ä¸€ä¸ªåŸºäº Flexbox çš„å…è´¹å¼€æº CSS æ¡†æ¶ï¼Œè¢«è¶…è¿‡ 15 ä¸‡å¼€å‘è€…ä½¿ç”¨ã€‚â€
> æˆ‘åªæƒ³è¯´å®ƒçœŸçš„å¾ˆæ£’ï¼Œå¾ˆå®¹æ˜“å­¦ï¼Œæ‰€ä»¥ä¸€å®šè¦å»çœ‹çœ‹ã€‚

åœ¨è¿™ä¸ªæŒ‘æˆ˜ä¸­ï¼Œä½ å¿…é¡»ä½¿ç”¨ [Giphy æœç´¢ API](https://developers.giphy.com/) åˆ›å»ºä¸€ä¸ª gif æœç´¢åº”ç”¨ç¨‹åºã€‚æ­£å¦‚æ–‡æ¡£æ‰€è¯´ï¼Œä½ éœ€è¦é€šè¿‡[åˆ›å»ºä¸€ä¸ªåº”ç”¨](https://developers.giphy.com/dashboard/?create=true)æ¥è·å¾— API å¯†åŒ™ã€‚ä¸€æ—¦ä½ è¿™æ ·åšäº†ï¼Œä½ å°†èƒ½å¤Ÿæœç´¢ä»–ä»¬çš„ APIï¼Œä¾‹å¦‚:`http://api.giphy.com/v1/gifs/search?q=funny+cat&api_key=dc6zaTOxFJmzC`ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ª API é”®ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªé”®å› ä¸ºå¤ªå¤šçš„è¯·æ±‚è€Œè¢«ç¦æ­¢ï¼Œä¸€å®šè¦åˆ›å»ºè‡ªå·±çš„é”®ğŸ¤¦â€

ä¸€æ—¦è·å–äº† gif(æˆ–è€…é™æ€å›¾åƒï¼Œå¦‚æœæ‚¨æ„¿æ„çš„è¯)ï¼Œå°±ç”¨ä¸€ä¸ªç±»`result`(æ˜¯çš„ï¼Œclassï¼Œè€Œä¸æ˜¯ id)åœ¨ div ä¸­æ˜¾ç¤ºå®ƒä»¬ğŸ‘).

è¿™æ˜¯ä½ å·èµ·è¢–å­ï¼Œåˆ›é€ å®ƒï¼Œä¸ºè‡ªå·±æ„Ÿåˆ°éª„å‚²çš„éƒ¨åˆ†ğŸ’ªï¼Œç„¶åæ¥è¿™é‡Œæ£€æŸ¥æˆ‘æ˜¯æ€ä¹ˆåšåˆ°çš„ã€‚

``
$('å½¢å¼')ã€‚submit(å‡½æ•°(ev){
ev . prevent default()ï¼›
var searchTerm = $('input ')ã€‚val()ï¼›`

 ````
var apiLink = "http://api.giphy.com/v1/gifs/search?api_key=dc6zaTOxFJmzC&q=" + searchTerm;

var output = '';
fetch(apiLink)
    .then(function(response){
        return response.json();
    })
    .then(function(images){
        $.each(images.data, function(i, im){
            output += `<img src="${im.images.downsized.url}"/>`;
        });

        $('.result').html(output);
    }); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

});
`

 `æ­£å¦‚æ‚¨å¯èƒ½æ³¨æ„åˆ°çš„ï¼Œä¸ä¸Šä¸€ç¯‡æ–‡ç« ç›¸æ¯”ï¼Œå‡ ä¹æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œç”¨ Fetch API äº¤æ¢ jQuery AJAX è°ƒç”¨éå¸¸å®¹æ˜“ã€‚

## [](#conclusion)ç»“è®º

è¿™ç¯‡åšæ–‡åˆ°æ­¤ä¸ºæ­¢ã€‚æˆ‘å¸Œæœ›å®ƒæ˜¯æœ‰ç”¨çš„ï¼Œå¹¶ä¸”æ‚¨å·²ç»çœ‹åˆ°äº†ä½¿ç”¨ Fetch API è¿›è¡Œ AJAX è¯·æ±‚æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚æˆ‘ä¹Ÿå¸Œæœ›ä½ å–œæ¬¢æ¼”ç¤ºç»ƒä¹ ğŸ‘è¿™ä¸‰ç¯‡æ–‡ç« ç³»åˆ—åˆ°æ­¤ç»“æŸã€‚ç¥ä½ ç©å¾—æ„‰å¿«ï¼Œå¾ˆå¿«å†è§ï¼ğŸ’ª````