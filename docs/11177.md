# å¦‚ä½•ç”¨ GitLab è®¾ç½® AppCenter è€Œä¸æ¨é€æœºå¯†æ–‡ä»¶

> åŸæ–‡:[https://dev . to/Adam gold/how-to-setup-app center-with-git lab-without-pushing-secret-files-4mk 8](https://dev.to/adamgold/how-to-setup-appcenter-with-gitlab-without-pushing-secret-files-4mk8)

æˆ‘ä»¬éƒ½åŒæ„ï¼Œæ‹¥æœ‰ä¸€ä¸ªè‡ªåŠ¨åŒ–åº”ç”¨æ„å»ºã€åˆ†å‘ç”šè‡³åˆ†æçš„å·¥å…·æ˜¯éå¸¸å¥½çš„ã€‚å—¯ï¼Œè¿™æ­£æ˜¯[åº”ç”¨ä¸­å¿ƒ](https://appcenter.ms)æ‰€åšçš„ã€‚è¿˜æœ‰æ›´å¤šã€‚

[![I want that](../Images/06834d2c8e56b872c05d01acb96f2f12.png)T2ã€‘](https://i.giphy.com/media/621y3s994ksbnxZZip/giphy.gif)

#### [](#however)ç„¶è€Œ...

å¯¹äºæˆ‘ä»¬è¿™äº›ä½¿ç”¨ GitLab ä½œä¸ºä¸»è¦ Git æœåŠ¡å™¨çš„äººæ¥è¯´ï¼Œè®¾ç½® GitLab ä¸ AppCenter ä¸€èµ·å·¥ä½œå¯èƒ½ä¼šéå¸¸ä»¤äººæ²®ä¸§ã€‚æˆ‘ä»¬ä¹Ÿä¸æƒ³å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç§˜å¯†æ¨é€åˆ°æˆ‘ä»¬çš„ Git æœåŠ¡å™¨ï¼Œæ— è®ºæ˜¯æˆ‘ä»¬çš„ Firebase JSON è¿˜æ˜¯ AppCenter ç§˜å¯†ã€‚

### [](#bitbucket-mirroring)ä½æ¡¶é•œåƒ

[![Screen Shot 2019-03-07 at 18.04.30](../Images/d9de2e5e36203ceafc253932ba7eb019.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ZfByUtzU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/OdXekub.png)

ä¸ºäº†è®© AppCenter ä¸ GitLabâ€œä¸€èµ·â€å·¥ä½œï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»å°†æˆ‘ä»¬çš„å­˜å‚¨åº“é•œåƒåˆ° BitBucketã€‚å› æ­¤ï¼Œç»§ç»­åœ¨ BitBucket ä¸­åˆ›å»ºä¸€ä¸ªå­˜å‚¨åº“ï¼Œç„¶åè½¬åˆ°æ‚¨çš„ç”¨æˆ·çš„`Settings` ( **ä¸æ˜¯å›è´­è®¾ç½®**ï¼Œæˆ‘ä»¬ä»ç„¶åœ¨ BitBucket ä¸­)ï¼Œåœ¨`App passwords`ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºå¯†ç ï¼Œå…·æœ‰æ‰€æœ‰å¯ç”¨çš„æƒé™ï¼Œå¹¶å¤åˆ¶æ‚¨ç¨åè·å¾—çš„å¯†ç ã€‚

[![Screen Shot 2019-03-07 at 18.13.21](../Images/e898c691a8f69e0ac9d7b2a0e968d94f.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--lL13XTE5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/CGjWUMu.png)

ç„¶åè¿›å…¥ GitLabï¼Œ`Settings`->-`Repository`ï¼Œåœ¨`Mirroring Repositories`ä¸‹ï¼Œè¾“å…¥ä½ çš„ BitBucket å…‹éš† URLï¼Œé€‰æ‹©`Mirror Direction`ä¸‹çš„`Push`ï¼Œ`Password`ä¸º auth æ–¹å¼ï¼Œç²˜è´´ä½ åœ¨ BitBucket ä¸­å¾—åˆ°çš„å¯†ç ã€‚ç‚¹å‡»`Mirror Repository`ï¼Œæ‚¨åº”è¯¥ä¼šåœ¨ä¸‹è¡¨ä¸­çœ‹åˆ°æ–°çš„ä¸€è¡Œã€‚ç‚¹æŒ‰å³ä¾§çš„â€œåˆ·æ–°â€æŒ‰é’®å¼€å§‹åŒæ­¥ã€‚

### [](#setup-appcenter)è®¾ç½®åº”ç”¨ä¸­å¿ƒ

é‚£æ˜¯å®¹æ˜“çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬ä»ç„¶éœ€è¦é…ç½®æˆ‘ä»¬çš„æ„å»ºå¹¶éšè—ä¸€äº›ç§˜å¯†ğŸ˜

è½¬åˆ°[åº”ç”¨ä¸­å¿ƒ](https://appcenter.ms/)ï¼Œå¦‚æœè¿˜æ²¡æœ‰ç”¨æˆ·ï¼Œåˆ›å»ºä¸€ä¸ªç”¨æˆ·ã€‚åˆ›å»ºæ‚¨çš„åº”ç”¨ç¨‹åº(å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ª Android å’Œä¸€ä¸ª iOS)ï¼Œå¹¶å®Œæˆæ·»åŠ åº”ç”¨ç¨‹åºä¸­å¿ƒçš„ SDK çš„æ­¥éª¤ã€‚ç°åœ¨è½¬åˆ°`Build`ï¼Œé€‰æ‹©`Select a Service`ä¸‹çš„`BitBucket`ã€‚é€‰æ‹©æ‚¨æ–°åˆ›å»ºçš„ repoï¼Œç„¶åæ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ‚¨æ‰€æœ‰çš„åˆ†æ”¯ã€‚

### [](#build-scripts)æ„å»ºè„šæœ¬

[![Screen Shot 2019-03-07 at 18.04.00](../Images/d2d30f958bf1dd2ff31b81994b3a114d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--T0zoy5X6--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/S5Jv17A.png) 
ç°åœ¨ä¸ºäº†è®© AppCenter æ„å»ºä½ çš„åº”ç”¨ï¼Œå®ƒéœ€è¦åº”ç”¨çš„ AppCenter secret(åœ¨è®¾ç½®ä¸­ç»™ä½ ï¼Œå¦‚ä¸Šæ‰€ç¤º)ï¼Œå¦‚æœä½ åƒæˆ‘ä¸€æ ·ä½¿ç”¨ Firebaseï¼Œå®ƒè¿˜éœ€è¦`google-services.json`æ–‡ä»¶(å¯¹äº Android)å’Œ`GoogleService-Info.plist`å¯¹äº iOSã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„æ˜¯åœ¨æ„å»ºä¹‹å‰æ³¨å°„å®ƒä»¬â€¦æˆ‘ä»¬å†™ç‚¹ä»£ç å§ï¼

æˆ‘ä»¬çš„æ–‡ä»¶å°†è¢«å‘½åä¸º`appcenter-pre-build.sh`(è¿™æ · AppCenter å¯ä»¥åœ¨æ„å»ºä¹‹å‰è¯†åˆ«å¹¶è¿è¡Œå®ƒ):

```
echo "Injecting secrets..."
echo "Updating Google JSON"
echo $GOOGLE_SERVICES_JSON | base64 --decode > "$APPCENTER_SOURCE_DIRECTORY/android/app/google-services.json"
echo "Updating Google plist"
echo $GOOGLE_SERVICES_PLIST | base64 --decode > "$APPCENTER_SOURCE_DIRECTORY/ios/GoogleService-Info.plist"
echo "Updating android secret"
echo $ANDROID_SECRET > "$APPCENTER_SOURCE_DIRECTORY/android/app/src/main/assets/appcenter-config.json"
echo "Updating iOS secret"
echo $IOS_SECRET > "$APPCENTER_SOURCE_DIRECTORY/ios/Glitz/AppCenter-Config.plist"
echo "Finished injecting secrets." 
```

è¿™æ®µä»£ç é€‚ç”¨äºä¸¤ä¸ªå¹³å°ï¼Œä½ å¯ä»¥éšæ„ç¼–è¾‘ã€‚

ç°åœ¨è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯æ’å…¥ç¯å¢ƒå˜é‡ï¼

### [](#environment-variables)ç¯å¢ƒå˜é‡

å¦‚æˆ‘ä»¬çš„ä»£ç æ‰€ç¤ºï¼Œæˆ‘ä»¬æœ‰ 4 ä¸ªç¯å¢ƒå˜é‡ã€‚è®©æˆ‘ä»¬å†æ¬¡è¿›å…¥æ„å»ºé…ç½®ï¼Œå±•å¼€`Environment Variables`ï¼Œå¹¶æ·»åŠ æˆ‘ä»¬çš„ 4 ä¸ªå˜é‡:

`GOOGLE_SERVICES_JSON`ã€`GOOGLE_SERVICES_PLIST`ã€`ANDROID_SECRET`ã€`IOS_SECRET`ã€‚

#### [](#make-sure-to-base64-encode-the-json-values-before-entering-them)ç¡®ä¿åœ¨è¾“å…¥ JSON å€¼ä¹‹å‰å¯¹å…¶è¿›è¡Œ base64 ç¼–ç ï¼

(ä½ å¯ä»¥ä½¿ç”¨[è¿™ä¸ªç«™ç‚¹](https://www.base64encode.org/)

ç°åœ¨ä½ çš„æ„å»ºåº”è¯¥è¿è¡Œäº†ï¼Œå®ƒåº”è¯¥åœ¨ä¸­é—´çš„æŸä¸ªåœ°æ–¹æ˜¾ç¤º`Injecting secretsâ€¦`:
[![Easy](../Images/9b5fc284cd96a31650f56df08a7168b3.png)](https://i.giphy.com/media/zcCGBRQshGdt6/giphy.gif)