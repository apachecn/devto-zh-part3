# Android å’Œ iOS æ¨é€é€šçŸ¥ï¼Œæ”¯æŒæµèŠå¤©å’ŒåŸç”Ÿååº”

> åŸæ–‡:[https://dev . to/lukesmetham/Android-IOs-push-notifications-with-stream-chat-and-react-native-3n0a](https://dev.to/lukesmetham/android-ios-push-notifications-with-stream-chat-and-react-native-3n0a)

# T2ã€‘

# [](#android-amp-ios-push-notifications-with-stream-chat-and-react-native)å®‰å“& iOS æ¨é€é€šçŸ¥ï¼Œå¸¦æµèŠå¤©å’Œ React åŸç”Ÿ

[Stream Chat](https://getstream.io/chat) å…è®¸æ‚¨éå¸¸è½»æ¾åœ°å°†æ¨é€é€šçŸ¥æ·»åŠ åˆ° React åŸç”Ÿåº”ç”¨ç¨‹åºä¸­ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨æœ¬åœ°æ¨é€é€šçŸ¥ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªç¤ºä¾‹ React æœ¬åœ°åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºå¯åœ¨ Android å’Œ iOS è®¾å¤‡ä¸Šè¿è¡Œã€‚

æ³¨æ„:*Expo åº”ç”¨ä¸æ”¯æŒæœ¬æ•™ç¨‹ã€‚æˆ‘ä»¬éœ€è¦è®¿é—®æœ¬æœºä»£ç æ¥è·å–å‘é€æµèŠå¤©æ¨é€é€šçŸ¥æ‰€éœ€çš„è®¾å¤‡ä»¤ç‰Œã€‚å¦‚æœæ‚¨å¸Œæœ›å°†å®ƒé›†æˆåˆ°ç°æœ‰çš„ Expo åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨å°†éœ€è¦å¼¹å‡ºã€‚*

å¦‚æœä½ æƒ³çœ‹è¿™ä¸ªæ•™ç¨‹çš„ä»£ç ï¼Œæˆ–è€…ç”šè‡³å…‹éš†å¹¶è·Ÿéšä½ è‡ªå·±ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªæŠ¥å‘Šä¸­æ‰¾åˆ°å®ƒ:ã€https://github.com/GetStream/react-native-chat-example-pushã€‘T2

é¦–å…ˆï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»ä½¿ç”¨ Stream åˆ›å»ºäº†ä¸€ä¸ªå¸æˆ·ï¼Œå¹¶åœ¨ä»ªè¡¨æ¿ä¸­åˆ›å»ºäº†ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚

ä¸ºäº†ä½¿äº‹æƒ…å˜å¾—æ›´ç®€å•ï¼Œæˆ‘ä»¬å°†ç¦ç”¨ authï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æµ‹è¯•æ¨é€æ¶ˆæ¯ã€‚è¯·æ³¨æ„ï¼Œè¿™ä»…é€‚ç”¨äºæµ‹è¯•/å¼€å‘ç¯å¢ƒã€‚åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œæ‚¨å¯ä»¥è½¬åˆ°åº”ç”¨ä»ªè¡¨æ¿ä¸­çš„èŠå¤©é€‰é¡¹å¡ï¼Œå‘ä¸‹æ»šåŠ¨è‡³èŠå¤©äº‹ä»¶ï¼Œå¹¶å¯ç”¨ç¦ç”¨èº«ä»½éªŒè¯æ£€æŸ¥çš„åˆ‡æ¢ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸éœ€è¦å‘é€æœ‰æ•ˆçš„ç”¨æˆ·ä»¤ç‰Œâ€”â€”é€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦ä»æœåŠ¡å™¨ç”Ÿæˆæœ‰æ•ˆçš„ç”¨æˆ·ä»¤ç‰Œ)ï¼›æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å…³äºä½¿ç”¨ Stream ä¸ºç”Ÿäº§åº”ç”¨ç¨‹åºç”Ÿæˆæœ‰æ•ˆä»¤ç‰Œçš„æ›´å¤šç»†èŠ‚ã€‚

[![](../Images/ade68e9ff8172b8a38697c77da509655.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--obt23Vre--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/mimIWRC.png)

ä¸€æ—¦ä½ è®¾ç½®å¥½äº†ï¼Œç¡®ä¿ä½ æŠŠä½ çš„ API å¯†åŒ™å’Œç§˜å¯†æ”¾åœ¨ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ï¼Œä»¥ä¾¿åœ¨æœ¬æ•™ç¨‹çš„åé¢ä½¿ç”¨ã€‚

æ¥ä¸‹æ¥ï¼Œåœ¨æ‚¨çš„ç»ˆç«¯ä¸­ä½¿ç”¨ react-native init chat-push-example å‘½ä»¤åˆå§‹åŒ–æ‚¨çš„æ–°é¡¹ç›®ã€‚æ‚¨å¯ä»¥å°†èŠå¤©æ¨é€ç¤ºä¾‹é‡å‘½åä¸ºæ‚¨å–œæ¬¢çš„ä»»ä½•åç§°ã€‚

> æ³¨æ„:å¦‚æœæ‚¨å°†å®ƒæ·»åŠ åˆ°ç°æœ‰çš„ç”¨ Expo æˆ– CRNA åˆ›å»ºçš„ React æœ¬åœ°é¡¹ç›®ä¸­ï¼Œæ‚¨å°†éœ€è¦å¼¹å‡ºã€‚è¯·æ³¨æ„ï¼Œå¼¹å‡ºæ˜¯ä¸å¯é€†çš„ï¼›ä½†æ˜¯ï¼Œå®ƒéœ€è¦è®¿é—®åŸç”Ÿ iOS å’Œ Android åŠŸèƒ½ã€‚_ [å¼¹å‡º](https://github.com/react-community/create-react-native-app/blob/master/EJECTING.md)

æˆ‘ä»¬å°†ä»å®‰è£…æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ä¾èµ–é¡¹å¼€å§‹:

`$ yarn add stream-chat react-native-push-notifications react-native link react-native-push-notifications`

## [](#ios-setup)iOS è®¾ç½®

å¯¹äº iOSï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è‹¹æœçš„ APN æœåŠ¡æ¥æ”¯æŒæ¨é€åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ Expo æˆ– Firebase äº‘æ¶ˆæ¯ã€‚

æ‚¨è¿˜éœ€è¦é“¾æ¥ä» React Native å¯¼å‡ºçš„ [PushNotificationIOS](https://facebook.github.io/react-native/docs/pushnotificationios) ã€‚æ‰“å¼€ Xcodeï¼Œåœ¨å·¦ä¾§è¾¹æ ä¸­ï¼Œç¡®å®šæ‚¨åœ¨â€œé¡¹ç›®å¯¼èˆªå™¨â€æ ‡ç­¾ä¸­(æ–‡ä»¶å¤¹å›¾æ ‡)ã€‚å³é”®å•å‡»é¡¹ç›®åç§°ä¸­çš„åº“ç›®å½•ï¼Œå¹¶é€‰æ‹©`Add files to <Project_Name_Here>`ã€‚

[![](../Images/628be818411603e7b9a834c3c9985bde.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--64CHukxV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/Ql0eSjl.png)

å°†å¼¹å‡ºä¸€ä¸ªæ–‡ä»¶å¯¹è¯æ¡†ã€‚å¯¼èˆªåˆ°é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œç„¶åå¯¼èˆªåˆ°æ‚¨çš„`node_modules`ç›®å½•ï¼Œå¹¶å¯¼èˆªåˆ°å¦‚ä¸‹æ‰€ç¤ºçš„è·¯å¾„ã€‚å•å‡»æ·»åŠ ã€‚

`./node_modules/react-native/Libraries/PushNotificationsIOS/RCTPushNotification.xcodeproj`

[![](../Images/a9b1cbed5baf146132e3b2e773efbd9c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--SgTQsIIN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/JSc3LB2.png)

ç°åœ¨ï¼Œåœ¨ navigator ä¾§æ ä¸­å•å‡»åº”ç”¨ç¨‹åº Xcode é¡¹ç›®çš„æ ¹ï¼Œå¹¶åœ¨ä¸­é—´çª—æ ¼é¡¶éƒ¨çš„é€‰é¡¹å¡ä¸­å•å‡» Build Phasesã€‚åœ¨ä¸‹ä¸€ä¸ªå±å¹•ä¸Šï¼Œæœ‰äº”ä¸ªä¸‹æ‹‰èœå•ã€‚æ‰¾åˆ°æ ‡æœ‰ Link Binaries with Libraries çš„ä¸‹æ‹‰åˆ—è¡¨ï¼Œå±•å¼€å®ƒï¼Œç„¶åå•å‡»å·¦ä¸‹è§’çš„åŠ å·å›¾æ ‡ã€‚

[![](../Images/60703960391954d606893fb1dc7c7a20.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--Fg0E7cM6--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/O2kKmry.png)

ç„¶åï¼Œèšç„¦æœç´¢æ¡†ï¼Œè¾“å…¥`RCTPushNotification`ã€‚æ‚¨åº”è¯¥åœ¨åˆ—è¡¨ä¸­çœ‹åˆ°ä¸€ä¸ªåä¸º`libRCTPushNotification.a`çš„æ–‡ä»¶ã€‚é€‰æ‹©å®ƒå¹¶å•å‡»æ·»åŠ ã€‚

[![](../Images/4291c54cf782660a64d665fa59241ace.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ln-NJZW9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/7faenYo.png)

æœ€åï¼Œå°†ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ·»åŠ åˆ°æ‚¨çš„`AppDelegate.m`æ–‡ä»¶çš„åº•éƒ¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:

[![](../Images/39951b29ed4570d50d7698bf6f7cea3d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--XWL6N3aw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/YOzyzCP.png)T3ã€‘

```
// Required to register for notifications

 - (void)application:(UIApplication *)application didRegisterUserNotificationSettings:(UIUserNotificationSettings *)notificationSettings

 {

  [RCTPushNotificationManager didRegisterUserNotificationSettings:notificationSettings];

 }

 // Required for the register event.

 - (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken

 {

  [RCTPushNotificationManager didRegisterForRemoteNotificationsWithDeviceToken:deviceToken];

 }

 // Required for the notification event. You must call the completion handler after handling the remote notification.

 - (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo

fetchCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler {

    [RCTPushNotificationManager didReceiveRemoteNotification:userInfo fetchCompletionHandler:completionHandler];

 }

 // Required for the registrationError event.

 - (void)application:(UIApplication *)application didFailToRegisterForRemoteNotificationsWithError:(NSError *)error

 {

  [RCTPushNotificationManager didFailToRegisterForRemoteNotificationsWithError:error];

 }

 // Required for the localNotification event.

 - (void)application:(UIApplication *)application didReceiveLocalNotification:(UILocalNotification *)notification

 {

  [RCTPushNotificationManager didReceiveLocalNotification:notification];

 } 
```

> æ³¨æ„:è¿™æ®µä»£ç å°†æ‚¨çš„ iOS åº”ç”¨ç¨‹åºæŒ‚æ¥åˆ° React Native çš„ _[rctphusnotificationmanager](https://facebook.github.io/react-native/docs/pushnotificationios)ï¼Œå…è®¸æˆ‘ä»¬æ£€ç´¢è®¾å¤‡ä»¤ç‰Œå¹¶åœ¨ JavaScript ä»£ç ä¸­å¤„ç†æ¨é€é€šçŸ¥ã€‚

## [](#running-on-your-device)åœ¨æ‚¨çš„è®¾å¤‡ä¸Šè¿è¡Œ

ä¸å¹¸çš„æ˜¯ï¼Œæ¨é€é€šçŸ¥åœ¨ iOS æ¨¡æ‹Ÿå™¨ä¸­ä¸èµ·ä½œç”¨ï¼Œæ‰€ä»¥ä½ éœ€è¦ä¸€ä¸ªç‰©ç† iOS è®¾å¤‡æ‰èƒ½çœ‹åˆ°ä½ çš„åŠ³åŠ¨æˆæœã€‚å¦‚æœæ‚¨æƒ³åœ¨è®¾å¤‡ä¸Šè¿è¡Œ React æœ¬åœ°åº”ç”¨ç¨‹åºï¼Œæ‚¨å¿…é¡»ç¼–è¾‘ Xcode é¡¹ç›®ï¼Œä»¥åŒ…å«ä»£ç ç­¾åå’Œæ¨é€åŠŸèƒ½ã€‚

æ‰“å¼€ Xcodeï¼Œä»å·¦è¾¹çš„å¯¼èˆªæ ä¸­ç¡®ä¿æ‚¨çš„é¡¹ç›®è¢«é€‰ä¸­ã€‚å¯¼èˆªåˆ°â€œé€šç”¨â€æ ‡ç­¾ï¼Œåœ¨â€œç­¾åâ€ä¸‹ï¼Œç¡®å®šæ‚¨ä½¿ç”¨ Apple Developer å¸æˆ·ç™»å½•ã€‚ç™»å½•åï¼Œé€‰æ‹©æ‚¨çš„å¼€å‘å›¢é˜Ÿï¼Œå¹¶ç¡®ä¿é€‰ä¸­è‡ªåŠ¨ç®¡ç†ç­¾åã€‚

[![](../Images/5b2bb1e3687a19b4fc0da22f06a65bf6.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--g4Rf2RfL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/RknSkmi.png)

åœ¨â€œGeneralâ€é€‰é¡¹å¡çš„â€œIdentityâ€ä¸‹ï¼Œç¡®ä¿æ‚¨çš„æ†ç»‘åŒ…æ ‡è¯†ç¬¦ä¸æ‚¨ç”¨äºé…ç½®å¸¦æœ‰ Stream çš„æ¨é€é€šçŸ¥çš„æ ‡è¯†ç¬¦ç›¸åŒ¹é…ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰è¿™æ ·åšï¼Œè¯·å‰å¾€[https://getstream.io/chat/docs/#push_ios](https://getstream.io/chat/docs/#push_ios)ç„¶åè¿”å›æœ¬æ•™ç¨‹ã€‚

æœ€åï¼Œå¯¼èˆªåˆ°â€œåŠŸèƒ½â€é€‰é¡¹å¡ï¼Œç¡®ä¿æ¨é€é€šçŸ¥å·²å¯ç”¨:

[![](../Images/371612508cb66fbc0e94e297b10fde3c.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--ECfRHLJ9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/89sZCHX.png)

ä½ éƒ½å‡†å¤‡å¥½äº†ï¼æ’å…¥æ‚¨çš„ iOS è®¾å¤‡ï¼Œä» Xcode çš„è¿è¡Œèœå•ä¸­é€‰æ‹©å®ƒï¼Œç„¶åæŒ‰ä¸‹è¿è¡Œã€‚

[![](../Images/d9fc7062f4b68c922543f4606d229d37.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--UcVl7ZH5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/N2Fj33h.png)

## [](#android-setup)å®‰å“è®¾ç½®

å¯¹äº Androidï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [Firebase äº‘æ¶ˆæ¯](https://firebase.google.com/docs/cloud-messaging/)æ¥æ”¯æŒæ¨é€é€šçŸ¥ã€‚æ‰€ä»¥é¦–å…ˆï¼Œä½ éœ€è¦å» [Firebase æ§åˆ¶å°](http://console.firebase.google.com/)ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºæˆ–è€…é€‰æ‹©ä¸€ä¸ªç°æœ‰çš„é¡¹ç›®ã€‚ç„¶åï¼Œè½¬åˆ°é¡¹ç›®è®¾ç½®å’Œå¸¸è§„é€‰é¡¹å¡ä¸‹ã€‚ç‚¹å‡»ä½ çš„åº”ç”¨ç¨‹åºï¼Œæ·»åŠ ä¸€ä¸ª android åº”ç”¨ç¨‹åºå¹¶ä¸‹è½½ä½ çš„ google-services.json æ–‡ä»¶â€”â€”ä½ éœ€è¦æŠŠå®ƒæ”¾åœ¨ä½ çš„é¡¹ç›® Android ç›®å½•çš„æ ¹ç›®å½•ä¸‹ã€‚

ç°åœ¨ï¼Œé€šè¿‡å¯¼èˆªåˆ°æ‚¨çš„é¡¹ç›®çº§`build.gradle`æ–‡ä»¶(`._android_build.gradle`)ï¼Œæ‰“å¼€å®ƒï¼Œå¹¶å°†ä»¥ä¸‹ä»£ç å¤åˆ¶åˆ°æ‚¨çš„ä¾èµ–é¡¹ä¸­ï¼Œç¡®ä¿`google-services.jsonfile`åŒ…å«åœ¨æ‚¨çš„ Android é¡¹ç›®çš„ä¾èµ–é¡¹ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
buildscript {

    // ...

    dependencies {

        // ...

        classpath 'com.google.gms:google-services:+'

        // ...  

    }

    // ...

} 
```

ç„¶åï¼Œåœ¨åŒä¸€ä¸ªç›®å½•ä¸­ï¼Œæ‰¾åˆ°`settings.gradle`æ–‡ä»¶ï¼Œå¦‚æœä¸‹é¢çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°±å¤åˆ¶å®ƒã€‚

> æ³¨æ„:å½“æ‚¨å…ˆå‰è¿è¡Œ react-native link æ—¶ï¼Œå®ƒåº”è¯¥å·²ç»æ·»åŠ äº†å¿…è¦çš„æ–‡ä»¶ï¼›ç„¶è€Œï¼Œæœ€å¥½æ€»æ˜¯ä»”ç»†æ£€æŸ¥ã€‚è”ç³»æœ‰æ—¶æ˜¯ä¸ç¨³å®šçš„ã€‚

```
include ':react-native-push-notification'

project(':react-native-push-notification').projectDir = file('../node_modules/react-native-push-notification/android') 
```

æ¥ä¸‹æ¥ï¼Œå¯¼èˆªåˆ°`._android_app/src`å¹¶æ£€æŸ¥æ‚¨æ˜¯å¦æœ‰`res`ç›®å½•ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºå®ƒå¹¶åœ¨é‡Œé¢åˆ›å»ºå¦ä¸€ä¸ªåä¸º values çš„ç›®å½•ã€‚ç„¶ååˆ›å»ºä¸€ä¸ªåä¸º`colours.xml`çš„æ–°æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹:

```
<resources>
        <color name="white">#FFF</color>
</resources 
```

é“¾æ¥å¯èƒ½å·²ç»å¤„ç†äº†ä¸‹ä¸€æ­¥ï¼Œä½†æ˜¯å†ä¸€æ¬¡ï¼Œåœ¨`android_app_src/main`ä¸­å¯¼èˆªåˆ°é¡¹ç›® android ç›®å½•ä¸­çš„`MainApplication.java`ã€‚

å¹¶ä¸”æ£€æŸ¥å®ƒæœ‰è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼Œç”¨æ³¨é‡Šçªå‡ºæ˜¾ç¤º:

```
import com.dieam.reactnativepushnotification.ReactNativePushNotificationPackage;  // <--- THIS

public class MainApplication extends Application implements ReactApplication {

  private final ReactNativeHost mReactNativeHost = new ReactNativeHost(this) {
      @Override
      protected boolean getUseDeveloperSupport() {
        return BuildConfig.DEBUG;
      }

      @Override
      protected List<ReactPackage> getPackages() {

      return Arrays.<ReactPackage>asList(
          new MainReactPackage(),
          new ReactNativePushNotificationPackage() // <---- & THIS      
      );
    }
  };
  ....
} 
```

æœ€åä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ç‚¹â€”â€”è½¬åˆ°`android_app_src_main_AndroidManifest.xml`å¹¶å¤åˆ¶ä»¥ä¸‹å†…å®¹(ä¸‹é¢çš„è¯„è®ºå°†æœ‰åŠ©äºæŒ‡å¯¼æ‚¨è¿›è¡Œç‰¹å®šçš„è®¾ç½®):

```
<!-- < Only if you're using GCM or localNotificationSchedule() > -->

  <uses-permission android:name="android.permission.WAKE_LOCK" />

  <permission
    android:name="${applicationId}.permission.C2D_MESSAGE"
    android:protectionLevel="signature" />
   <uses-permission android:name="${applicationId}.permission.C2D_MESSAGE" />

   <!-- < Only if you're using GCM or localNotificationSchedule() > -->
   <uses-permission android:name="android.permission.VIBRATE" />
   <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/>

<!-- Then, within the <application> block, place the following -->

    <receiver
    android:name="com.google.android.gms.gcm.GcmReceiver"
    android:exported="true"
    android:permission="com.google.android.c2dm.permission.SEND" >
    <intent-filter>
        <action android:name="com.google.android.c2dm.intent.RECEIVE" />
        <category android:name="${applicationId}" />
    </intent-filter>
  </receiver>

  <receiver android:name="com.dieam.reactnativepushnotification.modules.RNPushNotificationPublisher" />
  <receiver android:name="com.dieam.reactnativepushnotification.modules.RNPushNotificationBootEventReceiver">
    <intent-filter>
      <action android:name="android.intent.action.BOOT_COMPLETED" />
    </intent-filter>
  </receiver>

  <service android:name="com.dieam.reactnativepushnotification.modules.RNPushNotificationRegistrationService"/>

  <service android:name="com.dieam.reactnativepushnotification.modules.RNPushNotificationListenerServiceGcm" android:exported="false" >
    <intent-filter>
      <action android:name="com.google.android.c2dm.intent.RECEIVE" />
    </intent-filter>
  </service>

  <service
android:name="com.dieam.reactnativepushnotification.modules.RNPushNotificationListenerService"
        android:exported="false" >
    <intent-filter>
        <action android:name="com.google.firebase.MESSAGING_EVENT" />
    </intent-filter>
  </service> 
```

å°±æ˜¯è¿™æ ·ï¼æˆ‘ä»¬å‡†å¤‡å¼€å§‹ç¼–å†™ä¸€äº›æ™®é€šçš„ React Nativeï¼Œå¹¶å¯åŠ¨æˆ‘ä»¬çš„æµèŠå¤©å®¢æˆ·ç«¯ï¼Œå‡†å¤‡å‘é€æ¨é€é€šçŸ¥ã€‚

ç°åœ¨æ˜¯åœ¨æ‚¨å–œæ¬¢çš„å¹³å°ä¸Šå¯åŠ¨æ‚¨çš„åº”ç”¨ç¨‹åºçš„å¥½æ—¶æœºï¼Œå¦‚æœæ‚¨è¿˜æ²¡æœ‰è¿™æ ·åšçš„è¯ï¼Œè¯·æ£€æŸ¥ä¸€åˆ‡æ˜¯å¦æ­£å¸¸ï¼Œæ²¡æœ‰ä»»ä½•å¯æ€•çš„çº¢å±ã€‚

## [](#sending-push-notifications)å‘é€æ¨é€é€šçŸ¥

å¤šäºäº†[react-native-push-notifications](https://www.npmjs.com/package/react-native-push-notifications)ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªå¹³å°ä¸Šä½¿ç”¨åŸç”Ÿæ¨é€çš„åŒæ—¶ï¼Œè·å¾—äº†å¹³å°æ— å…³çš„ä½“éªŒï¼å› æ­¤ï¼Œé¦–å…ˆï¼Œåœ¨æˆ‘ä»¬å‘é€é€šçŸ¥ä¹‹å‰ï¼Œæˆ‘ä»¬å°†å¿«é€Ÿè¿æ¥æµå®¢æˆ·ç«¯ã€‚

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰“å¼€ App.js æ–‡ä»¶ã€‚æ£€æŸ¥`componentDidMount`æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå‘ç±»ä¸­æ·»åŠ ä¸€ä¸ªå¼‚æ­¥`componentDidMount`æ–¹æ³•ã€‚

> æ³¨æ„:è¿™æ˜¯æ‚¨éœ€è¦ä¹‹å‰çš„æµåº”ç”¨ç¨‹åºå¯†é’¥çš„åœ°æ–¹ã€‚å¦‚æœæ‚¨ä¸åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œæ‚¨è¿˜éœ€è¦åœ¨è¿™ä¸€æ­¥ç”Ÿæˆä¸€ä¸ªç”¨æˆ·ä»¤ç‰Œã€‚å¦‚æœæ‚¨æ­£åœ¨ç”Ÿäº§ï¼Œè¯·å‚è§æ­¤å¤„çš„:
> 
> å¦‚æœæ‚¨ä½¿ç”¨å¼€å‘æ¨¡å¼ï¼Œè¯·æ£€æŸ¥ä¸‹é¢ä»£ç ä¸­çš„æ³¨é‡Šï¼Œå–æ¶ˆå¯¹`changeAppSettings`è°ƒç”¨çš„æ³¨é‡Šï¼Œç„¶åæ‚¨å¯ä»¥å°†ä»»ä½•å­—ç¬¦ä¸²å€¼ä½œä¸ºä»¤ç‰Œä¼ é€’ã€‚

```
import React, { Component } from 'react';
import StreamChat from 'stream-chat';
import { API_KEY, USER_ID, USER_TOKEN } from 'react-native-dotenv';

class App extends Component {
  async componentDidMount() {
    const client = new StreamChat(API_KEY, null);
    await client.setUser({ id: USER_ID }, USER_TOKEN);

    PushNotification.configure({
      onRegister(token) {
        client
          .addDevice(token.token, token.os === 'ios' ? 'apn' : 'firebase')
          .then(() => {
            console.log(`registered device with token ${token}`);
          })
          .catch((e) => {
            console.error(`registering device failed: ${e}`);
          });
      },
      onNotification(notification) {
        notification.finish(PushNotificationIOS.FetchResult.NoData);
      },
      senderID: "1069091084846",
      requestPermissions: true
    });  
  }
  // ...
} 
```

å‡ºäºæœ¬æ•™ç¨‹çš„è€ƒè™‘ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª. env æ–‡ä»¶æ¥å­˜å‚¨è¿™äº›å€¼ï¼Œå¹¶ä½¿ç”¨å¦‚ä¸Šæ‰€ç¤ºçš„ [react-native-dotenv](https://www.npmjs.com/package/react-native-dotenv) æ¥è·å–å®ƒä»¬â€”â€”è¿™åœ¨ä»»ä½•æƒ…å†µä¸‹å¯¹æ‚¨çš„`API_KEY`æ¥è¯´éƒ½æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä½†æ˜¯æ‚¨çš„`USER_ID`å’Œ`USER_TOKEN`å¯èƒ½æ¥è‡ªçœŸå®ä¸–ç•Œè®¾ç½®ä¸­çš„å…¶ä»–åœ°æ–¹ï¼Œè¿™å–å†³äºæ‚¨çš„ç”¨ä¾‹ã€‚

ç°åœ¨å‰©ä¸‹çš„å°±æ˜¯è¿æ¥[react-native-push-notifications](https://github.com/zo0r/react-native-push-notification)ã€‚

åœ¨ componentDidMount ä¸­çš„ client.setUser è°ƒç”¨ä¸‹é¢ï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®(å¹¶è®°ä½ä»â€œreact-native-push-notificationâ€å¯¼å…¥ PushNotification åœ¨é¡¶éƒ¨)ã€‚

ä¸‹é¢åˆ†åˆ«æ˜¯ iOS å’Œ Android éƒ¨åˆ†ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ çš„åº”ç”¨æ˜¯è·¨å¹³å°çš„ï¼Œä½ å¯ä»¥åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªéƒ¨åˆ†:

```
PushNotification.configure({
  onRegister(token) {
    client
      .addDevice(token.token, token.os === 'ios' ? 'apn' : 'firebase')
      .then(() => {
        console.log(`registered device with token ${token}`);
      })
      .catch((e) => {
        console.error(`registering device failed: ${e}`);
      });
  },
  onNotification(notification) {
    // iOS only
    notification.finish(PushNotificationIOS.FetchResult.NoData);
  },
  senderID: "1069091084846", // (Android Only) Grab this from your Firebase Dashboard where you got google-services.json
  requestPermissions: true
}); 
```

è¿™æ˜¯è®©[react-native-push-notification](https://www.npmjs.com/package/react-native-push-notification)åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å¤„ç†æ¨é€é€šçŸ¥çš„æœ€ä½é…ç½®ã€‚ä½ åº”è¯¥çœ‹çœ‹ä»–ä»¬çš„ [GitHub repo](https://github.com/zo0r/react-native-push-notification#readme) ä»¥è·å¾—é…ç½®é€‰é¡¹å’Œè®¾ç½®çš„å®Œæ•´å‚è€ƒã€‚

## [](#try-it-out)è¯•è¯•çœ‹

åœ¨æœ¬èŠ‚ä¸­ï¼Œå¦‚æœæ‚¨çš„æ„å»ºé¢å‘ iOSï¼Œæ‚¨éœ€è¦æ’å…¥ä¸€ä¸ªçœŸå®çš„ iOS è®¾å¤‡â€”â€”æ¨é€é€šçŸ¥åœ¨æ¨¡æ‹Ÿå™¨ä¸­æ— æ³•å·¥ä½œã€‚ç„¶è€Œï¼ŒAndroid æ¨¡æ‹Ÿå™¨*æ”¯æŒæ¨é€é€šçŸ¥â€”â€”åªè¦ç¡®ä¿ä½ ä½¿ç”¨çš„æ¨¡æ‹Ÿå™¨å®‰è£…äº† Google Play æœåŠ¡(åœ¨ AVD ç®¡ç†å™¨ä¸­æ˜¾ç¤ºä¸º Play Store å›¾æ ‡)*

[![](../Images/e62f1ab8c2b43527f1646945012b2bd5.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--WnE1LXB_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/aky0VIi.png)

å¦‚æœæ‚¨åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶å¯ç”¨äº†è¿œç¨‹ JS è°ƒè¯•ï¼Œé‚£ä¹ˆä¸€æ—¦æ‚¨æ¥å—äº†å…è®¸é€šçŸ¥çš„æƒé™ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¸¦æœ‰ä»¤ç‰Œæ—¥å¿—çš„æ³¨å†Œè®¾å¤‡å‡ºç°åœ¨æ§åˆ¶å°ä¸­ã€‚

ä¸€æ—¦ä½ çš„è®¾å¤‡è¢«æ³¨å†Œï¼Œç¡®ä¿ä½ å·²ç»å®‰è£…äº† [getstream-cli](https://github.com/getstream/stream-cli) å¹¶é…ç½®äº†ä½ çš„ API å¯†åŒ™å’Œå¯†ç (ä»¥åŠå…¶ä»–å¿…éœ€çš„å‚æ•°):

```
$ stream config:set 
```

é…ç½®å®Œæˆåï¼Œæ‚¨å¯ä»¥åœ¨ç»ˆç«¯ä¸­å®‰å…¨åœ°è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
$ stream chat:push:test 
```

é¦–å…ˆï¼ŒCLI å°†æç¤ºæ‚¨è¾“å…¥è¦å‘å…¶å‘é€é€šçŸ¥çš„ç”¨æˆ·çš„ ID(æ‚¨å¯ä»¥åœ¨æ‚¨çš„ã€‚envâ€“æˆ–ä¹‹å‰å­˜å‚¨å®ƒçš„ä»»ä½•åœ°æ–¹)â€“ç„¶åå°†å‰©ä½™çš„æ¯ä¸ªæ­¥éª¤ç•™ç©ºï¼Œä»¥ä¾¿å‘æ³¨å†Œåˆ°è¯¥ç”¨æˆ·çš„è®¾å¤‡å‘é€é»˜è®¤é€šçŸ¥ã€‚æœ‰å…³æ¨é€ CLI é€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æ­¤å¤„çš„ã€‚

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åªæ˜¯å¬åˆ°å®å£°æˆ–æŸç§é’Ÿå£°ï¼Œä½ çš„é€šçŸ¥å‡ºç°åœ¨ä½ çš„è®¾å¤‡ä¸Šã€‚æ­å–œä½ ã€‚ğŸ˜