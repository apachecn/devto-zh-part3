# ç”¨ GraphQL å’Œ Apollo åˆ›å»º api ç¬¬ä¸€éƒ¨åˆ†

> [https://dev . to/gugadev/create-un-form-con-graph QL-y-angular---part-I-1m 9k](https://dev.to/gugadev/creando-un-formulario-con-graphql-y-angular---parte-i-1m9k)

> **æ³¨:**æœ¬æ•™ç¨‹ç”±äºå…¶å¤æ‚æ€§ï¼Œå°†åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚ç¬¬ä¸€ä¸ªæ˜¯æœ¬æ–‡ï¼Œå°†ä¸ TypeGraphQL ä¸€èµ·ä½¿ç”¨ GraphQL å’Œ Apollo ä¸“ç”¨äºåç«¯ã€‚ç¬¬äºŒä¸ªï¼Œå‰ç«¯ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Angularã€‚

[æºä»£ç ](https://github.com/gugadev/graphql-ng-signup)

åœ¨ä¸Šä¸€ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº† GraphQL çš„åŸºæœ¬æ¦‚å¿µã€‚æˆ‘ä»¬çœ‹åˆ°äº†å˜é‡ï¼Œæ¬²æœ›ï¼Œçªå˜ç­‰ç­‰ã€‚å› ä¸ºåšæŒç†è®ºæ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç€æ‰‹å®è·µæ‰€å­¦åˆ°çš„ä¸œè¥¿å§ã€‚

## [](#preparaci%C3%B3n-del-proyecto)é¡¹ç›®å‡†å¤‡

é¦–å…ˆï¼Œè¯·è®°ä½ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ node ltã€‚åŒæ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨ NPM å’Œ yarã€‚

æˆ‘ä»¬éœ€è¦å®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨ä¸º:

*   `@types/bcryptjs`
*   `@types/graphql`
*   `@types/lokijs`
*   `@types/pino`
*   `apollo-server`
*   `bcryptjs`
*   `class-validator`
*   `graphql`
*   `lokijs`
*   `pino`
*   `pino-pretty`
*   `reflect-metadata`
*   `type-graphql`
*   `typedi`

å‘å±•å•ä½å¦‚ä¸‹:

*   `@types/node`
*   `nodemon`
*   `ts-node`
*   `tslint`
*   `typescript`

æœ€åï¼Œæ·»åŠ è„šæœ¬`start`ä»¥è¿è¡Œ nodemon è¿è¡Œ ts-node å¹¶è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åº:

```
{  "scripts":  {  "start":  "nodemon --exec ts-node src/main.ts --watch src/ --ignore src/database/data.json"  }  } 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#creando-los-modelos)åˆ›å»ºæ¨¡å‹

> ä¸ºäº†ä¸“æ³¨äº GraphQLï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å†…å­˜ä¸­çš„æ•°æ®åº“ã€‚

ç¬¬ä¸€æ­¥å°†æ˜¯åˆ›å»ºæ¨¡å‹ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªæˆ‘ä»¬ç§°ä¹‹ä¸º`User` :

```
// user.type.ts
import {
  ObjectType,
  Field,
  Int
} from 'type-graphql'

@ObjectType()
export default class User {
  @Field(type => Int)
  id: number
  @Field()
  email: string
  @Field()
  password: string
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ­¤ç±»å‹ä»…åŒ…å«ä¸‰ä¸ªå­—æ®µ:

*   id:ä»£è¡¨ PKã€‚
*   ç”µå­é‚®ä»¶
*   å¯†ç 

è¯·æ³¨æ„ï¼Œ`type-graphql`åœ¨ JavaScript ç±»å‹ä¸è¶³æ—¶ä¸ºæˆ‘ä»¬æä¾›äº†å¯é€‰ç±»å‹ï¼Œå¦‚`Int`ã€‚ä¾‹å¦‚ï¼Œç¼ºçœæƒ…å†µä¸‹ï¼Œ`number`æ˜ å°„åˆ°`Float`å›¾ QLã€‚ä¸ºæ­¤ï¼Œé€šè¿‡å‚æ•°`type`ï¼Œæˆ‘ä»¬å‘Šè¯‰ä»–æ˜¯`INT`å‹ã€‚

åè¿‡æ¥ï¼ŒåŒä¸€ç±»å°†æˆä¸ºæˆ‘ä»¬çš„æ•°æ®åº“å¼•æ“å°†ä½¿ç”¨çš„æ¨¡å‹(å§‹ç»ˆè€ƒè™‘é‡ç”¨)

## [](#creando-el-servicio)åˆ›å»ºæœåŠ¡

æˆ‘ä»¬ç°åœ¨å¼€å§‹åˆ›å»ºâ€œ`User`â€çš„æœåŠ¡ã€‚å®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
// user.service.ts
import { Service } from 'typedi'
import { hash, genSalt } from 'bcryptjs'
import db from '../database/client'
import User from './user.type'
import UserInput from './user.input'

@Service()
export default class UserService {
  private datasource = db.getCollection('users')

  findByEmail(email: strng): User {
    return this.datasource.findOne({ email })
  }
  async create(data: UserInput): Promise<User> {
    const body = {
      ...data,
      id: this.datsource.count() + 1,
      password: await hash(data.password, await genSalt(10))
    }
    const { id } = this.datasource.insert(body)
    return this.find(id)
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡æ˜¯ä¸è£…é¥°è€…`Service`ä¸€èµ·æ ‡æ³¨çš„ã€‚è¿™å°è£…é¥°æœºè®©æˆ‘ä»¬æŠŠä¸€ä¸ªç­çº§æ³¨å†Œä¸º DI å®¹å™¨ä¸­çš„ä¸€é¡¹æœåŠ¡ï¼Œä»¥åå†æŠŠå®ƒæ³¨å…¥*å…¶ä»–åœ°æ–¹ã€‚*

 *å‰©ä¸‹çš„çœŸçš„å¾ˆç®€å•ã€‚ä½œä¸ºè´¢äº§ï¼Œæˆ‘ä»¬æœ‰`datasource`ï¼Œå…¶ä¸­åŒ…å«ç€æˆ‘ä»¬ä»æ•°æ®åº“ä¸­æ£€ç´¢åˆ°çš„`users`é›†åˆã€‚

æœ€åæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œå³`email`é€šè¿‡ç”¨æˆ·çš„`email`å’Œ`create`æ¥æŸ¥æ‰¾ç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·æ¥æ”¶ç±»å‹ä¸º`UserInput`çš„å‚æ•°ï¼Œæ•£åˆ—å…¶å¹³é¢å¯†ç ï¼Œå°†å…¶æ’å…¥é›†åˆä¸­ï¼Œæœ€åè¿”å›åˆ›å»ºçš„æ–‡æ¡£ã€‚

å¬èµ·æ¥ä¸é”™ï¼Œä½†æ˜¯ï¼Œâˆä¼šä¸ä¼šæ˜¯`UserInput`ï¼ŸğŸ¤”

## [](#argumentos-personalizados)ä¸ªæ€§åŒ–å‚æ•°

æ‚¨ä¼šå‘ç°åœ¨ä¸Šä¸€ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬è°ˆåˆ°äº†â€œ`input`â€è¿™ç±»ç±»å‹ï¼Œè¿™äº›ç±»å‹åŒ…æ‹¬è¦ä½œä¸ºä¸€ä¸ªé›†åˆä¼ é€’åˆ°æŸ¥è¯¢ä¸­çš„å•ä¸ªå‚æ•°çš„å­—æ®µã€‚åŸºäºè¿™ä¸€æ¦‚å¿µï¼Œæˆ‘ä»¬å¼€å§‹åˆ›é€ æˆ‘ä»¬è‡ªå·±çš„è¾“å…¥ã€‚

```
import { IsEmail } from 'class-validator'
import {
  InputType,
  Field
} from 'type-graphql'

@InputType()
export default class UserInput {
  @Field()
  @IsEmail()
  email: string
  @Field()
  password: string
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ä½ ä¼šæ„è¯†åˆ°å®ƒå¾ˆåƒ`User`ï¼Œâˆå—ï¼Ÿå”¯ä¸€çš„åŒºåˆ«æ˜¯è£…é¥°`InputType`ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬è¡¨ç¤ºè¿™é—¨è¯¾æ˜¯ç»“æ„`input`ã€‚æ­¤å¤–ï¼Œç”±äºæˆ‘ä»¬éå¸¸å°å¿ƒï¼Œæˆ‘ä»¬é€šè¿‡è£…é¥°`isMail`éªŒè¯äº†å­—æ®µ`email`ï¼ŒéªŒè¯åŒ…å±æ€§`class-validator`ï¼Œè¿™å°†æ˜¯è‡ªåŠ¨çš„ï¼ŒåŒæ ·ï¼Œå¦‚æœä¸ºå­—æ®µæä¾›äº†é”™è¯¯çš„å€¼ï¼Œä¹Ÿä¼šé€šè¿‡ GraphQL è¿”å›é”™è¯¯ã€‚

## [](#%C2%A0creando-el-resolver)åˆ›å»ºè§£æå™¨

å¥½äº†ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ç±»å‹ï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹åˆ›å»ºæŸ¥è¯¢å’Œçªå˜ä¸å…¶å„è‡ªçš„è§£æå™¨ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç±»å¹¶ç”¨`Resolver`è¿›è¡Œæ³¨é‡Šï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
import {
  Resolver,
  Arg,
  Query,
  Mutation,
  Int
} from 'type-graphql'
import User from './user.type'

@Resolver(of => User)
export default class UserResolver {

} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€šè¿‡è£…é¥°`Resolver`æˆ‘ä»¬è¡¨ç¤ºè¿™ä¸ªç­çº§å°†åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªè§£æå™¨ï¼Œæ­¤å¤–ï¼Œé€šè¿‡è®ºè¯`of`æˆ‘ä»¬è¡¨ç¤ºå®ƒå°†å±äºè°ï¼›åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œa `User`ã€‚æˆ‘ä»¬ç°åœ¨å°†`User`æœåŠ¡çº³å…¥æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶ä»æŸ¥è¯¢å’Œçªå˜ä¸­è¿”å›ã€‚

```
// imports anteriores
import { Inject } from 'typedi'

@Resolver(of => User)
export default class UserResolver {
  @Inject() private service: UserService
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

å‡†å¤‡å¥½äº†ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œå‘ç”Ÿè¿‡å—ï¼ŸğŸ¤”

è£…é¥°`@Inject`å°†ä¾èµ–(ä¸€ä¸ªå®ä¾‹)æ³¨å…¥å˜é‡æˆ–å‚æ•°ä¸­ï¼Œè¿™ç§ä¾èµ–å¿…é¡»ä¸å˜é‡çš„ç±»å‹ç›¸åŒã€‚å½“æˆ‘ä»¬ä½¿ç”¨`@Inject`æ—¶ï¼Œæˆ‘ä»¬æ‰€åšçš„æ˜¯å¯¹å®¹å™¨è¯´:

> å“ï¼Œâˆå¦‚æœä½ æœ‰ä¸€ä¸ªå«
> `UserService`çš„ç­çº§çš„è¯ï¼Œåœ¨ä½ çš„ç™»è®°å†Œä¸ŠæŸ¥è¯¢ä¸€ä¸‹å¥½å—ï¼Ÿå¦‚æœä½ æœ‰ï¼Œæˆ‘éœ€è¦ä½ ç»™æˆ‘ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æŠŠå®ƒä¿å­˜åœ¨å˜é‡`service`ã€‚

ä½ æ˜ç™½å—ï¼Ÿå¤ªå¥½äº†ã€‚ä¸€æ—¦æˆ‘ä»¬å·²ç»åŒ…æ‹¬äº†å¯¹`UserService`çš„ä¾èµ–ï¼Œæˆ‘ä»¬å°±å·²ç»å‡†å¤‡å¥½ä½¿ç”¨å®ƒçš„æ–¹æ³•äº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸‹æˆ‘ä»¬çš„`Query`ã€‚å®ƒå°†é€šè¿‡å…¶`id` :
è´Ÿè´£æŸ¥æ‰¾ç”¨æˆ·

```
// imports anteriores
import {
  ...
  Arg, // agregamos
  Query, // agregamos
  Int // agregamos
} from 'type-graphql'

@Resolver(of => User)
export default class UserResolver {
  ...
  @Query(returns => User, {Â nullable: true })
  user(@Arg('email') email: string) {
    return this.userService.findByEmail(email)
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é€šè¿‡è£…é¥°å•†`Query`æˆ‘ä»¬è¡¨ç¤ºï¼Œè¿™ç§æ–¹æ³•ä»£è¡¨æŸ¥è¯¢ã€‚æ­¤è£…é¥°æ¥å—ä¸¤ä¸ªå‚æ•°:è¿”å›ç±»å‹å’Œå¯é€‰çš„é€‰é¡¹æ•°ç»„ã€‚é€šè¿‡é‚£ä¸ªé˜µåˆ—æˆ‘ä»¬å‘Šè¯‰ä½ è¿™ä¸ªæŸ¥è¯¢**å¯ä»¥è¿”å› null** ï¼Œå› ä¸ºå½“ä¸€ä¸ªç”¨æˆ·ä¸åœ¨çš„æ—¶å€™ï¼Œè¿”å›çš„å°†æ˜¯`null`ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬è¿”å›`null`æ—¶ä¼šå¾—åˆ°é”™è¯¯ã€‚

åœ¨`id`çš„è®ºç‚¹ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†`Arg`å¼çš„è£…é¥°å™¨ï¼Œæˆ‘ä»¬ç»™å®ƒå–äº†ä¸ªåå­—ã€‚æœ€åï¼Œå½“è¯¥æ–¹æ³•è¿è¡Œæ—¶ï¼Œå°†åœ¨æ•°æ®åº“ä¸­æœç´¢è¯¥`email`ï¼Œå¹¶è¿”å›ç›¸å…³ç”¨æˆ·ã€‚

ä»¥ä¸Šå®šä¹‰ç¿»è¯‘æˆä»¥ä¸‹å›¾ QL æ–¹æ¡ˆ:

```
type Query {
  user(email: String!): User
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

ç®€å•å—ï¼Ÿã€‚æˆ‘ä»¬ç°åœ¨ç»§ç»­æˆ‘ä»¬çš„çªå˜ï¼Œå®ƒå°†è´Ÿè´£åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·ã€‚æ–¹æ³•çš„å®šä¹‰ç›¸å½“ç±»ä¼¼æŸ¥è¯¢:

```
// imports anteriores
import {
  ...
  Mutation // agregamos
} from 'type-graphql'
import UserInput from './user.input'

@Resolver(of => User)
export default class UserResolver {
  ...
  @Mutation(returns => User)
  user(@Arg('data') data: UserInput) {
    return this.userService.create(data)
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æ³¨æ„æ–¹æ³•çš„è®ºè¯ï¼Œæˆ‘ä»¬ä¸å†é€šè¿‡è£…é¥°ç¬¦`Arg`ä¸Šçš„`type`ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»é€šè¿‡ Typescript è¿™æ ·åšäº†ã€‚ä½ ä¼šåšçš„æ˜¯*ã€type-graph QLã€‘*æ˜¯ç”¨åå°„æ¥çœ‹å‚æ•°çš„ç±»å‹ï¼Œåšæ­£ç¡®çš„æ˜ å°„ã€‚å¤ªæ£’äº†ï¼

ä»¥ä¸Šå†…å®¹å°†ç¿»è¯‘ä¸º:

```
type Mutation {
  createUser(data: UserInput!): User
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#di-base-de-datos-y-apollo)è¿ªÂ·åŸºÂ·å¾· datos y é˜¿æ³¢ç½—

æˆ‘ä»¬å·²ç»å¾—åˆ°äº†å‡ ä¹æ‰€æœ‰æˆ‘ä»¬éœ€è¦çš„ï¼Œæˆ‘ä»¬åªå·®å‡ æ­¥äº†ã€‚ç¬¬ä¸€æ˜¯é…ç½®æˆ‘ä»¬çš„ä¾å­˜å…³ç³»æ³¨å…¥å®¹å™¨ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½œå¦‚ä¸‹å®‰æ’:

```
import {Â Container } from 'typedi'
import { useContainer } from 'type-graphql'

export default () => {
  useContainer(Container)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬ä»`typedi`è¿›å£å®¹å™¨ï¼Œå¹¶ä¼ ç»™`type-graphql`ä¸ºæˆ‘ä»¬è®¾ç½®ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦åšçš„ï¼Œä»¥ä¾¿ä½¿å®ƒèƒ½å¤Ÿè¿ä½œï¼Œå¹¶æä¾›å’Œæ³¨å…¥å„ç§ä¾èµ–ã€‚

æ¥ä¸‹æ¥æ˜¯åˆ›å»ºæˆ‘ä»¬çš„æ•°æ®åº“ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨æ•™ç¨‹å¼€å¤´æ‰€è¯´ï¼Œå®ƒå°†æˆä¸ºè®°å¿†ä¸­çš„æ•°æ®åº“ï¼Œå› æ­¤ï¼Œå¯ä»¥å‡è®¾ï¼Œè®¾ç½®å°†éå¸¸ç®€å•:

```
// database/bootstrap.ts
import * as Loki from 'lokijs'

const db: Loki = new Loki('data.json')
db.addCollection('users')

export default db 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

è¯·æ³¨æ„ï¼Œå½“æˆ‘ä»¬å®ä¾‹åŒ–æ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸ºâ€œ`users`â€çš„é›†åˆï¼Œè¯¥é›†åˆå°†å­˜å‚¨æˆ‘ä»¬è¦åˆ›å»ºçš„ç”¨æˆ·ã€‚

æœ€åï¼Œæˆ‘ä»¬éœ€è¦ç”¨é˜¿æ³¢ç½—åˆ›å»ºæˆ‘ä»¬çš„ GraphQL æœåŠ¡å™¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ç¯å…‰:

```
// server/index.ts
import {Â ApolloServer } from 'apollo-server'
import { buildSchema } from 'type-graphql'
import formatError from '../errors/argument.format'
import UserResolver from '../users/user.resolver'

/**
 * Creates a Apollo server using an
 * executable schema generated by
 * TypeGraphQL.
 * We provide a custom Apollo error
 * format to returns a non-bloated
 * response to the client.
 */
export default async () => {
  const schema = await buildSchema({
    resolvers: [
      UserResolver
    ]
  })
  return new ApolloServer({
    schema
  })
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘ä»¬æ‰€åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å¯¼å…¥è§£æå™¨ï¼Œç„¶åä»¥æ•°ç»„çš„å½¢å¼ä¼ é€’åˆ°â€œ`buildSchema`â€ä»¥ä¾¿ç”Ÿæˆé˜¿æ³¢ç½—å¯ä»¥ç†è§£çš„æœ‰æ•ˆçš„`schema`å›¾ QLã€‚äºŒæ˜¯å®ä¾‹åŒ–`ApolloServer`ï¼Œå¹¶ä¸å…¶ä»–å¯é€‰å±æ€§ä¸€èµ·ä¼ é€’`schema`ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å±æ€§æ¸…å•ã€‚å®Œæˆåï¼Œæˆ‘ä»¬å°±æœ‰ä¸€å°æœåŠ¡å™¨å¯ä»¥è¿è¡Œäº†ã€‚

## [](#entry-point)è¿›å…¥ç‚¹

æœ€åï¼Œæˆ‘ä»¬åˆ›å»ºäº†é˜¿æ³¢ç½—æœåŠ¡å™¨è¿è¡Œçš„ä¸»æ–‡ä»¶ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åªå¯¼å…¥æœåŠ¡å™¨åˆ›å»ºçš„åŠŸèƒ½ï¼Œè¿è¡ŒåŠŸèƒ½`listen`ï¼Œå®ƒå°†ä¼šç›‘å¬æœåŠ¡å™¨ã€‚

```
// main.ts
import 'reflect-metadata'
import enableDI from './container/bootstrap'
import createServer from './server'
import log from './logger'

const run = async () => {
  enableDI()
  try {
    const server = await createServer()
    const { url } = await server.listen({ port: 3000 })
    log.info(`ğŸš€  Server ready at ${url}`)
  } catch (e) {
    log.error(e)
  }
}

run() 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#opcional)æ“ä½œé€‰é¡¹

### [](#error-formatter)é”™è¯¯æ ¼å¼åŒ–ç¨‹åº

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“å‡ºç°è¿è¡Œæ—¶é”™è¯¯æ—¶ï¼ŒGraphQL è¿”å›ä¸€ä¸ªåŒ…å«è®¸å¤šè¯¦ç»†ä¿¡æ¯çš„å¤§å¯¹è±¡ï¼Œå¦‚å‘ç”Ÿé”™è¯¯çš„è¡Œã€å †æ ˆè·Ÿè¸ªç­‰ã€‚ä¸ºäº†é¿å…è¿‡äºè¯¦ç»†çš„å®‰å…¨å’Œç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ‹¦æˆªé”™è¯¯å¹¶éšæ„ä¿®æ”¹é”™è¯¯çš„æ ¼å¼åŒ–ç¨‹åºã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªä¾‹å­:

```
// errors/argument.format.ts
import { GraphQLError } from 'graphql'
import { ArgumentValidationError } from 'type-graphql'
import { ValidationError } from 'class-validator'

/**
 * Describes a custom GraphQL error format.
 * @param { err } Original GraphQL Error
 * @returns formatted error
 */
export default (err: GraphQLError): any => {
  const formattedError: { [key: string]: any } = {
    message: err.message
  }

  if (err.originalError instanceof ArgumentValidationError) {
    formattedError.validationErrors = err.originalError.validationErrors.map((ve: ValidationError) => {
      const constraints = {Â ...ve.constraints }
      return {
        property: ve.property,
        value: ve.value,
        constraints
      }
    })
  }
  return formattedError
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

é”™è¯¯æ ¼å¼åŒ–ç¨‹åºæ”¶åˆ°ç±»å‹ä¸ºâ€œ`GraphQL`â€çš„é”™è¯¯ã€‚æ­¤é”™è¯¯åŒ…å«è¯¸å¦‚`message`ã€`paths`ã€`location`ã€`extensions`ç­‰å±æ€§ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬åªèƒ½æå–æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸å¤ªè¯¦ç»†çš„æ¶ˆæ¯å’ŒéªŒè¯é”™è¯¯:åªéœ€è¦å‘ç”Ÿé”™è¯¯çš„å±æ€§ã€å…¶å€¼å’Œæœªå‘ç”Ÿçš„çº¦æŸã€‚è¿™æ ·æˆ‘ä»¬å°±æœ‰äº†å®šåˆ¶é”™è¯¯ã€‚

ä¸ºäº†å¯ç”¨å®ƒï¼Œæˆ‘ä»¬åªå°†å®ƒä¼ é€’ç»™`ApolloServer` :
æ„é€ å‡½æ•°çš„`formatError`é€‰é¡¹

```
return new ApolloServer({
    schema,
    formatError
  })
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#run-forrest-run)å¿«è·‘ï¼Œç¦é›·æ–¯ï¼Œå¿«è·‘ï¼

çœŸç›¸çš„æ—¶åˆ»åˆ°äº†ã€‚æ­¤æ—¶æ²¡æœ‰å›å¤´è·¯:è¦ä¹ˆè·‘ï¼Œè¦ä¹ˆå¼€æªæ‰“æ­»ä»–â–¡è·‘æœåŠ¡å™¨è¿è¡Œç»å…¸â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡ã€‚

å¦‚æœæˆ‘ä»¬å» [localhost:3000](http://localhost:3000) æˆ‘ä»¬å°†çœ‹åˆ°æ“åœºå¼€å§‹æ¯”èµ›ã€‚å›¾ç‰‡ä¸­æ˜¾ç¤ºçš„æŸ¥è¯¢å’Œçªå˜æŸ¥çœ‹ç»“æœï¼

[![](../Images/340f74c573ccb8f8e45518a5ceec6a22.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--vo2CONAI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.imgur.com/Nkaw21b.png)

åœ¨æ­¤ä¹‹å‰ï¼Œé˜¿æ³¢ç½—å…¬å¸çš„å®¢æˆ·ä¸ºå…¶æä¾›äº†ä¸€ç³»åˆ—çš„æœåŠ¡ã€‚ä¸€ç‚¹ä¹Ÿä¸ã€‚ğŸ¤˜*