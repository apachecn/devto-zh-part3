# å›¢é˜ŸåŸå¸‚â€”â€”æµ‹è¯•å¤±è´¥ä½†æ„å»ºé€šè¿‡çš„å¥‡æ€ªæ¡ˆä¾‹

> åŸæ–‡:[https://dev.to/ankitvijay/team-city-å¥½å¥‡-æµ‹è¯•å¤±è´¥-é€šè¿‡-æ„å»º-4gbf](https://dev.to/ankitvijay/team-city--curious-case-of-failed-tests-but-passed-build-4gbf)

æœ€è¿‘ï¼Œæˆ‘å†™äº†ä¸€ç¯‡å…³äºæˆ‘å¦‚ä½•è®¾æ³•å…³é—­æ•´ä¸ªç»„ç»‡çš„[æ„å»ºç®¡é“çš„å¸–å­ã€‚](https://dev.to/ankitvijay/when-i-brought-down-build-pipeline-for-entire-organization-57kh)è™½ç„¶é‚£æ®µæ—¶é—´æ˜¯æˆ‘çš„é”™ï¼Œä½†è¿™æ¬¡åº”è¯¥æ˜¯æ›¼åŸé˜Ÿæ‰¿æ‹…è´£ä»»ã€‚

### [](#background)èƒŒæ™¯

æˆ‘æœ€è¿‘ä¸ºæˆ‘ä»¬çš„æ–°åˆ›å»ºäº†ä¸€ä¸ª CI/CD æ¸ é“ã€‚NET æ ¸å¿ƒé¡¹ç›®ã€‚ä½œä¸ºæ„å»ºç®¡é“çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘æœ‰é€šå¸¸çš„æ„å»ºæ­¥éª¤æ¥æ„å»ºè§£å†³æ–¹æ¡ˆï¼Œè¿è¡Œå•å…ƒæµ‹è¯•ï¼Œè¿è¡Œé›†æˆæµ‹è¯•ï¼Œç„¶åéƒ¨ç½²åˆ° Octopusã€‚

### [](#team-city-dotnet-cli-plugin)å›¢é˜ŸåŸå¸‚ dotnet CLI æ’ä»¶

æ­£å¦‚æˆ‘ä¹‹å‰åœ¨ Team City ä¸Šçš„å¸–å­ä¸­æåˆ°çš„ï¼Œæˆ‘å·²ç»å°½å¯èƒ½åœ°é¿å…ä½¿ç”¨ Team City æ’ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨è„šæœ¬æˆ–å‘½ä»¤è¡Œã€‚ä¸ºäº†è¿è¡Œæˆ‘çš„æ–°é¡¹ç›®çš„æµ‹è¯•ï¼Œæˆ‘çš„é¦–é€‰æ˜¯åˆ©ç”¨ç°æˆçš„â€œdotnetâ€å‘½ä»¤ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ Team City dotnet æ’ä»¶ã€‚ä½†æ˜¯ï¼Œ **[dotnet test](https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-test?tabs=netcore21)** å‘½ä»¤é»˜è®¤ä¸å¸¦å¤šä¸ªé¡¹ç›®åˆ—è¡¨*ã€‚æ˜¾ç„¶æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ç”±äºç®€å•æ˜“ç”¨ï¼Œæˆ‘é€‰æ‹©äº† Team City æ’ä»¶ã€‚é…ç½®ç®€å•æ˜äº†ï¼Œæˆ‘åœ¨å‡ åˆ†é’Ÿå†…å°±å¯åŠ¨å¹¶è¿è¡Œäº†ã€‚*

[![](../Images/f2b75c64dc1d2244de2fcb6681068488.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--29C7DqsU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i0.wp.com/ankitvijay.net/wp-content/uploads/2019/03/image.png%3Ffit%3D810%252C261%26ssl%3D1) 

<figcaption>å›¢é˜ŸåŸå¸‚ dotnet CLI æ’ä»¶</figcaption>

### [](#issue)ä¸€æœŸ

æˆ‘ä»¬çš„ CI/CD æ¸ é“ä¼¼ä¹åƒé¢„æœŸçš„é‚£æ ·è¿ä½œï¼Œæ²¡æœ‰ä»»ä½•æˆå‰§æ€§äº‹ä»¶ã€‚ä¸€æ—¦å…¬å…±å…³ç³»åˆ†æ”¯æœºæ„è·å¾—æ‰¹å‡†ï¼Œä¸»åˆ†æ”¯æœºæ„çš„å»ºè®¾æ˜¯è§¦å‘å’ŒæˆåŠŸçš„å»ºè®¾ï¼Œè§£å†³æ–¹æ¡ˆå°†éƒ¨ç½²åˆ°å…«è¾¾é€šã€‚åœ¨ä¸€ä¸ªæ™´æœ—çš„æ—¥å­é‡Œï¼Œæˆ‘ä»¬çš„ QA æŠ¥å‘Šäº†ä¸€ä¸ª bugï¼Œè¿™ä¸ª bug æœ¬åº”è¯¥è¢«æˆ‘ä»¬çš„é›†æˆæµ‹è¯•å‘ç°ã€‚å½“æˆ‘æŸ¥çœ‹ Team City build æ—¶ï¼Œæˆ‘æ³¨æ„åˆ°å³ä½¿é›†æˆæµ‹è¯•å¤±è´¥ï¼Œæ„å»ºä¹Ÿæ˜¯æˆåŠŸçš„ã€‚è¿™åœ¨å¾ˆå¤šæ–¹é¢éƒ½å¾ˆå¥‡æ€ªï¼Œæˆ‘ä»”ç»†æ£€æŸ¥äº†æ„å»ºé…ç½®ï¼Œå¹¶éªŒè¯äº†å®ƒä»¬éƒ½è®¾ç½®æ­£ç¡®ã€‚æ‰€æœ‰æ„å»ºæ­¥éª¤çš„â€œæ‰§è¡Œæ­¥éª¤â€éƒ½è¢«è®¾ç½®ä¸ºâ€œå¦‚æœå‰é¢çš„æ‰€æœ‰æ­¥éª¤éƒ½æˆåŠŸå®Œæˆâ€ã€‚ä½†æ˜¯åœ¨*å¤±è´¥çš„*æ„å»ºæ­¥éª¤ä¹‹åçš„æ„å»ºæ­¥éª¤ä¼¼ä¹ä»åœ¨æ‰§è¡Œã€‚

### [](#root-cause)æ ¹æœ¬åŸå› 

è¿›ä¸€æ­¥æŒ–æ˜åï¼Œæˆ‘å‘ç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ Team City dotnet æ’ä»¶ä¸Šçš„è¿™ä¸ªé—®é¢˜ã€‚è¿˜æœ‰å…¶ä»–åƒæˆ‘ä¸€æ ·çŒä¸åŠé˜²çš„å¼€å‘è€…ã€‚æ ¹æ®æ’ä»¶è´¡çŒ®è€…ä¹‹ä¸€çš„è¯´æ³•:

> è¿™æ˜¯åŸå§‹è¡Œä¸ºã€‚å¯¹äºå¤§å¤šæ•°è¿è¡Œç¨‹åºï¼Œè¿›ç¨‹è¿”å›éé›¶é€€å‡ºä»£ç ï¼Œè¿™æ„å‘³ç€è¿è¡Œä¸æˆåŠŸã€‚å¯¹äºåƒ NUnitã€VSTestã€dotnet testã€msbuild /t:VSTestã€dotnet vstest è¿™æ ·çš„è¿è¡Œè€…æ¥è¯´ï¼Œæ­£é€€å‡ºä»£ç åªæ˜¯å¤§é‡å¤±è´¥çš„æµ‹è¯•ã€‚è¯¦è§æ­¤[èºçº¹](https://youtrack.jetbrains.com/issue/TW-49018)

ç„¶è€Œï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œè¿™ä¸ªè§£é‡Šä¸è¶³ä»¥ä¿®å¤æ’ä»¶ä¸­çš„é”™è¯¯è¡Œä¸º/é”™è¯¯ã€‚è¿™ç§è¡Œä¸ºå¹¶ä¸ç›´è§‚ï¼Œä¼šå¯¼è‡´åƒæˆ‘å’Œå…¶ä»–å¼€å‘äººå‘˜ä¸€æ ·çš„é—®é¢˜ã€‚

å¦‚æœä½ æƒ³è®© JetBrains ä¼˜å…ˆè€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥åœ¨è¿™é‡ŒæŠ•ç¥¨[ã€‚](https://youtrack.jetbrains.com/issue/TW-55626)

### [](#workaround)å·¥ä½œåŒº

é’ˆå¯¹æ­¤é—®é¢˜ï¼Œå»ºè®®çš„è§£å†³æ–¹æ³•ä¹‹ä¸€æ˜¯å°†æ¯ä¸ªæ„å»ºæ­¥éª¤çš„â€œæ‰§è¡Œæ­¥éª¤â€è®¾ç½®ä¸ºâ€œä»…å½“æ„å»ºçŠ¶æ€ä¸ºæˆåŠŸæ—¶â€ã€‚ä½†æ˜¯æˆ‘ä¸å–œæ¬¢è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒæ„å‘³ç€æˆ‘ä»¬ä¼šæ— ç¼˜æ— æ•…åœ°è„±ç¦»é»˜è®¤çš„,è€Œä¸”æˆ‘ä»¬éœ€è¦è®°ä½*,æ¯å½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ–°çš„æ„å»ºæ­¥éª¤æ—¶ï¼Œè¿˜è¦æ”¹å˜é»˜è®¤çš„*ã€‚

æˆ‘é€šè¿‡åœ¨æˆ‘çš„ Team City æ„å»ºé…ç½®ä¸­æ·»åŠ ä»¥ä¸‹â€œå¤±è´¥æ¡ä»¶â€,æˆåŠŸåœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

[![image](../Images/7c32e40310c6cd207e30ff3a9609dc32.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--YtkJB0cK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i1.wp.com/user-images.githubusercontent.com/5988564/53308876-44dab080-38f0-11e9-9575-1657d0d60757.png%3Fw%3D810%26ssl%3D1)

æ¯æ¬¡æµ‹è¯•æ„å»ºæ­¥éª¤å¤±è´¥æ—¶ï¼Œæ„å»ºæ—¥å¿—æ¶ˆæ¯éƒ½ä¼šåŒ…å«æ–‡æœ¬â€œæµ‹è¯•å¤±è´¥â€,è¿™å°±æ˜¯æ­¤å¤±è´¥æ¡ä»¶çš„ä½œç”¨ã€‚

å¸Œæœ›è¿™ä¸ªå»ºè®®èƒ½å¸®åŠ©ä½ é¿å…çŠ¯åŒæ ·çš„é”™è¯¯ï¼Œå¹¶èŠ‚çœå‡ ä¸ªå°æ—¶ã€‚ğŸ™‚

å¸–å­[å›¢é˜ŸåŸå¸‚-æµ‹è¯•å¤±è´¥ä½†å»ºé€ é€šè¿‡](https://ankitvijay.net/2019/03/25/team-city-failed-tests-but-build-pass/)é¦–å…ˆå‡ºç°åœ¨[å—¨ï¼Œæˆ‘æ˜¯ Ankit](https://ankitvijay.net) ã€‚