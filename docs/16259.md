# å…·æœ‰ Docker å’Œ Traefik çš„ Matrix å…ƒç´ (Riot) web

> åŸæ–‡:[https://dev.to/joenas/riot-web-for-matrix ä¸ç å¤´å·¥äººå’Œæ¬è¿å·¥ 50il](https://dev.to/joenas/riot-web-for-matrix--with-docker-and-traefik-50il)

[![Element web for Matrix with Docker and Traefik](../Images/15a112e5de8b4a586d77a593ab9506dd.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--VDtSQORW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://jonnev.se/content/images/2019/01/Screenshot-2019-01-12-at-19.08.52.png)

æ‰€ä»¥ [Element](https://element.io/) ~~Riot~~ æ˜¯æˆ‘æ›´å–œæ¬¢ä½¿ç”¨çš„ Matrix çš„â€œå…‰æ»‘â€ç½‘ç»œå®¢æˆ·ç«¯ï¼Œè‡³å°‘åœ¨ä¸ä½¿ç”¨æ¡Œé¢å®¢æˆ·ç«¯æ—¶æ˜¯è¿™æ ·ã€‚æˆ‘ä¹‹å‰ç»™[å†™è¿‡ä¸€ç¯‡å…³äºå¦‚ä½•å»ºç«‹ä½ è‡ªå·±çš„ä¸»æœåŠ¡å™¨çš„æŒ‡å—](https://dev.to/joenas/matrix-homeserver-with-docker-5dfn)ï¼Œç°åœ¨æˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘æ˜¯å¦‚ä½•éƒ¨ç½²æˆ‘çš„å…ƒç´ å®ä¾‹çš„ã€‚

## [](#prerequisites)å…ˆå†³æ¡ä»¶

ä¸€å¦‚æ—¢å¾€ï¼Œæœ¬æŒ‡å—å‡è®¾æ‚¨å¯¹ Linux æœ‰ä¸€å®šçš„äº†è§£ï¼Œå¹¶ä¸”æ‚¨æœ‰ä¸€å°å®‰è£…äº†è¿™äº›æœåŠ¡çš„æœåŠ¡å™¨:

*   [ç å¤´å·¥äºº](https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/)
*   [åç«™-å¤åˆ](https://docs.docker.com/compose/install/)
*   [Traefik](https://dev.to/joenas/traefik-with-docker-and-lets-encrypt-35if)
*   ä¸€ä¸ª**åŸŸ**æ¥æ‰˜ç®¡æ‚¨çš„å…ƒç´ *

âš ï¸åŸŸéœ€è¦**ä¸åŒäºä½ çš„ä¸»æœåŠ¡å™¨åŸŸ**ã€‚åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šã€‚ä½¿ç”¨å­åŸŸ*åº”è¯¥æ˜¯*å¥½çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ çš„ä¸»æœåŠ¡å™¨åœ¨`example.com`ä½ å¯ä»¥ä½¿ç”¨`element.example.com`ã€‚

å¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨ Traefikï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–åå‘ä»£ç†å°†æµé‡è½¬å‘åˆ° docker å®¹å™¨ã€‚ç¡®ä¿å°† SSL/TLS æ·»åŠ åˆ°ä»£ç†ä¸­ï¼Œä¾‹å¦‚è®©æˆ‘ä»¬åŠ å¯†ï¼

*å¦‚æœä½ æ­£åœ¨å»ºç«‹ä¸€ä¸ªæ–°çš„ VPSï¼Œè¯·éšæ„ä½¿ç”¨æˆ‘åœ¨æ•°å­—æµ·æ´‹çš„[æ¨èé“¾æ¥](https://m.do.co/c/37d221e6802a)ï¼Œä¸ºä½ çš„æœåŠ¡å™¨è·å¾— 10 ç¾å…ƒ*ğŸ˜Š

## [](#setup)è®¾ç½®

æˆ‘ä»¬å°†ä¸ºå…ƒç´ åˆ›å»ºä¸€ä¸ªç›®å½•å’Œä¸€äº›æ”¯æŒæ–‡ä»¶ã€‚

```
mkdir -p /opt/element 

# If you had to use sudo above, set the permissions to your user to make life easier
sudo chmod -R $USER:$USER -R /opt/element

mkdir /opt/element/config
mkdir /opt/element/versions
touch /opt/element/docker-compose.yml 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#dockercompose-with-traefik)ç å¤´å·¥-å †è‚¥ï¼Œå¸¦æœ‰ Traefik

å…ˆè¯´æˆ‘ä»¬çš„`docker-compose`ã€‚å‘ä¸‹æ»šåŠ¨ä¸€ç‚¹ï¼ŒæŸ¥çœ‹ä¸ä½¿ç”¨ Traefik çš„ç¤ºä¾‹ã€‚

```
nano /opt/element/docker-compose.yml

version: '2'

services:
  web:
    image: nginx:1.12-alpine
    container_name: element
    restart: unless-stopped
    networks:
      - web
    labels:
      - "traefik.enable=true"
      - "traefik.frontend.rule=Host:element.example.com"
      - "traefik.port=80"
      - "traefik.docker.network=web"
    volumes:
      - ./element-web:/usr/share/nginx/html/
      - ./config/config.json:/usr/share/nginx/html/config.json

networks:
  web:
    external: true 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

â˜ï¸ **è®°ä½ç”¨**æ›¿æ¢`traefik.frontend.rule`ä¸­çš„`element.example.com`ï¼Œå¦‚æœéœ€è¦å¯ä»¥æ›´æ”¹å¤–éƒ¨`network`çš„åç§°ã€‚

### [](#no-traefik)No Traefik

å¦‚æœä½¿ç”¨å¦ä¸€ä¸ªåå‘ä»£ç†ï¼Œè¯·ä½¿ç”¨æˆ–ä¿®æ”¹æ­¤é€‰é¡¹ã€‚

```
version: '2'

services:
  web:
    image: nginx:1.12-alpine
    container_name: element
    restart: unless-stopped
    ports:
      - "127.0.0.1:8080:80"
    volumes:
      - ./element-web:/usr/share/nginx/html/
      - ./config/config.json:/usr/share/nginx/html/config.json 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#fetch-latest-element-version)å–æœ€æ–°çš„å…ƒç´ ç‰ˆæœ¬

ç°åœ¨æˆ‘ä»¬è·å–æœ€æ–°å…ƒç´ å‘å¸ƒçš„ tarballï¼Œæå–å®ƒå¹¶æŠŠå®ƒæ”¾åœ¨`versions`æ–‡ä»¶å¤¹ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºç¬¦å·é“¾æ¥ï¼Œä»¥ä¾¿èƒ½å¤Ÿä»¥ä¸€ç§ç®€å•çš„æ–¹å¼æ›´æ–°ç‰ˆæœ¬ã€‚

```
wget -qO- https://github.com/vector-im/element-web/releases/download/v0.17.8/riot-v0.17.8.tar.gz | tar xvz -C /opt/element/versions
ln -s /opt/element/versions/riot-v0.17.8 /opt/element/element-web 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

â˜ï¸:è¯·åŠ¡å¿…æŸ¥çœ‹[ç‰ˆæœ¬](https://github.com/vector-im/element-web/releases)é¡µé¢ï¼Œå¦‚æœæœ‰æ›´æ–°çš„ç‰ˆæœ¬ï¼Œè¯·ç›¸åº”åœ°æ›´æ–°ä¸Šé¢çš„å‘½ä»¤ï¼

## [](#config)é…ç½®

å¤åˆ¶[æ ·æœ¬é…ç½®](https://github.com/vector-im/element-web/blob/master/config.sample.json)å¹¶æ ¹æ®æ‚¨çš„éœ€è¦è¿›è¡Œç¼–è¾‘ã€‚

```
cp element-web/riot-v0.17.8/config.sample.json /opt/element/config/config.json
nano /opt/element/config/config.json 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

æˆ‘åªæ”¹å˜äº†è¿™äº›å€¼:

```
{
    "default_hs_url": "https://matrix.example.com",
    "brand": "Custom Brand",
    "roomDirectory": {
        "servers": [
            "matrix.example.com",
            "matrix.org"
        ]
    }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

## [](#run-it)è·‘å§ï¼

æˆ‘ä»¬å‡†å¤‡å¥½äº†ã€‚è¿è¡Œ`docker-compose up -d`ï¼Œä½ åº”è¯¥èƒ½å¤Ÿè®¿é—®ä½ çš„åŸŸåå¹¶ç™»å½•ğŸ˜ƒ

## [](#updating)æ›´æ–°

è¦æ›´æ–°åˆ°æ–°å…ƒç´ ç‰ˆæœ¬ï¼Œè¯·æ£€æŸ¥â€œå‘å¸ƒâ€é¡µé¢ï¼Œé€šè¿‡ä¿®æ”¹è¿™äº›å‘½ä»¤è·å–æ–°ç‰ˆæœ¬ã€‚ç„¶åé“¾æ¥æ–°ç‰ˆæœ¬ï¼Œåœæ­¢å¹¶å†æ¬¡å¯åŠ¨æ‚¨çš„å®¹å™¨ã€‚

```
wget -qO- https://github.com/vector-im/element-web/releases/download/v0.17.8/VERSION.tar.gz | tar xvz -C /opt/element/versions
docker-compose stop
rm element-web
ln -s /opt/element/versions/VERSION /opt/element/element-web
docker-compose up -d 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>