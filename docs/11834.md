# JavaScript ä¸­çš„çŠ¶æ€ç®¡ç†æ¨¡å¼:è·¨ç»„ä»¶å…±äº«æ•°æ®

> åŸæ–‡:[https://dev . to/bnevilleoneill/state-management-pattern-in-JavaScript-sharing-data-cross-components-2g kj](https://dev.to/bnevilleoneill/state-management-pattern-in-javascript-sharing-data-across-components-2gkj)

### JavaScript ä¸­çš„çŠ¶æ€ç®¡ç†æ¨¡å¼:è·¨ç»„ä»¶å…±äº«æ•°æ®

[![](../Images/d369106ac0277a38eb02f291caffa2ea.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--iXI5l3DW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/668/1%2Ahcws3Wa6u9IqaEZ_4X04uw.jpeg)

å½“æˆ‘ä»¬è°ˆè®ºçŠ¶æ€ç®¡ç†æ—¶ï¼Œæˆ‘ä»¬çœŸæ­£åœ¨è°ˆè®ºçš„æ˜¯ï¼Œæˆ‘ä»¬å¦‚ä½•è·¨ JavaScript åº”ç”¨ç¨‹åºçš„ç»„ä»¶ç®¡ç†æ•°æ®ï¼Ÿ

æ„å»ºè®¸å¤šåº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå…¸å‹æŒ‘æˆ˜æ˜¯ä¿æŒç”¨æˆ·ç•Œé¢çš„ä¸åŒéƒ¨åˆ†åŒæ­¥ã€‚é€šå¸¸ï¼ŒçŠ¶æ€çš„å˜åŒ–éœ€è¦åæ˜ åœ¨å¤šä¸ªç»„ä»¶ä¸­ï¼Œéšç€åº”ç”¨ç¨‹åºçš„å¢é•¿ï¼Œè¿™ç§å¤æ‚æ€§åªä¼šå¢åŠ ã€‚

ä¸€ä¸ªå¸¸è§çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨äº‹ä»¶è®©åº”ç”¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†çŸ¥é“ä»€ä¹ˆæ—¶å€™å‘ç”Ÿäº†å˜åŒ–ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯å°†çŠ¶æ€ä¿å­˜åœ¨ DOM æœ¬èº«ä¸­ï¼Œæˆ–è€…ç”šè‡³å°†å®ƒåˆ†é…ç»™çª—å£ä¸­çš„ä¸€ä¸ªå…¨å±€å¯¹è±¡ã€‚ç°åœ¨æˆ‘ä»¬æœ‰å‡ ä¸ªåº“ï¼Œæ¯”å¦‚ Vuexã€Redux å’Œ NgRxï¼Œæ¥å¸®åŠ©ç®€åŒ–è·¨ç»„ä»¶çš„çŠ¶æ€ç®¡ç†ã€‚ä»–ä»¬é€šå¸¸ä½¿ç”¨æ‰€è°“çš„**å­˜å‚¨æ¨¡å¼**,æ‰€æœ‰æ”¹å˜å­˜å‚¨çŠ¶æ€çš„åŠ¨ä½œéƒ½æ”¾åœ¨ä¸€ä¸ªå­˜å‚¨ç±»ä¸­ã€‚è¿™ç§ç±»å‹çš„é›†ä¸­å¼çŠ¶æ€ç®¡ç†ä½¿å¾—ç†è§£ä»€ä¹ˆç±»å‹çš„çªå˜å¯èƒ½å‘ç”Ÿä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•è¢«è§¦å‘çš„å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

[![](../Images/2063f22e152ef36aa267c13ae9842601.png)T2ã€‘](https://logrocket.com/signup/)

### [](#what-we-will-build)æˆ‘ä»¬å°†å»ºé€ ä»€ä¹ˆ

ä»»ä½•çŠ¶æ€ç®¡ç†å·¥å…·åªéœ€è¦å‡ æ ·ä¸œè¥¿:å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºå¯ç”¨çš„å…¨å±€çŠ¶æ€å€¼ï¼Œä»¥åŠè¯»å–å’Œæ›´æ–°å®ƒçš„èƒ½åŠ›ã€‚å¤§æ„å¦‚ä¸‹:

```
const state = {};

export const getState = () => state;

export const setState = nextState => {
  state = nextState;
}; 
```

è¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºæœ¬çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†ä¸€ä¸ªè¡¨ç¤ºåº”ç”¨ç¨‹åºçŠ¶æ€çš„å…¨å±€å¯ç”¨å€¼:stateï¼Œä¸€ä¸ªè¯»å– state: getState çš„æ–¹æ³•å’Œä¸€ä¸ªæ›´æ–° state: setState çš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªæ€»ä½“æ€è·¯æ¥æ„å»ºä¸€ä¸ªæ²¡æœ‰ JavaScript æ¡†æ¶æˆ–ä¾èµ–çš„å¾…åŠäº‹é¡¹åˆ—è¡¨åº”ç”¨ç¨‹åºã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å¤§è‡´äº†è§£è¿™äº›å·ç«‹å›¾ä¹¦é¦†æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚è¯¥åº”ç”¨ç¨‹åºå°†å¦‚ä¸‹æ‰€ç¤º:

[![](../Images/e5dcc7f64f5a031ebc31e74e7b4d5e25.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--DxoNz4-C--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AB6l9Tm0jYf5XoGvpjfTNZw.png)

é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®‰è£… [http-server](https://www.npmjs.com/package/http-server) ï¼Œå®ƒå°†åœ¨æˆ‘ä»¬å®Œæˆåä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæä¾›æœåŠ¡ã€‚è¦å®‰è£…è¿™ä¸ªï¼Œé¦–å…ˆç¡®ä¿ä½ çš„æœºå™¨ä¸Šå®‰è£…äº† [Nodes.js](http://nodejs.org) å’Œ [Nodes.js](http://nodejs.org) åŒ…ç®¡ç†å™¨(NPM)ã€‚åœ¨ Windows æ“ä½œç³»ç»Ÿä¸Šï¼Œå®‰è£…è¿™äº›ç¨‹åºçš„æ­¥éª¤å¦‚ä¸‹:

1.  ä» [Nodes.js](http://nodejs.org) ç½‘ç«™ä¸‹è½½ Windows å®‰è£…ç¨‹åº
2.  è¿è¡Œæ‚¨åˆšåˆšä¸‹è½½çš„å®‰è£…ç¨‹åº
3.  æŒ‰ç…§æç¤ºæ“ä½œï¼Œæ¥å—é»˜è®¤å®‰è£…è®¾ç½®
4.  é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¿è¡Œ node-v æ¥æµ‹è¯•å®ƒã€‚è¿™åº”è¯¥ä¼šæ‰“å°å‡ºä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ‰€ä»¥æ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼äº v8.12.0 çš„å†…å®¹ã€‚å¦å¤–ï¼Œè¿è¡Œ npm -v æ¥æŸ¥çœ‹ npm æ˜¯å¦å®‰è£…æˆåŠŸã€‚è¿™åº”è¯¥ä¼šæ‰“å°å‡º NPM çš„ç‰ˆæœ¬å·ï¼Œæ‰€ä»¥æ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼äº 6.4.1 çš„å†…å®¹ã€‚
5.  è¿è¡Œå‘½ä»¤ npm install http-server -g åœ¨æ‚¨çš„æœºå™¨ä¸Šå…¨å±€å®‰è£… [http-server](https://www.npmjs.com/package/http-server) ã€‚å®‰è£…ä¹‹åï¼Œæ‚¨ç°åœ¨å¯ä»¥é€šè¿‡åœ¨ç´¢å¼•æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸­è¿è¡Œ http-server æ¥ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›æœåŠ¡

ç°åœ¨å›åˆ°æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œåˆ›å»ºä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„æ–‡ä»¶å¤¹ç»“æ„:

```
/state-management-JS   â”œâ”€â”€src      â”œâ”€â”€ css         â”œâ”€â”€ global.css      â”œâ”€â”€ js         â”œâ”€â”€ main.js      index.html 
```

åœ¨ global.css æ–‡ä»¶ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹:

```
h1 {
    margin-bottom: 15px;
    width: 100%;
    font-size: 100px;
    font-weight: 100;
    text-align: center;
    color: rgba(175, 47, 47, 0.15);
    -webkit-text-rendering: optimizeLegibility;
    -moz-text-rendering: optimizeLegibility;
    text-rendering: optimizeLegibility;
}
@media all and (min-width: 40em) {
    main {
        width: 80vw;
        max-width: 40em;
        margin: 0 auto
    }
}
/**
* Intro 
*/
.intro {
    padding: 0 0 1rem 0;
    margin: 0 0 2rem 0;
    border-bottom: 1px dotted var(--border);
}
.intro__heading {
    font-weight: 400;
}
.intro__summary {
    margin-top: 0.3rem;
    font-size: 1.3rem;
    font-weight: 300;
}
.intro__summary b {
    font-weight: 500;
}
/**
* App 
*/
.app {
    display: grid;
    grid-template-columns: 1fr;
    grid-auto-flow: row;
    grid-gap: 2rem;
}
.app__decor {
    display: block;
    width: 100%;
    text-align: center;
    font-size: 3rem;
    line-height: 1;
}
.app__decor small {
    display: block;
    font-size: 1.3rem;
    font-weight: 400;
    color: var(--text-secondary);
}
.app__decor > * {
    display: block;
}
.app__decor > * + * {
    margin-top: 0.4rem;
}
.app__items {
    list-style: none;
    padding: 0;
    margin: 1rem 0 0 0;
    font-weight: 300;
}
.app__items li {
    position: relative;
    padding: 0 0 0 2rem;
    font-size: 1.3rem;
}
.app__items li::before {
    content: "ğŸ•›";
    position: absolute;
    top: 1px;
    left: 0;
}
.app__items li + li {
    margin-top: 0.5rem;
}
.app__items button {
    background: transparent;
    border: none;
    position: relative;
    top: -1px;
    color: var(--danger);
    font-weight: 500;
    font-size: 1rem;
    margin: 0 0 0 5px;
    cursor: pointer;
}
.app__items button:hover {
    color: var(--danger--dark);
}
@media all and (min-width: 40rem) {
    .app {
        grid-template-columns: 2fr 1fr;
    }
}

/**
* New item
*/
.new-item {
    margin: 2rem 0 0 0;
    padding: 1rem 0 0 0;
    border-top: 1px dotted var(--border);
}

/**
* No items
*/
.no-items {
    margin: 1rem 0 0 0;
    color: var(--text-secondary);
}
/**
* Visually hidden
*/
.visually-hidden { 
    display: block;
    height: 1px;
    width: 1px;
    overflow: hidden;
    clip: rect(1px 1px 1px 1px);
    clip: rect(1px, 1px, 1px, 1px);
    clip-path: inset(1px);
    white-space: nowrap;
    position: absolute;
}
.new-todo {
    padding: 16px 16px 16px 60px;
    border: none;
    background: rgba(0, 0, 0, 0.003);
    box-shadow: inset 0 -2px 1px rgba(0,0,0,0.03);
    position: relative;
    width: 100%;
    font-size: 24px;
    font-family: inherit;
    font-weight: inherit;
    line-height: 1.4em;
}
.save-button {
    display: inline-block;
    border: 0;
    padding: 0;
    margin: 0;
    text-decoration: none;
    background: #666;
    color: #fff;
    padding: 11px 25px 10px 25px;
    font-family: sans-serif;
    font-size: 1rem;
    border-radius: 2px;
    cursor: pointer;
    text-align: center;
    -webkit-appearance: none;
    margin-top: 15px;
} 
```

è¿™æ˜¯æˆ‘ä»¬å°†åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„æ ·å¼è¡¨ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨æœ¬æ•™ç¨‹ä¸­è®¨è®ºæ ·å¼ï¼Œå› ä¸ºå¯¹åº”ç”¨ç¨‹åºåº”ç”¨æ ·å¼æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ã€‚

### [](#the-observer-pattern)è§‚å¯Ÿè€…æ¨¡å¼

æˆ‘ä»¬å°†åˆ©ç”¨è§‚å¯Ÿè€…æ¶æ„è®¾è®¡æ¨¡å¼ï¼Œå®ƒæ˜¯è¯­è¨€ä¸å¯çŸ¥çš„ã€‚è§‚å¯Ÿè€…æ¨¡å¼æä¾›äº†ä¸€ä¸ªè®¢é˜…æ¨¡å‹ï¼Œåœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œå¯¹è±¡è®¢é˜…ä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶åœ¨äº‹ä»¶å‘ç”Ÿæ—¶å¾—åˆ°é€šçŸ¥ã€‚è¿™ç§æ¨¡å¼æ˜¯äº‹ä»¶é©±åŠ¨ç¼–ç¨‹çš„åŸºçŸ³ï¼ŒåŒ…æ‹¬ JavaScriptã€‚è§‚å¯Ÿè€…æ¨¡å¼æœ‰åŠ©äºè‰¯å¥½çš„é¢å‘å¯¹è±¡è®¾è®¡ï¼Œå¹¶ä¿ƒè¿›æ¾æ•£è€¦åˆã€‚

[![](../Images/92346399641fb44b9396ea81de94e6b9.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--XVUvJst1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/258/1%2AjAzlEy_JIYvhYRrrD-DcqA.jpeg) 

<figcaption>è§‚å¯Ÿè€…æ¨¡å¼çš„å†ç°</figcaption>

**è§‚å¯Ÿè€…**ä¹Ÿè¢«ç§°ä¸º**è®¢é˜…è€…**ï¼Œæˆ‘ä»¬æŠŠè¢«è§‚å¯Ÿçš„å¯¹è±¡ç§°ä¸ºå‘å¸ƒè€…(æˆ–ä¸»ä½“)ã€‚**å‘å¸ƒè€…**åœ¨äº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥è®¢é˜…è€…ã€‚

å½“å¯¹è±¡ä¸å†å¯¹ç”±ä»–ä»¬æ³¨å†Œçš„ä¸»é¢˜é€šçŸ¥æ„Ÿå…´è¶£æ—¶ï¼Œä»–ä»¬å¯ä»¥è‡ªå·±å–æ¶ˆè®¢é˜…ã€‚ç„¶åï¼Œä¸»é¢˜å°†ä¾æ¬¡å°†å®ƒä»¬ä»è§‚å¯Ÿè€…é›†åˆä¸­ç§»é™¤ã€‚

æ‰“å¼€ src\js ç›®å½•ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªåä¸º lib çš„æ–°æ–‡ä»¶å¤¹ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º pubsub.js çš„æ–°æ–‡ä»¶

```
/js   â”œâ”€â”€ lib      â”œâ”€â”€ pubsub.js 
```

åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å…è®¸åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†è®¢é˜…å’Œå‘å¸ƒå‘½åäº‹ä»¶çš„åŠŸèƒ½ã€‚

å°†ä»¥ä¸‹ä»£ç è¾“å…¥åˆ° pubsub.js

```
export default class PubSub {
    constructor() {
        this.events = {};
    }
    subscribe(event, callback) {
        if (!this.events.hasOwnProperty(event)) {
            this.events[event] = [];
        }
        return this.events[event].push(callback);
    }
    publish(event, data = {}) {
        if (!this.events.hasOwnProperty(event)) {
            return [];
        }
        return this.events[event].map(callback => callback(data));
    }
} 
```

åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°† this.events å®ä¾‹åŒ–ä¸ºä¸€ä¸ªç©ºå¯¹è±¡æ¥ä¿å­˜æˆ‘ä»¬çš„äº‹ä»¶ã€‚

subscribe æ–¹æ³•æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²äº‹ä»¶ï¼Œå®ƒæ˜¯äº‹ä»¶çš„å”¯ä¸€åç§°å’Œä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚ç„¶åï¼Œå®ƒæ£€æŸ¥ this.events çš„å±æ€§ä¸­æ˜¯å¦æœ‰åŒ¹é…çš„äº‹ä»¶â€”â€”å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥äº‹ä»¶ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„å½¢å¼çš„äº‹ä»¶å±æ€§ã€‚å¦åˆ™ï¼Œå®ƒä¼šå°†ä¼ é€’çš„å›è°ƒæ–¹æ³•æ¨å…¥ this.events[event]ã€‚

publish æ–¹æ³•æ£€æŸ¥ this.events çš„å±æ€§ä¸­æ˜¯å¦æœ‰åŒ¹é…çš„äº‹ä»¶â€”â€”å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥äº‹ä»¶ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ã€‚å¦åˆ™ï¼Œå®ƒå°†ä½¿ç”¨æ•°æ®å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œéå†æ¯ä¸ªå­˜å‚¨çš„å›è°ƒã€‚

### [](#the-store)å•†åº—

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸­å¤®å¯¹è±¡ï¼Œå®ƒå°†åŒ…å«ä¸€ä¸ª state å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åˆåŒ…å«æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚æˆ‘ä»¬è¿˜å°†åˆ›å»ºä¸€ä¸ª dispatch æ–¹æ³•ï¼Œå½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªæ–°çš„å¾…åŠäº‹é¡¹æ—¶å°†è°ƒç”¨è¯¥æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•è°ƒç”¨æˆ‘ä»¬çš„åŠ¨ä½œï¼ŒåŠ¨ä½œåˆè°ƒç”¨æˆ‘ä»¬çš„çªå˜ï¼Œæœ€ç»ˆæ”¹å˜çŠ¶æ€ã€‚

åœ¨ js æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º store çš„æ–°æ–‡ä»¶å¤¹ã€‚åœ¨é‚£é‡Œï¼Œåˆ›å»ºä¸€ä¸ªåä¸º store.js çš„æ–°æ–‡ä»¶ï¼Œè¿™æ ·æ‚¨çš„æ–‡ä»¶å¤¹ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

```
/js   â”œâ”€â”€ lib      â”œâ”€â”€ pubsub.js   â”œâ”€â”€ store      â”œâ”€â”€ store.js 
```

ç„¶åå°†ä»¥ä¸‹å†…å®¹è¾“å…¥ store.js

```
import PubSub from '../lib/pubsub.js';

export default class Store {
    constructor(params) {
        let self = this;
        self.actions = {};
        self.mutations = {};
        self.state = {};
        self.status = 'default state';
        self.events = new PubSub();
        if (params.hasOwnProperty('actions')) {
            self.actions = params.actions;
        }
        if (params.hasOwnProperty('mutations')) {
            self.mutations = params.mutations;
        }
        self.state = new Proxy((params.state || {}), {
            set: function (state, key, value) {
                state[key] = value;
                console.log(`stateChange: ${key}: ${value}`);
                self.events.publish('stateChange', self.state);
                if (self.status !== 'mutation') {
                    console.warn(`You should use a mutation to set ${key}`);
                }
                self.status = 'resting';
                return true;
            }
        });
    }
    dispatch(actionKey, payload) {
        let self = this;
        if (typeof self.actions[actionKey] !== 'function') {
            console.error(`Action "${actionKey} doesn't exist.`);
            return false;
        }
        console.groupCollapsed(`ACTION: ${actionKey}`);
        self.status = 'action';
        self.actions[actionKey](self, payload);
        console.groupEnd();
        return true;
    }
    commit(mutationKey, payload) {
        let self = this;
        if (typeof self.mutations[mutationKey] !== 'function') {
            console.log(`Mutation "${mutationKey}" doesn't exist`);
            return false;
        }
        self.status = 'mutation';
        let newState = self.mutations[mutationKey](self.state, payload);
        self.state = Object.assign(self.state, newState);
        return true;
    }   
} 
```

è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ®µä»£ç åœ¨åšä»€ä¹ˆã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥ pubsub.js æ–‡ä»¶ã€‚ç„¶åæˆ‘ä»¬å£°æ˜ä¸€ä¸ªæ¥å—å‚æ•°çš„æ„é€ å‡½æ•°ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºçŠ¶æ€ã€åŠ¨ä½œå’Œçªå˜å®ä¾‹åŒ–ä¸€ä¸ªé»˜è®¤çš„ç©ºå¯¹è±¡ã€‚æˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ªçŠ¶æ€å±æ€§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥ç¡®å®šå¯¹è±¡åœ¨ä»»ä½•ç»™å®šæ—¶é—´æ­£åœ¨åšä»€ä¹ˆã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ PubSub å®ä¾‹ï¼Œå¹¶å°†å…¶åˆ†é…ç»™å±æ€§ eventsã€‚ç„¶åï¼Œæˆ‘ä»¬æ£€æŸ¥ä¼ å…¥æ„é€ å‡½æ•°çš„å‚æ•°æ˜¯å¦å°†å±æ€§ actions å’Œ mutations ä½œä¸ºè‡ªå·±çš„å±æ€§ã€‚å¦‚æœä»»ä¸€æ¡ä»¶ä¸ºçœŸï¼Œæˆ‘ä»¬å°†æ“ä½œå’Œçªå˜å¯¹è±¡è®¾ç½®ä¸ºä¼ å…¥å‚æ•°çš„ç›¸åº”å‚æ•°ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ ES6 çš„æ–°ç‰¹æ€§ï¼Œ**ä»£ç†**åˆ°*è§‚å¯Ÿ*çŠ¶æ€å¯¹è±¡ã€‚å¦‚æœæˆ‘ä»¬æ·»åŠ ä¸€ä¸ª get é™·é˜±ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘è§†æ¯æ¬¡å¯¹è±¡è¢«è¯·æ±‚æ•°æ®çš„æ—¶å€™ã€‚ç±»ä¼¼åœ°ï¼Œé€šè¿‡è®¾ç½®é™·é˜±ï¼Œæˆ‘ä»¬å¯ä»¥ç•™æ„å¯¹å¯¹è±¡æ‰€åšçš„æ›´æ”¹ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®æ›´æ”¹ï¼Œç„¶åå°†å…¶è®°å½•åˆ°æ§åˆ¶å°ã€‚ç„¶åæˆ‘ä»¬ç”¨ PubSub æ¨¡å—å‘å¸ƒä¸€ä¸ª stateChange äº‹ä»¶ã€‚ç„¶åæˆ‘ä»¬æ£€æŸ¥çŠ¶æ€æ˜¯å¦ä¸æ˜¯çªå˜ï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸­è®°å½•ä¸€ä¸ªè­¦å‘Šã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª dispatch æ–¹æ³•ï¼Œå®ƒå¯»æ‰¾ä¸€ä¸ªåŠ¨ä½œï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œè®¾ç½®ä¸€ä¸ªçŠ¶æ€å¹¶åœ¨åˆ›å»ºç™»å½•æ§åˆ¶å°æ—¶è°ƒç”¨è¿™ä¸ªåŠ¨ä½œã€‚ç„¶åï¼Œè¯¥æ“ä½œå°†é€šè¿‡è°ƒç”¨ commit æ–¹æ³•æ¥æ”¹å˜æˆ‘ä»¬çš„æ›´æ”¹ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸ªçªå˜æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œæˆ‘ä»¬è¿è¡Œå®ƒå¹¶ä»å®ƒçš„è¿”å›å€¼ä¸­è·å¾—æˆ‘ä»¬çš„æ–°çŠ¶æ€ã€‚ç„¶åï¼Œæˆ‘ä»¬è·å–æ–°çš„çŠ¶æ€ï¼Œå¹¶å°†å…¶ä¸ç°æœ‰çš„çŠ¶æ€åˆå¹¶ï¼Œä»¥åˆ›å»ºçŠ¶æ€çš„æœ€æ–°ç‰ˆæœ¬ã€‚

### [](#actions-and-mutations)åŠ¨ä½œå’Œçªå˜

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„åŠ¨ä½œå’Œçªå˜æ–‡ä»¶ã€‚åœ¨ store æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º actions.js çš„æ–°æ–‡ä»¶ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
export default {
    addItem(context, payload) {
        context.commit('addItem', payload);
    },
    clearItem(context, payload) {
        context.commit('clearItem', payload);
    }
}; 
```

ä¸Šä¸‹æ–‡æ˜¯ Store ç±»çš„å®ä¾‹ï¼Œæœ‰æ•ˆè´Ÿè½½æ˜¯ç”± Store ç±»ä¸­çš„ dispatch æ–¹æ³•ä¼ å…¥çš„å®é™…æ•°æ®æ›´æ”¹ã€‚åŠ¨ä½œ addItem å’Œ clearItem å°†æœ‰æ•ˆè´Ÿè½½ä¼ é€’ç»™ä¸€ä¸ªçªå˜ commit æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åè¿‡æ¥æäº¤è¦å­˜å‚¨çš„æ•°æ®ã€‚è®©æˆ‘ä»¬ç°åœ¨åˆ›é€ æˆ‘ä»¬çš„çªå˜ã€‚åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œä»ç„¶åœ¨å­˜å‚¨æ–‡ä»¶å¤¹ä¸­ï¼Œåä¸º mutations.js:

```
export default {
    addItem(state, payload) {
        state.items.push(payload);
        return state;
    },
    clearItem(state, payload) {
        state.items.splice(payload.index, 1);
        return state;
    }
}; 
```

å¦‚å‰æ‰€è¿°ï¼Œè¿™ä¸ªå˜å¼‚æ˜¯ç”± action.js æ–‡ä»¶ä¸­çš„ commit æ–¹æ³•è°ƒç”¨çš„ã€‚è¿™é‡Œï¼ŒaddItem æ¥å—æˆ‘ä»¬çš„å½“å‰çŠ¶æ€å’Œä¸€ä¸ªæœ‰æ•ˆè´Ÿè½½ä½œä¸ºå‚æ•°ï¼Œç„¶åå°†æœ‰æ•ˆè´Ÿè½½æ¨å…¥ state å¯¹è±¡çš„ items å±æ€§ã€‚ç¬¬äºŒä¸ªæ–¹æ³• clearItem ç§»é™¤ä»çŠ¶æ€å¯¹è±¡ä¼ å…¥çš„æœ‰æ•ˆè´Ÿè½½ã€‚

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¿å­˜é»˜è®¤é¡¹ç›®é›†çš„æ–‡ä»¶ï¼Œè¿™æ ·åœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±æœ‰ä¸œè¥¿å¯ä»¥æ˜¾ç¤ºäº†ã€‚åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ state.js å¹¶è¾“å…¥ä»¥ä¸‹å†…å®¹:

```
export default {  
    items: [
        'An example task. Delete or add your own',
        'Another example task. Delete or add your own'
    ]
}; 
```

åœ¨åŒä¸€ä¸ªç›®å½•ä¸­åˆ›å»ºå¦ä¸€ä¸ªåä¸º index.js çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­å¯¼å…¥æˆ‘ä»¬çš„æ“ä½œã€çªå˜ã€çŠ¶æ€å’Œå­˜å‚¨ã€‚åœ¨è¯¥æ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹:

```
import actions from './actions.js';
import mutations from './mutations.js';
import state from './state.js';
import Store from './store.js';

export default new Store({
  actions,
  mutations,
  state
}); 
```

### [](#components)ç»„ä»¶

æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåªæœ‰ä¸‰ä¸ªåŠŸèƒ½:æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨ã€æ·»åŠ ä»»åŠ¡å’Œæ˜¾ç¤ºä»»åŠ¡è®¡æ•°ã€‚æˆ‘ä»¬å°†æŠŠè¿™äº›åŠŸèƒ½åˆ†æˆä¸‰ä¸ªç»„ä»¶æ–‡ä»¶ï¼Œä½†é¦–å…ˆæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŸºæœ¬ç»„ä»¶ã€‚åœ¨ lib æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º component.js çš„æ–‡ä»¶ã€‚æ‰€ä»¥ä½ çš„ lib æ–‡ä»¶å¤¹ç»“æ„çœ‹èµ·æ¥åƒè¿™æ ·:

```
â”œâ”€â”€ lib   â”œâ”€â”€ pubsub.js   â”œâ”€â”€ component.js 
```

åœ¨ component.js æ–‡ä»¶ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹:

```
import Store from '../store/store.js';
export default class Component {
    constructor(props = {}) {
        this.render = this.render || function () { };
        if (props.store instanceof Store) {
            props.store.events.subscribe('stateChange', () => this.render());
        }
        if (props.hasOwnProperty('element')) {
            this.element = props.element;
        }
    }
} 
```

è¿™é‡Œæˆ‘ä»¬å¯¼å…¥äº† Store ç±»ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥æ£€æŸ¥æ„é€ å‡½æ•°ä¸­çš„ä¸€ä¸ªå±æ€§ã€‚åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è¦çœ‹çœ‹æ˜¯å¦æœ‰ä¸€ä¸ª render æ–¹æ³•ã€‚å¦‚æœè¿™ä¸ªç»„ä»¶ç±»æ˜¯å¦ä¸€ä¸ªç±»çš„çˆ¶ç±»ï¼Œé‚£ä¹ˆå­ç±»å¯èƒ½å·²ç»ä¸º render è®¾ç½®äº†è‡ªå·±çš„æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æ–¹æ³•é›†ï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªç©ºæ–¹æ³•æ¥é˜²æ­¢ä¸œè¥¿è¢«ç ´åã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¼ å…¥çš„å¯¹è±¡æ˜¯å¦æœ‰ä¸€ä¸ªå±æ€§ï¼Œè¯¥å±æ€§æ˜¯æˆ‘ä»¬å¯¼å…¥çš„ Store ç±»çš„å®ä¾‹ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†æ”¾å¿ƒåœ°ä½¿ç”¨å®ƒçš„æ–¹æ³•å’Œå±æ€§ã€‚ç„¶åæˆ‘ä»¬è°ƒç”¨ subscribe æ–¹æ³•ï¼Œä¼ å…¥æˆ‘ä»¬è®¢é˜…çš„äº‹ä»¶çš„åç§°â€”â€”å…¨å±€ stateChange äº‹ä»¶å’Œå›è°ƒ renderã€‚æœ€åï¼Œæˆ‘ä»¬ä»å­ç»„ä»¶ä¸­è·å¾—ä¸€ä¸ªå…ƒç´ å±æ€§

ç°åœ¨æˆ‘ä»¬æœ‰äº†çˆ¶ç»„ä»¶ï¼Œè®©æˆ‘ä»¬åˆ›å»ºå­ç»„ä»¶ã€‚é¦–å…ˆï¼Œåœ¨ js æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º components çš„æ–°æ–‡ä»¶å¤¹ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º list.js çš„æ–‡ä»¶

```
/js   â”œâ”€â”€ lib   â”œâ”€â”€ components      â”œâ”€â”€ list.js 
```

åœ¨ list.js æ–‡ä»¶ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹:

```
import Component from '../lib/component.js';
import store from '../store/index.js';
export default class List extends Component {
    constructor() {
        super({
            store,
            element: document.querySelector('.js-items')
        });
    }
    render() {

        if (store.state.items.length === 0) {
            this.element.innerHTML = `<p class="no-items">You have no tasks yet </p>`;
            return;
        }
        this.element.innerHTML = `
      <ul class="app__items"> ${store.state.items.map(item => {
            return `
            <li>${item}<button aria-label="Delete this item">Ã—</button></li>
          `
        }).join('')} </ul>
    `;
        this.element.querySelectorAll('button').forEach((button, index) => {
            button.addEventListener('click', () => {
                store.dispatch('clearItem', { index });
            });
        });
    }
}; 
```

åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ super å…³é”®å­—æ¥è®¿é—®å’Œè°ƒç”¨çˆ¶ç»„ä»¶(å³ components.js æ–‡ä»¶)ä¸Šçš„å‡½æ•°ã€‚æˆ‘ä»¬é¦–å…ˆå°† Store å®ä¾‹ä¼ é€’ç»™æˆ‘ä»¬æ­£åœ¨æ‰©å±•çš„çˆ¶ç±»ã€‚

ä¹‹åï¼Œæˆ‘ä»¬å£°æ˜ä¸€ä¸ª render æ–¹æ³•ï¼Œæ¯æ¬¡ stateChange äº‹ä»¶å‘ç”Ÿæ—¶éƒ½ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚è¿™ä¹Ÿæ˜¯ parent component.js æ£€æŸ¥çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ¸²æŸ“æ–¹æ³•ä¸­ï¼Œå¦‚æœæ²¡æœ‰é¡¹ç›®ï¼Œæˆ‘ä»¬ä¼šç»™å‡ºä¸€ä¸ªé¡¹ç›®åˆ—è¡¨æˆ–ä¸€ä¸ªå°é€šçŸ¥ã€‚æ‚¨è¿˜ä¼šçœ‹åˆ°ï¼Œæ¯ä¸ªæŒ‰é’®éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³çš„äº‹ä»¶ï¼Œå®ƒä»¬ä¼šåœ¨æˆ‘ä»¬çš„å•†åº—å†…è¿›è¡Œè°ƒåº¦å’Œæ“ä½œã€‚

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºè®¡æ•°ç»„ä»¶ã€‚åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º count.js çš„æ–°æ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹å†…å®¹:

```
import Component from '../lib/component.js';
import store from '../store/index.js';
export default class Count extends Component {
    constructor() {
        super({
            store,
            element: document.querySelector('.js-count')
        });
    }
    render() {
        let suffix = store.state.items.length !== 1 ? 's' : '';
        this.element.innerHTML = `
      You have ${store.state.items.length} task${suffix} today 
    `;
    }
} 
```

è¿™å¤„ç†æˆ‘ä»¬çš„é¡¹ç›®è®¡æ•°ï¼Œå®ƒæ˜¯ä¸è¨€è‡ªæ˜çš„ã€‚è®©æˆ‘ä»¬è¿›å…¥æœ€åä¸€ä¸ªéƒ¨åˆ†ã€‚åˆ›å»ºä¸€ä¸ªåä¸º status.js çš„æ–°æ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹å†…å®¹:

```
import Component from '../lib/component.js';
import store from '../store/index.js';
export default class Status extends Component {
    constructor() {
        super({
            store,
            element: document.querySelector('.js-status')
        });
    }
} 
```

### [](#views)è§†å›¾

æˆ‘ä»¬éœ€è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯åˆ›å»ºä¸€ä¸ª main.js æ–‡ä»¶å’Œ index.html è§†å›¾ã€‚åœ¨ js æ–‡ä»¶å¤¹ä¸­åˆ›å»º main.js æ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹å†…å®¹:

```
import store from './store/index.js';
import Count from './components/count.js';
import List from './components/list.js';
import Status from './components/status.js';
const formElement = document.querySelector('.js-form');
const inputElement = document.querySelector('#new-item-field');
formElement.addEventListener('submit', evt => {
    evt.preventDefault();
    let value = inputElement.value.trim();
    if (value.length) {
        store.dispatch('addItem', value);
        inputElement.value = '';
        inputElement.focus();
    }
});
const countInstance = new Count();
const listInstance = new List();
const statusInstance = new Status();
countInstance.render();
listInstance.render();
statusInstance.render(); 
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ‰€åšçš„å°±æ˜¯è·å–æˆ‘ä»¬éœ€è¦çš„ä¾èµ–é¡¹ã€‚æˆ‘ä»¬å·²ç»æœ‰äº†è‡ªå·±çš„å•†åº—ã€å‰ç«¯ç»„ä»¶å’Œä¸€äº› DOM å…ƒç´ ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å‘è¡¨å•æ·»åŠ ä¸€ä¸ªäº‹ä»¶ä¾¦å¬å™¨ï¼Œå¹¶ä½¿ç”¨ preventDefault é˜»æ­¢å®ƒæäº¤ã€‚ç„¶åï¼Œæˆ‘ä»¬è·å–æ–‡æœ¬æ¡†çš„å€¼ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„ä»»ä½•ç©ºç™½ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯å› ä¸ºæˆ‘ä»¬æƒ³æ£€æŸ¥æ¥ä¸‹æ¥æ˜¯å¦æœ‰ä»»ä½•å†…å®¹è¦ä¼ é€’ç»™å•†åº—ã€‚æœ€åï¼Œå¦‚æœæœ‰å†…å®¹ï¼Œæˆ‘ä»¬ç”¨è¯¥å†…å®¹è°ƒåº¦ addItem æ“ä½œ

ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºç»„ä»¶çš„æ–°å®ä¾‹ï¼Œå¹¶è°ƒç”¨å®ƒä»¬çš„æ¯ä¸ªå‘ˆç°æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨é¡µé¢ä¸Šè·å¾—åˆå§‹çŠ¶æ€ã€‚

åœ¨ src æ–‡ä»¶å¤¹ä¸­åˆ›å»º index.html æ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹ä»£ç :

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="https://bootswatch.com/4/flatly/bootstrap.css" />
    <title>Todo</title>
</head>
<body>
    <main>
        <header class="intro">
            <h1 class="intro__heading">Todo List</h1>
        </header>
        <section class="app">
            <section class="app__input">
                <h2 class="app__heading">Tasks</h2>
                <div class="js-items" aria-live="polite" aria-label="A list of items you have to done"></div>
                <form class="new-item js-form ">
                  <div>
                    <input type="text" class="new-todo" id="new-item-field" autocomplete="off" placeholder="What is to be done"/>
                    <button class="btn-primary save-button">Save</button>
                  </div>
                </form>
        </section>
          <aside class="app__status">
            <p role="status" class="visually-hidden"><span class="js-status"></span></p>
              <div class="app__decor js-count" aria-hidden="true">
              </div>
          </aside>
        </section>
    </main>
    <script type="module" src="js/main.js"></script>
</body>
</html> 
```

### [](#localstorage)æœ¬åœ°å­˜å‚¨

ä½¿ç”¨ç»ˆç«¯ï¼Œå°† cd æ”¾å…¥ src æ–‡ä»¶å¤¹å¹¶è¿è¡Œå‘½ä»¤ http-serverã€‚è¿™å°†åœ¨æœ¬åœ° web æœåŠ¡å™¨ä¸­ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæä¾›æœåŠ¡ã€‚ç°åœ¨è®¿é—® URL[http://localhost:8080](http://localhost:8080)æ¥æŸ¥çœ‹åº”ç”¨ç¨‹åºã€‚ç»§ç»­ï¼Œåœ¨é‚£é‡Œæ·»åŠ ç±»ä¼¼äº*ã€é˜…è¯»ä¹¦ç±ã€‘*çš„ä¸œè¥¿ã€‚

[![](../Images/cac73113549aaf16840eafb34664a6f1.png)T2ã€‘](https://res.cloudinary.com/practicaldev/image/fetch/s--4UARCxCS--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AUhGzBOV8wxnDkNIcdi5tyA.png)

æ‚¨ä¼šæ³¨æ„åˆ°ï¼Œå½“æˆ‘ä»¬åˆ·æ–°é¡µé¢æ—¶ï¼Œæˆ‘ä»¬è¾“å…¥çš„æ•°æ®ä¸¢å¤±äº†ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥ä¿å­˜æˆ–å­˜å‚¨æˆ‘ä»¬è¾“å…¥çš„æ•°æ®ã€‚LocalStorage å…è®¸æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å­˜å‚¨æ•°æ®ï¼Œå³ä½¿å½“ç”¨æˆ·å…³é—­æˆ–é‡æ–°åŠ è½½é¡µé¢æ—¶ï¼Œä¹Ÿå¯ä»¥æ£€ç´¢è¿™äº›æ•°æ®ã€‚æˆ‘ä»¬è¿˜èƒ½å¤Ÿä»æœ¬åœ°å­˜å‚¨ä¸­å†™å…¥ã€æ›´æ–°å’Œåˆ é™¤æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ localStorage.getItem æ–¹æ³•è·å–é¡¹ç›®ï¼Œä½¿ç”¨ localStorage.setItem æ–¹æ³•è®¾ç½®é¡¹ç›®ï¼Œä½¿ç”¨ localStorage.removeItem æ–¹æ³•ç§»é™¤é¡¹ç›®ã€‚

è®©æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­è®¾ç½® localStorageã€‚åœ¨/src/js/store/mutations.js æ–‡ä»¶ä¸­ï¼Œå°†å†…å®¹æ›¿æ¢ä¸º:

```
export default {
    addItem(state, payload) {
        state.items.push(payload);
        localStorage.setItem('items', JSON.stringify(state.items))   
        return state;
    },
    clearItem(state, payload) {
        state.items.splice(payload.index, 1);
        localStorage.setItem('items', JSON.stringify(state.items))
        return state;
    }
}; 
```

åœ¨ addItem æ–¹æ³•ä¸­ï¼Œåœ¨å°†æœ‰æ•ˆè´Ÿè½½æ¨å…¥ state å¯¹è±¡åï¼Œæˆ‘ä»¬å°† state.items è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å¸¦æœ‰ key name items çš„ localStorage ä¸­ã€‚æˆ‘ä»¬åœ¨ clearItem æ–¹æ³•ä¸­åšäº†ç±»ä¼¼çš„äº‹æƒ…ï¼Œæ­¤åä» state.items ä¸­åˆ é™¤ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬ç”¨ state.items çš„æ›´æ–°å€¼æ›´æ–° localStorageã€‚

æ¥ä¸‹æ¥åœ¨/src/js/store/state.js ä¸­ï¼Œå°†å…¶å†…å®¹æ›¿æ¢ä¸º:

```
export default {
    items: JSON.parse(localStorage.getItem('items') || '[]')   
}; 
```

è¿™é‡Œæˆ‘ä»¬æ£€æŸ¥ localStorage æ˜¯å¦å­˜åœ¨ä¸€ä¸ªåä¸º items çš„é”®ã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬è¦å°†å®ƒè®¾ç½®ä¸ºå˜é‡ itemsï¼Œå¦åˆ™å°† items è®¾ç½®ä¸ºç©ºæ•°ç»„ã€‚ç°åœ¨ï¼Œå³ä½¿æˆ‘ä»¬é‡æ–°åŠ è½½æˆ–å…³é—­é¡µé¢ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥ä¿ç•™æˆ‘ä»¬è¾“å…¥çš„æ•°æ®ã€‚

### [](#for-those-more-advanced)å¯¹äºæ›´é«˜çº§çš„äººæ¥è¯´

å¦‚æœæ‚¨è¿˜è®°å¾—åœ¨ store.js æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†ä¸€ä¸ª ES6 ç‰¹æ€§ï¼Œä»£ç†æ¥ç›‘è§†çŠ¶æ€å¯¹è±¡ã€‚è¿™å®é™…ä¸Šæ˜¯åŒ…è£…ä¸€ä¸ªç°æœ‰çš„å¯¹è±¡ï¼Œä¹Ÿç§°ä¸ºç›®æ ‡ï¼Œå¹¶æ‹¦æˆªå¯¹å…¶å±æ€§æˆ–æ–¹æ³•çš„ä»»ä½•è®¿é—®ï¼Œå³ä½¿å®ƒä»¬ä¸å­˜åœ¨ã€‚ä»£ç†å¯¹è±¡æœ‰ä¸€äº›*é™·é˜±*ï¼Œå¯ä»¥åœ¨æˆæƒè®¿é—®ç›®æ ‡ä¹‹å‰è°ƒç”¨ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ set trap æ¥ç›‘è§†çŠ¶æ€å¯¹è±¡çš„å˜åŒ–ã€‚è¿™æ„å‘³ç€å½“ä¸€ä¸ªçªå˜è¿è¡Œç±»ä¼¼ state.name ="Foo "çš„ä¸œè¥¿æ—¶ï¼Œè¿™ä¸ªé™·é˜±ä¼šåœ¨å®ƒè¢«è®¾ç½®ä¹‹å‰æ•è·å®ƒã€‚ä»£ç†çš„ä¸€äº›ç”¨ä¾‹åŒ…æ‹¬éªŒè¯ã€å€¼ä¿®æ­£ã€å±æ€§æŸ¥æ‰¾æ‰©å±•ã€è·Ÿè¸ªå±æ€§è®¿é—®ç­‰ç­‰ã€‚

### [](#conclusion)ç»“è®º

æˆ‘ä»¬å·²ç»æ¢ç´¢äº†å¦‚ä½•åœ¨ JavaScript ä¸­å®ç°çŠ¶æ€ç®¡ç†ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†è§‚å¯Ÿè€…æ¶æ„è®¾è®¡æ¨¡å¼å’Œæœ¬åœ°å­˜å‚¨ã€‚æœ‰è®¸å¤šåœºæ™¯éœ€è¦å®ç°çŠ¶æ€ç®¡ç†ï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯ç”¨æˆ·ç®¡ç†å’Œèº«ä»½éªŒè¯ã€‚ä½ å¯ä»¥åœ¨ [Github](https://github.com/caleboki/state-management-js) ä¸ŠæŸ¥çœ‹æœ€ç»ˆäº§å“ï¼Œå¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–è¯„è®ºï¼Œè¯·ä¸è¦çŠ¹è±«ï¼Œåœ¨ä¸‹é¢å‘è¡¨ã€‚

* * *

### [](#plug-logrocket-a-dvr-for-web-apps)Plug: [LogRocket](https://logrocket.com/signup/) ï¼Œä¸€æ¬¾é€‚ç”¨äºç½‘ç»œåº”ç”¨çš„ DVR

[![](../Images/d56be9e9e36d8fa98c6959f7097b7787.png)](https://logrocket.com/signup/)

<figcaption>[https://logrocket.com/signup/](https://logrocket.com/signup/)</figcaption>

LogRocket æ˜¯ä¸€ä¸ªå‰ç«¯æ—¥å¿—å·¥å…·ï¼Œå¯ä»¥è®©ä½ å›æ”¾é—®é¢˜ï¼Œå°±åƒå®ƒä»¬å‘ç”Ÿåœ¨ä½ è‡ªå·±çš„æµè§ˆå™¨ä¸­ä¸€æ ·ã€‚LogRocket ä¸éœ€è¦çŒœæµ‹é”™è¯¯å‘ç”Ÿçš„åŸå› ï¼Œä¹Ÿä¸éœ€è¦å‘ç”¨æˆ·è¯¢é—®æˆªå›¾å’Œæ—¥å¿—è½¬å‚¨ï¼Œè€Œæ˜¯è®©æ‚¨é‡æ”¾ä¼šè¯ä»¥å¿«é€Ÿäº†è§£å“ªé‡Œå‡ºé”™äº†ã€‚å®ƒå¯ä»¥ä¸ä»»ä½•åº”ç”¨ç¨‹åºå®Œç¾é…åˆï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ¡†æ¶ï¼Œå¹¶ä¸”æœ‰æ’ä»¶å¯ä»¥è®°å½•æ¥è‡ª Reduxã€Vuex å’Œ@ngrx/store çš„é¢å¤–ä¸Šä¸‹æ–‡ã€‚

é™¤äº†è®°å½• Redux æ“ä½œå’ŒçŠ¶æ€ï¼ŒLogRocket è¿˜è®°å½•æ§åˆ¶å°æ—¥å¿—ã€JavaScript é”™è¯¯ã€å †æ ˆè·Ÿè¸ªã€å¸¦æœ‰å¤´+æ­£æ–‡çš„ç½‘ç»œè¯·æ±‚/å“åº”ã€æµè§ˆå™¨å…ƒæ•°æ®å’Œè‡ªå®šä¹‰æ—¥å¿—ã€‚å®ƒè¿˜ä½¿ç”¨ DOM æ¥è®°å½•é¡µé¢ä¸Šçš„ HTML å’Œ CSSï¼Œç”šè‡³ä¸ºæœ€å¤æ‚çš„å•é¡µé¢åº”ç”¨ç¨‹åºé‡æ–°åˆ›å»ºåƒç´ çº§å®Œç¾è§†é¢‘ã€‚

å…è´¹è¯•ç”¨ã€‚

* * *

å¸–å­ã€JavaScript ä¸­çš„çŠ¶æ€ç®¡ç†æ¨¡å¼:è·¨ç»„ä»¶å…±äº«æ•°æ®ã€‘([https://Blog . log rocket . com/State-management-pattern-in-JavaScript-Sharing-data-cross-components-f 4420581 f 535/](https://blog.logrocket.com/state-management-pattern-in-javascript-sharing-data-across-components-f4420581f535/)æœ€å…ˆå‡ºç°åœ¨ [LogRocket åšå®¢](https://blog.logrocket.com)ä¸Šã€‚